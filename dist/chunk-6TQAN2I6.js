import{a as $l}from"./chunk-2G2GIW6W.js";import{a as Xl,b as Ql,c as Zl,e as er}from"./chunk-5PTZGGBL.js";import{a as zl,b as ql}from"./chunk-MCGZ3BDK.js";import{$ as Oi,$a as Je,$b as jo,$c as ji,$d as gn,$g as Ki,Aa as yt,Ac as Ho,Ad as Ot,Ae as Ce,Ag as Tl,Ah as co,Ba as Et,Bc as ki,Bd as zo,Bh as Gl,Ca as vt,Cb as we,Cc as Jo,Cd as qo,Cg as Ol,Ch as Ul,Da as m,Db as li,Dc as Bi,Dd as Qo,De as tl,Dg as xl,Dh as kl,Ea as p,Eb as _n,Ec as ci,Ed as $o,Fa as f,Fb as pt,Fc as Yo,Fd as fn,Fe as Ji,Fh as An,Ga as O,Gb as Go,Ge as ye,Gf as cl,Hb as Gt,He as Sn,Hh as Ln,I as oe,Ib as Mi,Ie as il,Ih as nn,Jb as Di,Je as Cn,Jf as pl,Jg as Rl,Jh as Mn,Ka as Pe,Kb as Uo,Ke as nl,Kf as Ze,Kh as Bl,La as Te,Lb as ko,Le as xt,Lh as jl,Ma as wt,Mb as un,Md as ge,Me as He,Mh as Vl,N as De,Na as M,Nb as Bo,Ne as Ue,Nh as Wl,O as ei,Oc as Ut,Of as Wt,Oh as Hl,P as pn,Pa as P,Pd as ue,Pg as wi,Ph as Dn,Q as G,Qa as _,Qd as dt,Qf as fi,Qg as Tn,Qh as Jl,R as zt,Ra as Fi,Rc as ro,Rd as Zo,Re as Bt,Rg as Fl,Rh as Yl,Sa as Ai,Sc as kt,Sd as ot,Se as _i,Sh as Kl,T as w,Ta as It,Td as Wi,Tf as dl,U as g,Ua as _e,Ud as Hi,V as te,Va as se,Vc as Br,Vd as pi,Ve as ol,Vg as Al,W as ie,Wa as ce,Wc as I,Wd as fe,Wg as Yi,X as xo,Xc as q,Xd as $e,Xf as bn,Xg as Jt,Yb as ri,Yc as Ne,Yd as mn,Yf as _l,Yg as Yt,Za as Oe,Zc as ke,Zd as hn,Zf as ul,Zg as On,_a as ni,_c as vi,_d as wn,_e as ll,_f as en,aa as Ro,ab as Nt,ac as to,ad as Me,ag as Ht,b as sn,bb as he,bd as We,bg as fl,bh as Ft,cb as C,cc as io,cd as Ae,ch as tn,da as $n,db as U,dd as $,df as ao,ea as xi,eb as F,ec as no,ed as k,eh as xn,fb as Li,fc as oo,fd as Ko,fg as ml,fh as qt,g as Po,ga as Fo,gb as V,gd as Zi,gg as hl,gh as Rn,ha as Ao,hb as W,hc as lo,hd as de,hg as mi,hh as gi,i as Qn,ia as c,ib as H,id as Ye,ih as Ll,jb as B,jd as Ge,jf as rl,jg as Rt,jh as so,ka as ti,kb as nt,kd as xe,ke as Se,kf as Le,kg as Pn,la as Lo,lb as Ve,ld as Tt,le as di,lf as Ee,mb as Do,md as Xo,mf as jt,mg as wl,na as Ri,nb as Y,nc as ai,nd as Mt,nf as ui,ng as gl,oa as L,ob as Re,od as z,of as me,og as Sl,pb as Qe,pc as ee,pf as be,pg as Cl,ph as Xi,q as $i,qa as je,qb as Zn,qc as bt,qf as yn,qg as yl,qh as Fn,ra as ii,rb as eo,rc as Ni,rg as El,sb as y,sc as Ei,se as el,sf as En,sg as vl,ta as Mo,tb as E,tc as Vo,td as Fe,tf as vn,u as cn,ua as ct,ub as oi,uc as K,uf as al,ug as hi,v as To,va as dn,vb as No,vc as Pt,vd as Vi,vf as sl,vh as Ml,wa as J,wb as pe,wc as Gi,wd as Z,we as lt,wf as Vt,wg as Il,wh as zi,xa as qe,xc as si,xf as In,xg as bl,xh as Dl,ya as x,yc as Ui,yh as qi,z as Oo,za as R,zc as Wo,ze as rt,zg as Pl,zh as Nl}from"./chunk-FPZA7CK2.js";import{a as Lt,b as Ti,f as kr,g as le}from"./chunk-GAL4ENT6.js";var _t=class{constructor(s,i,e,t,n){this.utilService=s,this.firewallId=i,this.clusterId=e,this.fwcloudId=t,this.policyType=n,this.rules=[]}getFirewallId(){return this.firewallId}getFwcloudId(){return this.fwcloudId}getClusterId(){return this.clusterId}getPolicyType(){return this.policyType}getPolicyRules(){return this.rules}getPolicyRule(s){let i=null;if(Array.isArray(this.rules))for(let e=0;e<this.rules.length&&!i;e++){let t=this.rules[e];t.id===s?i=t:t.rule_group&&Array.isArray(t.rules)&&(i=t.rules.find(n=>n.id===s))}return i}getShowAction(){return this.showAction}setShowAction(s){this.showAction=s}setPolicyRules(s){this.rules=s}getPolicyRulesLength(){return this.rules?this.rules.length:0}};var Ii=class extends _t{constructor(s,i,e,t,n,l,o,a,u,d){super(s,t,n,l,o),this.utilService=s,this.fwcRoutingTableService=i,this.fwcPolicyGridRoutingTableFunctionalityService=e,this.translationKeys={ENTITY_NAME:"ROUTING.NEW_TABLE_PANEL.ROUTE",ENTITY_DELETE:"ROUTING.ROUTE.DELETE_TEXT",DELETE_SUCCESS:"ROUTING.ROUTE.DELETE_SUCCESS",ENTITY_COLOR:"ROUTING.ROUTE.COLOR_TEXT"},this.routingTableId=u,this.routingTableName=d,this.buildPolicyRules(a)}getRoutingTableId(){return this.routingTableId}getRoutingTableName(){return this.routingTableName}buildPolicyRules(s){let i=[];Array.isArray(s)&&(i=this.fwcPolicyGridRoutingTableFunctionalityService.parseRoutingTableRoutes(this.firewallId,this.fwcloudId,s)),this.rules=i}newPolicyRule(s,i){s&&i!==void 0?this.fwcPolicyGridRoutingTableFunctionalityService.showNewRouteDialog(this.clusterId,this.firewallId,this.routingTableId,this.routingTableName,s.id,i):this.fwcPolicyGridRoutingTableFunctionalityService.showNewRouteDialog(this.clusterId,this.firewallId,this.routingTableId,this.routingTableName)}deletePolicyRuleApiCall(s){return this.utilService.fwcAPICall(this.fwcRoutingTableService.deleteRoutingTableRoutes.bind(this.fwcRoutingTableService),this.firewallId,this.fwcloudId,this.routingTableId,s)}convertPolicyRulesToRoutes(){let s=[];if(Array.isArray(this.rules))for(let i of this.rules){let e=this.convertPolicyRuleToRoute(i);s.push(e)}return s}convertPolicyRuleToRoute(s){let i,e,t=[];if(Array.isArray(s.positions)&&s.positions.length){let l=s.positions.find(u=>u.id===vi.GATEWAY_POSITION);if(l){let u=l.ipobjs.find(d=>d.type===I.OBJ_ADDRESS);u&&(i=u.id)}let o=s.positions.find(u=>u.id===vi.INTERFACE_POSITION);if(o){let u=o.ipobjs.find(d=>d.type===I.OBJ_INTERFACE_FIREWALL||d.type===I.OBJ_INTERFACE_HOST);u&&(e=u.id)}let a=s.positions.find(u=>u.id===vi.TO_POSITION);if(a&&Array.isArray(a.ipobjs))for(let u of a.ipobjs)u._fwcObjType!==I.OBJ_ANY&&t.push({id:u.id,name:u.name,type:u.type,firewall_id:u.firewall_id,cluster_id:u.cluster_id,cluster_name:u.cluster_name,position_order:u.position_order})}return{id:s.id,routingTableId:this.routingTableId,routeGroupId:s.idgroup,comment:s.comment,style:s.style,route_order:s.rule_order,active:!!s.active,firewallApplyToId:null,gatewayId:i,interfaceId:e,items:t}}manageObject(s,i,e,t){this.fwcPolicyGridRoutingTableFunctionalityService.updateRoutePosition(this,this.firewallId,this.fwcloudId,this.routingTableId,s,i,e,t)}deleteObject(s,i){this.fwcPolicyGridRoutingTableFunctionalityService.deleteObjectFromPosition(this.firewallId,this.clusterId,this.fwcloudId,this.routingTableId,s.rule,s,i)}compileSelectedRoutes(){this.fwcPolicyGridRoutingTableFunctionalityService.compileRoutes(this.routingTableId)}moveSelectedRules(s,i){this.fwcPolicyGridRoutingTableFunctionalityService.moveSelectedRoutes(this.clusterId,this.firewallId,this.fwcloudId,this.routingTableId,i.pasteOnRuleId,i.rulesIds,i.pasteOffset)}manageSelectedRules(s,i){return this.utilService.fwcAPICall(this.fwcRoutingTableService.manageTableRoutes.bind(this.fwcRoutingTableService),this.firewallId,this.fwcloudId,this.routingTableId,s.pasteOnRuleId,s.pasteOffset,s.rulesIds,i)}setRuleActive(s,i){let e={active:!!i};this.fwcPolicyGridRoutingTableFunctionalityService.updateSelectedRoutes(this.clusterId,this.firewallId,this.fwcloudId,this.routingTableId,e)}setRuleComment(s){this.fwcPolicyGridRoutingTableFunctionalityService.updateRouteComment(this.routingTableId,s)}setRuleApplyTo(s){this.fwcPolicyGridRoutingTableFunctionalityService.updateRuleApplyTo(this.routingTableId,s)}setRuleScript(s){}setRuleStyleApiCall(){return this.fwcPolicyGridRoutingTableFunctionalityService.setRouteStyle.bind(this.fwcPolicyGridRoutingTableFunctionalityService)}newRuleGroupApiCall(){return this.fwcPolicyGridRoutingTableFunctionalityService.newRouteGroup.bind(this.fwcPolicyGridRoutingTableFunctionalityService)}setRuleGroupStyleApiCall(){return this.fwcPolicyGridRoutingTableFunctionalityService.setGroupValues.bind(this.fwcPolicyGridRoutingTableFunctionalityService)}setRuleGroupNameApiCall(){return this.fwcPolicyGridRoutingTableFunctionalityService.setGroupValues.bind(this.fwcPolicyGridRoutingTableFunctionalityService)}removeRulesFromGroupApiCall(s){let i={routeGroupId:null},e=s.rulesIds;return this.utilService.fwcAPICall(this.fwcRoutingTableService.updateRoutingTableRoutes.bind(this.fwcRoutingTableService),this.firewallId,this.fwcloudId,this.routingTableId,e,i)}deleteRuleGroupApiCall(s){return this.utilService.fwcAPICall(this.fwcRoutingTableService.deleteRoutingTableRouteGroup.bind(this.fwcRoutingTableService),this.firewallId,this.fwcloudId,s)}};var Kt=class extends _t{constructor(s,i,e,t,n,l,o,a,u,d,h){super(s,t,n,l,o),this.utilService=s,this.fwcDhcpPolicyService=i,this.fwcPolicyGridDhcpRulesFunctionalityService=e,this.messageService=d,this.translate=h,this.translationKeys={ENTITY_NAME:"RULE.RULE",ENTITY_DELETE:"RULE.DELETE_TEXT",DELETE_SUCCESS:"RULE.DELETE_SUCCESS",ENTITY_COLOR:"RULE.COLOR_TEXT"},this.dhcpGroupId=u,this.buildPolicyRules(a)}compileSelectedRoutes(s){throw new Error("Method not implemented.")}getDhcpGroupId(){return this.dhcpGroupId}buildPolicyRules(s){let i=[];Array.isArray(s)&&(i=this.fwcPolicyGridDhcpRulesFunctionalityService.parseDhcpPolicyRules(this.firewallId,this.fwcloudId,s)),this.rules=i}newPolicyRule(s,i){s&&i!==void 0?this.fwcPolicyGridDhcpRulesFunctionalityService.showNewRuleDialog(this.clusterId,this.firewallId,s.id,i):this.fwcPolicyGridDhcpRulesFunctionalityService.showNewRuleDialog(this.clusterId,this.firewallId)}deletePolicyRuleApiCall(s){return this.utilService.fwcAPICall(this.fwcDhcpPolicyService.deleteDhcpPolicyRules.bind(this.fwcDhcpPolicyService),this.firewallId,this.fwcloudId,s)}manageObject(s,i,e,t){this.fwcPolicyGridDhcpRulesFunctionalityService.updateRulePosition(this,this.firewallId,this.fwcloudId,s,i,e,t).catch(()=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.translate.instant("DHCP.POLICY.ERROR_MANAGING_OBJECT")})})}deleteObject(s,i){this.fwcPolicyGridDhcpRulesFunctionalityService.deleteObjectFromPosition(this.firewallId,this.clusterId,this.fwcloudId,s.rule,s,i)}compileSelectedRules(){this.fwcPolicyGridDhcpRulesFunctionalityService.compileSelectedRules()}moveSelectedRules(s,i){this.fwcPolicyGridDhcpRulesFunctionalityService.moveSelectedRules(i.firewall,i.fwcloud,i.pasteOnRuleId,i.rulesIds,i.pasteOffset)}manageSelectedRules(s,i){return this.utilService.fwcAPICall(this.fwcDhcpPolicyService.manageDhcpPolicyRules.bind(this.fwcDhcpPolicyService),this.firewallId,this.fwcloudId,s.pasteOnRuleId,s.pasteOffset,s.rulesIds,i)}setRuleActive(s,i){let e={active:!!i};this.fwcPolicyGridDhcpRulesFunctionalityService.updateSelectedRules(this.clusterId,this.firewallId,this.fwcloudId,e)}setRuleComment(s){this.fwcPolicyGridDhcpRulesFunctionalityService.updateRuleComment(s)}setRuleApplyTo(s){this.fwcPolicyGridDhcpRulesFunctionalityService.handleChangeApplyToGroup(s)}setRuleLeaseTime(s){this.fwcPolicyGridDhcpRulesFunctionalityService.updateRuleLeaseTime(s)}setRuleScript(s){this.fwcPolicyGridDhcpRulesFunctionalityService.updateRuleCfgText(s)}setRuleStyleApiCall(){return this.fwcPolicyGridDhcpRulesFunctionalityService.setRuleStyle.bind(this.fwcPolicyGridDhcpRulesFunctionalityService)}newRuleGroupApiCall(){return this.fwcPolicyGridDhcpRulesFunctionalityService.newDhcpRuleGroup.bind(this.fwcPolicyGridDhcpRulesFunctionalityService)}setRuleGroupStyleApiCall(){return this.fwcPolicyGridDhcpRulesFunctionalityService.setGroupValues.bind(this.fwcPolicyGridDhcpRulesFunctionalityService)}setRuleGroupNameApiCall(){return this.fwcPolicyGridDhcpRulesFunctionalityService.setGroupValues.bind(this.fwcPolicyGridDhcpRulesFunctionalityService)}removeRulesFromGroupApiCall(s){let i={group:null},e=s.rulesIds;return this.utilService.fwcAPICall(this.fwcDhcpPolicyService.updateDhcpPolicyRules.bind(this.fwcDhcpPolicyService),this.firewallId,this.fwcloudId,e,i)}deleteRuleGroupApiCall(s){return this.utilService.fwcAPICall(this.fwcDhcpPolicyService.deleteDhcpPolicyRulesGroup.bind(this.fwcDhcpPolicyService),this.firewallId,this.fwcloudId,s)}};var Si=class extends _t{constructor(s,i,e,t,n,l,o,a,u){super(s,t,n,l,o),this.utilService=s,this.fwcKeepalivedPolicyService=i,this.fwcPolicyGridKeepalivedRulesFunctionalityService=e,this.translationKeys={ENTITY_NAME:"RULE.RULE",ENTITY_DELETE:"RULE.DELETE_TEXT",DELETE_SUCCESS:"RULE.DELETE_SUCCESS",ENTITY_COLOR:"RULE.COLOR_TEXT"},this.keepalivedGroupId=u,this.buildPolicyRules(a)}compileSelectedRoutes(s){throw new Error("Method not implemented.")}getKeepalivedGroupId(){return this.keepalivedGroupId}buildPolicyRules(s){let i=[];Array.isArray(s)&&(i=this.fwcPolicyGridKeepalivedRulesFunctionalityService.parseKeepalivedPolicyRules(this.firewallId,this.fwcloudId,s)),this.rules=i}newPolicyRule(s,i){s&&i!==void 0?this.fwcPolicyGridKeepalivedRulesFunctionalityService.showNewRuleDialog(this.clusterId,this.firewallId,s.id,i):this.fwcPolicyGridKeepalivedRulesFunctionalityService.showNewRuleDialog(this.clusterId,this.firewallId)}deletePolicyRuleApiCall(s){return this.utilService.fwcAPICall(this.fwcKeepalivedPolicyService.deleteKeepalivedPolicyRules.bind(this.fwcKeepalivedPolicyService),this.firewallId,this.fwcloudId,s)}manageObject(s,i,e,t){this.fwcPolicyGridKeepalivedRulesFunctionalityService.updateRulePosition(this,this.firewallId,this.fwcloudId,s,i,e,t)}deleteObject(s,i){this.fwcPolicyGridKeepalivedRulesFunctionalityService.deleteObjectFromPosition(this.firewallId,this.clusterId,this.fwcloudId,s.rule,s,i)}compileSelectedRules(){this.fwcPolicyGridKeepalivedRulesFunctionalityService.compileSelectedRules()}moveSelectedRules(s,i){this.fwcPolicyGridKeepalivedRulesFunctionalityService.moveSelectedRules(i.firewall,i.fwcloud,i.pasteOnRuleId,i.rulesIds,i.pasteOffset)}manageSelectedRules(s,i){return this.utilService.fwcAPICall(this.fwcKeepalivedPolicyService.manageKeepalivedPolicyRules.bind(this.fwcKeepalivedPolicyService),this.firewallId,this.fwcloudId,s.pasteOnRuleId,s.pasteOffset,s.rulesIds,i)}setRuleActive(s,i){let e={active:!!i};this.fwcPolicyGridKeepalivedRulesFunctionalityService.updateSelectedRules(this.clusterId,this.firewallId,this.fwcloudId,e)}setRuleScript(s){this.fwcPolicyGridKeepalivedRulesFunctionalityService.updateRuleCfgText(s)}setRuleComment(s){this.fwcPolicyGridKeepalivedRulesFunctionalityService.updateRuleComment(s)}setRuleApplyTo(s){this.fwcPolicyGridKeepalivedRulesFunctionalityService.handleChangeApplyToGroup(s)}setRuleStyleApiCall(){return this.fwcPolicyGridKeepalivedRulesFunctionalityService.setRuleStyle.bind(this.fwcPolicyGridKeepalivedRulesFunctionalityService)}newRuleGroupApiCall(){return this.fwcPolicyGridKeepalivedRulesFunctionalityService.newKeepalivedRuleGroup.bind(this.fwcPolicyGridKeepalivedRulesFunctionalityService)}setRuleGroupStyleApiCall(){return this.fwcPolicyGridKeepalivedRulesFunctionalityService.setGroupValues.bind(this.fwcPolicyGridKeepalivedRulesFunctionalityService)}setRuleGroupNameApiCall(){return this.fwcPolicyGridKeepalivedRulesFunctionalityService.setGroupValues.bind(this.fwcPolicyGridKeepalivedRulesFunctionalityService)}removeRulesFromGroupApiCall(s){let i={group:null},e=s.rulesIds;return this.utilService.fwcAPICall(this.fwcKeepalivedPolicyService.updateKeepalivedPolicyRule.bind(this.fwcKeepalivedPolicyService),this.firewallId,this.fwcloudId,e,i)}deleteRuleGroupApiCall(s){return this.utilService.fwcAPICall(this.fwcKeepalivedPolicyService.deleteKeepalivedPolicyRulesGroup.bind(this.fwcKeepalivedPolicyService),this.firewallId,this.fwcloudId,s)}};var Ci=class extends _t{constructor(s,i,e,t,n,l,o,a,u){super(s,t,n,l,o),this.utilService=s,this.fwcHAProxyPolicyService=i,this.fwcPolicyGridHAProxyRulesFunctionalityService=e,this.translationKeys={ENTITY_NAME:"RULE.RULE",ENTITY_DELETE:"RULE.DELETE_TEXT",DELETE_SUCCESS:"RULE.DELETE_SUCCESS",ENTITY_COLOR:"RULE.COLOR_TEXT"},this.HAProxyGroupId=u,this.buildPolicyRules(a)}compileSelectedRoutes(s){throw new Error("Method not implemented.")}getHAProxyGroupId(){return this.HAProxyGroupId}buildPolicyRules(s){let i=[];Array.isArray(s)&&(i=this.fwcPolicyGridHAProxyRulesFunctionalityService.parseHAProxyPolicyRules(this.firewallId,this.fwcloudId,s)),this.rules=i}newPolicyRule(s,i){s&&i!==void 0?this.fwcPolicyGridHAProxyRulesFunctionalityService.showNewRuleDialog(this.clusterId,this.firewallId,s.id,i):this.fwcPolicyGridHAProxyRulesFunctionalityService.showNewRuleDialog(this.clusterId,this.firewallId)}deletePolicyRuleApiCall(s){return this.utilService.fwcAPICall(this.fwcHAProxyPolicyService.deleteHAProxyPolicyRules.bind(this.fwcHAProxyPolicyService),this.firewallId,this.fwcloudId,s)}manageObject(s,i,e,t){this.fwcPolicyGridHAProxyRulesFunctionalityService.updateRulePosition(this,this.firewallId,this.fwcloudId,s,i,e,t)}deleteObject(s,i){this.fwcPolicyGridHAProxyRulesFunctionalityService.deleteObjectFromPosition(this.firewallId,this.clusterId,this.fwcloudId,s.rule,s,i)}compileSelectedRules(){this.fwcPolicyGridHAProxyRulesFunctionalityService.compileSelectedRules()}moveSelectedRules(s,i){this.fwcPolicyGridHAProxyRulesFunctionalityService.moveSelectedRules(i.firewall,i.fwcloud,i.pasteOnRuleId,i.rulesIds,i.pasteOffset)}manageSelectedRules(s,i){return this.utilService.fwcAPICall(this.fwcHAProxyPolicyService.manageHAProxyPolicyRules.bind(this.fwcHAProxyPolicyService),this.firewallId,this.fwcloudId,s.pasteOnRuleId,s.pasteOffset,s.rulesIds,i)}setRuleActive(s,i){let e={active:!!i};this.fwcPolicyGridHAProxyRulesFunctionalityService.updateSelectedRules(this.clusterId,this.firewallId,this.fwcloudId,e)}setRuleComment(s){this.fwcPolicyGridHAProxyRulesFunctionalityService.updateRuleComment(s)}setRuleApplyTo(s){this.fwcPolicyGridHAProxyRulesFunctionalityService.handleChangeApplyToGroup(s)}setRuleScript(s){this.fwcPolicyGridHAProxyRulesFunctionalityService.updateRuleCfgText(s)}setRuleStyleApiCall(){return this.fwcPolicyGridHAProxyRulesFunctionalityService.setRuleStyle.bind(this.fwcPolicyGridHAProxyRulesFunctionalityService)}newRuleGroupApiCall(){return this.fwcPolicyGridHAProxyRulesFunctionalityService.newHAProxyRuleGroup.bind(this.fwcPolicyGridHAProxyRulesFunctionalityService)}setRuleGroupStyleApiCall(){return this.fwcPolicyGridHAProxyRulesFunctionalityService.setGroupValues.bind(this.fwcPolicyGridHAProxyRulesFunctionalityService)}setRuleGroupNameApiCall(){return this.fwcPolicyGridHAProxyRulesFunctionalityService.setGroupValues.bind(this.fwcPolicyGridHAProxyRulesFunctionalityService)}removeRulesFromGroupApiCall(s){let i={group:null},e=s.rulesIds;return this.utilService.fwcAPICall(this.fwcHAProxyPolicyService.updateHAProxyPolicyRules.bind(this.fwcHAProxyPolicyService),this.firewallId,this.fwcloudId,e,i)}deleteRuleGroupApiCall(s){return this.utilService.fwcAPICall(this.fwcHAProxyPolicyService.deleteHAProxyPolicyRulesGroup.bind(this.fwcHAProxyPolicyService),this.firewallId,this.fwcloudId,s)}};var Nn=(()=>{let s=class s{constructor(e,t){this.translate=e,this.utilService=t}showDangerousRules(e,t,n,l,o){let a=!!(this.componentRef&&!this.componentRef.hostView.destroyed);if(!Array.isArray(e)||!e.length&&!a)return null;let u=this.getOrCreatePanel();if(!u)return null;let d=e.map(S=>{let v=S.dangerousRuleData||{};return{id:S.id,ruleIPType:v.ruleIPType||"",ruleChainType:v.ruleChainType||"",ruleOrder:v.ruleOrder??v.rule_order??-1,critical:!!v.critical}}),h={dialogTitle:this.translate.instant("COMPILE.DANGEROUS_RULES_HEADER"),firewallName:t,firewallId:n,firewallType:l,rules:d};return u.openWithData(h,o),u}hidePanel(){this.componentRef&&!this.componentRef.hostView.destroyed&&this.componentRef.instance.hideDialog()}bringPanelToFront(){this.componentRef&&!this.componentRef.hostView.destroyed&&this.componentRef.instance.bringToFront()}getOrCreatePanel(){if(this.componentRef&&!this.componentRef.hostView.destroyed)return this.componentRef.instance;let e=this.utilService.createDynamicComponentRef(Yl);return e?(this.componentRef=e,e.instance.setDynamicComponentRef(e),e.onDestroy(()=>{this.componentRef===e&&(this.componentRef=void 0)}),e.changeDetectorRef.detectChanges(),e.instance):null}};s.\u0275fac=function(t){return new(t||s)(G(ue),G(me))},s.\u0275prov=De({token:s,factory:s.\u0275fac,providedIn:"root"});let r=s;return r})();var Gn=(()=>{let s=class s{constructor(e,t,n,l,o,a,u,d,h,S,v,b,T,A,N,j,D,Q,X){this.fwcContextMenuService=e,this.fwcErrorPipe=t,this.fwcPolicyService=n,this.fwcFirewallService=l,this.fwcUserService=o,this.itemSelectedService=a,this.ruleSelectedService=u,this.inputDataService=d,this.utilService=h,this.fwcPolicyGridRoutingTableFunctionalityService=S,this.renderer=v,this.cd=b,this.messageService=T,this.confirmationService=A,this.translate=N,this.store=j,this.fwcAiAssistantService=D,this.aiAssistantCheckEnabledService=Q,this.fwcDangerousRuleFunctionalityService=X,this.aiAssistantCheckEnabled=!1,this.infoTooltipShown=!1,this.subsetDangerousRulesRecompileInProgress=!1,this.ruleContextMenu=e.getRuleMenus(),this.aiAssistantCheckEnabledSubscription=this.aiAssistantCheckEnabledService.getaiAssistantCheckEnabled().subscribe(re=>{this.aiAssistantCheckEnabled=re})}ngOnDestroy(){this.aiAssistantCheckEnabledSubscription&&this.aiAssistantCheckEnabledSubscription.unsubscribe()}setRuleTooltip(e){let t="RULE.RULE_ID";e.type===Ne.ROUTING_TABLE&&(t="ROUTING.ROUTE.ROUTE_ID");let n="<h6>"+this.translate.instant(t)+" <strong>"+e.id+"</strong></h6><ul>";if(e.special&&e.special!=ke.HOOKSCRIPT&&(n+='<li><i class="fa fa-fw fa-exclamation-circle fwcOrange"></i> '+this.translate.instant("RULE.RULE_IS_SPECIAL")+"</li>"),e.options){let l=e.special&&e.special!=ke.HOOKSCRIPT?"fwcOrange":"fwcBlue";n+='<li><i class="fa fa-fw fa-cog '+l+'"></i> '+this.translate.instant("RULE.RULE_HAS_OPTIONS")+"</li>"}return(e.run_before||e.run_after)&&(n+='<li><i class="fa fa-fw fa-file-code fwcOrange"></i> '+this.translate.instant("RULE.RULE_HAS_HOOKS")+"</li>"),e.active||(n+='<li><i class="fa fa-fw fa-times fwcRed"></i> '+this.translate.instant("RULE.RULE_IS_DISABLED")+"</li>"),n+="</ul>",n}selectRule(e,t){if(t&&t.shiftKey){let n,l,o;this.ruleSelectedService.addSelectedRule(e),o=this.ruleSelectedService.getActualSelectedRules();for(let a=0;a<o.length;a++)(o[a].rule_order<n||n==null)&&(n=o[a].rule_order),(o[a].rule_order>n||l==null)&&(l=o[a].rule_order);n&&l&&n!=l&&this.ruleSelectedService.setSelectedRuleRange(n,l)}else t&&t.ctrlKey?(this.ruleSelectedService.isRuleSelected(e.id)?this.ruleSelectedService.removeSelectedRule(e):this.ruleSelectedService.addSelectedRule(e),t.preventDefault()):(this.ruleSelectedService.clearSelectedRules(),this.ruleSelectedService.addSelectedRule(e))}editRule(e){e.type!==Ne.POLICY_ROUTING&&e.type!==Ne.ROUTING_TABLE&&e.special!==ke.HOOKSCRIPT&&e.special!==ke.FAIL2BAN&&this.ruleSelectedService.setRule(e)}getRulePolicyType(e){let t;return Array.isArray(e.positions)&&e.positions.length&&(t=e.positions[0].policy_type),t}onContextMenuLoad(e,t){return le(this,null,function*(){let n,l,o,a,u,d,h,S=!1,v,b,T=!1,A,N=!1,j,D,Q=this.fwcUserService.getActualFwcUser();switch(e.type){case Ne.ROUTING_TABLE:D=this.ruleContextMenu.ROUTE;break;case Ne.POLICY_ROUTING:D=this.ruleContextMenu.ROUTING_RULE;break;case $[q.DHCP]:case $[q.DHCP_FIXED_IP]:D=this.ruleContextMenu.DHCP_RULE;break;case $[q.KEEPALIVED]:D=this.ruleContextMenu.KEEPALIVED_RULE;break;case $[q.HAPROXY]:D=this.ruleContextMenu.HAPROXY_RULE;break;default:D=this.ruleContextMenu.RULE}this.ruleSelectedService.isRuleSelected(e.id)||(this.ruleSelectedService.clearSelectedRules(),this.ruleSelectedService.addSelectedRule(e)),n=this.ruleSelectedService.getActualSelectedRules(),b=n.some(ne=>!!ne.special),b&&(T=!n.some(ne=>ne.special&&ne.special!=ke.HOOKSCRIPT)),A=n.some(ne=>ne.special==ke.CATCHALL),N=n.some(ne=>ne.special==ke.FAIL2BAN),l=this.ruleSelectedService.getSelectedRulesLength(),o=this.ruleSelectedService.getActualClipboardRulesLength(),d=this.ruleSelectedService.getSelectedRulesGroups(),a=d.length,u=d.indexOf(-1)!=-1,h=this.checkSequentialSelectedRules(),v=this.ruleSelectedService.getActualClipboardRules(),v&&v.action==de.CUT&&v.rules&&v.rules.length&&(S=v.rules.some(ne=>ne.id==e.id)),l>1?this.fwcContextMenuService.swapMenuOptions(D,"text","textMulti"):this.fwcContextMenuService.swapMenuOptions(D,"text","textSingle"),this.fwcContextMenuService.setMenuOption(D,k.RULE_COMPILE,"visible",a==1),this.fwcContextMenuService.setMenuOption(D,k.RULE_COLOR_CHANGE,"visible",!b||T),this.fwcContextMenuService.setMenuOption(D,k.RULE_EDIT,"visible",l==1&&!T&&!N),j=a==1&&u&&l>=1,j=j&&h,this.fwcContextMenuService.setMenuOption(D,k.RULE_CREATE_GROUP,"visible",j),j=a==1&&!u,this.fwcContextMenuService.setMenuOption(D,k.RULE_REMOVE_GROUP,"visible",j);let X=this.getSelectedRuleIndex();j=a==1&&!u,j=j&&h,j=j&&(X.groupAbove!=X.firstGroup||X.groupBelow!=X.lastGroup),this.fwcContextMenuService.setMenuOption(D,k.RULE_REMOVE_FROM_GROUP,"visible",j),l==1?(this.fwcContextMenuService.setMenuOption(D,k.RULE_ENABLE,"visible",!e.active&&(!b||T)),this.fwcContextMenuService.setMenuOption(D,k.RULE_DISABLE,"visible",!!e.active&&(!b||T))):(this.fwcContextMenuService.setMenuOption(D,k.RULE_ENABLE,"visible",!0),this.fwcContextMenuService.setMenuOption(D,k.RULE_DISABLE,"visible",!b||T)),this.fwcContextMenuService.setMenuOption(D,k.RULE_DELETE,"visible",a==1&&l>1||l==1&&(!b||T)),j=X.ruleAbove!=-1&&!A,this.fwcContextMenuService.setMenuOption(D,k.RULE_MOVE_ABOVE,"visible",a==1&&j),j&&h&&a==1&&X.firstGroup!=X.groupAbove&&X.groupAbove!=-1&&X.groupAbove!=null?this.fwcContextMenuService.swapMenuOptionText(D,k.RULE_MOVE_ABOVE,"text","textGroup"):this.fwcContextMenuService.swapMenuOptionText(D,k.RULE_MOVE_ABOVE,"text","textNormal"),j=X.ruleBelow!=-1&&!X.ruleBelowCatchAll,this.fwcContextMenuService.setMenuOption(D,k.RULE_MOVE_BELOW,"visible",a==1&&j),j&&h&&a==1&&X.lastGroup!=X.groupBelow&&X.groupBelow!=-1&&X.groupBelow!=null?this.fwcContextMenuService.swapMenuOptionText(D,k.RULE_MOVE_BELOW,"text","textGroup"):this.fwcContextMenuService.swapMenuOptionText(D,k.RULE_MOVE_BELOW,"text","textNormal"),this.fwcContextMenuService.setMenuOption(D,k.COPY,"visible",a==1&&(!b||T)),this.fwcContextMenuService.setMenuOption(D,k.CUT,"visible",a==1&&(!b||T)),this.fwcContextMenuService.setMenuOption(D,k.PASTE_ABOVE,"visible",o>=1&&!S),this.fwcContextMenuService.setMenuOption(D,k.PASTE_BELOW,"visible",o>=1&&!S&&!A),this.fwcContextMenuService.setMenuOption(D,k.RULE_NEW_BELOW,"visible",!A),this.fwcContextMenuService.setMenuOption(D,k.RULE_NEW_HS_BELOW,"visible",!A);let re=Q.lockInfo.result;D.items.forEach(ne=>{ne.enabled=re}),this.fwcContextMenuService.setMenuOption(D,k.AI_ASSISTANT,"enabled",!!this.aiAssistantCheckEnabled)})}onContextMenuHandler(e,t,n){let l=ot(t);if(n.detail.item){let o=this.ruleSelectedService.getActualSelectedRules(),a=this.ruleSelectedService.getActualClipboardRules();switch(n.detail.item.id){case k.RULE_COMPILE:case k.COMPILE_IPTABLES:case k.COMPILE_NFTABLES:case k.COMPILE_VYOS:{let u;n.detail.item.id===k.COMPILE_IPTABLES?u=Mt[0].id:n.detail.item.id===k.COMPILE_NFTABLES?u=Mt[1].id:n.detail.item.id===k.COMPILE_VYOS&&(u=Mt[2].id),e instanceof Kt||e instanceof Ci||e instanceof Si?e.compileSelectedRules():e.compileSelectedRoutes(u);break}case k.SYSTEM_COMPILE:e instanceof Kt&&e.compileSelectedRules();case k.RULE_SELECT:case k.RULE_UNSELECT:this.selectRule(t);break;case k.RULE_EDIT:this.editRule(t);break;case k.RULE_ENABLE:case k.RULE_DISABLE:{let u=n.detail.item.id==k.RULE_ENABLE?1:0;e.setRuleActive(t,u);break}case k.RULE_NEW_HS_ABOVE:case k.RULE_NEW_HS_BELOW:case k.RULE_NEW_ABOVE:case k.RULE_NEW_BELOW:{let u=t.type===Ne.POLICY_ROUTING||t.type===Ne.ROUTING_TABLE||t.type===$[q.DHCP]||t.type===$[q.DHCP_FIXED_IP]||t.type===$[q.KEEPALIVED]||t.type===$[q.HAPROXY]?-1:0,d=n.detail.item.id==k.RULE_NEW_ABOVE||n.detail.item.id==k.RULE_NEW_HS_ABOVE?u:1;[$[q.DHCP],$[q.KEEPALIVED],$[q.HAPROXY]].includes(t.type)&&t.special?l.special=[k.RULE_NEW_ABOVE,k.RULE_NEW_BELOW].includes(n.detail.item.id)?ke.HOOKSCRIPT:0:l.special=n.detail.item.id==k.RULE_NEW_HS_ABOVE||n.detail.item.id==k.RULE_NEW_HS_BELOW?ke.HOOKSCRIPT:0,e.newPolicyRule(l,d);break}case k.RULE_DELETE:{this.deleteSelectedRules(e,t,o,n.detail.item.id);break}case k.COPY:this.ruleSelectedService.copyRulesToClipboard();break;case k.CUT:this.ruleSelectedService.cutRulesToClipboard();break;case k.PASTE_ABOVE:case k.PASTE_BELOW:{this.pasteSelectedRules(e,t,a,n.detail.item.id);break}case k.RULE_MOVE_ABOVE:case k.RULE_MOVE_BELOW:{let u;u=this.newRulesData(t,o,n.detail.item.id,de.CUT),e.moveSelectedRules(t,u);break}case k.RULE_CREATE_GROUP:{let u=e.newRuleGroupApiCall(),d={header:this.translate.instant("RULE.GROUP_TEXT_HEADER"),helpText:this.translate.instant("RULE.GROUP_TEXT"),formControls:[{name:"groupName",label:this.translate.instant("POLICY_GRID.GR_NAME.NAME"),type:"text",required:!0}],onAccept:h=>u(t.firewall,this.fwcUserService.getActualFwSelectedCloud(),h)};e instanceof Ii&&(d.formControls.push({name:"separator",type:"separator"}),d.formControls.push({name:"groupComment",label:this.translate.instant("ITEM_PANEL.FIELDS.COMMENTS"),type:"text"})),e instanceof Kt&&(d.formControls.push({name:"separator",type:"separator"}),d.formControls.push({name:"groupComment",label:this.translate.instant("ITEM_PANEL.FIELDS.COMMENTS"),type:"text"})),e instanceof Si&&(d.formControls.push({name:"separator",type:"separator"}),d.formControls.push({name:"groupComment",label:this.translate.instant("ITEM_PANEL.FIELDS.COMMENTS"),type:"text"})),e instanceof Ci&&(d.formControls.push({name:"separator",type:"separator"}),d.formControls.push({name:"groupComment",label:this.translate.instant("ITEM_PANEL.FIELDS.COMMENTS"),type:"text"})),this.inputDataService.setInputData(d);break}case k.RULE_REMOVE_GROUP:t.idgroup&&this.confirmationService.confirm({header:this.translate.instant("GLOBALS.MSG_CONFIRM"),icon:"fa fa-question-circle fwcBlue iconBig",message:this.translate.instant("POLICY_GRID.GR_DELETE",{name:t.group_name}),rejectVisible:!0,rejectLabel:"No",acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.YES"),accept:()=>{e.deleteRuleGroupApiCall(t.idgroup).then(u=>{this.store.dispatch(Ce.reloadDialog({dialogUuids:[Z.ITEM_PANEL]}));let d=[];d.push(t),this.policyReload(d)}).catch(u=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(u)})})}});break;case k.RULE_REMOVE_FROM_GROUP:{let u;u=this.newRulesData(t,o,n.detail.item.id,de.DELETE),e.removeRulesFromGroupApiCall(u).then(d=>{this.store.dispatch(Ce.reloadDialog({dialogUuids:[Z.ITEM_PANEL]}));let h=[];h.push(t),this.policyReload(h)}).catch(d=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(d)})});break}case k.RULE_COLOR_CHANGE:{let u=this.translate.instant(e.translationKeys.ENTITY_COLOR),d=e.setRuleStyleApiCall(),h={header:this.translate.instant("RULE.COLOR_HEADER"),helpText:u,formControls:[{name:"ruleColor",placeholder:this.translate.instant("RULE.COLOR_PLACEHOLDER"),type:"colorpicker",value:t.style}],onAccept:S=>d(t,S)};e instanceof Ii&&h.formControls.push({name:"routingTableId",type:"hidden",value:e.getRoutingTableId()}),e instanceof Kt&&h.formControls.push({name:"dhcpGroupId",type:"hidden",value:e.getDhcpGroupId()}),e instanceof Si&&h.formControls.push({name:"keepalivedGroupId",type:"hidden",value:e.getKeepalivedGroupId()}),e instanceof Ci&&h.formControls.push({name:"haproxyGroupId",type:"hidden",value:e.getHAProxyGroupId()}),this.inputDataService.setInputData(h);break}case k.AI_ASSISTANT:{let u=this.utilService.createDynamicComponentRef(Jl),d=u.instance;d.setDynamicComponentRef(u);let h;h={fwcloud:this.fwcUserService.getActualFwSelectedCloud(),firewall:t.firewall,type:t.type};let S=this.ruleSelectedService.getRulesOrderedIds(o,!0);if(!S)return;h.rulesIds=S.rulesIds,d.showAIDialog({fwcloud:h.fwcloud,firewallId:h.firewall,rulesIds:h.rulesIds});break}case k.NO_MENU:break}}}checkSequentialSelectedRules(){let e=!1,t,n;if(t=this.fwcPolicyService.getActualPolicySequential(),n=this.ruleSelectedService.getActualSelectedRules(),n.length){n.sort(function(l,o){return l.rule_order>o.rule_order?1:l.rule_order<o.rule_order?-1:0});for(let l=0;l<t.length;l++)if(t[l].id==n[0].id){e=!0;for(let o=1;o<n.length&&l+o<t.length;o++)if(t[l+o].id!=n[o].id){e=!1;break}break}}return e}getSelectedRuleIndex(){let e,t,n,l,o,a,u,d;if(t=this.fwcPolicyService.getActualPolicySequential(),n=this.ruleSelectedService.getActualSelectedRules(),n.length){n.sort(function(v,b){return v.rule_order>b.rule_order?1:v.rule_order<b.rule_order?-1:0});let h=n[0],S=n[n.length-1];l=o=a=u=-1;for(let v=0;v<t.length;v++){let b=t[v];if(b.id==h.id)break;l=b.id,a=b.idgroup}for(let v=t.length-1;v>=0;v--){let b=t[v];if(b.id==S.id)break;d=b.special==ke.CATCHALL,o=b.id,u=b.idgroup}e={firstRule:h.id,firstGroup:h.idgroup,lastRule:S.id,lastGroup:S.idgroup,ruleBelow:o,ruleBelowCatchAll:d,groupBelow:u,ruleAbove:l,groupAbove:a}}return e}detectChanges(){this.cd.destroyed||(this.cd.markForCheck(),this.cd.detectChanges())}createNewRule(e,t){this.utilService.fwcAPICall(this.fwcPolicyService.newPolicyRule.bind(this.fwcPolicyService),e).then(n=>{t&&this.updateFirewallStatus(t),this.policyReload(),this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("RULE.CREATED")})}).catch(n=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(n)})})}moveSelectedRules(e,t){let n=this.ruleSelectedService.getActualSelectedRules();this.store.dispatch(lt.requestBlockUI()),this.utilService.fwcAPICall(this.fwcPolicyService.managePolicyRules.bind(this.fwcPolicyService),t,de.CUT).then(()=>{this.updateFirewallStatus(e),this.policyReload(n)}).catch(l=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(l)})}).finally(()=>{this.store.dispatch(lt.requestUnblockUI())})}deleteSelectedRules(e,t,n,l){let o;o=this.newRulesData(t,n,l,de.DELETE,!0);let a=o&&o.rulesIds.length;if(a){let u=a+" "+this.translate.instant(e.translationKeys.ENTITY_NAME)+(a>1?"s ":""),d=this.translate.instant(e.translationKeys.ENTITY_DELETE,{text:u}),h=this.translate.instant(e.translationKeys.DELETE_SUCCESS);this.confirmationService.confirm({header:this.translate.instant("GLOBALS.MSG_CONFIRM"),icon:"fa fa-question-circle fwcBlue iconBig",message:d,rejectVisible:!0,rejectLabel:"No",acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.YES"),accept:()=>{e.deletePolicyRuleApiCall(o.rulesIds).then(S=>{this.store.dispatch(Ce.reloadDialog({dialogUuids:[Z.ITEM_PANEL,Z.CLUSTER_PANEL,Z.FIREWALL_PANEL,Z.OVCONFIG_PANEL,Z.WIREGUARD_CONFIG_PANEL,Z.IPSEC_CONFIG_PANEL]})),this.updateFirewallStatus(t),this.policyReload(),this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:h})}).catch(S=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(S)}),this.detectChanges()})}})}}pasteSelectedRules(e,t,n,l){let o=!1;if(n&&n.action==de.CUT&&n.rules&&n.rules.length&&(o=n.rules.some(a=>{if(a.id==t.id)return!0})),n&&n.rules&&n.rules.length&&!o){let a;a=this.newRulesData(t,n.rules,l,n.action),this.store.dispatch(lt.requestBlockUI()),e.manageSelectedRules(a,n.action).then(u=>{this.store.dispatch(lt.requestUnblockUI()),this.store.dispatch(Ce.reloadDialog({dialogUuids:[Z.ITEM_PANEL,Z.OVCONFIG_PANEL,Z.WIREGUARD_CONFIG_PANEL,Z.IPSEC_CONFIG_PANEL]})),this.updateFirewallStatus(t),this.policyReload(n.rules),this.ruleSelectedService.clearClipboardRules()}).catch(u=>{this.store.dispatch(lt.requestUnblockUI()),this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(u)})})}}newRulesData(e,t,n,l,o){let a={};a.action=l,a.fwcloud=this.fwcUserService.getActualFwcUser().selectedFwCloud,a.firewall=e.firewall,n==k.PASTE_ABOVE||n==k.RULE_MOVE_ABOVE?a.pasteOffset=-1:a.pasteOffset=1,a.pasteOnRuleOrder=e.rule_order+a.pasteOffset;let u=this.ruleSelectedService.getRulesOrderedIds(t,o),d=u.rulesIds,h=u.orderedRules;if(a.idgroup=e.idgroup,n==k.PASTE_ABOVE||n==k.PASTE_BELOW)a.pasteOnRuleId=e.id;else{let S,v,b,T,A;if(n==k.RULE_MOVE_ABOVE?S=0:S=h.length-1,v=h[S].id,T=this.fwcPolicyService.getActualPolicySequential(),Array.isArray(T)||(T=[]),A=T.findIndex(N=>N.id==v),A!=-1){let N=A+a.pasteOffset;(N<0||N>=T.length)&&(N=A),b=T[N].id,T[N].idgroup!==T[A].idgroup&&(a.pasteOffset=0)}else b=v;a.pasteOnRuleId=b}if(a.rulesIds=d,a.rulesIds){let S=this.fwcPolicyService.getActualPolicy();S&&(a.rulesOrder=[],a.rulesIds.forEach(v=>{let b=S.findIndex(T=>T.id==v);a.rulesOrder.push(b+1)}))}return a}getFirewallCompiler(e){return new Promise((t,n)=>{this.utilService.fwcAPICall(this.fwcFirewallService.getFirewall.bind(this.fwcFirewallService),e,this.fwcUserService.getActualFwSelectedCloud()).then(l=>{let u=(l.data.options&61440)>>12;t(u)}).catch(l=>{n(l)})})}compileSelectedRules(e){return le(this,null,function*(){let t,n,l,o,a,u=this.ruleSelectedService.getActualSelectedRules(),d=this.ruleSelectedService.getRulesOrderedIds(u),h;if(Array.isArray(d.orderedRules)&&d.orderedRules[0]){if(h=d.orderedRules[0],t=this.fwcUserService.getActualFwcUser().customer_id,n=this.fwcUserService.getActualFwcUser().selectedFwCloud,l=h.firewall,o=h.type,a=d.rulesIds,e===void 0)try{e=yield this.getFirewallCompiler(l)}catch(b){this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(b)}),this.ruleSelectedService.setRuleStatus(null);return}let S=Mt.find(b=>b.id===e),v;if(S&&(v=S.name),!t||!n||!l||!o||!Array.isArray(a)||!a.length||!v)return;this.ruleSelectedService.setRuleStatus(""),this.detectChanges(),this.utilService.fwcAPICall(this.fwcPolicyService.getPolicyRulesCompilation.bind(this.fwcPolicyService),l,o,a,this.fwcUserService.getActualFwSelectedCloud(),v).then(b=>{if(Array.isArray(b.data)){let T=this.utilService.createDynamicComponentRef(qt),A=T.instance;A.setDynamicComponentRef(T);let N=this.translate.instant("RULE.RULE");A.showCompilationData(b.data,u,N,void 0,v);let j=b.data.filter(D=>D.dangerousRuleData);if(j.length){let D=this.buildSubsetDangerousRuleDialogOptions(A),Q=(X,re)=>{this.fwcDangerousRuleFunctionalityService.showDangerousRules(j,X,l,re,D)?this.subsetDangerousRulesContext={firewallId:l,firewallName:X,firewallType:re,ruleType:o,ruleIds:[...a],compilerName:v,selectedRules:ot(u)||[],ruleLabel:N,componentRef:T}:this.subsetDangerousRulesContext=void 0};this.utilService.fwcAPICall(this.fwcFirewallService.getFirewall.bind(this.fwcFirewallService),l,this.fwcUserService.getActualFwSelectedCloud()).then(X=>{let re=X?.data?.name&&X.data.name.trim()?X.data.name:String(l),ne=X?.data?.cluster?"cluster":"firewall";Q(re,ne)}).catch(()=>{Q(String(l),"firewall")})}else this.subsetDangerousRulesContext=void 0}}).catch(b=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(b)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}})}buildSubsetDangerousRuleDialogOptions(e){return{actionMode:"subset",onDialogClose:t=>{t==="minimize"&&e.minimizeDialog()},onRequestRecompile:t=>{this.handleSubsetDangerousRulesRecompile(t)}}}handleSubsetDangerousRulesRecompile(e){if(!this.subsetDangerousRulesContext||this.subsetDangerousRulesRecompileInProgress)return;this.subsetDangerousRulesRecompileInProgress=!0,e?.firewallName&&(this.subsetDangerousRulesContext.firewallName=e.firewallName),e?.firewallType&&(this.subsetDangerousRulesContext.firewallType=e.firewallType),this.closeSubsetCompilationDialog(),this.ruleSelectedService.setRuleStatus(""),this.detectChanges();let t=this.subsetDangerousRulesContext,{firewallId:n,ruleType:l,ruleIds:o,compilerName:a,selectedRules:u,ruleLabel:d}=t,h=this.fwcUserService.getActualFwSelectedCloud();this.utilService.fwcAPICall(this.fwcPolicyService.getPolicyRulesCompilation.bind(this.fwcPolicyService),n,l,o,h,a).then(S=>{if(this.subsetDangerousRulesRecompileInProgress=!1,this.ruleSelectedService.setRuleStatus(null),this.detectChanges(),!Array.isArray(S.data))return;let v=this.utilService.createDynamicComponentRef(qt);if(!v)return;let b=v.instance;b.setDynamicComponentRef(v),b.showCompilationData(S.data,u||[],d,void 0,a),t.componentRef=v;let T=S.data.filter(Q=>Q.dangerousRuleData),A=t.firewallName&&t.firewallName.trim()?t.firewallName:String(n),N=t.firewallType||"firewall",j=this.buildSubsetDangerousRuleDialogOptions(b);this.fwcDangerousRuleFunctionalityService.showDangerousRules(T,A,n,N,j)||(this.subsetDangerousRulesContext=void 0)}).catch(S=>{this.subsetDangerousRulesRecompileInProgress=!1,this.ruleSelectedService.setRuleStatus(null),this.detectChanges(),this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(S)})})}closeSubsetCompilationDialog(){let e=this.subsetDangerousRulesContext?.componentRef;e&&!e.hostView.destroyed&&e.instance.hideDialog(),this.subsetDangerousRulesContext&&(this.subsetDangerousRulesContext.componentRef=void 0)}setRulesProperty(e,t,n){let l,o=!1,a;if(a={fwcloud:this.fwcUserService.getActualFwSelectedCloud(),firewall:e.firewall,type:e.type},t=="active")l=this.fwcPolicyService.updatePolicyRulesActive.bind(this.fwcPolicyService),o=!0,a.active=n;else if(t=="style")l=this.fwcPolicyService.updatePolicyRulesStyle.bind(this.fwcPolicyService),o=!0,a.style=n;else return;let u=this.ruleSelectedService.getActualSelectedRules();if(!u)return;let d=this.ruleSelectedService.getRulesOrderedIds(u,!0);d&&(a.rulesIds=d.rulesIds,this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(l,a).then(h=>{o&&this.updateFirewallStatus(e);for(let S=0;S<u.length;S++){let v=u[S];(!v.special||v.special===ke.HOOKSCRIPT)&&(v[t]=n,v=ot(v))}this.ruleSelectedService.setRuleStatus(null),this.cd.detectChanges()}).catch(h=>{this.ruleSelectedService.setRuleStatus(null),this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(h)}),this.cd.detectChanges()}))}newRuleGroup(e,t,n){let l=this.ruleSelectedService.getActualSelectedRules(),o=n?n.groupName:null;if(!(o==null||o=="")){let a={fwcloud:t,firewall:e,name:o,comment:"",rulesIds:[]},u=[],d=l.slice(0);d.sort(function(h,S){return h.rule_order>S.rule_order?1:h.rule_order<S.rule_order?-1:0});for(let h=0;h<d.length;h++)u.push(d[h].id);a.rulesIds=u,this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcPolicyService.newPolicyRulesGroup.bind(this.fwcPolicyService),a).then(h=>{this.store.dispatch(Ce.reloadDialog({dialogUuids:[Z.ITEM_PANEL]})),this.policyReload(d)}).catch(h=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(h)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null)})}}onSetRuleCustomColor(e,t){t&&this.setRulesProperty(e,"style",t.ruleColor)}updateFirewallStatus(e){this.store.dispatch(rt.updateFwStatus({item:{cluster:e._fwcClusterId,id:e.firewall,status:3}}))}policyReload(e){let t=this.fwcPolicyService.getActualSelectedPolicy(),n=Object.assign({},t);n._forcePolicyReload=!0,e&&(n._selectedRules=e.slice()),this.fwcPolicyService.setSelectedPolicy(n),this.detectChanges()}updateRule(e){let t=!1,n=!1,l=!1,o=!1,a=!1,u=!1,d=!1,h;return new Promise((v,b)=>{e.formModel||b(!1);let T=e.formModel.action,A=e.action,N=e.formModel.comment,j=e.comment,D=e.formModel.fw_apply_to,Q=e.fw_apply_to,X=e.formModel.mark,re=e.mark,ne=e.formModel.run_before,ae=e.run_before;h={rule:e.id,idgroup:e.idgroup,firewall:e.firewall,rule_order:e.rule_order,options:e.options,action:e.action,fw_apply_to:e.fw_apply_to,time_start:e.time_start,time_end:e.time_end,comment:e.comment,active:e.active,style:e.style,type:e.type,fwcloud:this.fwcUserService.getActualFwSelectedCloud(),mark:e.mark,run_before:e.run_before},T!=A&&(h.action=T,t=!0),N!=j&&(h.comment=N,l=!0),D!=Q&&(h.fw_apply_to=D,n=!0),X!=re&&(h.mark=X,u=!0),ne!=ae&&(h.run_before=ne,d=!0),t||l||n||o||a||u||d?(this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcPolicyService.updatePolicyRule.bind(this.fwcPolicyService),h).then(ze=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("RULE.UPDATED")}),t&&(e.action=T),n&&(e.fw_apply_to=D),u&&(e.mark=X),d&&(e.run_before=ne),l&&(e.comment=N),(t||l||n||o||u||d)&&this.updateFirewallStatus(e),v(ze),this.ruleSelectedService.setRuleStatus(null),this.detectChanges()}).catch(ze=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(ze)}),t&&(e.formModel.action=e.action),n&&(e.formModel.fw_apply_to=e.fw_apply_to),l&&(e.formModel.comment=j),d&&(e.formModel.run_before=ae),v(!1),this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})):v(!0)})}onActionDragEnter(e,t,n){let l=this.itemSelectedService.getDragItem();l&&l._fwcObjType==I.OBJ_MARK&&(this.renderer.addClass(n,"tdActionCell-hovered"),e.labelDraggedOverAction=!0)}onActionDragLeave(e,t,n){t.target==n&&(this.renderer.removeClass(n,"tdActionCell-hovered"),e.labelDraggedOverAction=!1)}onActionDragOver(e){e.preventDefault()}onActionDragDrop(e,t,n){let l=this.itemSelectedService.getDragItem();this.itemSelectedService.clearDragItem(),t.preventDefault();let o=()=>{this.renderer.removeClass(n,"tdActionCell-hovered"),e.labelDraggedOverAction=!1,this.ruleSelectedService.setRuleStatus(null),this.detectChanges()};new Promise((u,d)=>{let h=l&&l._fwcObjType==I.OBJ_MARK&&l.id_obj?l.id_obj:void 0;h&&(h!==e.mark||!e.mark)?(this.ruleSelectedService.setRuleStatus(""),e.formModel.mark=h,this.updateRule(e).then(S=>{e.mark_name=l.text,e.mark=h,u(S)}).catch(S=>d(S))):d(!1)}).then(u=>{o()}).catch(u=>{o()})}onDeleteRuleMark(e){e.mark&&(this.ruleSelectedService.setRuleStatus(""),e.formModel.mark=0,this.updateRule(e).then(t=>{this.ruleSelectedService.setRuleStatus(null),this.store.dispatch(Ce.reloadDialog({dialogUuids:[Z.ITEM_PANEL]})),this.detectChanges()}).catch(t=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()}))}showMarkInfo(e,t){if(t&&t.preventDefault(),this.itemSelectedService.setObjectInfo(void 0,t),!this.infoTooltipTimer&&!this.infoTooltipShown){let n={objId:e.mark,objType:I.OBJ_MARK,fwId:e.firewall};this.infoTooltipTimer=setTimeout(()=>{this.infoTooltipShown=!0,this.itemSelectedService.setObjectInfo(n,t)},1e3)}}clearMarkInfo(e){e&&e.preventDefault(),this.infoTooltipTimer&&(clearTimeout(this.infoTooltipTimer),this.infoTooltipTimer=void 0),this.infoTooltipShown&&(this.itemSelectedService.setObjectInfo(void 0,e),this.infoTooltipShown=!1)}onCommentFocus(e){e.commentEdit=!0}onCommentBlur(e,t){t.commentEdit=!1,e.setRuleComment(t)}onLeaseTimeFocus(e){e.leaseTimeEdit=!0}onLeaseTimeBlur(e,t){t.leaseTimeEdit=!1,e.setRuleLeaseTime(t)}onScriptFocus(e,t){let n=this.utilService.createDynamicComponentRef(Ll),l=n.instance;l.setDynamicComponentRef(n),l.show(e,t)}onSetGroupCustomColor(e){if(e){let t=e.groupData,n=e.group;t.style=e.groupColor,t.groupIds=[t.id],this.updateGroup(n,t,!0)}}onSetGroupName(e){if(e){let t=e.group,n=e.groupData,l=""+e.groupName;t&&n&&l.length&&(n.name=l,this.updateGroup(t,n,!1))}}updateGroup(e,t,n){this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcPolicyService.updatePolicyRulesGroupStyleOrName.bind(this.fwcPolicyService),t,n).then(()=>{if(n){e.group_style=t.style;let l=e.rules;for(let o=0;o<l.length;o++)l[o].group_style=e.group_style}else{e.group_name=t.name;let l=e.rules;for(let o=0;o<l.length;o++)l[o].group_name=e.group_name}e=ot(e)}).catch(l=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(l)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}handleChangeApplyTo(e,t){"setRuleApplyTo"in e&&typeof e.setRuleApplyTo=="function"&&e.setRuleApplyTo(t)}};s.\u0275fac=function(t){return new(t||s)(G(Wi),G(be),G(ye),G(fe),G(ge),G(He),G(Ue),G(xt),G(me),G(gi),G(Ri),G(we),G(Ee),G(Le),G(ue),G(Se),G(qo),G(Qo),G(Nn))},s.\u0275prov=De({token:s,factory:s.\u0275fac});let r=s;return r})();var nr=new Map([["OpenVPN",1],["GeoIP",2],["CrowdSec",4],["NtopNG",8],["Suricata",16],["Keepalived",32],["Zeek",64],["Elasticsearch",128],["Filebeat",256],["WebSafety",512],["Kibana",1024],["Logstash",2048],["DnsSafety",4096],["iscbind9",8192],["iscdhcp",16384]]),Un=(()=>{let s=class s{constructor(e,t,n,l,o,a,u,d,h,S,v,b,T,A,N){this.fwcContextMenuService=e,this.fwcErrorPipe=t,this.changeDetectorRef=n,this.fwcUserService=l,this.fwcPolicyService=o,this.itemSelectedService=a,this.confirmationService=u,this.utilService=d,this.ruleSelectedService=h,this.fwcPolicyGridRoutingTableFunctionalityService=S,this.store=v,this.renderer=b,this.messageService=T,this.fwcFirewallService=A,this.translate=N,this.alive=!0,this.dragLevelMap=new WeakMap,this.onDragEnd=()=>{this.resetVisibleRulePositions()},this.positionContextMenu=this.fwcContextMenuService.getPositionMenus(),typeof window<"u"&&(this.globalDragEndHandler=()=>{this.cleanupDragPreview(),this.clearHoverState()},window.addEventListener("dragend",this.globalDragEndHandler,!0)),typeof navigator<"u"&&/firefox/i.test(navigator.userAgent)&&window.addEventListener("dragend",this.onDragEnd)}ngOnDestroy(){this.alive=!1,typeof this.onDragEnd=="function"&&window.removeEventListener("dragend",this.onDragEnd),typeof window<"u"&&this.globalDragEndHandler&&window.removeEventListener("dragend",this.globalDragEndHandler,!0),this.clearHoverState()}onContextMenuHandler(e,t,n,l,o,a,u,d){this.onItemRightClickEvent(a,t);let h=a.selectedItem;if(h&&(h.rightclicked=!1,this.detectChanges()),d.detail.item){switch(d.detail.item.id){case k.POSITION_NEGATE:case k.POSITION_ALLOW:if(a.ipobjs.length>1){let v=d.detail.item.id==k.POSITION_NEGATE,b={fwcloud:this.fwcUserService.getActualFwSelectedCloud(),firewall:n,rule:o,position:a.id};this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcPolicyService.negatePolicyObject.bind(this.fwcPolicyService),b,v).then(T=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("POSITION.POS_UPDATED")}),this.updateFirewallStatus(n,l),a.negate=v}).catch(T=>{this.ruleSelectedService.setRuleStatus(null),this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(T)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.removeRightClickedClass(),this.detectChanges()})}break;case k.PASTE:let S=this.itemSelectedService.getActualClipboardItem();if(S&&u.indexOf(+S._fwcObjType)!=-1){let v=S._fwcRuleId,b=S._fwcPositionId,T=S.action;if(v!=o||b!=a.id){let A;A=this.checkOperation(n,a,u,S),A?this.confirmationService.confirm({header:"Error",icon:"fa fa-exclamation-circle fwcRed iconBig",message:A,rejectVisible:!1,acceptLabel:"Ok",accept:()=>{}}):e.manageObject(o,a,S,T),h&&(h.id===S.id&&this.removeRightClickedClass(),S&&this.removeRightClickedClass()),this.detectChanges()}}break}if(h)switch(d.detail.item.id){case k.OBJECT_EDIT:h._fwcObjId!=I.OBJ_ANY&&(h._fwcObjType===I.OBJ_OPENVPN_PREFIX||h._fwcObjType===I.OBJ_WIREGUARD_PREFIX||h._fwcObjType===I.OBJ_IPSEC_PREFIX?(h.editPrefixAction=!0,this.itemSelectedService.setPrefixItem(h)):this.itemSelectedService.setItem(h));break;case k.COPY:if(h._fwcObjId!=I.OBJ_ANY){let v=Object.assign({},h);this.itemSelectedService.setClipboardItem(v,de.COPY)}this.detectChanges();break;case k.CUT:h._fwcObjId!=I.OBJ_ANY&&this.itemSelectedService.setClipboardItem(h,de.CUT),this.detectChanges();break;case k.DELETE:this.confirmationService.confirm({header:this.translate.instant("GLOBALS.MSG_CONFIRM"),icon:"fa fa-question-circle fwcBlue iconBig",message:this.translate.instant("POSITION.DEL_OBJ",{name:h._fwcObjName}),rejectVisible:!0,rejectLabel:"No",acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.YES"),accept:()=>{e.deleteObject(a,h)}});break;case k.WHERE_USED:let S=Object.assign({},h);S._fwcUserId=this.fwcUserService.getActualFwcUser().user_id,S._fwcCloud=this.fwcUserService.getActualFwcUser().selectedFwCloud,S.whereUsedAction=!0,this.itemSelectedService.setItem(S);break}}this.onContextMenuClose(a),this.detectChanges()}deleteObjectFromPosition(e,t,n,l,o){let a,u={fwcloud:this.fwcUserService.getActualFwSelectedCloud(),firewall:e,rule:n,ipobj:-1,ipobj_g:-1,interface:-1,position:l.id,position_order:void 0},d=0;for(let h=0;h<l.ipobjs.length&&!(l.ipobjs[h]._fwcObjId==o._fwcObjId&&l.ipobjs[h]._fwcObjType==o._fwcObjType);h++)l.ipobjs[h]._fwcObjId!=I.OBJ_ANY&&d++;switch(u.position_order=d+1,l.content){case"I":u.interface=o._fwcObjId,a=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_INTERFACE_FIREWALL"),delete u.ipobj,delete u.ipobj_g;break;case"O":default:o._fwcObjType==I.OBJ_OPENVPN_CONFIG_CLI?(u.openvpn=o._fwcObjId,a=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_OPENVPN_CONFIG")):o._fwcObjType==I.OBJ_OPENVPN_PREFIX&&(u.prefix=o._fwcObjId,a=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_PREFIX")),o._fwcObjType==I.OBJ_WGC_CONFIG_CLI?(u.wireguard=o._fwcObjId,a=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_WG_CONFIG")):o._fwcObjType==I.OBJ_WIREGUARD_PREFIX&&(u.prefix=o._fwcObjId,a=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_PREFIX")),o._fwcObjType==I.OBJ_ISC_CONFIG_CLI?(u.ipsec=o._fwcObjId,a=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_IPSEC_CONFIG")):o._fwcObjType==I.OBJ_IPSEC_PREFIX&&(u.prefix=o._fwcObjId,a=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_PREFIX")),o._fwcObjType==I.OBJ_INTERFACE_FIREWALL||o._fwcObjType==I.OBJ_INTERFACE_HOST?(u.interface=o._fwcObjId,a=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_INTERFACE_FIREWALL")):o._fwcObjType==I.OBJ_GROUP||o._fwcObjType==I.OBJ_SERVICE_GROUP||o._fwcObjType==I.OBJ_CONTINENT?(u.ipobj_g=o._fwcObjId,a=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_GROUP")):(u.ipobj=o._fwcObjId,a=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_GEN_IP_OBJECT")),(o._fwcObjType==I.OBJ_OPENVPN_CONFIG_CLI||o._fwcObjType==I.OBJ_OPENVPN_PREFIX||o._fwcObjType==I.OBJ_WGC_CONFIG_CLI||o._fwcObjType==I.OBJ_WIREGUARD_PREFIX||o._fwcObjType==I.OBJ_ISC_CONFIG_CLI||o._fwcObjType==I.OBJ_IPSEC_PREFIX)&&(delete u.ipobj,delete u.ipobj_g,delete u.interface);break}this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcPolicyService.deletePolicyObject.bind(this.fwcPolicyService),u,l.content,o._fwcObjType).then(h=>{this.removeItem(l,o),this.updateFirewallStatus(e,t);let S=this.itemSelectedService.getActualClipboardItem();S&&S._fwcObjId===o.id&&S._fwcPositionId===o._fwcPositionId&&this.itemSelectedService.clearClipboardItem(),this.store.dispatch(Ce.reloadDialog({dialogUuids:[Z.ITEM_PANEL,Z.CLUSTER_PANEL,Z.FIREWALL_PANEL,Z.OVCONFIG_PANEL,Z.WIREGUARD_CONFIG_PANEL,Z.IPSEC_CONFIG_PANEL]})),this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:a+this.translate.instant("POSITION.OBJ_DELETED")})}).catch(h=>{let S=this.fwcErrorPipe.transform(h);this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(h)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}onContextMenuLoad(e,t,n,l,o){let a=!1,u=!1,d,h,S,v=!1,b,T;this.clearObjectInfo(void 0);let A=this.positionContextMenu.POSITION,N=this.fwcUserService.getActualFwcUser(),j=this.itemSelectedService.getActualClipboardItem(),Q=o.detail?.event?.target?.closest(".divFwcPosition-item");if(!!Q?.getAttribute("data-obj_id")||(a=!0,n.selectedItem=void 0),document.querySelectorAll(".divFwcPosition-item").forEach(ne=>ne.classList.remove("item-rightclicked")),Q&&Q.getAttribute("data-obj_id")&&Q.classList.add("item-rightclicked"),this.listenForOutsideClicks(n),S=n.id==14||n.id==16||n.id==34||n.id==35,(n.selectedItem&&n.selectedItem._fwcObjType==I.OBJ_ANY||n.ipobjs.length<=1||a)&&(u=!0),h=j&&j._fwcRuleId==t&&j._fwcPositionId==n.id,d=j&&l.indexOf(+j._fwcObjType)!=-1,b=e===Ne.POLICY_ROUTING||e===Ne.ROUTING_TABLE,T=[$[q.DHCP_FIXED_IP],$[q.DHCP],$[q.KEEPALIVED],$[q.HAPROXY]].includes(e),A&&A.items){for(let ne=0;ne<A.items.length;ne++){let ae=A.items[ne];ae.id==k.POSITION_NEGATE&&(ae.visible=!S&&!T&&!b&&!n.negate&&n.ipobjs.length>1),ae.id==k.POSITION_ALLOW&&(ae.visible=!!(!S&&n.negate&&n.ipobjs.length>1)),(ae.id==k.OBJECT_EDIT||ae.id==k.COPY||ae.id==k.CUT||ae.id==k.DELETE||ae.id==k.WHERE_USED||ae.id==k.SEPARATOR)&&(ae.visible=n.id===We.MASTER_NODE&&ae.id===k.WHERE_USED?!1:!u),ae.id==k.PASTE&&(ae.visible=!!(j&&d&&!h)),(ae.id==k.DELETE||ae.id==k.CUT)&&(ae.visible=n.id!==vi.GATEWAY_POSITION&&(n.id!==ji.FROM_POSITION||n.ipobjs.length>2)?!u:!1),ae.visible&&(v=!0)}N.lockInfo.result||A.items.forEach(ne=>{ne.enabled=ne.id===k.WHERE_USED}),!j&&u&&n.ipobjs.length<=1||!v?o.detail.cancel=!0:n.selectedItem&&(n.selectedItem.rightclicked=!0)}n.selectedItem&&n.selectedItem.rightclicked&&(n.selectedItem.rightclicked=!1),this.detectChanges()}onContextMenuClose(e){e.selectedItem&&(e.selectedItem.rightclicked=!1),this.detectChanges()}listenForOutsideClicks(e){let t=n=>{let l=document.querySelector(".iui-contextmenu"),o=l&&l.contains(n.target),a=n.target.closest(".divFwcPosition-item");!o&&!a&&(this.removeRightClickedClass(),document.removeEventListener("click",t))};document.addEventListener("click",t)}removeRightClickedClass(){document.querySelectorAll(".divFwcPosition-item").forEach(t=>{t.classList.remove("item-rightclicked")})}onListDragOver(e){e.preventDefault()}onListDragEnter(e,t,n,l,o){let a,u=l.currentTarget;if(!(!!u&&u===o||l.target&&o.contains(l.target)))return;let h=(this.dragLevelMap.get(o)||0)+1;if(this.dragLevelMap.set(o,h),this.clearHoverState(o),t.draggedOver||(t.draggedOver=!0,this.detectChanges()),a=this.itemSelectedService.getDragItem(),a.srcPositionUID!=t.positionUID&&a){let S={draggedItem:a,firewallId:e,fwcPosition:t,fwcPositionEl:o,typesPositions:n};this.doListDragEnter(S),this.hoveredPosition={pos:t,el:o}}}doListDragEnter(e){let{firewallId:t,draggedItem:n,typesPositions:l,fwcPosition:o,fwcPositionEl:a}=e,u=+n._fwcObjType;if(!l){o.objectAllowed=!1;return}l.indexOf(u)==-1||o.ipobjs&&o.ipobjs.some(function(d){return n._fwcObjId==d._fwcObjId&&n._fwcObjType==d._fwcObjType})||o.content=="I"&&u==I.OBJ_INTERFACE_FIREWALL&&n._fwcFwId!=t?o.objectAllowed=!1:o.objectAllowed=!0,this.detectChanges()}onListDragLeave(e,t,n){let l=e.currentTarget;if(!(!!l&&l===n||e.target&&n.contains(e.target)))return;let a=(this.dragLevelMap.get(n)||0)-1;a<=0?(this.dragLevelMap.delete(n),this.hoveredPosition&&this.hoveredPosition.el===n?this.clearHoverState():(t.draggedOver=!1,t.objectAllowed=void 0,this.detectChanges())):this.dragLevelMap.set(n,a)}onListDragDrop(e,t,n,l,o,a){let u,d,h=e.getFirewallId(),S=e.getClusterId();if(o.preventDefault(),n.draggedOver=!1,n.objectAllowed=void 0,this.dragLevelMap.delete(a),this.hoveredPosition&&this.hoveredPosition.el===a&&(this.hoveredPosition=void 0),d=this.itemSelectedService.getDragItem(),d&&(d._fwcPositionId!=n.id||d._fwcRuleId!=t))if(u=this.checkOperation(h,n,l,d),u)this.confirmationService.confirm({header:this.translate.instant("POSITION.ERROR_HEADER"),icon:"fa fa-exclamation-circle fwcRed iconBig",message:u,rejectVisible:!1,acceptLabel:"Ok",accept:()=>{}});else if(S&&(d.obj_type==24||d.obj_type==23))this.fwcFirewallService.getCluster.bind(this.fwcFirewallService)(S,this.fwcUserService.getActualFwSelectedCloud()).subscribe(b=>{let T=b.data;if(T.nodes.find(A=>A.install_communication=="agent")&&!(T.plugins&nr.get("GeoIP")))this.confirmationService.confirm({header:this.translate.instant("FW.PLUGINS.GEOIP_NOT_ACTIVATED_HEADER"),icon:"fa fa-exclamation-triangle fwcOrange iconBig",message:this.translate.instant("FW.PLUGINS.GEOIP_NOT_ACTIVATED_CLUSTER",{cluster:T.name}),rejectVisible:!0,acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.YES"),rejectLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.NO"),reject:()=>{},accept:()=>{if(d.container&&(d.container=void 0,d.containerReadOnly=!1,d._fwcObjType===I.OBJ_ADDRESS)){let A=/^(.+)\s+\((.+)\)$/.exec(d.text);A&&(d._fwcObjName=A[1])}e.manageObject(t,n,d)}});else{if(d.container&&(d.container=void 0,d.containerReadOnly=!1,d._fwcObjType===I.OBJ_ADDRESS)){let A=/^(.+)\s+\((.+)\)$/.exec(d.text);A&&(d._fwcObjName=A[1])}e.manageObject(t,n,d)}});else if(h&&(d.obj_type==24||d.obj_type==23))this.fwcFirewallService.getFirewall.bind(this.fwcFirewallService)(h,this.fwcUserService.getActualFwSelectedCloud()).subscribe(b=>{let T=b.data;if(!(T.plugins&nr.get("GeoIP"))&&T.install_communication=="agent")this.confirmationService.confirm({header:this.translate.instant("FW.PLUGINS.GEOIP_NOT_ACTIVATED_HEADER"),icon:"fa fa-exclamation-triangle fwcOrange iconBig",message:this.translate.instant("FW.PLUGINS.GEOIP_NOT_ACTIVATED_FIREWALL",{firewall:T.name}),rejectVisible:!0,acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.YES"),rejectLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.NO"),reject:()=>{},accept:()=>{if(d.container&&(d.container=void 0,d.containerReadOnly=!1,d._fwcObjType===I.OBJ_ADDRESS)){let A=/^(.+)\s+\((.+)\)$/.exec(d.text);A&&(d._fwcObjName=A[1])}e.manageObject(t,n,d)}});else{if(d.container&&(d.container=void 0,d.containerReadOnly=!1,d._fwcObjType===I.OBJ_ADDRESS)){let A=/^(.+)\s+\((.+)\)$/.exec(d.text);A&&(d._fwcObjName=A[1])}e.manageObject(t,n,d)}});else{if(d.container&&(d.container=void 0,d.containerReadOnly=!1,d._fwcObjType===I.OBJ_ADDRESS)){let v=/^(.+)\s+\((.+)\)$/.exec(d.text);v&&(d._fwcObjName=v[1])}e.manageObject(t,n,d)}this.itemSelectedService.clearDragItem(),this.resetVisibleRulePositions()}resetVisibleRulePositions(){typeof navigator<"u"&&/firefox/i.test(navigator.userAgent)&&this.fwcPolicyService.getActualPolicy().filter(e=>e.visible===!0).forEach(e=>{e.positions.forEach(t=>{t.draggedOver=!1,t.objectAllowed=void 0;let n=document.getElementById(`position-${t.id}`);n&&(this.renderer.removeClass(n,"fwcObjectAllowed"),this.renderer.removeClass(n,"fwcObjectForbidden"),this.renderer.removeClass(n,"draggedOver"))})})}onItemRightClickEvent(e,t){e.selectedItem=t}onItemClickEvent(e,t){if(e.selectedItem=t,this.clearObjectInfo(void 0),t._fwcObjId!=I.OBJ_ANY){let n={_fwcObjId:t._fwcObjId,_fwcObjType:t._fwcObjType,highlighted:!t.highlighted};this.itemSelectedService.setModifiedItem(n,!1,!1,!1,!0)}}onItemDblClickEvent(e,t){e.selectedItem=t;let n=Object.assign({},t),l=n._fwcObjType===I.OBJ_OPENVPN_PREFIX||n._fwcObjType===I.OBJ_WIREGUARD_PREFIX||n._fwcObjType===I.OBJ_IPSEC_PREFIX;n.editPrefixAction=l,l?this.itemSelectedService.setPrefixItem(n):n&&n._fwcObjId!=I.OBJ_ANY&&this.itemSelectedService.setItem(n)}onMarkDblClickEvent(e){let t={id:e,fwcloud:this.fwcUserService.getActualFwSelectedCloud(),_fwcObjId:e,_fwcObjType:I.OBJ_MARK};this.itemSelectedService.setItem(t)}itemDragStart(e,t,n){let l;n.stopPropagation(),e.selectedItem=t,l=Object.assign({},t),l.srcPositionUID=e.positionUID,this.itemSelectedService.setDragItem(l);let o=l.id?.toString()??"";n.dataTransfer.setData("dragItemId",o),n.dataTransfer.setData("text/plain",o),this.setDragImageFromEvent(n),n.dataTransfer.dropEffect="move",n.dataTransfer.effectAllowed="copyMove",this.clearObjectInfo(void 0)}showObjectInfo(e,t){if(e&&(t&&t.preventDefault(),e&&!this.infoTooltipTimer&&!this.infoTooltipShown)){let n={objId:e._fwcObjId,objType:e._fwcObjType,fwId:e._fwcFwId,clusterId:e._fwcClusterId,objParentId:e.parent_id};n.objId!==null&&n.objType!==null&&n.objType!=I.OBJ_ANY&&(this.infoTooltipTimer=setTimeout(()=>{this.infoTooltipShown=!0,this.itemSelectedService.setObjectInfo(n,t)},1e3))}}clearObjectInfo(e){e&&e.preventDefault(),this.infoTooltipTimer&&(clearTimeout(this.infoTooltipTimer),this.infoTooltipTimer=void 0),this.infoTooltipShown&&(setTimeout(()=>{this.itemSelectedService.setObjectInfo(void 0,e)},500),this.infoTooltipShown=!1)}manageObject(e,t,n,l,o,a){let u=Object.assign({},o),d,h,S=o._fwcObjId,v=o._fwcObjType,b=o._fwcPositionId,T=o._fwcRuleId,A=l.id,N=n,j=o.position_order,D=this.fwcPolicyService.getActualSelectedPolicy()._fwcPolicyIPVersion;if(h=this.translate.instant("POSITION.ERROR_EMPTY_CONTAINER",{name:o._fwcObjName,ipVersion:D}),a)o.position_order=l.ipobjs.length;else{let X=0;for(let re=0;re<l.ipobjs.length&&!(l.ipobjs[re]._fwcObjId==S&&l.ipobjs[re]._fwcObjType==v);re++)l.ipobjs[re]._fwcObjId!=I.OBJ_ANY&&X++;o.position_order=X+1}o._fwcPositionId=o.position=l.id,o._fwcRuleId=o.rule=n,o.ipobj=void 0,o.ipobj_g=void 0,o.interface=void 0,o.container=void 0,o.ipobj=o.ipobj_g=o.interface=-1;let Q={fwcloud:this.fwcUserService.getActualFwSelectedCloud(),firewall:e,rule:o.rule,position:o.position,position_order:o.position_order};if(o._fwcObjType==I.OBJ_OPENVPN_CONFIG_CLI)Q.openvpn=o._fwcObjId,d=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_OPENVPN_CONFIG");else if(o._fwcObjType==I.OBJ_OPENVPN_PREFIX)Q.prefix=o._fwcObjId,d=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_PREFIX"),h=this.translate.instant("POSITION.ERROR_EMPTY_PREFIX",{name:o._fwcObjName});else if(o._fwcObjType==I.OBJ_WGC_CONFIG_CLI)Q.wireguard=o._fwcObjId,d=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_WG_CONFIG");else if(o._fwcObjType==I.OBJ_WIREGUARD_PREFIX)Q.prefix=o._fwcObjId,d=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_PREFIX"),h=this.translate.instant("POSITION.ERROR_EMPTY_PREFIX",{name:o._fwcObjName});else if(o._fwcObjType==I.OBJ_ISC_CONFIG_CLI)Q.ipsec=o._fwcObjId,d=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_IPSEC_CONFIG");else if(o._fwcObjType==I.OBJ_IPSEC_PREFIX)Q.prefix=o._fwcObjId,d=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_PREFIX"),h=this.translate.instant("POSITION.ERROR_EMPTY_PREFIX",{name:o._fwcObjName});else switch(Q.ipobj=o.ipobj,Q.ipobj_g=o.ipobj_g,Q.interface=o.interface,l.content){case"I":Q.interface=o.interface=o._fwcObjId,d="Interface",delete Q.ipobj,delete Q.ipobj_g;break;case"O":default:o._fwcObjType==I.OBJ_INTERFACE_FIREWALL||o._fwcObjType==I.OBJ_INTERFACE_HOST?(Q.interface=o.interface=o._fwcObjId,d=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_INTERFACE_FIREWALL")):o._fwcObjType==I.OBJ_GROUP||o._fwcObjType==I.OBJ_SERVICE_GROUP||o._fwcObjType==I.OBJ_CONTINENT?(Q.ipobj_g=o.ipobj_g=o._fwcObjId,d=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_GROUP")):(Q.ipobj=o.ipobj=o._fwcObjId,d=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_GEN_IP_OBJECT"));break}if(b==null||T==null||a==de.COPY)this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcPolicyService.newPolicyObject.bind(this.fwcPolicyService),Q,l.content,o._fwcObjType).then(X=>{this.updateFirewallStatus(e,t),this.store.dispatch(Ce.reloadDialog({dialogUuids:[Z.ITEM_PANEL]})),l.ipobjs.push(o),this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:d+this.translate.instant("POSITION.OBJ_ADDED")}),this.ruleSelectedService.setRuleStatus(null),this.ruleSelectedService.setRuleHeightRecalculate(n),this.detectChanges(),a==de.COPY&&this.store.dispatch(Ce.reloadDialog({dialogUuids:[Z.ITEM_PANEL,Z.OVCONFIG_PANEL,Z.WIREGUARD_CONFIG_PANEL,Z.IPSEC_CONFIG_PANEL]}))}).catch(X=>{let re;X.error&&X.error.fwcErr==1003?re=this.translate.instant("POSITION.ERROR_DUP"):X.error&&X.error.fwcErr==5001?re=h:this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(X)}),re&&this.confirmationService.confirm({header:this.translate.instant("POSITION.ERROR_HEADER"),icon:"fa fa-exclamation-circle fwcRed iconBig",message:re,rejectVisible:!1,acceptLabel:"Ok",accept:()=>{}}),this.ruleSelectedService.setRuleStatus(null),this.detectChanges()});else{let X={fwcloud:this.fwcUserService.getActualFwSelectedCloud(),firewall:e,rule:T,position:b,position_order:j,new_rule:N,new_position:A,new_order:o.position_order};l.content=="O"?o._fwcObjType==I.OBJ_OPENVPN_CONFIG_CLI?X.openvpn=o._fwcObjId:o._fwcObjType==I.OBJ_WGC_CONFIG_CLI?X.wireguard=o._fwcObjId:o._fwcObjType==I.OBJ_ISC_CONFIG_CLI?X.ipsec=o._fwcObjId:o._fwcObjType==I.OBJ_OPENVPN_PREFIX||o._fwcObjType==I.OBJ_WIREGUARD_PREFIX||o._fwcObjType==I.OBJ_IPSEC_PREFIX?X.prefix=o._fwcObjId:(X.ipobj=o.ipobj,X.ipobj_g=o.ipobj_g,X.interface=o.interface):X.interface=o.interface,this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcPolicyService.updatePolicyObject.bind(this.fwcPolicyService),X,l.content,o._fwcObjType).then(re=>{l.ipobjs.push(o),o.srcRuleId=T,o.srcPositionId=b,this.itemSelectedService.setModifiedItem(o,!0),a&&this.itemSelectedService.clearClipboardItem(),this.updateFirewallStatus(e,t),this.store.dispatch(Ce.reloadDialog({dialogUuids:[Z.ITEM_PANEL,Z.OVCONFIG_PANEL,Z.WIREGUARD_CONFIG_PANEL,Z.IPSEC_CONFIG_PANEL]})),this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:d+this.translate.instant("POSITION.OBJ_ADDED")}),this.ruleSelectedService.setRuleHeightRecalculate(T),this.ruleSelectedService.setRuleHeightRecalculate(N)}).catch(re=>{re.error&&re.error.respCode=="ACR_ALREADY_EXISTS"?this.confirmationService.confirm({header:this.translate.instant("POSITION.ERROR_HEADER"),icon:"fa fa-exclamation-circle fwcRed iconBig",message:this.translate.instant("POSITION.ERROR_DUP"),rejectVisible:!1,acceptLabel:"Ok",accept:()=>{}}):this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(re)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}}removeItem(e,t){let n=-1;if(!e.ipobjs)return-1;for(let l=0;l<e.ipobjs.length;l++)if(e.ipobjs[l]._fwcObjId!=I.OBJ_ANY&&e.ipobjs[l]._fwcObjId==t._fwcObjId){n=l;break}return n>=0&&e.ipobjs.splice(n,1),e.ipobjs.length<=1&&(e.negate=!1),n}updateFirewallStatus(e,t){this.store.dispatch(rt.updateFwStatus({item:{cluster:t,id:e,status:3}}))}checkOperation(e,t,n,l){let o,a=+l._fwcObjType,u=this.translate.instant("GLOBALS.DB_OBJECT_NAMES."+a),d=l.items&&l.items.length,S=(v=>{let b=!1,T=[];for(T.push(v);T.length&&!b;){let A=T.pop();b=A._fwcObjType==I.OBJ_ADDRESS,!b&&A.items&&A.items.length&&T.push(...A.items)}return b})(l);return n.indexOf(a)==-1?o=this.translate.instant("POSITION.ERROR_NOTALLOWED"):t.ipobjs&&t.ipobjs.some(function(v){return l._fwcObjId==v._fwcObjId&&l._fwcObjType==v._fwcObjType})?o=this.translate.instant("POSITION.ERROR_EXISTS",{name:l._fwcObjName}):t.content=="I"&&a==I.OBJ_INTERFACE_FIREWALL&&l._fwcFwId!=e?o=this.translate.instant("POSITION.ERROR_IF"):t.policy_type!==Ne.ROUTING_TABLE&&t.single_object&&t.ipobjs&&t.ipobjs.length>=2?o=this.translate.instant("POSITION.ERROR_ONLY1"):t.policy_type===Ne.ROUTING_TABLE&&t.id===vi.INTERFACE_POSITION&&l._fwcObjType===I.OBJ_INTERFACE_HOST&&(o=this.translate.instant("POSITION.ERROR_HOST_IF_IN_ROUTE")),o}removeItemAt(e,t){return e.ipobjs?(t>=0&&t<e.ipobjs.length&&e.ipobjs.splice(t,1),e.ipobjs.length<=1&&(e.negate=!1),t):-1}detectChanges(){this.changeDetectorRef.destroyed||this.changeDetectorRef.detectChanges()}setDragImageFromEvent(e){if(!e?.dataTransfer)return;let t=e.target?.closest(".divFwcPosition-item");if(!t)return;let n=t.getBoundingClientRect(),l=n.width/2,o=n.height/2;(e.clientX!==0||e.clientY!==0)&&(l=e.clientX-n.left,o=e.clientY-n.top);let a=this.createDragPreviewElement(t,n),u=a??t;try{e.dataTransfer.setDragImage(u,l,o),a&&(this.dragPreviewElement=a)}catch{a?.parentNode&&a.parentNode.removeChild(a),this.dragPreviewElement=void 0}}createDragPreviewElement(e,t){if(typeof document>"u"||typeof window>"u")return null;let n=e.cloneNode(!0);if(!n)return null;n.classList.remove("item-general-hidden");let l=window.getComputedStyle(e),o=l.backgroundColor&&l.backgroundColor!=="rgba(0, 0, 0, 0)"?l.backgroundColor:"rgba(255, 255, 255, 0.95)";return n.style.pointerEvents="none",n.style.position="fixed",n.style.top="-1000px",n.style.left="-1000px",n.style.zIndex="2147483647",n.style.background=o,n.style.borderRadius="4px",n.style.padding="2px 6px",n.style.boxShadow="0 1px 4px rgba(0, 0, 0, 0.2)",n.style.border="1px solid rgba(0, 0, 0, 0.12)",n.style.boxSizing="border-box",n.style.display="inline-flex",n.style.alignItems="center",n.style.gap="0.35rem",n.style.font=l.font||`${l.fontSize} ${l.fontFamily}`,n.style.color=l.color,n.style.whiteSpace="nowrap",n.style.width=`${t.width}px`,n.style.minHeight=`${t.height}px`,n.style.height=`${t.height}px`,document.body.appendChild(n),n}clearHoverState(e){if(this.hoveredPosition&&this.hoveredPosition.el!==e){let{pos:t,el:n}=this.hoveredPosition;t.draggedOver=!1,t.objectAllowed=void 0,this.dragLevelMap.delete(n),this.detectChanges()}e||(this.hoveredPosition=void 0)}cleanupDragPreview(){this.dragPreviewElement?.parentNode&&this.dragPreviewElement.parentNode.removeChild(this.dragPreviewElement),this.dragPreviewElement=void 0}};s.\u0275fac=function(t){return new(t||s)(G(Wi),G(be),G(we),G(ge),G(ye),G(He),G(Le),G(me),G(Ue),G(gi),G(Se),G(Ri),G(Ee),G(fe),G(ue))},s.\u0275prov=De({token:s,factory:s.\u0275fac});let r=s;return r})();var kn=class extends _t{constructor(s,i,e,t,n,l,o,a){super(s,t,n,l,o),this.utilService=s,this.fwcRoutingPolicyService=i,this.fwcPolicyGridRoutingRulesFunctionalityService=e,this.translationKeys={ENTITY_NAME:"RULE.RULE",ENTITY_DELETE:"RULE.DELETE_TEXT",DELETE_SUCCESS:"RULE.DELETE_SUCCESS",ENTITY_COLOR:"RULE.COLOR_TEXT"},this.buildPolicyRules(a)}buildPolicyRules(s){let i=[];Array.isArray(s)&&(i=this.fwcPolicyGridRoutingRulesFunctionalityService.parseRoutingPolicyRules(this.firewallId,this.fwcloudId,s)),this.rules=i}convertPolicyRuleToRoutingRule(s){let i=[];if(Array.isArray(s.positions)&&s.positions.length){let t=s.positions.find(n=>n.id===ji.FROM_POSITION);if(t&&Array.isArray(t.ipobjs))for(let n of t.ipobjs)n._fwcObjType!==I.OBJ_ANY&&i.push({id:n.id,name:n.name,type:n.type,firewall_id:n.firewall_id,cluster_id:n.cluster_id,cluster_name:n.cluster_name,position_order:n.position_order})}return{id:s.id,routingTableId:s.routingTableId,routingGroupId:s.idgroup,comment:s.comment,style:s.style,rule_order:s.rule_order,active:!!s.active,items:i}}newPolicyRule(s,i){s&&i!==void 0?this.fwcPolicyGridRoutingRulesFunctionalityService.showNewRuleDialog(this.clusterId,this.firewallId,s.id,i):this.fwcPolicyGridRoutingRulesFunctionalityService.showNewRuleDialog(this.clusterId,this.firewallId)}updateRule(s){let i=s.formModel.comment,e=s.formModel.style,t=s.formModel.active,n=this.convertPolicyRuleToRoutingRule(s);this.fwcPolicyGridRoutingRulesFunctionalityService.updateRule(this.clusterId,this.firewallId,this.fwcloudId,n,i,e,!!t)}deletePolicyRuleApiCall(s){return this.utilService.fwcAPICall(this.fwcRoutingPolicyService.deleteRoutingPolicyRules.bind(this.fwcRoutingPolicyService),this.firewallId,this.fwcloudId,s)}manageObject(s,i,e,t){this.fwcPolicyGridRoutingRulesFunctionalityService.updateRulePosition(this,this.firewallId,this.fwcloudId,s,i,e,t)}deleteObject(s,i){this.fwcPolicyGridRoutingRulesFunctionalityService.deleteObjectFromPosition(this.firewallId,this.clusterId,this.fwcloudId,s.rule,s,i)}compileSelectedRoutes(){this.fwcPolicyGridRoutingRulesFunctionalityService.compileSelectedRules()}moveSelectedRules(s,i){this.fwcPolicyGridRoutingRulesFunctionalityService.moveSelectedRules(i.firewall,i.fwcloud,i.pasteOnRuleId,i.rulesIds,i.pasteOffset)}manageSelectedRules(s,i){return this.utilService.fwcAPICall(this.fwcRoutingPolicyService.manageRoutingPolicyRules.bind(this.fwcRoutingPolicyService),this.firewallId,this.fwcloudId,s.pasteOnRuleId,s.pasteOffset,s.rulesIds,i)}setRuleActive(s,i){let e={active:!!i};this.fwcPolicyGridRoutingRulesFunctionalityService.updateSelectedRules(this.clusterId,this.firewallId,this.fwcloudId,e)}setRuleComment(s){this.fwcPolicyGridRoutingRulesFunctionalityService.updateRuleComment(s)}setRuleApplyTo(s){this.fwcPolicyGridRoutingRulesFunctionalityService.handleChangeApplyToTable(s)}setRuleScript(s){}setRuleStyleApiCall(){return this.fwcPolicyGridRoutingRulesFunctionalityService.setRuleStyle.bind(this.fwcPolicyGridRoutingRulesFunctionalityService)}newRuleGroupApiCall(){return this.fwcPolicyGridRoutingRulesFunctionalityService.newRoutingRuleGroup.bind(this.fwcPolicyGridRoutingRulesFunctionalityService)}setRuleGroupStyleApiCall(){return this.fwcPolicyGridRoutingRulesFunctionalityService.setGroupValues.bind(this.fwcPolicyGridRoutingRulesFunctionalityService)}setRuleGroupNameApiCall(){return this.fwcPolicyGridRoutingRulesFunctionalityService.setGroupValues.bind(this.fwcPolicyGridRoutingRulesFunctionalityService)}removeRulesFromGroupApiCall(s){let i={routingGroupId:null},e=s.rulesIds;return this.utilService.fwcAPICall(this.fwcRoutingPolicyService.updateRoutingPolicyRules.bind(this.fwcRoutingPolicyService),this.firewallId,this.fwcloudId,e,i)}deleteRuleGroupApiCall(s){return this.utilService.fwcAPICall(this.fwcRoutingPolicyService.deleteRoutingPolicyRulesGroup.bind(this.fwcRoutingPolicyService),this.firewallId,this.fwcloudId,s)}};var Bn=class extends _t{constructor(s,i,e,t,n,l,o,a,u){super(s,n,l,o,a),this.utilService=s,this.fwcPolicyService=i,this.fwcPositionFunctionalityService=e,this.fwcRuleFunctionalityService=t,this.translationKeys={ENTITY_NAME:"RULE.RULE",ENTITY_DELETE:"RULE.DELETE_TEXT",DELETE_SUCCESS:"RULE.DELETE_SUCCESS",ENTITY_COLOR:"RULE.COLOR_TEXT"},this.buildPolicyRules(u)}buildPolicyRules(s){this.rules=s||[]}newPolicyRule(s,i){let e;s&&i!==void 0?e={id:void 0,idgroup:s.idgroup,firewall:s.firewall,rule_order:s.rule_order+i,action:s.action,time_start:void 0,time_end:void 0,active:1,options:0,comment:"",type:s.type,style:s.group_style,fwcloud:this.fwcloudId,special:s.special?s.special:0}:e={id:void 0,idgroup:null,firewall:this.firewallId,rule_order:1,action:$o.FWACTION_ACCEPT,time_start:void 0,time_end:void 0,active:1,options:0,comment:"",type:this.policyType,fwcloud:this.fwcloudId},this.fwcRuleFunctionalityService.createNewRule(e,s)}deletePolicyRuleApiCall(s){return this.utilService.fwcAPICall(this.fwcPolicyService.deletePolicyRules.bind(this.fwcPolicyService),this.firewallId,s,this.fwcloudId)}manageObject(s,i,e,t){this.fwcPositionFunctionalityService.manageObject(this.firewallId,this.clusterId,s,i,e,t)}deleteObject(s,i){this.fwcPositionFunctionalityService.deleteObjectFromPosition(this.firewallId,this.clusterId,s.rule,s,i)}compileSelectedRoutes(s){this.fwcRuleFunctionalityService.compileSelectedRules(s)}moveSelectedRules(s,i){this.fwcRuleFunctionalityService.moveSelectedRules(s,i)}manageSelectedRules(s,i){return this.utilService.fwcAPICall(this.fwcPolicyService.managePolicyRules.bind(this.fwcPolicyService),s,i)}setRuleActive(s,i){this.fwcRuleFunctionalityService.setRulesProperty(s,"active",i)}setRuleComment(s){this.fwcRuleFunctionalityService.updateRule(s)}setRuleScript(s){this.fwcRuleFunctionalityService.updateRule(s)}setRuleStyleApiCall(){return this.fwcRuleFunctionalityService.onSetRuleCustomColor.bind(this.fwcRuleFunctionalityService)}newRuleGroupApiCall(){return this.fwcRuleFunctionalityService.newRuleGroup.bind(this.fwcRuleFunctionalityService)}setRuleGroupStyleApiCall(){return this.fwcRuleFunctionalityService.onSetGroupCustomColor.bind(this.fwcRuleFunctionalityService)}setRuleGroupNameApiCall(){return this.fwcRuleFunctionalityService.onSetGroupName.bind(this.fwcRuleFunctionalityService)}removeRulesFromGroupApiCall(s){return this.utilService.fwcAPICall(this.fwcPolicyService.deletePolicyRulesGroupRuleFromGroup.bind(this.fwcPolicyService),s)}deleteRuleGroupApiCall(s){return this.utilService.fwcAPICall(this.fwcPolicyService.deletePolicyRulesGroup.bind(this.fwcPolicyService),this.firewallId,s,this.fwcloudId)}setRuleApplyTo(s){this.fwcRuleFunctionalityService.updateRule(s)}};var or=(()=>{let s=class s{constructor(e,t,n,l,o,a,u,d,h,S,v,b){this.translate=e,this.fwcErrorPipe=t,this.utilService=n,this.fwcUserService=l,this.fwcFirewallService=o,this.fwcPolicyService=a,this.fwcDhcpPolicyService=u,this.ruleSelectedService=d,this.messageService=h,this.confirmationService=S,this.cd=v,this.store=b}setGroupValues(e){if(e){let t=e.groupData,n=e.group,l=e.policyType,o={style:e.groupColor,name:e.groupName};this.updateGroup(l,t.firewall,t.fwcloud,n,o)}}updateGroup(e,t,n,l,o){let a;(e===$[q.DHCP]||e===$[q.DHCP_FIXED_IP])&&(a=this.fwcDhcpPolicyService.updateDhcpPolicyRuleGroup.bind(this.fwcDhcpPolicyService)),a&&(this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(a,t,n,l.idgroup,o).then(()=>{if(o.name){l.group_name=o.name;let u=l.rules;for(let d=0;d<u.length;d++)u[d].group_name=l.group_name}if(o.style){l.group_style=o.style;let u=l.rules;for(let d=0;d<u.length;d++)u[d].group_style=l.group_style}l=ot(l)}).catch(u=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(u)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()}))}compileRules(e){let t,n,l,o=this.ruleSelectedService.getActualSelectedRules(),a=this.ruleSelectedService.getRulesOrderedIds(o),u;if(Array.isArray(a.orderedRules)&&a.orderedRules[0]){u=a.orderedRules[0],t=this.fwcUserService.getActualFwcUser().selectedFwCloud,n=u.firewall,l=a.rulesIds;let d=this.fwcDhcpPolicyService.compileDhcpPolicyRules.bind(this.fwcDhcpPolicyService),h=[n,t,l],S=this.translate.instant("DHCP.NEW_RULE_PANEL.RULE"),v=this.translate.instant("DHCP.POLICY.COMPILE_DIALOG_TITLE");e&&(d=this.fwcDhcpPolicyService.compileDhcpPolicyRules.bind(this.fwcDhcpPolicyService),h=[n,t,e,l],S=this.translate.instant("DHCP.NEW_RULE_PANEL.RULE"),v=this.translate.instant("DHCP.RULE.COMPILE_DIALOG_TITLE")),this.ruleSelectedService.setRuleStatus(""),this.detectChanges(),this.utilService.fwcAPICall(d,...h).then(b=>{if(Array.isArray(b.data)){let T=this.utilService.createDynamicComponentRef(qt),A=T.instance;A.setDynamicComponentRef(T),A.showCompilationData(b.data,o,S,v,void 0,void 0)}}).catch(b=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(b)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}}filterIpObjects(e,t){let n=[];return Array.isArray(e)&&(n=e.filter(t).map(l=>({id:l.id,order:l.position_order}))),n}buildCopyApiData(e,t){let n={},l,o,a=e._fwcObjId,u=e._fwcObjType,d=t.ipobjs;switch(u){case I.OBJ_NETWORK:l=this.filterIpObjects(d,h=>h._fwcObjType===I.OBJ_NETWORK)[0],o="networkId";break;case I.OBJ_ADDRESS_RANGE:l=this.filterIpObjects(d,h=>h._fwcObjType===I.OBJ_ADDRESS_RANGE)[0],o="rangeId";break;case I.OBJ_ADDRESS:if(t.id===Me.DNS){l=this.filterIpObjects(d,h=>h._fwcObjType===I.OBJ_ADDRESS),o="ipObjIds";break}else{l=this.filterIpObjects(d,h=>h._fwcObjType===I.OBJ_ADDRESS)[0],o="routerId";break}case I.OBJ_INTERFACE_HOST:case I.OBJ_INTERFACE_FIREWALL:l=this.filterIpObjects(d,h=>h._fwcObjType===I.OBJ_INTERFACE_FIREWALL||h._fwcObjType===I.OBJ_INTERFACE_HOST)[0],o="interfaceId";break}return n[o]=Array.isArray(l)?[...l,{id:a,order:d?d.length:1}]:a,l&&!Array.isArray(l)&&this.buildRemoveApiData(l,t),n}buildRemoveApiData(e,t){let n={},l,o,a=e._fwcObjId,u=t.ipobjs;switch(e._fwcObjType){case I.OBJ_NETWORK:return this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.ERROR"),detail:this.translate.instant("GLOBALS.MSG_OBJ_DELETE.NETWORK")}),e;case I.OBJ_ADDRESS_RANGE:return this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.ERROR"),detail:this.translate.instant("GLOBALS.MSG_OBJ_DELETE.RANGE")}),e;case I.OBJ_ADDRESS:if(t.id===Me.DNS){l=this.filterIpObjects(u,h=>h._fwcObjType===I.OBJ_ADDRESS&&h._fwcObjId!==a),o="ipObjIds";break}else return this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.ERROR"),detail:this.translate.instant("GLOBALS.MSG_OBJ_DELETE.ROUTER")}),e;case I.OBJ_INTERFACE_HOST:case I.OBJ_INTERFACE_FIREWALL:return this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.ERROR"),detail:this.translate.instant("GLOBALS.MSG_OBJ_DELETE.INTERFACE")}),e}return n[o]=Array.isArray(l)?[...l]:l,n}removeObjectFromPosition(e,t){if(Array.isArray(e.ipobjs)){e.ipobjs=e.ipobjs.filter(n=>n._fwcObjId!==t._fwcObjId||n._fwcObjType!==t._fwcObjType);for(let n of e.ipobjs)n.position_order!=null&&n.position_order>t.position_order&&n.position_order--}}dispatchFwStatusUpdateAction(e,t){this.store.dispatch(rt.updateFwStatus({item:{cluster:e,id:t,status:3}}))}dispatchReloadItemPanelAction(){this.store.dispatch(Ce.reloadDialog({dialogUuids:[Z.ITEM_PANEL]}))}dispatchReloadItemEditingPanels(){this.store.dispatch(Ce.reloadDialog({dialogUuids:[Z.ITEM_PANEL,Z.CLUSTER_PANEL,Z.FIREWALL_PANEL,Z.OVCONFIG_PANEL,Z.WIREGUARD_CONFIG_PANEL,Z.IPSEC_CONFIG_PANEL]}))}detectChanges(){this.cd.destroyed||(this.cd.markForCheck(),this.cd.detectChanges())}};s.\u0275fac=function(t){return new(t||s)(G(ue),G(be),G(me),G(ge),G(fe),G(ye),G(wi),G(Ue),G(Ee),G(Le),G(we),G(Se))},s.\u0275prov=De({token:s,factory:s.\u0275fac,providedIn:"root"});let r=s;return r})();var jn=(()=>{let s=class s extends or{constructor(e,t,n,l,o,a,u,d,h,S,v,b,T){super(e,t,n,l,o,a,d,h,S,v,b,T),this.translate=e,this.fwcErrorPipe=t,this.utilService=n,this.fwcUserService=l,this.fwcFirewallService=o,this.fwcPolicyService=a,this.fwcInterfaceService=u,this.fwcDhcpPolicyService=d,this.ruleSelectedService=h,this.messageService=S,this.confirmationService=v,this.cd=b,this.store=T}parseDhcpPolicyRules(e,t,n){let l=[];for(let o of n){o.group&&(o.dhcpGroup=o.group);let a=o.rule_type;o.rule_type=o.rule_type==2?$[q.DHCP_FIXED_IP]:$[q.DHCP];let u=this.resolveFirewallApplyToId(o),d={id:o.id,idgroup:o.group&&o.dhcpGroup.id,group_name:o.group&&o.dhcpGroup.name,group_style:o.group&&o.dhcpGroup.style,comment:o.comment,style:o.style,type:o.rule_type,max_lease:a===1?o.max_lease:null,cfg_text:a===3?o.cfg_text:null,special:a===3?6:null,rule_order:o.rule_order,active:o.active?1:0,firewall:e,fwcloud:t,fw_apply_to:u,positions:[]},h=1;if(d.type===$[q.DHCP]){let S={id:Me.NETWORK,rule:o.id,ipobjs:[],content:"O",name:this.translate.instant("POLICY_GRID.RULES.DHCP_NETWORK"),policy_type:o.rule_type,position_order:h++,single_object:0,fwcloud:t,firewall:e};if(o.network){let A={rule:o.id,position:Me.NETWORK,id:o.network.id,name:o.network.name,type:o.network.ipObjTypeId,position_order:1,firewall_id:e,cluster_id:o._fwcClusterId};S.ipobjs.push(A)}let v={id:Me.RANGE,rule:o.id,ipobjs:[],content:"O",name:this.translate.instant("POLICY_GRID.RULES.RANGE"),policy_type:o.rule_type,position_order:h++,single_object:0,fwcloud:t,firewall:e};if(o.range){let A={rule:o.id,position:Me.RANGE,id:o.range.id,name:o.range.name,type:o.range.ipObjTypeId,position_order:1,firewall_id:e,cluster_id:o._fwcClusterId};v.ipobjs.push(A)}let b={id:Me.ROUTER,rule:o.id,ipobjs:[],content:"O",name:this.translate.instant("POLICY_GRID.RULES.ROUTER"),policy_type:o.rule_type,position_order:h++,single_object:0,fwcloud:t,firewall:e};if(o.router){let A={rule:o.id,position:Me.ROUTER,id:o.router.id,name:o.router.name,type:o.router.ipObjTypeId,position_order:1,firewall_id:o.router.interface&&o.router.interface.firewall?o.router.interface.firewall.id:null,firewall_name:o.router.interface&&o.router.interface.firewall?o.router.interface.firewall.name:null,cluster_id:o.router.interface&&o.router.interface.firewall&&o.router.interface.firewall.cluster?o.router.interface.firewall.cluster.id:null,cluster_name:o.router.interface&&o.router.interface.firewall&&o.router.interface.firewall.cluster?o.router.interface.firewall.cluster.name:null,host_id:o.router.interface&&o.router.interface.hosts&&o.router.interface.hosts.length>0&&o.router.interface.hosts[0].hostIPObj?o.router.interface.hosts[0].hostIPObj.id:null,host_name:o.router.interface&&o.router.interface.hosts&&o.router.interface.hosts.length>0&&o.router.interface.hosts[0].hostIPObj?o.router.interface.hosts[0].hostIPObj.name:null};b.ipobjs.push(A)}let T={id:Me.DNS,rule:o.id,ipobjs:[],content:"O",name:this.translate.instant("POLICY_GRID.RULES.SERVERS"),policy_type:o.rule_type,position_order:h++,single_object:0,fwcloud:t,firewall:e};if(Array.isArray(o.items)){let A=1;for(let N of o.items){let j={rule:o.id,position:Me.DNS,id:N.id,name:N.name,type:N.type,position_order:A++,firewall_id:N.firewall_id?N.firewall_id:null,firewall_name:N.firewall_name?N.firewall_name:null,cluster_id:N.cluster_id?N.cluster_id:null,cluster_name:N.cluster_name?N.cluster_name:null,host_id:N.host_id?N.host_id:null,host_name:N.host_name?N.host_name:null};T.ipobjs.push(j)}}d.positions.push(S,v,b,T)}if(d.type===$[q.DHCP_FIXED_IP]){let S={id:Me.INTERFACE,rule:o.id,ipobjs:[],content:"O",name:this.translate.instant("POLICY_GRID.RULES.INTERFACE"),policy_type:o.rule_type,position_order:h++,single_object:0,fwcloud:t,firewall:e};if(o.interface){let b={rule:o.id,position:Me.INTERFACE,id:o.interface.id,name:o.interface.name,type:o.interface.type,mac:o.interface.mac,position_order:1,firewall_id:o.interface.firewall?o.interface.firewall.id:null,firewall_name:o.interface.firewall?o.interface.firewall.name:null,cluster_id:o.interface.firewall&&o.interface.firewall.cluster?o.interface.firewall.cluster.id:null,cluster_name:o.interface.firewall&&o.interface.firewall.cluster?o.interface.firewall.cluster.name:null,fwcloud:t,host_id:o.interface.hosts&&o.interface.hosts.length>0&&o.interface.hosts[0].hostIPObj?o.interface.hosts[0].hostIPObj.id:null,host_name:o.interface.hosts&&o.interface.hosts.length>0&&o.interface.hosts[0].hostIPObj?o.interface.hosts[0].hostIPObj.name:null};b.mac&&S.ipobjs.push(b)}let v={id:Me.IP,rule:o.id,ipobjs:[],content:"O",name:this.translate.instant("POLICY_GRID.RULES.IP"),policy_type:o.rule_type,position_order:h++,single_object:0,fwcloud:t,firewall:e};if(o.router){let b={rule:o.id,position:Me.IP,id:o.router.id,name:o.router.name,type:o.router.ipObjTypeId,position_order:1,firewall_id:o.router.interface&&o.router.interface.firewall?o.router.interface.firewall.id:null,firewall_name:o.router.interface&&o.router.interface.firewall?o.router.interface.firewall.name:null,cluster_id:o.router.interface&&o.router.interface.firewall&&o.router.interface.firewall.cluster?o.router.interface.firewall.cluster.id:null,cluster_name:o.router.interface&&o.router.interface.firewall&&o.router.interface.firewall.cluster?o.router.interface.firewall.cluster.name:null,host_id:o.router.interface&&o.router.interface.hosts&&o.router.interface.hosts.length>0&&o.router.interface.hosts[0].hostIPObj?o.router.interface.hosts[0].hostIPObj.id:null,host_name:o.router.interface&&o.router.interface.hosts&&o.router.interface.hosts.length>0&&o.router.interface.hosts[0].hostIPObj?o.router.interface.hosts[0].hostIPObj.name:null};v.ipobjs.push(b)}d.positions.push(S,v)}l.push(d)}return l}updateSelectedRules(e,t,n,l){let o=this.ruleSelectedService.getActualSelectedRules(),a=!!Object.keys(l).length;if(Array.isArray(o)&&o.length){let u=o.map(d=>d.id);this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcDhcpPolicyService.updateDhcpPolicyRules.bind(this.fwcDhcpPolicyService),t,n,u,l).then(()=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("DHCP.SUCCESS.UPDATE_RULE")}),this.fwcPolicyService.reloadPolicy(),a&&this.dispatchFwStatusUpdateAction(e,t)}).catch(d=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(d)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null)})}}updateRuleComment(e){if(e&&e.formModel){let t=e.formModel.comment;if(e.comment!==t){let n=e.firewall,l=e.fwcloud,o={comment:t};this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcDhcpPolicyService.updateDhcpPolicyRule.bind(this.fwcDhcpPolicyService),n,l,e.id,o).then(()=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("ROUTING.SUCCESS.UPDATE_RULE")}),e.comment=t,this.dispatchFwStatusUpdateAction(e._fwcClusterId,n)}).catch(a=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(a)}),e.formModel.comment=e.comment}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}}}updateRuleCfgText(e){if(e&&e.formModel){let t=e.formModel.cfg_text;if(e.cfg_text!==t){let n=e.firewall,l=e.fwcloud,o={cfg_text:t};this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcDhcpPolicyService.updateDhcpPolicyRule.bind(this.fwcDhcpPolicyService),n,l,e.id,o).then(()=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("ROUTING.SUCCESS.UPDATE_RULE")}),e.cfg_text=t,this.dispatchFwStatusUpdateAction(e._fwcClusterId,n)}).catch(a=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(a)}),e.formModel.cfg_text=e.cfg_text}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}}}handleChangeApplyToGroup(e){if(e&&e.formModel){let t=e.firewall,n=e.fwcloud,l={firewallApplyToId:e.formModel.fw_apply_to};this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcDhcpPolicyService.updateDhcpPolicyRule.bind(this.fwcDhcpPolicyService),t,n,e.id,l).then(()=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("DHCP.SUCCESS.UPDATE_RULE")}),e.fw_apply_to=e.formModel.fw_apply_to,this.dispatchFwStatusUpdateAction(e._fwcClusterId,e.firewall),this.dispatchReloadItemEditingPanels(),this.detectChanges()}).catch(o=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(o)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}}updateRuleLeaseTime(e){if(e&&e.formModel){let t=e.formModel.max_lease;if(e.max_lease!==t){let n=e.firewall,l=e.fwcloud,o={max_lease:t};this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcDhcpPolicyService.updateDhcpPolicyRule.bind(this.fwcDhcpPolicyService),n,l,e.id,o).then(()=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("ROUTING.SUCCESS.UPDATE_RULE")}),e.max_lease=t,this.dispatchFwStatusUpdateAction(e._fwcClusterId,n)}).catch(a=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(a)}),e.formModel.max_lease=e.max_lease}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}}}setRuleStyle(e,t){if(t){let n={style:t.ruleColor};this.updateSelectedRules(e._fwcClusterId,e.firewall,this.fwcUserService.getActualFwSelectedCloud(),n)}}updateRulePosition(e,t,n,l,o,a,u){return le(this,null,function*(){let d={},h=a._fwcPositionId,S=a._fwcRuleId,v=this.checkOperation(e,a,u);if(v)this.confirmationService.confirm({header:this.translate.instant("POSITION.ERROR_HEADER"),icon:"fa fa-exclamation-circle fwcRed iconBig",message:v,rejectVisible:!1,acceptLabel:"Ok",accept:()=>{}});else{let b=e.getClusterId();if(a&&(a.obj_type===I.OBJ_INTERFACE_FIREWALL||a.obj_type===I.OBJ_INTERFACE_HOST)){let T=yield this.fwcInterfaceService.getInterface.bind(this.fwcInterfaceService)(t,a.id_obj,a.fwcloud).toPromise();try{if(T.data&&(T.data.mac===null||T.data.mac===void 0||T.data.mac==="")){this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.translate.instant("DHCP.POLICY.ERROR_EMPTY_MAC")});return}}catch{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.translate.instant("DHCP.POLICY.ERROR_GET_INTERFACE")})}}h==null||S==null||u==de.COPY?(d=this.buildCopyApiData(a,o),this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcDhcpPolicyService.updateDhcpPolicyRule.bind(this.fwcDhcpPolicyService),t,n,l,d).then(()=>{this.addObjectToPosition(o,a),this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("DHCP.SUCCESS.UPDATE_RULE")}),this.dispatchFwStatusUpdateAction(b,t),this.dispatchReloadItemEditingPanels(),this.ruleSelectedService.setRuleHeightRecalculate(l)}).catch(T=>{T&&typeof T.error=="string"&&T.status===500&&(T.error==="IP version mismatch"?this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.translate.instant("ITEM_PANEL.ERRORS.INVALID_IP_VERSION.TEXT")}):T.error==="Interface mac is not defined"?this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.translate.instant("DHCP.POLICY.ERROR_EMPTY_MAC")}):this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(T)}))}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})):(this.ruleSelectedService.setRuleStatus(""),this.moveObject(e,t,n,l,o,a).then(()=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("DHCP.SUCCESS.UPDATE_RULE")})}).catch(T=>{T&&typeof T.error=="string"&&T.status===500&&(T.error==="IP version mismatch"?this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.translate.instant("ITEM_PANEL.ERRORS.INVALID_IP_VERSION.TEXT")}):T.error==="Interface mac is not defined"?this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.translate.instant("DHCP.POLICY.ERROR_EMPTY_MAC")}):this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(T)}))}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()}))}})}checkOperation(e,t,n){let l;return t._fwcRuleId&&t._fwcPositionId&&(n===de.CUT||n===de.DELETE)&&e.getPolicyRule(t._fwcRuleId).positions.find(d=>d.id===t._fwcPositionId).ipobjs.filter(d=>d._fwcObjType!==I.OBJ_ANY).length<2&&(l=this.translate.instant("DHCP.POLICY.ERROR_LAST_IPOBJECT")),l}moveObject(e,t,n,l,o,a){return le(this,null,function*(){try{let u,d;switch(a._fwcObjType){case I.OBJ_GROUP:{u="ipObjGroupId";break}case I.OBJ_MARK:{u="markId";break}default:{u="ipObjId";break}}let h=e.getPolicyRule(a._fwcRuleId),S=h.positions.find(b=>b.id===a._fwcPositionId);if(a._fwcPositionId!==Me.DNS)return Promise.reject(this.translate.instant("DHCP.POLICY.ERROR_MOVING_POSITION"));d={fromId:h.id,toId:l},d[u]=a._fwcObjId,yield this.utilService.fwcAPICall(this.fwcDhcpPolicyService.moveObjectBetweenPositions.bind(this.fwcDhcpPolicyService),t,n,d),this.addObjectToPosition(o,a),this.removeObjectFromPosition(S,a),this.dispatchReloadItemEditingPanels(),this.ruleSelectedService.setRuleHeightRecalculate(h.id),this.ruleSelectedService.setRuleHeightRecalculate(l);let v=e.getClusterId();this.dispatchFwStatusUpdateAction(v,t),Promise.resolve()}catch{Promise.reject()}})}deleteObjectFromPosition(e,t,n,l,o,a){let u={};u=this.buildRemoveApiData(a,o),u!==a&&(this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcDhcpPolicyService.updateDhcpPolicyRule.bind(this.fwcDhcpPolicyService),e,n,l,u).then(()=>{this.removeObjectFromPosition(o,a),this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("DHCP.SUCCESS.UPDATE_RULE")}),this.dispatchFwStatusUpdateAction(t,e),this.dispatchReloadItemEditingPanels(),this.ruleSelectedService.setRuleHeightRecalculate(l)}).catch(d=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(d)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()}))}addObjectToPosition(e,t){let n={cluster_id:t._fwcClusterId,cluster_name:t._fwcClusterName,firewall_id:t._fwcFwId,firewall_name:t._fwcFwName,host_id:t._fwcHostId,host_name:t._fwcHostName,id:t._fwcObjId,id_obj:t._fwcObjId,name:t._fwcObjName,obj_type:t._fwcObjType,parent_id:t.parent_id,position:e.id,position_order:e.ipobjs?e.ipobjs.length:1,rule:e.rule,type:t._fwcObjType,_fwcFwId:t._fwcFwId,_fwcFwName:t._fwcFwName,_fwcObjId:t._fwcObjId,_fwcObjName:t._fwcObjName,_fwcObjType:t._fwcObjType,_fwcPositionId:e.id,_fwcRuleId:e.rule,_fwcUserId:this.fwcUserService.getActualFwcUser().user_id,highlighted:t.highlighted};e.id!==Me.DNS&&e.id!==Me.INTERFACE?e.ipobjs=[...e.ipobjs.filter(l=>l.obj_type!==n.obj_type),n]:e.id!==Me.DNS&&e.id===Me.INTERFACE?e.ipobjs=[...e.ipobjs.filter(l=>l.obj_type!==I.OBJ_INTERFACE_FIREWALL&&l.obj_type!==I.OBJ_INTERFACE_HOST),n]:e.ipobjs=[...e.ipobjs,n]}showNewRuleDialog(e,t,n,l,o,a,u){let d=this.utilService.createDynamicComponentRef(Ml),h=d.instance;h.setDynamicComponentRef(d),h.showNewRuleDialog(e,t,n,l)}moveSelectedRules(e,t,n,l,o){this.store.dispatch(lt.requestBlockUI()),this.utilService.fwcAPICall(this.fwcDhcpPolicyService.manageDhcpPolicyRules.bind(this.fwcDhcpPolicyService),e,t,n,o,l,de.CUT).then(()=>{this.fwcPolicyService.reloadPolicy()}).catch(()=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.translate.instant("GLOBALS.MSG_OP_RESULT.PROCESS_ERROR")})}).finally(()=>{this.store.dispatch(lt.requestUnblockUI())})}newDhcpRuleGroup(e,t,n){let l=n&&n.groupName,o=n&&n.groupComment;if(l){let u=this.ruleSelectedService.getActualSelectedRules().map(d=>d.id);this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcDhcpPolicyService.newDhcpPolicyRuleGroup.bind(this.fwcDhcpPolicyService),e,t,l,o,u).then(()=>{this.dispatchReloadItemPanelAction(),this.fwcPolicyService.reloadPolicy()}).catch(d=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(d)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}else return}compileSelectedRules(){this.compileRules()}resolveFirewallApplyToId(e){let t=["firewallApplyToId","firewallApplyTo","fw_apply_to"];for(let n of t){let l=e[n],o=this.normalizeApplyToCandidate(l);if(o!==void 0)return o}if(e&&typeof e.firewall=="object"&&e.firewall!==null){let n=this.normalizeApplyToCandidate(e.firewall.id);if(n!==void 0)return n}return null}normalizeApplyToCandidate(e){if(e===void 0)return;if(e===null)return null;if(typeof e=="object")return"id"in e?this.normalizeApplyToCandidate(e.id):void 0;let t=typeof e=="number"?e:Number(e);return Number.isNaN(t)?void 0:t}};s.\u0275fac=function(t){return new(t||s)(G(ue),G(be),G(me),G(ge),G(fe),G(ye),G($e),G(wi),G(Ue),G(Ee),G(Le),G(we),G(Se))},s.\u0275prov=De({token:s,factory:s.\u0275fac,providedIn:"root"});let r=s;return r})();var rr=(()=>{let s=class s{constructor(e,t,n,l,o,a,u,d,h,S){this.translate=e,this.fwcErrorPipe=t,this.utilService=n,this.fwcUserService=l,this.fwcPolicyService=o,this.fwcKeepalivedPolicyService=a,this.ruleSelectedService=u,this.messageService=d,this.cd=h,this.store=S}setGroupValues(e){if(e){let t=e.groupData,n=e.group,l=e.policyType,o={style:e.groupColor,name:e.groupName};this.updateGroup(l,t.firewall,t.fwcloud,n,o)}}updateGroup(e,t,n,l,o){let a;e===$[q.KEEPALIVED]&&(a=this.fwcKeepalivedPolicyService.updateKeepalivedPolicyRuleGroup.bind(this.fwcKeepalivedPolicyService)),a&&(this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(a,t,n,l.idgroup,o).then(()=>{if(o.name){l.group_name=o.name;let u=l.rules;for(let d=0;d<u.length;d++)u[d].group_name=l.group_name}if(o.style){l.group_style=o.style;let u=l.rules;for(let d=0;d<u.length;d++)u[d].group_style=l.group_style}l=ot(l)}).catch(u=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(u)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()}))}compileRules(e){let t,n,l,o=this.ruleSelectedService.getActualSelectedRules(),a=this.ruleSelectedService.getRulesOrderedIds(o),u;if(Array.isArray(a.orderedRules)&&a.orderedRules[0]){u=a.orderedRules[0],t=this.fwcUserService.getActualFwcUser().selectedFwCloud,n=u.firewall,l=a.rulesIds;let d=this.fwcKeepalivedPolicyService.compileKeepalivedPolicyRules.bind(this.fwcKeepalivedPolicyService),h=[n,t,l],S=this.translate.instant("KEEPALIVED.POLICY.RULE"),v=this.translate.instant("KEEPALIVED.POLICY.COMPILE_DIALOG_TITLE");e&&(d=this.fwcKeepalivedPolicyService.compileKeepalivedPolicyRules.bind(this.fwcKeepalivedPolicyService),h=[n,t,e,l],S=this.translate.instant("KEEPALIVED.NEW_RULE_PANEL.RULE"),v=this.translate.instant("KEEPALIVED.RULE.COMPILE_DIALOG_TITLE")),this.ruleSelectedService.setRuleStatus(""),this.detectChanges(),this.utilService.fwcAPICall(d,...h).then(b=>{if(Array.isArray(b.data)){let T=this.utilService.createDynamicComponentRef(qt),A=T.instance;A.setDynamicComponentRef(T),A.showCompilationData(b.data,o,S,v,void 0,void 0)}}).catch(b=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(b)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}}filterIpObjects(e,t){let n=[];return Array.isArray(e)&&(n=e.filter(t).map(l=>({id:l.id,order:l.position_order}))),n}buildCopyApiData(e,t){let n={},l,o,a=e._fwcObjId,u=e._fwcObjType,d=t.ipobjs;switch(u){case I.OBJ_INTERFACE_FIREWALL:l=this.filterIpObjects(d,h=>h._fwcObjType===I.OBJ_INTERFACE_FIREWALL)[0],o="interfaceId";break;case I.OBJ_ADDRESS:l=this.filterIpObjects(d,h=>h._fwcObjType===I.OBJ_ADDRESS),o="virtualIpsIds";break;case I.OBJ_FIREWALL:l=this.filterIpObjects(d,h=>h._fwcObjType===I.OBJ_FIREWALL)[0],o="masterNodeId";break}return n[o]=u===I.OBJ_ADDRESS?[...(Array.isArray(l)?l:[l]).filter(h=>h.id!==a),{id:a,order:d?d.length:1}]:a,l&&this.buildRemoveApiData(Array.isArray(l)?l[0]:l,t),n}buildRemoveApiData(e,t){let n={},l,o,a=t.ipobjs,u=e._fwcObjId,d=e._fwcObjType;switch(d===void 0&&t.ipobjs[0]._fwcObjType===I.OBJ_INTERFACE_FIREWALL&&(d=t.ipobjs[0]._fwcObjType,u=t.ipobjs[0]._fwcObjId),d){case I.OBJ_INTERFACE_FIREWALL:return this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.translate.instant("KEEPALIVED.POLICY.ERROR_INTERFACE_DELETE")}),e;case I.OBJ_ADDRESS:l=this.filterIpObjects(a,h=>h._fwcObjType===I.OBJ_ADDRESS&&h._fwcObjId!==u)[0],o="virtualIpsIds";break;case I.OBJ_FIREWALL:return this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.translate.instant("KEEPALIVED.POLICY.ERROR_MASTERNODE_DELETE")}),e}return n[o]=Array.isArray(l)?[...l]:l,n}removeObjectFromPosition(e,t){if(Array.isArray(e.ipobjs)){e.ipobjs=e.ipobjs.filter(n=>n._fwcObjId!==t._fwcObjId||n._fwcObjType!==t._fwcObjType);for(let n of e.ipobjs)n.position_order!=null&&n.position_order>t.position_order&&n.position_order--}}dispatchFwStatusUpdateAction(e,t){this.store.dispatch(rt.updateFwStatus({item:{cluster:e,id:t,status:3}}))}dispatchReloadItemPanelAction(){this.store.dispatch(Ce.reloadDialog({dialogUuids:[Z.ITEM_PANEL]}))}dispatchReloadItemEditingPanels(){this.store.dispatch(Ce.reloadDialog({dialogUuids:[Z.ITEM_PANEL,Z.CLUSTER_PANEL,Z.FIREWALL_PANEL,Z.OVCONFIG_PANEL,Z.WIREGUARD_CONFIG_PANEL,Z.IPSEC_CONFIG_PANEL]}))}detectChanges(){this.cd.destroyed||(this.cd.markForCheck(),this.cd.detectChanges())}};s.\u0275fac=function(t){return new(t||s)(G(ue),G(be),G(me),G(ge),G(ye),G(zi),G(Ue),G(Ee),G(we),G(Se))},s.\u0275prov=De({token:s,factory:s.\u0275fac,providedIn:"root"});let r=s;return r})();var Vn=(()=>{let s=class s extends rr{constructor(e,t,n,l,o,a,u,d,h,S,v,b){super(e,t,n,l,o,a,d,h,v,b),this.translate=e,this.fwcErrorPipe=t,this.utilService=n,this.fwcUserService=l,this.fwcPolicyService=o,this.fwcKeepalivedPolicyService=a,this.fwcInterfaceService=u,this.ruleSelectedService=d,this.messageService=h,this.confirmationService=S,this.cd=v,this.store=b}parseKeepalivedPolicyRules(e,t,n){let l=[];for(let o of n){o.group&&(o.keepalivedGroup=o.group);let a=o.rule_type,u=this.resolveFirewallApplyToId(o),d={id:o.id,idgroup:o.group&&o.keepalivedGroup.id,group_name:o.group&&o.keepalivedGroup.name,group_style:o.group&&o.keepalivedGroup.style,comment:o.comment,style:o.style,type:$[q.KEEPALIVED],cfg_text:a===2?o.cfg_text:null,special:a===2?6:null,rule_order:o.rule_order,active:o.active?1:0,firewall:e,fwcloud:t,fw_apply_to:u,positions:[]},h=1,S={id:We.INTERFACE,rule:o.id,ipobjs:[],content:"O",name:this.translate.instant("POLICY_GRID.RULES.INTERFACE"),policy_type:d.type,position_order:h++,single_object:0,fwcloud:t,firewall:e};if(o.interface){let T={rule:o.id,position:We.INTERFACE,id:o.interface.id,name:o.interface.name,type:o.interface.type,position_order:1,firewall_id:o.interface.firewall?o.interface.firewall.id:null,firewall_name:o.interface.firewall?o.interface.firewall.name:null,cluster_id:o.interface.firewall&&o.interface.firewall.cluster?o.interface.firewall.cluster.id:null,cluster_name:o.interface.firewall&&o.interface.firewall.cluster?o.interface.firewall.cluster.name:null,fwcloud:t};S.ipobjs.push(T)}let v={id:We.VIRTUAL_IPS,rule:o.id,ipobjs:[],content:"O",name:this.translate.instant("POLICY_GRID.RULES.VIRTUAL_IPS"),policy_type:d.type,position_order:h++,single_object:0,fwcloud:t,firewall:e};if(Array.isArray(o.items))for(let A of o.items){let N={rule:o.id,position:We.VIRTUAL_IPS,id:A.id,name:A.name,type:A.type,position_order:1,firewall_id:A.firewall_id?A.firewall_id:null,firewall_name:A.firewall_name?A.firewall_name:null,cluster_id:A.cluster_id?A.cluster_id:null,cluster_name:A.cluster_name?A.cluster_name:null,host_id:A.host_id?A.host_id:null,host_name:A.host_name?A.host_name:null};v.ipobjs.push(N)}let b={id:We.MASTER_NODE,rule:o.id,ipobjs:[],content:"O",name:this.translate.instant("POLICY_GRID.RULES.MASTER_NODE"),policy_type:d.type,position_order:h++,single_object:0,fwcloud:t,firewall:e};if(o.masterNode){let T={rule:o.id,position:We.MASTER_NODE,id:o.masterNode.id,name:o.masterNode.name,type:I.OBJ_FIREWALL,position_order:1};b.ipobjs.push(T)}d.positions.push(S,v,b),l.push(d)}return l}updateSelectedRules(e,t,n,l){let o=this.ruleSelectedService.getActualSelectedRules(),a=!!Object.keys(l).length;if(Array.isArray(o)&&o.length){let u=o.map(d=>d.id);this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcKeepalivedPolicyService.updateKeepalivedPolicyRules.bind(this.fwcKeepalivedPolicyService),t,n,u,l).then(()=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("KEEPALIVED.SUCCESS.UPDATE_RULE")}),this.fwcPolicyService.reloadPolicy(),a&&this.dispatchFwStatusUpdateAction(e,t)}).catch(d=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(d)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null)})}}handleChangeApplyToGroup(e){if(e&&e.formModel){let t=e.firewall,n=e.fwcloud,l={firewallApplyToId:e.formModel.fw_apply_to};this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcKeepalivedPolicyService.updateKeepalivedPolicyRule.bind(this.fwcKeepalivedPolicyService),t,n,e.id,l).then(()=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("KEEPALIVED.SUCCESS.UPDATE_RULE")}),e.fw_apply_to=e.formModel.fw_apply_to,this.dispatchFwStatusUpdateAction(e._fwcClusterId,e.firewall),this.dispatchReloadItemEditingPanels(),this.detectChanges()}).catch(o=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(o)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}}updateRuleCfgText(e){if(e&&e.formModel){let t=e.formModel.cfg_text;if(e.cfg_text!==t){let n=e.firewall,l=e.fwcloud,o={cfg_text:t};this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcKeepalivedPolicyService.updateKeepalivedPolicyRule.bind(this.fwcKeepalivedPolicyService),n,l,e.id,o).then(()=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("ROUTING.SUCCESS.UPDATE_RULE")}),e.cfg_text=t,this.dispatchFwStatusUpdateAction(e._fwcClusterId,n)}).catch(a=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(a)}),e.formModel.cfg_text=e.cfg_text}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}}}updateRuleComment(e){if(e&&e.formModel){let t=e.formModel.comment;if(e.comment!==t){let n=e.firewall,l=e.fwcloud,o={comment:t};this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcKeepalivedPolicyService.updateKeepalivedPolicyRule.bind(this.fwcKeepalivedPolicyService),n,l,e.id,o).then(()=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("ROUTING.SUCCESS.UPDATE_RULE")}),e.comment=t,this.dispatchFwStatusUpdateAction(e._fwcClusterId,n)}).catch(a=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(a)}),e.formModel.comment=e.comment}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}}}setRuleStyle(e,t){if(t){let n={style:t.ruleColor};this.updateSelectedRules(e._fwcClusterId,e.firewall,this.fwcUserService.getActualFwSelectedCloud(),n)}}updateRulePosition(e,t,n,l,o,a,u){return le(this,null,function*(){let d={},h=a._fwcPositionId,S=a._fwcRuleId,v=this.checkOperation(e,a,u);if(v)this.confirmationService.confirm({header:this.translate.instant("POSITION.ERROR_HEADER"),icon:"fa fa-exclamation-circle fwcRed iconBig",message:v,rejectVisible:!1,acceptLabel:"Ok",accept:()=>{}});else{let b=e.getClusterId();if(a&&a.obj_type===I.OBJ_FIREWALL){if(a.position===We.MASTER_NODE){this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.translate.instant("KEEPALIVED.POLICY.ERROR_MASTER_NODE")});return}if(a.cluster_id!==b){this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.translate.instant("KEEPALIVED.POLICY.ERROR_CLUSTER_NODES")});return}}h==null||S==null||u==de.COPY?(d=this.buildCopyApiData(a,o),this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcKeepalivedPolicyService.updateKeepalivedPolicyRule.bind(this.fwcKeepalivedPolicyService),t,n,l,d).then(()=>{this.addObjectToPosition(o,a),this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("KEEPALIVED.SUCCESS.UPDATE_RULE")}),this.dispatchFwStatusUpdateAction(b,t),this.dispatchReloadItemEditingPanels(),this.ruleSelectedService.setRuleHeightRecalculate(l)}).catch(T=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(T)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})):(this.ruleSelectedService.setRuleStatus(""),this.moveObject(e,t,n,l,o,a).then(()=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("KEEPALIVED.SUCCESS.UPDATE_RULE")})}).catch(T=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(T)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()}))}})}checkOperation(e,t,n){let l;return t._fwcRuleId&&t._fwcPositionId&&(n===de.CUT||n===de.DELETE)&&e.getPolicyRule(t._fwcRuleId).positions.find(d=>d.id===t._fwcPositionId).ipobjs.filter(d=>d._fwcObjType!==I.OBJ_ANY).length<2&&(l=this.translate.instant("KEEPALIVED.POLICY.ERROR_LAST_IPOBJECT")),l}moveObject(e,t,n,l,o,a){return le(this,null,function*(){try{let u,d;switch(a._fwcObjType){case I.OBJ_GROUP:{u="ipObjGroupId";break}case I.OBJ_MARK:{u="markId";break}default:{u="ipObjId";break}}let h=e.getPolicyRule(a._fwcRuleId),S=h.positions.find(b=>b.id===a._fwcPositionId);if(a._fwcPositionId!==We.VIRTUAL_IPS)return Promise.reject(this.translate.instant("KEEPALIVED.POLICY.ERROR_MOVING_POSITION"));d={fromId:h.id,toId:l},d[u]=a._fwcObjId,yield this.utilService.fwcAPICall(this.fwcKeepalivedPolicyService.moveObjectBetweenPositions.bind(this.fwcKeepalivedPolicyService),t,n,d),this.addObjectToPosition(o,a),this.removeObjectFromPosition(S,a),this.dispatchReloadItemEditingPanels(),this.ruleSelectedService.setRuleHeightRecalculate(h.id),this.ruleSelectedService.setRuleHeightRecalculate(l);let v=e.getClusterId();this.dispatchFwStatusUpdateAction(v,t),Promise.resolve()}catch{Promise.reject()}})}deleteObjectFromPosition(e,t,n,l,o,a){let u={};u=this.buildRemoveApiData(a,o),u!==a&&(this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcKeepalivedPolicyService.updateKeepalivedPolicyRule.bind(this.fwcKeepalivedPolicyService),e,n,l,u).then(()=>{this.removeObjectFromPosition(o,a),this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("KEEPALIVED.SUCCESS.UPDATE_RULE")}),this.dispatchFwStatusUpdateAction(t,e),this.dispatchReloadItemEditingPanels(),this.ruleSelectedService.setRuleHeightRecalculate(l)}).catch(d=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(d)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()}))}addObjectToPosition(e,t){let n={cluster_id:t._fwcClusterId,cluster_name:t._fwcClusterName,firewall_id:t._fwcFwId,firewall_name:t._fwcFwName,host_id:t._fwcHostId,host_name:t._fwcHostName,id:t._fwcObjId,id_obj:t._fwcObjId,name:t._fwcObjName,obj_type:t._fwcObjType,parent_id:t.parent_id,position:e.id,position_order:e.ipobjs?e.ipobjs.length:1,rule:e.rule,type:t._fwcObjType,_fwcFwId:t._fwcFwId,_fwcFwName:t._fwcFwName,_fwcObjId:t._fwcObjId,_fwcObjName:t._fwcObjName,_fwcObjType:t._fwcObjType,_fwcPositionId:e.id,_fwcRuleId:e.rule,_fwcUserId:this.fwcUserService.getActualFwcUser().user_id,highlighted:t.highlighted};e.id!==We.VIRTUAL_IPS&&e.id!==We.INTERFACE?e.ipobjs=[...e.ipobjs.filter(l=>l.obj_type!==n.obj_type),n]:e.id!==We.INTERFACE&&e.id===We.VIRTUAL_IPS?e.ipobjs=[...e.ipobjs.filter(l=>l.obj_type!==I.OBJ_INTERFACE_FIREWALL),n]:e.id===We.INTERFACE?e.ipobjs=[...e.ipobjs.filter(l=>l.obj_type!==I.OBJ_INTERFACE_FIREWALL),n]:e.ipobjs=[...e.ipobjs,n]}showNewRuleDialog(e,t,n,l,o,a,u){let d=this.utilService.createDynamicComponentRef(Dl),h=d.instance;h.setDynamicComponentRef(d),h.showNewRuleDialog(e,t,n,l)}moveSelectedRules(e,t,n,l,o){this.store.dispatch(lt.requestBlockUI()),this.utilService.fwcAPICall(this.fwcKeepalivedPolicyService.manageKeepalivedPolicyRules.bind(this.fwcKeepalivedPolicyService),e,t,n,o,l,de.CUT).then(()=>{this.fwcPolicyService.reloadPolicy()}).catch(()=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.translate.instant("GLOBALS.MSG_OP_RESULT.PROCESS_ERROR")})}).finally(()=>{this.store.dispatch(lt.requestUnblockUI())})}newKeepalivedRuleGroup(e,t,n){let l=n&&n.groupName,o=n&&n.groupComment;if(l){let u=this.ruleSelectedService.getActualSelectedRules().map(d=>d.id);this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcKeepalivedPolicyService.newKeepalivedPolicyRuleGroup.bind(this.fwcKeepalivedPolicyService),e,t,l,o,u).then(()=>{this.dispatchReloadItemPanelAction(),this.fwcPolicyService.reloadPolicy()}).catch(d=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(d)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}else return}compileSelectedRules(){this.compileRules()}resolveFirewallApplyToId(e){let t=["firewallApplyToId","firewallApplyTo","fw_apply_to"];for(let n of t){let l=e[n],o=this.normalizeApplyToCandidate(l);if(o!==void 0)return o}if(e&&typeof e.firewall=="object"&&e.firewall!==null){let n=this.normalizeApplyToCandidate(e.firewall.id);if(n!==void 0)return n}return null}normalizeApplyToCandidate(e){if(e===void 0)return;if(e===null)return null;if(typeof e=="object")return"id"in e?this.normalizeApplyToCandidate(e.id):void 0;let t=typeof e=="number"?e:Number(e);return Number.isNaN(t)?void 0:t}};s.\u0275fac=function(t){return new(t||s)(G(ue),G(be),G(me),G(ge),G(ye),G(zi),G($e),G(Ue),G(Ee),G(Le),G(we),G(Se))},s.\u0275prov=De({token:s,factory:s.\u0275fac,providedIn:"root"});let r=s;return r})();var sr=(()=>{let s=class s{constructor(e,t,n,l,o,a,u,d,h,S){this.translate=e,this.fwcErrorPipe=t,this.utilService=n,this.fwcUserService=l,this.fwcPolicyService=o,this.fwcHAProxyPolicyService=a,this.ruleSelectedService=u,this.messageService=d,this.cd=h,this.store=S}setGroupValues(e){if(e){let t=e.groupData,n=e.group,l=e.policyType,o={style:e.groupColor,name:e.groupName};this.updateGroup(l,t.firewall,t.fwcloud,n,o)}}updateGroup(e,t,n,l,o){let a;e===$[q.HAPROXY]&&(a=this.fwcHAProxyPolicyService.updateHAProxyPolicyRuleGroup.bind(this.fwcHAProxyPolicyService)),a&&(this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(a,t,n,l.idgroup,o).then(()=>{if(o.name){l.group_name=o.name;let u=l.rules;for(let d=0;d<u.length;d++)u[d].group_name=l.group_name}if(o.style){l.group_style=o.style;let u=l.rules;for(let d=0;d<u.length;d++)u[d].group_style=l.group_style}l=ot(l)}).catch(u=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(u)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()}))}compileRules(e){let t,n,l,o=this.ruleSelectedService.getActualSelectedRules(),a=this.ruleSelectedService.getRulesOrderedIds(o),u;if(Array.isArray(a.orderedRules)&&a.orderedRules[0]){u=a.orderedRules[0],t=this.fwcUserService.getActualFwcUser().selectedFwCloud,n=u.firewall,l=a.rulesIds;let d=this.fwcHAProxyPolicyService.compileHAProxyPolicyRules.bind(this.fwcHAProxyPolicyService),h=[n,t,l],S=this.translate.instant("HAPROXY.POLICY.RULE"),v=this.translate.instant("HAPROXY.POLICY.COMPILE_DIALOG_TITLE");e&&(d=this.fwcHAProxyPolicyService.compileHAProxyPolicyRules.bind(this.fwcHAProxyPolicyService),h=[n,t,e,l],S=this.translate.instant("HAPROXY.NEW_RULE_PANEL.RULE"),v=this.translate.instant("HAPROXY.RULE.COMPILE_DIALOG_TITLE")),this.ruleSelectedService.setRuleStatus(""),this.detectChanges(),this.utilService.fwcAPICall(d,...h).then(b=>{if(Array.isArray(b.data)){let T=this.utilService.createDynamicComponentRef(qt),A=T.instance;A.setDynamicComponentRef(T),A.showCompilationData(b.data,o,S,v,void 0,void 0)}}).catch(b=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(b)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}}filterIpObjects(e,t){let n=[];return Array.isArray(e)&&(n=e.filter(t).map(l=>({id:l.id,order:l.position_order}))),n}buildCopyApiData(e,t){let n={},l,o,a=e._fwcObjId,u=e._fwcObjType,d=t.ipobjs;switch(u){case I.OBJ_ADDRESS:t.id===Ae.FRONTEND_IP?(l=this.filterIpObjects(d,h=>h._fwcObjType===I.OBJ_ADDRESS)[0],o="frontendIpId"):t.id===Ae.BACKEND_IPS&&(l=this.filterIpObjects(d,h=>h._fwcObjType===I.OBJ_ADDRESS),o="backendIpsIds");break;case I.OBJ_SERVICE_TCP:case I.OBJ_SERVICE_UDP:t.id===Ae.FRONTEND_PORT?(l=this.filterIpObjects(d,h=>h._fwcObjType===I.OBJ_SERVICE_UDP||h._fwcObjType===I.OBJ_SERVICE_TCP)[0],o="frontendPortId"):t.id===Ae.BACKEND_PORT&&(l=this.filterIpObjects(d,h=>h._fwcObjType===I.OBJ_SERVICE_UDP||h._fwcObjType===I.OBJ_SERVICE_TCP)[0],o="backendPortId");break}return n[o]=Array.isArray(l)?[...l,{id:a,order:d?d.length:1}]:a,l&&!Array.isArray(l)&&this.buildRemoveApiData(l,t),n}buildRemoveApiData(e,t){let n={},l,o,a=e._fwcObjId,u=t.ipobjs;switch(e._fwcObjType){case I.OBJ_ADDRESS:if(t.id===Ae.BACKEND_IPS){if(l=this.filterIpObjects(u,h=>h._fwcObjType===I.OBJ_ADDRESS&&h._fwcObjId!==a),!l||l.length===0)return this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.ERROR"),detail:this.translate.instant("GLOBALS.MSG_OBJ_DELETE.BACKEND_IP")}),e;o="backendIpsIds";break}else return this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.ERROR"),detail:this.translate.instant("GLOBALS.MSG_OBJ_DELETE.FRONTEND_IP")}),e;case I.OBJ_SERVICE_TCP:case I.OBJ_SERVICE_UDP:return t.id===Ae.FRONTEND_PORT?this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.ERROR"),detail:this.translate.instant("GLOBALS.MSG_OBJ_DELETE.FRONTEND_PORT")}):t.id===Ae.BACKEND_PORT&&this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.ERROR"),detail:this.translate.instant("GLOBALS.MSG_OBJ_DELETE.BACKEND_PORT")}),e}return n[o]=Array.isArray(l)?[...l]:l,n}removeObjectFromPosition(e,t){if(Array.isArray(e.ipobjs)){e.ipobjs=e.ipobjs.filter(n=>n._fwcObjId!==t._fwcObjId||n._fwcObjType!==t._fwcObjType);for(let n of e.ipobjs)n.position_order!=null&&n.position_order>t.position_order&&n.position_order--}}dispatchFwStatusUpdateAction(e,t){this.store.dispatch(rt.updateFwStatus({item:{cluster:e,id:t,status:3}}))}dispatchReloadItemPanelAction(){this.store.dispatch(Ce.reloadDialog({dialogUuids:[Z.ITEM_PANEL]}))}dispatchReloadItemEditingPanels(){this.store.dispatch(Ce.reloadDialog({dialogUuids:[Z.ITEM_PANEL,Z.CLUSTER_PANEL,Z.FIREWALL_PANEL,Z.OVCONFIG_PANEL,Z.WIREGUARD_CONFIG_PANEL,Z.IPSEC_CONFIG_PANEL]}))}detectChanges(){this.cd.destroyed||(this.cd.markForCheck(),this.cd.detectChanges())}};s.\u0275fac=function(t){return new(t||s)(G(ue),G(be),G(me),G(ge),G(ye),G(qi),G(Ue),G(Ee),G(we),G(Se))},s.\u0275prov=De({token:s,factory:s.\u0275fac,providedIn:"root"});let r=s;return r})();var Wn=(()=>{let s=class s extends sr{constructor(e,t,n,l,o,a,u,d,h,S,v){super(e,t,n,l,o,a,u,d,S,v),this.translate=e,this.fwcErrorPipe=t,this.utilService=n,this.fwcUserService=l,this.fwcPolicyService=o,this.fwcHAProxyPolicyService=a,this.ruleSelectedService=u,this.messageService=d,this.confirmationService=h,this.cd=S,this.store=v}parseHAProxyPolicyRules(e,t,n){let l=[];for(let o of n){o.group&&(o.HAProxyGroup=o.group);let a=o.rule_type,u=this.resolveFirewallApplyToId(o),d={id:o.id,idgroup:o.group&&o.HAProxyGroup.id,group_name:o.group&&o.HAProxyGroup.name,group_style:o.group&&o.HAProxyGroup.style,comment:o.comment,style:o.style,type:$[q.HAPROXY],cfg_text:a===2?o.cfg_text:null,special:a===2?6:null,rule_order:o.rule_order,active:o.active?1:0,firewall:e,fwcloud:t,fw_apply_to:u,positions:[]},h=1,S={id:Ae.FRONTEND_IP,rule:o.id,ipobjs:[],content:"O",name:this.translate.instant("POLICY_GRID.RULES.HAPROXY_FRONTEND_IP"),policy_type:d.type,position_order:h++,single_object:0,fwcloud:t,firewall:e};if(o.frontendIp){let A={rule:o.id,position:Ae.FRONTEND_IP,id:o.frontendIp.id,name:o.frontendIp.name,type:o.frontendIp.ipObjTypeId,position_order:1,if_id:o.frontendIp.interface?o.frontendIp.interface.id:null,if_name:o.frontendIp.interface?o.frontendIp.interface.name:null,firewall_id:o.frontendIp.interface&&o.frontendIp.interface.firewall?o.frontendIp.interface.firewall.id:null,firewall_name:o.frontendIp.interface&&o.frontendIp.interface.firewall?o.frontendIp.interface.firewall.name:null,cluster_id:o.frontendIp.interface&&o.frontendIp.interface.firewall&&o.frontendIp.interface.firewall.cluster?o.frontendIp.interface.firewall.cluster.id:null,cluster_name:o.frontendIp.interface&&o.frontendIp.interface.firewall&&o.frontendIp.interface.firewall.cluster?o.frontendIp.interface.firewall.cluster.name:null,host_id:o.frontendIp.interface&&o.frontendIp.interface.hosts&&o.frontendIp.interface.hosts.length>0&&o.frontendIp.interface.hosts[0].hostIPObj?o.frontendIp.interface.hosts[0].hostIPObj.id:null,host_name:o.frontendIp.interface&&o.frontendIp.interface.hosts&&o.frontendIp.interface.hosts.length>0&&o.frontendIp.interface.hosts[0].hostIPObj?o.frontendIp.interface.hosts[0].hostIPObj.name:null};S.ipobjs.push(A)}let v={id:Ae.FRONTEND_PORT,rule:o.id,ipobjs:[],content:"O",name:this.translate.instant("POLICY_GRID.RULES.HAPROXY_FRONTEND_PORT"),policy_type:d.type,position_order:h++,single_object:0,fwcloud:t,firewall:e};if(o.frontendPort){let A={rule:o.id,position:Ae.FRONTEND_PORT,id:o.frontendPort.id,name:o.frontendPort.name,type:o.frontendPort.ipObjTypeId,position_order:1};v.ipobjs.push(A)}let b={id:Ae.BACKEND_IPS,rule:o.id,ipobjs:[],content:"O",name:this.translate.instant("POLICY_GRID.RULES.HAPROXY_BACKEND_IPS"),policy_type:d.type,position_order:h++,single_object:0,fwcloud:t,firewall:e};if(Array.isArray(o.items))for(let N of o.items){let j={rule:o.id,position:Ae.BACKEND_IPS,id:N.id,name:N.name,type:N.type,position_order:1,if_id:N.interface?N.interface.id:null,if_name:N.interface?N.interface.name:null,firewall_id:N.firewall_id?N.firewall_id:null,firewall_name:N.firewall_name?N.firewall_name:null,cluster_id:N.cluster_id?N.cluster_id:null,cluster_name:N.cluster_name?N.cluster_name:null,host_id:N.host_id?N.host_id:null,host_name:N.host_name?N.host_name:null};b.ipobjs.push(j)}let T={id:Ae.BACKEND_PORT,rule:o.id,ipobjs:[],content:"O",name:this.translate.instant("POLICY_GRID.RULES.HAPROXY_BACKEND_PORT"),policy_type:d.type,position_order:h++,single_object:0,fwcloud:t,firewall:e};if(o.backendPort){let A={rule:o.id,position:Ae.BACKEND_PORT,id:o.backendPort.id,name:o.backendPort.name,type:o.backendPort.ipObjTypeId,position_order:1};T.ipobjs.push(A)}d.positions.push(S,v,b,T),l.push(d)}return l}updateRule(e,t,n,l,o,a,u){this.ruleSelectedService.setRuleStatus("");let d={},h=!1;o&&(d.comment=o,h=!0),a&&(d.style=a,h=!0),u!==void 0&&(d.active=u,h=!0),this.utilService.fwcAPICall(this.fwcHAProxyPolicyService.updateHAProxyPolicyRule.bind(this.fwcHAProxyPolicyService),t,n,l.id,d).then(S=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("HAPROXY.SUCCESS.UPDATE_RULE")}),this.fwcPolicyService.reloadPolicy(),h&&this.dispatchFwStatusUpdateAction(e,t)}).catch(S=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(S)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null)})}updateSelectedRules(e,t,n,l){let o=this.ruleSelectedService.getActualSelectedRules(),a=!!Object.keys(l).length;if(Array.isArray(o)&&o.length){let u=o.map(d=>d.id);this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcHAProxyPolicyService.updateHAProxyPolicyRules.bind(this.fwcHAProxyPolicyService),t,n,u,l).then(d=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("HAPROXY.SUCCESS.UPDATE_RULE")}),this.fwcPolicyService.reloadPolicy(),a&&this.dispatchFwStatusUpdateAction(e,t)}).catch(d=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(d)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null)})}}updateRuleComment(e){if(e&&e.formModel){let t=e.formModel.comment;if(e.comment!==t){let n=e.firewall,l=e.fwcloud,o={comment:t};this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcHAProxyPolicyService.updateHAProxyPolicyRule.bind(this.fwcHAProxyPolicyService),n,l,e.id,o).then(a=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("ROUTING.SUCCESS.UPDATE_RULE")}),e.comment=t,this.dispatchFwStatusUpdateAction(e._fwcClusterId,n)}).catch(a=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(a)}),e.formModel.comment=e.comment}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}}}updateRuleCfgText(e){if(e&&e.formModel){let t=e.formModel.cfg_text;if(e.cfg_text!==t){let n=e.firewall,l=e.fwcloud,o={cfg_text:t};this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcHAProxyPolicyService.updateHAProxyPolicyRule.bind(this.fwcHAProxyPolicyService),n,l,e.id,o).then(()=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("ROUTING.SUCCESS.UPDATE_RULE")}),e.cfg_text=t,this.dispatchFwStatusUpdateAction(e._fwcClusterId,n)}).catch(a=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(a)}),e.formModel.cfg_text=e.cfg_text}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}}}resolveFirewallApplyToId(e){let t=["firewallApplyToId","firewallApplyTo","fw_apply_to"];for(let n of t){let l=e[n],o=this.normalizeApplyToCandidate(l);if(o!==void 0)return o}if(e&&typeof e.firewall=="object"&&e.firewall!==null){let n=this.normalizeApplyToCandidate(e.firewall.id);if(n!==void 0)return n}return null}normalizeApplyToCandidate(e){if(e===void 0)return;if(e===null)return null;if(typeof e=="object")return"id"in e?this.normalizeApplyToCandidate(e.id):void 0;let t=typeof e=="number"?e:Number(e);return Number.isNaN(t)?void 0:t}setRuleStyle(e,t){if(t){let n={style:t.ruleColor};this.updateSelectedRules(e._fwcClusterId,e.firewall,this.fwcUserService.getActualFwSelectedCloud(),n)}}updateRulePosition(e,t,n,l,o,a,u){let d={},h=a._fwcPositionId,S=a._fwcRuleId,v=this.checkOperation(e,a,u);if(v)this.confirmationService.confirm({header:this.translate.instant("POSITION.ERROR_HEADER"),icon:"fa fa-exclamation-circle fwcRed iconBig",message:v,rejectVisible:!1,acceptLabel:"Ok",accept:()=>{}});else{let b=e.getClusterId();if(h==null||S==null||u==de.COPY)d=this.buildCopyApiData(a,o),this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcHAProxyPolicyService.updateHAProxyPolicyRule.bind(this.fwcHAProxyPolicyService),t,n,l,d).then(T=>{this.addObjectToPosition(o,a),this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("HAPROXY.SUCCESS.UPDATE_RULE")}),this.dispatchFwStatusUpdateAction(b,t),this.dispatchReloadItemEditingPanels(),this.ruleSelectedService.setRuleHeightRecalculate(l)}).catch(T=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(T)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()});else{if(a&&(a.obj_type===I.OBJ_ADDRESS&&a.position!=Ae.BACKEND_IPS||a.obj_type!==I.OBJ_ADDRESS)){this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.translate.instant("HAPROXY.POLICY.ERROR_MOVING_POSITION")});return}this.ruleSelectedService.setRuleStatus(""),this.moveObject(e,t,n,l,o,a).then(()=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("HAPROXY.SUCCESS.UPDATE_RULE")})}).catch(T=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(T)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}}}checkOperation(e,t,n){let l;return t._fwcRuleId&&t._fwcPositionId&&(n===de.CUT||n===de.DELETE)&&e.getPolicyRule(t._fwcRuleId).positions.find(d=>d.id===t._fwcPositionId).ipobjs.filter(d=>d._fwcObjType!==I.OBJ_ANY).length<2&&(l=this.translate.instant("HAPROXY.POLICY.ERROR_LAST_IPOBJECT")),l}moveObjectAlt(e,t,n,l,o,a){return le(this,null,function*(){try{let u=this.buildCopyApiData(a,o);yield this.utilService.fwcAPICall(this.fwcHAProxyPolicyService.updateHAProxyPolicyRule.bind(this.fwcHAProxyPolicyService),t,n,l,u);let d=e.getPolicyRule(a._fwcRuleId),h=d.positions.find(b=>b.id===a._fwcPositionId),S=this.buildRemoveApiData(a,h);yield this.utilService.fwcAPICall(this.fwcHAProxyPolicyService.updateHAProxyPolicyRule.bind(this.fwcHAProxyPolicyService),t,n,d.id,S),this.addObjectToPosition(o,a),this.removeObjectFromPosition(h,a),this.ruleSelectedService.setRuleHeightRecalculate(d.id),this.ruleSelectedService.setRuleHeightRecalculate(l),this.dispatchReloadItemEditingPanels();let v=e.getClusterId();this.dispatchFwStatusUpdateAction(v,t),Promise.resolve()}catch{Promise.reject()}})}moveObject(e,t,n,l,o,a){return le(this,null,function*(){try{let u,d;switch(a._fwcObjType){case I.OBJ_GROUP:{u="ipObjGroupId";break}case I.OBJ_MARK:{u="markId";break}default:{u="ipObjId";break}}let h=e.getPolicyRule(a._fwcRuleId),S=h.positions.find(b=>b.id===a._fwcPositionId);if(a._fwcPositionId!==Ae.BACKEND_IPS)return Promise.reject(this.translate.instant("HAPROXY.POLICY.ERROR_MOVING_POSITION"));d={fromId:h.id,toId:l},d[u]=a._fwcObjId,yield this.utilService.fwcAPICall(this.fwcHAProxyPolicyService.moveObjectBetweenPositions.bind(this.fwcHAProxyPolicyService),t,n,d),this.addObjectToPosition(o,a),this.removeObjectFromPosition(S,a),this.dispatchReloadItemEditingPanels(),this.ruleSelectedService.setRuleHeightRecalculate(h.id),this.ruleSelectedService.setRuleHeightRecalculate(l);let v=e.getClusterId();this.dispatchFwStatusUpdateAction(v,t),Promise.resolve()}catch{Promise.reject()}})}deleteObjectFromPosition(e,t,n,l,o,a){let u={};u=this.buildRemoveApiData(a,o),u!==a&&(this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcHAProxyPolicyService.updateHAProxyPolicyRule.bind(this.fwcHAProxyPolicyService),e,n,l,u).then(d=>{this.removeObjectFromPosition(o,a),this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("HAPROXY.SUCCESS.UPDATE_RULE")}),this.dispatchFwStatusUpdateAction(t,e),this.dispatchReloadItemEditingPanels(),this.ruleSelectedService.setRuleHeightRecalculate(l)}).catch(d=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(d)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()}))}addObjectToPosition(e,t){let n={cluster_id:t._fwcClusterId,cluster_name:t._fwcClusterName,firewall_id:t._fwcFwId,firewall_name:t._fwcFwName,host_id:t._fwcHostId,host_name:t._fwcHostName,id:t._fwcObjId,id_obj:t._fwcObjId,name:t._fwcObjName,obj_type:t._fwcObjType,parent_id:t.parent_id,position:e.id,position_order:e.ipobjs?e.ipobjs.length:1,rule:e.rule,type:t._fwcObjType,_fwcFwId:t._fwcFwId,_fwcFwName:t._fwcFwName,_fwcObjId:t._fwcObjId,_fwcObjName:t._fwcObjName,_fwcObjType:t._fwcObjType,_fwcPositionId:e.id,_fwcRuleId:e.rule,_fwcUserId:this.fwcUserService.getActualFwcUser().user_id,highlighted:t.highlighted};e.id===Ae.FRONTEND_PORT||e.id===Ae.BACKEND_PORT?e.ipobjs=[...e.ipobjs.filter(l=>l.obj_type!==I.OBJ_SERVICE_TCP&&l.obj_type!==I.OBJ_SERVICE_UDP),n]:e.id!==Ae.BACKEND_IPS?e.ipobjs=[...e.ipobjs.filter(l=>l.obj_type!==n.obj_type),n]:e.ipobjs=[...e.ipobjs,n]}showNewRuleDialog(e,t,n,l,o,a,u){let d=this.utilService.createDynamicComponentRef(Nl),h=d.instance;h.setDynamicComponentRef(d),h.showNewRuleDialog(e,t,n,l)}moveSelectedRules(e,t,n,l,o){this.store.dispatch(lt.requestBlockUI()),this.utilService.fwcAPICall(this.fwcHAProxyPolicyService.manageHAProxyPolicyRules.bind(this.fwcHAProxyPolicyService),e,t,n,o,l,de.CUT).then(()=>{this.fwcPolicyService.reloadPolicy()}).catch(a=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.translate.instant("GLOBALS.MSG_OP_RESULT.PROCESS_ERROR")})}).finally(()=>{this.store.dispatch(lt.requestUnblockUI())})}newHAProxyRuleGroup(e,t,n){let l=n&&n.groupName,o=n&&n.groupComment;if(l){let u=this.ruleSelectedService.getActualSelectedRules().map(d=>d.id);this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcHAProxyPolicyService.newHAProxyPolicyRuleGroup.bind(this.fwcHAProxyPolicyService),e,t,l,o,u).then(d=>{this.dispatchReloadItemPanelAction(),this.fwcPolicyService.reloadPolicy()}).catch(d=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(d)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}else return}compileSelectedRules(){this.compileRules()}handleChangeApplyToGroup(e){if(e&&e.formModel){let t=e.firewall,n=e.fwcloud,l={firewallApplyToId:e.formModel.fw_apply_to};this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcHAProxyPolicyService.updateHAProxyPolicyRule.bind(this.fwcHAProxyPolicyService),t,n,e.id,l).then(o=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("ROUTING.SUCCESS.UPDATE_RULE")}),e.fw_apply_to=e.formModel.fw_apply_to,this.dispatchFwStatusUpdateAction(e._fwcClusterId,e.firewall),this.dispatchReloadItemEditingPanels(),this.detectChanges()}).catch(o=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(o)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}}};s.\u0275fac=function(t){return new(t||s)(G(ue),G(be),G(me),G(ge),G(ye),G(qi),G(Ue),G(Ee),G(Le),G(we),G(Se))},s.\u0275prov=De({token:s,factory:s.\u0275fac,providedIn:"root"});let r=s;return r})();var Xr=["gridPaginator"],zr=["policyTable"],qr=(r,s,i)=>({$implicit:r,groupHide:s,rowIndex:i}),Qr=(r,s)=>({$implicit:r,groupHide:!1,rowIndex:s}),$r=(r,s,i)=>({first:r,last:s,totalRecords:i}),Zr=()=>({width:"2rem",height:"2rem"}),ea=(r,s,i,e)=>({fwcRuleSelected:r,fwcRuleDisabled:s,fwcRuleHighlighted:i,fwcRuleSpecial:e}),ta=(r,s,i,e)=>({fwcPositionHighlighted:r,draggedOver:s,fwcObjectForbidden:i,fwcObjectAllowed:e}),ia=r=>({divCommentPopup:r});function na(r,s){r&1&&(p(0,"h1",27),O(1,"i",28),C(2),y(3,"translate"),f()),r&2&&(c(2),F(" ",E(3,1,"POLICY_GRID.POL_PANEL"),`
`))}function oa(r,s){r&1&&(Pe(0),O(1,"i",39),C(2,"\xA0 "),p(3,"span",33),C(4,"Cluster:"),f(),Te())}function la(r,s){r&1&&(O(0,"i",40),C(1,"\xA0 "),p(2,"span",33),C(3,"Firewall:"),f())}function ra(r,s){if(r&1){let i=M();p(0,"p-button",41),P("onClick",function(){w(i);let t=_(2);return g(t.settingsSidebar=!0)}),f()}}function aa(r,s){r&1&&wt(0)}function sa(r,s){r&1&&O(0,"div",48)}function ca(r,s){if(r&1){let i=M();p(0,"p-drawer",46),H("visibleChange",function(t){w(i);let n=_(3);return W(n.settingsSidebar,t)||(n.settingsSidebar=t),g(t)}),p(1,"div",47)(2,"div",48)(3,"h5",49),C(4),y(5,"translate"),f()(),p(6,"div",48)(7,"b"),C(8),y(9,"translate"),f(),p(10,"div",50),J(11,sa,1,0,"div",51),p(12,"div",48)(13,"p-checkbox",52),H("ngModelChange",function(t){w(i);let n=_(3);return W(n.columnVisibility.comments,t)||(n.columnVisibility.comments=t),g(t)}),f(),p(14,"label",53),C(15),y(16,"translate"),f()()()()(),p(17,"div",54)(18,"p-button",55),y(19,"translate"),P("onClick",function(){w(i);let t=_(3);return g(t.settingsSidebar=!1)}),f()()()}if(r&2){let i=_(3);V("visible",i.settingsSidebar),m("baseZIndex",1e4),c(4),F(" ",E(5,10,"POLICY_GRID.GRID_SETTINGS")," "),c(4),U(E(9,12,"POLICY_GRID.COLUMN_VISIBILITY")),c(3),m("ngIf",(i.fwcSelectedPolicy==null?null:i.fwcSelectedPolicy._fwcClusterId)!==null&&(i.fwcSelectedPolicy==null?null:i.fwcSelectedPolicy._fwcClusterId)!==void 0&&i.fwcSelectedPolicy._fwcPolicyType!==i.SpecialPolicyTypes.ROUTING_TABLE&&i.fwcSelectedPolicy._fwcPolicyType!==i.SpecialPolicyTypes.POLICY_ROUTING),c(2),V("ngModel",i.columnVisibility.comments),c(2),F("\u2002",E(16,14,"POLICY_GRID.RULES.COMMENT")),c(3),m("label",B(E(19,16,"GLOBALS.MSG_BUTTONS.CLOSE")))("styleClass","p-button-secondary")}}function pa(r,s){r&1&&O(0,"col")}function da(r,s){r&1&&O(0,"col")}function _a(r,s){r&1&&O(0,"col")}function ua(r,s){r&1&&O(0,"col")}function fa(r,s){r&1&&O(0,"col")}function ma(r,s){if(r&1&&(p(0,"colgroup"),O(1,"col"),J(2,pa,1,0,"col",56)(3,da,1,0,"col",45)(4,_a,1,0,"col",45)(5,ua,1,0,"col",45)(6,fa,1,0,"col",45),f()),r&2){let i=_(3);c(),ni("width","3rem"),c(),m("ngForOf",i.fwcPolicyPositions),c(),m("ngIf",(i.fwcSelectedPolicy==null?null:i.fwcSelectedPolicy._fwcPolicyType)===i.SpecialPolicyTypes.POLICY_ROUTING),c(),m("ngIf",i.fwcSelectedPolicy==null?null:i.fwcSelectedPolicy.show_action),c(),m("ngIf",i.columnVisibility.applyTo&&(i.fwcSelectedPolicy==null?null:i.fwcSelectedPolicy._fwcClusterId)!==null&&(i.fwcSelectedPolicy==null?null:i.fwcSelectedPolicy._fwcClusterId)!==void 0),c(),m("ngIf",i.columnVisibility.comments)}}function ha(r,s){if(r&1&&(p(0,"th",62),C(1),f()),r&2){let i=s.$implicit;ni("width",i.name==="Source"||i.name==="Destination"?"20%":""),c(),F(" ",i.name," ")}}function wa(r,s){r&1&&(p(0,"th"),C(1),y(2,"translate"),f()),r&2&&(c(),F(" ",E(2,1,"ROUTING.NEW_TABLE_PANEL.TABLE")," "))}function ga(r,s){r&1&&(p(0,"th",62),C(1),y(2,"translate"),f()),r&2&&(c(),F(" ",E(2,1,"POLICY_GRID.RULES.ACTION")," "))}function Sa(r,s){r&1&&(p(0,"th",63),C(1),y(2,"translate"),f()),r&2&&(c(),F(" ",E(2,1,"POLICY_GRID.RULES.APPLY_TO")," "))}function Ca(r,s){r&1&&(p(0,"th",64),C(1),y(2,"translate"),f()),r&2&&(c(),F(" ",E(2,1,"POLICY_GRID.RULES.LEASE_TIME")," "))}function ya(r,s){r&1&&(p(0,"th",62),C(1),y(2,"translate"),f()),r&2&&(c(),F(" ",E(2,1,"POLICY_GRID.RULES.COMMENT")," "))}function Ea(r,s){if(r&1&&(p(0,"tr")(1,"th",57),C(2,"#"),f(),J(3,ha,2,3,"th",58)(4,wa,3,3,"th",45)(5,ga,3,3,"th",59)(6,Sa,3,3,"th",60)(7,Ca,3,3,"th",61)(8,ya,3,3,"th",59),f()),r&2){let i=_(4);c(3),m("ngForOf",i.fwcPolicyPositions),c(),m("ngIf",(i.fwcSelectedPolicy==null?null:i.fwcSelectedPolicy._fwcPolicyType)===i.SpecialPolicyTypes.POLICY_ROUTING),c(),m("ngIf",i.fwcSelectedPolicy==null?null:i.fwcSelectedPolicy.show_action),c(),m("ngIf",(i.fwcSelectedPolicy==null?null:i.fwcSelectedPolicy._fwcClusterId)!==null&&(i.fwcSelectedPolicy==null?null:i.fwcSelectedPolicy._fwcClusterId)!==void 0&&i.columnVisibility.applyTo!==!1),c(),m("ngIf",i.fwcSelectedPolicy._fwcPolicyType===i.POLICY_TYPES_FROM_NODES[i.NodeTypes.DHCP]),c(),m("ngIf",i.columnVisibility.comments)}}function va(r,s){if(r&1&&J(0,Ea,9,6,"tr",45),r&2){let i=_(3);m("ngIf",(i.fwcPolicyPositions==null?null:i.fwcPolicyPositions.length)||i.fwcSelectedPolicy._fwcPolicyType==i.POLICY_TYPES_FROM_NODES[i.NodeTypes.DHCP]||i.fwcSelectedPolicy._fwcPolicyType==i.POLICY_TYPES_FROM_NODES[i.NodeTypes.DHCP_FIXED_IP]||i.fwcSelectedPolicy._fwcPolicyType==i.POLICY_TYPES_FROM_NODES[i.NodeTypes.KEEPALIVED]||i.fwcSelectedPolicy._fwcPolicyType==i.POLICY_TYPES_FROM_NODES[i.NodeTypes.HAPROXY])}}function Ia(r,s){r&1&&wt(0)}function ba(r,s){r&1&&O(0,"i",75)}function Pa(r,s){r&1&&O(0,"i",76)}function Ta(r,s){if(r&1&&(Pe(0),p(1,"span"),C(2," ("),p(3,"strong"),C(4),f(),C(5),y(6,"translate"),f(),Te()),r&2){let i=_(2).$implicit;c(4),U(i.rules.length),c(),F(" ",E(6,2,"POLICY_GRID.RULES.RULES"),") ")}}function Oa(r,s){r&1&&(p(0,"span"),C(1),y(2,"translate"),f()),r&2&&(c(),F("(",E(2,1,"POLICY_GRID.RULES.NO_RULES"),")"))}function xa(r,s){r&1&&wt(0)}function Ra(r,s){if(r&1&&(Pe(0),J(1,xa,1,0,"ng-container",78),Te()),r&2){let i=s.$implicit,e=_(3).$implicit;_(3);let t=Oe(7);c(),m("ngTemplateOutlet",t)("ngTemplateOutletContext",Zn(2,qr,i,e.groupHide,e.idgroup))}}function Fa(r,s){if(r&1&&(Pe(0),J(1,Ra,2,6,"ng-container",77),Te()),r&2){let i=_(2).$implicit,e=_(3);c(),m("ngForOf",i.rules)("ngForTrackBy",e.policyRowTrackBy)}}function Aa(r,s){if(r&1){let i=M();p(0,"tr",65)(1,"td")(2,"div",66)(3,"iui-contextmenu",67),P("menuOpening",function(t){w(i);let n=_().$implicit,l=_(3);return g(l.contextMenuLoad(n,t))})("menuClick",function(t){w(i);let n=_().$implicit,l=_(3);return g(l.contextMenuHandler(l.fwcPolicyObject,n,t))})("menuOpening",function(t){w(i);let n=_(4);return g(n.adjustMenuPosition(t))}),p(4,"div",68)(5,"span",69),P("click",function(){w(i);let t=_().$implicit,n=_(3);return g(n.toggleGroupVisible(t))}),J(6,ba,1,0,"i",70)(7,Pa,1,0,"i",71),f(),C(8," \xA0 "),p(9,"span",72),O(10,"i",73),C(11,"\xA0\xA0"),p(12,"strong"),C(13),f(),O(14,"span",74),J(15,Ta,7,4,"ng-container",32)(16,Oa,3,3,"ng-template",null,10,pe),f()()()()()(),J(18,Fa,2,2,"ng-container",45)}if(r&2){let i=Oe(17),e=_().$implicit,t=_(3);ni("background-color",e.group_style?t.RulesStylesBg[e.group_style]!=null&&t.RulesStylesBg[e.group_style].length?t.RulesStylesBg[e.group_style]:e.group_style:t.RulesStylesBg[1e3]),c(),qe("colspan",t.fwcSelectedPolicy._fwcPolicyType===t.POLICY_TYPES_FROM_NODES[t.NodeTypes.HAPROXY]?t.fwcSelectedPolicy._fwcClusterId!==null&&t.fwcSelectedPolicy._fwcClusterId!==void 0?t.getColumnsCount():t.getColumnsCount()-1:t.fwcSelectedPolicy._fwcPolicyType===t.POLICY_TYPES_FROM_NODES[t.NodeTypes.DHCP]||t.fwcSelectedPolicy._fwcPolicyType===t.POLICY_TYPES_FROM_NODES[t.NodeTypes.DHCP_FIXED_IP]?t.getColumnsCount():t.fwcSelectedPolicy._fwcPolicyType===t.POLICY_TYPES_FROM_NODES[t.NodeTypes.KEEPALIVED]?t.getColumnsCount()-2:t.getColumnsCount()),c(2),m("allowAnimation",!1)("customStyle",t.contextMenuStyle)("colorScheme",t.currentColorScheme)("settings",t.ruleGroupContextMenu.RULE_GROUP),c(3),m("ngIf",!e.groupHide),c(),m("ngIf",e.groupHide),c(2),m("pTooltip",B("ID: <strong>"+e.idgroup+"</strong>"))("escape",!1),c(4),U(e.group_name),c(2),m("ngIf",e.rules==null?null:e.rules.length)("ngIfElse",i),c(3),m("ngIf",!e.groupHide)}}function La(r,s){r&1&&wt(0)}function Ma(r,s){if(r&1&&J(0,La,1,0,"ng-container",78),r&2){let i=_().$implicit;_(3);let e=Oe(7);m("ngTemplateOutlet",e)("ngTemplateOutletContext",Qe(2,Qr,i,i.id))}}function Da(r,s){if(r&1&&J(0,Ia,1,0,"ng-container",38)(1,Aa,19,16,"ng-template",null,8,pe)(3,Ma,1,5,"ng-template",null,9,pe),r&2){let i=s.$implicit,e=Oe(2),t=Oe(4);m("ngIf",i.rule_group)("ngIfThen",e)("ngIfElse",t)}}function Na(r,s){if(r&1&&(p(0,"span",80),C(1),y(2,"translate"),f()),r&2){_();let i=Oe(2),e=_(3);c(),F(" ",oi(2,1,"POLICY_GRID.PAGINATOR_REPORT",Zn(4,$r,i.first+1,i.first+e.MAX_ROWS_PER_PAGE>i.totalRecords?i.totalRecords:i.first+e.MAX_ROWS_PER_PAGE,i.totalRecords))," ")}}function Ga(r,s){if(r&1){let i=M();Pe(0),p(1,"p-paginator",79,11),P("onPageChange",function(t){w(i);let n=_(3);return g(n.onPageChange(t))}),f(),J(3,Na,3,8,"ng-template",null,12,pe),Te()}if(r&2){let i=Oe(4),e=_(3);c(),m("rows",e.MAX_ROWS_PER_PAGE)("totalRecords",e.getPolicyRulesLength())("alwaysShow",!1)("templateLeft",i)}}function Ua(r,s){if(r&1&&(J(0,ca,20,18,"p-drawer",42),p(1,"div",43)(2,"p-table",44,4),y(4,"fwcGridPagination"),J(5,ma,7,7,"ng-template",null,5,pe)(7,va,1,1,"ng-template",null,6,pe)(9,Da,5,3,"ng-template",null,7,pe),f()(),J(11,Ga,5,4,"ng-container",45)),r&2){let i=_(2);m("ngIf",i.settingsSidebar!==void 0),c(2),m("value",No(4,10,i.fwcPolicyObject.getPolicyRules(),(i.gridPaginator==null?null:i.gridPaginator.first)||0,(i.gridPaginator==null?null:i.gridPaginator.rows)||0))("rowTrackBy",i.policyRowTrackBy)("resizableColumns",!0)("scrollable",!0)("virtualScrollOptions",i.scrollerOptions)("virtualScroll",!0)("virtualScrollItemSize",37)("scrollHeight","100vh"),c(9),m("ngIf",i.showPaginator)}}function ka(r,s){if(r&1){let i=M();p(0,"div",81),O(1,"sts-fwc-message",82),p(2,"div",83)(3,"p-button",84),y(4,"translate"),P("onClick",function(){w(i);let t=_(2);return g(t.createNewRule(t.fwcPolicyObject))}),f()()()}if(r&2){let i=_(2);c(),m("message",i.msgNoRules),c(2),m("label",E(4,2,(i.fwcSelectedPolicy==null?null:i.fwcSelectedPolicy._fwcPolicyType)!==i.SpecialPolicyTypes.ROUTING_TABLE?"POLICY_GRID.RULES.CREATE":"CONTEXT.ROUTING.NEW_TABLE_ROUTE"))}}function Ba(r,s){if(r&1){let i=M();p(0,"div",29)(1,"div",30)(2,"h6",31),J(3,oa,5,0,"ng-container",32)(4,la,4,0,"ng-template",null,1,pe),p(6,"span",33)(7,"strong"),C(8),f(),O(9,"span",34),C(10),y(11,"translate"),p(12,"strong"),C(13),f()()(),p(14,"div",35),J(15,ra,1,0,"p-button",36),p(16,"p-button",37),y(17,"translate"),P("onClick",function(){w(i);let t=_();return g(t.onPolicySelect(t.fwcSelectedPolicy,!0))}),f()()(),J(18,aa,1,0,"ng-container",38)(19,Ua,12,14,"ng-template",null,2,pe)(21,ka,5,4,"ng-template",null,3,pe),f()}if(r&2){let i=Oe(5),e=Oe(20),t=Oe(22),n=_();c(3),m("ngIf",n.fwcSelectedPolicy==null?null:n.fwcSelectedPolicy._fwcClusterId)("ngIfElse",i),c(5),F(" ",n.fwcSelectedPolicy._fwcFwName," "),c(2),F(" ",E(11,10,n.fwcSelectedPolicy._fwcPolicyType!==n.SpecialPolicyTypes.ROUTING_TABLE?"POLICY_GRID.POL_TYPE":"ROUTING.NEW_TABLE_PANEL.TABLE"),": "),c(3),F(" ",n.fwcSelectedPolicy._fwcPolicyName," "),c(2),m("ngIf",n.fwcSelectedPolicy._fwcPolicyType!==n.POLICY_TYPES_FROM_NODES[n.NodeTypes.DHCP]&&n.fwcSelectedPolicy._fwcPolicyType!==n.POLICY_TYPES_FROM_NODES[n.NodeTypes.DHCP_FIXED_IP]&&n.fwcSelectedPolicy._fwcPolicyType!==n.POLICY_TYPES_FROM_NODES[n.NodeTypes.HAPROXY]),c(),m("label",E(17,12,"POLICY_GRID.RELOAD")),c(2),m("ngIf",n.fwcPolicyObject==null?null:n.fwcPolicyObject.getPolicyRulesLength())("ngIfThen",e)("ngIfElse",t)}}function ja(r,s){if(r&1&&(p(0,"div",85),O(1,"p-progressSpinner"),p(2,"span",86),C(3),f()()),r&2){let i=_();c(),Nt(Y(3,Zr)),c(2),F(" ",i.ruleStatus," ")}}function Va(r,s){r&1&&(p(0,"div",99)(1,"span"),O(2,"i",100),f()())}function Wa(r,s){if(r&1&&(p(0,"span",101),O(1,"i",102),f()),r&2){let i=_(2).$implicit,e=_();c(),m("ngClass",i.special&&i.special!=e.SpecialPolicyRules.HOOKSCRIPT?"fwcOrange":"fwcBlue")}}function Ha(r,s){r&1&&(p(0,"span"),O(1,"i",103),f())}function Ja(r,s){r&1&&O(0,"i",117)}function Ya(r,s){r&1&&(p(0,"span"),C(1,"6"),f())}function Ka(r,s){if(r&1&&(p(0,"span",118),O(1,"i",119),C(2," crowdsec"),J(3,Ya,2,0,"span",45),C(4,"-blacklists "),f()),r&2){let i=_(6).$implicit;c(3),m("ngIf",i.type>60)}}function Xa(r,s){if(r&1&&(p(0,"span",120),C(1," ("),O(2,"i",116),y(3,"fwcIcon"),p(4,"span"),C(5),f(),C(6,")\xA0 "),f()),r&2){let i=_(2).$implicit,e=_(5);c(2),he(nt("fwcIcon ",E(3,4,e.ObjectTypes.OBJ_CLUSTER))),c(3),U(i.cluster_name)}}function za(r,s){if(r&1&&(p(0,"span",120),C(1," ("),O(2,"i",116),y(3,"fwcIcon"),p(4,"span"),C(5),f(),C(6,")\xA0 "),f()),r&2){let i=_(2).$implicit,e=_(5);c(2),he(nt("fwcIcon ",E(3,4,e.ObjectTypes.OBJ_FIREWALL))),c(3),U(i.firewall_name)}}function qa(r,s){if(r&1&&(p(0,"span",120),C(1," ("),O(2,"i",116),y(3,"fwcIcon"),p(4,"span"),C(5),f(),C(6,")\xA0 "),f()),r&2){let i=_(2).$implicit,e=_(5);c(2),he(nt("fwcIcon ",E(3,4,e.ObjectTypes.OBJ_HOST))),c(3),U(i.host_name)}}function Qa(r,s){if(r&1&&(O(0,"img",121),y(1,"lowercase"),y(2,"lowercase")),r&2){let i=_(2).$implicit;he(nt("flag-icon flag-icon-",E(1,4,i.name))),m("src","assets/flags/4x3/"+E(2,6,i.name)+".svg",xi)}}function $a(r,s){if(r&1&&(O(0,"i",116),y(1,"fwcIcon")),r&2){let i=_(2).$implicit;he(nt("fwcIcon ",oi(1,3,i.name,i.name)))}}function Za(r,s){r&1&&wt(0)}function es(r,s){if(r&1&&C(0),r&2){let i=_(2).$implicit;U(i._fwcObjName)}}function ts(r,s){if(r&1&&C(0),r&2){let i=_(2).$implicit;F("[",i.labelName,"]")}}function is(r,s){if(r&1&&(Pe(0),J(1,Ja,1,0,"i",109)(2,Ka,5,1,"span",110),p(3,"span",111),J(4,Xa,7,6,"span",112)(5,za,7,6,"span",112)(6,qa,7,6,"span",112),p(7,"span",113),J(8,Qa,3,8,"img",114)(9,$a,2,6,"i",115),O(10,"i",116),y(11,"fwcIcon"),J(12,Za,1,0,"ng-container",38)(13,es,1,1,"ng-template",null,16,pe)(15,ts,1,1,"ng-template",null,17,pe),f()(),Te()),r&2){let i=Oe(14),e=Oe(16),t=_().$implicit,n=_().$implicit,l=_(3).$implicit,o=_();c(),m("ngIf",n.negate),c(),m("ngIf",l.special==o.SpecialPolicyRules.CROWDSEC&&n.name==="Source"),c(2),m("ngIf",n.ipobjs.length>1&&t.cluster_id!=null&&t.cluster_id!==l._fwcClusterId&&t.host_id==null&&!(t.firewall_id!=null&&t.cluster_id==null)),c(),m("ngIf",t.firewall_id!=null&&t.cluster_id==null&&t.firewall_id!=l.firewall&&o.isObjectTypesValid(t._fwcObjType)&&!(t.firewall_id===l.firewall&&t.cluster_id===l._fwcClusterId)&&!t.host_id&&(o.isPolicyNotInSelected(o.fwcSelectedPolicy)&&t.firewall_id&&!t.cluster_id&&t.firewall_id!=l.firewall||t.firewall_id!=l.firewall&&t._fwcObjType==o.ObjectTypes.OBJ_ADDRESS&&o.fwcSelectedPolicy!==o.POLICY_TYPES_FROM_NODES[o.NodeTypes.HAPROXY]||o.fwcSelectedPolicy===o.POLICY_TYPES_FROM_NODES[o.NodeTypes.HAPROXY]&&t.firewall_id!=l.firewall&&!l._fwcClusterId||o.fwcSelectedPolicy===o.POLICY_TYPES_FROM_NODES[o.NodeTypes.DHCP]&&t.firewall_id!=l.firewall&&!l._fwcClusterId&&t.firewall_id||t.firewall_id==l.firewall&&t._fwcObjType==o.ObjectTypes.OBJ_ADDRESS&&o.fwcSelectedPolicy!==o.POLICY_TYPES_FROM_NODES[o.NodeTypes.KEEPALIVED])),c(),m("ngIf",(t._fwcObjType==o.ObjectTypes.OBJ_INTERFACE_HOST||t._fwcObjType==o.ObjectTypes.OBJ_ADDRESS||t._fwcObjType==o.ObjectTypes.OBJ_ADDRESS&&o.fwcSelectedPolicy!==o.POLICY_TYPES_FROM_NODES[o.NodeTypes.KEEPALIVED]||t._fwcObjType==o.ObjectTypes.OBJ_OPENVPN_PREFIX)&&t.host_id),c(2),m("ngIf",t._fwcObjType===o.ObjectTypes.OBJ_COUNTRIE),c(),m("ngIf",t._fwcObjType===o.ObjectTypes.OBJ_CONTINENT),c(),he(nt("fwcIcon ",E(11,13,t._fwcObjType))),c(2),m("ngIf",(t._fwcObjType==o.ObjectTypes.OBJ_INTERFACE_FIREWALL||t._fwcObjType==o.ObjectTypes.OBJ_INTERFACE_HOST)&&t.labelName&&t.labelName.length)("ngIfThen",e)("ngIfElse",i)}}function ns(r,s){if(r&1){let i=M();p(0,"div")(1,"iui-contextmenu",90),P("menuOpening",function(t){w(i);let n=_().$implicit,l=_(3).$implicit,o=_();return g(o.fwcPositionFunctionalityService.onContextMenuLoad(l.type,l.id,n,o.fwcTypesPositions[n.id],t))})("menuClick",function(t){let n=w(i).$implicit,l=_().$implicit,o=_(3).$implicit,a=_();return g(a.fwcPositionFunctionalityService.onContextMenuHandler(a.fwcPolicyObject,n,o.firewall,o._fwcClusterId,o.id,l,a.fwcTypesPositions[l.id],t))})("menuOpening",function(t){w(i);let n=_(5);return g(n.adjustMenuPosition(t))}),p(2,"div",108),P("click",function(){let t=w(i).$implicit,n=_().$implicit,l=_(4);return g(l.fwcPositionFunctionalityService.onItemClickEvent(n,t))})("dblclick",function(){let t=w(i).$implicit,n=_().$implicit,l=_(4);return g(l.fwcPositionFunctionalityService.onItemDblClickEvent(n,t))})("mouseenter",function(t){let n=w(i).$implicit,l=_(5);return g(l.fwcPositionFunctionalityService.showObjectInfo(n,t))})("mouseleave",function(t){w(i);let n=_(5);return g(n.fwcPositionFunctionalityService.clearObjectInfo(t))})("dragstart",function(t){let n=w(i).$implicit,l=_().$implicit,o=_(4);return g(o.fwcPositionFunctionalityService.itemDragStart(l,n,t))}),J(3,is,17,15,"ng-container",45),f()()()}if(r&2){let i=s.$implicit,e=_().$implicit,t=_(4);c(),m("allowAnimation",!1)("customStyle",t.contextMenuStyle)("colorScheme",t.currentColorScheme)("settings",t.fwcPositionFunctionalityService.positionContextMenu.POSITION),c(),Je("item-highlighted",i.highlighted==!0)("item-rightclicked",i.rightclicked==!0),m("ngClass",i.hidden&&(e.ipobjs==null?null:e.ipobjs.length)>1?"item-general-hidden":"item-general-default")("draggable",i.allowDrag!==!1&&!(e.id===t.RoutingPolicyPositions.FROM_POSITION&&(e.ipobjs==null?null:e.ipobjs.length)<=2||e.id===t.DhcpPolicyPositions.NETWORK||e.id===t.DhcpPolicyPositions.INTERFACE||e.id===t.DhcpPolicyPositions.ROUTER||e.id===t.DhcpPolicyPositions.RANGE||e.id===t.DhcpPolicyPositions.IP)),qe("data-obj_id",i.id),c(),m("ngIf",i.hidden&&(e.ipobjs==null?null:e.ipobjs.length)==1||!i.hidden&&(e.ipobjs==null?null:e.ipobjs.length)>1)}}function os(r,s){if(r&1){let i=M();p(0,"td",105)(1,"div",106,15),P("dragenter",function(t){let n=w(i).$implicit,l=Oe(2),o=_(3).$implicit,a=_();return g(a.fwcPositionFunctionalityService.onListDragEnter(o.firewall,n,a.fwcTypesPositions[n.id],t,l))})("dragleave",function(t){let n=w(i).$implicit,l=Oe(2),o=_(4);return g(o.fwcPositionFunctionalityService.onListDragLeave(t,n,l))})("dragover",function(t){w(i);let n=_(4);return g(n.fwcPositionFunctionalityService.onListDragOver(t))})("drop",function(t){let n=w(i).$implicit,l=Oe(2),o=_(3).$implicit,a=_();return g(a.fwcPositionFunctionalityService.onListDragDrop(a.fwcPolicyObject,o.id,n,a.fwcTypesPositions[n.id],t,l))}),J(3,ns,4,12,"div",77),p(4,"iui-contextmenu",90),P("menuOpening",function(t){let n=w(i).$implicit,l=_(3).$implicit,o=_();return g(o.fwcPositionFunctionalityService.onContextMenuLoad(l.type,l.id,n,o.fwcTypesPositions[n.id],t))})("menuClick",function(t){let n=w(i).$implicit,l=_(3).$implicit,o=_();return g(o.fwcPositionFunctionalityService.onContextMenuHandler(o.fwcPolicyObject,void 0,l.firewall,l._fwcClusterId,l.id,n,o.fwcTypesPositions[n.id],t))})("menuOpening",function(t){w(i);let n=_(4);return g(n.adjustMenuPosition(t))}),O(5,"div",107),f()()()}if(r&2){let i=s.$implicit,e=_(4);c(),m("ngClass",eo(7,ta,i.highlighted,i.draggedOver,i.objectAllowed===!1,i.objectAllowed===!0)),c(2),m("ngForOf",i.ipobjs)("ngForTrackBy",e.positionObjectsTrackBy),c(),m("allowAnimation",!1)("customStyle",e.contextMenuStyle)("colorScheme",e.currentColorScheme)("settings",e.fwcPositionFunctionalityService.positionContextMenu.POSITION)}}function ls(r,s){if(r&1&&(Pe(0),J(1,os,6,12,"td",104),Te()),r&2){let i=_(2).$implicit;c(),m("ngForOf",i.positions)}}function rs(r,s){if(r&1){let i=M();p(0,"td")(1,"div",122)(2,"textarea",123),P("ngModelChange",function(t){w(i);let n=_(2).$implicit;return g(n.formModel.run_before||(n.formModel.cfg_text=t))})("focus",function(){w(i);let t=_(2).$implicit,n=_();return g(n.fwcRuleFunctionalityService.onScriptFocus(n.fwcPolicyObject,t))}),C(3,"            "),f()()()}if(r&2){let i=_(2).$implicit,e=_();qe("colspan",e.getManualRulePlaceholderColspan(i)),c(2),m("ngModel",i.formModel.run_before||i.formModel.cfg_text)}}function as(r,s){if(r&1){let i=M();p(0,"td")(1,"p-select",124),H("ngModelChange",function(t){w(i);let n=_(2).$implicit;return W(n.formModel.routingTableId,t)||(n.formModel.routingTableId=t),g(t)}),P("onChange",function(t){w(i);let n=_(2).$implicit,l=_();return g(l.fwcPolicyGridRoutingRulesFunctionalityService.handleChangeRoutingTable(n,t.value))}),f()()}if(r&2){let i=_(2).$implicit,e=_();c(),m("options",e.routingTablesItems),V("ngModel",i.formModel.routingTableId),m("disabled",!e.fwcUserLock)}}function ss(r,s){if(r&1&&(O(0,"i"),C(1)),r&2){let i=s.$implicit;he(i.icon),c(),F(" ",i.label," ")}}function cs(r,s){if(r&1&&(O(0,"i"),C(1)),r&2){let i=s.$implicit;he(i.icon),c(),F(" ",i.label," ")}}function ps(r,s){if(r&1){let i=M();p(0,"p-select",129),H("ngModelChange",function(t){w(i);let n=_(3).$implicit;return W(n.formModel.action,t)||(n.formModel.action=t),g(t)}),P("onChange",function(){w(i);let t=_(3).$implicit,n=_();return g(n.fwcRuleFunctionalityService.updateRule(t))}),J(1,ss,2,3,"ng-template",null,19,pe)(3,cs,2,3,"ng-template",null,20,pe),f()}if(r&2){let i=_(3).$implicit,e=_();m("options",e.fwActionsService.getActionsItems(i==null?null:i.special)),V("ngModel",i.formModel.action),m("styleClass","dropDownAction")("disabled",!e.fwcUserLock)}}function ds(r,s){r&1&&(p(0,"span",118),O(1,"i",130),C(2," Accept established, related "),f())}function _s(r,s){r&1&&(p(0,"div",134),O(1,"i",135),C(2),y(3,"translate"),O(4,"i",135),f()),r&2&&(c(2),F(" ",E(3,1,"RULE.DROP_MARK")," "))}function us(r,s){if(r&1){let i=M();p(0,"div",136),P("mouseenter",function(t){w(i);let n=_(4).$implicit,l=_();return g(l.fwcRuleFunctionalityService.showMarkInfo(n,t))})("mouseleave",function(t){w(i);let n=_(5);return g(n.fwcRuleFunctionalityService.clearMarkInfo(t))})("wheel",function(t){w(i);let n=_(5);return g(n.fwcRuleFunctionalityService.clearMarkInfo(t))})("dblclick",function(){w(i);let t=_(4).$implicit,n=_();return g(n.fwcPositionFunctionalityService.onMarkDblClickEvent(t.mark))}),p(1,"span",137),O(2,"i",138),C(3),f(),p(4,"div",139)(5,"i",140),P("click",function(){w(i);let t=_(4).$implicit,n=_();return g(n.fwcRuleFunctionalityService.onDeleteRuleMark(t))}),f()()()}if(r&2){let i=_(4).$implicit;c(3),F(" ",i.mark_name," ")}}function fs(r,s){if(r&1&&(p(0,"div",131,21),J(2,_s,5,3,"div",132)(3,us,6,1,"div",133),f()),r&2){let i=_(3).$implicit;c(2),m("ngIf",!i.mark&&i.labelDraggedOverAction),c(),m("ngIf",i.mark)}}function ms(r,s){if(r&1){let i=M();p(0,"td",125,18),P("dragenter",function(t){w(i);let n=Oe(1),l=_(2).$implicit,o=_();return g(o.fwcRuleFunctionalityService.onActionDragEnter(l,t,n))})("dragleave",function(t){w(i);let n=Oe(1),l=_(2).$implicit,o=_();return g(o.fwcRuleFunctionalityService.onActionDragLeave(l,t,n))})("dragover",function(t){w(i);let n=_(3);return g(n.fwcRuleFunctionalityService.onActionDragOver(t))})("drop",function(t){w(i);let n=Oe(1),l=_(2).$implicit,o=_();return g(o.fwcRuleFunctionalityService.onActionDragDrop(l,t,n))}),p(2,"div",126),J(3,ps,5,4,"p-select",127)(4,ds,3,0,"span",110)(5,fs,4,2,"div",128),f()()}if(r&2){let i=_(2).$implicit,e=_();c(3),m("ngIf",(i==null?null:i.special)!=e.SpecialPolicyRules.STATEFUL),c(),m("ngIf",(i==null?null:i.special)==e.SpecialPolicyRules.STATEFUL),c(),m("ngIf",(i==null?null:i.special)!=e.SpecialPolicyRules.STATEFUL)}}function hs(r,s){if(r&1&&(p(0,"span"),O(1,"i"),y(2,"fwcIcon"),C(3,"\xA0 "),f()),r&2){let i=_(6);c(),he(E(2,2,i.ObjectTypes.OBJ_FIREWALL))}}function ws(r,s){if(r&1&&(J(0,hs,4,4,"span",45),C(1)),r&2){let i=s.$implicit;m("ngIf",i.value),c(),F(" ",i.label," ")}}function gs(r,s){if(r&1&&(p(0,"span"),O(1,"i"),y(2,"fwcIcon"),C(3,"\xA0 "),f()),r&2){let i=_(6);c(),he(E(2,2,i.ObjectTypes.OBJ_FIREWALL))}}function Ss(r,s){if(r&1&&(J(0,gs,4,4,"span",45),C(1)),r&2){let i=s.$implicit;m("ngIf",i.value),c(),F(" ",i.label," ")}}function Cs(r,s){if(r&1){let i=M();p(0,"p-select",129),H("ngModelChange",function(t){w(i);let n=_(3).$implicit;return W(n.formModel.fw_apply_to,t)||(n.formModel.fw_apply_to=t),g(t)}),P("onChange",function(){w(i);let t=_(3).$implicit,n=_();return g(n.fwcRuleFunctionalityService.handleChangeApplyTo(n.fwcPolicyObject,t))}),J(1,ws,2,2,"ng-template",null,19,pe)(3,Ss,2,2,"ng-template",null,20,pe),f()}if(r&2){let i=_(3).$implicit,e=_();m("options",e.clusterNodesItems),V("ngModel",i.formModel.fw_apply_to),m("styleClass","dropDownAction")("disabled",!e.fwcUserLock)}}function ys(r,s){r&1&&(p(0,"span"),C(1),y(2,"translate"),f()),r&2&&(c(),F(" ",E(2,1,"RULE.ALL_NODES")," "))}function Es(r,s){if(r&1&&(p(0,"td",141)(1,"div",126),J(2,Cs,5,4,"p-select",127)(3,ys,3,3,"span",45),f()()),r&2){let i=_(2).$implicit,e=_();c(2),m("ngIf",!i.special||i.special==e.SpecialPolicyRules.HOOKSCRIPT||i.special==e.SpecialPolicyRules.FAIL2BAN),c(),m("ngIf",i.special&&i.special!=e.SpecialPolicyRules.HOOKSCRIPT&&i.special!=e.SpecialPolicyRules.FAIL2BAN)}}function vs(r,s){if(r&1){let i=M();p(0,"td",105)(1,"div",126)(2,"input",142),H("ngModelChange",function(t){w(i);let n=_(2).$implicit;return W(n.formModel.max_lease,t)||(n.formModel.max_lease=t),g(t)}),P("focus",function(){w(i);let t=_(2).$implicit,n=_();return g(n.fwcRuleFunctionalityService.onLeaseTimeFocus(t))})("blur",function(){w(i);let t=_(2).$implicit,n=_();return g(n.fwcRuleFunctionalityService.onLeaseTimeBlur(n.fwcPolicyObject,t))}),f()()()}if(r&2){let i=_(2).$implicit,e=_();c(2),m("id",e.max_lease_time),V("ngModel",i.formModel.max_lease)}}function Is(r,s){if(r&1){let i=M();p(0,"td",143)(1,"div",144)(2,"textarea",145),y(3,"translate"),H("ngModelChange",function(t){w(i);let n=_(2).$implicit;return W(n.formModel.comment,t)||(n.formModel.comment=t),g(t)}),P("focus",function(){w(i);let t=_(2).$implicit,n=_();return g(n.fwcRuleFunctionalityService.onCommentFocus(t))})("blur",function(){w(i);let t=_(2).$implicit,n=_();return g(n.fwcRuleFunctionalityService.onCommentBlur(n.fwcPolicyObject,t))}),C(4,"            "),f()()()}if(r&2){let i=_(2).$implicit,e=_();c(),ni("max-height",i.heightPx+"px"),m("ngClass",Re(9,ia,i.commentEdit)),c(),m("placeholder",B(E(3,7,"GLOBALS.DB_FIELDS.comment"))),V("ngModel",i.formModel.comment),m("disabled",!e.fwcUserLock)}}function bs(r,s){if(r&1){let i=M();Pe(0),p(1,"tr",87),P("mouseenter",function(t){w(i);let n=_().$implicit,l=_();return g(l.onRuleEnter(n,t))}),p(2,"td",88),P("click",function(t){w(i);let n=_().$implicit,l=_();return g(l.fwcRuleFunctionalityService.selectRule(n,t))})("dblclick",function(){w(i);let t=_().$implicit,n=_();return g(n.fwcRuleFunctionalityService.editRule(t))}),p(3,"div",66)(4,"div",89)(5,"iui-contextmenu",90),P("menuOpening",function(t){w(i);let n=_().$implicit,l=_();return g(l.fwcRuleFunctionalityService.onContextMenuLoad(n,t))})("menuOpening",function(t){w(i);let n=_(2);return g(n.adjustMenuPosition(t))})("menuClick",function(t){w(i);let n=_().$implicit,l=_();return g(l.fwcRuleFunctionalityService.onContextMenuHandler(l.fwcPolicyObject,n,t))}),p(6,"div",91)(7,"div"),J(8,Va,3,0,"div",92),f(),p(9,"div")(10,"span",93),C(11),f(),O(12,"br"),J(13,Wa,2,1,"span",94)(14,Ha,2,0,"span",45),f()()()()()(),J(15,ls,2,1,"ng-container",32)(16,rs,4,2,"ng-template",null,14,pe)(18,as,2,3,"td",45)(19,ms,6,3,"td",95)(20,Es,4,2,"td",96)(21,vs,3,2,"td",97)(22,Is,5,11,"td",98),f(),Te()}if(r&2){let i=Oe(17),e=_().$implicit,t=_();c(),ni("background-color",e.style&&t.RulesStylesBg[e.style]?t.RulesStylesBg[e.style]:e.style),m("id",nt("rule_",e.id))("ngClass",eo(25,ea,t.isRuleSelected(e),!e.active,e.highlighted,e.special&&e.special!=t.SpecialPolicyRules.HOOKSCRIPT)),c(),m("pTooltip",t.fwcRuleFunctionalityService.setRuleTooltip(e))("escape",!1),c(3),m("allowAnimation",!1)("customStyle",t.contextMenuStyle)("colorScheme",t.currentColorScheme)("settings",e.type===t.SpecialPolicyTypes.ROUTING_TABLE?t.fwcRuleFunctionalityService.ruleContextMenu.ROUTE:e.type===t.SpecialPolicyTypes.POLICY_ROUTING?t.fwcRuleFunctionalityService.ruleContextMenu.ROUTING_RULE:e.type===t.POLICY_TYPES_FROM_NODES[t.NodeTypes.DHCP]||e.type===t.POLICY_TYPES_FROM_NODES[t.NodeTypes.DHCP_FIXED_IP]?t.fwcRuleFunctionalityService.ruleContextMenu.DHCP_RULE:e.type===t.POLICY_TYPES_FROM_NODES[t.NodeTypes.KEEPALIVED]?t.fwcRuleFunctionalityService.ruleContextMenu.KEEPALIVED_RULE:e.type===t.POLICY_TYPES_FROM_NODES[t.NodeTypes.HAPROXY]?t.fwcRuleFunctionalityService.ruleContextMenu.HAPROXY_RULE:t.fwcRuleFunctionalityService.ruleContextMenu.RULE),c(),ni("min-height",t.fwcPolicyGridFunctionalityService.calcRuleHeight(e),"px"),m("ngClass",e.idgroup?"fwcGroupCell":"fwcGridCell"),c(2),m("ngIf",!e.active),c(3),U(e._fwcRuleOrder),c(2),m("ngIf",e.options),c(),m("ngIf",e.run_before||e.run_after||e.special==t.SpecialPolicyRules.HOOKSCRIPT),c(),m("ngIf",e.special!=t.SpecialPolicyRules.HOOKSCRIPT&&e.special!=t.SpecialPolicyRules.FAIL2BAN)("ngIfElse",i),c(3),m("ngIf",(t.fwcSelectedPolicy==null?null:t.fwcSelectedPolicy._fwcPolicyType)===t.SpecialPolicyTypes.POLICY_ROUTING),c(),m("ngIf",(t.fwcSelectedPolicy==null?null:t.fwcSelectedPolicy.show_action)&&e.special!=t.SpecialPolicyRules.HOOKSCRIPT&&e.special!=t.SpecialPolicyRules.FAIL2BAN),c(),m("ngIf",t.shouldShowApplyToColumn(e)),c(),m("ngIf",t.fwcSelectedPolicy._fwcPolicyType===t.POLICY_TYPES_FROM_NODES[t.NodeTypes.DHCP]&&e.special!==6),c(),m("ngIf",t.columnVisibility.comments&&e.special!=t.SpecialPolicyRules.HOOKSCRIPT)}}function Ps(r,s){r&1&&O(0,"div",149)}function Ts(r,s){r&1&&(p(0,"div",99)(1,"span"),O(2,"i",100),f()())}function Os(r,s){if(r&1&&(p(0,"span"),O(1,"i",150),f()),r&2){let i=_(2).$implicit,e=_();c(),m("ngClass",i.special&&i.special!=e.SpecialPolicyRules.HOOKSCRIPT?"fwcOrange":"fwcBlue")}}function xs(r,s){r&1&&(p(0,"span"),O(1,"i",151),f())}function Rs(r,s){if(r&1&&(p(0,"tr",146)(1,"td",147),J(2,Ps,1,0,"div",148),p(3,"div",91)(4,"div"),J(5,Ts,3,0,"div",92),p(6,"span",93),C(7),f(),O(8,"br"),J(9,Os,2,1,"span",45)(10,xs,2,0,"span",45),f()()(),O(11,"td"),f()),r&2){let i=_().$implicit,e=_();ni("height",i.heightPx+"px"),m("id",B("rule_"+i.id)),c(2),m("ngIf",i.idgroup),c(),m("ngClass",i.idgroup?"fwcGroupCell":"fwcGridCell"),c(2),m("ngIf",!i.active),c(2),U(i._fwcRuleOrder),c(2),m("ngIf",i.options),c(),m("ngIf",i.run_before||i.run_after),c(),qe("colSpan",e.getColumnsCount()-1)}}function Fs(r,s){if(r&1&&J(0,bs,23,30,"ng-container",32)(1,Rs,12,11,"ng-template",null,13,pe),r&2){let i=s.$implicit,e=Oe(2);m("ngIf",i.visible)("ngIfElse",e)}}var Hn=(()=>{let s=class s{constructor(e,t,n,l,o,a,u,d,h,S,v,b,T,A,N,j,D,Q,X,re,ne,ae,ze,Dt,at,st,rn,$t,Xt,yi){this.refService=e,this.fwcFirewallService=t,this.fwcPolicyService=n,this.fwcRoutingPolicyService=l,this.fwcRoutingTableService=o,this.fwcPositionService=a,this.itemSelectedService=u,this.ruleSelectedService=d,this.fwcContextMenuService=h,this.fwcRuleFunctionalityService=S,this.fwcPositionFunctionalityService=v,this.fwcPolicyGridFunctionalityService=b,this.fwcPolicyGridRoutingRulesFunctionalityService=T,this.fwcPolicyGridRoutingTableFunctionalityService=A,this.fwcDhcpPolicyService=N,this.fwcPolicyGridDhcpRulesFunctionalityService=j,this.fwcKeepalivedPolicyService=D,this.fwcPolicyGridKeepalivedRulesFunctionalityService=Q,this.fwcHAProxyPolicyService=X,this.fwcPolicyGridHAProxyRulesFunctionalityService=re,this.fwcUserService=ne,this.fwActionsService=ae,this.fwcErrorPipe=ze,this.confirmationService=Dt,this.messageService=at,this.inputDataService=st,this.utilService=rn,this.store=$t,this.cd=Xt,this.translate=yi,this.virtualRowHeightPx=55,this.virtualScrollEnabled=!0,this.virtualScrollThreshold=200,this.tableScrollHeight="calc(99vh - 8.8rem)",this.contextMenuStyle=[Gl,kl,Ul],this.applicationRef=null,this.contextMenuReference=null,this.ruleGroupsExpanded=[],this.fwcSelectedPolicy={},this.RulesStylesBg=Ko,this.POLICY_TYPES_FROM_NODES=$,this.NodeTypes=q,this.gridColumns=[],this.selectedGridColumns=[],this.alive=!0,this.loadingData=!1,this.ObjectTypes=I,this.showPaginator=!1,this.MAX_ROWS_PER_PAGE=100,this.SpecialPolicyTypes=Ne,this.SpecialPolicyRules=ke,this.RoutingPolicyPositions=ji,this.DhcpPolicyPositions=Me,this.KeepalivedPolicyPositions=We,this.HAProxyPolicyPositions=Ae,this.scrollerOptions={delay:0,appendOnly:!0,autoSize:!0,scrollHeight:"calc(100vh - 10.5rem)",onScroll:an=>{let Ct=an.originalEvent.target,Pi=document.querySelector(".divTableScroll.fwcDivPadded.fwcDivPaddedTB");Pi&&(Ct.scrollTop>0?Pi.classList.add("fwcSticky"):Pi.classList.remove("fwcSticky"));let Zt={scrollTop:Ct.scrollTop,scrollHeight:Ct.scrollHeight,offsetTop:Ct.offsetTop,offsetHeight:Ct.offsetHeight};this.utilService.setGridScroll(Zt)}},this.selectedRules=[],this.columnVisibility={applyTo:!0,comments:!0},this.fwcSelectedPolicy&&this.fwcSelectedPolicy._fwcPolicyType!==Ne.ROUTING_TABLE?this.msgNoRules={type:"warning",title:this.translate.instant("POLICY_GRID.ERR_EMPTY.SUMMARY"),text:this.translate.instant("POLICY_GRID.ERR_EMPTY.TEXT")}:this.msgNoRules={type:"warning",title:this.translate.instant("POLICY_GRID.ERR_EMPTY_ROUTING_TABLE.SUMMARY"),text:this.translate.instant("POLICY_GRID.ERR_EMPTY_ROUTING_TABLE.TEXT")}}ngAfterViewInit(){let e=this;setTimeout(function(){let t=e.refService.getAppRef();e.contextMenuReference=t,e.applicationRef=t},1),this.wheelListener=this.onWheelEvent.bind(this),window.addEventListener("wheel",this.wheelListener,{passive:!0})}updateVirtualRowHeight(){let e=Math.max(this.fwcPolicyGridFunctionalityService.getMaximumRuleHeight(),55);this.virtualRowHeightPx=e,this.scrollerOptions=Ti(Lt({},this.scrollerOptions),{itemSize:e,scrollHeight:this.tableScrollHeight})}onWheelEvent(e){window.innerHeight>450&&this.closeContextMenu()}ngOnInit(){this.fwcPolicyService.reloadPolicy().pipe(oe(()=>this.alive)).subscribe(()=>{this.onPolicySelect(this.fwcSelectedPolicy,!0)}),this.store.pipe(oe(()=>this.alive),di(el)).subscribe(t=>{t==="dark"?this.currentColorScheme=co.Dark:this.currentColorScheme=co.Light}),this.fwcPolicyService.getSelectedPolicy().pipe(oe(()=>this.alive)).subscribe(t=>{this.onPolicySelect(t,t&&t._forcePolicyReload)});let e=this.fwcPolicyService.getActualSelectedPolicy?.();e&&e._fwcFwId!==null&&e._fwcFwId!==void 0&&this.onPolicySelect(Lt({},e),!0),this.ruleSelectedService.getSelectedRules().pipe(oe(()=>this.alive)).subscribe(t=>{this.selectedRules=t}),this.ruleSelectedService.getRuleStatus().pipe(oe(()=>this.alive)).subscribe(t=>{t||t===""?this.ruleStatus=t||this.translate.instant("GLOBALS.MSG_OP_RESULT.LOADING"):this.ruleStatus=null}),this.ruleSelectedService.getRuleHeightRecalculate().pipe(oe(()=>this.alive)).subscribe(t=>{let n=this.fwcPolicyObject.getPolicyRule(t);n&&this.fwcPolicyGridFunctionalityService.calcRuleHeight(n)}),this.ruleSelectedService.getModifiedRule().pipe(oe(()=>this.alive)).subscribe(t=>{if(t){let n;for(let l of this.fwcPolicyGridFunctionalityService.policyIterator(this.fwcPolicyObject.getPolicyRules()))if(l.id===t.id){n=l;break}n&&(n.options=t.options,n.run_before=t.run_before,n.run_after=t.run_after,this.fwcRuleFunctionalityService.setRuleTooltip(n),this.refreshComponent())}}),this.ruleSelectedService.getSelectedRuleRange().pipe(oe(()=>this.alive)).subscribe(t=>{let n=[];if(t){let l=this.fwcPolicyObject.getPolicyRules();for(let o=0;o<l.length;o++){let a=l[o];if(a.rule_group)for(let u=0;u<a.rules.length;u++){let d=a.rules[u];d.rule_order>=t.minRuleOrder&&d.rule_order<=t.maxRuleOrder&&n.push(d)}else a.rule_order>=t.minRuleOrder&&a.rule_order<=t.maxRuleOrder&&n.push(a)}}this.ruleSelectedService.setSelectedRules(n)}),this.ruleGroupContextMenu=this.fwcContextMenuService.getRuleGroupMenus(),this.fwcUserService.getFwcUser().pipe(oe(()=>this.alive)).subscribe(t=>{t&&(this.fwcUserObject=t,this.fwcUserLock=t.lockInfo.result,this.fwcUser=t.user_id,this.fwCloud=t.selectedFwCloud)}),this.itemSelectedService.getModifiedItem().pipe(oe(()=>this.alive)).subscribe(t=>{if(this.fwcPolicyObject){let n=this.fwcPolicyObject.getPolicyRules();if(n){if(t.deleteFromList){let l=null;for(let o of this.fwcPolicyGridFunctionalityService.policyIterator(n))if(t.srcRuleId==o.id){l=o;break}if(l&&l.positions){let o=null;for(let a=0;a<l.positions.length;a++){let u=l.positions[a];if(t.srcPositionId==u.id){o=u;break}}if(o&&o.ipobjs)for(let a=0;a<o.ipobjs.length;a++){let u=o.ipobjs[a];u._fwcObjId==t._fwcObjId&&u._fwcObjType==t._fwcObjType&&this.fwcPositionFunctionalityService.removeItemAt(o,a)}}}else if(t.highlightItem){for(let l of this.fwcPolicyGridFunctionalityService.policyIterator(this.fwcPolicyObject.getPolicyRules()))if(Array.isArray(l.positions))for(let o=0;o<l.positions.length;o++){let a=l.positions[o];if(Array.isArray(a.ipobjs))for(let u=0;u<a.ipobjs.length;u++){let d=a.ipobjs[u];d._fwcObjId==t._fwcObjId&&d._fwcObjType==t._fwcObjType?d.highlighted=t.highlighted:d.highlighted=!1}}}else if(t._fwcObjType!=I.OBJ_FIREWALL&&t._fwcObjType!=I.OBJ_CLUSTER){for(let l of this.fwcPolicyGridFunctionalityService.policyIterator(this.fwcPolicyObject.getPolicyRules()))if(Array.isArray(l.positions))for(let o=0;o<l.positions.length;o++){let a=l.positions[o];if(Array.isArray(a.ipobjs))for(let u=0;u<a.ipobjs.length;u++){let d=a.ipobjs[u];if(d._fwcObjId==t._fwcObjId&&d._fwcObjType==t._fwcObjType)for(let h of Object.keys(d))t[h]!==void 0&&(d[h]=t[h])}}if(t._fwcObjType===I.OBJ_MARK)for(let l of this.fwcPolicyGridFunctionalityService.policyIterator(this.fwcPolicyObject.getPolicyRules()))l.mark&&t._fwcObjId===l.mark&&(l.mark_name=t._fwcObjName,t.code&&(l.mark_code=t.code))}this.refreshComponent()}}}),this.utilService.getGridScroll().pipe(oe(()=>this.alive)).subscribe(t=>{this.fwcPolicyGridFunctionalityService.showRulesInViewport(this.fwcPolicyObject.getPolicyRules(),t)}),this.utilService.getGridScrollToTop().pipe(oe(()=>this.alive)).subscribe(()=>{setTimeout(()=>{this.policyTable.scrollTo({top:0})},100)}),this.cd.detectChanges()}ngOnDestroy(){this.alive=!1,this.wheelListener&&window.removeEventListener("wheel",this.wheelListener)}refreshComponent(){this.cd.destroyed||this.cd.detectChanges()}onPolicySelect(e,t){if(!e){ri.log(">> Undefined selected policy");return}let n=this.fwcUserService?.getActualFwSelectedCloud?.();if(n!=null&&(this.fwCloud=n,e.fwcloud=n),e._fwcFwId===null||e._fwcFwId===void 0){this.fwcTypesPositions=[],this.fwcPolicyPositions=[],this.fwcSelectedPolicy=e,this.fwcPolicyObject&&this.fwcPolicyObject.setPolicyRules(null),this.fwcPolicyService.setActualPolicy(null),this.refreshComponent();return}if(this.fwcSelectedPolicy&&e._fwcPolicyName!==this.fwcSelectedPolicy._fwcPolicyName&&(this.fwcSelectedPolicy._fwcPolicyName=e._fwcPolicyName),e.fwcloud!==null&&e.fwcloud!==void 0&&e.fwcloud!=this.fwCloud){this.confirmationService.confirm({header:"ERROR",icon:"fa fa-exclamation-circle fwcRed iconBig",message:this.translate.instant("POLICY_GRID.MSG_POL_LOAD_ERROR"),rejectVisible:!1,acceptLabel:"Ok"});return}e._fwcFwId!==null&&e._fwcFwId!==void 0&&this.fwcSelectedPolicy&&e._fwcFwId!=this.fwcSelectedPolicy._fwcFwId&&ri.log(this.translate.instant("POLICY_GRID.MSG_POL_LOAD_FW"));let l={};t||(l._fwcSelectRuleId=e._fwcSelectRuleId,l._fwcSelectRulePositionIds=e._fwcSelectRulePositionIds,l._fwcSelectObjId=e._fwcSelectObjId,l._fwcSelectObjType=e._fwcSelectObjType),l._selectedRules=e._selectedRules;let o=this.fwcSelectedPolicy&&this.fwcSelectedPolicy._fwcFwId==e._fwcFwId&&this.fwcSelectedPolicy._fwcPolicyType==e._fwcPolicyType&&this.fwcSelectedPolicy._fwcObjId===e._fwcObjId;o&&!t?(this.clearHighlightedRules(),l._fwcSelectRuleId!==null&&l._fwcSelectRuleId!==void 0&&(this.highlightRule(l._fwcSelectRuleId,l._fwcSelectRulePositionIds),this.itemSelectedService.setSearchItem(l)),this.refreshComponent()):(this.loadingData=!0,this.refreshComponent(),this.fwcSelectedPolicy&&(this.fwcSelectedPolicy._fwcFwId!=e._fwcFwId||this.fwcSelectedPolicy._fwcPolicyType!=e._fwcPolicyType)&&(this.ruleGroupsExpanded=[],this.ruleSelectedService.clearClipboardRules(),this.ruleSelectedService.clearSelectedRules(),this.itemSelectedService.clearClipboardItem()),Promise.all([this.getPolicy(e._fwcFwId,e._fwcClusterId,e._fwcPolicyType,e._fwcObjId),this.getTypesPositions(),this.getClusterNodes(e._fwcClusterId),this.getRoutingTables(e._fwcFwId,e._fwcPolicyType)]).then(([a,u,d,h])=>{this.fwcPolicyObject=a;let S=a.getPolicyRules(),v=u.data,b=d.data,T=h.data;if(l._selectedRules&&this.ruleSelectedService.updateSelectedRules(l._selectedRules,S),this.clusterNodesItems=[{label:this.translate.instant("RULE.ALL_NODES"),value:null}],b&&Array.isArray(b)&&b.forEach(A=>{this.clusterNodesItems.push({label:A.name,value:A.id,icon:"&#x1F6E1;"})}),T){this.routingTablesItems=[];for(let A of T)this.routingTablesItems.push({label:A.name,value:A.id})}o||(this.fwcPolicyGridFunctionalityService.clearActualViewportInfo(),this.fwcPolicyGridFunctionalityService.resetMaximumRuleHeight(),this.utilService.setGridScrollToTop()),this.parsePolicy(S,v,e),this.ruleSelectedService.clearSelectedRules(),l._fwcSelectRuleId!==null&&l._fwcSelectRuleId!==void 0&&(this.highlightRule(l._fwcSelectRuleId,l._fwcSelectRulePositionIds),this.itemSelectedService.setSearchItem(l))}).catch(a=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(a)})}).finally(()=>{this.loadingData=!1,this.refreshComponent()}))}getPolicy(e,t,n,l){return new Promise((a,u)=>{switch(n){case Ne.POLICY_ROUTING:this.fwcRoutingPolicyService.getRoutingPolicyGrid(e,this.fwCloud).pipe(oe(()=>this.alive)).subscribe(d=>{let h=new kn(this.utilService,this.fwcRoutingPolicyService,this.fwcPolicyGridRoutingRulesFunctionalityService,e,t,this.fwCloud,n,d.data);a(h)},d=>{u(d)});break;case Ne.ROUTING_TABLE:this.fwcRoutingTableService.getRoutingTableRoutesGrid(e,this.fwCloud,l).pipe(oe(()=>this.alive)).subscribe(d=>{let h=new Ii(this.utilService,this.fwcRoutingTableService,this.fwcPolicyGridRoutingTableFunctionalityService,e,t,this.fwCloud,n,d.data,l,this.fwcPolicyService.getActualSelectedPolicy()._fwcPolicyName);a(h)},d=>{u(d)});break;case $[q.DHCP]:this.fwcDhcpPolicyService.getDhcpPolicyGrid(e,this.fwCloud,1).pipe(oe(()=>this.alive)).subscribe(d=>{let h=new Kt(this.utilService,this.fwcDhcpPolicyService,this.fwcPolicyGridDhcpRulesFunctionalityService,e,t,this.fwCloud,n,d.data);a(h)},d=>{u(d)});break;case $[q.DHCP_FIXED_IP]:this.fwcDhcpPolicyService.getDhcpPolicyGrid(e,this.fwCloud,2).pipe(oe(()=>this.alive)).subscribe(d=>{let h=new Kt(this.utilService,this.fwcDhcpPolicyService,this.fwcPolicyGridDhcpRulesFunctionalityService,e,t,this.fwCloud,n,d.data);a(h)},d=>{u(d)});break;case $[q.KEEPALIVED]:this.fwcKeepalivedPolicyService.getKeepalivedPolicyGrid(e,this.fwCloud).pipe(oe(()=>this.alive)).subscribe(d=>{let h=new Si(this.utilService,this.fwcKeepalivedPolicyService,this.fwcPolicyGridKeepalivedRulesFunctionalityService,e,t,this.fwCloud,n,d.data);a(h)},d=>{u(d)});break;case $[q.HAPROXY]:this.fwcHAProxyPolicyService.getHAProxyPolicyGrid(e,this.fwCloud).pipe(oe(()=>this.alive)).subscribe(d=>{let h=new Ci(this.utilService,this.fwcHAProxyPolicyService,this.fwcPolicyGridHAProxyRulesFunctionalityService,e,t,this.fwCloud,n,d.data);a(h)},d=>{u(d)});break;default:this.fwcPolicyService.getPolicy(e,n,this.fwCloud).pipe(oe(()=>this.alive)).subscribe(d=>{let h=new Bn(this.utilService,this.fwcPolicyService,this.fwcPositionFunctionalityService,this.fwcRuleFunctionalityService,e,t,this.fwCloud,n,d.data);a(h)},d=>{u(d)})}})}getTypesPositions(){return new Promise((t,n)=>{this.fwcPositionService.getTypesPositions().pipe(oe(()=>this.alive)).subscribe(l=>{t(l)},l=>{n(l)})})}getClusterNodes(e){return new Promise((n,l)=>{e!=null?this.fwcFirewallService.getClusterNodes(e,this.fwCloud).pipe(oe(()=>this.alive)).subscribe(o=>{n(o)},o=>{l(o)}):n({data:[]})})}getRoutingTables(e,t){return new Promise((l,o)=>{t===Ne.POLICY_ROUTING?this.utilService.fwcAPICall(this.fwcRoutingTableService.getRoutingTables.bind(this.fwcRoutingTableService),e,this.fwcUserService.getActualFwSelectedCloud()).then(a=>{l(a)}).catch(a=>{o(a)}):l({data:null})})}policyRowTrackBy(e,t){return t.id||null}positionObjectsTrackBy(e,t){return t.id||null}parsePolicy(e,t,n){return le(this,null,function*(){let l=!1,o=[],a,u=0;if(!n||!e||!t){ri.log("Wrong data in policy parsing");return}n._fwcUserId=this.fwcUser,n.show_action=!(n._fwcPolicyType===$[q.POLICY_SNAT]||n._fwcPolicyType===$[q.POLICY_DNAT]||n._fwcPolicyType===$[q.POLICY_ROUTING]||n._fwcPolicyType===$[q.ROUTING_TABLE]||n._fwcPolicyType===$[q.DHCP]||n._fwcPolicyType===$[q.DHCP_FIXED_IP]||n._fwcPolicyType===$[q.KEEPALIVED]||n._fwcPolicyType===$[q.HAPROXY]),Object.keys(e).length===0&&e.constructor===Object&&(e=[]);for(let d of e){u++,d._fwcRuleOrder=u,d._fwcUserId=this.fwcUser,d._fwcClusterId=n._fwcClusterId,d.formModel={action:d.action,comment:d.comment,fw_apply_to:d.fw_apply_to,mark:d.mark,style:d.style,active:d.active,run_before:d.run_before,routingTableId:d.routingTableId,max_lease:d.max_lease,cfg_text:d.cfg_text},d.idgroup&&(l=!0);let h=d.negate,S=[];if(h&&(S=h.split(" ").map(v=>Number(v))),Array.isArray(d.positions)){let v=0;for(let b=0;b<d.positions.length;b++){let T=d.positions[b],A=`${d.firewall}-${d.id}-${T.id}`;T.positionUID=A.split("").reduce(function(j,D){return j=(j<<5)-j+D.charCodeAt(0),j&j},0),T.rule=d.id;let N=+T.id;if(S&&S.findIndex(j=>j==N)!=-1&&(T.negate=!0),Array.isArray(T.ipobjs)){T.ipobjs.length>v&&(v=T.ipobjs.length);for(let j=0;j<T.ipobjs.length;j++){let D=T.ipobjs[j];D.position_order!=j+1&&(D.position_order=j+1),D.type=+D.type,D.type==I.OBJ_CONTINENT?D._fwcObjName=this.translate.instant("NODE_TYPES."+D.name):D.type==I.OBJ_COUNTRIE?D._fwcObjName=this.translate.instant("COUNTRIES."+D.name):D._fwcObjName=D.name,D._fwcObjType=D.obj_type=D.type,D._fwcObjId=D.id_obj=D.id,D._fwcFwId=D.parent_id=D.firewall_id,D._fwcFwName=D.firewall_name,D._fwcRuleId=d.id,D._fwcPositionId=T.id,D._fwcUserId=this.fwcUser,D._fwcOpenVPNId=D.openvpn,D._fwcWireguardId=D.wireguard,D.cluster_id!==void 0&&D.cluster_id!==null&&(D.parent_id=D._fwcClusterId=D.cluster_id),D.host_id!==void 0&&D.host_id!==null&&(D.parent_id=D._fwcHostId=D.host_id)}}else T.ipobjs=[];T.ipobjs.push({_fwcObjId:I.OBJ_ANY,_fwcObjName:`${d.special==ke.CROWDSEC&&T.name=="Source"?"":"(Any)"}`,_fwcObjType:I.OBJ_ANY,allowDrag:!1,hidden:!0})}this.fwcPolicyGridFunctionalityService.calcRuleHeight(d,v)}}e[0]&&e[0].positions&&(a=e[0].positions);for(let d of t){let h=d.type,S=d.position;o[S]||(o[S]=[]),o[S].push(h)}l&&(e=this.parsePolicyWithGroups(e)),this.virtualScrollEnabled=Array.isArray(e)&&e.length>this.virtualScrollThreshold,this.updateVirtualRowHeight(),this.fwcPolicyGridFunctionalityService.showRulesInViewport(e),this.fwcTypesPositions=o,this.fwcPolicyObject.setPolicyRules(e),this.fwcPolicyPositions=a,this.fwcSelectedPolicy=n,this.numberOfGridColumns=a?a.length+2:0,this.fwcSelectedPolicy._fwcClusterId!==null&&this.fwcSelectedPolicy._fwcClusterId!==void 0&&this.numberOfGridColumns++,this.fwcSelectedPolicy.show_action&&this.numberOfGridColumns++,this.fwcSelectedPolicy._fwcPolicyType===Ne.POLICY_ROUTING&&this.numberOfGridColumns++,this.fwcSelectedPolicy._fwcPolicyType===$[q.DHCP]&&this.numberOfGridColumns++,this.fwcSelectedPolicy._fwcPolicyType===$[q.DHCP_FIXED_IP]&&this.numberOfGridColumns++,this.fwcSelectedPolicy._fwcPolicyType===$[q.KEEPALIVED]&&this.numberOfGridColumns++,this.fwcSelectedPolicy._fwcPolicyType===$[q.HAPROXY]&&this.numberOfGridColumns++,this.fwcPolicyService.setActualPolicy(e)})}parsePolicyWithGroups(e){let t=[];for(let n=0;n<e.length;n++){let l=e[n];if(!l.idgroup)t.push(l);else{let o=l.idgroup,a={rule_group:!0,idgroup:o,group_name:l.group_name,group_style:l.group_style,rules:[],groupHide:!0};this.fwcPolicyGridFunctionalityService.calcRuleHeight(a),this.ruleGroupsExpanded.findIndex(d=>d==a.idgroup)!=-1&&(a.groupHide=!1);let u;for(u=n;u<e.length&&e[u].idgroup==o;u++)a.rules.push(e[u]);t.push(a),n=u-1}}return t}isRuleSelected(e){for(let t=0;t<this.selectedRules.length;t++)if(this.selectedRules[t].id==e.id)return!0;return!1}clearHighlightedRules(){let e=this.fwcPolicyObject.getPolicyRules();if(e){let t=[],n=e;if(n&&n.length)for(t.push(...n);t.length;){let l=t.pop();if(l.highlighted&&delete l.highlighted,l.positions)for(let o=0;o<l.positions.length;o++)l.positions[o].highlighted&&delete l.positions[o].highlighted;l.rule_group&&l.rules&&l.rules.length&&t.push(...l.rules)}}}highlightRule(e,t){this.expandGroup(e);let n=this.fwcPolicyObject.getPolicyRules();if(n){let l=n;if(l&&l.length)for(let d=0;d<l.length;d++){let h=l[d];if(h.rule_group&&h.rules&&h.rules.length)for(let S=0;S<h.rules.length;S++){let v=h.rules[S];if(v.id===e){this.highlightRulePosition(v,t);break}}else if(h.id===e){this.highlightRulePosition(h,t);break}}this.refreshComponent();let o=document.querySelector("#rule_"+e),a=0,u=Array.from(document.querySelectorAll("tr"));for(let d of u)a+=d.clientHeight;if(o){let d=o.clientHeight,h=a;a=0;for(let S of u){if(S===o)break;a+=S.clientHeight}a<h&&(a-=d),this.policyTable.scrollTo({top:a,behavior:"smooth"})}}}highlightRulePosition(e,t){let n=!1;if(Array.isArray(t)||(t=[]),e&&e.positions){for(let l=0;l<e.positions.length;l++){let o=e.positions[l];t.find(a=>a===o.id)&&(o.highlighted=!0,n=!0,setTimeout(()=>{o.highlighted=!1,this.refreshComponent()},4e3))}n||(e.highlighted=!0,setTimeout(()=>{e.highlighted=!1,this.refreshComponent()},4e3))}}expandGroup(e){let t=this.fwcPolicyObject.getPolicyRules();if(t){let n=t;if(n&&n.length){for(let l=0;l<n.length;l++)if(n[l].rule_group){let o=n[l],a=o.rules;a&&a.length&&a.find(d=>d.id===e)&&this.toggleGroupVisible(o,!1)}}}}toggleGroupVisible(e,t){t===!0||t===!1?e.groupHide=t:e.groupHide=!e.groupHide,!e.groupHide&&this.ruleGroupsExpanded.findIndex(n=>n===e.idgroup)==-1&&this.ruleGroupsExpanded.push(e.idgroup),e.groupHide&&(this.ruleGroupsExpanded=this.ruleGroupsExpanded.filter(n=>n!==e.idgroup)),this.fwcPolicyGridFunctionalityService.showRulesInViewport(this.fwcPolicyObject.getPolicyRules())}createNewRule(e){e.newPolicyRule()}policyReload(e){let t={};t=Object.assign(this.fwcSelectedPolicy),t._forcePolicyReload=!0,e&&(t._selectedRules=e.slice(0)),this.fwcPolicyService.setSelectedPolicy(t)}onRuleEnter(e,t){e.highlighted&&delete e.highlighted,this.itemSelectedService.setObjectInfo(void 0,t)}contextMenuLoad(e,t){let n=this.ruleGroupContextMenu.RULE_GROUP.items;if(n)for(let l=0;l<n.length;l++){let o=n[l];o.id==k.FOLDER_EXPAND?o.visible=!!e.groupHide:o.id==k.FOLDER_COLLAPSE?o.visible=!e.groupHide:this.fwcUserLock||(o.enabled=!1)}}contextMenuHandler(e,t,n){let l=t.rules[0];if(n.detail.item)switch(n.detail.item.id){case k.FOLDER_EXPAND:case k.FOLDER_COLLAPSE:this.toggleGroupVisible(t);break;case k.RULE_GROUP_EDIT:case k.RULE_GROUP_COLOR_CHANGE:{let o={id:l.idgroup,fwcloud:this.fwcUserService.getActualFwSelectedCloud(),firewall:l.firewall,style:t.group_style,name:t.group_name,comment:void 0,groupIds:[]},a={header:this.translate.instant("POLICY_GRID.GR_NAME.HEADER"),helpText:this.translate.instant("POLICY_GRID.GR_NAME.TEXT"),formControls:[{name:"groupData",type:"hidden",value:o},{name:"group",type:"hidden",value:t},{name:"policyType",type:"hidden",value:e.getPolicyType()}],onAccept:e.setRuleGroupNameApiCall()};n.detail.item.id==k.RULE_GROUP_EDIT?(a.formControls.push({name:"groupName",label:this.translate.instant("POLICY_GRID.GR_NAME.NAME"),type:"text",required:!0,value:t.group_name}),this.inputDataService.setInputData(a)):(a.formControls.push({name:"groupColor",placeholder:this.translate.instant("RULE.COLOR_PLACEHOLDER"),type:"colorpicker",value:t.group_style}),a.header=this.translate.instant("RULE.COLOR_HEADER"),a.helpText=this.translate.instant("RULE.GROUP_COLOR_TEXT"),a.onAccept=e.setRuleGroupStyleApiCall(),this.inputDataService.setInputData(a));break}case k.RULE_REMOVE_GROUP:l.idgroup&&this.confirmationService.confirm({header:this.translate.instant("GLOBALS.MSG_CONFIRM"),icon:"fa fa-question-circle fwcBlue iconBig",message:this.translate.instant("POLICY_GRID.GR_DELETE",{name:l.group_name}),rejectVisible:!0,rejectLabel:"No",acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.YES"),accept:()=>{e.deleteRuleGroupApiCall(l.idgroup).then(o=>{this.store.dispatch(Ce.reloadDialog({dialogUuids:[Z.ITEM_PANEL]}));let a=[];a.push(l),this.policyReload(a)}).catch(o=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(o)})})}});break}}onKeyup(e){if(e&&e.key&&e.target.nodeName==="BODY"){let t=e.key.toUpperCase(),n=e.ctrlKey,l=e.shiftKey;if(n){let o=this.ruleSelectedService.getActualSelectedRules(),a=this.ruleSelectedService.getActualClipboardRules();if(t=="C"&&o&&(e.preventDefault(),this.ruleSelectedService.copyRulesToClipboard()),t=="X"&&o&&(e.preventDefault(),this.ruleSelectedService.cutRulesToClipboard()),t=="V"&&o&&a){e.preventDefault();let u=k.PASTE_BELOW,d=o[o.length-1];l&&(u=k.PASTE_ABOVE,d=o[0]),this.fwcRuleFunctionalityService.pasteSelectedRules(this.fwcPolicyObject,d,a,u)}if((t==="ARROWUP"||t==="ARROWDOWN")&&o){e.preventDefault();let u=o[o.length-1],d=k.RULE_MOVE_BELOW;t==="ARROWUP"&&(u=o[0],d=k.RULE_MOVE_ABOVE);let h;h=this.fwcRuleFunctionalityService.newRulesData(u,o,d,de.CUT),this.fwcRuleFunctionalityService.moveSelectedRules(u,h)}}if(t=="DELETE"){let o=this.ruleSelectedService.getActualSelectedRules();if(e.preventDefault(),o){let a=o[0];this.fwcRuleFunctionalityService.deleteSelectedRules(this.fwcPolicyObject,a,o,k.RULE_DELETE)}}}}getPolicyRulesLength(){let e=0,t=this.fwcPolicyObject.getPolicyRules();if(t)for(let n=0;n<t.length;n++){let l=t[n];l.rules?e+=l.rules.length:e++}return e}onPageChange(e){this.refreshComponent()}getColumnsCount(){let e=this.numberOfGridColumns;return this.columnVisibility.comments===!1&&(e-=1),this.fwcSelectedPolicy&&this.fwcSelectedPolicy._fwcClusterId!==null&&this.fwcSelectedPolicy._fwcClusterId!==void 0&&this.fwcSelectedPolicy._fwcPolicyType!==$[q.DHCP]&&this.fwcSelectedPolicy._fwcPolicyType!==$[q.DHCP_FIXED_IP]&&this.columnVisibility.applyTo===!1&&(e-=1),this.fwcSelectedPolicy&&this.fwcSelectedPolicy._fwcPolicyType===$[q.DHCP_FIXED_IP]?(e-=1,this.fwcSelectedPolicy._fwcClusterId!==null&&this.fwcSelectedPolicy._fwcClusterId!==void 0&&(e-=1)):(this.fwcSelectedPolicy&&this.fwcSelectedPolicy._fwcPolicyType===$[q.DHCP]&&this.fwcSelectedPolicy._fwcClusterId!==null&&this.fwcSelectedPolicy._fwcClusterId!==void 0||this.fwcSelectedPolicy&&this.fwcSelectedPolicy._fwcPolicyType===$[q.HAPROXY]&&this.fwcSelectedPolicy._fwcClusterId!==null&&this.fwcSelectedPolicy._fwcClusterId!==void 0||this.fwcSelectedPolicy&&this.fwcSelectedPolicy._fwcPolicyType===$[q.KEEPALIVED]&&this.fwcSelectedPolicy._fwcClusterId!==null&&this.fwcSelectedPolicy._fwcClusterId!==void 0)&&(e-=1),e}getManualRulePlaceholderColspan(e){let t=this.getColumnsCount(),n=this.fwcSelectedPolicy?._fwcPolicyType,l=this.columnVisibility?.comments!==!1,o=!!this.fwcSelectedPolicy?.show_action,a=n===$[q.DHCP],u=this.shouldShowApplyToColumn(e),d=[$[q.DHCP],$[q.DHCP_FIXED_IP],$[q.HAPROXY],$[q.KEEPALIVED]];if(n!==void 0&&d.includes(n)){let b=0;o&&(!e||e.special!==ke.HOOKSCRIPT&&e.special!==ke.FAIL2BAN)&&b++,a&&(!e||e.special!==ke.HOOKSCRIPT)&&b++,u&&(b++,l&&b++);let N=t-(1+b);return N>0?N:1}return this.fwcSelectedPolicy?._fwcClusterId!==null&&this.fwcSelectedPolicy?._fwcClusterId!==void 0?t-3:t-1}shouldShowApplyToColumn(e){return e?this.columnVisibility?.applyTo!==!1&&e._fwcClusterId!==null&&e._fwcClusterId!==void 0:!1}isObjectTypesValid(e){return[I.OBJ_INTERFACE_FIREWALL,I.OBJ_ADDRESS,I.OBJ_OPENVPN_PREFIX,I.OBJ_WIREGUARD_PREFIX,I.OBJ_IPSEC_PREFIX,I.OBJ_DHCP_RULE_INTERFACE,I.OBJ_OPENVPN_CONFIG_CLI,I.OBJ_WGC_CONFIG_CLI,I.OBJ_ISC_CONFIG_CLI].includes(e)}isPolicyNotInSelected(e){return![$[q.HAPROXY],$[q.DHCP]].includes(e)}adjustMenuPosition(e){requestAnimationFrame(()=>{let t=document.querySelector("iui-contextmenu-win");t&&(t.classList.add("context-menu-hidden"),setTimeout(()=>{if(t&&t.shadowRoot){let l=t.shadowRoot.querySelector('[data-ctrl="contextmenu-win"]');if(l){let o=l.getBoundingClientRect(),a=window.innerHeight,u=window.innerWidth,d=e.detail.event.pageX,h=e.detail.event.pageY,S=h,v=d;h+o.height>a&&(S=h-o.height,S<0&&(S=0)),d+o.width>u&&(v=d-o.width,v<0&&(v=0)),l.style.top=`${S}px`,l.style.left=`${v}px`,t.classList.remove("context-menu-hidden"),t.classList.add("context-menu-visible")}}},30))})}closeContextMenu(){setTimeout(()=>{let e=document.querySelector("iui-contextmenu-win");if(e&&e.shadowRoot){let n=e.shadowRoot.querySelector('[data-ctrl="contextmenu-win"]');n&&(n.style.display="none")}},50)}};s.\u0275fac=function(t){return new(t||s)(L(zo),L(fe),L(ye),L(il),L(Cn),L(Sn),L(He),L(Ue),L(Wi),L(Gn),L(Un),L(xn),L(Rn),L(gi),L(wi),L(jn),L(zi),L(Vn),L(qi),L(Wn),L(ge),L(fn),L(be),L(Le),L(Ee),L(xt),L(me),L(Se),L(we),L(ue))},s.\u0275cmp=je({type:s,selectors:[["sts-fwc-policy-grid"]],viewQuery:function(t,n){if(t&1&&(_e(Xr,5),_e(zr,5)),t&2){let l;se(l=ce())&&(n.gridPaginator=l.first),se(l=ce())&&(n.policyTable=l.first)}},hostBindings:function(t,n){t&1&&P("keyup",function(o){return n.onKeyup(o)},Ao)},standalone:!1,features:[Ve([fe,Sn,Gn,Un,xn,Rn,gi,jn,Vn,Wn])],decls:8,vars:4,consts:[["fwcGridRule",""],["showFwHeader",""],["showTable",""],["noData",""],["policyTable",""],["colgroup",""],["header",""],["body",""],["ruleGroup",""],["ruleNormal",""],["noRulesInGroup",""],["gridPaginator",""],["paginatorInfo",""],["showRulePlaceholder",""],["specialHookScriptRulePlaceholder",""],["fwcPositionEl",""],["objectName",""],["labelName",""],["tdActionPosition",""],["selectedItem",""],["item",""],["divMarkContainer",""],["class","fwcIconHeader",4,"ngIf"],["class","divTableScroll fwcDivPadded fwcDivPaddedTB",4,"ngIf"],[3,"blocked"],[1,"flex","h-full","w-full","items-center","justify-center"],["class","fixed bottom-4 left-1/2 flex -translate-x-1/2 items-center rounded-full bg-[rgba(255,255,255,0.7)] px-4 py-1",4,"ngIf"],[1,"fwcIconHeader"],[1,"fa","fa-eye"],[1,"divTableScroll","fwcDivPadded","fwcDivPaddedTB"],[1,"divFormHeader","fwcHead"],[1,"fwcLeftIcon"],[4,"ngIf","ngIfElse"],[1,"fwcBlue"],[1,"fwcSep"],[1,"flex","h-full","gap-[1.3rem]","justify-between","items-center"],["styleClass","fwc-settings-btn","icon","pi pi-cog",3,"onClick",4,"ngIf"],["styleClass","fwc-reload-btn","icon","fwci-loadpolicy",3,"onClick","label"],[4,"ngIf","ngIfThen","ngIfElse"],["aria-hidden","true",1,"fwcMenuIcon","fwci-cluster","text-(--fwcOrange)"],["aria-hidden","true",1,"fwcMenuIcon","fwci-firewall","text-(--fwcOrange)"],["styleClass","fwc-settings-btn","icon","pi pi-cog",3,"onClick"],["position","right",3,"visible","baseZIndex","visibleChange",4,"ngIf"],[1,"p-table-wrapper","overflow-x-auto","fwcGridTable"],[3,"value","rowTrackBy","resizableColumns","scrollable","virtualScrollOptions","virtualScroll","virtualScrollItemSize","scrollHeight"],[4,"ngIf"],["position","right",3,"visibleChange","visible","baseZIndex"],[1,"flex","flex-col","gap-4"],[1,"w-full"],[1,"botBorder","text-(--fwcBlue)"],[1,"flex","flex-col","gap-2"],["class","w-full",4,"ngIf"],["inputId","comments","name","comments","binary","true",3,"ngModelChange","ngModel"],["for","comments"],[1,"mt-4"],["type","button",3,"onClick","label","styleClass"],[4,"ngFor","ngForOf"],[2,"text-align","center"],["pResizableColumn","",3,"width",4,"ngFor","ngForOf"],["pResizableColumn","",4,"ngIf"],["pResizableColumn","","class","fwcApplyToColumn",4,"ngIf"],["pResizableColumn","","style","width:6rem",4,"ngIf"],["pResizableColumn",""],["pResizableColumn","",1,"fwcApplyToColumn"],["pResizableColumn","",2,"width","6rem"],[1,"fwcGridGroup"],[1,"context-menu-wrapper"],["contextMenuRef","contextMenuReference",3,"menuOpening","menuClick","allowAnimation","customStyle","colorScheme","settings"],[1,"clickable-area",2,"padding","0.5rem"],[3,"click"],["class","fa fa-fw fa-chevron-down","aria-hidden","true",4,"ngIf"],["class","fa fa-fw fa-chevron-right","aria-hidden","true",4,"ngIf"],["showDelay","700","tooltipPosition","bottom",1,"spanGroupName",3,"pTooltip","escape"],["aria-hidden","true",1,"fwcMenuIcon","fwci-objectgroup","fwcOrange"],[1,"inline-block"],["aria-hidden","true",1,"fa","fa-fw","fa-chevron-down"],["aria-hidden","true",1,"fa","fa-fw","fa-chevron-right"],[4,"ngFor","ngForOf","ngForTrackBy"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"onPageChange","rows","totalRecords","alwaysShow","templateLeft"],[1,"p-paginator-current"],[1,"flex","flex-col","items-center"],[3,"message"],[1,"w-full","text-center"],["type","button","icon","fa fa-plus",3,"onClick","label"],[1,"fixed","bottom-4","left-1/2","flex","-translate-x-1/2","items-center","rounded-full","bg-[rgba(255,255,255,0.7)]","px-4","py-1"],[1,"ml-2","text-(--fwcBlue)"],[3,"mouseenter","id","ngClass"],["showDelay","700","tooltipPosition","bottom",1,"fwc-centered",2,"filter","none !important",3,"click","dblclick","pTooltip","escape"],[1,"clickable-area"],[3,"menuOpening","menuClick","allowAnimation","customStyle","colorScheme","settings"],[1,"fwcCont",3,"ngClass"],["class","leftRibbon",4,"ngIf"],[1,"fwcRuleOrder"],["class","fwcRuleOptions",4,"ngIf"],["class","fwcActionPosition tdActionCell p-resizable-column",3,"dragenter","dragleave","dragover","drop",4,"ngIf"],["class","fwcActionPosition fwcApplyToColumn p-resizable-column",4,"ngIf"],["class","fwcPositionTd p-resizable-column",4,"ngIf"],["class","fwcCommentPosition p-resizable-column",4,"ngIf"],[1,"leftRibbon"],[1,"fa","fa-times","fwcWhite"],[1,"fwcRuleOptions"],[1,"fa","fa-fw","fa-cog",3,"ngClass"],[1,"fa","fa-file-code","fwcOrange"],["class","fwcPositionTd p-resizable-column",4,"ngFor","ngForOf"],[1,"fwcPositionTd","p-resizable-column"],[1,"divFwcPosition",3,"dragenter","dragleave","dragover","drop","ngClass"],[2,"height","100%","width","100%"],[1,"divFwcPosition-item",3,"click","dblclick","mouseenter","mouseleave","dragstart","ngClass","draggable"],["class","fwcIcon fwci-negateposition fwcRed","aria-hidden","true",4,"ngIf"],["class","spanActionSpecial",4,"ngIf"],[1,"fwc-label-grid"],["class","fwcPaleDark",4,"ngIf"],[1,"fwc-label-grid-name"],["aria-hidden","true","width","18","height","18",3,"class","src",4,"ngIf"],["aria-hidden","true",3,"class",4,"ngIf"],["aria-hidden","true"],["aria-hidden","true",1,"fwcIcon","fwci-negateposition","fwcRed"],[1,"spanActionSpecial"],[1,"fwcIcon","fwci-address","fwcBlue"],[1,"fwcPaleDark"],["aria-hidden","true","width","18","height","18",3,"src"],[1,"fwcTextArea"],["ondragstart","() => {return false}","ondrop","() => {return false}",2,"border","0",3,"ngModelChange","focus","ngModel"],["appendTo","body",3,"ngModelChange","onChange","options","ngModel","disabled"],[1,"fwcActionPosition","tdActionCell","p-resizable-column",3,"dragenter","dragleave","dragover","drop"],[1,"divFwcPosition"],[3,"options","ngModel","styleClass","disabled","ngModelChange","onChange",4,"ngIf"],["class","divMarkContainer",4,"ngIf"],[3,"ngModelChange","onChange","options","ngModel","styleClass","disabled"],[1,"fa","fa-fw","fa-check","fwcOrange"],[1,"divMarkContainer"],["class","divMarkPlaceholder",4,"ngIf"],["class","divMark",3,"mouseenter","mouseleave","wheel","dblclick",4,"ngIf"],[1,"divMarkPlaceholder"],["aria-hidden","true",1,"fa","fa-arrow-circle-down","fwcGreen"],[1,"divMark",3,"mouseenter","mouseleave","wheel","dblclick"],[1,"divMark--label"],[1,"fwci2-label"],[1,"divMark--button"],[1,"fa","fa-times",3,"click"],[1,"fwcActionPosition","fwcApplyToColumn","p-resizable-column"],["name","max_lease_time","type","number",2,"text-align","right",3,"ngModelChange","focus","blur","id","ngModel"],[1,"fwcCommentPosition","p-resizable-column"],[3,"ngClass"],["maxlength","255","ondragstart","() => {return false}","ondrop","() => {return false}",3,"ngModelChange","focus","blur","ngModel","placeholder","disabled"],[1,"fwcRulePlaceholder",3,"id"],[1,"fwc-centered",2,"filter","none !important"],["class","fwcGroupSpacerDiv",4,"ngIf"],[1,"fwcGroupSpacerDiv"],[1,"fa","fa-cog",3,"ngClass"],[1,"fa","fa-terminal","fwcOrange"]],template:function(t,n){t&1&&(J(0,na,4,3,"h1",22)(1,Ba,23,14,"div",23),p(2,"p-blockUI",24)(3,"div",25),O(4,"p-progressSpinner"),f()(),J(5,ja,4,4,"div",26)(6,Fs,3,2,"ng-template",null,0,pe)),t&2&&(m("ngIf",!(n.fwcPolicyObject!=null&&n.fwcPolicyObject.getPolicyRules())),c(),m("ngIf",!!(n.fwcPolicyObject!=null&&n.fwcPolicyObject.getPolicyRules())),c(),m("blocked",n.loadingData),c(3),m("ngIf",n.ruleStatus))},styles:[".p-datatable-scrollable>.p-datatable-table-container{width:100%}.fwcSticky[_ngcontent-%COMP%]{padding-top:0!important}div.fwcDivRPad[_ngcontent-%COMP%]{padding-right:1.5rem!important}.divGridLoader[_ngcontent-%COMP%]{display:flex;align-items:center;position:fixed;bottom:1rem;left:50%;transform:translate(-50%);padding:.2rem 1rem;background:#ffffffb3;border-radius:1rem}.divGridLoader[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-left:.3rem}.id-column[_ngcontent-%COMP%]{min-width:100%;min-height:44px;height:100%}.max-lease[_ngcontent-%COMP%]{min-height:44px}.context-menu-wrapper[_ngcontent-%COMP%]{width:100%;height:100%}.clickable-area[_ngcontent-%COMP%]{display:block;width:100%;height:100%}tr[_ngcontent-%COMP%]{height:100%}  .fwc-right-float p-button:first-child{margin-bottom:2px}  .context-menu-hidden{opacity:0;transform:scale(.95)}  .context-menu-visible{transition:opacity .4s ease,transform .4s ease;opacity:1;transform:scale(1)}  .p-drawer-header{justify-content:end!important}  .fwc-settings-btn.p-button.p-button-icon-only{padding:1.094rem .95rem}  .fwc-reload-btn.p-button{min-height:35.72px!important}  .fwc-reload-btn.p-button>span{margin-top:.1rem}"],changeDetection:0});let r=s;return r})();var Ls=["fwcTreeAccordion"],Ms=["sts-fwc-tree-accordion",""],Ds=["*"],pr=(()=>{let s=class s{hostWindowResize(){this.subjectWindowResized.next(void 0)}constructor(){this.subjectWindowResized=new sn,this.alive=!0}ngOnInit(){}ngAfterViewInit(){this.containerHeight=this.fwcTreeAccordion.nativeElement.offsetHeight,this.calcPanels(),this.treePanels.forEach(e=>{e.onChange().pipe(oe(()=>this.alive)).subscribe(()=>{this.calcPanels()})}),this.onWindowResize().pipe(cn(300),oe(()=>this.alive)).subscribe(()=>{this.containerHeight=this.fwcTreeAccordion.nativeElement.offsetHeight,this.calcPanels()})}ngOnDestroy(){this.alive=!1}calcPanels(){let e=0,t=[],n,l=0;if(this.treePanels){if(this.treePanels.forEach(o=>{e+=o.expanded?0:1,l||(l=o.getMinHeight()),t.push(o)}),e<t.length){n=(this.containerHeight-e*l)/(t.length-e);for(let o=0;o<t.length;o++){let a=t[o];a.expanded?a.setHeight(n):a.setHeight(l)}}for(let o=0;o<t.length;o++){let a=t[o];setTimeout(()=>{a.divContent.nativeElement.querySelector("iui-treeview").updateLayout()},300)}}}onWindowResize(){return this.subjectWindowResized.asObservable()}};s.\u0275fac=function(t){return new(t||s)},s.\u0275cmp=je({type:s,selectors:[["","sts-fwc-tree-accordion",""]],contentQueries:function(t,n,l){if(t&1&&It(l,Ln,4),t&2){let o;se(o=ce())&&(n.treePanels=o)}},viewQuery:function(t,n){if(t&1&&_e(Ls,5),t&2){let l;se(l=ce())&&(n.fwcTreeAccordion=l.first)}},hostBindings:function(t,n){t&1&&P("resize",function(){return n.hostWindowResize()},Fo)},standalone:!1,attrs:Ms,ngContentSelectors:Ds,decls:3,vars:0,consts:[["fwcTreeAccordion",""],[1,"fwcTreeAccordion"]],template:function(t,n){t&1&&(Fi(),p(0,"div",1,0),Ai(2),f())},styles:[".fwcTreeAccordion[_ngcontent-%COMP%]{box-sizing:border-box;width:100%;height:100%;padding-left:.5rem;padding-right:.5rem}"]});let r=s;return r})();var Us=["compileLog"];function ks(r,s){r&1&&(p(0,"div",7)(1,"h6",10),O(2,"i",11),C(3),y(4,"translate"),f()()),r&2&&(c(3),F(" ",E(4,1,"COMPILE.FORM.SELECT")," "))}function Bs(r,s){r&1&&(p(0,"div",7)(1,"h6",10),O(2,"i",12),C(3),y(4,"translate"),f()()),r&2&&(c(3),F(" ",E(4,1,"COMPILE.FORM.COMP_INST")," "))}function js(r,s){if(r&1){let i=M();x(0,ks,5,3,"div",7),x(1,Bs,5,3,"div",7),p(2,"div",8)(3,"button",9),P("click",function(){w(i);let t=_();return g(t.onHeaderMinimize())}),f()()}if(r&2){let i=_();R(i.displaySelectOptions?0:-1),c(),R(i.displayCompileOptions?1:-1)}}function Vs(r,s){if(r&1&&(p(0,"span"),O(1,"i",19),C(2),f()),r&2){let i=_().$implicit;c(2),F("\xA0",i.name," ")}}function Ws(r,s){if(r&1&&(p(0,"span"),O(1,"i",20),C(2,"\xA0"),p(3,"strong"),C(4),f(),C(5," ("),p(6,"strong"),C(7),f(),C(8),f()),r&2){let i=_().$implicit;c(4),U(i.name),c(3),U(i.fwnodes==null?null:i.fwnodes.length),c(),F(" node",(i.fwnodes==null?null:i.fwnodes.length)>1?"s":"",") ")}}function Hs(r,s){if(r&1&&(p(0,"span"),C(1),y(2,"date"),f()),r&2){let i=_().$implicit;c(),U(oi(2,1,i.compiled_at,"yyyy-MM-dd HH:mm:ss"))}}function Js(r,s){r&1&&(p(0,"span"),C(1,"-"),f())}function Ys(r,s){if(r&1&&(p(0,"span"),C(1),y(2,"date"),f()),r&2){let i=_().$implicit;c(),U(oi(2,1,i.installed_at,"yyyy-MM-dd HH:mm:ss"))}}function Ks(r,s){r&1&&(p(0,"span"),C(1,"-"),f())}function Xs(r,s){if(r&1){let i=M();p(0,"tr")(1,"td"),x(2,Vs,3,1,"span"),x(3,Ws,9,3,"span"),f(),p(4,"td")(5,"p-checkbox",18),H("ngModelChange",function(t){let n=w(i).$index,l=_(3);return W(l.compileChecks[n],t)||(l.compileChecks[n]=t),g(t)}),P("onChange",function(t){w(i);let n=_(3);return g(n.checkCompileInstallCheckboxes(t))}),f()(),p(6,"td")(7,"p-checkbox",18),H("ngModelChange",function(t){let n=w(i).$index,l=_(3);return W(l.installChecks[n],t)||(l.installChecks[n]=t),g(t)}),P("onChange",function(t){w(i);let n=_(3);return g(n.checkCompileInstallCheckboxes(t))}),f()(),p(8,"td"),x(9,Hs,3,4,"span"),x(10,Js,2,0,"span"),f(),p(11,"td"),x(12,Ys,3,4,"span"),x(13,Ks,2,0,"span"),f()()}if(r&2){let i=s.$implicit,e=s.$index,t=_(3);c(2),R(i.cluster===null?2:-1),c(),R(i.cluster!==null?3:-1),c(2),m("name","compile_"+i.id),V("ngModel",t.compileChecks[e]),m("binary",!0),c(2),m("name","install_"+i.id),V("ngModel",t.installChecks[e]),m("binary",!0),c(2),R(i!=null&&i.compiled_at?9:-1),c(),R(i!=null&&i.compiled_at?-1:10),c(2),R(i!=null&&i.installed_at?12:-1),c(),R(i!=null&&i.installed_at?-1:13)}}function zs(r,s){if(r&1){let i=M();p(0,"div",13)(1,"table",15)(2,"thead")(3,"tr")(4,"th"),C(5),y(6,"translate"),f(),p(7,"th")(8,"p-checkbox",16),H("ngModelChange",function(t){w(i);let n=_(2);return W(n.compileAllCheck,t)||(n.compileAllCheck=t),g(t)}),P("onChange",function(){w(i);let t=_(2);return g(t.compileOrInstallAll(!1))}),f(),C(9),y(10,"translate"),f(),p(11,"th")(12,"p-checkbox",17),H("ngModelChange",function(t){w(i);let n=_(2);return W(n.installAllCheck,t)||(n.installAllCheck=t),g(t)}),P("onChange",function(){w(i);let t=_(2);return g(t.compileOrInstallAll(!0))}),f(),C(13),y(14,"translate"),f(),p(15,"th"),C(16),y(17,"translate"),f(),p(18,"th"),C(19),y(20,"translate"),f()()(),p(21,"tbody"),Et(22,Xs,14,12,"tr",null,yt),f()()()}if(r&2){let i=_(2);c(5),U(E(6,9,"GLOBALS.MSG_OBJ_TYPES.FIREWALL")),c(3),V("ngModel",i.compileAllCheck),m("binary",!0),c(),F(" ",E(10,11,"CONTEXT.FW.COMPILE")," "),c(3),V("ngModel",i.installAllCheck),m("binary",!0),c(),F(" ",E(14,13,"CONTEXT.FW.INSTALL")," "),c(3),U(E(17,15,"COMPILE.FORM.LAST_COMP")),c(3),U(E(20,17,"COMPILE.FORM.LAST_INST")),c(3),vt(i.firewalls)}}function qs(r,s){if(r&1&&(p(0,"div",13),O(1,"sts-fwc-message",21),f()),r&2){let i=_(2);c(),m("message",i.errorMessage)}}function Qs(r,s){r&1&&(p(0,"div",14),O(1,"p-progressSpinner"),f())}function $s(r,s){if(r&1&&(p(0,"div",5),x(1,zs,24,19,"div",13),x(2,qs,2,1,"div",13),x(3,Qs,2,0,"div",14),f()),r&2){let i=_();c(),R(i.firewalls&&i.firewalls.length?1:-1),c(),R(i.errorMessage?2:-1),c(),R(i.loadingData?3:-1)}}function Zs(r,s){if(r&1&&(p(0,"span"),O(1,"i",20),C(2,"\xA0"),p(3,"strong"),C(4),f()()),r&2){let i=_(2).$implicit;c(4),U(i.firewallName)}}function ec(r,s){if(r&1&&(p(0,"span"),O(1,"span",32)(2,"i",19),C(3),f()),r&2){let i=_(2).$implicit;c(3),F("\xA0",i.firewallName)}}function tc(r,s){if(r&1&&(p(0,"td"),x(1,Zs,5,1,"span"),x(2,ec,4,1,"span"),f()),r&2){let i=_().$implicit;c(),R(i.isNode?-1:1),c(),R(i.isNode?2:-1)}}function ic(r,s){if(r&1&&(p(0,"td"),O(1,"i",19),C(2),f()),r&2){let i=_().$implicit;c(2),F("\xA0",i.firewallName," ")}}function nc(r,s){if(r&1){let i=M();p(0,"a",35),P("click",function(){w(i);let t=_(3).$implicit,n=_(2);return g(n.showPolicyDialog(t.firewallId))}),f()}}function oc(r,s){if(r&1&&O(0,"i"),r&2){let i=_(3).$implicit,e=_(2);he(e.FirewallOpsIcons[i.compileState])}}function lc(r,s){if(r&1&&(p(0,"span"),x(1,nc,1,0,"a",33),x(2,oc,1,2,"i",34),f()),r&2){let i=_(2).$implicit,e=_(2);c(),R(i.compileState===3||i.compileState!==1&&i.compileState!==2&&e.getFirewallStatusCompiled(i.firewallId)===0?1:-1),c(),R(i.compileState===4?2:-1)}}function rc(r,s){if(r&1&&(p(0,"td",25),x(1,lc,3,2,"span"),f()),r&2){let i=_().$implicit;c(),R(i.isNode?-1:1)}}function ac(r,s){if(r&1){let i=M();p(0,"a",35),P("click",function(){w(i);let t=_(2).$implicit,n=_(2);return g(n.showPolicyDialog(t.firewallId))}),f()}}function sc(r,s){if(r&1&&O(0,"i"),r&2){let i=_(2).$implicit,e=_(2);he(e.FirewallOpsIcons[i.compileState])}}function cc(r,s){if(r&1&&(p(0,"td",25),x(1,ac,1,0,"a",33),x(2,sc,1,2,"i",34),f()),r&2){let i=_().$implicit,e=_(2);c(),R(i.compileState===3||i.compileState!==1&&i.compileState!==2&&e.getFirewallStatusCompiled(i.firewallId)===0?1:-1),c(),R(i.compileState===4?2:-1)}}function pc(r,s){if(r&1){let i=M();p(0,"a",37),P("click",function(){w(i);let t=_(3).$implicit,n=_(2);return g(n.downloadPolicyScript(t.firewallId))}),f()}}function dc(r,s){if(r&1&&O(0,"i"),r&2){let i=_(3).$implicit,e=_(2);he(e.FirewallOpsIcons[i.compileState])}}function _c(r,s){if(r&1&&(p(0,"span"),x(1,pc,1,0,"a",36),x(2,dc,1,2,"i",34),f()),r&2){let i=_(2).$implicit,e=_(2);c(),R(i.compileState===3||i.compileState!==1&&i.compileState!==2&&e.getFirewallStatusCompiled(i.firewallId)===0?1:-1),c(),R(i.compileState===4?2:-1)}}function uc(r,s){if(r&1&&(p(0,"td",25),x(1,_c,3,2,"span"),f()),r&2){let i=_().$implicit;c(),R(i.isNode?-1:1)}}function fc(r,s){if(r&1){let i=M();p(0,"a",37),P("click",function(){w(i);let t=_(2).$implicit,n=_(2);return g(n.downloadPolicyScript(t.firewallId))}),f()}}function mc(r,s){if(r&1&&O(0,"i"),r&2){let i=_(2).$implicit,e=_(2);he(e.FirewallOpsIcons[i.compileState])}}function hc(r,s){if(r&1&&(p(0,"td",25),x(1,fc,1,0,"a",36),x(2,mc,1,2,"i",34),f()),r&2){let i=_().$implicit,e=_(2);c(),R(i.compileState===3||i.compileState!==1&&i.compileState!==2&&e.getFirewallStatusCompiled(i.firewallId)===0?1:-1),c(),R(i.compileState===4?2:-1)}}function wc(r,s){if(r&1&&(p(0,"tr",26),x(1,tc,3,2,"td"),x(2,ic,3,1,"td"),p(3,"td",25),O(4,"i"),f(),p(5,"td",25),O(6,"i"),f(),x(7,rc,2,1,"td",25),x(8,cc,3,2,"td",25),x(9,uc,2,1,"td",25),x(10,hc,3,2,"td",25),f()),r&2){let i=s.$implicit,e=_(2);m("ngClass",i.coloredBg?"bgColored":"bgNormal"),c(),R(i.clusterId!==null&&i.clusterId!==void 0?1:-1),c(),R(i.clusterId===null||i.clusterId===void 0?2:-1),c(2),he(e.FirewallOpsIcons[i.compileState]),c(2),he(e.FirewallOpsIcons[i.installState]),c(),R(i.clusterId!==null&&i.clusterId!==void 0?7:-1),c(),R(i.clusterId===null||i.clusterId===void 0?8:-1),c(),R(i.clusterId!==null&&i.clusterId!==void 0?9:-1),c(),R(i.clusterId===null||i.clusterId===void 0?10:-1)}}function gc(r,s){if(r&1&&(p(0,"div",6)(1,"div",22)(2,"div",23)(3,"table",24)(4,"caption"),C(5),y(6,"translate"),f(),p(7,"thead")(8,"tr")(9,"th"),C(10),y(11,"translate"),f(),p(12,"th",25),C(13,"C"),f(),p(14,"th",25),C(15,"I"),f(),p(16,"th",25),C(17,"V"),f(),p(18,"th",25),C(19,"D"),f()()(),p(20,"tbody"),Et(21,wc,11,11,"tr",26,yt),f()()()(),p(23,"div",27)(24,"div",28)(25,"div",29),O(26,"i",30),p(27,"span"),C(28),y(29,"translate"),f()(),O(30,"sts-fwc-log",31,3),f()()()),r&2){let i=_();c(5),F(" ",E(6,5,"COMPILE.FORM.SEL_FW")," "),c(5),U(E(11,7,"COMPILE.FORM.NAME")),c(11),vt(i.operationQueue),c(7),U(E(29,9,"LOG_PANEL.LOGS_HEADER")),c(2),m("autoResize",!0)("showHeader",!1)}}function Sc(r,s){if(r&1){let i=M();p(0,"p-button",40),y(1,"translate"),P("onClick",function(){w(i);let t=_(3);return g(t.showCompileDialog())}),f()}if(r&2){let i=_(3);m("label",B(E(1,3,"GLOBALS.MSG_BUTTONS.NEXT")))("disabled",!i.firewalls||!(i.firewalls!=null&&i.firewalls.length))}}function Cc(r,s){if(r&1){let i=M();p(0,"div"),x(1,Sc,2,5,"p-button",38),p(2,"p-button",39),y(3,"translate"),P("onClick",function(){w(i);let t=_(2);return g(t.hideDialog())}),f()()}if(r&2){let i=_(2);c(),R(i.enableProcess?1:-1),c(),m("label",B(E(3,3,"GLOBALS.MSG_BUTTONS.CLOSE")))}}function yc(r,s){if(r&1){let i=M();p(0,"p-button",48),y(1,"translate"),P("onClick",function(){w(i);let t=_(3);return g(t.doPauseProcess(!0))}),f()}if(r&2){let i=_(3);m("label",B(E(1,3,"COMPILE.PAUSE")))("disabled",i.disableButtons)}}function Ec(r,s){if(r&1){let i=M();p(0,"p-button",49),P("onClick",function(){w(i);let t=_(3);return g(t.doContinueProcess())}),f()}if(r&2){let i=_(3);m("disabled",i.disableButtons)("label",i.continueButtonText)}}function vc(r,s){if(r&1){let i=M();p(0,"p-button",50),y(1,"translate"),P("click",function(){w(i);let t=_(3);return g(t.downloadPolicyScript(t.operationQueue[0].firewallId))}),f()}r&2&&m("label",B(E(1,2,"CONTEXT.FW.DOWNLOAD")))}function Ic(r,s){if(r&1){let i=M();p(0,"p-button",51),y(1,"translate"),P("click",function(){w(i);let t=_(3);return g(t.showPolicyDialog(t.operationQueue[0].firewallId))}),f()}r&2&&m("label",B(E(1,2,"CONTEXT.FW.SHOW")))}function bc(r,s){if(r&1){let i=M();p(0,"p-button",52),y(1,"translate"),P("onClick",function(){w(i);let t=_(3);return g(t.doDownloadCompileLog())}),f()}if(r&2){let i=_(3);m("label",B(E(1,3,"LOG_PANEL.BTN_DOWNLOAD")))("disabled",i.loadingData||i.disableButtons)}}function Pc(r,s){if(r&1){let i=M();p(0,"div"),x(1,yc,2,5,"p-button",41),x(2,Ec,1,2,"p-button",42),O(3,"span",43),x(4,vc,2,4,"p-button",44),x(5,Ic,2,4,"p-button",45),x(6,bc,2,5,"p-button",46),p(7,"p-button",47),y(8,"translate"),P("onClick",function(){w(i);let t=_(2);return g(t.hideDialog())}),f()()}if(r&2){let i=_(2);c(),R(!i.pauseProcess&&i.operationInProcessId<i.operationQueue.length-1?1:-1),c(),R(i.pauseProcess&&i.operationInProcessId<i.operationQueue.length?2:-1),c(2),R(!i.pauseProcess&&!(i.operationInProcessId<i.operationQueue.length)&&i.getDifferentCompiled()?4:-1),c(),R(!i.pauseProcess&&!(i.operationInProcessId<i.operationQueue.length)&&i.getDifferentCompiled()?5:-1),c(),R(i.pauseProcess===!1&&!(i.operationInProcessId<i.operationQueue.length)?6:-1),c(),m("label",B(E(8,8,"GLOBALS.MSG_BUTTONS.CLOSE")))("disabled",i.loadingData||i.disableButtons)}}function Tc(r,s){if(r&1&&(x(0,Cc,4,5,"div"),x(1,Pc,9,10,"div")),r&2){let i=_();R(i.displaySelectOptions?0:-1),c(),R(i.displayCompileOptions?1:-1)}}var Oc=6e4,dr=(()=>{let s=class s extends Jt{set compileLogInstance(e){this.log=e}constructor(e,t,n,l,o,a,u,d,h,S,v,b,T,A,N,j,D){super(u,t,e,A,N,j),this.itemSelectedService=e,this.appOptionsService=t,this.fwcUserService=n,this.fwcFirewallService=l,this.fwcPolicyService=o,this.fwcErrorPipe=a,this.appDialogPanelsService=u,this.confirmationService=d,this.messageService=h,this.inputDataService=S,this.fwcEventService=v,this.utilService=b,this.translate=T,this.cd=A,this.store=N,this.router=j,this.fwcDangerousRuleFunctionalityService=D,this.displaySelectOptions=!1,this.displayCompileOptions=!1,this.firewalls=[],this.compileChecks=[],this.installChecks=[],this.operationQueue=[],this.operationStatus={},this.loadingData=!1,this.FirewallOpsIcons=Xo,this.disableButtons=!1,this.pauseProcess=!1,this.alive=!0,this.skipDialogHideReset=!1,this.dangerousRulesRecompileInProgress=!1,this.createDialog(this.translate.instant("COMPILE.PANEL_TITLE"),"fwci-compileallfirewalls")}ngOnInit(){let e,t;this.continueButtonText=this.translate.instant("COMPILE.CONTINUE");let n=[];this.itemSelectedService.getCloudToCompile().pipe(oe(()=>this.alive)).subscribe(l=>{if(l){switch(this.closeExistingCompilationDialog(),this.loadingData=!0,l.compileWhat){case Tt.COMP_CLOUD:e=this.fwcFirewallService.getFirewallsByCloud.bind(this.fwcFirewallService),t=this.translate.instant("COMPILE.NO_DATA");break;case Tt.COMP_CLUSTER:e=this.fwcFirewallService.getClusterNodes.bind(this.fwcFirewallService);break;case Tt.COMP_FIREWALL:e=this.fwcFirewallService.getFirewall.bind(this.fwcFirewallService);break;case Tt.COMP_CLUSTERS_ALL:e=this.fwcFirewallService.getFirewallsByCloud.bind(this.fwcFirewallService),t=this.translate.instant("COMPILE.NO_DATA_CL");break;case Tt.COMP_FIREWALLS_ALL:e=this.fwcFirewallService.getFirewallsByCloud.bind(this.fwcFirewallService),t=this.translate.instant("COMPILE.NO_DATA_FW");break}this.fwcFirewallService.getClustersByCloud(this.fwcUserService.getActualFwSelectedCloud()).subscribe(o=>{o.data&&Array.isArray(o.data)?n=o.data:n=[],e(l.compileId,this.fwcUserService.getActualFwSelectedCloud()).subscribe(a=>{let u=[],d,h;Array.isArray(a.data)&&a.data.length?u.push(...a.data):a.data&&a.data.id&&u.push(a.data),this.firewalls=[];for(let S=0;S<u.length;S++)if(u[S].status_compiled=u[S].status&1,u[S].status_installed=u[S].status&2,d=u[S].cluster,d==null)(l.compileWhat===Tt.COMP_CLOUD||l.compileWhat===Tt.COMP_FIREWALLS_ALL||l.compileWhat===Tt.COMP_FIREWALL)&&this.firewalls.push(u[S]);else if(l.compileWhat===Tt.COMP_CLOUD||l.compileWhat===Tt.COMP_CLUSTERS_ALL||l.compileWhat===Tt.COMP_CLUSTER){h=!1;for(let T=0;T<this.firewalls.length&&!h;T++)this.firewalls[T].cluster==d&&(this.firewalls[T].fwnodes.push(u[S]),h=!0);let v="",b=n.filter(T=>T.id==d);if(b&&b.length&&(v=b[0].name),!h){let T=Object.assign({},u[S]);u[S].name=v,u[S].fwnodes=[],u[S].fwnodes.push(T),this.firewalls.push(u[S])}}if(this.loadingData=!1,this.firewalls.length){for(let S=0;S<this.firewalls.length;S++)this.compileChecks[S]=!!this.firewalls[S].status_compiled,this.installChecks[S]=!!l.compileAction&&!!this.firewalls[S].status_installed;this.checkCompileInstallCheckboxes()}else this.errorMessage={type:"warning",title:this.translate.instant("COMPILE.NO_DATA_HEAD"),text:t};this.recenterDialog()},a=>{a.error&&a.error.fwcErr==1002?this.errorMessage={type:"warning",title:this.translate.instant("COMPILE.NO_DATA_HEAD"),text:t}:a.error&&this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(a)}),this.loadingData=!1})},o=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(o)}),this.loadingData=!1}),this.displaySelectOptions=!0,this.showDialog()}})}checkCompileInstallCheckboxes(e){this.compileChecks.every(t=>t)?this.compileAllCheck=!0:this.compileAllCheck=!1,this.installChecks.every(t=>t)?this.installAllCheck=!0:this.installAllCheck=!1,this.enableProcess=this.compileChecks.some(t=>t)||this.installChecks.some(t=>t)}ngOnDestroy(){clearTimeout(this.opTimeout),super.ngOnDestroy()}onDialogHide(e){if(this.dialogMinified||this.skipDialogHideReset){this.skipDialogHideReset=!1;return}this.resetCompileDialogState()}onHeaderMinimize(){this.minimizeDialog()}onDialogShow(){this.refreshLogView(),this.fwcDangerousRuleFunctionalityService.bringPanelToFront()}resetCompileDialogState(){this.displaySelectOptions=!1,this.displayCompileOptions=!1,this.firewalls=[],this.compileChecks=[],this.errorMessage=null,this.installChecks=[],this.log&&this.log.clearMessages(),this.channel_id&&this.utilService.ioReleaseLogEvent(this.channel_id),this.operationQueue=[],this.pauseProcess=!1,this.eventsSubscription&&this.eventsSubscription.unsubscribe(),this.operationInProcessId!==void 0&&this.itemSelectedService.setModifiedItem({_fwcTreeAction:Ye.RELOAD_TREE,containerToReload:Ge.C_FIREWALLS}),this.actualFirewallCompileSSHInputData=null,this.operationInProcessId=void 0,this.opTimeout&&clearTimeout(this.opTimeout),this.clearDangerousRulesRecompileState()}getDangerousRuleDialogOptions(){return{actionMode:"firewall",onCloseCompilation:()=>{this.doPauseProcess()},onDialogClose:e=>{this.handleDangerousRuleDialogClose(e)},onDialogRestore:()=>{this.handleDangerousRuleDialogRestore()},onRequestRecompile:e=>{this.handleDangerousRulesRecompile(e)}}}handleDangerousRuleDialogClose(e){e==="continue"?(this.clearDangerousRulesRecompileState(),this.processFirewallOperation()):e==="pause"?(this.dangerousRulesRecompileInProgress=!1,this.doPauseProcess()):e==="minimize"?(this.dangerousRulesRecompileInProgress=!1,this.doPauseProcess(),this.onHeaderMinimize()):e==="close"&&this.clearDangerousRulesRecompileState()}handleDangerousRuleDialogRestore(){this.dialogMinified&&(this.restoreDialog(),this.fwcDangerousRuleFunctionalityService.bringPanelToFront())}handleDangerousRulesRecompile(e){e?.firewallId&&(this.dangerousRulesContext={firewallId:e.firewallId,firewallName:e.firewallName||this.dangerousRulesContext?.firewallName||String(e.firewallId),firewallType:e.firewallType||this.dangerousRulesContext?.firewallType}),!(this.dangerousRulesRecompileInProgress||!this.dangerousRulesContext)&&this.utilService.fwcAPICall(this.fwcFirewallService.getFirewall.bind(this.fwcFirewallService),this.dangerousRulesContext.firewallId,this.fwcUserService.getActualFwSelectedCloud()).then(t=>{t.data.status&1&&(this.dangerousRulesRecompileInProgress=!0,this.recompileFirewallAfterDangerousRulesRestore())}).catch(t=>{this.addMessageToLog(this.translate.instant("COMPILE.COMP_ERROR",{error:this.fwcErrorPipe.transform(t)}),z.MSG_ERROR)})}recompileFirewallAfterDangerousRulesRestore(){let e=this.operationQueue&&this.operationInProcessId<this.operationQueue.length?this.operationQueue[this.operationInProcessId]:void 0;if(!e){this.dangerousRulesRecompileInProgress=!1;return}let t=this.buildOperationTargetName(e);this.addMessageToLog(this.translate.instant("COMPILE.DANGEROUS_RULES_RECOMPILE_LOG",{name:t}),z.MSG_WARNING),this.addMessageToLog(this.translate.instant("COMPILE.COMP_START",{name:t}),z.MSG_INFO),this.operationStatus.opMsg=this.translate.instant("COMPILE.COMP_SUCCESS",{name:t}),this.operationStatus.opMsgType=z.MSG_OK,this.resetTimer(),this.loadingData=!0,this.log.startDataLoad(),this.utilService.fwcAPICall(this.fwcPolicyService.compileFirewall.bind(this.fwcPolicyService),e.firewallId,this.fwcUserService.getActualFwSelectedCloud(),this.channel_id).then(n=>{this.loadingData=!1,this.log.stopDataLoad(),clearTimeout(this.opTimeout),setTimeout(()=>{this.addMessageToLog(this.operationStatus.opMsg,this.operationStatus.opMsgType),this.addMessageToLog("",z.MSG_SEPARATOR);let l=e.clusterName?"cluster":"firewall";this.fwcDangerousRuleFunctionalityService.showDangerousRules(n.data,e.firewallName,e.firewallId,l,this.getDangerousRuleDialogOptions())?this.dangerousRulesContext={firewallId:e.firewallId,firewallName:e.firewallName,firewallType:l}:this.doPauseProcess(),this.dangerousRulesRecompileInProgress=!1})}).catch(n=>{this.loadingData=!1,this.log.stopDataLoad(),this.addMessageToLog(this.translate.instant("COMPILE.COMP_ERROR",{name:t,error:this.fwcErrorPipe.transform(n)}),z.MSG_ERROR),this.dangerousRulesRecompileInProgress=!1})}buildOperationTargetName(e){return e.clusterId!==null&&e.clusterId!==void 0?e.firewallName?this.translate.instant("COMPILE.INST_CLUSTER_NODE",{clusterName:e.clusterName,firewallName:e.firewallName}):this.translate.instant("COMPILE.INST_CLUSTER",{clusterName:e.clusterName}):this.translate.instant("COMPILE.INST_FW",{firewallName:e.firewallName})}clearDangerousRulesRecompileState(){this.dangerousRulesContext=void 0,this.dangerousRulesRecompileInProgress=!1}closeExistingCompilationDialog(){!this.displayDialog&&!this.dialogMinified||(this.resetCompileDialogState(),this.displayDialog&&(this.skipDialogHideReset=!0),this.dialogMinified=!1,this.hideDialog())}refreshLogView(){setTimeout(()=>{this.log&&this.log.scrollToBottom()})}compileAll(){this.displaySelectOptions=!0}compileOrInstallAll(e){let t,n;e?(t=this.installAllCheck,n=this.installChecks):(t=this.compileAllCheck,n=this.compileChecks),t?n.fill(!0):n.fill(!1),this.checkCompileInstallCheckboxes()}showCompileDialog(){this.displaySelectOptions=!1,this.displayCompileOptions=!0,this.recenterDialog(),setTimeout(()=>{this.log&&this.log.clearMessages(),this.startCompileProcess(),this.cd.detectChanges()})}resetTimer(){this.opTimeout&&clearTimeout(this.opTimeout),this.opTimeout=setTimeout(()=>{this.doTimeoutOp()},Oc)}startCompileProcess(){let e,t=!1;if(!this.firewalls)return;this.operationQueue=[];for(let o=0;o<this.firewalls.length;o++)if(this.compileChecks[o]||this.installChecks[o]){let a=this.firewalls[o];if(a.cluster===null||a.cluster===void 0)e={clusterId:a.cluster,firewallId:a.id,firewallName:a.name,compileState:this.compileChecks[o]?xe.FW_PENDING:xe.FW_DISABLED,installState:this.installChecks[o]?xe.FW_PENDING:xe.FW_DISABLED,coloredBg:t,opCompiled:!1,opInstalled:!1},this.operationQueue.push(Object.assign({},e));else{e={clusterId:a.cluster,clusterName:a.name,firewallId:a.id,firewallName:a.name,compileState:this.compileChecks[o]?xe.FW_PENDING:xe.FW_DISABLED,installState:xe.FW_DISABLED,coloredBg:t,opCompiled:!1,opInstalled:!1},this.operationQueue.push(Object.assign({},e));for(let u=0;a.fwnodes&&u<a.fwnodes.length;u++){let d=a.fwnodes[u];e={clusterId:a.cluster,clusterName:a.name,isNode:!0,firewallId:d.id,firewallName:d.name,compileState:xe.FW_DISABLED,installState:this.installChecks[o]?xe.FW_PENDING:xe.FW_DISABLED,coloredBg:t,opCompiled:!1,opInstalled:!1},this.operationQueue.push(Object.assign({},e))}}t=!t}let n=this.utilService.createDynamicComponentRef(tn),l=n.instance;l.setDynamicComponentRef(n),this.communicationSubscription=l.socketEventEmitter.subscribe(o=>{o=="connected"&&(this.channel_id=Ft(),this.utilService.ioListenOnLogEvent(this.channel_id),this.eventsSubscription=this.fwcEventService.getEvent().pipe(oe(()=>this.displayCompileOptions)).subscribe(a=>{let u=new On(a),d;u.payload.type===z.MSG_ERROR&&(this.pauseProcess=!0,d=this.utilService.isCommunicationErrorStr(u.payload.message),this.operationStatus.opMsg=this.translate.instant("COMPILE.GEN_ERROR"),this.operationStatus.opMsgType=z.MSG_ERROR,d?this.continueButtonText=this.translate.instant("COMPILE.RETRY"):this.continueButtonText=this.translate.instant("COMPILE.CONTINUE")),!d&&this.log&&this.log.addNewMessage(u),this.resetTimer()}),this.operationInProcessId=0,this.actualFirewallCompileSSHInputData=null,this.processFirewallOperation()),this.communicationSubscription.unsubscribe()}),l.checkConnection()}processFirewallOperation(e){let t;if(!this.pauseProcess&&(clearTimeout(this.opTimeout),this.operationQueue&&this.operationInProcessId<this.operationQueue.length)){let n=this.operationQueue[this.operationInProcessId];if(!n)return;if(n.clusterId!==null&&n.clusterId!==void 0?n.firewallName?t=this.translate.instant("COMPILE.INST_CLUSTER_NODE",{clusterName:n.clusterName,firewallName:n.firewallName}):t=this.translate.instant("COMPILE.INST_CLUSTER",{clusterName:n.clusterName}):t=this.translate.instant("COMPILE.INST_FW",{firewallName:n.firewallName}),n.compileState==xe.FW_PENDING)n.compileState=xe.FW_PROCESSING,this.addMessageToLog(this.translate.instant("COMPILE.COMP_START",{name:t}),z.MSG_INFO),this.operationStatus.opMsg=this.translate.instant("COMPILE.COMP_SUCCESS",{name:t}),this.operationStatus.opMsgType=z.MSG_OK,this.resetTimer(),this.loadingData=!0,this.log.startDataLoad(),this.utilService.fwcAPICall(this.fwcPolicyService.compileFirewall.bind(this.fwcPolicyService),n.firewallId,this.fwcUserService.getActualFwSelectedCloud(),this.channel_id).then(l=>{n.compileState=xe.FW_OK,this.loadingData=!1,this.log.stopDataLoad(),clearTimeout(this.opTimeout),setTimeout(()=>{if(this.addMessageToLog(this.operationStatus.opMsg,this.operationStatus.opMsgType),this.addMessageToLog("",z.MSG_SEPARATOR),l.data.length>0){let o=n.clusterName?"cluster":"firewall";this.fwcDangerousRuleFunctionalityService.showDangerousRules(l.data,n.firewallName,n.firewallId,o,this.getDangerousRuleDialogOptions())?this.dangerousRulesContext={firewallId:n.firewallId,firewallName:n.firewallName,firewallType:o}:this.doPauseProcess();return}this.processFirewallOperation()})}).catch(l=>{this.addMessageToLog(this.translate.instant("COMPILE.COMP_ERROR",{name:t,error:this.fwcErrorPipe.transform(l)}),z.MSG_ERROR),n.compileState=xe.FW_ERROR,this.doPauseProcess(),this.log.stopDataLoad()});else if(n.installState==xe.FW_PENDING){n.installState=xe.FW_PROCESSING,(this.operationInProcessId||!this.operationInProcessId&&n.compileState!=xe.FW_DISABLED)&&this.addMessageToLog("",z.MSG_SEPARATOR),this.addMessageToLog(this.translate.instant("COMPILE.INST_START",{name:t}),z.MSG_INFO);let l={header:this.translate.instant("COMPILE.INST_SSH",{name:t}),helpText:this.translate.instant("COMPILE.INST_SSH_TEXT"),modal:!1,formControls:[{name:"firewall_id",type:"hidden",value:n.firewallId}],onAccept:this.installFirewall.bind(this)};this.fwcFirewallService.getFirewall(n.firewallId,this.fwcUserService.getActualFwSelectedCloud()).subscribe(o=>le(this,null,function*(){let a=o.data;if(a){let u=this.fwcUserService.getActualFwcUser().privateKey,d=a.install_user,h=a.install_pass,S=a.install_apikey;try{d&&(d=yield this.utilService.openPGPDecrypt(d,u)),h&&(h=yield this.utilService.openPGPDecrypt(h,u)),S&&(S=yield this.utilService.openPGPDecrypt(S,u))}catch{}if(a.install_interface&&a.install_ipobj){l.formControls.push({name:"install_communication",type:"hidden",value:a.install_communication}),a.install_communication==="ssh"&&(l.formControls.push({name:"install_user",label:this.translate.instant("CLUSTER.MSG_CLUSTER_EDITION.SSH_USER"),type:"text",required:!0,value:this.actualFirewallCompileSSHInputData?this.actualFirewallCompileSSHInputData.install_user:d,setFocus:!0}),l.formControls.push({name:"",label:"",type:"separator"}),l.formControls.push({name:"install_pass",label:this.translate.instant("CLUSTER.MSG_CLUSTER_EDITION.SSH_PASS"),type:"password",required:!0,value:this.actualFirewallCompileSSHInputData?this.actualFirewallCompileSSHInputData.install_pass:h}));let v={name:"btnPauseProcess",label:this.translate.instant("COMPILE.PAUSE"),type:"button",icon:"fa fa-pause",class:"p-button-warning",value:0};if(l.formControls.push(v),l.formControls.unshift({name:"",label:"",type:"separator"}),l.formControls.unshift({name:"ip_name",label:this.translate.instant("COMPILE.FIELDS.INST_IP"),icon:"fwci-address fwcBlue",type:"text",value:a.ip_name?a.ip_name+" ("+a.ip+")":"-",readonly:!0,halfSized:!0}),l.formControls.unshift({name:"interface_name",label:this.translate.instant("COMPILE.FIELDS.INST_IF"),icon:"fwci-interface fwcGreen",type:"text",value:a.interface_name||"-",readonly:!0,halfSized:!0}),a.install_communication==="agent"&&a.install_protocol&&a.install_apikey){let b=this.inputDataService.getInputDataValue(l);this.installFirewall(b)}else this.disableButtons=!0,this.inputDataService.setInputData(l)}else n.installState=xe.FW_ERROR,this.pauseProcess=!0,this.disableButtons=!1,this.loadingData=!1,this.log&&this.log.stopDataLoad(),clearTimeout(this.opTimeout),setTimeout(()=>{this.confirmationService.confirm({key:"cdErrorFw",header:this.translate.instant("COMPILE.INST_SSH_ERROR"),message:this.translate.instant("COMPILE.INST_SSH_ERROR_TEXT",{name:a.name}),reject:()=>{this.doPauseProcess(),this.confirmationService.close()},accept:()=>{let v=this.translate.instant("COMPILE.INST_SSH_ERROR_TEXT",{name:a.name});this.addMessageToLog(this.translate.instant("COMPILE.INST_ERROR",{name:t,error:v}),z.MSG_ERROR),this.operationInProcessId++,this.actualFirewallCompileSSHInputData=null,this.pauseProcess=!1,this.processFirewallOperation(),this.confirmationService.close()}})},100)}else n.installState=xe.FW_ERROR,this.doPauseProcess(),this.log.stopDataLoad(),this.addMessageToLog(this.translate.instant("COMPILE.INST_FW_ERROR",{name:t}),z.MSG_ERROR)}),o=>{n.installState=xe.FW_ERROR,this.doPauseProcess(),this.log.stopDataLoad(),this.addMessageToLog(this.translate.instant("COMPILE.INST_DATA_ERROR",{name:t,error:this.fwcErrorPipe.transform(o)}),z.MSG_ERROR)})}else this.operationInProcessId++,this.actualFirewallCompileSSHInputData=null,this.processFirewallOperation()}}installFirewall(e){return le(this,null,function*(){let t,n;if(this.operationQueue&&this.operationInProcessId<this.operationQueue.length&&(n=this.operationQueue[this.operationInProcessId]),!!n)if(n.clusterId!==null&&n.clusterId!==void 0?t=`cluster ${n.clusterId} - firewall ${n.firewallId} (${n.firewallName})`:t=`firewall ${n.firewallId} (${n.firewallName})`,this.disableButtons=!1,e){if(this.actualFirewallCompileSSHInputData=e,e.btnPauseProcess){n.installState=xe.FW_PENDING,this.doPauseProcess(!0);return}let l=this.fwcUserService.getActualFwcUser().publicKey,o=e.install_user,a=e.install_pass,u=e.install_apikey;o&&(o=yield this.utilService.openPGPEncrypt(o,l)),a&&(a=yield this.utilService.openPGPEncrypt(a,l)),this.resetTimer(),this.loadingData=!0,this.log.startDataLoad(),this.utilService.fwcAPICall(this.fwcPolicyService.installFirewall.bind(this.fwcPolicyService),e.firewall_id,this.fwcUserService.getActualFwSelectedCloud(),o,a,this.channel_id).then(d=>{n.installState=xe.FW_OK,this.operationStatus.opMsg=this.translate.instant("COMPILE.INST_SUCCESS",{name:t}),this.operationStatus.opMsgType=z.MSG_OK,this.loadingData=!1,this.log.stopDataLoad(),this.actualFirewallCompileSSHInputData=null,setTimeout(()=>{this.addMessageToLog(this.operationStatus.opMsg,this.operationStatus.opMsgType),this.addMessageToLog("",z.MSG_SEPARATOR),this.processFirewallOperation()})}).catch(d=>{let h=this.utilService.isCommunicationError(d.error);h?(n.installState=xe.FW_PENDING,this.addMessageToLog(this.translate.instant("COMPILE.INST_ERROR",{name:t,error:h}),z.MSG_ERROR),this.continueButtonText=this.translate.instant("COMPILE.RETRY")):(d.error.fwcErr==9e3?this.confirmationService.confirm({header:this.translate.instant("GLOBALS.MSG_OP_RESULT.ERROR"),icon:"fa fa-exclamation-circle fwcRed iconBig",message:this.translate.instant("API_ERROR.SSH_FORBIDDEN"),rejectVisible:!1,acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.OK")}):(n.installState=xe.FW_ERROR,this.addMessageToLog(this.translate.instant("COMPILE.INST_ERROR",{name:t,error:this.fwcErrorPipe.transform(d)}),z.MSG_ERROR)),this.continueButtonText=this.translate.instant("COMPILE.CONTINUE"),this.actualFirewallCompileSSHInputData=null),this.loadingData=!1,this.log.stopDataLoad(),this.operationInProcessId<this.operationQueue.length-1?this.doPauseProcess():clearTimeout(this.opTimeout)})}else n.installState=xe.FW_WARNING,this.addMessageToLog(this.translate.instant("COMPILE.INST_WARNING",{name:t}),z.MSG_ERROR),this.operationInProcessId++,this.actualFirewallCompileSSHInputData=null,this.processFirewallOperation()})}doTimeoutOp(){this.pauseProcess=!0,this.loadingData=!1,this.log&&(this.log.stopDataLoad(),this.addMessageToLog(this.translate.instant("COMPILE.WARN_TIMEOUT"),z.MSG_WARNING))}doPauseProcess(e){this.pauseProcess=!0,this.loadingData=!1,this.log&&this.log.stopDataLoad(),clearTimeout(this.opTimeout),e&&this.addMessageToLog(this.translate.instant("COMPILE.WARN_PAUSE"),z.MSG_WARNING)}endCompilationProcess(){this.pauseProcess=!0,this.loadingData=!1,this.disableButtons=!1,this.log&&this.log.stopDataLoad(),clearTimeout(this.opTimeout),this.eventsSubscription&&(this.eventsSubscription.unsubscribe(),this.eventsSubscription=null),this.channel_id&&(this.utilService.ioReleaseLogEvent(this.channel_id),this.channel_id=null),this.actualFirewallCompileSSHInputData=null,this.operationQueue=[],this.operationInProcessId===void 0&&(this.operationInProcessId=0)}doContinueProcess(){this.fwcDangerousRuleFunctionalityService.hidePanel(),this.pauseProcess=!1,this.processFirewallOperation()}doDownloadCompileLog(){this.log&&this.log.downloadLog()}showPolicyDialog(e){let t=this.utilService.createDynamicComponentRef(so),n=t.instance;n.setDynamicComponentRef(t),n.show(e)}downloadPolicyScript(e){let t=this.utilService.createDynamicComponentRef(so),n=t.instance;n.setDynamicComponentRef(t),n.downloadPolicyScript(e)}getDifferentCompiled(){let e=[...new Set(this.operationQueue.map(t=>t.clusterId))];return e.length===1&&e[0]===null&&[...new Set(this.operationQueue.map(t=>t.firewallId))].length===1?this.getFirewallStatusCompiled(this.operationQueue[0].firewallId)===3:e.length===1?this.operationQueue.find(t=>t.firewallId===this.firewalls[0].id).compileState===3:!1}getFirewallStatusCompiled(e){return this.operationQueue.find(t=>t.firewallId===e).compileState}};s.\u0275fac=function(t){return new(t||s)(L(He),L(Ot),L(ge),L(fe),L(ye),L(be),L(kt),L(Le),L(Ee),L(xt),L(pi),L(me),L(ue),L(we),L(Se),L(Ut),L(Nn))},s.\u0275cmp=je({type:s,selectors:[["sts-fwc-firewall-compile-panel"]],viewQuery:function(t,n){if(t&1&&_e(Us,5),t&2){let l;se(l=ce())&&(n.compileLogInstance=l.first)}},standalone:!1,features:[Ve([fe]),ct],decls:8,vars:6,consts:[["fwCompileDialog",""],["header",""],["footer",""],["compileLog",""],["styleClass","dlgFwcDialog dlgFwcDialog--medium dlgFwcDialog--log-resize",3,"visibleChange","onHide","onShow","visible","modal","resizable","closable"],[1,"grid","divTableScroll"],[1,"grid","divFw","fwc-log-grid"],[1,"divFormHeader"],[1,"divHeaderButtons"],["pButton","","type","button","icon","fa fa-window-minimize",1,"p-button-secondary",3,"click"],[1,"fwcWhite","fwcIconLeft"],[1,"fwcMenuIcon","fwci-firewalls","fwcOrange"],[1,"fwcMenuIcon","fwci-compileallfirewalls","fwcOrange"],[1,"col-12"],[1,"col-12","divLoader"],[1,"tableFw"],["name","compile_all",1,"compileCheckbox",3,"ngModelChange","onChange","ngModel","binary"],["name","install_all",1,"compileCheckbox",3,"ngModelChange","onChange","ngModel","binary"],[1,"compileCheckbox",3,"ngModelChange","onChange","name","ngModel","binary"],[1,"fwcMenuIcon","fwci-firewall","fwcBlue"],[1,"fwcMenuIcon","fwci-cluster","fwcOrange"],[3,"message"],[1,"col-4"],[1,"divFwBar","divTableScroll"],[1,"tableFw","unstriped"],[1,"fwc-centered"],[3,"ngClass"],[1,"col-8"],[1,"fwcLogPanel"],[1,"fwcLogPanel-header"],[1,"fa","fa-lg","fa-list","fwcBlue"],[3,"autoResize","showHeader"],[1,"fwcSepShort"],[1,"fa","fa-eye","fwcBlue"],[3,"class"],[1,"fa","fa-eye","fwcBlue",3,"click"],[1,"fa","fa-download"],[1,"fa","fa-download",3,"click"],["type","button","styleClass","p-button-success","icon","fa fa-arrow-right",3,"disabled","label"],["type","button","icon","pi pi-check",3,"onClick","label"],["type","button","styleClass","p-button-success","icon","fa fa-arrow-right",3,"onClick","disabled","label"],["type","button","styleClass","p-button-warning","icon","fa fa-pause",3,"disabled","label"],["type","button","styleClass","p-button-success","icon","fa fa-play",3,"disabled","label"],[1,"spanSep"],["type","button","styleClass","p-button-secondary","icon","fa fa-download",3,"label"],["type","button","styleClass","p-button-secondary","icon","fa fa-eye",3,"label"],["type","button","styleClass","p-button-secondary","icon","fa fa-download",3,"disabled","label"],["type","button","icon","pi pi-check",3,"onClick","disabled","label"],["type","button","styleClass","p-button-warning","icon","fa fa-pause",3,"onClick","disabled","label"],["type","button","styleClass","p-button-success","icon","fa fa-play",3,"onClick","disabled","label"],["type","button","styleClass","p-button-secondary","icon","fa fa-download",3,"click","label"],["type","button","styleClass","p-button-secondary","icon","fa fa-eye",3,"click","label"],["type","button","styleClass","p-button-secondary","icon","fa fa-download",3,"onClick","disabled","label"]],template:function(t,n){if(t&1){let l=M();p(0,"p-dialog",4,0),H("visibleChange",function(a){return w(l),W(n.displayDialog,a)||(n.displayDialog=a),g(a)}),P("onHide",function(a){return w(l),g(n.onDialogHide(a))})("onShow",function(){return w(l),g(n.onDialogShow())}),J(2,js,4,2,"ng-template",null,1,pe),x(4,$s,4,3,"div",5),x(5,gc,32,11,"div",6),J(6,Tc,2,2,"ng-template",null,2,pe),f()}t&2&&(V("visible",n.displayDialog),m("modal",!0)("resizable",!0)("closable",!1),c(4),R(n.displaySelectOptions?4:-1),c(),R(n.displayCompileOptions?5:-1))},dependencies:[pt,bt,Pt,Ki,Yt,Ht,Wt,pl,Ze,Rt,ko,dt],styles:[`.divFw{height:33rem}.divFwBar{height:32rem}.fwcLogPanel{height:32rem;border:1px solid var(--fwcGrey2);background:var(--fwcGrey6);display:flex;flex-direction:column}.dlgFwcDialog--log-resize .divFw,.dlgFwcDialog--log-resize .divFwBar,.dlgFwcDialog--log-resize .fwcLogPanel{height:500px;min-height:0}.fwcLogPanel-header{display:flex;align-items:center;gap:.5rem;padding:.4rem .6rem;font-weight:600;color:var(--fwcDark);background:#f4f4f4;border-bottom:1px solid var(--fwcGrey2)}.fwcLogPanel sts-fwc-log{flex:1 1 auto;display:block}
`],encapsulation:2});let r=s;return r})();var Mc=["inputFirewallName"],Dc=["fwcInterfacesEditor"],fr=r=>({visibility:r}),Nc=r=>({label:"SSH",value:"ssh",disabled:r}),Gc=()=>({label:"FWCloud-Agent",value:"agent"}),mr=(r,s)=>[r,s],Uc=()=>({label:"HTTPS",value:"https"}),kc=()=>({label:"HTTP",value:"http"}),ve=()=>({standalone:!0}),hr=(r,s)=>({type:"error",title:r,text:s});function Bc(r,s){if(r&1&&(p(0,"div",10)(1,"h6",14),O(2,"i",15),C(3),y(4,"translate"),p(5,"strong"),C(6),f()()()),r&2){let i=_(4);c(3),F(" ",E(4,2,"FW.MSG_FW_EDITION.EDIT")," "),c(3),U(i.firewall==null?null:i.firewall.name)}}function jc(r,s){r&1&&(p(0,"span")(1,"i"),C(2,"(Master)"),f()())}function Vc(r,s){if(r&1&&(p(0,"div",10)(1,"h6",14),O(2,"i",15),C(3," Cluster "),p(4,"strong"),C(5),f(),C(6),y(7,"translate"),x(8,jc,3,0,"span"),f()()),r&2){let i=_(4);c(5),U(i.firewall==null?null:i.firewall._fwcClusterId),c(),F(" - ",E(7,3,"FW.MSG_FW_EDITION.EDIT_NODE")," "),c(2),R(i.firewall!=null&&i.firewall.fwmaster?8:-1)}}function Wc(r,s){if(r&1&&(x(0,Bc,7,4,"div",10),x(1,Vc,9,5,"div",10)),r&2){let i=_(3);R(i.firewall!=null&&i.firewall._fwcClusterId?-1:0),c(),R(i.firewall!=null&&i.firewall._fwcClusterId?1:-1)}}function Hc(r,s){r&1&&(p(0,"div",10)(1,"h6",14),O(2,"i",15),C(3),y(4,"translate"),f()()),r&2&&(c(3),F(" ",E(4,1,"FW.MSG_FW_EDITION.EDIT")," "))}function Jc(r,s){if(r&1&&x(0,Wc,2,2)(1,Hc,5,3,"div",10),r&2){let i=_(2);R(i.firewall!=null&&i.firewall.id?0:1)}}function Yc(r,s){if(r&1&&(p(0,"div",10)(1,"h6",14),O(2,"i",16),C(3),y(4,"translate"),p(5,"strong"),C(6),f()()()),r&2){let i=_(2);c(3),F(" ",E(4,2,"FW.MSG_FW_EDITION.DELETE")," "),c(3),U(i.firewallToDelete._fwcObjName)}}function Kc(r,s){if(r&1){let i=M();p(0,"p-button",17),P("onClick",function(){w(i);let t=_(2);return g(t.showHelp())}),f()}if(r&2){let i=_(2);m("disabled",i.loadingData)}}function Xc(r,s){if(r&1){let i=M();x(0,Jc,2,1),x(1,Yc,7,4,"div",10),p(2,"div",11),x(3,Kc,1,1,"p-button",12),p(4,"p-button",13),P("onClick",function(){w(i);let t=_();return g(t.minimizeDialog())}),f()()}if(r&2){let i=_();R(i.firewall?0:-1),c(),R(i.firewallToDelete?1:-1),c(2),R(i.helpSection?3:-1),c(),m("disabled",i.loadingData)}}function zc(r,s){if(r&1&&O(0,"span",58),r&2){let i=_(2).$implicit;m("ngClass",i.iconClass)}}function qc(r,s){if(r&1&&(p(0,"div",55),J(1,zc,1,1,"span",56),p(2,"span",57),C(3),f()()),r&2){let i=_().$implicit;c(),m("ngIf",i.iconClass),c(2),U(i.name)}}function Qc(r,s){if(r&1&&J(0,qc,4,2,"div",54),r&2){let i=s.$implicit;m("ngIf",i)}}function $c(r,s){if(r&1&&O(0,"span",58),r&2){let i=_().$implicit;m("ngClass",i.iconClass)}}function Zc(r,s){if(r&1&&(p(0,"div",59),J(1,$c,1,1,"span",56),p(2,"span",57),C(3),f()()),r&2){let i=s.$implicit;c(),m("ngIf",i.iconClass),c(2),U(i.name)}}function ep(r,s){if(r&1){let i=M();p(0,"div",60)(1,"div",34)(2,"label",61),C(3),y(4,"translate"),f(),p(5,"p-select",62),P("onChange",function(){return w(i),g(!0)}),f()()(),p(6,"div",63)(7,"div",34)(8,"label",64),C(9),y(10,"translate"),f(),O(11,"input",65),y(12,"translate"),p(13,"p-button",66),P("mousedown",function(){w(i);let t=_(3);return g(t.displayApiKey=!0)})("mouseup",function(){w(i);let t=_(3);return g(t.displayApiKey=!1)})("mouseout",function(){w(i);let t=_(3);return g(t.displayApiKey=!1)}),f()()()}if(r&2){let i=_(3);c(3),U(E(4,7,"FW.MSG_FW_EDITION.AGENT_PROTOCOL")),c(2),m("options",Qe(15,mr,Y(13,Uc),Y(14,kc))),c(4),U(E(10,9,"FW.MSG_FW_EDITION.AGENT_APIKEY")),c(2),m("placeholder",B(E(12,11,"FW.MSG_FW_EDITION.AGENT_APIKEY")))("showPassword",i.displayApiKey)("feedback",!1)}}function tp(r,s){r&1&&(p(0,"p",69),C(1),y(2,"translate"),f()),r&2&&(c(),F(" ",E(2,1,"ITEM_PANEL.ERRORS.FIELD_USERNAME")," "))}function ip(r,s){if(r&1){let i=M();p(0,"div",63)(1,"div",34)(2,"label",67),C(3),y(4,"translate"),f(),O(5,"input",68),y(6,"translate"),f(),x(7,tp,3,3,"p",69),f(),p(8,"div",60)(9,"div",34,5)(11,"label",70),C(12),y(13,"translate"),f(),O(14,"input",71),y(15,"translate"),y(16,"translate"),y(17,"translate"),y(18,"translate"),y(19,"translate"),p(20,"p-button",66),P("mousedown",function(){w(i);let t=_(3);return g(t.displaySSH=!0)})("mouseup",function(){w(i);let t=_(3);return g(t.displaySSH=!1)})("mouseout",function(){w(i);let t=_(3);return g(t.displaySSH=!1)}),f()()()}if(r&2){let i=_(3);c(3),U(E(4,12,"FW.MSG_FW_EDITION.SSH_USER")),c(2),m("placeholder",B(E(6,14,"FW.MSG_FW_EDITION.SSH_USER"))),c(2),R(!i.formModel.get("install_user").valid&&!i.formModel.get("install_user").pristine?7:-1),c(5),U(E(13,16,"FW.MSG_FW_EDITION.SSH_PASS")),c(2),m("placeholder",B(E(15,18,"FW.MSG_FW_EDITION.SSH_PASS")))("showPassword",i.displaySSH)("promptLabel",E(16,20,"GLOBALS.MSG_PASSWORD.PASS"))("weakLabel",E(17,22,"GLOBALS.MSG_PASSWORD.WEAK"))("mediumLabel",E(18,24,"GLOBALS.MSG_PASSWORD.NORMAL"))("strongLabel",E(19,26,"GLOBALS.MSG_PASSWORD.SAFE"))}}function np(r,s){if(r&1){let i=M();p(0,"div",74)(1,"div",34)(2,"div",77)(3,"p-button",78),y(4,"translate"),y(5,"translate"),P("onClick",function(){w(i);let t=_(4);return g(t.onTestFwcAgentCommunicationDiscoverInterfaces())}),f(),p(6,"p-button",79),y(7,"translate"),y(8,"translate"),P("onClick",function(){w(i);let t=_(4);return g(t.showFirewallInfo())}),f()()()()}if(r&2){let i=_(4);c(3),m("pTooltip",B(E(4,10,"FW.MSG_FW_EDITION.AGENT_TOOLTIP")))("label",B(E(5,12,"FW.MSG_FW_EDITION.AGENT_TEST")))("disabled",i.loadingData),c(3),m("pTooltip",B(E(7,14,"FW.FW_MORE_INFO.AGENT_TOOLTIP")))("label",B(E(8,16,"FW.FW_MORE_INFO.MORE_INFO")))("disabled",i.loadingData)}}function op(r,s){if(r&1&&(p(0,"div",60)(1,"div",34)(2,"label"),O(3,"i",72),y(4,"translate"),C(5),y(6,"translate"),f(),O(7,"input",73),f()(),p(8,"div",60)(9,"div",34)(10,"label"),C(11),y(12,"translate"),f(),O(13,"input",73),f()(),p(14,"div",74)(15,"div",34)(16,"label",75),C(17),y(18,"translate"),f(),O(19,"input",76),y(20,"translate"),f()(),x(21,np,9,18,"div",74)),r&2){let i,e=_(3);c(3),m("pTooltip",B(E(4,14,"FW.MSG_FW_EDITION.TOOLTIP_NEW_INSTALL"))),c(2),F(" \xA0 ",E(6,16,"FW.MSG_FW_EDITION.NEW_IF")," "),c(2),m("value",B(e.discoveredInstallOptions.interface==null?null:e.discoveredInstallOptions.interface.name)),c(4),U(E(12,18,"FW.MSG_FW_EDITION.NEW_IP")),c(2),m("value",B((e.discoveredInstallOptions.ipobj==null?null:e.discoveredInstallOptions.ipobj.address)+" ("+(e.discoveredInstallOptions.ipobj==null?null:e.discoveredInstallOptions.ipobj.name)+")")),c(4),U(E(18,20,"FW.MSG_FW_EDITION.PORT")),c(2),m("placeholder",B(E(20,22,"FW.MSG_FW_EDITION.PORT")))("value",B(e.install_port_agent)),c(2),R(((i=e.formModel.get("install_communication"))==null?null:i.value)==="agent"?21:-1)}}function lp(r,s){if(r&1&&(p(0,"span"),C(1),f()),r&2){let i=s.$implicit;c(),U(i!=null&&i.name?i.id+" - "+i.name:"")}}function rp(r,s){if(r&1&&(p(0,"span"),C(1),f()),r&2){let i=s.$implicit;c(),Li("",i.id," - ",i.name)}}function ap(r,s){if(r&1&&(p(0,"span"),C(1),f()),r&2){let i=_().$implicit;c(),F("\xA0(",i.address,")")}}function sp(r,s){r&1&&(p(0,"span"),C(1),y(2,"translate"),f()),r&2&&(c(),F("\xA0(",E(2,1,"FW.MSG_FW_EDITION.NO_IP"),")"))}function cp(r,s){if(r&1&&(p(0,"span"),C(1),f(),x(2,ap,2,1,"span"),x(3,sp,3,3,"span")),r&2){let i=s.$implicit;c(),U(i.name),c(),R(i.address?2:-1),c(),R(i.address?-1:3)}}function pp(r,s){if(r&1){let i=M();p(0,"div",74)(1,"div",85)(2,"div",86)(3,"p-button",87),y(4,"translate"),y(5,"translate"),P("onClick",function(){w(i);let t=_(5);return g(t.onTestFwcAgentCommunication())}),f()(),p(6,"div",86)(7,"p-button",88),y(8,"translate"),y(9,"translate"),P("onClick",function(){w(i);let t=_(5);return g(t.showFirewallInfo())}),f()()()()}if(r&2){let i=_(5);c(3),m("pTooltip",B(E(4,10,"FW.MSG_FW_EDITION.AGENT_TOOLTIP")))("label",B(E(5,12,"FW.MSG_FW_EDITION.AGENT_TEST")))("disabled",i.loadingData||i.formModel.get("install_protocol").invalid||i.formModel.get("install_apikey").invalid||!i.formModel.get("install_interface").value||!i.formModel.get("install_ipobj").value||i.formModel.get("install_port").invalid),c(4),m("pTooltip",B(E(8,14,"FW.FW_MORE_INFO.AGENT_TOOLTIP")))("label",B(E(9,16,"FW.FW_MORE_INFO.MORE_INFO")))("disabled",i.loadingData||!i.formModel.get("install_ipobj").value)}}function dp(r,s){if(r&1){let i=M();p(0,"div",60)(1,"div")(2,"label",80),C(3),y(4,"translate"),f(),p(5,"p-select",81,6),y(7,"translate"),P("onChange",function(t){w(i);let n=_(4);return g(n.onChangeInstallData(t))}),J(8,lp,2,1,"ng-template",42)(9,rp,2,2,"ng-template",43),f()()(),p(10,"div",60)(11,"div")(12,"label",82),C(13),y(14,"translate"),f(),p(15,"p-select",83),y(16,"translate"),P("onChange",function(t){w(i);let n=_(4);return g(n.onChangeInstallData(t))}),J(17,cp,4,3,"ng-template",43),f()()(),p(18,"div",74)(19,"div")(20,"label",75),C(21),y(22,"translate"),f(),O(23,"input",84),f()(),x(24,pp,10,18,"div",74)}if(r&2){let i,e=_(4);c(3),U(E(4,10,"GLOBALS.MSG_OBJ_TYPES.OBJ_INTERFACE_FIREWALL")),c(2),m("options",e.interfaces)("autoDisplayFirst",!1)("placeholder",E(7,12,"GLOBALS.MSG_OBJ_TYPES.OBJ_INTERFACE_FIREWALL")),c(8),U(E(14,14,"GLOBALS.MSG_OBJ_TYPES.OBJ_ADDRESS")),c(2),m("options",e.interfacesIpObjs)("autoDisplayFirst",!1)("placeholder",E(16,16,"GLOBALS.MSG_OBJ_TYPES.OBJ_ADDRESS")),c(6),U(E(22,18,"FW.MSG_FW_EDITION.PORT")),c(3),R(((i=e.formModel.get("install_communication"))==null?null:i.value)==="agent"?24:-1)}}function _p(r,s){r&1&&(p(0,"p"),C(1),y(2,"translate"),f()),r&2&&(c(),U(E(2,1,"FW.MSG_FW_EDITION.NO_IF")))}function up(r,s){if(r&1&&x(0,dp,25,20)(1,_p,3,3,"p"),r&2){let i=_(3);R(i.interfaces!=null&&i.interfaces.length?0:1)}}function fp(r,s){if(r&1){let i=M();Pe(0),p(1,"div",30)(2,"div",31)(3,"h5",32),C(4),y(5,"translate"),f()(),p(6,"div",33)(7,"div",34)(8,"label",35),C(9),y(10,"translate"),f(),O(11,"input",36,3),y(13,"translate"),f(),p(14,"p",37),C(15),y(16,"translate"),f()(),p(17,"div",38)(18,"div",39)(19,"label",40),C(20),y(21,"translate"),f(),p(22,"p-select",41,4),P("onChange",function(){w(i);let t=_(2);return g(t.changeCompilerOptions())}),J(24,Qc,1,1,"ng-template",42)(25,Zc,4,2,"ng-template",43),f()()(),p(26,"div",38)(27,"div",34)(28,"label",44),C(29),y(30,"translate"),f(),p(31,"p-select",45),y(32,"translate"),P("onChange",function(t){w(i);let n=_(2);return g(n.handleFirewallManagementChange(t))}),f()()(),p(33,"div",46)(34,"div",47)(35,"label",48),C(36),y(37,"translate"),f(),O(38,"textarea",49),f()()(),p(39,"div",30)(40,"div",31)(41,"h5",50),C(42),y(43,"translate"),y(44,"translate"),f()(),x(45,ep,14,18)(46,ip,21,28),p(47,"div",51)(48,"p-button",52),y(49,"translate"),P("onClick",function(){w(i);let t=_(2);return g(t.onDiscoverInterfaces())}),f()()(),p(50,"div",30)(51,"div",31)(52,"h5",53),C(53),y(54,"translate"),f()(),x(55,op,22,24)(56,up,2,1),f(),Te()}if(r&2){let i,e,t=_(2);c(4),F(" ",E(5,21,"FW.MSG_FW_EDITION.BASIC_DATA")," "),c(5),U(E(10,23,"FW.MSG_FW_EDITION.NAME")),c(2),m("placeholder",B(E(13,25,"FW.MSG_FW_EDITION.NAME"))),c(3),m("ngStyle",Re(45,fr,t.formModel.get("name").valid||t.formModel.get("name").pristine?"hidden":"visible")),c(),F(" ",E(16,27,"ITEM_PANEL.ERRORS.FIELD_INVALID_NAME")," "),c(5),U(E(21,29,"FW.MSG_FW_EDITION.COMPILER")),c(2),m("options",t.FirewallCompilerOptions),c(7),U(E(30,31,"FW.MSG_FW_EDITION.COMM_TYPE")),c(2),m("options",Qe(50,mr,Re(47,Nc,t.isSSHCommunicationDisabled),Y(49,Gc)))("placeholder",E(32,33,"FW.MSG_FW_EDITION.COMM_TYPE")),c(5),U(E(37,35,"FW.MSG_FW_EDITION.DESC")),c(2),m("rows",3)("cols",30),c(4),F(" ",((i=t.formModel.get("install_communication"))==null?null:i.value)==="agent"?E(43,37,"FW.MSG_FW_EDITION.AGENT_DATA"):E(44,39,"FW.MSG_FW_EDITION.SSH")," "),c(3),R(((e=t.formModel.get("install_communication"))==null?null:e.value)==="agent"?45:46),c(3),m("label",B(E(49,41,"FW.MSG_FW_EDITION.DISCOVER_IF")))("disabled",t.loadingData),c(5),F(" ",E(54,43,"FW.MSG_FW_EDITION.INSTALL")," "),c(2),R(t.discoveredInstallOptions?55:56)}}function mp(r,s){if(r&1){let i=M();Pe(0),p(1,"sts-fwc-interfaces-tree-editor",89,7),P("onInstallModified",function(t){w(i);let n=_(2);return g(n.onEditorInstallModified(t))})("onIpObjectModified",function(t){w(i);let n=_(2);return g(n.onEditorInterfaceOrIpModified(t))})("onStartAutodiscover",function(){w(i);let t=_(2);return g(t.onDiscoverInterfaces(!0))}),f(),Te()}if(r&2){let i=_(2);c(),m("options",i.interfacesEditorOptions)}}function hp(r,s){if(r&1){let i=M();Pe(0),O(1,"input",90),p(2,"div",30)(3,"div",31)(4,"h5",32),C(5),y(6,"translate"),f()(),p(7,"div",91)(8,"div",46)(9,"div",34)(10,"p-checkbox",92),H("ngModelChange",function(t){w(i);let n=_(2);return W(n.optionsFlags.stateful,t)||(n.optionsFlags.stateful=t),g(t)}),P("onChange",function(){w(i);let t=_(2);return g(t.onChangeOptionsFlags())}),f(),p(11,"span",53),C(12),y(13,"translate"),f()()(),p(14,"div",46)(15,"div",34)(16,"p-checkbox",92),H("ngModelChange",function(t){w(i);let n=_(2);return W(n.optionsFlags.ipv4,t)||(n.optionsFlags.ipv4=t),g(t)}),P("onChange",function(){w(i);let t=_(2);return g(t.onChangeOptionsFlags())}),f(),p(17,"span",53),C(18),y(19,"translate"),f()()(),p(20,"div",46)(21,"div",34)(22,"p-checkbox",92),H("ngModelChange",function(t){w(i);let n=_(2);return W(n.optionsFlags.ipv6,t)||(n.optionsFlags.ipv6=t),g(t)}),P("onChange",function(){w(i);let t=_(2);return g(t.onChangeOptionsFlags())}),f(),p(23,"span",53),C(24),y(25,"translate"),f()()(),p(26,"div",46)(27,"div",34)(28,"p-checkbox",92),H("ngModelChange",function(t){w(i);let n=_(2);return W(n.optionsFlags.debug,t)||(n.optionsFlags.debug=t),g(t)}),P("onChange",function(){w(i);let t=_(2);return g(t.onChangeOptionsFlags())}),f(),p(29,"span",53),C(30),y(31,"translate"),f()()(),p(32,"div",46)(33,"div",34)(34,"p-checkbox",92),H("ngModelChange",function(t){w(i);let n=_(2);return W(n.optionsFlags.report,t)||(n.optionsFlags.report=t),g(t)}),P("onChange",function(){w(i);let t=_(2);return g(t.onChangeOptionsFlags())}),f(),p(35,"span",53),C(36),y(37,"translate"),f()()()(),p(38,"div",91)(39,"div",46)(40,"div",34)(41,"p-checkbox",92),H("ngModelChange",function(t){w(i);let n=_(2);return W(n.optionsFlags.docker,t)||(n.optionsFlags.docker=t),g(t)}),P("onChange",function(){w(i);let t=_(2);return g(t.onChangeOptionsFlags())}),f(),C(42," \xA0\xA0 "),p(43,"a",93),te(),p(44,"svg",94),O(45,"use",95),f()(),ie(),p(46,"p",53),C(47),y(48,"translate"),f(),p(49,"a",96),C(50,"(+ info)"),f()()(),p(51,"div",46)(52,"div",34)(53,"p-checkbox",92),H("ngModelChange",function(t){w(i);let n=_(2);return W(n.optionsFlags.crowdsec,t)||(n.optionsFlags.crowdsec=t),g(t)}),P("onChange",function(){w(i);let t=_(2);return g(t.onChangeOptionsFlags())}),f(),C(54," \xA0\xA0 "),p(55,"a",97),te(),p(56,"svg",94),O(57,"use",98),f()(),ie(),p(58,"p",53),C(59),y(60,"translate"),f()()(),p(61,"div",46)(62,"div",34)(63,"p-checkbox",92),H("ngModelChange",function(t){w(i);let n=_(2);return W(n.optionsFlags.fail2ban,t)||(n.optionsFlags.fail2ban=t),g(t)}),P("onChange",function(){w(i);let t=_(2);return g(t.onChangeOptionsFlags())}),f(),C(64," \xA0\xA0 "),p(65,"a",99),te(),p(66,"svg",94),O(67,"use",100),f()(),ie(),p(68,"p",53),C(69),y(70,"translate"),f()()()(),p(71,"div",91)(72,"div",46)(73,"h6",53),C(74),y(75,"translate"),f()(),p(76,"div",46)(77,"div",34)(78,"p-checkbox",92),H("ngModelChange",function(t){w(i);let n=_(2);return W(n.optionsFlags.pdr_warning,t)||(n.optionsFlags.pdr_warning=t),g(t)}),P("onChange",function(){w(i);let t=_(2);return g(t.onChangeOptionsFlags())}),f(),p(79,"span",53),C(80),y(81,"translate"),f()()(),p(82,"div",46)(83,"div",34)(84,"p-checkbox",92),H("ngModelChange",function(t){w(i);let n=_(2);return W(n.optionsFlags.pdr_critical,t)||(n.optionsFlags.pdr_critical=t),g(t)}),P("onChange",function(){w(i);let t=_(2);return g(t.onChangeOptionsFlags())}),f(),p(85,"span",53),C(86),y(87,"translate"),f()()()()(),Te()}if(r&2){let i=_(2);c(5),F(" ",E(6,44,"FW.MSG_FW_EDITION.OPTIONS_DATA")," "),c(5),m("binary",!0),V("ngModel",i.optionsFlags.stateful),m("ngModelOptions",Y(68,ve)),c(2),F("\xA0\xA0",E(13,46,"FW.OPTION_NAMES.stateful")),c(4),m("binary",!0),V("ngModel",i.optionsFlags.ipv4),m("ngModelOptions",Y(69,ve)),c(2),F("\xA0\xA0",E(19,48,"FW.OPTION_NAMES.ipv4")),c(4),m("binary",!0),V("ngModel",i.optionsFlags.ipv6),m("ngModelOptions",Y(70,ve)),c(2),F("\xA0\xA0",E(25,50,"FW.OPTION_NAMES.ipv6")),c(4),m("binary",!0),V("ngModel",i.optionsFlags.debug),m("ngModelOptions",Y(71,ve)),c(2),F("\xA0\xA0",E(31,52,"FW.OPTION_NAMES.debug")),c(4),m("binary",!0),V("ngModel",i.optionsFlags.report),m("ngModelOptions",Y(72,ve)),c(2),F("\xA0\xA0",E(37,54,"FW.OPTION_NAMES.report")),c(5),m("binary",!0),V("ngModel",i.optionsFlags.docker),m("ngModelOptions",Y(73,ve)),c(6),F("\xA0\xA0",E(48,56,"FW.OPTION_NAMES.docker")),c(2),m("href",B(i.dockerDocURL),xi),c(4),m("binary",!0),V("ngModel",i.optionsFlags.crowdsec),m("ngModelOptions",Y(74,ve)),c(6),F("\xA0\xA0",E(60,58,"FW.OPTION_NAMES.crowdsec")),c(4),m("binary",!0),V("ngModel",i.optionsFlags.fail2ban),m("ngModelOptions",Y(75,ve)),c(6),F("\xA0\xA0",E(70,60,"FW.OPTION_NAMES.fail2ban")),c(5),F(" ",E(75,62,"FW.MSG_FW_EDITION.DANGEROUS_RULES_DETECTION")," "),c(4),m("binary",!0),V("ngModel",i.optionsFlags.pdr_warning),m("ngModelOptions",Y(76,ve)),c(2),F("\xA0\xA0",E(81,64,"FW.OPTION_NAMES.pdr_warning")),c(4),m("binary",!0),V("ngModel",i.optionsFlags.pdr_critical),m("ngModelOptions",Y(77,ve)),c(2),F("\xA0\xA0",E(87,66,"FW.OPTION_NAMES.pdr_critical"))}}function wp(r,s){if(r&1&&(p(0,"div",30)(1,"div",46),O(2,"sts-fwc-message",102),f()()),r&2){let i=_(3);c(2),m("message",Qe(1,hr,i.translate.instant("PLUGINS.TITLE"),i.translate.instant("PLUGINS.ERRORS.COMMUNICATION.TEXT")))}}function gp(r,s){if(r&1){let i=M();p(0,"div",30)(1,"div",31)(2,"h5",32),C(3),y(4,"translate"),f()(),p(5,"div",33)(6,"div",46)(7,"div",34)(8,"p-checkbox",92),H("ngModelChange",function(t){w(i);let n=_(3);return W(n.optionsPlugins.openvpn,t)||(n.optionsPlugins.openvpn=t),g(t)}),P("onChange",function(){w(i);let t=_(3);return g(t.onChangePlugins())}),f(),C(9," \xA0\xA0 "),p(10,"a",103),te(),p(11,"svg",94),O(12,"use",104),f()(),ie(),p(13,"p",53),C(14),y(15,"translate"),f()()(),p(16,"div",46)(17,"div",34)(18,"p-checkbox",92),H("ngModelChange",function(t){w(i);let n=_(3);return W(n.optionsPlugins.wireguard,t)||(n.optionsPlugins.wireguard=t),g(t)}),P("onChange",function(){w(i);let t=_(3);return g(t.onChangePlugins())}),f(),C(19," \xA0\xA0 "),p(20,"a",105),te(),p(21,"svg",94),O(22,"use",106),f()(),ie(),p(23,"p",53),C(24),y(25,"translate"),f()()(),p(26,"div",46)(27,"div",34)(28,"p-checkbox",92),H("ngModelChange",function(t){w(i);let n=_(3);return W(n.optionsPlugins.ipsec,t)||(n.optionsPlugins.ipsec=t),g(t)}),P("onChange",function(){w(i);let t=_(3);return g(t.onChangePlugins())}),f(),C(29," \xA0\xA0 "),p(30,"a",107),te(),p(31,"svg",94),O(32,"use",108),f()(),ie(),p(33,"p",53),C(34),y(35,"translate"),f()()(),p(36,"div",46)(37,"div",34)(38,"p-checkbox",92),H("ngModelChange",function(t){w(i);let n=_(3);return W(n.optionsPlugins.keepalived,t)||(n.optionsPlugins.keepalived=t),g(t)}),P("onChange",function(){w(i);let t=_(3);return g(t.onChangePlugins())}),f(),C(39," \xA0\xA0 "),p(40,"a",109),te(),p(41,"svg",94),O(42,"use",110),f()(),ie(),p(43,"p",53),C(44),y(45,"translate"),f()()(),p(46,"div",46)(47,"div",34)(48,"p-checkbox",92),H("ngModelChange",function(t){w(i);let n=_(3);return W(n.optionsPlugins.geoip,t)||(n.optionsPlugins.geoip=t),g(t)}),P("onChange",function(){w(i);let t=_(3);return g(t.onChangePlugins())}),f(),C(49," \xA0\xA0 "),p(50,"a",111),te(),p(51,"svg",94),O(52,"use",112),f()(),ie(),p(53,"p",53),C(54),y(55,"translate"),f()()(),p(56,"div",46)(57,"div",34)(58,"p-checkbox",92),H("ngModelChange",function(t){w(i);let n=_(3);return W(n.optionsPlugins.crowdsec,t)||(n.optionsPlugins.crowdsec=t),g(t)}),P("onChange",function(){w(i);let t=_(3);return g(t.onChangePlugins())}),f(),C(59," \xA0\xA0 "),p(60,"a",97),te(),p(61,"svg",94),O(62,"use",98),f()(),ie(),p(63,"p",53),C(64),y(65,"translate"),f()()(),p(66,"div",46)(67,"div",34)(68,"p-checkbox",92),H("ngModelChange",function(t){w(i);let n=_(3);return W(n.optionsPlugins.ntopng,t)||(n.optionsPlugins.ntopng=t),g(t)}),P("onChange",function(){w(i);let t=_(3);return g(t.onChangePlugins())}),f(),C(69," \xA0\xA0 "),p(70,"a",113),te(),p(71,"svg",94),O(72,"use",114),f()(),ie(),p(73,"p",53),C(74),y(75,"translate"),f()()(),p(76,"div",46)(77,"div",34)(78,"p-checkbox",92),H("ngModelChange",function(t){w(i);let n=_(3);return W(n.optionsPlugins.websafety,t)||(n.optionsPlugins.websafety=t),g(t)}),P("onChange",function(){w(i);let t=_(3);return g(t.onChangePlugins())}),f(),C(79," \xA0\xA0 "),p(80,"a",115),te(),p(81,"svg",94),O(82,"use",116),f()(),ie(),p(83,"p",53),C(84),y(85,"translate"),f()()(),p(86,"div",46)(87,"div",34)(88,"p-checkbox",92),H("ngModelChange",function(t){w(i);let n=_(3);return W(n.optionsPlugins.dnssafety,t)||(n.optionsPlugins.dnssafety=t),g(t)}),P("onChange",function(){w(i);let t=_(3);return g(t.onChangePlugins())}),f(),C(89," \xA0\xA0 "),p(90,"a",117),te(),p(91,"svg",94),O(92,"use",118),f()(),ie(),p(93,"p",53),C(94),y(95,"translate"),f()()(),p(96,"div",46)(97,"div",34)(98,"p-checkbox",92),H("ngModelChange",function(t){w(i);let n=_(3);return W(n.optionsPlugins.suricata,t)||(n.optionsPlugins.suricata=t),g(t)}),P("onChange",function(){w(i);let t=_(3);return g(t.onChangePlugins())}),f(),C(99," \xA0\xA0 "),p(100,"a",119),te(),p(101,"svg",94),O(102,"use",120),f()(),ie(),p(103,"p",53),C(104),y(105,"translate"),f()()()(),p(106,"div",33)(107,"div",46)(108,"div",34)(109,"p-checkbox",92),H("ngModelChange",function(t){w(i);let n=_(3);return W(n.optionsPlugins.zeek,t)||(n.optionsPlugins.zeek=t),g(t)}),P("onChange",function(){w(i);let t=_(3);return g(t.onChangePlugins())}),f(),C(110," \xA0\xA0 "),p(111,"a",121),te(),p(112,"svg",94),O(113,"use",122),f()(),ie(),p(114,"p",53),C(115),y(116,"translate"),f()()(),p(117,"div",46)(118,"div",34)(119,"p-checkbox",92),H("ngModelChange",function(t){w(i);let n=_(3);return W(n.optionsPlugins.elasticsearch,t)||(n.optionsPlugins.elasticsearch=t),g(t)}),P("onChange",function(){w(i);let t=_(3);return g(t.onChangePlugins())}),f(),C(120," \xA0\xA0 "),p(121,"a",123),te(),p(122,"svg",94),O(123,"use",124),f()(),ie(),p(124,"p",53),C(125),y(126,"translate"),f()()(),p(127,"div",46)(128,"div",34)(129,"p-checkbox",92),H("ngModelChange",function(t){w(i);let n=_(3);return W(n.optionsPlugins.kibana,t)||(n.optionsPlugins.kibana=t),g(t)}),P("onChange",function(){w(i);let t=_(3);return g(t.onChangePlugins())}),f(),C(130," \xA0\xA0 "),p(131,"a",125),te(),p(132,"svg",94),O(133,"use",126),f()(),ie(),p(134,"p",53),C(135),y(136,"translate"),f()()(),p(137,"div",46)(138,"div",34)(139,"p-checkbox",92),H("ngModelChange",function(t){w(i);let n=_(3);return W(n.optionsPlugins.logstash,t)||(n.optionsPlugins.logstash=t),g(t)}),P("onChange",function(){w(i);let t=_(3);return g(t.onChangePlugins())}),f(),C(140," \xA0\xA0 "),p(141,"a",127),te(),p(142,"svg",94),O(143,"use",128),f()(),ie(),p(144,"p",53),C(145),y(146,"translate"),f()()(),p(147,"div",46)(148,"div",34)(149,"p-checkbox",92),H("ngModelChange",function(t){w(i);let n=_(3);return W(n.optionsPlugins.filebeat,t)||(n.optionsPlugins.filebeat=t),g(t)}),P("onChange",function(){w(i);let t=_(3);return g(t.onChangePlugins())}),f(),C(150," \xA0\xA0 "),p(151,"a",129),te(),p(152,"svg",94),O(153,"use",130),f()(),ie(),p(154,"p",53),C(155),y(156,"translate"),f()()(),p(157,"div",46)(158,"div",34)(159,"p-checkbox",92),H("ngModelChange",function(t){w(i);let n=_(3);return W(n.optionsPlugins.iscdhcp,t)||(n.optionsPlugins.iscdhcp=t),g(t)}),P("onChange",function(){w(i);let t=_(3);return g(t.onChangePlugins())}),f(),C(160," \xA0\xA0 "),p(161,"a",131),te(),p(162,"svg",94),O(163,"use",132),f()(),ie(),p(164,"p",53),C(165),y(166,"translate"),f()()(),p(167,"div",46)(168,"div",34)(169,"p-checkbox",92),H("ngModelChange",function(t){w(i);let n=_(3);return W(n.optionsPlugins.haproxy,t)||(n.optionsPlugins.haproxy=t),g(t)}),P("onChange",function(){w(i);let t=_(3);return g(t.onChangePlugins())}),f(),C(170," \xA0\xA0 "),p(171,"a",133),te(),p(172,"svg",94),O(173,"use",134),f()(),ie(),p(174,"p",53),C(175),y(176,"translate"),f()()(),p(177,"div",46)(178,"div",34)(179,"p-checkbox",92),H("ngModelChange",function(t){w(i);let n=_(3);return W(n.optionsPlugins.iscbind9,t)||(n.optionsPlugins.iscbind9=t),g(t)}),P("onChange",function(){w(i);let t=_(3);return g(t.onChangePlugins())}),f(),C(180," \xA0\xA0 "),p(181,"a",135),te(),p(182,"svg",94),O(183,"use",136),f()(),ie(),p(184,"p",53),C(185),y(186,"translate"),f()()(),p(187,"div",46)(188,"div",34)(189,"p-checkbox",92),H("ngModelChange",function(t){w(i);let n=_(3);return W(n.optionsPlugins.irqbalance,t)||(n.optionsPlugins.irqbalance=t),g(t)}),P("onChange",function(){w(i);let t=_(3);return g(t.onChangePlugins())}),f(),C(190," \xA0\xA0 "),p(191,"a",137),te(),p(192,"svg",94),O(193,"use",138),f()(),ie(),p(194,"p",53),C(195),y(196,"translate"),f()()()()()}if(r&2){let i=_(3);c(3),F(" ",E(4,77,"FW.MSG_FW_EDITION.PLUGINS")," "),c(5),m("binary",!0),V("ngModel",i.optionsPlugins.openvpn),m("ngModelOptions",Y(117,ve)),c(6),F("\xA0\xA0",E(15,79,"FW.PLUGINS.OPENVPN")),c(4),m("binary",!0),V("ngModel",i.optionsPlugins.wireguard),m("ngModelOptions",Y(118,ve)),c(6),F("\xA0\xA0",E(25,81,"FW.PLUGINS.WIREGUARD")),c(4),m("binary",!0),V("ngModel",i.optionsPlugins.ipsec),m("ngModelOptions",Y(119,ve)),c(6),F("\xA0\xA0",E(35,83,"FW.PLUGINS.IPSEC")),c(4),m("binary",!0),V("ngModel",i.optionsPlugins.keepalived),m("ngModelOptions",Y(120,ve)),c(6),F("\xA0\xA0",E(45,85,"FW.PLUGINS.KEEPALIVED")),c(4),m("binary",!0),V("ngModel",i.optionsPlugins.geoip),m("ngModelOptions",Y(121,ve)),c(6),F("\xA0\xA0",E(55,87,"FW.PLUGINS.GEOIP")),c(4),m("binary",!0),V("ngModel",i.optionsPlugins.crowdsec),m("ngModelOptions",Y(122,ve)),c(6),F("\xA0\xA0",E(65,89,"FW.PLUGINS.CROWDSEC")),c(4),m("binary",!0),V("ngModel",i.optionsPlugins.ntopng),m("ngModelOptions",Y(123,ve)),c(6),F("\xA0\xA0",E(75,91,"FW.PLUGINS.NTOPNG")),c(4),m("binary",!0),V("ngModel",i.optionsPlugins.websafety),m("ngModelOptions",Y(124,ve)),c(6),F("\xA0\xA0",E(85,93,"FW.PLUGINS.WEBSAFETY")),c(4),m("binary",!0),V("ngModel",i.optionsPlugins.dnssafety),m("ngModelOptions",Y(125,ve)),c(6),F("\xA0\xA0",E(95,95,"CLUSTER.PLUGINS.DNSSAFETY")),c(4),m("binary",!0),V("ngModel",i.optionsPlugins.suricata),m("ngModelOptions",Y(126,ve)),c(6),F("\xA0\xA0",E(105,97,"FW.PLUGINS.SURICATA")),c(5),m("binary",!0),V("ngModel",i.optionsPlugins.zeek),m("ngModelOptions",Y(127,ve)),c(6),F("\xA0\xA0",E(116,99,"FW.PLUGINS.ZEEK")),c(4),m("binary",!0),V("ngModel",i.optionsPlugins.elasticsearch),m("ngModelOptions",Y(128,ve)),c(6),F("\xA0\xA0",E(126,101,"CLUSTER.PLUGINS.ELASTICSEARCH")),c(4),m("binary",!0),V("ngModel",i.optionsPlugins.kibana),m("ngModelOptions",Y(129,ve)),c(6),F("\xA0\xA0",E(136,103,"CLUSTER.PLUGINS.KIBANA")),c(4),m("binary",!0),V("ngModel",i.optionsPlugins.logstash),m("ngModelOptions",Y(130,ve)),c(6),F("\xA0\xA0",E(146,105,"CLUSTER.PLUGINS.LOGSTASH")),c(4),m("binary",!0),V("ngModel",i.optionsPlugins.filebeat),m("ngModelOptions",Y(131,ve)),c(6),F("\xA0\xA0",E(156,107,"FW.PLUGINS.FILEBEAT")),c(4),m("binary",!0),V("ngModel",i.optionsPlugins.iscdhcp),m("ngModelOptions",Y(132,ve)),c(6),F("\xA0\xA0",E(166,109,"FW.PLUGINS.ISCDHCP")),c(4),m("binary",!0),V("ngModel",i.optionsPlugins.haproxy),m("ngModelOptions",Y(133,ve)),c(6),F("\xA0\xA0",E(176,111,"FW.PLUGINS.HAPROXY")),c(4),m("binary",!0),V("ngModel",i.optionsPlugins.iscbind9),m("ngModelOptions",Y(134,ve)),c(6),F("\xA0\xA0",E(186,113,"FW.PLUGINS.ISCBIND9")),c(4),m("binary",!0),V("ngModel",i.optionsPlugins.irqbalance),m("ngModelOptions",Y(135,ve)),c(6),F("\xA0\xA0",E(196,115,"FW.PLUGINS.IRQBALANCE"))}}function Sp(r,s){if(r&1&&(Pe(0),O(1,"input",101),x(2,wp,3,4,"div",30),x(3,gp,197,136,"div",30),Te()),r&2){let i,e,t=_(2);c(2),R(((i=t.formModel.get("install_communication"))==null?null:i.value)!=="agent"?2:-1),c(),R(((e=t.formModel.get("install_communication"))==null?null:e.value)==="agent"?3:-1)}}function Cp(r,s){if(r&1&&(p(0,"div",30)(1,"div",46),O(2,"sts-fwc-message",102),f()()),r&2){let i=_(3);c(2),m("message",Qe(1,hr,i.translate.instant("NGFW.TITLE"),i.translate.instant("NGFW.ERRORS.COMMUNICATION.TEXT")))}}function yp(r,s){if(r&1){let i=M();p(0,"div",30)(1,"div",31)(2,"h5",32),C(3),y(4,"translate"),f()(),p(5,"div",139)(6,"div",38)(7,"div",140)(8,"label",141)(9,"a",113),te(),p(10,"svg",94),O(11,"use",114),f()(),C(12),y(13,"translate"),f(),ie(),p(14,"p-button",142),y(15,"translate"),y(16,"translate"),P("onClick",function(){w(i);let t=_(3);return g(t.onClickButtonNGFW("NTOPNG"))}),f()()(),p(17,"div",38)(18,"div",140)(19,"label",143)(20,"a",115),te(),p(21,"svg",94),O(22,"use",116),f()(),C(23),y(24,"translate"),f(),ie(),p(25,"p-button",142),y(26,"translate"),y(27,"translate"),P("onClick",function(){w(i);let t=_(3);return g(t.onClickButtonNGFW("WEBSAFETYPROXY"))}),f()()(),p(28,"div",38)(29,"div",140)(30,"label",144)(31,"a",117),te(),p(32,"svg",94),O(33,"use",118),f()(),C(34),y(35,"translate"),f(),ie(),p(36,"p-button",142),y(37,"translate"),y(38,"translate"),P("onClick",function(){w(i);let t=_(3);return g(t.onClickButtonNGFW("DNSSAFETY"))}),f()()(),p(39,"div",38)(40,"div",140)(41,"label",145)(42,"a",123),te(),p(43,"svg",94),O(44,"use",124),f()(),C(45),y(46,"translate"),f(),ie(),p(47,"p-button",142),y(48,"translate"),y(49,"translate"),P("onClick",function(){w(i);let t=_(3);return g(t.onClickButtonNGFW("ELASTICSEARCH"))}),f()()()()()}if(r&2){let i=_(3);c(3),F(" ",E(4,25,"NGFW.DESCRIPTION")," "),c(9),F(" ",E(13,27,"CONTEXT.FW.NTOPNG")," "),c(2),m("pTooltip",B(E(15,29,"CONTEXT.FW.NTOPNG")))("label",B(E(16,31,"CONTEXT.FW.NTOPNG")))("disabled",!i.checksNtopNGConfig()),c(9),F(" ",E(24,33,"CONTEXT.FW.WEBSAFETYPROXY")," "),c(2),m("pTooltip",B(E(26,35,"CONTEXT.FW.WEBSAFETYPROXY")))("label",B(E(27,37,"CONTEXT.FW.WEBSAFETYPROXY")))("disabled",!i.checksWebSafetyProxyActie()),c(9),F(" ",E(35,39,"CONTEXT.FW.DNSSAFETY")," "),c(2),m("pTooltip",B(E(37,41,"CONTEXT.FW.DNSSAFETY")))("label",B(E(38,43,"CONTEXT.FW.DNSSAFETY")))("disabled",!i.checksDNSSafetyActive()),c(9),F(" ",E(46,45,"CLUSTER.PLUGINS.ELASTICSEARCH")," "),c(2),m("pTooltip",B(E(48,47,"CLUSTER.PLUGINS.ELASTICSEARCH")))("label",B(E(49,49,"CLUSTER.PLUGINS.ELASTICSEARCH")))("disabled",!i.checksElasticSearchActive())}}function Ep(r,s){if(r&1&&(Pe(0),x(1,Cp,3,4,"div",30),x(2,yp,50,51,"div",30),Te()),r&2){let i,e,t=_(2);c(),R(((i=t.formModel.get("install_communication"))==null?null:i.value)!=="agent"?1:-1),c(),R(((e=t.formModel.get("install_communication"))==null?null:e.value)==="agent"?2:-1)}}function vp(r,s){if(r&1){let i=M();p(0,"form",18),P("keyup.enter",function(t){w(i);let n=_();return g(n.checkForm(t))})("keyup.esc",function(){w(i);let t=_();return g(t.onCancel())}),p(1,"fieldset",19)(2,"div",20)(3,"div",21)(4,"button",22),P("click",function(){w(i);let t=_();return g(t.shownPanel=0)}),O(5,"i",23),p(6,"span"),C(7),y(8,"translate"),f()(),p(9,"button",22),P("click",function(){w(i);let t=_();return g(t.shownPanel=1)}),O(10,"i",24),p(11,"span"),C(12),y(13,"translate"),f()(),p(14,"button",22),P("click",function(){w(i);let t=_();return g(t.shownPanel=2)}),O(15,"i",25),p(16,"span"),C(17),y(18,"translate"),f()(),p(19,"button",22),P("click",function(){w(i);let t=_();return g(t.shownPanel=3)}),O(20,"i",26),p(21,"span"),C(22),y(23,"translate"),f()(),p(24,"button",22),P("click",function(){w(i);let t=_();return g(t.shownPanel=4)}),O(25,"i",27),p(26,"span"),C(27),y(28,"translate"),f()()(),p(29,"section",28),J(30,fp,57,53,"ng-container",29)(31,mp,3,1,"ng-container",29)(32,hp,88,78,"ng-container",29)(33,Sp,4,2,"ng-container",29)(34,Ep,3,2,"ng-container",29),f()()()()}if(r&2){let i,e,t=_();m("formGroup",t.formModel),c(),m("disabled",t.loadingData),c(3),Je("is-active",t.shownPanel===0),m("disabled",t.loadingData),c(3),U(E(8,27,"FW.MSG_FW_TAB.FT_0")),c(2),Je("is-active",t.shownPanel===1),m("disabled",t.loadingData),c(3),U(E(13,29,"FW.MSG_FW_TAB.FT_1")),c(2),Je("is-active",t.shownPanel===2),m("disabled",t.loadingData),c(3),U(E(18,31,"FW.MSG_FW_TAB.FT_2")),c(2),Je("is-active",t.shownPanel===3),m("disabled",t.loadingData||((i=t.formModel.get("install_communication"))==null?null:i.value)!=="agent"),c(3),U(E(23,33,"FW.MSG_FW_EDITION.PLUGINS")),c(2),Je("is-active",t.shownPanel===4),m("disabled",t.loadingData||((e=t.formModel.get("install_communication"))==null?null:e.value)!=="agent"),c(3),U(E(28,35,"NGFW.TITLE")),c(3),m("ngIf",t.shownPanel===0),c(),m("ngIf",t.shownPanel===1),c(),m("ngIf",t.shownPanel===2),c(),m("ngIf",t.shownPanel===3),c(),m("ngIf",t.shownPanel===4)}}function Ip(r,s){if(r&1&&(p(0,"div",146),O(1,"sts-fwc-message",102),f()),r&2){let i=_(2);c(),m("message",i.delMessage)}}function bp(r,s){if(r&1){let i=M();p(0,"div",147),O(1,"sts-fwc-message",102),p(2,"sts-fwc-object-restrictions",148),P("onHideParent",function(){w(i);let t=_(3);return g(t.minimizeDialog(!0))})("onRefreshRestrictions",function(){w(i);let t=_(3);return g(t.reloadPanel())}),f()()}if(r&2){let i=_(3);c(),m("message",i.deleteMsgError),c(),m("dependencies",i.dependencies)}}function Pp(r,s){if(r&1&&x(0,bp,3,2,"div",147),r&2){let i=_(2);R(i.dependencies.restrictionsError?-1:0)}}function Tp(r,s){if(r&1){let i=M();p(0,"div",149)(1,"div",150)(2,"p-checkbox",151),H("ngModelChange",function(t){w(i);let n=_(3);return W(n.okToDelete,t)||(n.okToDelete=t),g(t)}),f(),p(3,"span",152),C(4),y(5,"translate"),f()()()}if(r&2){let i=_(3);c(2),V("ngModel",i.okToDelete),c(2),F(" ",E(5,2,"FW.MSG_FW_DELETE.DEL_5")," ")}}function Op(r,s){if(r&1&&(O(0,"sts-fwc-message",102),x(1,Tp,6,4,"div",149)),r&2){let i=_(2);m("message",i.deleteMsgError),c(),R(i.loadingData?-1:1)}}function xp(r,s){if(r&1&&(x(0,Ip,2,1,"div",146),x(1,Pp,1,1)(2,Op,2,2)),r&2){let i=_();R(i.loadingData&&!i.deleteMsgError?0:-1),c(),R(i.dependencies?1:2)}}function Rp(r,s){if(r&1&&(p(0,"div",153),O(1,"p-progressSpinner",158),f()),r&2){let i=_(3);m("ngStyle",Re(1,fr,i.loadingData?"visible":"hidden"))}}function Fp(r,s){if(r&1){let i=M();p(0,"p-button",159),y(1,"translate"),P("onClick",function(){w(i);let t=_(3);return g(t.onCloseDialog())}),f()}r&2&&m("label",B(E(1,2,"GLOBALS.MSG_BUTTONS.STOP")))}function Ap(r,s){if(r&1){let i=M();p(0,"p-button",160),y(1,"translate"),P("onClick",function(){w(i);let t=_(3);return g(t.onCancel())}),f()}if(r&2){let i=_(3);m("label",B(E(1,3,"GLOBALS.MSG_BUTTONS.CANCEL")))("disabled",i.loadingData)}}function Lp(r,s){if(r&1){let i=M();p(0,"p-button",161),y(1,"translate"),P("onClick",function(){w(i);let t=_(3);return g(t.onSave())}),f()}if(r&2){let i=_(3);m("label",B(E(1,3,"GLOBALS.MSG_BUTTONS.SAVE")))("disabled",!i.formModel.valid||i.loadingData)}}function Mp(r,s){if(r&1){let i=M();p(0,"p-button",162),y(1,"translate"),P("onClick",function(){w(i);let t=_(3);return g(t.onCancel())}),f()}if(r&2){let i=_(3);m("label",B(E(1,3,"GLOBALS.MSG_BUTTONS.CLOSE")))("disabled",i.loadingData)}}function Dp(r,s){if(r&1&&(x(0,Rp,2,3,"div",153),x(1,Fp,2,4,"p-button",154),x(2,Ap,2,5,"p-button",155),x(3,Lp,2,5,"p-button",156),x(4,Mp,2,5,"p-button",157)),r&2){let i=_(2);R(i.loadingCommunication?0:-1),c(),R(i.loadingCommunication?1:-1),c(),R(!i.formModel.pristine&&!i.loadingCommunication?2:-1),c(),R(i.formModel.pristine?-1:3),c(),R(i.formModel.pristine?4:-1)}}function Np(r,s){if(r&1){let i=M();p(0,"p-button",165),y(1,"translate"),P("onClick",function(){w(i);let t=_(3);return g(t.reloadPanel())}),f()}if(r&2){let i=_(3);m("label",B(E(1,3,"POLICY_GRID.RELOAD")))("disabled",i.loadingData)}}function Gp(r,s){if(r&1){let i=M();x(0,Np,2,5,"p-button",163),p(1,"p-button",164),y(2,"translate"),P("onClick",function(){w(i);let t=_(2);return g(t.onDeleteFirewall())}),f(),p(3,"p-button",162),y(4,"translate"),P("onClick",function(){w(i);let t=_(2);return g(t.onCancel())}),f()}if(r&2){let i=_(2);R(i.dependencies?0:-1),c(),m("label",B(E(2,7,"FW.MSG_FW_EDITION.DELETE")))("disabled",!i.okToDelete||i.loadingData),c(2),m("label",B(E(4,9,"GLOBALS.MSG_BUTTONS.CANCEL")))("disabled",i.loadingData)}}function Up(r,s){if(r&1&&(x(0,Dp,5,5),x(1,Gp,5,11)),r&2){let i=_();R(i.firewall?0:-1),c(),R(i.firewallToDelete?1:-1)}}var Ke=(function(r){return r.stateful="stateful",r.ipv4="ipv4",r.ipv6="ipv6",r.debug="debug",r.report="report",r.docker="docker",r.crowdsec="crowdsec",r.fail2ban="fail2ban",r.pdr_warning="pdr_warning",r.pdr_critical="pdr_critical",r})(Ke||{}),it=(function(r){return r.openvpn="openvpn",r.wireguard="wireguard",r.ipsec="ipsec",r.geoip="geoip",r.crowdsec="crowdsec",r.ntopng="ntopng",r.suricata="suricata",r.keepalived="keepalived",r.zeek="zeek",r.elasticsearch="elasticsearch",r.filebeat="filebeat",r.websafety="websafety",r.kibana="kibana",r.logstash="logstash",r.dnssafety="dnssafety",r.iscbind9="iscbind9",r.iscdhcp="iscdhcp",r.haproxy="haproxy",r.irqbalance="irqbalance",r})(it||{}),kp=Mt.find(r=>r.name.toLowerCase()==="vyos")?.id??2,ho=new Map([[Ke.stateful,0],[Ke.ipv4,1],[Ke.ipv6,2],[Ke.debug,3],[Ke.report,4],[Ke.docker,5],[Ke.crowdsec,6],[Ke.fail2ban,7],[Ke.pdr_warning,8],[Ke.pdr_critical,9]]),Bp=[Ke.stateful,Ke.ipv4,Ke.pdr_warning,Ke.pdr_critical],_r=Bp.reduce((r,s)=>{let i=ho.get(s);return i!==void 0?r+2**i:r},0),tt=new Map([["openvpn",1],["geoip",2],["crowdsec",4],["ntopng",8],["suricata",16],["keepalived",32],["zeek",64],["elasticsearch",128],["filebeat",256],["websafety",512],["kibana",1024],["logstash",2048],["dnssafety",4096],["iscbind9",8192],["iscdhcp",16384],["haproxy",32768],["wireguard",65536],["ipsec",131072],["irqbalance",262144]]),wr=(()=>{let s=class s extends Jt{userAndPassValidator(e){let t=this,n=t.controls.install_user.value,l=t.controls.install_pass.value;return(!n||!n.length)&&l&&l.length?{userandpass:!0}:null}constructor(e,t,n,l,o,a,u,d,h,S,v,b,T,A,N,j,D){super(S,a,t,N,j,D),this.fwcUserService=e,this.itemSelectedService=t,this.fwcFirewallService=n,this.fwcInterfaceService=l,this.confirmationService=o,this.appOptionsService=a,this.fwcPolicyService=u,this.fwcEventService=d,this.fwcErrorPipe=h,this.appDialogPanelsService=S,this.messageService=v,this.translate=b,this.utilService=T,this.inputDataService=A,this.cd=N,this.store=j,this.router=D,this.firewall=null,this.firewallToDelete=null,this.interfaces=[],this.interfacesIpObjs=[],this.displaySSH=!1,this.loadingData=!1,this.loadingCommunication=!1,this.dependencies=null,this.okToDelete=!1,this.alive=!0,this.displayApiKey=!1,this.isVyOSCompilerSelected=!1,this.isSSHCommunicationDisabled=!1,this.FirewallCompilerOptions=Mt,this.wasVyOSCompilerSelected=!1,this.lastCommunicationBeforeVyOS=null,this.hasInitializedCommunicationState=!1,this.optionsFlags={stateful:!1,ipv4:!1,ipv6:!1,debug:!1,report:!1,docker:!1,crowdsec:!1,fail2ban:!1,pdr_warning:!1,pdr_critical:!1},this.optionsPlugins={openvpn:!1,wireguard:!1,ipsec:!1,geoip:!1,crowdsec:!1,ntopng:!1,suricata:!1,keepalived:!1,zeek:!1,elasticsearch:!1,filebeat:!1,websafety:!1,kibana:!1,logstash:!1,dnssafety:!1,iscbind9:!1,iscdhcp:!1,haproxy:!1,irqbalance:!1},this.createDialog(this.translate.instant("FW.PANEL_TITLE"),"fwci-firewalls",Z.FIREWALL_PANEL),this.helpSection="/firewalls",this.resetForm()}ngOnInit(){this.dockerDocURL=`https://fwcloud.net/${this.translate.currentLang!=="es"?this.translate.currentLang+"/":""}documentation/fwcloud-docker`,this.deleteMsgError=null,this.store.pipe(oe(()=>this.alive),di(Ji.selectDialogUuidsToReload)).subscribe(e=>{e&&e.find(t=>t===this.dialogUUID)&&this.reloadPanel()}),this.checkSSHCommunicationConfig(),this.itemSelectedService.getItem().pipe(oe(()=>this.alive)).subscribe(e=>{e._fwcObjType==I.OBJ_FIREWALL&&(this.itemSelectedService.hideObjectPanel(),e.deleteAction?(this.showDialog(),this.checkFirewallRestrictions(e)):(this.resetForm(),e.id_obj!==null&&e.id_obj!=null?Promise.all([this.getClusterNodes(e._fwcClusterId,e.id_obj)]).then(([t])=>{let n=this.getMasterFirewall(t);n||(n=e.id_obj),Promise.all([this.getFirewall(e.id_obj),this.getFirewallInterfaces(n)]).then(a=>le(this,[a],function*([l,o]){this.firewall=l.data;let u=this.fwcUserService.getActualFwcUser().privateKey;try{this.firewall.install_user&&(this.firewall.install_user=yield this.utilService.openPGPDecrypt(this.firewall.install_user,u)),this.firewall.install_pass&&(this.firewall.install_pass=yield this.utilService.openPGPDecrypt(this.firewall.install_pass,u)),this.firewall.install_apikey&&(this.firewall.install_apikey=yield this.utilService.openPGPDecrypt(this.firewall.install_apikey,u))}catch{}this.firewall._fwcClusterId=e._fwcClusterId,this.firewall.firewallUUID=Ft(),this.interfaces=o.data;let d,h;Array.isArray(this.interfaces)&&this.interfaces.forEach(S=>{S.interfaceUUID=Xi(),this.firewall.install_interface&&this.firewall.install_interface===S.id&&(this.firewall.installInterfaceUUID=S.interfaceUUID,d=S),Array.isArray(S.ipobjs)&&S.ipobjs.forEach(v=>{v.ipObjUUID=S.interfaceUUID+Xi(),this.firewall.install_ipobj&&this.firewall.install_ipobj===v.id&&(this.firewall.installIpObjUUID=v.ipObjUUID,h=v)})}),Array.isArray(this.interfaces)&&(this.interfacesEditorOptions={isCluster:!1,firewalls:[{firewallUUID:this.firewall.firewallUUID,firewall_name:this.firewall.name,firewall:this.firewall.id,cluster:null,installOptions:{firewallUUID:this.firewall.firewallUUID,interface:d,ipobj:h}}],discoveredFirewallUUID:this.firewall.firewallUUID,discoveredIfs:[],existingIfs:this.interfaces}),this.fillForm(),this.showDialog()})).catch(l=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(l)})})}).catch(t=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(t)})}):(this.firewall={firewallUUID:Ft(),id:void 0,fwmaster:1,node_id:e.node_id,options:_r,plugins:0},this.fillForm(),this.showDialog())))})}ngOnDestroy(){this.compilerControlSubscription&&(this.compilerControlSubscription.unsubscribe(),this.compilerControlSubscription=null),super.ngOnDestroy()}reloadPanel(){if(this.firewallToDelete&&this.firewallToDelete&&(this.displayDialog||this.dialogMinified)){let e=Object.assign({},this.firewallToDelete),t=this.itemSelectedService.getActualLastMinifiedDialogId();this.checkFirewallRestrictions(e),this.dialogId==t&&(this.showDialog(),this.itemSelectedService.setLastMinifiedDialogId(void 0)),this.store.dispatch(Ce.reloadDialogFinished({dialogUuid:this.dialogUUID}))}}resetProperties(){this.isVyOSCompilerSelected=!1,this.wasVyOSCompilerSelected=!1,this.lastCommunicationBeforeVyOS=null,this.hasInitializedCommunicationState=!1,this.firewall=null,this.firewallToDelete=null,this.interfaces=[],this.interfacesIpObjs=[],this.dependencies=null,this.deleteMsgError=null,this.delMessage=null,this.fwcUserService.setConfirmationToken(void 0),this.interfacesEditorOptions=null,this.fwcInterfacesEditor&&this.fwcInterfacesEditor.resetProperties(),this.discoveredInstallOptions=null,this.formModel&&this.formModel.reset()}resetForm(){this.compilerControlSubscription&&(this.compilerControlSubscription.unsubscribe(),this.compilerControlSubscription=null),this.formModel=new Ei({cluster:new K(null),name:new K("",ee.required),comment:new K(""),fwcloud:new K(this.fwcUserService.getActualFwSelectedCloud()),install_user:new K(""),install_pass:new K(""),save_user_pass:new K(1),install_interface:new K(null),install_ipobj:new K(null),fwmaster:new K(1),install_port:new K(33033),options:new K(_r),node_id:new K(null),firewall:new K(null),plugins:new K(0),compiler:new K(0),install_communication:new K("agent",[ee.required]),install_protocol:new K("https"),install_apikey:new K("")}),this.formModel.get("install_interface").valueChanges.subscribe(e=>{this.onInterfaceChange(+e)}),this.setOptionsFlags()}fillForm(){if(this.firewall){this.formModel.controls.cluster.setValue(this.firewall.cluster),this.formModel.controls.name.setValue(this.firewall.name,[ee.pattern(Fe.nameRegExp)]),this.formModel.controls.comment.setValue(this.firewall.comment),this.formModel.controls.install_user.setValue(this.firewall.install_user,[ee.pattern(Fe.linuxUsername)]),this.formModel.controls.install_pass.setValue(this.firewall.install_pass,[ee.pattern(Fe.linuxPassword)]),this.formModel.controls.save_user_pass.setValue(1),this.formModel.controls.install_interface.setValue(this.firewall.install_interface),this.formModel.controls.install_ipobj.setValue(this.firewall.install_ipobj),this.formModel.controls.fwmaster.setValue(this.firewall.fwmaster),this.firewall.install_port&&this.formModel.controls.install_port.setValue(this.firewall.install_port),this.formModel.controls.options.setValue(this.firewall.options),this.setOptionsFlags(),this.formModel.controls.plugins.setValue(this.firewall.plugins),this.setOptionsPlugins(),this.formModel.controls.node_id.setValue(this.firewall.node_id),this.formModel.controls.firewall.setValue(this.firewall.id),this.firewall.install_communication&&this.formModel.controls.install_communication.setValue(this.firewall.install_communication),this.firewall.install_protocol&&this.formModel.controls.install_protocol.setValue(this.firewall.install_protocol),this.firewall.install_apikey&&this.formModel.controls.install_apikey.setValue(this.firewall.install_apikey),this.firewall.type=I.OBJ_FIREWALL,this.firewall.container=Ge.C_FIREWALLS;let e=this.firewall.options&61440;this.formModel.controls.compiler.setValue(e>>12),this.updateCompilerState()}}onInterfaceChange(e){if(this.interfaces){for(let t=0;t<this.interfaces.length;t++)this.interfaces[t]&&this.interfaces[t].id==e&&(this.interfacesIpObjs=this.interfaces[t].ipobjs);this.formModel.get("install_ipobj").setValue(null)}}setOptionsFlags(){let e=this.firewall?.options??this.formModel?.get("options")?.value??0;Object.values(Ke).forEach(t=>{this.optionsFlags[t]=!!(e&2**ho.get(t))})}onChangeOptionsFlags(){let e=[];for(let t of Object.values(Ke)){let n=ho.get(t);e[n]=this.optionsFlags[t]?"1":"0"}this.formModel.controls.options.setValue(parseInt(e.reduce((t,n)=>n+t,""),2)),this.formModel.markAsDirty()}changeCompilerOptions(){let e=this.formModel.get("compiler").value,t=this.formModel.get("options").value,n=e<<12,l=t&4095;this.formModel.get("options").setValue(n|l),this.updateCompilerState()}updateCompilerState(){if(!this.formModel){this.isVyOSCompilerSelected=!1,this.wasVyOSCompilerSelected=!1,this.lastCommunicationBeforeVyOS=null;return}let e=this.formModel.get("compiler"),n=(typeof e?.value=="number"?e.value:Number(e?.value))===kp,l=this.formModel.get("install_communication");if(!l){this.isVyOSCompilerSelected=n,this.wasVyOSCompilerSelected=n;return}if(n){if(!this.wasVyOSCompilerSelected){let o=l.value;o&&o!=="ssh"&&(this.lastCommunicationBeforeVyOS=o)}l.value!=="ssh"?(l.setValue("ssh"),this.handleFirewallManagementChange("ssh")):this.wasVyOSCompilerSelected||this.handleFirewallManagementChange("ssh"),this.hasInitializedCommunicationState=!0}else this.wasVyOSCompilerSelected&&this.lastCommunicationBeforeVyOS&&this.lastCommunicationBeforeVyOS!=="ssh"?(l.setValue(this.lastCommunicationBeforeVyOS),this.handleFirewallManagementChange(this.lastCommunicationBeforeVyOS)):this.hasInitializedCommunicationState||this.handleFirewallManagementChange(l.value),this.lastCommunicationBeforeVyOS=null,this.hasInitializedCommunicationState=!0;this.isVyOSCompilerSelected=n,this.wasVyOSCompilerSelected=n}getMasterFirewall(e){let t=null;if(e.data)for(let n=0;n<e.data.length;n++){let l=e.data[n];if(l.fwmaster){t=l.id;break}}return t}getClusterNodes(e,t){let n={};return new Promise((o,a)=>{e?this.fwcFirewallService.getClusterNodes(e,this.fwcUserService.getActualFwSelectedCloud()).subscribe(u=>{o(u)},u=>{a(u)}):o(n)})}getFirewalls(){return new Promise((t,n)=>{this.fwcFirewallService.getFirewallsByCloud(this.fwcUserService.getActualFwSelectedCloud()).subscribe(l=>{t(l)},l=>{n(l)})})}getClusters(){return new Promise((t,n)=>{this.fwcFirewallService.getClustersByCloud(this.fwcUserService.getActualFwSelectedCloud()).subscribe(l=>{t(l)},l=>{n(l)})})}getFirewall(e){return new Promise((n,l)=>{this.fwcFirewallService.getFirewall(e,this.fwcUserService.getActualFwSelectedCloud()).subscribe(o=>{n(o)},o=>{l(o)})})}getFirewallInterfaces(e){return new Promise((n,l)=>{this.fwcInterfaceService.getInterfacesInFwFull(e,this.fwcUserService.getActualFwSelectedCloud()).subscribe(o=>{n(o)},o=>{l(o)})})}onCancel(e){!e&&this.formModel&&!this.formModel.pristine&&this.formModel.valid?this.confirmationService.confirm({header:this.translate.instant("GLOBALS.MSG_CONFIRM"),icon:"fa fa-question-circle fwcBlue iconBig",message:this.translate.instant("FW.MSG_FW_EXIT"),accept:()=>{this.onCancel(!0)},rejectVisible:!0,rejectLabel:"No",acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.YES")}):(this.hideDialog(),this.resetProperties()),this.shownPanel=0}checkFirewallRestrictions(e){e&&(this.loadingData=!0,this.firewallToDelete=e,this.dependencies=null,this.deleteMsgError=null,this.delMessage={type:"loading",title:e._fwcClusterId?this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.CHECKING_HEAD"):this.translate.instant("FW.MSG_FW_DELETE.CHECKING_HEAD"),text:e._fwcClusterId?this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.CHECKING_TEXT"):this.translate.instant("FW.MSG_FW_DELETE.CHECKING_TEXT")},this.okToDelete=!1,Promise.all([this.getClusterNodes(e._fwcClusterId,e.id_obj),this.getFirewalls(),this.getClusters()]).then(([t,n,l])=>{let o=n.data,a=l.data;for(let d=0;d<o.length;d++){let h=o[d];if(h.cluster!==null&&h.cluster!==void 0)for(let S=0;S<a.length;S++){let v=a[S];if(h.cluster==v.id){h.cluster_name=v.name;break}}}let u=this.getMasterFirewall(t);if(u||(u=e.id_obj),e._fwcClusterId){this.fwcFirewallService.checkClusterRestrictions(u,this.fwcUserService.getActualFwSelectedCloud()).subscribe(()=>{this.deleteMsgError={type:"warning",title:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.DEL_2"),text:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.DEL_3",{name:e._fwcObjName})},this.dependencies=null,this.loadingData=!1,this.recenterDialog()},d=>{if(d.error&&d.error.restrictions)try{this.dependencies=d.error.restrictions,this.dependencies._fwcRestrictedObject={_fwcObjId:u,_fwcObjType:I.OBJ_CLUSTER},this.deleteMsgError={type:"error",title:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.DEL_0"),text:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.DEL_1",{name:e._fwcObjName})},this.recenterDialog()}catch(h){this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:h})}else this.deleteMsgError={type:"error",title:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.ERROR_RES_HEAD"),text:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.ERROR_DEL_TEXT",{error:this.fwcErrorPipe.transform(d)})},this.dependencies={restrictionsError:!0};this.loadingData=!1});return}this.fwcFirewallService.checkFwRestrictions(e.id_obj,this.fwcUserService.getActualFwSelectedCloud()).subscribe(d=>{let h=d.data.fwc_confirm_token;this.fwcUserService.setConfirmationToken(h),this.deleteMsgError={type:"warning",title:this.translate.instant("FW.MSG_FW_DELETE.DEL_2"),text:this.translate.instant("FW.MSG_FW_DELETE.DEL_3",{name:e._fwcObjName})},this.dependencies=null,this.loadingData=!1,this.recenterDialog()},d=>{if(d.error){if(d.error.restrictions)try{this.dependencies=d.error.restrictions,this.dependencies._fwcRestrictedObject={_fwcObjId:e.id_obj,_fwcObjType:I.OBJ_FIREWALL},this.deleteMsgError={type:"error",title:this.translate.instant("FW.MSG_FW_DELETE.DEL_0"),text:this.translate.instant("FW.MSG_FW_DELETE.DEL_1",{name:e._fwcObjName})},this.recenterDialog()}catch(h){this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:h})}else this.deleteMsgError={type:"error",title:this.translate.instant("FW.MSG_FW_DELETE.DEL_0"),text:this.translate.instant("FW.MSG_FW_DELETE.ERROR_RES_TEXT",{error:this.fwcErrorPipe.transform(d)})},this.dependencies={restrictionsError:!0};this.loadingData=!1}})}).catch(t=>{this.loadingData=!1,this.deleteMsgError={type:"error",title:this.translate.instant("FW.MSG_FW_DELETE.DEL_0"),text:this.translate.instant("FW.MSG_FW_DELETE.ERROR_RES_TEXT",{error:this.fwcErrorPipe.transform(t)})},this.dependencies={restrictionsError:!0}}))}checkForm(e){e&&e.target&&e.target.type!="textarea"&&this.formModel.valid&&(e.target.blur(),this.onSave())}onSave(e=!1){return le(this,null,function*(){if(!this.firewall)return;if(!e&&this.fwcInterfacesEditor&&!this.fwcInterfacesEditor.isThereAnySelectedNode()){this.confirmationService.confirm({header:this.translate.instant("IF_EDITOR.TREE.MSG_NO_SELECTED.TITLE"),icon:"fa fa-question-circle fwcBlue iconBig",message:this.translate.instant("IF_EDITOR.TREE.MSG_NO_SELECTED.TEXT",{obj_name:this.translate.instant("GLOBALS.MSG_OBJ_TYPES.FIREWALL").toLowerCase()}),accept:()=>{this.onSave(!0)},rejectVisible:!0,rejectLabel:"No",acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.YES")});return}this.loadingData=!0;let t,n,l=Object.assign({},this.firewall),o={};for(let u in this.formModel.controls)o[u]=l[u]=this.formModel.controls[u].value!==null&&this.formModel.controls[u].value!==void 0?this.formModel.controls[u].value:void 0;let a=this.fwcUserService.getActualFwcUser().publicKey;o.install_user&&(o.install_user=yield this.utilService.openPGPEncrypt(o.install_user,a)),o.install_pass&&(o.install_pass=yield this.utilService.openPGPEncrypt(o.install_pass,a)),this.firewall.id===null||this.firewall.id===void 0?(t=this.fwcFirewallService.newFirewall.bind(this.fwcFirewallService),n=this.translate.instant("FW.MSG_FW_CREATE")):(t=this.fwcFirewallService.updateFirewall.bind(this.fwcFirewallService),n=this.translate.instant("FW.MSG_FW_UPDATE",{name:l.name})),o.install_apikey?o.install_apikey=yield this.utilService.openPGPEncrypt(o.install_apikey,a):o.install_apikey=null,delete o.compiler,o.install_communication=="ssh"&&(o.install_apikey=""),o.install_communication=="agent"&&(o.install_user="",o.install_pass=""),this.utilService.fwcAPICall(t,o).then(u=>le(this,null,function*(){let d;u.data&&u.data.insertId?d=u.data.insertId:d=this.firewall.id,o.firewall=d,l.container=Ge.C_FIREWALLS,l._fwcObjId=d,l._fwcObjType=I.OBJ_FIREWALL,l._fwcTreeAction=Ye.NEW_ITEM,this.itemSelectedService.setModifiedItem(l),this.loadingData=!1,this.itemSelectedService.getSelectedTreeNode().pipe(To(1)).subscribe(h=>{let S=()=>{if(l.id!==null&&l.id!==void 0||this.fwcInterfacesEditor&&this.fwcInterfacesEditor.operationsModified()){let v=this.fwcPolicyService.getActualSelectedPolicy();v._fwcFwId!==null&&v._fwcFwId!==void 0&&(v._fwcFwId==l.id&&(v._fwcFwName=l.name,v._dontLocateInTree=!0),this.fwcPolicyService.setSelectedPolicy(v),this.fwcPolicyService.reloadPolicy())}this.loadingData=!1,this.hideDialog(),this.resetProperties(),this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:n})};if(this.fwcInterfacesEditor&&this.fwcInterfacesEditor.areTherePendingOperations()){let v=this.fwcInterfacesEditor.getSelectedTreeNodes();if(u.data&&u.data.loData&&this.fwcInterfacesEditor.setNewLoIds(u.data),Array.isArray(h.items)){let b=h.items.find(T=>T.node_type===q.FOLDER_INTERFACES);if(b){let T={parentObject:{fwcloud:this.fwcUserService.getActualFwSelectedCloud(),name:h._fwcFwName,type:I.OBJ_FIREWALL,id:d,id_node:b.id},objectTreeNodes:v,onClose:N=>le(this,null,function*(){let j,D,Q=!1;if(N.forEach(X=>{X.operationStatus===Vi.SUCCESS&&X.operationResult&&X.object.installFirewallUUIDs&&X.object.installFirewallUUIDs.has(this.firewall.firewallUUID)&&(X.object.type===I.OBJ_INTERFACE_FIREWALL?j=X.operationResult.insertId:X.object.type===I.OBJ_ADDRESS&&(D=X.operationResult.insertId)),X.operationStatus===Vi.ERROR&&(Q=!0)}),!Q&&j&&D){o.install_interface=j,o.install_ipobj=D;try{let X=new An(o).getValue(),re=yield this.utilService.fwcAPICall(this.fwcFirewallService.updateFirewall.bind(this.fwcFirewallService),X)}catch(X){ri.log("ERROR UPDATING: ",X)}}this.itemSelectedService.setModifiedItem(l),S()})},A={uuid:Z.ITEM_BATCH_MANAGER,data:T};this.appDialogPanelsService.searchAndShowDialog(A)}else S()}}else S()})})).catch(u=>{u.status==400&&u.error.fwcErr==8001?(this.confirmationService.confirm({header:this.translate.instant("GLOBALS.MSG_OP_RESULT.ERROR"),icon:"fa fa-exclamation-circle fwcRed iconBig",message:this.translate.instant("API_ERROR."+u.error.fwcErr),rejectVisible:!1,acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.OK"),accept:()=>{}}),this.loadingData=!1):(this.loadingData=!1,this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(u)}))})})}manageInterfacesAndIps(e){let t=this.itemSelectedService.getActualFwcTreeComponents();Array.isArray(t)&&t.forEach(n=>{})}onDeleteFirewall(){this.okToDelete&&this.firewallToDelete&&(this.loadingData=!0,this.deleteMsgError=null,this.delMessage={type:"loading",title:this.translate.instant("FW.MSG_FW_DELETE.DELETING_HEAD"),text:this.translate.instant("FW.MSG_FW_DELETE.DELETING_TEXT")},this.utilService.fwcAPICall(this.fwcFirewallService.deleteFirewall.bind(this.fwcFirewallService),this.firewallToDelete.id_obj,this.fwcUserService.getActualFwSelectedCloud()).then(e=>{let t=this.firewallToDelete,n={_fwcFwId:null,fwId:null},l=this.fwcPolicyService.getActualSelectedPolicy();this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("FW.MSG_FW_DELETE.DEL_4")}),t._fwcTreeAction=Ye.DELETE_ITEM,this.itemSelectedService.setModifiedItem(t),this.itemSelectedService.setModifiedItem({_fwcTreeAction:Ye.RELOAD_TREE,containerToReload:Ge.C_OBJECTS}),l&&l._fwcFwId==this.firewallToDelete.id_obj&&this.fwcPolicyService.setSelectedPolicy(n),this.loadingData=!1,this.hideDialog(),this.resetProperties()}).catch(e=>{this.deleteMsgError={type:"error",title:this.translate.instant("FW.MSG_FW_DELETE.ERROR_RES_HEAD"),text:this.translate.instant("FW.MSG_FW_DELETE.ERROR_RES_TEXT",{error:this.fwcErrorPipe.transform(e)})},this.fwcUserService.setConfirmationToken(void 0),this.loadingData=!1}))}onDiscoverInterfaces(e=!0){Array.isArray(this.interfacesIpObjs)&&(!e&&this.interfacesEditorOptions&&this.fwcInterfacesEditor.operationsModified()?this.confirmationService.confirm({header:this.translate.instant("FW.MSG_FW_EDITION.CONFIRM_DISCOVER_HEADER"),icon:"fa fa-question-circle fwcBlue iconBig",message:this.translate.instant("FW.MSG_FW_EDITION.CONFIRM_DISCOVER_TEXT"),accept:()=>{this.doShowDiscoverDialog()},rejectVisible:!0,rejectLabel:"No",acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.YES")}):this.doShowDiscoverDialog())}onTestFwcAgentCommunication(){return le(this,null,function*(){let e=this.formModel.get("install_ipobj").value;if(e){this.loadingData=!0,this.loadingCommunication=!0;let t=this.formModel.value,n=this.interfacesIpObjs.find(l=>l.id===e);if(n){let l="Error",o="fa fa-exclamation-circle fwcRed iconBig",a=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:this.translate.instant("GLOBALS.ERRORS.COMMUNICATION")}),u=this.fwcUserService.getActualFwcUser().publicKey,d={communication:t.install_communication,host:n.address,port:t.install_port};if(t.install_communication==="ssh"){let h=t.install_user,S=t.install_pass;h&&(h=yield this.utilService.openPGPEncrypt(h,u)),S&&(S=yield this.utilService.openPGPEncrypt(S,u)),d.username=h,d.password=S}else{let h=t.install_apikey;h&&(h=yield this.utilService.openPGPEncrypt(h,u)),d.protocol=t.install_protocol,d.apikey=h}this.communicationSubscription=this.utilService.fwcAPICallObservable(this.fwcFirewallService.checkFwCommunication.bind(this.fwcFirewallService),this.fwcUserService.getActualFwSelectedCloud(),d).subscribe({next:()=>{l=this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),o="fa fa-check-circle fwcGreen iconBig",a=this.translate.instant("FW.MSG_FW_EDITION.PING_AGENT_OK"),this.confirmationService.confirm({header:l,icon:o,acceptLabel:"Ok",rejectVisible:!1,message:a}),this.loadingData=!1,this.loadingCommunication=!1},error:h=>le(this,null,function*(){let S;S=this.utilService.isCommunicationError(h.error),S&&(a=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:S})),this.confirmationService.confirm({header:l,icon:o,acceptLabel:"Ok",rejectVisible:!1,message:a}),this.loadingData=!1,this.loadingCommunication=!1})})}}})}onTestFwcAgentCommunicationDiscoverInterfaces(){return le(this,null,function*(){if(this.discoveredInstallOptions.ipobj){this.loadingData=!0;let e="Error",t="fa fa-exclamation-circle fwcRed iconBig",n=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:this.translate.instant("GLOBALS.ERRORS.COMMUNICATION")}),l=this.fwcUserService.getActualFwcUser().publicKey,o={communication:this.formModel.value.install_communication,host:this.discoveredInstallOptions.ipobj.address,port:this.install_port_agent},a=this.formModel.value.install_apikey;a&&(a=yield this.utilService.openPGPEncrypt(a,l)),o.protocol=this.formModel.value.install_protocol,o.apikey=a,this.utilService.fwcAPICall(this.fwcFirewallService.checkFwCommunication.bind(this.fwcFirewallService),this.fwcUserService.getActualFwSelectedCloud(),o).then(u=>{e=this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),t="fa fa-check-circle fwcGreen iconBig",n=this.translate.instant("FW.MSG_FW_EDITION.PING_AGENT_OK")}).catch(u=>{if(u.error){let d;d=this.utilService.isCommunicationError(u.error),d&&(n=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:d}))}}).finally(()=>{this.confirmationService.confirm({header:e,icon:t,acceptLabel:"Ok",rejectVisible:!1,message:n}),this.loadingData=!1})}})}doShowDiscoverDialog(e){let t=this.formModel.get("install_ipobj").value,n="",l=this.formModel.get("install_communication").value||"ssh";if(t){let a=this.interfacesIpObjs.find(u=>u.id===t);a&&(n=a.address)}else this.discoveredInstallOptions&&(n=this.discoveredInstallOptions.ipobj.address);let o={header:this.firewall.name?this.translate.instant("COMPILE.INST_SSH",{name:this.firewall.name}):this.translate.instant("COMPILE.INST_SSH_GEN"),helpText:this.translate.instant("IF_EDITOR.TREE.INST_SSH_TEXT"),modal:!0,isSSHPanel:!0,formControls:[{name:"install_communication",type:"hidden",value:l},{name:"address",label:this.translate.instant("ITEM_PANEL.FIELDS.ADDRESS"),regexp:Fe.ipV4Regexp,type:"text",required:!0,value:e?e.address:n,setFocus:!0},{name:"",label:"",type:"separator"},{name:"install_port",label:this.translate.instant("CLUSTER.MSG_CLUSTER_EDITION.PORT"),regexp:Fe.portRegexp,type:"number",required:!0,value:e?e.install_port:this.formModel.get("install_port").value},{name:"",label:"",type:"separator"}],onAccept:this.doDiscoverInterfaces.bind(this)};l==="ssh"?o.formControls.push({name:"install_user",label:this.translate.instant("CLUSTER.MSG_CLUSTER_EDITION.SSH_USER"),type:"text",required:!0,value:e?e.install_user:this.formModel.get("install_user").value},{name:"",label:"",type:"separator"},{name:"install_pass",label:this.translate.instant("CLUSTER.MSG_CLUSTER_EDITION.SSH_PASS"),type:"password",required:!0,value:e?e.install_pass:this.formModel.get("install_pass").value}):o.formControls.push({name:"install_protocol",label:this.translate.instant("FW.MSG_FW_EDITION.AGENT_PROTOCOL"),type:"select",required:!0,value:e?e.install_protocol:this.formModel.get("install_protocol").value,options:[{id:"https",text:"HTTPS"},{id:"http",text:"HTTP"}]},{name:"",label:"",type:"separator"},{name:"install_apikey",label:this.translate.instant("FW.MSG_FW_EDITION.AGENT_APIKEY"),type:"password",required:!0,value:e?e.install_apikey:this.formModel.get("install_apikey").value}),this.inputDataService.setInputData(o)}doDiscoverInterfaces(e){return le(this,null,function*(){if(e){let t=this.fwcUserService.getActualFwcUser().publicKey,n={fwcloud:this.fwcUserService.getActualFwSelectedCloud(),ip:e.address,port:+e.install_port,communication:e.install_communication};if(e.install_communication==="ssh"){let l=e.install_user,o=e.install_pass;l&&(l=yield this.utilService.openPGPEncrypt(l,t)),o&&(o=yield this.utilService.openPGPEncrypt(o,t)),n.sshuser=l,n.sshpass=o,this.formModel.get("install_user").value!==e.install_user&&(this.formModel.get("install_user").setValue(e.install_user),this.formModel.markAsDirty())}else{let l=e.install_apikey;l&&(l=yield this.utilService.openPGPEncrypt(l,t)),n.apikey=l,n.protocol=e.install_protocol,this.formModel.get("install_protocol").value!==e.install_protocol&&(this.formModel.get("install_protocol").setValue(e.install_protocol),this.formModel.markAsDirty()),this.formModel.get("install_apikey").value!==e.install_apikey&&(this.formModel.get("install_apikey").setValue(e.install_apikey),this.formModel.markAsDirty())}this.loadingData=!0,this.loadingCommunication=!0,this.communicationSubscription=this.utilService.fwcAPICallObservable(this.fwcFirewallService.autoDiscoverInterfaces.bind(this.fwcFirewallService),n).subscribe({next:l=>{if(Array.isArray(l.data)){let o=l.data,a=this.getInterfaceAndAddressByUUID(this.firewall.installInterfaceUUID,this.firewall.installIpObjUUID);this.interfacesEditorOptions={isCluster:!1,firewalls:[{firewallUUID:this.firewall.firewallUUID,firewall_name:this.firewall.name,firewall:this.firewall.id,cluster:null,installOptions:{firewallUUID:this.firewall.firewallUUID,interface:a.interfaceInfo,ipobj:a.ipObjInfo}}],discoveredFirewallUUID:this.firewall.firewallUUID,discoveredAddress:e.address,discoveredIfs:o,existingIfs:this.interfaces},this.install_port_agent=e.install_port,this.formModel.markAsDirty(),this.shownPanel=1,this.recenterDialog()}this.loadingData=!1,this.loadingCommunication=!1},error:l=>le(this,null,function*(){if(l.error.fwcErr==9e3)this.confirmationService.confirm({header:this.translate.instant("GLOBALS.MSG_OP_RESULT.ERROR"),icon:"fa fa-exclamation-circle fwcRed iconBig",message:this.translate.instant("API_ERROR.SSH_FORBIDDEN"),rejectVisible:!1,acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.OK")});else{let o;l&&(o=this.utilService.isCommunicationError(l.error)),this.confirmationService.confirm({header:"Error",icon:"fa fa-exclamation-circle fwcRed iconBig",acceptLabel:"Ok",rejectVisible:!1,message:this.translate.instant("FW.MSG_FW_EDITION.ERROR_DISCOVER")+(o?":<br/>"+o:""),accept:()=>{if(o)return this.doShowDiscoverDialog(e)}})}this.loadingData=!1,this.loadingCommunication=!1})})}})}showFirewallInfo(){return le(this,null,function*(){this.loadingData=!0,this.loadingCommunication=!0;let e=this.formModel.get("install_ipobj").value;if(e){let t=this.formModel.value,n=this.interfacesIpObjs.find(l=>l.id===e);if(n){let l=this.fwcUserService.getActualFwcUser().publicKey,o={communication:t.install_communication,host:n.address,port:t.install_port};if(t.install_communication!=="ssh"){let a=t.install_apikey;a&&(a=yield this.utilService.openPGPEncrypt(a,l)),o.protocol=t.install_protocol,o.apikey=a}this.communicationSubscription=this.utilService.fwcAPICallObservable(this.fwcFirewallService.getFirewallInformation.bind(this.fwcFirewallService),this.fwcUserService.getActualFwSelectedCloud(),o).subscribe({next:a=>{let u=this.utilService.createDynamicComponentRef(Dn),d=u.instance;d.setDynamicComponentRef(u),d.showFirewallPanel(a.data.data.fwc_agent_version,a.data.data.host_name,a.data.data.system_name,a.data.data.os_version,a.data.data.os_version,a.data.data.kernel_version),this.loadingData=!1,this.loadingCommunication=!1},error:a=>le(this,null,function*(){let u=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:this.translate.instant("GLOBALS.ERRORS.COMMUNICATION")}),d;d=this.utilService.isCommunicationError(a.error),d&&(u=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:d})),this.confirmationService.confirm({header:"Error",icon:"fa fa-exclamation-circle fwcRed iconBig",acceptLabel:"Ok",rejectVisible:!1,message:u}),this.loadingData=!1,this.loadingCommunication=!1})})}}})}getInterfaceAndAddressByUUID(e,t){let n,l;return Array.isArray(this.interfaces)&&this.interfaces.forEach(o=>{o.interfaceUUID&&o.interfaceUUID===e&&(n=o),Array.isArray(o.ipobjs)&&o.ipobjs.forEach(a=>{a.ipObjUUID&&a.ipObjUUID===t&&(l=a)})}),!n&&this.discoveredInstallOptions&&this.discoveredInstallOptions.interface.interfaceUUID===e&&(n=this.discoveredInstallOptions.interface),!l&&this.discoveredInstallOptions&&this.discoveredInstallOptions.ipobj.ipObjUUID===t&&(l=this.discoveredInstallOptions.ipobj),{interfaceInfo:n,ipObjInfo:l}}onChangeInstallData(e){let t=this.formModel.get("install_interface").value,n=this.formModel.get("install_ipobj").value,l=null;t&&Array.isArray(this.interfaces)&&(l=this.interfaces.find(u=>u.id===t),this.firewall.installInterfaceUUID=l?l.interfaceUUID:void 0);let o=null;n&&l&&Array.isArray(l.ipobjs)&&(o=l.ipobjs.find(u=>u.id===n),this.firewall.installIpObjUUID=o?o.ipObjUUID:void 0);let a={firewallUUID:this.firewall.firewallUUID,interface:l,ipobj:o};this.refreshDialog(),this.fwcInterfacesEditor.updateInstallOptions(a)}onEditorInstallModified(e){if(e)if(!e.interface&&!e.ipobj)this.formModel.get("install_interface").setValue(null),this.formModel.get("install_ipobj").setValue(null),this.firewall.installInterfaceUUID=null,this.firewall.installIpObjUUID=null,this.discoveredInstallOptions=null;else{let t=e.interface.id,n=e.ipobj.id;this.formModel.get("install_interface").setValue(t),this.formModel.get("install_ipobj").setValue(n),this.firewall.installInterfaceUUID=e.interface.interfaceUUID,this.firewall.installIpObjUUID=e.ipobj.ipObjUUID,t&&n?this.discoveredInstallOptions=null:this.discoveredInstallOptions={interface:e.interface,ipobj:e.ipobj}}this.formModel.markAsDirty()}onEditorInterfaceOrIpModified(e){if(e&&Object.keys(e).length){if(e.id&&Array.isArray(this.interfaces)){let t=!1;for(let n=0;n<this.interfaces.length&&!t;n++){let l=this.interfaces[n];if(e.id===l.id&&e.type===l.type&&(l.name=e.name,t=!0),Array.isArray(l.ipobjs))for(let o=0;o<l.ipobjs.length&&!t;o++){let a=l.ipobjs[o];e.id===a.id&&e.type===a.type&&(a.name=e.name,a.address=e.address,t=!0)}}}else this.discoveredInstallOptions&&(e.type===I.OBJ_INTERFACE_FIREWALL?this.discoveredInstallOptions.interface&&(this.discoveredInstallOptions.interface.name=e.name):this.discoveredInstallOptions.ipobj&&(this.discoveredInstallOptions.ipobj.name=e.name,this.discoveredInstallOptions.ipobj.address=e.address));this.formModel.markAsDirty()}}handleFirewallManagementChange(e){if(!this.formModel)return;let t;typeof e=="string"?t=e:t=e?.value,t&&(!this.isVyOSCompilerSelected&&t!=="ssh"&&(this.lastCommunicationBeforeVyOS=t),t==="agent"?(this.formModel.get("install_protocol").setValidators([ee.required]),this.formModel.get("install_port").setValue(33033)):(this.formModel.get("install_protocol").clearValidators(),this.formModel.get("install_apikey").clearValidators(),this.formModel.get("install_port").setValue(22)),this.formModel.get("install_protocol").updateValueAndValidity(),this.formModel.get("install_apikey").updateValueAndValidity())}setOptionsPlugins(){this.firewall&&Object.values(it).forEach(e=>{this.optionsPlugins[e]=!!(this.firewall.plugins&tt.get(e))})}onChangePluginsDevelop(){let e=[];for(let n of Object.values(it)){let l=tt.get(n);e[l]=this.optionsPlugins[n]?"1":"0"}this.formModel.controls.plugins.setValue(parseInt(e.reduce((n,l)=>l+n,""),2));let t;Object.values(it).forEach(n=>{(this.formModel.controls.plugins.value&2**tt.get(n))!==(this.firewall.plugins&2**tt.get(n))&&(t=n)}),this.confirmationService.confirm({header:this.translate.instant("FW.PLUGINS.HEADER"),icon:"fa fa-exclamation-circle fwcRed iconBig",acceptLabel:"Ok",rejectVisible:!1,message:this.translate.instant("FW.PLUGINS.NOT_IMPLEMENTED"),reject:()=>{this.setOptionsPlugins()},accept:()=>{this.setOptionsPlugins()}})}onChangePlugins(){let e=[],t="",n;if(this.firewall.id?(n=this.firewall.plugins,!this.firewall.install_communication&&!this.formModel.value.install_communication?t=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:this.translate.instant("API_ERROR.client-tiemeout")}):!this.firewall.install_apikey&&!this.formModel.value.install_apikey?t=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:this.translate.instant("API_ERROR.ApiKeyNotFound")}):!this.firewall.ip&&!this.formModel.value.install_ipobj?t=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:this.translate.instant("API_ERROR.ETIMEDOUT")}):!this.firewall.install_port&&!this.formModel.value.install_ipobj?t=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:this.translate.instant("API_ERROR.ECONNRESET")}):!this.firewall.install_protocol&&!this.formModel.value.install_protocol&&(t=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:this.translate.instant("API_ERROR.EPROTO")}))):(n=this.formModel.controls.plugins.value,this.formModel.value.install_communication?this.formModel.value.install_apikey?this.discoveredInstallOptions?this.formModel.value.install_protocol||(t=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:this.translate.instant("API_ERROR.EPROTO")})):t=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT_IP_PORT"):t=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:this.translate.instant("API_ERROR.ApiKeyNotFound")}):t=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:this.translate.instant("API_ERROR.client-tiemeout")})),t!=""){this.confirmationService.confirm({header:"Error",icon:"fa fa-exclamation-circle fwcRed iconBig",acceptLabel:"Ok",rejectVisible:!1,message:t,reject:()=>{this.setOptionsPlugins()},accept:()=>{this.setOptionsPlugins()}});return}for(let a of Object.values(it)){let u=tt.get(a);e[u]=this.optionsPlugins[a]?"1":"0"}this.formModel.controls.plugins.setValue(parseInt(e.reduce((a,u)=>u+a,""),2));let l,o;Object.values(it).forEach(a=>le(this,null,function*(){if((this.formModel.controls.plugins.value&tt.get(a))!==(this.firewall.plugins&tt.get(a))){a==it.iscbind9?l="isc-bind9":a==it.iscdhcp?l="isc-dhcp":l=a,o=this.optionsPlugins[a];let u;this.formModel.controls.plugins.value&tt.get(a)?u=this.translate.instant("FW.PLUGINS.ENABLE",{plugin:this.translate.instant("FW.PLUGINS."+a.toUpperCase())}):u=this.translate.instant("FW.PLUGINS.DISABLE",{plugin:this.translate.instant("FW.PLUGINS."+a.toUpperCase())}),this.confirmationService.confirm({header:this.translate.instant("FW.PLUGINS.HEADER"),message:u,reject:()=>{this.setOptionsPlugins()},accept:()=>le(this,null,function*(){this.loadingData=!0;let d=this.firewall.install_user,h=this.firewall.install_pass,S=this.firewall.install_apikey;d&&(d.startsWith("-")||(d=yield this.utilService.openPGPEncrypt(d,this.fwcUserService.getActualFwcUser().publicKey))),h&&(h.startsWith("-")||(h=yield this.utilService.openPGPEncrypt(h,this.fwcUserService.getActualFwcUser().publicKey))),S?S.startsWith("-")||(S=yield this.utilService.openPGPEncrypt(S,this.fwcUserService.getActualFwcUser().publicKey)):S=null;let v,b,T,A,N,j;this.discoveredInstallOptions?(N=this.formModel.value.install_communication,b=this.discoveredInstallOptions.ipobj.address,T=this.install_port_agent,A=yield this.utilService.openPGPEncrypt(this.formModel.value.install_apikey,this.fwcUserService.getActualFwcUser().publicKey),v=this.formModel.value.install_protocol,j=!0):this.formModel.value.install_ipobj&&(N=this.formModel.value.install_communication,b=this.interfacesIpObjs.find(ne=>ne.id==this.formModel.value.install_ipobj).address,T=this.formModel.value.install_port,A=yield this.utilService.openPGPEncrypt(this.formModel.value.install_apikey,this.fwcUserService.getActualFwcUser().publicKey),v=this.formModel.value.install_protocol,j=!1);let D=Object.assign({},this.firewall),Q={};for(let ne in this.formModel.controls)Q[ne]=D[ne]=this.formModel.controls[ne].value!==null&&this.formModel.controls[ne].value!==void 0?this.formModel.controls[ne].value:void 0;let X=this.fwcUserService.getActualFwcUser().publicKey;d&&(Q.install_user=d),h&&(Q.install_pass=h),S?Q.install_apikey=S:Q.install_apikey&&(Q.install_apikey.startsWith("-")||(Q.install_apikey=yield this.utilService.openPGPEncrypt(Q.install_apikey,this.fwcUserService.getActualFwcUser().publicKey))),delete Q.compiler,Q.plugins=this.formModel.controls.plugins.value,this.eventsSubscription=this.fwcEventService.getEvent().pipe(oe(()=>this.alive)).subscribe(ne=>{ne.type==Hi.EVENT_PLUGIN_PANEL_CLOSED&&(this.eventsSubscription.unsubscribe(),ne.data?(this.setOptionsPlugins(),this.formModel.controls.plugins.setValue(n)):this.firewall.plugins=this.formModel.controls.plugins.value)});let re={firewall:Q,plugin:l,enable:o,address:b,persisted:j};this.itemSelectedService.setFirewallToPluginOperation(re),this.loadingData=!1}),icon:"fa fa-question-circle fwcBlue iconBig",rejectVisible:!0,rejectLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.NO"),acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.YES")})}}))}checkSSHCommunicationConfig(){return le(this,null,function*(){this.isSSHCommunicationDisabled=!(yield this.utilService.fwcAPICall(this.fwcFirewallService.loadBackEndConfig.bind(this.fwcFirewallService))).data.availablecommunications.includes("ssh")})}checksNtopNGConfig(){return this.interfacesIpObjs.find(e=>e.id==this.formModel.value.install_ipobj)?!!(this.firewall.plugins&tt.get(it.ntopng)):this.discoveredInstallOptions&&Array.from(this.discoveredInstallOptions.interface.installFirewallUUIDs).find(e=>e===this.firewall.firewallUUID)?!!(this.firewall.plugins&tt.get(it.ntopng)):!1}checksWebSafetyProxyActie(){return this.interfacesIpObjs.find(e=>e.id==this.formModel.value.install_ipobj)?!!(this.firewall.plugins&tt.get(it.websafety)):this.discoveredInstallOptions&&Array.from(this.discoveredInstallOptions.interface.installFirewallUUIDs).find(e=>e===this.firewall.firewallUUID)?!!(this.firewall.plugins&tt.get(it.websafety)):!1}checksDNSSafetyActive(){return this.interfacesIpObjs.find(e=>e.id==this.formModel.value.install_ipobj)?!!(this.firewall.plugins&tt.get(it.dnssafety)):this.discoveredInstallOptions&&Array.from(this.discoveredInstallOptions.interface.installFirewallUUIDs).find(e=>e===this.firewall.firewallUUID)?!!(this.firewall.plugins&tt.get(it.dnssafety)):!1}checksElasticSearchActive(){return this.interfacesIpObjs.find(e=>e.id==this.formModel.value.install_ipobj)?!!(this.firewall.plugins&tt.get(it.elasticsearch)):this.discoveredInstallOptions&&Array.from(this.discoveredInstallOptions.interface.installFirewallUUIDs).find(e=>e===this.firewall.firewallUUID)?!!(this.firewall.plugins&tt.get(it.elasticsearch)):!1}onClickButtonNGFW(e){let t,n=this.interfacesIpObjs.length!==0?this.interfacesIpObjs.find(l=>l.id==this.formModel.value.install_ipobj).address:this.discoveredInstallOptions.ipobj.address;switch(e){case"NTOPNG":t="http://"+n+":3000";break;case"WEBSAFETYPROXY":t="https://"+n+":8095";break;case"DNSSAFETY":t="https://"+n+":8096";break;case"ELASTICSEARCH":t="http://"+n+":5601";break}try{window.open(t)}catch(l){this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(l)})}}onShowDialog(e){this.itemSelectedService.getActualItem().ngfw==!0?this.shownPanel=4:this.itemSelectedService.getActualItem().plugins===!0?this.shownPanel=3:this.shownPanel=0,this.recenterDialog();let t=this.itemSelectedService.getActualItem();delete t.ngfw,delete t.plugins,setTimeout(()=>{this.inputFirewallName&&this.inputFirewallName.nativeElement.focus()},150)}onHideDialog(e){}onCloseDialog(){this.communicationSubscription&&(this.communicationSubscription.unsubscribe(),this.communicationSubscription=null,this.loadingData=!1,this.loadingCommunication=!1)}};s.\u0275fac=function(t){return new(t||s)(L(ge),L(He),L(fe),L($e),L(Le),L(Ot),L(ye),L(pi),L(be),L(kt),L(Ee),L(ue),L(me),L(xt),L(we),L(Se),L(Ut))},s.\u0275cmp=je({type:s,selectors:[["sts-fwc-firewall-panel"]],viewQuery:function(t,n){if(t&1&&(_e(Mc,5),_e(Dc,5)),t&2){let l;se(l=ce())&&(n.inputFirewallName=l.first),se(l=ce())&&(n.fwcInterfacesEditor=l.first)}},standalone:!1,features:[Ve([fe,$e]),ct],decls:8,vars:5,consts:[["firewallDialog",""],["header",""],["footer",""],["inputFirewallName",""],["ddCompiler",""],["divPass",""],["ddInstallInterface",""],["fwcInterfacesEditor",""],["styleClass","dlgFwcDialog dlgFwcDialog--firewall",3,"visibleChange","onShow","onHide","visible","modal","closable"],[1,"fwcFirewallPanel",3,"formGroup"],[1,"divFormHeader"],[1,"divHeaderButtons"],["type","button","icon","fa fa-question",3,"disabled"],["type","button","styleClass","p-button-secondary","icon","fa fa-window-minimize",3,"onClick","disabled"],[1,"fwcWhite","fwcIconLeft"],[1,"fwcMenuIcon","fwci-firewall","fwcOrange"],[1,"fwcMenuIcon","fwci-delete","fwcOrange"],["type","button","icon","fa fa-question",3,"onClick","disabled"],[1,"fwcFirewallPanel",3,"keyup.enter","keyup.esc","formGroup"],[3,"disabled"],[1,"first-tabview","tabTabbedMenu","flex","flex-col","w-full","bg-(--surfaceBackgroundColor)"],[1,"flex","flex-wrap","fwc-tabbar"],["type","button",1,"fwc-tab-button",3,"click","disabled"],[1,"fwcMenuIcon","fwci-editfirewall","fwcOrange"],[1,"fwcMenuIcon","fwci-interfaces","fwcOrange"],[1,"fwcMenuIcon","fwci-config","fwcOrange"],[1,"fa","fa-puzzle-piece","fwcOrange"],[1,"fa","fa-n","fwcOrange"],[1,"fwc-firewall-panel-section"],[4,"ngIf"],[1,"grid"],[1,"col-12","noVertPad"],[1,"noVertPad","fwcBlue","botBorder"],[1,"col-6"],[1,"p-inputgroup"],["for","name"],["type","text","maxlength","64","pInputText","","formControlName","name","name","name",3,"placeholder"],[1,"fwc-error",3,"ngStyle"],[1,"col-3"],[1,"p-inputgroup","compiler-dropdown-group"],["for","compiler"],["formControlName","compiler","name","compiler","optionLabel","name","optionValue","id","appendTo","body","styleClass","dropDownForm",3,"onChange","options"],["pTemplate","selectedItem"],["pTemplate","item"],["for","install_communication"],["formControlName","install_communication","name","install_communication","optionLabel","label","optionValue","value","appendTo","body","styleClass","dropDownForm",3,"onChange","options","placeholder"],[1,"col-12"],[1,"p-inputgroup","justify-between"],["for","comment"],["maxlength","255","pInputText","","formControlName","comment","name","comment",1,"fwc-comment-input",3,"rows","cols"],[1,"noVertPad","fwcBlue"],[1,"col-12","md:col-3","justify-between"],["type","button","styleClass","fwc-btn-tall","icon","fa fa-search-plus",3,"onClick","disabled","label"],[1,"fwcBlue"],["class","compiler-dropdown__value",4,"ngIf"],[1,"compiler-dropdown__value"],["class","compiler-dropdown__icon","aria-hidden","true",3,"ngClass",4,"ngIf"],[1,"compiler-dropdown__label"],["aria-hidden","true",1,"compiler-dropdown__icon",3,"ngClass"],[1,"compiler-dropdown__item"],[1,"col-4"],["for","install_protocol"],["formControlName","install_protocol","name","install_protocol","optionLabel","label","optionValue","value","appendTo","body",1,"dropDownForm",3,"onChange","options"],[1,"col-5"],["for","install_apikey"],["pPassword","","formControlName","install_apikey","name","install_apikey","maxlength","64",3,"showPassword","placeholder","feedback"],["type","button","icon","fa fa-eye","styleClass","p-button-secondary fwcButtonHeight",3,"mousedown","mouseup","mouseout"],["for","install_user"],["type","text","pInputText","","maxlength","32","formControlName","install_user","name","install_user",3,"placeholder"],[1,"fwc-error"],["for","install_pass"],["pPassword","","formControlName","install_pass","name","install_pass","maxlength","64",3,"showPassword","placeholder","promptLabel","weakLabel","mediumLabel","strongLabel"],[1,"fa","fa-lg","fa-info-circle","fwcBlue",3,"pTooltip"],["type","text","pInputText","","readonly","",3,"value"],[1,"col-2"],["for","install_port"],["type","text","pInputText","","readonly","",3,"placeholder","value"],[1,"flex","w-full","items-center","gap-2"],["type","button","styleClass","flex-1 fwc-btn-tall","tooltipPosition","top","showDelay","500","icon","fa fa-plug",3,"onClick","disabled","pTooltip","label"],["type","button","styleClass","flex-1 fwc-btn-tall","tooltipPosition","top","showDelay","500","icon","fa fa-info-circle",3,"onClick","disabled","pTooltip","label"],["for","install_interface"],["formControlName","install_interface","name","install_interface","optionLabel","name","optionValue","id","appendTo","body","styleClass","dropDownForm",3,"onChange","options","autoDisplayFirst","placeholder"],["for","install_ipobj"],["formControlName","install_ipobj","name","install_ipobj","optionLabel","name","optionValue","id","appendTo","body","styleClass","dropDownForm",3,"onChange","options","autoDisplayFirst","placeholder"],["type","number","pInputText","","min","1","placeholder","Port","formControlName","install_port","name","install_port"],[1,"responsive-button-container"],[1,"responsive-button"],["type","button","tooltipPosition","top","showDelay","500","icon","fa fa-plug",3,"onClick","disabled","pTooltip","label"],["type","button","tooltipPosition","top","showDelay","500","icon","fa fa-info-circle","id","btnMoreInfo",3,"onClick","disabled","pTooltip","label"],[3,"onInstallModified","onIpObjectModified","onStartAutodiscover","options"],["type","hidden","formControlName","options","name","options"],[1,"col-12","md:col-4"],[3,"ngModelChange","onChange","binary","ngModel","ngModelOptions"],["href","https://www.docker.com","target","_blank"],["width","20","height","20",1,"icon"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-docker"],["target","_blank",1,"fwc-inline-info-link",3,"href"],["href","https://crowdsec.net/","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-crowdsec"],["href","https://www.fail2ban.org","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-fail2ban"],["type","hidden","formControlName","plugins","name","plugins"],[3,"message"],["href","https://www.openvpn.net/","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-openvpn"],["href","https://www.wireguard.com/","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-wireguard"],["href","","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-ipsec"],["href","https://github.com/acassen/keepalived","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-keepalived"],["href","https://ipgeolocation.io/","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-geoip"],["href","https://www.ntop.org/","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-ntopng"],["href","https://www.diladele.com/","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-websafety"],["href","https://dnssafety.diladele.com/","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-dnssafety"],["href","https://suricata.io/","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-suricata"],["href","https://zeek.org/","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-zeek"],["href","https://www.elastic.co/what-is/elasticsearch","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-elasticsearch"],["href","https://www.elastic.co/what-is/kibana","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-kibana"],["href","https://www.elastic.co/logstash/","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-logstash"],["href","https://www.elastic.co/beats/filebeat","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-filebeat"],["href","https://www.isc.org/dhcp/","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-isc-dhcp"],["href","https://www.haproxy.org/","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-ha-proxy"],["href","https://www.isc.org/bind/","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-isc-bind9"],["href","https://irqbalance.github.io/irqbalance/","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-irqbalance"],[1,"grid","grid-nogutter","ngfw-tools-grid"],[1,"flex","flex-col"],["for","NTOPNG_BUTTON",1,"flex","items-center","gap-2","mb-2"],["type","button","styleClass","w-full ","tooltipPosition","top","showDelay","500",3,"onClick","disabled","pTooltip","label"],["for","WEBSAFETYPROXY_BUTTON",1,"flex","items-center","gap-2","mb-2"],["for","DNSSAFETY_BUTTON",1,"flex","items-center","gap-2","mb-2"],["for","ELASTICSEARCH_BUTTON",1,"flex","items-center","gap-2","mb-2"],[1,"col-12","divCentered"],[1,"fwcRestrictionsContainer"],[3,"onHideParent","onRefreshRestrictions","dependencies"],[1,"col-12","divCentered",2,"padding","0"],[1,"flex","items-center","justify-center","gap-2","overflow-auto","text-center","font-['Montserrat',Arial,sans-serif]","max-w-[80vw]"],["name","chkOkToDelete","binary","true",3,"ngModelChange","ngModel"],[1,"text-[0.9rem]","text-(--fwcMidDark)"],[1,"divLoadTemp",3,"ngStyle"],["type","button","styleClass","p-button-danger","icon","fa fa-xmark",3,"label"],["type","button","styleClass","p-button-danger","icon","pi pi-trash",3,"disabled","label"],["type","button","styleClass","p-button-success","icon","fa fa-save",3,"disabled","label"],["type","button","icon","pi pi-check",3,"disabled","label"],["styleClass","fwc-spinner-sm"],["type","button","styleClass","p-button-danger","icon","fa fa-xmark",3,"onClick","label"],["type","button","styleClass","p-button-danger","icon","pi pi-trash",3,"onClick","disabled","label"],["type","button","styleClass","p-button-success","icon","fa fa-save",3,"onClick","disabled","label"],["type","button","icon","pi pi-check",3,"onClick","disabled","label"],["type","button","styleClass","fwc-left-float","icon","fa fa-refresh",3,"disabled","label"],["type","button","styleClass","p-button-danger","icon","fa fa-trash",3,"onClick","disabled","label"],["type","button","styleClass","fwc-left-float","icon","fa fa-refresh",3,"onClick","disabled","label"]],template:function(t,n){if(t&1){let l=M();p(0,"p-dialog",8,0),H("visibleChange",function(a){return w(l),W(n.displayDialog,a)||(n.displayDialog=a),g(a)}),P("onShow",function(a){return w(l),g(n.onShowDialog(a))})("onHide",function(a){return w(l),g(n.onHideDialog(a))}),J(2,Xc,5,4,"ng-template",null,1,pe),x(4,vp,35,37,"form",9),x(5,xp,3,2),J(6,Up,2,2,"ng-template",null,2,pe),f()}t&2&&(V("visible",n.displayDialog),m("modal",!0)("closable",!1),c(4),R(n.firewall?4:-1),c(),R(n.firewallToDelete?5:-1))},dependencies:[pt,Gt,Mi,Gi,ai,si,bt,Ni,ci,Bi,Pt,Ui,ki,Yi,Fn,Yt,Ht,jt,Wt,mi,Ze,fi,Pn,hi,Rt,dt],styles:[`p-tabs li a{height:100%;color:var(--fwcDark)!important}p-tabs li.p-highlight .p-tabs-nav-link{color:#dedede!important}.p-tabs-nav-content{font-size:.9rem!important}sts-fwc-firewall-panel>p-dialog>div>div>div.ng-tns-c1623988549-19.p-dialog-content.ng-star-inserted{min-width:100%!important}.responsive-button-container{display:flex;flex-direction:row;width:100%;height:100%;gap:.2rem}.responsive-button{display:flex;flex:1 1 50%;min-width:0;align-self:flex-end}.responsive-button-container>*:last-child{justify-content:flex-end}.responsive-button button{min-height:2.44rem!important;font-size:14.4px;line-height:normal}.responsive-button .fa{flex:0 0 auto;margin:0 .25rem;font-size:14.4px!important}button.fwc-btn-tall{justify-content:space-between;min-height:100%;min-width:100%;font-size:14.4px;line-height:normal}button.fwc-btn-tall .p-button-label{display:flex;flex:1 1 auto;justify-content:center;align-items:center;text-align:center;white-space:normal}.fwc-comment-input{width:calc(100% - 15rem)}.fwc-inline-info-link{display:inline-block;margin-left:.5rem;margin-top:.125rem}.fwc-spinner-sm{width:1.7rem;height:1.7rem}.fwc-firewall-panel-section{display:flex;flex-direction:column;flex:1 1 0%;padding:1rem 1rem .571rem!important;overflow:hidden;box-sizing:border-box;border:1px solid var(--fwcGrey2);border-bottom-right-radius:3px;border-bottom-left-radius:3px;background:var(--surfaceBackgroundColor)}.fwc-firewall-panel-section *{max-width:100%!important;box-sizing:border-box;flex-shrink:1;overflow-wrap:break-word}sts-fwc-firewall-panel .fwc-tabbar{gap:.2rem;background:transparent}.dlgFwcDialog .fwcFirewallPanel .p-inputgroup{align-items:center;width:100%}.dlgFwcDialog .ngfw-tools-grid{display:flex;flex-wrap:nowrap;width:calc(100% - 14rem)!important}.dlgFwcDialog .ngfw-tools-grid .col-3{flex:1 1 calc((100% - 1.5rem)/4)}.compiler-dropdown__value,.compiler-dropdown__item{display:flex;align-items:center}.compiler-dropdown__icon{display:inline-flex;align-items:center;justify-content:center;width:1.5rem;height:1.5rem;line-height:1;flex-shrink:0}.compiler-dropdown__value .compiler-dropdown__icon{margin-right:.25rem}.compiler-dropdown__item .compiler-dropdown__icon{margin-right:.65rem}.compiler-dropdown-panel .p-dropdown-item{display:flex;align-items:center}.compiler-dropdown-panel .compiler-dropdown__item{width:100%}
`],encapsulation:2});let r=s;return r})();var Vp=["inputClusterName"],Wp=["fwcInterfacesEditor"],Hp=["nodeInput"],Cr=r=>({visibility:r}),Jp=r=>({"background-color":r}),Yp=()=>["col-12","lg:col-2"],Kp=()=>["col-12","lg:col-3"],Xp=()=>["col-4","lg:col-2"],Co=()=>["col-4","lg:col-3"],zp=()=>({label:"HTTPS",value:"https"}),qp=()=>({label:"HTTP",value:"http"}),Qp=(r,s)=>[r,s],gr=()=>["col-6","lg:col-2"],Ie=()=>({standalone:!0}),yr=(r,s)=>({type:"error",title:r,text:s});function $p(r,s){if(r&1&&(p(0,"div",9)(1,"h6",13),O(2,"i",14),C(3),y(4,"translate"),p(5,"strong"),C(6),f()()()),r&2){let i=_(3);c(3),F(" ",E(4,2,"CLUSTER.MSG_CLUSTER_EDITION.EDIT")," "),c(3),U(i.cluster==null?null:i.cluster.name)}}function Zp(r,s){r&1&&(p(0,"div",9)(1,"h6",13),O(2,"i",14),C(3),y(4,"translate"),f()()),r&2&&(c(3),F(" ",E(4,1,"CLUSTER.MSG_CLUSTER_EDITION.NEW")," "))}function ed(r,s){if(r&1&&x(0,$p,7,4,"div",9)(1,Zp,5,3,"div",9),r&2){let i=_(2);R(i.cluster!=null&&i.cluster.id?0:1)}}function td(r,s){if(r&1&&(p(0,"div",9)(1,"h6",13),O(2,"i",15),C(3),y(4,"translate"),p(5,"strong"),C(6),f()()()),r&2){let i=_(2);c(3),F(" ",E(4,2,"CLUSTER.MSG_CLUSTER_EDITION.DELETE")," "),c(3),U(i.clusterToDelete._fwcObjName)}}function id(r,s){if(r&1){let i=M();p(0,"p-button",16),P("onClick",function(){w(i);let t=_(2);return g(t.showHelp())}),f()}if(r&2){let i=_(2);m("disabled",i.loadingData)}}function nd(r,s){if(r&1){let i=M();x(0,ed,2,1),x(1,td,7,4,"div",9),p(2,"div",10),x(3,id,1,1,"p-button",11),p(4,"p-button",12),P("onClick",function(){w(i);let t=_();return g(t.minimizeDialog())}),f()()}if(r&2){let i=_();R(i.cluster?0:-1),c(),R(i.clusterToDelete?1:-1),c(2),R(i.helpSection?3:-1),c(),m("disabled",i.loadingData)}}function od(r,s){if(r&1&&O(0,"span",50),r&2){let i=_(2).$implicit;m("ngClass",i.iconClass)}}function ld(r,s){if(r&1&&(p(0,"div",47),J(1,od,1,1,"span",48),p(2,"span",49),C(3),f()()),r&2){let i=_().$implicit;c(),m("ngIf",i.iconClass),c(2),U(i.name)}}function rd(r,s){if(r&1&&J(0,ld,4,2,"div",46),r&2){let i=s.$implicit;m("ngIf",i)}}function ad(r,s){if(r&1&&O(0,"span",50),r&2){let i=_().$implicit;m("ngClass",i.iconClass)}}function sd(r,s){if(r&1&&(p(0,"div",51),J(1,ad,1,1,"span",48),p(2,"span",49),C(3),f()()),r&2){let i=s.$implicit;c(),m("ngIf",i.iconClass),c(2),U(i.name)}}function cd(r,s){r&1&&(p(0,"p",56),C(1),y(2,"translate"),f()),r&2&&(c(),F(" ",E(2,1,"ITEM_PANEL.ERRORS.FIELD_INVALID_NAME")," "))}function pd(r,s){if(r&1){let i=M();p(0,"div",63)(1,"div",53)(2,"p-select",64),y(3,"translate"),P("onChange",function(){return w(i),g(!0)}),f()()(),p(4,"div",65)(5,"div",53),O(6,"input",66),y(7,"translate"),p(8,"p-button",67),P("mousedown",function(){w(i);let t=_().$index,n=_(3);return g(n.displayApiKey[t]=!0)})("mouseup",function(){w(i);let t=_().$index,n=_(3);return g(n.displayApiKey[t]=!1)})("mouseout",function(){w(i);let t=_().$index,n=_(3);return g(n.displayApiKey[t]=!1)}),f()()()}if(r&2){let i=_().$index,e=_(3);c(2),m("options",Qe(12,Qp,Y(10,zp),Y(11,qp)))("placeholder",E(3,6,"FW.MSG_FW_EDITION.AGENT_PROTOCOL")),c(4),m("placeholder",B(E(7,8,"FW.MSG_FW_EDITION.AGENT_APIKEY")))("showPassword",e.displayApiKey[i])("feedback",!1)}}function dd(r,s){r&1&&(p(0,"p",56),C(1),y(2,"translate"),f()),r&2&&(c(),F(" ",E(2,1,"ITEM_PANEL.ERRORS.FIELD_USERNAME")," "))}function _d(r,s){if(r&1){let i=M();p(0,"div",68),O(1,"input",69),y(2,"translate"),x(3,dd,3,3,"p",56),f(),p(4,"div",52)(5,"div",53),O(6,"input",70),y(7,"translate"),y(8,"translate"),y(9,"translate"),y(10,"translate"),y(11,"translate"),p(12,"p-button",67),P("mousedown",function(){w(i);let t=_().$index,n=_(3);return g(n.displaySSH[t]=!0)})("mouseup",function(){w(i);let t=_().$index,n=_(3);return g(n.displaySSH[t]=!1)})("mouseout",function(){w(i);let t=_().$index,n=_(3);return g(n.displaySSH[t]=!1)}),f()()()}if(r&2){let i=_(),e=i.$implicit,t=i.$index,n=_(3);m("ngClass",n.interfaces!=null&&n.interfaces.length||n.discoveredInstallOptions.has(e.get("firewallUUID").value)?Y(26,gr):Y(27,Co)),c(),m("id",nt("fwSSHUser",t))("placeholder",B(E(2,14,"CLUSTER.MSG_CLUSTER_EDITION.SSH_USER"))),c(2),R(!e.get("install_user").valid&&!e.get("install_user").pristine?3:-1),c(),m("ngClass",n.interfaces!=null&&n.interfaces.length||n.discoveredInstallOptions.has(e.get("firewallUUID").value)?Y(28,gr):Y(29,Co)),c(2),m("placeholder",B(E(7,16,"CLUSTER.MSG_CLUSTER_EDITION.SSH_PASS")))("showPassword",n.displaySSH[t])("promptLabel",E(8,18,"GLOBALS.MSG_PASSWORD.PASS"))("weakLabel",E(9,20,"GLOBALS.MSG_PASSWORD.WEAK"))("mediumLabel",E(10,22,"GLOBALS.MSG_PASSWORD.NORMAL"))("strongLabel",E(11,24,"GLOBALS.MSG_PASSWORD.SAFE"))}}function ud(r,s){if(r&1&&(p(0,"div",71)(1,"div",53)(2,"label"),O(3,"i",72),y(4,"translate"),f(),O(5,"input",73),f()(),p(6,"div",71)(7,"div",53),O(8,"input",73),f()()),r&2){let i,e,t=_().$implicit,n=_(3);c(3),m("pTooltip",B(E(4,6,"FW.MSG_FW_EDITION.TOOLTIP_NEW_INSTALL"))),c(2),m("value",B((i=n.discoveredInstallOptions.get(t.get("firewallUUID").value).interface)==null?null:i.name)),c(3),m("value",B(((e=n.discoveredInstallOptions.get(t.get("firewallUUID").value).ipobj)==null?null:e.address)+" ("+((e=n.discoveredInstallOptions.get(t.get("firewallUUID").value).ipobj)==null?null:e.name)+")"))}}function fd(r,s){if(r&1&&(p(0,"span"),C(1),f()),r&2){let i=s.$implicit;c(),U(i!=null&&i.name?i.id+" - "+i.name:"")}}function md(r,s){if(r&1&&(p(0,"span"),C(1),f()),r&2){let i=s.$implicit;c(),Li("",i.id," - ",i.name)}}function hd(r,s){if(r&1){let i=M();p(0,"div",74)(1,"p-select",75),y(2,"translate"),P("onChange",function(t){w(i);let n=_(2).$index,l=_(3);return g(l.onInterfaceChange(n,t.value))}),J(3,fd,2,1,"ng-template",38)(4,md,2,2,"ng-template",39),f()()}if(r&2){let i=_(5);c(),m("options",i.interfaces)("autoDisplayFirst",!1)("placeholder",E(2,3,"GLOBALS.MSG_OBJ_TYPES.OBJ_INTERFACE_FIREWALL"))}}function wd(r,s){if(r&1&&(p(0,"span"),C(1),f()),r&2){let i=_().$implicit;c(),F("\xA0(",i.address,")")}}function gd(r,s){r&1&&(p(0,"span"),C(1),y(2,"translate"),f()),r&2&&(c(),F(" \xA0(",E(2,1,"CLUSTER.MSG_CLUSTER_EDITION.NO_IP"),") "))}function Sd(r,s){if(r&1&&(p(0,"span"),C(1),f(),x(2,wd,2,1,"span"),x(3,gd,3,3,"span")),r&2){let i=s.$implicit;c(),U(i.name),c(),R(i.address?2:-1),c(),R(i.address?-1:3)}}function Cd(r,s){if(r&1){let i=M();p(0,"div",74)(1,"p-select",76),y(2,"translate"),P("onChange",function(){w(i);let t=_(2).$index,n=_(3);return g(n.onChangeInstallData(t))}),J(3,Sd,4,3,"ng-template",39),f()()}if(r&2){let i=_(2),e=i.$implicit,t=i.$index,n=_(3);c(),m("name",nt("fwIP",t))("options",n.interfacesIpObjs.get(e.get("firewallUUID").value))("autoDisplayFirst",!1)("placeholder",E(2,5,"GLOBALS.MSG_OBJ_TYPES.OBJ_ADDRESS"))}}function yd(r,s){if(r&1&&(x(0,hd,5,5,"div",74),x(1,Cd,4,7,"div",74)),r&2){let i=_(4);R(i.interfaces.length?0:-1),c(),R(i.interfaces.length?1:-1)}}function Ed(r,s){r&1&&(O(0,"input",57),y(1,"translate")),r&2&&m("placeholder",B(E(1,2,"CLUSTER.MSG_CLUSTER_EDITION.PORT")))}function vd(r,s){if(r&1){let i=M();p(0,"p-button",77),y(1,"translate"),P("onClick",function(){w(i);let t=_().$implicit,n=_(3);return g(n.onTestFwcAgentCommunication(t))}),f()}if(r&2){let i=_().$implicit,e=_(3);m("pTooltip",B(E(1,3,"FW.MSG_FW_EDITION.AGENT_TEST_LONG")))("disabled",e.loadingData||i.get("install_protocol").invalid||i.get("install_apikey").invalid||i.get("install_port").invalid||!e.NodeHaveDiscoveredIp(i))}}function Id(r,s){if(r&1){let i=M();p(0,"p-button",78),y(1,"translate"),P("onClick",function(){w(i);let t=_().$implicit,n=_(3);return g(n.showClusterInfo(t))}),f()}if(r&2){let i=_().$implicit,e=_(3);m("pTooltip",B(E(1,3,"FW.FW_MORE_INFO.AGENT_TOOLTIP")))("disabled",e.loadingData||i.get("install_protocol").invalid||i.get("install_apikey").invalid||i.get("install_port").invalid||!e.NodeHaveDiscoveredIp(i))}}function bd(r,s){if(r&1){let i=M();p(0,"p-button",79),y(1,"translate"),P("onClick",function(){w(i);let t=_().$index,n=_(3);return g(n.nodeRemove(t))}),f()}if(r&2){let i=_(4);m("pTooltip",B(E(1,3,"CLUSTER.MSG_CLUSTER_EDITION.TT_NODE_DELETE")))("disabled",i.loadingData)}}function Pd(r,s){if(r&1){let i=M();p(0,"p-button",80),y(1,"translate"),P("onClick",function(){w(i);let t=_().$index,n=_(3);return g(n.nodeAdd(t))}),f()}if(r&2){let i=_(4);m("pTooltip",B(E(1,3,"CLUSTER.MSG_CLUSTER_EDITION.TT_NODE_ADD")))("disabled",i.loadingData)}}function Td(r,s){if(r&1){let i=M();p(0,"div",45)(1,"div",52)(2,"div",53)(3,"p-button",54),y(4,"translate"),y(5,"translate"),P("onClick",function(){let t=w(i).$implicit,n=_(3);return g(n.onClusterNodeInstallCommChange(t))}),f(),p(6,"input",55,5),y(8,"translate"),P("change",function(){let t=w(i).$implicit,n=_(3);return g(n.onClusterNodeNameChange(t))}),f()(),x(9,cd,3,3,"p",56),f(),x(10,pd,9,15)(11,_d,13,30),x(12,ud,9,8)(13,yd,2,2),p(14,"div",52)(15,"div",53),x(16,Ed,2,4,"input",57),x(17,vd,2,5,"p-button",58),x(18,Id,2,5,"p-button",59),x(19,bd,2,5,"p-button",60),x(20,Pd,2,5,"p-button",61),p(21,"p-button",62),y(22,"translate"),P("onClick",function(){let t=w(i).$index,n=_(3);return g(n.nodeAutoDiscoverInterfaces(t))}),f()()()()}if(r&2){let i,e,t,n=s.$implicit,l=s.$index,o=_(3);m("ngStyle",Re(30,Jp,l?"":"aliceblue"))("formGroupName",l),c(),m("ngClass",o.interfaces!=null&&o.interfaces.length||o.discoveredInstallOptions.has(n.get("firewallUUID").value)?Y(32,Yp):Y(33,Kp)),c(2),m("icon",n.get("install_communication").value==="agent"?"fa fa-user-secret":"fa fa-terminal")("disabled",o.loadingData)("pTooltip",n.get("install_communication").value==="agent"?E(4,22,"CLUSTER.MSG_CLUSTER_EDITION.COMM_FWCAGENT"):E(5,24,"CLUSTER.MSG_CLUSTER_EDITION.COMM_SSH")),c(3),m("id",nt("fwName",l))("placeholder",B(E(8,26,"CLUSTER.MSG_CLUSTER_EDITION.NODE_NAME"))),c(3),R(!n.get("name").valid&&!n.get("name").pristine?9:-1),c(),R(n.get("install_communication").value==="agent"?10:11),c(2),R(o.discoveredInstallOptions.has(n.get("firewallUUID").value)?12:13),c(2),m("ngClass",o.interfaces!=null&&o.interfaces.length||o.discoveredInstallOptions.has(n.get("firewallUUID").value)?Y(34,Xp):Y(35,Co)),c(2),R(o.interfaces.length||n.get("install_port")?16:-1),c(),R(((i=n.get("install_communication"))==null?null:i.value)==="agent"?17:-1),c(),R(((e=n.get("install_communication"))==null?null:e.value)==="agent"?18:-1),c(),R((t=n.get("id"))!=null&&t.value&&o.getNumberOfExistingNodes()>1||!((t=n.get("id"))!=null&&t.value)&&o.getFormNodes().controls.length>1?19:-1),c(),R(l+1==o.getFormNodes().controls.length?20:-1),c(),m("pTooltip",B(E(22,28,"CLUSTER.MSG_CLUSTER_EDITION.TT_NODE_DISCOVER")))("disabled",o.loadingData)}}function Od(r,s){if(r&1){let i=M();Pe(0),p(1,"div",28)(2,"div",29)(3,"h5",30),C(4),y(5,"translate"),f()(),p(6,"div",31)(7,"div",32)(8,"label",33),C(9),y(10,"translate"),f(),O(11,"input",34,3),y(13,"translate"),f(),p(14,"p",35),C(15),y(16,"translate"),f()(),p(17,"div",31)(18,"div",32)(19,"label",36),C(20),y(21,"translate"),f(),p(22,"p-select",37,4),P("onChange",function(){w(i);let t=_(2);return g(t.changeCompilerOptions())}),J(24,rd,1,1,"ng-template",38)(25,sd,4,2,"ng-template",39),f()()(),p(26,"div",29)(27,"div",40)(28,"label",41),C(29),y(30,"translate"),f(),O(31,"textarea",42),f()()(),p(32,"div",43)(33,"div",29)(34,"h5",44),C(35),y(36,"translate"),f()(),Et(37,Td,23,36,"div",45,yt),f(),Te()}if(r&2){let i=_(2);c(4),F(" ",E(5,12,"CLUSTER.MSG_CLUSTER_EDITION.BASIC")," "),c(5),U(E(10,14,"CLUSTER.MSG_CLUSTER_EDITION.NAME")),c(2),m("placeholder",B(E(13,16,"CLUSTER.MSG_CLUSTER_EDITION.NAME"))),c(3),m("ngStyle",Re(26,Cr,i.formModel.get("name").valid||i.formModel.get("name").pristine?"hidden":"visible")),c(),F(" ",E(16,18,"ITEM_PANEL.ERRORS.FIELD_INVALID_NAME")," "),c(5),U(E(21,20,"FW.MSG_FW_EDITION.COMPILER")),c(2),m("options",i.FirewallCompilerOptions),c(7),U(E(30,22,"CLUSTER.MSG_CLUSTER_EDITION.DESC")),c(2),m("rows",3)("cols",30),c(4),F(" ",E(36,24,"CLUSTER.MSG_CLUSTER_EDITION.NODES")," "),c(2),vt(i.getFormNodes().controls)}}function xd(r,s){if(r&1){let i=M();Pe(0),p(1,"sts-fwc-interfaces-tree-editor",81,6),P("onInstallModified",function(t){w(i);let n=_(2);return g(n.onEditorInstallModified(t))})("onIpObjectModified",function(t){w(i);let n=_(2);return g(n.onEditorInterfaceOrIpModified(t))})("onStartAutodiscover",function(){w(i);let t=_(2);return g(t.onDiscoverInterfaces(!0))}),f(),Te()}if(r&2){let i=_(2);c(),m("options",i.interfacesEditorOptions)}}function Rd(r,s){if(r&1){let i=M();Pe(0),O(1,"input",82),p(2,"div",28)(3,"div",83)(4,"h5",30),C(5),y(6,"translate"),f()(),p(7,"div",84)(8,"div",29)(9,"div",32)(10,"p-checkbox",85),H("ngModelChange",function(t){w(i);let n=_(2);return W(n.optionsFlags.stateful,t)||(n.optionsFlags.stateful=t),g(t)}),P("onChange",function(){w(i);let t=_(2);return g(t.onChangeOptionsFlags())}),f(),p(11,"span",44),C(12),y(13,"translate"),f()()(),p(14,"div",29)(15,"div",32)(16,"p-checkbox",85),H("ngModelChange",function(t){w(i);let n=_(2);return W(n.optionsFlags.ipv4,t)||(n.optionsFlags.ipv4=t),g(t)}),P("onChange",function(){w(i);let t=_(2);return g(t.onChangeOptionsFlags())}),f(),p(17,"span",44),C(18),y(19,"translate"),f()()(),p(20,"div",29)(21,"div",32)(22,"p-checkbox",85),H("ngModelChange",function(t){w(i);let n=_(2);return W(n.optionsFlags.ipv6,t)||(n.optionsFlags.ipv6=t),g(t)}),P("onChange",function(){w(i);let t=_(2);return g(t.onChangeOptionsFlags())}),f(),p(23,"span",44),C(24),y(25,"translate"),f()()(),p(26,"div",29)(27,"div",32)(28,"p-checkbox",85),H("ngModelChange",function(t){w(i);let n=_(2);return W(n.optionsFlags.debug,t)||(n.optionsFlags.debug=t),g(t)}),P("onChange",function(){w(i);let t=_(2);return g(t.onChangeOptionsFlags())}),f(),p(29,"span",44),C(30),y(31,"translate"),f()()(),p(32,"div",29)(33,"div",32)(34,"p-checkbox",85),H("ngModelChange",function(t){w(i);let n=_(2);return W(n.optionsFlags.report,t)||(n.optionsFlags.report=t),g(t)}),P("onChange",function(){w(i);let t=_(2);return g(t.onChangeOptionsFlags())}),f(),p(35,"span",44),C(36),y(37,"translate"),f()()()(),p(38,"div",84)(39,"div",29)(40,"div",32)(41,"p-checkbox",85),H("ngModelChange",function(t){w(i);let n=_(2);return W(n.optionsFlags.docker,t)||(n.optionsFlags.docker=t),g(t)}),P("onChange",function(){w(i);let t=_(2);return g(t.onChangeOptionsFlags())}),f(),C(42," \xA0\xA0 "),p(43,"a",86),te(),p(44,"svg",87),O(45,"use",88),f()(),C(46," \xA0\xA0 "),ie(),p(47,"p",44),C(48),y(49,"translate"),f(),p(50,"a",89),C(51,"(+ info)"),f()()(),p(52,"div",29)(53,"div",32)(54,"p-checkbox",85),H("ngModelChange",function(t){w(i);let n=_(2);return W(n.optionsFlags.crowdsec,t)||(n.optionsFlags.crowdsec=t),g(t)}),P("onChange",function(){w(i);let t=_(2);return g(t.onChangeOptionsFlags())}),f(),C(55," \xA0\xA0 "),p(56,"a",90),te(),p(57,"svg",87),O(58,"use",91),f()(),C(59," \xA0\xA0 "),ie(),p(60,"p",44),C(61),y(62,"translate"),f()()(),p(63,"div",29)(64,"div",32)(65,"p-checkbox",85),H("ngModelChange",function(t){w(i);let n=_(2);return W(n.optionsFlags.fail2ban,t)||(n.optionsFlags.fail2ban=t),g(t)}),P("onChange",function(){w(i);let t=_(2);return g(t.onChangeOptionsFlags())}),f(),C(66," \xA0\xA0 "),p(67,"a",92),te(),p(68,"svg",87),O(69,"use",93),f()(),C(70," \xA0\xA0 "),ie(),p(71,"p",44),C(72),y(73,"translate"),f()()()(),p(74,"div",84)(75,"div",29)(76,"h6",44),C(77),y(78,"translate"),f()(),p(79,"div",29)(80,"div",32)(81,"p-checkbox",85),H("ngModelChange",function(t){w(i);let n=_(2);return W(n.optionsFlags.pdr_warning,t)||(n.optionsFlags.pdr_warning=t),g(t)}),P("onChange",function(){w(i);let t=_(2);return g(t.setFormOptionsFlags())}),f(),p(82,"span",44),C(83),y(84,"translate"),f()()(),p(85,"div",29)(86,"div",32)(87,"p-checkbox",85),H("ngModelChange",function(t){w(i);let n=_(2);return W(n.optionsFlags.pdr_critical,t)||(n.optionsFlags.pdr_critical=t),g(t)}),P("onChange",function(){w(i);let t=_(2);return g(t.setFormOptionsFlags())}),f(),p(88,"span",44),C(89),y(90,"translate"),f()()()()(),Te()}if(r&2){let i=_(2);c(5),F(" ",E(6,44,"FW.MSG_FW_EDITION.OPTIONS_DATA")," "),c(5),m("binary",!0),V("ngModel",i.optionsFlags.stateful),m("ngModelOptions",Y(68,Ie)),c(2),F("\xA0\xA0",E(13,46,"FW.OPTION_NAMES.stateful")),c(4),m("binary",!0),V("ngModel",i.optionsFlags.ipv4),m("ngModelOptions",Y(69,Ie)),c(2),F("\xA0\xA0",E(19,48,"FW.OPTION_NAMES.ipv4")),c(4),m("binary",!0),V("ngModel",i.optionsFlags.ipv6),m("ngModelOptions",Y(70,Ie)),c(2),F("\xA0\xA0",E(25,50,"FW.OPTION_NAMES.ipv6")),c(4),m("binary",!0),V("ngModel",i.optionsFlags.debug),m("ngModelOptions",Y(71,Ie)),c(2),F("\xA0\xA0",E(31,52,"FW.OPTION_NAMES.debug")),c(4),m("binary",!0),V("ngModel",i.optionsFlags.report),m("ngModelOptions",Y(72,Ie)),c(2),F("\xA0\xA0",E(37,54,"FW.OPTION_NAMES.report")),c(5),m("binary",!0),V("ngModel",i.optionsFlags.docker),m("ngModelOptions",Y(73,Ie)),c(7),F("\xA0\xA0",E(49,56,"FW.OPTION_NAMES.docker")),c(2),m("href",B(i.dockerDocURL),xi),c(4),m("binary",!0),V("ngModel",i.optionsFlags.crowdsec),m("ngModelOptions",Y(74,Ie)),c(7),F("\xA0\xA0",E(62,58,"FW.OPTION_NAMES.crowdsec")),c(4),m("binary",!0),V("ngModel",i.optionsFlags.fail2ban),m("ngModelOptions",Y(75,Ie)),c(7),F("\xA0\xA0",E(73,60,"FW.OPTION_NAMES.fail2ban")),c(5),F(" ",E(78,62,"FW.MSG_FW_EDITION.DANGEROUS_RULES_DETECTION")," "),c(4),m("binary",!0),V("ngModel",i.optionsFlags.pdr_warning),m("ngModelOptions",Y(76,Ie)),c(2),F("\xA0\xA0",E(84,64,"FW.OPTION_NAMES.pdr_warning")),c(4),m("binary",!0),V("ngModel",i.optionsFlags.pdr_critical),m("ngModelOptions",Y(77,Ie)),c(2),F("\xA0\xA0",E(90,66,"FW.OPTION_NAMES.pdr_critical"))}}function Fd(r,s){if(r&1&&(p(0,"div",28)(1,"div",29),O(2,"sts-fwc-message",95),f()()),r&2){let i=_(3);c(2),m("message",Qe(1,yr,i.translate.instant("PLUGINS.TITLE"),i.translate.instant("PLUGINS.ERRORS.COMMUNICATION.TEXT")))}}function Ad(r,s){if(r&1){let i=M();p(0,"div",28)(1,"div",83)(2,"h5",30),C(3),y(4,"translate"),f()(),p(5,"div",31)(6,"div",29)(7,"div",32)(8,"p-checkbox",85),H("ngModelChange",function(t){w(i);let n=_(3);return W(n.optionsPlugins.openvpn,t)||(n.optionsPlugins.openvpn=t),g(t)}),P("onChange",function(){w(i);let t=_(3);return g(t.onChangePlugins())}),f(),C(9," \xA0\xA0 "),p(10,"a",96),te(),p(11,"svg",87),O(12,"use",97),f()(),ie(),p(13,"p",44),C(14),y(15,"translate"),f()()(),p(16,"div",29)(17,"div",32)(18,"p-checkbox",85),H("ngModelChange",function(t){w(i);let n=_(3);return W(n.optionsPlugins.wireguard,t)||(n.optionsPlugins.wireguard=t),g(t)}),P("onChange",function(){w(i);let t=_(3);return g(t.onChangePlugins())}),f(),C(19," \xA0\xA0 "),p(20,"a",98),te(),p(21,"svg",87),O(22,"use",99),f()(),ie(),p(23,"p",44),C(24),y(25,"translate"),f()()(),p(26,"div",29)(27,"div",32)(28,"p-checkbox",85),H("ngModelChange",function(t){w(i);let n=_(3);return W(n.optionsPlugins.ipsec,t)||(n.optionsPlugins.ipsec=t),g(t)}),P("onChange",function(){w(i);let t=_(3);return g(t.onChangePlugins())}),f(),C(29," \xA0\xA0 "),p(30,"a",100),te(),p(31,"svg",87),O(32,"use",101),f()(),ie(),p(33,"p",44),C(34),y(35,"translate"),f()()(),p(36,"div",29)(37,"div",32)(38,"p-checkbox",85),H("ngModelChange",function(t){w(i);let n=_(3);return W(n.optionsPlugins.keepalived,t)||(n.optionsPlugins.keepalived=t),g(t)}),P("onChange",function(){w(i);let t=_(3);return g(t.onChangePlugins())}),f(),C(39," \xA0\xA0 "),p(40,"a",102),te(),p(41,"svg",87),O(42,"use",103),f()(),ie(),p(43,"p",44),C(44),y(45,"translate"),f()()(),p(46,"div",29)(47,"div",32)(48,"p-checkbox",85),H("ngModelChange",function(t){w(i);let n=_(3);return W(n.optionsPlugins.geoip,t)||(n.optionsPlugins.geoip=t),g(t)}),P("onChange",function(){w(i);let t=_(3);return g(t.onChangePlugins())}),f(),C(49," \xA0\xA0 "),p(50,"a",104),te(),p(51,"svg",87),O(52,"use",105),f()(),ie(),p(53,"p",44),C(54),y(55,"translate"),f()()(),p(56,"div",29)(57,"div",32)(58,"p-checkbox",85),H("ngModelChange",function(t){w(i);let n=_(3);return W(n.optionsPlugins.crowdsec,t)||(n.optionsPlugins.crowdsec=t),g(t)}),P("onChange",function(){w(i);let t=_(3);return g(t.onChangePlugins())}),f(),C(59," \xA0\xA0 "),p(60,"a",90),te(),p(61,"svg",87),O(62,"use",91),f()(),ie(),p(63,"p",44),C(64),y(65,"translate"),f()()(),p(66,"div",29)(67,"div",32)(68,"p-checkbox",85),H("ngModelChange",function(t){w(i);let n=_(3);return W(n.optionsPlugins.ntopng,t)||(n.optionsPlugins.ntopng=t),g(t)}),P("onChange",function(){w(i);let t=_(3);return g(t.onChangePlugins())}),f(),C(69," \xA0\xA0 "),p(70,"a",106),te(),p(71,"svg",87),O(72,"use",107),f()(),ie(),p(73,"p",44),C(74),y(75,"translate"),f()()(),p(76,"div",29)(77,"div",32)(78,"p-checkbox",85),H("ngModelChange",function(t){w(i);let n=_(3);return W(n.optionsPlugins.websafety,t)||(n.optionsPlugins.websafety=t),g(t)}),P("onChange",function(){w(i);let t=_(3);return g(t.onChangePlugins())}),f(),C(79," \xA0\xA0 "),p(80,"a",108),te(),p(81,"svg",87),O(82,"use",109),f()(),ie(),p(83,"p",44),C(84),y(85,"translate"),f()()(),p(86,"div",29)(87,"div",32)(88,"p-checkbox",85),H("ngModelChange",function(t){w(i);let n=_(3);return W(n.optionsPlugins.dnssafety,t)||(n.optionsPlugins.dnssafety=t),g(t)}),P("onChange",function(){w(i);let t=_(3);return g(t.onChangePlugins())}),f(),C(89," \xA0\xA0 "),p(90,"a",110),te(),p(91,"svg",87),O(92,"use",111),f()(),ie(),p(93,"p",44),C(94),y(95,"translate"),f()()(),p(96,"div",29)(97,"div",32)(98,"p-checkbox",85),H("ngModelChange",function(t){w(i);let n=_(3);return W(n.optionsPlugins.suricata,t)||(n.optionsPlugins.suricata=t),g(t)}),P("onChange",function(){w(i);let t=_(3);return g(t.onChangePlugins())}),f(),C(99," \xA0\xA0 "),p(100,"a",112),te(),p(101,"svg",87),O(102,"use",113),f()(),ie(),p(103,"p",44),C(104),y(105,"translate"),f()()()(),p(106,"div",31)(107,"div",29)(108,"div",32)(109,"p-checkbox",85),H("ngModelChange",function(t){w(i);let n=_(3);return W(n.optionsPlugins.zeek,t)||(n.optionsPlugins.zeek=t),g(t)}),P("onChange",function(){w(i);let t=_(3);return g(t.onChangePlugins())}),f(),C(110," \xA0\xA0 "),p(111,"a",114),te(),p(112,"svg",87),O(113,"use",115),f()(),ie(),p(114,"p",44),C(115),y(116,"translate"),f()()(),p(117,"div",29)(118,"div",32)(119,"p-checkbox",85),H("ngModelChange",function(t){w(i);let n=_(3);return W(n.optionsPlugins.elasticsearch,t)||(n.optionsPlugins.elasticsearch=t),g(t)}),P("onChange",function(){w(i);let t=_(3);return g(t.onChangePlugins())}),f(),C(120," \xA0\xA0 "),p(121,"a",116),te(),p(122,"svg",87),O(123,"use",117),f()(),ie(),p(124,"p",44),C(125),y(126,"translate"),f()()(),p(127,"div",29)(128,"div",32)(129,"p-checkbox",85),H("ngModelChange",function(t){w(i);let n=_(3);return W(n.optionsPlugins.kibana,t)||(n.optionsPlugins.kibana=t),g(t)}),P("onChange",function(){w(i);let t=_(3);return g(t.onChangePlugins())}),f(),C(130," \xA0\xA0 "),p(131,"a",118),te(),p(132,"svg",87),O(133,"use",119),f()(),ie(),p(134,"p",44),C(135),y(136,"translate"),f()()(),p(137,"div",29)(138,"div",32)(139,"p-checkbox",85),H("ngModelChange",function(t){w(i);let n=_(3);return W(n.optionsPlugins.logstash,t)||(n.optionsPlugins.logstash=t),g(t)}),P("onChange",function(){w(i);let t=_(3);return g(t.onChangePlugins())}),f(),C(140," \xA0\xA0 "),p(141,"a",120),te(),p(142,"svg",87),O(143,"use",121),f()(),ie(),p(144,"p",44),C(145),y(146,"translate"),f()()(),p(147,"div",29)(148,"div",32)(149,"p-checkbox",85),H("ngModelChange",function(t){w(i);let n=_(3);return W(n.optionsPlugins.filebeat,t)||(n.optionsPlugins.filebeat=t),g(t)}),P("onChange",function(){w(i);let t=_(3);return g(t.onChangePlugins())}),f(),C(150," \xA0\xA0 "),p(151,"a",122),te(),p(152,"svg",87),O(153,"use",123),f()(),ie(),p(154,"p",44),C(155),y(156,"translate"),f()()(),p(157,"div",29)(158,"div",32)(159,"p-checkbox",85),H("ngModelChange",function(t){w(i);let n=_(3);return W(n.optionsPlugins.iscdhcp,t)||(n.optionsPlugins.iscdhcp=t),g(t)}),P("onChange",function(){w(i);let t=_(3);return g(t.onChangePlugins())}),f(),C(160," \xA0\xA0 "),p(161,"a",124),te(),p(162,"svg",87),O(163,"use",125),f()(),ie(),p(164,"p",44),C(165),y(166,"translate"),f()()(),p(167,"div",29)(168,"div",32)(169,"p-checkbox",85),H("ngModelChange",function(t){w(i);let n=_(3);return W(n.optionsPlugins.haproxy,t)||(n.optionsPlugins.haproxy=t),g(t)}),P("onChange",function(){w(i);let t=_(3);return g(t.onChangePlugins())}),f(),C(170," \xA0\xA0 "),p(171,"a",126),te(),p(172,"svg",87),O(173,"use",127),f()(),ie(),p(174,"p",44),C(175),y(176,"translate"),f()()(),p(177,"div",29)(178,"div",32)(179,"p-checkbox",85),H("ngModelChange",function(t){w(i);let n=_(3);return W(n.optionsPlugins.iscbind9,t)||(n.optionsPlugins.iscbind9=t),g(t)}),P("onChange",function(){w(i);let t=_(3);return g(t.onChangePlugins())}),f(),C(180," \xA0\xA0 "),p(181,"a",128),te(),p(182,"svg",87),O(183,"use",129),f()(),ie(),p(184,"p",44),C(185),y(186,"translate"),f()()(),p(187,"div",29)(188,"div",32)(189,"p-checkbox",85),H("ngModelChange",function(t){w(i);let n=_(3);return W(n.optionsPlugins.irqbalance,t)||(n.optionsPlugins.irqbalance=t),g(t)}),P("onChange",function(){w(i);let t=_(3);return g(t.onChangePlugins())}),f(),C(190," \xA0\xA0 "),p(191,"a",130),te(),p(192,"svg",87),O(193,"use",131),f()(),ie(),p(194,"p",44),C(195),y(196,"translate"),f()()()()()}if(r&2){let i=_(3);c(3),F(" ",E(4,77,"FW.MSG_FW_EDITION.PLUGINS")," "),c(5),m("binary",!0),V("ngModel",i.optionsPlugins.openvpn),m("ngModelOptions",Y(117,Ie)),c(6),F("\xA0\xA0",E(15,79,"CLUSTER.PLUGINS.OPENVPN")),c(4),m("binary",!0),V("ngModel",i.optionsPlugins.wireguard),m("ngModelOptions",Y(118,Ie)),c(6),F("\xA0\xA0",E(25,81,"FW.PLUGINS.WIREGUARD")),c(4),m("binary",!0),V("ngModel",i.optionsPlugins.ipsec),m("ngModelOptions",Y(119,Ie)),c(6),F("\xA0\xA0",E(35,83,"FW.PLUGINS.IPSEC")),c(4),m("binary",!0),V("ngModel",i.optionsPlugins.keepalived),m("ngModelOptions",Y(120,Ie)),c(6),F("\xA0\xA0",E(45,85,"CLUSTER.PLUGINS.KEEPALIVED")),c(4),m("binary",!0),V("ngModel",i.optionsPlugins.geoip),m("ngModelOptions",Y(121,Ie)),c(6),F("\xA0\xA0",E(55,87,"CLUSTER.PLUGINS.GEOIP")),c(4),m("binary",!0),V("ngModel",i.optionsPlugins.crowdsec),m("ngModelOptions",Y(122,Ie)),c(6),F("\xA0\xA0",E(65,89,"CLUSTER.PLUGINS.CROWDSEC")),c(4),m("binary",!0),V("ngModel",i.optionsPlugins.ntopng),m("ngModelOptions",Y(123,Ie)),c(6),F("\xA0\xA0",E(75,91,"CLUSTER.PLUGINS.NTOPNG")),c(4),m("binary",!0),V("ngModel",i.optionsPlugins.websafety),m("ngModelOptions",Y(124,Ie)),c(6),F("\xA0\xA0",E(85,93,"CLUSTER.PLUGINS.WEBSAFETY")),c(4),m("binary",!0),V("ngModel",i.optionsPlugins.dnssafety),m("ngModelOptions",Y(125,Ie)),c(6),F("\xA0\xA0",E(95,95,"CLUSTER.PLUGINS.DNSSAFETY")),c(4),m("binary",!0),V("ngModel",i.optionsPlugins.suricata),m("ngModelOptions",Y(126,Ie)),c(6),F("\xA0\xA0",E(105,97,"CLUSTER.PLUGINS.SURICATA")),c(5),m("binary",!0),V("ngModel",i.optionsPlugins.zeek),m("ngModelOptions",Y(127,Ie)),c(6),F("\xA0\xA0",E(116,99,"CLUSTER.PLUGINS.ZEEK")),c(4),m("binary",!0),V("ngModel",i.optionsPlugins.elasticsearch),m("ngModelOptions",Y(128,Ie)),c(6),F("\xA0\xA0",E(126,101,"CLUSTER.PLUGINS.ELASTICSEARCH")),c(4),m("binary",!0),V("ngModel",i.optionsPlugins.kibana),m("ngModelOptions",Y(129,Ie)),c(6),F("\xA0\xA0",E(136,103,"CLUSTER.PLUGINS.KIBANA")),c(4),m("binary",!0),V("ngModel",i.optionsPlugins.logstash),m("ngModelOptions",Y(130,Ie)),c(6),F("\xA0\xA0",E(146,105,"CLUSTER.PLUGINS.LOGSTASH")),c(4),m("binary",!0),V("ngModel",i.optionsPlugins.filebeat),m("ngModelOptions",Y(131,Ie)),c(6),F("\xA0\xA0",E(156,107,"CLUSTER.PLUGINS.FILEBEAT")),c(4),m("binary",!0),V("ngModel",i.optionsPlugins.iscdhcp),m("ngModelOptions",Y(132,Ie)),c(6),F("\xA0\xA0",E(166,109,"FW.PLUGINS.ISCDHCP")),c(4),m("binary",!0),V("ngModel",i.optionsPlugins.haproxy),m("ngModelOptions",Y(133,Ie)),c(6),F("\xA0\xA0",E(176,111,"FW.PLUGINS.HAPROXY")),c(4),m("binary",!0),V("ngModel",i.optionsPlugins.iscbind9),m("ngModelOptions",Y(134,Ie)),c(6),F("\xA0\xA0",E(186,113,"FW.PLUGINS.ISCBIND9")),c(4),m("binary",!0),V("ngModel",i.optionsPlugins.irqbalance),m("ngModelOptions",Y(135,Ie)),c(6),F("\xA0\xA0",E(196,115,"FW.PLUGINS.IRQBALANCE"))}}function Ld(r,s){if(r&1&&(Pe(0),O(1,"input",94),x(2,Fd,3,4,"div",28),x(3,Ad,197,136,"div",28),Te()),r&2){let i=_(2);c(2),R(i.NodesComunicateViaSsh()?2:-1),c(),R(i.NodesComunicateViaSsh()?-1:3)}}function Md(r,s){if(r&1&&(p(0,"div",28)(1,"div",29),O(2,"sts-fwc-message",95),f()()),r&2){let i=_(3);c(2),m("message",Qe(1,yr,i.translate.instant("NGFW.TITLE"),i.translate.instant("NGFW.ERRORS.COMMUNICATION.TEXT")))}}function Dd(r,s){if(r&1){let i=M();p(0,"div",28)(1,"div",83)(2,"h5",30),C(3),y(4,"translate"),f()(),p(5,"div",132)(6,"div",65)(7,"div",133)(8,"label",134)(9,"a",106),te(),p(10,"svg",87),O(11,"use",107),f()(),C(12),y(13,"translate"),f(),ie(),p(14,"p-button",135),y(15,"translate"),y(16,"translate"),P("onClick",function(){w(i);let t=_(3);return g(t.onClickButtonNGFW("NTOPNG",t.node))}),f()()(),p(17,"div",65)(18,"div",133)(19,"label",136)(20,"a",108),te(),p(21,"svg",87),O(22,"use",109),f()(),C(23),y(24,"translate"),f(),ie(),p(25,"p-button",135),y(26,"translate"),y(27,"translate"),P("onClick",function(){w(i);let t=_(3);return g(t.onClickButtonNGFW("WEBSAFETYPROXY",t.node))}),f()()(),p(28,"div",65)(29,"div",133)(30,"label",137)(31,"a",110),te(),p(32,"svg",87),O(33,"use",111),f()(),C(34),y(35,"translate"),f(),ie(),p(36,"p-button",135),y(37,"translate"),y(38,"translate"),P("onClick",function(){w(i);let t=_(3);return g(t.onClickButtonNGFW("DNSSAFETY",t.node))}),f()()(),p(39,"div",65)(40,"div",133)(41,"label",138)(42,"a",116),te(),p(43,"svg",87),O(44,"use",117),f()(),C(45),y(46,"translate"),f(),ie(),p(47,"p-button",135),y(48,"translate"),y(49,"translate"),P("onClick",function(){w(i);let t=_(3);return g(t.onClickButtonNGFW("ELASTICSEARCH",t.node))}),f()()()()()}if(r&2){let i=_(3);c(3),F(" ",E(4,25,"NGFW.DESCRIPTION")," "),c(9),F(" ",E(13,27,"CONTEXT.FW.NTOPNG")," "),c(2),m("pTooltip",B(E(15,29,"CONTEXT.FW.NTOPNG")))("label",B(E(16,31,"CONTEXT.FW.NTOPNG")))("disabled",!i.checksNodeNtopNGConfig()),c(9),F(" ",E(24,33,"CONTEXT.FW.WEBSAFETYPROXY")," "),c(2),m("pTooltip",B(E(26,35,"CONTEXT.FW.WEBSAFETYPROXY")))("label",B(E(27,37,"CONTEXT.FW.WEBSAFETYPROXY")))("disabled",!i.checksNodeWebSafetyProxyActie()),c(9),F(" ",E(35,39,"CONTEXT.FW.DNSSAFETY")," "),c(2),m("pTooltip",B(E(37,41,"CONTEXT.FW.DNSSAFETY")))("label",B(E(38,43,"CONTEXT.FW.DNSSAFETY")))("disabled",!i.checksNodeDNSSafetyActive()),c(9),F(" ",E(46,45,"CLUSTER.PLUGINS.ELASTICSEARCH")," "),c(2),m("pTooltip",B(E(48,47,"CLUSTER.PLUGINS.ELASTICSEARCH")))("label",B(E(49,49,"CLUSTER.PLUGINS.ELASTICSEARCH")))("disabled",!i.checksNodeElasticSearchActive())}}function Nd(r,s){if(r&1&&(Pe(0),x(1,Md,3,4,"div",28),x(2,Dd,50,51,"div",28),Te()),r&2){let i=_(2);c(),R(i.NodesComunicateViaSsh()?1:-1),c(),R(i.NodesComunicateViaSsh()?-1:2)}}function Gd(r,s){if(r&1){let i=M();p(0,"form",17),P("keyup.enter",function(t){w(i);let n=_();return g(n.checkForm(t))})("keyup.esc",function(){w(i);let t=_();return g(t.onCancel())}),p(1,"fieldset",18)(2,"div",19)(3,"div",20)(4,"button",21),P("click",function(){w(i);let t=_();return g(t.onChangeTab({index:0}))}),O(5,"i",14),p(6,"span"),C(7),y(8,"translate"),f()(),p(9,"button",21),P("click",function(){w(i);let t=_();return g(t.onChangeTab({index:1}))}),O(10,"i",22),p(11,"span"),C(12),y(13,"translate"),f()(),p(14,"button",21),P("click",function(){w(i);let t=_();return g(t.onChangeTab({index:2}))}),O(15,"i",23),p(16,"span"),C(17),y(18,"translate"),f()(),p(19,"button",21),P("click",function(){w(i);let t=_();return g(t.onChangeTab({index:3}))}),O(20,"i",24),p(21,"span"),C(22),y(23,"translate"),f()(),p(24,"button",21),P("click",function(){w(i);let t=_();return g(t.onChangeTab({index:4}))}),O(25,"i",25),p(26,"span"),C(27),y(28,"translate"),f()()(),p(29,"section",26),J(30,Od,39,28,"ng-container",27)(31,xd,3,1,"ng-container",27)(32,Rd,91,78,"ng-container",27)(33,Ld,4,2,"ng-container",27)(34,Nd,3,2,"ng-container",27),f()()()()}if(r&2){let i=_();m("formGroup",i.formModel),c(),m("disabled",i.loadingData),c(3),Je("is-active",i.shownPanel===0),m("disabled",i.loadingData),c(3),U(E(8,27,"CLUSTER.MSG_CLUSTER_TAB.CT_0")),c(2),Je("is-active",i.shownPanel===1),m("disabled",i.loadingData),c(3),U(E(13,29,"FW.MSG_FW_TAB.FT_1")),c(2),Je("is-active",i.shownPanel===2),m("disabled",i.loadingData),c(3),U(E(18,31,"CLUSTER.MSG_CLUSTER_TAB.CT_1")),c(2),Je("is-active",i.shownPanel===3),m("disabled",i.loadingData||i.NodesComunicateViaSsh()),c(3),U(E(23,33,"FW.MSG_FW_EDITION.PLUGINS")),c(2),Je("is-active",i.shownPanel===4),m("disabled",i.loadingData||i.NodesComunicateViaSsh()),c(3),U(E(28,35,"NGFW.TITLE")),c(3),m("ngIf",i.shownPanel===0),c(),m("ngIf",i.shownPanel===1),c(),m("ngIf",i.shownPanel===2),c(),m("ngIf",i.shownPanel===3),c(),m("ngIf",i.shownPanel===4)}}function Ud(r,s){if(r&1&&(p(0,"div",139),O(1,"sts-fwc-message",95),f()),r&2){let i=_(2);c(),m("message",i.delMessage)}}function kd(r,s){if(r&1&&O(0,"sts-fwc-message",95),r&2){let i=_(3);m("message",i.deleteMsgError)}}function Bd(r,s){if(r&1){let i=M();p(0,"sts-fwc-object-restrictions",142),P("onHideParent",function(){w(i);let t=_(3);return g(t.minimizeDialog(!0))})("onRefreshRestrictions",function(){w(i);let t=_(3);return g(t.reloadPanel())}),f()}if(r&2){let i=_(3);m("dependencies",i.dependencies)}}function jd(r,s){if(r&1&&(p(0,"div",140),x(1,kd,1,1,"sts-fwc-message",95),x(2,Bd,1,1,"sts-fwc-object-restrictions",141),f()),r&2){let i=_(2);c(),R(i.deleteMsgError?1:-1),c(),R(i.dependencies.restrictionsError?-1:2)}}function Vd(r,s){if(r&1){let i=M();p(0,"div",139)(1,"p-checkbox",143),y(2,"translate"),H("ngModelChange",function(t){w(i);let n=_(3);return W(n.okToDelete,t)||(n.okToDelete=t),g(t)}),f()()}if(r&2){let i=_(3);c(),m("label",B(E(2,3,"CLUSTER.MSG_CLUSTER_DELETE.DEL_5"))),V("ngModel",i.okToDelete)}}function Wd(r,s){if(r&1&&(O(0,"sts-fwc-message",95),x(1,Vd,3,5,"div",139)),r&2){let i=_(2);m("message",i.deleteMsgError),c(),R(i.loadingData?-1:1)}}function Hd(r,s){if(r&1&&(x(0,Ud,2,1,"div",139),x(1,jd,3,2,"div",140)(2,Wd,2,2)),r&2){let i=_();R(i.loadingData&&!i.deleteMsgError?0:-1),c(),R(i.dependencies?1:2)}}function Jd(r,s){if(r&1&&(p(0,"div",144),O(1,"p-progressSpinner",149),f()),r&2){let i=_(3);m("ngStyle",Re(1,Cr,i.loadingData?"visible":"hidden"))}}function Yd(r,s){if(r&1){let i=M();p(0,"p-button",150),y(1,"translate"),P("onClick",function(){w(i);let t=_(3);return g(t.onCloseDialog())}),f()}r&2&&m("label",B(E(1,2,"GLOBALS.MSG_BUTTONS.STOP")))}function Kd(r,s){if(r&1){let i=M();p(0,"p-button",151),y(1,"translate"),P("onClick",function(){w(i);let t=_(3);return g(t.onCancel())}),f()}if(r&2){let i=_(3);m("label",B(E(1,3,"GLOBALS.MSG_BUTTONS.CANCEL")))("disabled",i.loadingData)}}function Xd(r,s){if(r&1){let i=M();p(0,"p-button",152),y(1,"translate"),P("onClick",function(){w(i);let t=_(3);return g(t.onSave())}),f()}if(r&2){let i=_(3);m("label",B(E(1,3,"GLOBALS.MSG_BUTTONS.SAVE")))("disabled",!i.formModel.valid||i.loadingData)}}function zd(r,s){if(r&1){let i=M();p(0,"p-button",153),y(1,"translate"),P("onClick",function(){w(i);let t=_(3);return g(t.onCancel())}),f()}if(r&2){let i=_(3);m("label",B(E(1,3,"GLOBALS.MSG_BUTTONS.CLOSE")))("disabled",i.loadingData)}}function qd(r,s){if(r&1&&(x(0,Jd,2,3,"div",144),x(1,Yd,2,4,"p-button",145),x(2,Kd,2,5,"p-button",146),x(3,Xd,2,5,"p-button",147),x(4,zd,2,5,"p-button",148)),r&2){let i=_(2);R(i.loadingCommunication?0:-1),c(),R(i.loadingCommunication?1:-1),c(),R(!i.formModel.pristine&&!i.loadingCommunication?2:-1),c(),R(i.formModel.pristine?-1:3),c(),R(i.formModel.pristine?4:-1)}}function Qd(r,s){if(r&1){let i=M();p(0,"p-button",157),y(1,"translate"),P("onClick",function(){w(i);let t=_(3);return g(t.reloadPanel())}),f()}if(r&2){let i=_(3);m("label",B(E(1,3,"POLICY_GRID.RELOAD")))("disabled",i.loadingData)}}function $d(r,s){if(r&1){let i=M();x(0,Qd,2,5,"p-button",154),p(1,"p-button",155),y(2,"translate"),P("onClick",function(){w(i);let t=_(2);return g(t.onDeleteCluster())}),f(),p(3,"p-button",156),y(4,"translate"),P("onClick",function(){w(i);let t=_(2);return g(t.onCancel())}),f()}if(r&2){let i=_(2);R(i.dependencies?0:-1),c(),m("label",B(E(2,6,"CLUSTER.MSG_CLUSTER_EDITION.DELETE")))("disabled",!i.okToDelete||i.loadingData),c(2),m("label",B(E(4,8,"GLOBALS.MSG_BUTTONS.CANCEL")))}}function Zd(r,s){if(r&1&&(x(0,qd,5,5),x(1,$d,5,10)),r&2){let i=_();R(i.cluster?0:-1),c(),R(i.clusterToDelete?1:-1)}}var Xe=(function(r){return r.stateful="stateful",r.ipv4="ipv4",r.ipv6="ipv6",r.debug="debug",r.report="report",r.docker="docker",r.crowdsec="crowdsec",r.fail2ban="fail2ban",r.pdr_warning="pdr_warning",r.pdr_critical="pdr_critical",r})(Xe||{}),ht=(function(r){return r.openvpn="openvpn",r.wireguard="wireguard",r.ipsec="ipsec",r.geoip="geoip",r.crowdsec="crowdsec",r.ntopng="ntopng",r.suricata="suricata",r.keepalived="keepalived",r.zeek="zeek",r.elasticsearch="elasticsearch",r.filebeat="filebeat",r.websafety="websafety",r.kibana="kibana",r.logstash="logstash",r.dnssafety="dnssafety",r.iscbind9="iscbind9",r.iscdhcp="iscdhcp",r.haproxy="haproxy",r.irqbalance="irqbalance",r})(ht||{}),yo=new Map([[Xe.stateful,0],[Xe.ipv4,1],[Xe.ipv6,2],[Xe.debug,3],[Xe.report,4],[Xe.docker,5],[Xe.crowdsec,6],[Xe.fail2ban,7],[Xe.pdr_warning,8],[Xe.pdr_critical,9]]),e_=[Xe.stateful,Xe.ipv4,Xe.pdr_warning,Xe.pdr_critical],Sr=e_.reduce((r,s)=>{let i=yo.get(s);return i!==void 0?r+2**i:r},0),St=new Map([["openvpn",1],["geoip",2],["crowdsec",4],["ntopng",8],["suricata",16],["keepalived",32],["zeek",64],["elasticsearch",128],["filebeat",256],["websafety",512],["kibana",1024],["logstash",2048],["dnssafety",4096],["iscbind9",8192],["iscdhcp",16384],["haproxy",32768],["wireguard",65536],["ipsec",131072],["irqbalance",262144]]),t_=Mt.find(r=>r.name.toLowerCase()==="vyos")?.id??2,Er=(()=>{let s=class s extends Jt{constructor(e,t,n,l,o,a,u,d,h,S,v,b,T,A,N,j,D,Q){super(v,u,t,N,D,Q),this.fwcUserService=e,this.itemSelectedService=t,this.fwcFirewallService=n,this.fwcInterfaceService=l,this.confirmationService=o,this.fwcObjectTreeService=a,this.appOptionsService=u,this.fwcPolicyService=d,this.fwcEventService=h,this.fwcErrorPipe=S,this.appDialogPanelsService=v,this.messageService=b,this.utilService=T,this.inputDataService=A,this.cd=N,this.translate=j,this.store=D,this.router=Q,this.cluster=null,this.clusterToDelete=null,this.interfaces=[],this.interfacesIpObjs=new Map,this.clusterNodes=[],this.displaySSH=[],this.displayApiKey=[],this.dependencies=null,this.okToDelete=!1,this.isVyOSCompilerSelected=!1,this.loadingData=!1,this.loadingCommunication=!1,this.alive=!0,this.discoveredInstallOptions=new Map,this.FirewallCompilerOptions=Mt,this.wasVyOSCompilerSelected=!1,this.lastCommunicationBeforeVyOSByNode=new Map,this.optionsFlags={stateful:!1,ipv4:!1,ipv6:!1,debug:!1,report:!1,docker:!1,crowdsec:!1,fail2ban:!1,pdr_warning:!1,pdr_critical:!1},this.optionsPlugins={openvpn:!1,wireguard:!1,ipsec:!1,geoip:!1,crowdsec:!1,ntopng:!1,suricata:!1,keepalived:!1,zeek:!1,elasticsearch:!1,filebeat:!1,websafety:!1,kibana:!1,logstash:!1,dnssafety:!1,iscbind9:!1,iscdhcp:!1,haproxy:!1,irqbalance:!1},this.createDialog(this.translate.instant("CLUSTER.PANEL_TITLE"),"fwci-clusters",Z.CLUSTER_PANEL),this.helpSection="/firewalls",this.resetForm()}ngOnInit(){this.dockerDocURL=`https://fwcloud.net/${this.translate.currentLang!=="es"?this.translate.currentLang+"/":""}documentation/fwcloud-docker`,this.deleteMsgError=null,this.store.pipe(oe(()=>this.alive),di(Ji.selectDialogUuidsToReload)).subscribe(e=>{e&&e.find(t=>t===this.dialogUUID)&&this.reloadPanel()}),this.itemSelectedService.getItem().pipe(oe(()=>this.alive)).subscribe(e=>{if(e._fwcObjType==I.OBJ_CLUSTER)if(this.itemSelectedService.hideObjectPanel(),e.deleteAction)this.showDialog(),this.checkClusterRestrictions(e);else if(e.id_obj!==null&&e.id_obj!=null){let t=[],n;for(t.push(e);t.length&&!n;){let l=t.pop();l.node_type==q.FOLDER_CLUSTER_FW?n=l.id:l.items&&l.items.length&&t.push(...l.items)}this.fwcFirewallService.getCluster(e.id_obj,this.fwcUserService.getActualFwSelectedCloud()).subscribe({next:l=>le(this,null,function*(){let o,a;if(l.data){this.cluster=l.data,this.cluster.interfaces&&Array.isArray(this.cluster.interfaces)&&(this.interfaces=this.cluster.interfaces,this.interfaces.forEach(S=>{let v=Xi();S.interfaceUUID=v,Array.isArray(S.ipobjs)&&S.ipobjs.forEach(b=>{b.ipObjUUID=v+Xi()})}));let u=this.fwcUserService.getActualFwcUser().privateKey,d=this.cluster.nodes,h=[];for(let S=0;d&&S<d.length;S++){let v=d[S];o=v.options,a=v.plugins,v.firewallUUID=Ft();try{v.install_user&&(v.install_user=yield this.utilService.openPGPDecrypt(v.install_user,u)),v.install_pass&&(v.install_pass=yield this.utilService.openPGPDecrypt(v.install_pass,u)),v.install_apikey&&(v.install_apikey.startsWith("-")||(v.install_apikey=yield this.utilService.openPGPDecrypt(v.install_apikey,u)))}catch{}let b,T;Array.isArray(this.interfaces)&&this.interfaces.forEach(A=>{v.install_interface&&v.install_interface===A.id&&(v.installInterfaceUUID=A.interfaceUUID,b=A),Array.isArray(A.ipobjs)&&A.ipobjs.forEach(N=>{v.install_ipobj&&v.install_ipobj===N.id&&(v.installIpObjUUID=N.ipObjUUID,T=N)})}),this.setNode(this.cluster.nodes[0].id.toString()+","+this.cluster.nodes[0].name),h.push({firewallUUID:v.firewallUUID,firewall_name:v.name,firewall:v.id,cluster:this.cluster.id,installOptions:{firewallUUID:v.firewallUUID,interface:b,ipobj:T}});for(let A=0;A<this.interfaces.length;A++)if(v.install_interface==this.interfaces[A].id){this.interfacesIpObjs.set(v.firewallUUID,this.interfaces[A].ipobjs);break}}Array.isArray(this.interfaces)&&(this.interfacesEditorOptions={isCluster:!0,firewalls:h,discoveredFirewallUUID:void 0,discoveredIfs:[],existingIfs:this.interfaces}),this.cluster.options=o,this.cluster.nodesParentId=n,this.resetForm(),this.fillForm(),this.showDialog()}}),error:l=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(l)})},complete:()=>{}})}else this.cluster={id:void 0,node_id:e.node_id,options:Sr,plugins:0},this.resetForm(),this.fillForm(),this.showDialog()})}ngOnDestroy(){this.compilerControlSubscription&&(this.compilerControlSubscription.unsubscribe(),this.compilerControlSubscription=null),super.ngOnDestroy()}reloadPanel(){if(this.clusterToDelete&&this.clusterToDelete&&(this.displayDialog||this.dialogMinified)){let e=Object.assign({},this.clusterToDelete),t=this.itemSelectedService.getActualLastMinifiedDialogId();this.checkClusterRestrictions(e),this.dialogId==t&&(this.showDialog(),this.itemSelectedService.setLastMinifiedDialogId(void 0)),this.store.dispatch(Ce.reloadDialogFinished({dialogUuid:this.dialogUUID}))}}getInterfaceAndAddressByUUID(e,t,n){let l,o;if(Array.isArray(this.interfaces)&&this.interfaces.forEach(a=>{a.interfaceUUID&&a.interfaceUUID===t&&(l=a),Array.isArray(a.ipobjs)&&a.ipobjs.forEach(u=>{u.ipObjUUID&&u.ipObjUUID===n&&(o=u)})}),(!l||!o)&&this.discoveredInstallOptions){let a=this.discoveredInstallOptions.get(e);a&&(l=l||a.interface,o=o||a.ipobj)}return{interfaceInfo:l,ipObjInfo:o}}resetProperties(){this.isVyOSCompilerSelected=!1,this.wasVyOSCompilerSelected=!1,this.lastCommunicationBeforeVyOSByNode.clear(),this.fwcUserService.setConfirmationToken(void 0),this.cluster=null,this.clusterNodes=[],this.clusterToDelete=null,this.interfaces=[],this.interfacesIpObjs=new Map,this.dependencies=null,this.interfacesEditorOptions=null,this.fwcInterfacesEditor&&this.fwcInterfacesEditor.resetProperties(),this.discoveredInstallOptions=new Map,this.deleteMsgError=null,this.delMessage=null,this.displaySSH=[],this.displayApiKey=[],this.okToDelete=!1,this.loadingData=!1,this.formModel&&this.formModel.reset()}resetForm(){this.compilerControlSubscription&&(this.compilerControlSubscription.unsubscribe(),this.compilerControlSubscription=null),this.formModel=new Ei({cluster:new K(""),name:new K("",[ee.required,ee.pattern(Fe.nameRegExp)]),comment:new K(""),options:new K(Sr),plugins:new K(0),node_id:new K(null),fwnodes:new Yo([this.createNode()],Fe.distinctNameValidator.bind(this)),compiler:new K(0)}),this.setOptionsFlags()}createNode(e){let t,n,l,o,a,u,d,h,S,v,b,T,A,N,j,D,Q,X;e?(t=e.id,n=e.name,l=e.comment,o=e.fwcloud,a=e.install_user,u=e.install_pass,d=e.save_user_pass,h=e.install_interface,S=e.install_ipobj,v=e.fwmaster,b=e.install_port,T=e.firewallUUID,N=e.installInterfaceUUID,j=e.installIpObjUUID,D=e.install_communication,Q=e.install_protocol,X=e.install_apikey):T=Ft(),this.cluster&&(A=this.cluster.id),d===void 0&&(d=1),v===void 0&&(v=0),b===void 0&&(b=33033);let re=new Ei({name:new K(n,[ee.required,ee.pattern(Fe.nameRegExp)]),comment:new K(l),install_user:new K(a,ee.pattern(Fe.linuxUsername)),install_pass:new K(u,ee.pattern(Fe.linuxPassword)),save_user_pass:new K(d),install_interface:new K(h),install_ipobj:new K(S),fwmaster:new K(v),install_port:new K(b),firewallUUID:new K(T),installInterfaceUUID:new K(N),installIpObjUUID:new K(j),install_communication:new K(D||"agent",ee.required),install_protocol:new K(Q||"https"),install_apikey:new K(X)});return t!=null&&re.addControl("id",new K(t)),A!=null&&re.addControl("cluster",new K(A)),re}fillForm(){if(this.cluster){if(this.formModel.controls.cluster.setValue(this.cluster.id),this.formModel.controls.name.setValue(this.cluster.name),this.formModel.controls.comment.setValue(this.cluster.comment),this.formModel.controls.node_id.setValue(this.cluster.node_id),this.formModel.controls.options.setValue(this.cluster.options),this.setOptionsFlags(),this.formModel.controls.plugins.setValue(this.cluster.plugins),this.setOptionsPlugins(),this.cluster.nodes&&this.cluster.nodes.length){let t=this.formModel.controls.fwnodes;for(;t.length!==0;)t.removeAt(0);for(let n=0;n<this.cluster.nodes.length;n++){let l=this.cluster.nodes[n];this.formModel.controls.fwnodes.push(this.createNode(l))}}this.cluster.type=I.OBJ_CLUSTER,this.cluster.container=Ge.C_FIREWALLS;let e=this.cluster.options&61440;this.formModel.controls.compiler.setValue(e>>12),this.updateCompilerState()}}setOptionsFlags(){let e=this.cluster?.options??this.formModel?.get("options")?.value??0;Object.values(Xe).forEach(t=>{this.optionsFlags[t]=!!(e&2**yo.get(t))})}onChangeOptionsFlags(){let e=[];for(let t of Object.values(Xe)){let n=yo.get(t);e[n]=this.optionsFlags[t]?"1":"0"}this.formModel.controls.options.setValue(parseInt(e.reduce((t,n)=>n+t,""),2)),this.formModel.markAsDirty()}getFormNodes(){return this.formModel.get("fwnodes")}NodesComunicateViaSsh(){return!this.formModel.value.fwnodes.find(e=>e.install_communication!=="ssh")}setOptionsPlugins(){this.cluster&&Object.values(ht).forEach(e=>{this.optionsPlugins[e]=!!(this.cluster.plugins&St.get(e))})}onChangePluginsDevelop(){this.confirmationService.confirm({header:this.translate.instant("FW.PLUGINS.HEADER"),icon:"fa fa-exclamation-circle fwcRed iconBig",acceptLabel:"Ok",rejectVisible:!1,message:this.translate.instant("FW.PLUGINS.NOT_IMPLEMENTED"),reject:()=>{this.setOptionsPlugins()},accept:()=>{this.setOptionsPlugins()}})}NodeHaveDiscoveredIp(e){if(this.discoveredInstallOptions.get(e.value.firewallUUID)){if(this.discoveredInstallOptions.get(e.value.firewallUUID).ipobj.address!=null)return!0}else if(this.interfacesIpObjs.get(e.value.firewallUUID))return!0;return!1}onChangePlugins(){let e=[],t,n;this.cluster.id?(t=this.cluster.name,n=this.cluster.plugins):(n=this.formModel.controls.plugins.value,t=this.formModel.controls.name.value);for(let d of Object.values(ht)){let h=St.get(d);e[h]=this.optionsPlugins[d]?"1":"0"}this.formModel.controls.plugins.setValue(parseInt(e.reduce((d,h)=>h+d,""),2));let l=this.fwcUserService.getActualFwcUser().publicKey,o,a,u=[];Object.values(ht).forEach(d=>{if((this.formModel.controls.plugins.value&St.get(d))!==(this.cluster.plugins&St.get(d))){d==ht.iscbind9?o="isc-bind9":d==ht.iscdhcp?o="isc-dhcp":o=d,a=this.optionsPlugins[d];let h,S;this.formModel.controls.plugins.value&St.get(d)?(h=this.translate.instant("CLUSTER.PLUGINS.ENABLE",{plugin:this.translate.instant("CLUSTER.PLUGINS."+d.toUpperCase())}),S=this.translate.instant("CLUSTER.PLUGINS.ENABLE_OK",{plugin:this.translate.instant("CLUSTER.PLUGINS."+d.toUpperCase())})):(h=this.translate.instant("CLUSTER.PLUGINS.DISABLE",{plugin:this.translate.instant("CLUSTER.PLUGINS."+d.toUpperCase())}),S=this.translate.instant("CLUSTER.PLUGINS.DISABLE_OK",{plugin:this.translate.instant("CLUSTER.PLUGINS."+d.toUpperCase())})),this.confirmationService.confirm({header:this.translate.instant("CLUSTER.PLUGINS.HEADER"),message:h,reject:()=>{this.setOptionsPlugins()},accept:()=>le(this,null,function*(){this.loadingData=!0;for(let b=0;b<this.formModel.value.fwnodes.length;b++)if(this.discoveredInstallOptions.get(this.getFormNodes().value[b].firewallUUID)){let T=this.getFormNodes().value[b].install_apikey;T&&(T.startsWith("-")||(this.getFormNodes().value[b].install_apikey=yield this.utilService.openPGPEncrypt(this.getFormNodes().value[b].install_apikey,l))),u.push({firewall:this.getFormNodes().value[b],plugin:o,enable:a,address:this.discoveredInstallOptions.get(this.getFormNodes().value[b].firewallUUID).ipobj.address,persisted:!1})}else{let T=this.formModel.value.fwnodes[b].install_apikey;T&&(T.startsWith("-")||(this.formModel.value.fwnodes[b].install_apikey=yield this.utilService.openPGPEncrypt(this.formModel.value.fwnodes[b].install_apikey,l))),u.push({firewall:this.formModel.value.fwnodes[b],plugin:o,enable:a,address:this.interfacesIpObjs.get(this.formModel.value.fwnodes[b].firewallUUID)?this.interfacesIpObjs.get(this.formModel.value.fwnodes[b].firewallUUID).filter(A=>A.id==this.formModel.value.fwnodes[b].install_ipobj)[0].address:null,persisted:!1})}this.eventsSubscription=this.fwcEventService.getEvent().pipe(oe(()=>this.alive)).subscribe(b=>{if(b.type==Hi.EVENT_PLUGIN_PANEL_CLOSED)if(this.eventsSubscription.unsubscribe(),b.data)this.formModel.controls.plugins.setValue(n),this.setOptionsPlugins();else if(this.formModel.controls.plugins.setValue(this.formModel.controls.plugins.value),this.cluster.id){let A=this.formModel.value;A={cluster:this.cluster.id,name:this.cluster.name,comment:this.cluster.comment,options:this.cluster.options,plugins:this.formModel.controls.plugins.value},delete A.compiler;let N=this.fwcUserService.getActualFwSelectedCloud();A=ot(A),this.utilService.fwcAPICall(this.fwcFirewallService.updateCluster.bind(this.fwcFirewallService),A,N,null).then(j=>{let D=this.formModel.get("fwnodes");for(let Q=0;Q<D.length;Q++){let X=D.at(Q);X.value.plugins=this.formModel.controls.plugins.value,X.markAllAsTouched()}this.updateNodesAsync().then(()=>{this.processInterfacesOperations(this.cluster.id).then(()=>{this.cluster.plugins=this.formModel.controls.plugins.value}).catch(Q=>{this.setOptionsPlugins()})})}).catch(j=>{this.setOptionsPlugins(),this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(j)})})}else this.cluster.plugins=this.formModel.controls.plugins.value});let v={cluster:this.cluster,nodes:u,plugin:o,enable:a};this.itemSelectedService.setClusterToPluginOperation(v),this.loadingData=!1}),icon:"fa fa-question-circle fwcBlue iconBig",rejectVisible:!0,rejectLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.NO"),acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.YES")})}}),this.loadingData=!1}onClusterNodeNameChange(e){this.fwcInterfacesEditor&&this.fwcInterfacesEditor.updateFirewallName(e.get("firewallUUID").value,e.get("name").value)}onClusterNodeInstallCommChange(e){return le(this,null,function*(){if(!e||this.isVyOSCompilerSelected)return;let t=e.get("install_communication").value,n,l=(yield this.utilService.fwcAPICall(this.fwcFirewallService.loadBackEndConfig.bind(this.fwcFirewallService))).data.availablecommunications.includes("ssh");t==="ssh"?n="agent":!l&&t==="agent"?(this.confirmationService.confirm({header:this.translate.instant("GLOBALS.MSG_OP_RESULT.ERROR"),icon:"fa fa-exclamation-circle fwcRed iconBig",message:this.translate.instant("API_ERROR.SSH_FORBIDDEN"),rejectVisible:!1,acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.OK")}),n="agent"):n="ssh",this.setNodeCommunication(e,n)})}onInterfaceChange(e,t,n=null,l=!0){let o=this.formModel.get("fwnodes");if(o&&e>=0&&e<o.length){let a=o.at(e);if(!t)this.interfacesIpObjs.delete(a.get("firewallUUID").value);else{let u=this.interfaces.find(d=>d.id===+t);if(u&&(this.interfacesIpObjs.set(a.get("firewallUUID").value,u.ipobjs),a.get("installInterfaceUUID").setValue(u.interfaceUUID),Array.isArray(u.ipobjs))){let d=u.ipobjs.find(h=>h.id===+n);a.get("install_ipobj").setValue(n),a.get("installIpObjUUID").setValue(d?d.ipObjUUID:null)}}this.onChangeInstallData(e,l)}}onChangeInstallData(e,t=!0){let n=this.formModel.get("fwnodes"),l=n.at(e);if(l){let o=l.value,a,u;this.interfacesIpObjs.get(o.firewallUUID)&&(u=this.interfacesIpObjs.get(o.firewallUUID).find(S=>S.id===+o.install_ipobj)),u&&(a=u.ipObjUUID,l.get("installIpObjUUID").setValue(a));let d=o.installInterfaceUUID,h=o.firewallUUID;if(t){let S=this.getInterfaceAndAddressByUUID(h,d,a);this.fwcInterfacesEditor.updateInstallOptions({firewallUUID:h,interface:S.interfaceInfo,ipobj:S.ipObjInfo})}for(let S=0;S<n.length;S++){let v=n.at(S),b=v.value;S!==e&&b.installInterfaceUUID===d&&b.installIpObjUUID===a&&(v.get("install_interface").setValue(null),v.get("install_ipobj").setValue(null),v.get("installInterfaceUUID").setValue(null),v.get("installIpObjUUID").setValue(null),v.markAsTouched(),t&&this.fwcInterfacesEditor.updateInstallOptions({firewallUUID:b.firewallUUID,interface:null,ipobj:null}),this.interfacesIpObjs.delete(b.firewallUUID))}this.refreshDialog()}}nodeAdd(e){let t=this.formModel.get("fwnodes");if(t){let n=this.createNode();t.push(n);let l=n.get("firewallUUID").value;this.fwcInterfacesEditor&&this.fwcInterfacesEditor.addFirewall({cluster:this.cluster.id,firewall:void 0,firewallUUID:l,firewall_name:"",installOptions:{firewallUUID:l,interface:null,ipobj:null}})}this.recenterDialog();try{this.nodeInputs.last.nativeElement.focus()}catch{}}getNumberOfExistingNodes(){let e=0,t=this.formModel.get("fwnodes");if(t)for(let n=0;n<t.length;n++){let l=t.at(n);l.get("id")&&l.get("id").value&&e++}return e}nodeRemove(e){let t=this.formModel.get("fwnodes"),n=this.getNumberOfExistingNodes();if(!t||t.length<2||e<0||e>=t.length)return;let l=t.at(e).value;if(!(l.id&&n<2)){if(this.cluster.id!==null&&this.cluster.id!==void 0&&l.id!==null&&l.id!==void 0)this.confirmationService.confirm({header:this.translate.instant("GLOBALS.MSG_CONFIRM"),icon:"fa fa-question-circle fwcBlue iconBig",rejectVisible:!0,rejectLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.NO"),acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.YES"),message:this.translate.instant("CLUSTER.MSG_CLUSTER_NODE_DEL",{name:l.name}),accept:()=>{this.loadingData=!0,this.utilService.fwcAPICall(this.fwcFirewallService.deleteClusterNode.bind(this.fwcFirewallService),l.cluster,l.id,this.fwcUserService.getActualFwSelectedCloud()).then(o=>{let a=l.fwmaster,u=l.id,d=l.cluster,h=l.firewallUUID;if(t.removeAt(e),this.interfacesIpObjs.delete(l.firewallUUID),this.discoveredInstallOptions.delete(h),this.recenterDialog(),a){let v=t.at(0);v.get("fwmaster").setValue(1);let b={_fwcFwId:null,fwId:null},T=Object.assign({},this.fwcPolicyService.getActualSelectedPolicy());T&&T._fwcFwId==u&&(T._fwcFwId=T.fwId=v.get("id").value,this.fwcPolicyService.setSelectedPolicy(T))}this.fwcInterfacesEditor&&this.fwcInterfacesEditor.deleteFirewall(h);let S={_fwcObjId:d,_fwcObjType:I.OBJ_CLUSTER,container:Ge.C_FIREWALLS,_fwcTreeAction:Ye.NEW_ITEM};this.itemSelectedService.setModifiedItem(S),this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("CLUSTER.MSG_CLUSTER_NODES.CN_5",{name:l.name})}),this.loadingData=!1}).catch(o=>{o.error&&o.error.restrictions?setTimeout(()=>{this.confirmationService.confirm({icon:"fa fa-exclamation-circle fwcRed iconBig",header:this.translate.instant("CLUSTER.MSG_CLUSTER_NODE_RESTR.RESTR_0"),message:this.translate.instant("CLUSTER.MSG_CLUSTER_NODE_RESTR.RESTR_1"),accept:()=>{console.log("Restrictions")},acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.OK"),rejectVisible:!1})},500):this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(o)}),this.loadingData=!1})}});else{let o=l.firewallUUID;t.removeAt(e),this.interfacesIpObjs.delete(o),this.discoveredInstallOptions.delete(o),this.fwcInterfacesEditor&&this.fwcInterfacesEditor.deleteFirewall(o),this.recenterDialog()}this.nodeNGFW=this.formModel.get("fwnodes")[0]}}onTestFwcAgentCommunication(e){return le(this,null,function*(){let t=+e.get("install_ipobj").value;if(t){let n=e.value,l=this.interfacesIpObjs.get(n.firewallUUID);if(l){let o=l.find(a=>a.id===t);if(o){let a="Error",u="fa fa-exclamation-circle fwcRed iconBig",d=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:this.translate.instant("GLOBALS.ERRORS.COMMUNICATION")});this.loadingData=!0,this.loadingCommunication=!0;let h=this.fwcUserService.getActualFwcUser().publicKey,S={communication:n.install_communication,host:o.address,port:n.install_port};if(n.install_communication==="ssh"){let v=n.install_user,b=n.install_pass;v&&(v=yield this.utilService.openPGPEncrypt(v,h)),b&&(b=yield this.utilService.openPGPEncrypt(b,h)),S.username=v,S.password=b}else{let v=n.install_apikey;v&&(v.startsWith("-")||(v=yield this.utilService.openPGPEncrypt(v,h))),S.protocol=n.install_protocol,S.apikey=v}({msgHeader:a,msgIcon:u,msgMessage:d}=this.pingSubscription(S,a,u,d))}}}else{let n="Error",l="fa fa-exclamation-circle fwcRed iconBig",o=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:this.translate.instant("GLOBALS.ERRORS.COMMUNICATION")});this.loadingData=!0,this.loadingCommunication=!0;let a=this.fwcUserService.getActualFwcUser().publicKey;if(e.value.install_communication=="agent"){let u=e.value.install_apikey;u&&(u.startsWith("-")||(u=yield this.utilService.openPGPEncrypt(u,a)));let d;this.discoveredInstallOptions.get(e.value.firewallUUID)?d=this.discoveredInstallOptions.get(e.value.firewallUUID).ipobj.address:d=null;let h={communication:e.value.install_communication,host:d,port:e.value.install_port,protocol:e.value.install_protocol,apikey:u};({msgHeader:n,msgIcon:l,msgMessage:o}=this.pingSubscription(h,n,l,o))}}})}pingSubscription(e,t,n,l){return this.communicationSubscription=this.utilService.fwcAPICallObservable(this.fwcFirewallService.checkFwCommunication.bind(this.fwcFirewallService),this.fwcUserService.getActualFwSelectedCloud(),e).subscribe({next:()=>{t=this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),n="fa fa-check-circle fwcGreen iconBig",l=this.translate.instant("FW.MSG_FW_EDITION.PING_AGENT_OK"),this.confirmationService.confirm({header:t,icon:n,acceptLabel:"Ok",rejectVisible:!1,message:l}),this.loadingData=!1,this.loadingCommunication=!1},error:o=>le(this,null,function*(){let a;a=this.utilService.isCommunicationError(o.error),a&&(l=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:a})),this.confirmationService.confirm({header:t,icon:n,acceptLabel:"Ok",rejectVisible:!1,message:l}),this.loadingData=!1,this.loadingCommunication=!1})}),{msgHeader:t,msgIcon:n,msgMessage:l}}showClusterInfo(e){return le(this,null,function*(){let t=+e.get("install_ipobj").value;if(this.loadingData=!0,this.loadingCommunication=!0,t){let n=e.value;if(t){let l=this.interfacesIpObjs.get(n.firewallUUID),o=l.find(a=>a.id===t);if(l){let a=this.fwcUserService.getActualFwcUser().publicKey,u={communication:n.install_communication,host:o.address,port:n.install_port};if(n.install_communication!=="ssh"){let d=n.install_apikey;d&&(d=yield this.utilService.openPGPEncrypt(d,a)),u.protocol=n.install_protocol,u.apikey=d}this.communicationSubscription=this.utilService.fwcAPICallObservable(this.fwcFirewallService.getFirewallInformation.bind(this.fwcFirewallService),this.fwcUserService.getActualFwSelectedCloud(),u).subscribe({next:d=>{let h=this.utilService.createDynamicComponentRef(Dn),S=h.instance;S.setDynamicComponentRef(h),S.showFirewallPanel(d.data.data.fwc_agent_version,d.data.data.host_name,d.data.data.system_name,d.data.data.os_version,d.data.data.os_version,d.data.data.kernel_version),this.loadingData=!1,this.loadingCommunication=!1},error:d=>le(this,null,function*(){let h=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:this.translate.instant("GLOBALS.ERRORS.COMMUNICATION")}),S;S=this.utilService.isCommunicationError(d.error),S&&(h=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:S})),this.confirmationService.confirm({header:"Error",icon:"fa fa-exclamation-circle fwcRed iconBig",acceptLabel:"Ok",rejectVisible:!1,message:h}),this.loadingData=!1,this.loadingCommunication=!1})})}}}})}onDiscoverInterfaces(){let e=this.formModel.get("fwnodes");if(!e||!e.controls.some(o=>o.get("name").value)){this.confirmationService.confirm({icon:"fa fa-exclamation-circle fwcRed iconBig",header:this.translate.instant("CLUSTER.MSG_CLUSTER_NO_NODES.HEADER"),message:this.translate.instant("CLUSTER.MSG_CLUSTER_NO_NODES.TEXT"),accept:()=>{this.shownPanel=0},rejectVisible:!1,acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.OK")});return}let t=[],n=!1;e.controls.forEach((o,a)=>{o.get("name").value&&(t.push({id:a,text:o.get("name").value,default:!n}),n=!0)});let l={header:this.translate.instant("CLUSTER.MSG_NODE_SELECT.HEADER"),helpText:this.translate.instant("CLUSTER.MSG_NODE_SELECT.TEXT"),modal:!0,formControls:[{name:"nodeId",label:this.translate.instant("CLUSTER.MSG_CLUSTER_EDITION.NODE_NAME"),type:"select",options:t,required:!0}],onAccept:o=>{o&&this.nodeAutoDiscoverInterfaces(o.nodeId)}};this.inputDataService.setInputData(l)}nodeAutoDiscoverInterfaces(e,t){let n=this.formModel.get("fwnodes");if(!n||e<0||e>=n.length||!this.interfacesIpObjs)return;let l=n.at(e).value,o="",a=this.interfacesIpObjs.get(l.firewallUUID),u=l.install_ipobj,d=l.install_communication||"agent";if(u){let S=a.find(v=>v.id===u);S&&(o=S.address)}let h={header:this.translate.instant("COMPILE.INST_SSH_GEN"),helpText:this.translate.instant("IF_EDITOR.TREE.INST_SSH_TEXT"),modal:!0,isSSHPanel:!0,formControls:[{name:"nodeId",value:e,type:"hidden"},{name:"install_communication",value:d,type:"hidden"},{name:"name",label:this.translate.instant("CLUSTER.MSG_CLUSTER_EDITION.NODE_NAME"),type:"text",readonly:!0,halfSized:!0,value:l.name},{name:"firewallUUID",type:"hidden",value:l.firewallUUID},{name:"role",label:this.translate.instant("CLUSTER.MSG_CLUSTER_EDITION.ROLE"),type:"select",halfSized:!0,options:[{id:null,text:this.translate.instant("CLUSTER.CLUSTER_NODE_ROLES.NO_ROLE"),default:!0},{id:"M",text:this.translate.instant("CLUSTER.CLUSTER_NODE_ROLES.MASTER")},{id:"S",text:this.translate.instant("CLUSTER.CLUSTER_NODE_ROLES.SLAVE")},{id:"N",text:this.translate.instant("CLUSTER.CLUSTER_NODE_ROLES.NODE")}],value:t?t.role:null},{name:"address",label:this.translate.instant("ITEM_PANEL.FIELDS.ADDRESS"),regexp:Fe.ipV4Regexp,type:"text",required:!0,value:t?t.address:o,setFocus:!0},{name:"",label:"",type:"separator"},{name:"install_port",label:this.translate.instant("CLUSTER.MSG_CLUSTER_EDITION.PORT"),regexp:Fe.portRegexp,type:"number",required:!0,value:t?t.install_port:l.install_port},{name:"",label:"",type:"separator"}],onAccept:this.doDiscoverInterfaces.bind(this)};d==="ssh"?h.formControls.push({name:"install_user",label:this.translate.instant("CLUSTER.MSG_CLUSTER_EDITION.SSH_USER"),type:"text",required:!0,value:t?t.install_user:l.install_user},{name:"",label:"",type:"separator"},{name:"install_pass",label:this.translate.instant("CLUSTER.MSG_CLUSTER_EDITION.SSH_PASS"),type:"password",required:!0,value:t?t.install_pass:l.install_pass}):h.formControls.push({name:"install_protocol",label:this.translate.instant("FW.MSG_FW_EDITION.AGENT_PROTOCOL"),type:"select",required:!0,value:t?t.install_protocol:l.install_protocol,options:[{id:"https",text:"HTTPS"},{id:"http",text:"HTTP"}]},{name:"",label:"",type:"separator"},{name:"install_apikey",label:this.translate.instant("FW.MSG_FW_EDITION.AGENT_APIKEY"),type:"password",required:!0,value:t?t.install_apikey:l.install_apikey}),this.inputDataService.setInputData(h)}doDiscoverInterfaces(e){return le(this,null,function*(){if(e){let t=this.fwcUserService.getActualFwcUser().publicKey,n={fwcloud:this.fwcUserService.getActualFwSelectedCloud(),ip:e.address,port:+e.install_port,communication:e.install_communication};if(e.install_communication==="ssh"){let d=e.install_user,h=e.install_pass;d&&(d=yield this.utilService.openPGPEncrypt(d,t)),h&&(h=yield this.utilService.openPGPEncrypt(h,t)),n.sshuser=d,n.sshpass=h}else{let d=e.install_apikey;d&&(d.startsWith("-")||(d=yield this.utilService.openPGPEncrypt(d,t))),n.apikey=d,n.protocol=e.install_protocol}let l=[],o=this.formModel.get("fwnodes"),a;for(let d=0;d<o.length;d++){let h=o.at(d),S=h.value,v;if(this.discoveredInstallOptions){let T=this.discoveredInstallOptions.get(S.firewallUUID);T&&T.ipobj&&(v=T.ipobj.address)}S.firewallUUID&&S.firewallUUID===e.firewallUUID&&(a=h,v=e.address);let b=this.getInterfaceAndAddressByUUID(S.firewallUUID,S.installInterfaceUUID,S.installIpObjUUID);l.push({firewallUUID:S.firewallUUID,firewall_name:S.name,firewall:S.id,cluster:S.cluster,installOptions:{firewallUUID:S.firewallUUID,interface:b.interfaceInfo,ipobj:b.ipObjInfo}})}if(!a)return;e.install_communication==="ssh"?a.get("install_user").value!==e.install_user&&(a.get("install_user").setValue(e.install_user),a.markAsDirty()):(a.get("install_protocol").value!==e.install_protocol&&(a.get("install_protocol").setValue(e.install_protocol),a.markAsDirty()),a.get("install_apikey").value!==e.install_apikey&&(a.get("install_apikey").setValue(e.install_apikey),a.markAsDirty()));let u=e.role;u==="N"&&(u=a.get("name").value),this.loadingData=!0,this.loadingCommunication=!0,this.communicationSubscription=this.utilService.fwcAPICallObservable(this.fwcFirewallService.autoDiscoverInterfaces.bind(this.fwcFirewallService),n).subscribe({next:d=>{if(Array.isArray(d.data)){let h=d.data;Array.isArray(h)&&h.length&&(u&&(h=h.map(S=>(S.suffixToAdd=u,S))),this.interfacesEditorOptions={isCluster:!0,firewalls:l,discoveredFirewallUUID:a.get("firewallUUID").value,discoveredAddress:e.address,discoveredIfs:h,existingIfs:this.interfaces},this.formModel.markAsDirty(),this.shownPanel=1,this.recenterDialog())}this.loadingData=!1,this.loadingCommunication=!1},error:d=>le(this,null,function*(){if(d.error.fwcErr==9e3)this.confirmationService.confirm({header:this.translate.instant("GLOBALS.MSG_OP_RESULT.ERROR"),icon:"fa fa-exclamation-circle fwcRed iconBig",message:this.translate.instant("API_ERROR.SSH_FORBIDDEN"),rejectVisible:!1,acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.OK")});else{let h;d&&(h=this.utilService.isCommunicationError(d.error)),this.confirmationService.confirm({header:"Error",icon:"fa fa-exclamation-circle fwcRed iconBig",acceptLabel:"Ok",rejectVisible:!1,message:this.translate.instant("FW.MSG_FW_EDITION.ERROR_DISCOVER")+(h?":<br/>"+h:""),accept:()=>{if(h)return this.nodeAutoDiscoverInterfaces(e.nodeId,e)}})}this.loadingData=!1,this.loadingCommunication=!1})})}})}onEditorInstallModified(e){if(e){let t=this.formModel.get("fwnodes"),n,l;for(let o=0;o<t.length;o++){let a=t.at(o),u=a.value;e.interface&&u.installInterfaceUUID===e.interface.interfaceUUID&&e.ipobj&&u.installIpObjUUID===e.ipobj.ipObjUUID&&(a.get("install_interface").setValue(null),a.get("install_ipobj").setValue(null),a.get("installInterfaceUUID").setValue(null),a.get("installIpObjUUID").setValue(null),this.discoveredInstallOptions.delete(u.firewallUUID),this.onInterfaceChange(o,null,null,!1),a.markAsTouched(),this.interfacesIpObjs.delete(a.get("firewallUUID").value)),u.firewallUUID&&u.firewallUUID===e.firewallUUID&&(n=a,l=o)}if(n){if(!e.interface&&!e.ipobj)n.get("install_interface").setValue(null),n.get("install_ipobj").setValue(null),n.get("installInterfaceUUID").setValue(null),n.get("installIpObjUUID").setValue(null),this.discoveredInstallOptions.delete(e.firewallUUID);else{let o=e.interface.id,a=e.ipobj.id;if(o&&a)this.discoveredInstallOptions.delete(e.firewallUUID),n.get("install_interface").setValue(o),n.get("install_ipobj").setValue(a),n.get("installInterfaceUUID").setValue(e.interface.interfaceUUID),n.get("installIpObjUUID").setValue(e.ipobj.ipObjUUID),this.onInterfaceChange(l,o,a,!1);else{let u={interface:e.interface,ipobj:e.ipobj};this.discoveredInstallOptions.set(e.firewallUUID,u)}}n.markAsTouched(),this.formModel.markAsDirty()}}}onEditorInterfaceOrIpModified(e){e&&e.installFirewallUUIDs&&e.installFirewallUUIDs.forEach(t=>{if(e.id&&Array.isArray(this.interfaces)){let n=!1;for(let l=0;l<this.interfaces.length&&!n;l++){let o=this.interfaces[l];if(e.id===o.id&&e.type===o.type&&(o.name=e.name,n=!0),Array.isArray(o.ipobjs))for(let a=0;a<o.ipobjs.length&&!n;a++){let u=o.ipobjs[a];e.id===u.id&&e.type===u.type&&(u.name=e.name,u.address=e.address,n=!0)}}}else if(this.discoveredInstallOptions){let n=this.discoveredInstallOptions.get(t);n&&(e.type===I.OBJ_INTERFACE_FIREWALL?n.interface.name=e.name:(n.ipobj.name=e.name,n.ipobj.address=e.address))}this.formModel.markAsDirty()})}changeCompilerOptions(){let e=this.formModel.get("compiler").value,t=this.formModel.get("options").value,n=e<<12,l=t&4095;this.formModel.get("options").setValue(n|l),this.updateCompilerState()}updateCompilerState(){if(!this.formModel){this.isVyOSCompilerSelected=!1,this.wasVyOSCompilerSelected=!1,this.lastCommunicationBeforeVyOSByNode.clear();return}let e=this.formModel.get("compiler"),n=(typeof e?.value=="number"?e.value:Number(e?.value))===t_,l=this.getFormNodes();l&&l.controls.forEach((o,a)=>{let u=o,d=this.getNodeIdentifier(u,a),h=u.get("install_communication")?.value;if(n)!this.wasVyOSCompilerSelected&&h&&h!=="ssh"&&this.lastCommunicationBeforeVyOSByNode.set(d,h),this.setNodeCommunication(u,"ssh");else{let S=this.wasVyOSCompilerSelected&&this.lastCommunicationBeforeVyOSByNode.has(d)?this.lastCommunicationBeforeVyOSByNode.get(d):h;this.setNodeCommunication(u,S),this.lastCommunicationBeforeVyOSByNode.delete(d)}}),n||this.lastCommunicationBeforeVyOSByNode.clear(),this.isVyOSCompilerSelected=n,this.wasVyOSCompilerSelected=n}getNodeIdentifier(e,t){return e.get("firewallUUID")?.value||e.get("id")?.value?.toString()||t.toString()}setNodeCommunication(e,t){if(!e)return;let n=e.get("install_communication");if(!n)return;let l=t||n.value||"ssh",o=n.value!==l;o&&n.setValue(l);let a=e.get("install_protocol"),u=e.get("install_apikey"),d=e.get("install_port");l==="agent"?(a.setValidators([ee.required]),(o||!d.value)&&d.setValue(33033)):(a.clearValidators(),u.clearValidators(),(o||!d.value)&&d.setValue(22)),a.updateValueAndValidity(),u.updateValueAndValidity()}checkClusterRestrictions(e){e&&(this.loadingData=!0,this.clusterToDelete=e,this.dependencies=null,this.deleteMsgError=null,this.delMessage={type:"loading",title:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.CHECKING_HEAD"),text:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.CHECKING_TEXT")},this.okToDelete=!1,this.fwcFirewallService.getClusterMasterNode(e.id_obj,this.fwcUserService.getActualFwSelectedCloud()).subscribe(t=>{t.error?(this.deleteMsgError={type:"error",title:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.ERROR_RES_HEAD"),text:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.ERROR_RES_TEXT",{error:this.fwcErrorPipe.transform(t.error)})},this.dependencies={restrictionsError:!0},this.loadingData=!1):(e.masterFwId=t.data.id,this.fwcFirewallService.checkClusterRestrictions(e.masterFwId,this.fwcUserService.getActualFwSelectedCloud()).subscribe(n=>{this.deleteMsgError={type:"warning",title:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.DEL_2"),text:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.DEL_3",{name:e._fwcObjName})},this.dependencies=null,this.loadingData=!1,this.recenterDialog()},n=>{if(n.error&&n.error.restrictions)try{this.dependencies=n.error.restrictions,this.dependencies._fwcRestrictedObject={_fwcObjId:e.masterFwId,_fwcObjType:I.OBJ_CLUSTER},this.deleteMsgError={type:"error",title:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.DEL_0"),text:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.DEL_1",{name:e._fwcObjName})}}catch(l){this.dependencies={restrictionsError:!0},this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:l})}else this.deleteMsgError={type:"error",title:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.ERROR_RES_HEAD"),text:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.ERROR_DEL_TEXT",{error:this.fwcErrorPipe.transform(n)})},this.dependencies={restrictionsError:!0};this.loadingData=!1,this.recenterDialog()}))},t=>{this.loadingData=!1,this.deleteMsgError={type:"error",title:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.ERROR_RES_HEAD"),text:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.ERROR_RES_TEXT",{error:this.fwcErrorPipe.transform(t)})},this.dependencies={restrictionsError:!0},this.recenterDialog()}))}onShowDialog(){this.itemSelectedService.getActualItem().ngfw?this.shownPanel=4:this.itemSelectedService.getActualItem().plugins?this.shownPanel=3:(this.shownPanel=0,setTimeout(()=>{this.inputClusterName&&this.inputClusterName.nativeElement.focus()},150));let e=this.itemSelectedService.getActualItem();delete e.ngfw,delete e.plugins}onChangeTab(e){this.fwcInterfacesEditor&&this.fwcInterfacesEditor.hideFirewallSelector(),this.shownPanel=e.index}onHideDialog(){}onCancel(e){!e&&this.formModel&&!this.formModel.pristine&&this.formModel.valid?this.confirmationService.confirm({header:this.translate.instant("GLOBALS.MSG_CONFIRM"),icon:"fa fa-question-circle fwcBlue iconBig",message:this.translate.instant("CLUSTER.MSG_CLUSTER_CONFIRM"),accept:()=>{this.onCancel(!0)},rejectVisible:!0,rejectLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.NO"),acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.YES")}):(this.hideDialog(),this.resetProperties()),this.shownPanel=0}checkForm(e){e&&e.target&&e.target.type!="textarea"&&this.formModel.valid&&(e.target.blur(),this.onSave())}onSave(e=!1){return le(this,null,function*(){if(!e&&this.fwcInterfacesEditor&&!this.fwcInterfacesEditor.isThereAnySelectedNode()){this.confirmationService.confirm({header:this.translate.instant("IF_EDITOR.TREE.MSG_NO_SELECTED.TITLE"),icon:"fa fa-question-circle fwcBlue iconBig",message:this.translate.instant("IF_EDITOR.TREE.MSG_NO_SELECTED.TEXT",{obj_name:this.translate.instant("GLOBALS.MSG_OBJ_TYPES.CLUSTER").toLowerCase()}),accept:()=>{this.onSave(!0)},rejectVisible:!0,rejectLabel:"No",acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.YES")});return}let t,n;this.formModel.get("fwnodes").at(0).get("fwmaster").setValue(1);let o=ot(this.cluster),a=this.formModel.value;this.cluster.id===null||this.cluster.id===void 0?(t=this.fwcFirewallService.newCluster.bind(this.fwcFirewallService),n=this.translate.instant("CLUSTER.MSG_CLUSTER_NEW")):(t=this.fwcFirewallService.updateCluster.bind(this.fwcFirewallService),n=this.translate.instant("CLUSTER.MSG_CLUSTER_UPDATE_1",{name:this.cluster.name}),a={cluster:o.id,name:a.name,comment:a.comment,options:a.options,plugins:a.plugins}),delete a.compiler;let u=this.fwcUserService.getActualFwSelectedCloud(),d=a.node_id;if(delete a.node_id,a=ot(a),Array.isArray(a.fwnodes)){let h=this.fwcUserService.getActualFwcUser().publicKey;a.fwnodes=a.fwnodes.splice(0);for(let S=0;S<a.fwnodes.length;S++){let v=a.fwnodes[S];delete v.firewallUUID,delete v.installInterfaceUUID,delete v.installIpObjUUID;let b=v.install_user,T=v.install_pass;b&&(b=yield this.utilService.openPGPEncrypt(b,h)),T&&(T=yield this.utilService.openPGPEncrypt(T,h)),v.install_user=b,v.install_pass=T,v.install_apikey?v.install_apikey.startsWith("-")||(v.install_apikey=yield this.utilService.openPGPEncrypt(v.install_apikey,h)):v.install_apikey=null}}this.loadingData=!0,this.utilService.fwcAPICall(t,a,u,d).then(h=>{if(o._fwcObjType=I.OBJ_CLUSTER,o.container=Ge.C_FIREWALLS,o._fwcTreeAction=Ye.NEW_ITEM,this.cluster.id===null||this.cluster.id===void 0){let S=h.data.insertId;o.id=o.id_obj=o._fwcObjId=S,this.processInterfacesOperations(S,h.data).then(v=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:n})}).catch(v=>{this.confirmationService.confirm({icon:"fa fa-exclamation-circle fwcRed iconBig",header:this.translate.instant("CLUSTER.MSG_CLUSTER_BATCH.ERR_CREATING_IFS"),message:v.message,accept:()=>{},acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.OK"),rejectVisible:!1})}).finally(()=>{this.itemSelectedService.setModifiedItem(o),this.hideDialog(),this.resetProperties(),this.loadingData=!1})}else this.updateNodesAsync().then(S=>{o.id=o.id_obj=o._fwcObjId=this.cluster.id,o._fwcTreeAction=Ye.NEW_ITEM,o.container=Ge.C_FIREWALLS,this.processInterfacesOperations(o.id).then(v=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:n})}).catch(v=>{this.confirmationService.confirm({icon:"fa fa-exclamation-circle fwcRed iconBig",header:this.translate.instant("CLUSTER.MSG_CLUSTER_BATCH.ERR_CREATING_IFS"),message:v.message,accept:()=>{},acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.OK"),rejectVisible:!1})}).finally(()=>{this.itemSelectedService.setModifiedItem(o);let v=this.fwcPolicyService.getActualSelectedPolicy();v._fwcFwId!==null&&v._fwcFwId!==void 0&&(v._fwcClusterId==o.id&&(v._fwcFwName=o.name,v._dontLocateInTree=!0),this.fwcPolicyService.setSelectedPolicy(v),this.fwcPolicyService.reloadPolicy()),this.hideDialog(),this.resetProperties(),this.loadingData=!1})},S=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:this.translate.instant("CLUSTER.MSG_CLUSTER_UPDATE_ERR"),detail:S}),this.loadingData=!1})}).catch(h=>{h.status==400&&h.error.fwcErr==8002?(this.confirmationService.confirm({header:this.translate.instant("GLOBALS.MSG_OP_RESULT.ERROR"),icon:"fa fa-exclamation-circle fwcRed iconBig",message:this.translate.instant("API_ERROR."+h.error.fwcErr),rejectVisible:!1,acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.OK"),accept:()=>{}}),this.loadingData=!1):h.status==400&&h.error.fwcErr==8003?(this.confirmationService.confirm({header:this.translate.instant("GLOBALS.MSG_OP_RESULT.ERROR"),icon:"fa fa-exclamation-circle fwcRed iconBig",message:this.translate.instant("API_ERROR."+h.error.fwcErr),rejectVisible:!1,acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.OK"),accept:()=>{}}),this.loadingData=!1):(this.loadingData=!1,this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(h)}))})})}processInterfacesOperations(e,t){return new Promise((n,l)=>le(this,null,function*(){try{if(this.fwcInterfacesEditor&&this.fwcInterfacesEditor.areTherePendingOperations()){let o=this.fwcInterfacesEditor.getSelectedTreeNodes();t&&t.loData&&this.fwcInterfacesEditor.setNewLoIds(t);let[a,u]=yield Promise.all([this.utilService.fwcAPICall(this.fwcFirewallService.getCluster.bind(this.fwcFirewallService),e,this.fwcUserService.getActualFwSelectedCloud()),this.utilService.fwcAPICall(this.fwcObjectTreeService.getTree.bind(this.fwcObjectTreeService),this.appOptionsService.optionsTreeFw,this.fwcUserService.getActualFwSelectedCloud())]),d=a.data,h;if(d&&Array.isArray(d.nodes)&&(h=d.nodes),!h||!h.length)return l(new Error(this.translate.instant("CLUSTER.MSG_CLUSTER_BATCH.ERR_EMPTY_CLUSTER")));let S=this.formModel.get("fwnodes").value,v,b=this.fwcUserService.getActualFwcUser().publicKey;for(let j=0;j<h.length;j++){let D=h[j],Q=S.find(X=>X.name===D.name);if(Q){D.firewallUUID=Q.firewallUUID;let X=Q.install_user,re=Q.install_pass,ne=Q.install_apikey;X&&(D.install_user=yield this.utilService.openPGPEncrypt(X,b)),re&&(D.install_pass=yield this.utilService.openPGPEncrypt(re,b)),ne&&(ne.startsWith("-")?D.install_apikey=ne:D.install_apikey=yield this.utilService.openPGPEncrypt(ne,b))}else return l(new Error(this.translate.instant("CLUSTER.MSG_CLUSTER_BATCH.ERR_MISSING_NODE")));D.fwmaster&&(v=D.id),D.plugins=this.formModel.controls.plugins.value}let T=u.data,A=[];A.push(T);let N=this.fwcObjectTreeService.getNodesFull(A,q.OBJ_CLUSTER,e);if(N&&Array.isArray(N.items)){let j=N.items.find(D=>D.node_type===q.FOLDER_INTERFACES);if(j){let D={parentObject:{fwcloud:this.fwcUserService.getActualFwSelectedCloud(),name:N.text,type:I.OBJ_FIREWALL,id:v,id_node:j.id},objectTreeNodes:o,onClose:X=>le(this,null,function*(){let re=!1,ne=new Map;if(X.forEach(ae=>{if(ae.operationStatus===Vi.SUCCESS&&ae.operationResult&&ae.object.installFirewallUUIDs){let ze;ae.object.type===I.OBJ_INTERFACE_FIREWALL?ze={install_interface:ae.operationResult.insertId}:ae.object.type===I.OBJ_ADDRESS&&(ze={install_ipobj:ae.operationResult.insertId}),ae.object.installFirewallUUIDs&&ae.object.installFirewallUUIDs.forEach(Dt=>{let at=ne.get(Dt);ze=Lt(Lt({},at),ze),ne.set(Dt,ze)})}ae.operationStatus===Vi.ERROR&&(re=!0)}),re)return l(new Error(this.translate.instant("CLUSTER.MSG_CLUSTER_BATCH.ERR_IFS_OPERATIONS")));{let ae;if(ne.size)for(let[ze,Dt]of ne){let at=h.find(st=>st.firewallUUID===ze);if(at){ae=new An(at),ae.fwcloud=this.fwcUserService.getActualFwSelectedCloud(),ae.firewall=at.id,ae.install_interface=Dt.install_interface,ae.install_ipobj=Dt.install_ipobj;try{let st=ae.getValue(),rn=yield this.utilService.fwcAPICall(this.fwcFirewallService.updateFirewall.bind(this.fwcFirewallService),st)}catch{return l(new Error(this.translate.instant("CLUSTER.MSG_CLUSTER_BATCH.ERR_UPDATING_INST",{name:at.name})))}}else return l(new Error(this.translate.instant("CLUSTER.MSG_CLUSTER_BATCH.ERR_UPDATING_INST_MISSING")))}}n()})},Q={uuid:Z.ITEM_BATCH_MANAGER,data:D};this.appDialogPanelsService.searchAndShowDialog(Q)}else return l(new Error(this.translate.instant("CLUSTER.MSG_CLUSTER_BATCH.ERR_NO_IFS_NODE")))}else return l(new Error(this.translate.instant("CLUSTER.MSG_CLUSTER_BATCH.ERR_MISSING_CLUSTER_NODE")))}else n()}catch{l(new Error(this.translate.instant("CLUSTER.MSG_CLUSTER_BATCH.ERR_UNKNOWN")))}}))}updateOrSaveNode(e){let t,n="";return new Promise((o,a)=>{let u=Object.assign({},e),d;u.options=this.formModel.controls.options.value,u.plugins=this.formModel.controls.plugins.value,e.id===null||e.id===void 0?(u.node_id=this.cluster.nodesParentId,t=this.translate.instant("CLUSTER.MSG_CLUSTER_NODES.CN_0"),d=this.fwcFirewallService.newFirewall.bind(this.fwcFirewallService)):(u.firewall=u.id,delete u.id,t=this.translate.instant("CLUSTER.MSG_CLUSTER_NODES.CN_1"),d=this.fwcFirewallService.updateFirewall.bind(this.fwcFirewallService)),u.fwcloud=this.fwcUserService.getActualFwSelectedCloud(),u.install_interface=+u.install_interface||u.install_interface,u.install_ipobj=+u.install_ipobj||u.install_ipobj,delete u.firewallUUID,delete u.installInterfaceUUID,delete u.installIpObjUUID,u.install_communication==="ssh"?(u.install_protocol=null,u.install_apikey=null):(delete u.install_user,delete u.install_pass),this.utilService.fwcAPICall(d,u).then(h=>{n=this.translate.instant("CLUSTER.MSG_CLUSTER_NODES.CN_3",{name:e.name}),h.response=n,o(h)}).catch(h=>{if(h.status==400&&h.error.fwcErr==8003)this.confirmationService.confirm({header:this.translate.instant("GLOBALS.MSG_OP_RESULT.ERROR"),icon:"fa fa-exclamation-circle fwcRed iconBig",message:this.translate.instant("API_ERROR."+h.error.fwcErr),rejectVisible:!1,acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.OK"),accept:()=>{}}),this.loadingData=!1;else{let S="";S=this.fwcErrorPipe.transform(h),n=this.translate.instant("CLUSTER.MSG_CLUSTER_NODES.CN_2",{action:t,name:e.name,err_code:"",err_msg:S}),h.error=S,a(h)}})})}updateNodesAsync(){return new Promise((t,n)=>le(this,null,function*(){let l={opResult:!0,opResults:[]},o=this.formModel.get("fwnodes"),a=this.fwcUserService.getActualFwcUser().publicKey;for(let u=0;u<o.length;u++){let d=o.at(u);if(d.touched){let h=d.value,S=d.get("install_user").value,v=d.get("install_pass").value,b=d.get("install_apikey").value;S&&(h.install_user=yield this.utilService.openPGPEncrypt(S,a)),v&&(h.install_pass=yield this.utilService.openPGPEncrypt(v,a)),b&&(b.startsWith("-")?h.install_apikey=b:h.install_apikey=yield this.utilService.openPGPEncrypt(b,a)),yield this.updateOrSaveNode(h).then(T=>{l.opResults.push(T)},T=>(l.opResult=!1,l.opResults.push(T),n(l)))}}t(l)}))}onDeleteCluster(){this.okToDelete&&this.clusterToDelete&&(this.loadingData=!0,this.deleteMsgError=null,this.delMessage={type:"loading",title:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.DELETING_HEAD"),text:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.DELETING_TEXT")},this.utilService.fwcAPICall(this.fwcFirewallService.deleteCluster.bind(this.fwcFirewallService),this.clusterToDelete.id_obj,this.fwcUserService.getActualFwSelectedCloud()).then(e=>{let t=this.clusterToDelete,n={_fwcFwId:null,fwId:null},l=this.fwcPolicyService.getActualSelectedPolicy();this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.DEL_4")}),t._fwcTreeAction=Ye.DELETE_ITEM,this.itemSelectedService.setModifiedItem(t),this.itemSelectedService.setModifiedItem({_fwcTreeAction:Ye.RELOAD_TREE,containerToReload:Ge.C_OBJECTS}),l&&l._fwcClusterId==this.clusterToDelete.id_obj&&this.fwcPolicyService.setSelectedPolicy(n),this.loadingData=!1,this.hideDialog(),this.resetProperties()}).catch(e=>{this.deleteMsgError={type:"error",title:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.ERROR_RES_HEAD"),text:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.ERROR_RES_TEXT",{error:this.fwcErrorPipe.transform(e)})},this.dependencies={restrictionsError:!0},this.loadingData=!1}))}setNode(e){let t=e.split(",");t[0]!=""?this.fwcFirewallService.getFirewall(+t[0],this.fwcUserService.getActualFwSelectedCloud()).subscribe(n=>{this.nodeNGFW=n.data}):this.nodeNGFW=this.getFormNodes().value.find(n=>n.name===t[1])}checksNtopNGActive(){return!!(this.cluster.plugins&St.get(ht.ntopng))}checksNodeNtopNGConfig(){let e=this.formModel.controls.fwnodes.value;if(this.nodeNGFW&&e.find(n=>n.name===this.nodeNGFW.name)){let n=e.find(l=>l.name===this.nodeNGFW.name);if(this.nodeNGFW=n,n.install_ipobj)return n.install_ipobj&&!!(this.nodeNGFW.plugins&St.get(ht.ntopng));if(this.discoveredInstallOptions.get(n.firewallUUID))return this.checksNtopNGActive()}let t=this.nodeNGFW?this.nodeNGFW.firewallUUID:e[0]?e[0].firewallUUID:void 0;return t&&this.discoveredInstallOptions.get(t)?(this.nodeNGFW=e.find(n=>n.firewallUUID===t),this.checksNtopNGActive()):!1}checksWebSafetyProxyActie(){return!!(this.cluster.plugins&St.get(ht.websafety))}checksNodeWebSafetyProxyActie(){let e=this.formModel.controls.fwnodes.value;if(this.nodeNGFW&&e.find(n=>n.name===this.nodeNGFW.name)){let n=e.find(l=>l.name===this.nodeNGFW.name);if(this.nodeNGFW=n,n.install_ipobj)return n.install_ipobj&&!!(this.nodeNGFW.plugins&St.get(ht.websafety));if(this.discoveredInstallOptions.get(n.firewallUUID))return this.checksWebSafetyProxyActie()}let t=this.nodeNGFW?this.nodeNGFW.firewallUUID:e[0]?e[0].firewallUUID:void 0;return t&&this.discoveredInstallOptions.get(t)?(this.nodeNGFW=e.find(n=>n.firewallUUID===t),this.checksWebSafetyProxyActie()):!1}checksDNSSafetyActive(){return!!(this.cluster.plugins&St.get(ht.dnssafety))}checksNodeDNSSafetyActive(){let e=this.formModel.controls.fwnodes.value;if(this.nodeNGFW&&e.find(n=>n.name===this.nodeNGFW.name)){let n=e.find(l=>l.name===this.nodeNGFW.name);if(this.nodeNGFW=n,n.install_ipobj)return n.install_ipobj&&!!(this.nodeNGFW.plugins&St.get(ht.dnssafety));if(this.discoveredInstallOptions.get(n.firewallUUID))return this.checksDNSSafetyActive()}let t=this.nodeNGFW?this.nodeNGFW.firewallUUID:e[0]?e[0].firewallUUID:void 0;return t&&this.discoveredInstallOptions.get(t)?(this.nodeNGFW=e.find(n=>n.firewallUUID===t),this.checksDNSSafetyActive()):!1}checksElasticSearchActive(){return!!(this.cluster.plugins&St.get(ht.elasticsearch))}checksNodeElasticSearchActive(){let e=this.formModel.controls.fwnodes.value;if(this.nodeNGFW&&e.find(n=>n.name===this.nodeNGFW.name)){let n=e.find(l=>l.name===this.nodeNGFW.name);if(this.nodeNGFW=n,n.install_ipobj)return n.install_ipobj&&!!(this.nodeNGFW.plugins&St.get(ht.elasticsearch));if(this.discoveredInstallOptions.get(n.firewallUUID))return this.checksElasticSearchActive()}let t=this.nodeNGFW?this.nodeNGFW.firewallUUID:e[0]?e[0].firewallUUID:void 0;return t&&this.discoveredInstallOptions.get(t)?(this.nodeNGFW=e.find(n=>n.firewallUUID===t),this.checksElasticSearchActive()):!1}onClickButtonNGFW(e,t){let n,l=this.discoveredInstallOptions.get(this.getFormNodes().value.find(o=>o.name===this.nodeNGFW.name).firewallUUID)?this.discoveredInstallOptions.get(this.getFormNodes().value.find(o=>o.name===this.nodeNGFW.name).firewallUUID).ipobj.address:this.interfacesIpObjs.get(this.getFormNodes().value.find(o=>o.name===this.nodeNGFW.name).firewallUUID).filter(o=>o.id==this.getFormNodes().value.find(a=>a.name===this.nodeNGFW.name).install_ipobj)[0].address;switch(e){case"NTOPNG":n="http://"+l+":3000";break;case"WEBSAFETYPROXY":n="https://"+l+":8095";break;case"DNSSAFETY":n="https://"+l+":8096";break;case"ELASTICSEARCH":n="http://"+l+":5601";break}try{window.open(n)}catch(o){this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(o)})}}onCloseDialog(){this.communicationSubscription&&(this.communicationSubscription.unsubscribe(),this.communicationSubscription=null,this.loadingData=!1,this.loadingCommunication=!1)}};s.\u0275fac=function(t){return new(t||s)(L(ge),L(He),L(fe),L($e),L(Le),L(hn),L(Ot),L(ye),L(pi),L(be),L(kt),L(Ee),L(me),L(xt),L(we),L(ue),L(Se),L(Ut))},s.\u0275cmp=je({type:s,selectors:[["sts-fwc-cluster-panel"]],viewQuery:function(t,n){if(t&1&&(_e(Vp,5),_e(Wp,5),_e(Hp,5)),t&2){let l;se(l=ce())&&(n.inputClusterName=l.first),se(l=ce())&&(n.fwcInterfacesEditor=l.first),se(l=ce())&&(n.nodeInputs=l)}},standalone:!1,features:[Ve([fe,hn,$e]),ct],decls:8,vars:6,consts:[["clusterDialog",""],["header",""],["footer",""],["inputClusterName",""],["ddCompiler",""],["nodeInput",""],["fwcInterfacesEditor",""],["styleClass","dlgFwcDialog dlgFwcDialog--cluster",3,"visibleChange","onShow","onHide","visible","modal","closable","resizable"],["id","clusterData",1,"fwcFirewallPanel",3,"formGroup"],[1,"divFormHeader"],[1,"divHeaderButtons"],["type","button","icon","fa fa-question",3,"disabled"],["type","button","styleClass","p-button-secondary","icon","fa fa-window-minimize",3,"onClick","disabled"],[1,"fwcWhite","fwcIconLeft"],[1,"fwcMenuIcon","fwci-cluster","fwcOrange"],[1,"fwcMenuIcon","fwci-delete","fwcOrange"],["type","button","icon","fa fa-question",3,"onClick","disabled"],["id","clusterData",1,"fwcFirewallPanel",3,"keyup.enter","keyup.esc","formGroup"],[3,"disabled"],[1,"first-tabview","tabTabbedMenu","flex","flex-col","w-full","bg-(--surfaceBackgroundColor)"],[1,"flex","flex-wrap","fwc-tabbar"],["type","button",1,"fwc-tab-button",3,"click","disabled"],[1,"fwcMenuIcon","fwci-interfaces","fwcOrange"],[1,"fwcMenuIcon","fwci-config","fwcOrange"],[1,"fa","fa-puzzle-piece","fwcOrange"],[1,"fa","fa-n","fwcOrange"],[1,"fwc-cluster-panel-section"],[4,"ngIf"],[1,"grid"],[1,"col-12"],[1,"noVertPad","fwcBlue","botBorder"],[1,"col-6"],[1,"p-inputgroup"],["for","name"],["type","text","maxlength","64","pInputText","","formControlName","name","name","name",3,"placeholder"],[1,"fwc-error",3,"ngStyle"],["for","compiler"],["formControlName","compiler","name","compiler","optionLabel","name","optionValue","id","appendTo","body","styleClass","dropDownForm",3,"onChange","options"],["pTemplate","selectedItem"],["pTemplate","item"],[1,"p-inputgroup","justify-between"],["for","comment"],["maxlength","255","pInputText","","formControlName","comment","name","comment",1,"fwc-comment-input",3,"rows","cols"],["formArrayName","fwnodes",1,"grid"],[1,"fwcBlue"],[1,"col-12","grid","grid-nogutter",3,"ngStyle","formGroupName"],["class","compiler-dropdown__value",4,"ngIf"],[1,"compiler-dropdown__value"],["class","compiler-dropdown__icon","aria-hidden","true",3,"ngClass",4,"ngIf"],[1,"compiler-dropdown__label"],["aria-hidden","true",1,"compiler-dropdown__icon",3,"ngClass"],[1,"compiler-dropdown__item"],[3,"ngClass"],[1,"p-inputgroup",2,"padding-right","13px"],["type","button","styleClass","fwcButtonHeight","tooltipPosition","top","showDelay","500",3,"onClick","icon","disabled","pTooltip"],["formControlName","name","maxlength","64","type","text","pInputText","",3,"change","id","placeholder"],[1,"fwc-error"],["formControlName","install_port","type","number","pInputText","","min","1",2,"min-width","1rem !important",3,"placeholder"],["tooltipPosition","bottom","showDelay","500","type","button","styleClass","fwcButtonHeight","icon","fa fa-plug",3,"disabled","pTooltip"],["tooltipPosition","bottom","showDelay","500","type","button","styleClass","fwcButtonHeight","icon","fa fa-info-circle",3,"disabled","pTooltip"],["tooltipPosition","bottom","showDelay","500","type","button","styleClass","p-button-danger fwcButtonHeight","icon","pi pi-minus",3,"disabled","pTooltip"],["type","button","styleClass","fwcButtonHeight","icon","fa fa-plus","tooltipPosition","bottom","showDelay","500",3,"disabled","pTooltip"],["type","button","styleClass","fwcButtonHeight","icon","fa fa-search-plus","tooltipPosition","bottom","showDelay","500",3,"onClick","disabled","pTooltip"],[1,"col-1"],["formControlName","install_protocol","name","install_protocol","optionLabel","label","optionValue","value","appendTo","body","styleClass","dropDownForm selNoMargin",3,"onChange","options","placeholder"],[1,"col-3"],["formControlName","install_apikey","name","install_apikey","pPassword","","maxlength","64",3,"showPassword","placeholder","feedback"],["type","button","icon","fa fa-eye","styleClass","p-button-secondary",3,"mousedown","mouseup","mouseout"],[2,"padding-right","13px",3,"ngClass"],["formControlName","install_user","maxlength","32","type","text","pInputText","",3,"id","placeholder"],["formControlName","install_pass","pPassword","","maxlength","64",3,"showPassword","placeholder","promptLabel","weakLabel","mediumLabel","strongLabel"],[1,"col-4","lg:col-2"],[1,"fa","fa-lg","fa-info-circle","fwcBlue",2,"margin-top","0.9rem",3,"pTooltip"],["type","text","pInputText","","readonly","",3,"value"],[1,"col-4","lg:col-2",2,"padding-right","13px"],["formControlName","install_interface","name","install_interface","optionLabel","name","optionValue","id","appendTo","body","styleClass","dropDownForm selNoMargin",3,"onChange","options","autoDisplayFirst","placeholder"],["formControlName","install_ipobj","optionLabel","name","optionValue","id","appendTo","body","styleClass","dropDownForm selNoMargin",3,"onChange","options","name","autoDisplayFirst","placeholder"],["tooltipPosition","bottom","showDelay","500","type","button","styleClass","fwcButtonHeight","icon","fa fa-plug",3,"onClick","disabled","pTooltip"],["tooltipPosition","bottom","showDelay","500","type","button","styleClass","fwcButtonHeight","icon","fa fa-info-circle",3,"onClick","disabled","pTooltip"],["tooltipPosition","bottom","showDelay","500","type","button","styleClass","p-button-danger fwcButtonHeight","icon","pi pi-minus",3,"onClick","disabled","pTooltip"],["type","button","styleClass","fwcButtonHeight","icon","fa fa-plus","tooltipPosition","bottom","showDelay","500",3,"onClick","disabled","pTooltip"],[3,"onInstallModified","onIpObjectModified","onStartAutodiscover","options"],["type","hidden","formControlName","options","name","options"],[1,"col-12","noVertPad"],[1,"col-12","md:col-4"],[3,"ngModelChange","onChange","binary","ngModel","ngModelOptions"],["href","https://www.docker.com","target","_blank"],["width","20","height","20",1,"icon"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-docker"],["target","_blank",1,"fwc-inline-info-link",3,"href"],["href","https://crowdsec.net/","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-crowdsec"],["href","https://www.fail2ban.org","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-fail2ban"],["type","hidden","formControlName","plugins","name","plugins"],[3,"message"],["href","https://www.openvpn.net/","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-openvpn"],["href","https://www.wireguard.com/","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-wireguard"],["href","","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-ipsec"],["href","https://github.com/acassen/keepalived","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-keepalived"],["href","https://ipgeolocation.io/","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-geoip"],["href","https://www.ntop.org/","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-ntopng"],["href","https://www.diladele.com/","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-websafety"],["href","https://dnssafety.diladele.com/","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-dnssafety"],["href","https://suricata.io/","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-suricata"],["href","https://zeek.org/","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-zeek"],["href","https://www.elastic.co/what-is/elasticsearch","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-elasticsearch"],["href","https://www.elastic.co/what-is/kibana","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-kibana"],["href","https://www.elastic.co/logstash/","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-logstash"],["href","https://www.elastic.co/beats/filebeat","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-filebeat"],["href","https://www.isc.org/dhcp/","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-isc-dhcp"],["href","https://www.haproxy.org/","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-ha-proxy"],["href","https://www.isc.org/bind/","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-isc-bind9"],["href","https://irqbalance.github.io/irqbalance/","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-irqbalance"],[1,"grid","grid-nogutter","ngfw-tools-grid"],[1,"flex","flex-col"],["for","NTOPNG_BUTTON",1,"flex","items-center","gap-2","mb-2"],["type","button","tooltipPosition","top","showDelay","500","styleClass","w-full fwc-btn-tall fwc-btn-fill",3,"onClick","disabled","pTooltip","label"],["for","WEBSAFETYPROXY_BUTTON",1,"flex","items-center","gap-2","mb-2"],["for","DNSSAFETY_BUTTON",1,"flex","items-center","gap-2","mb-2"],["for","ELASTICSEARCH_BUTTON",1,"flex","items-center","gap-2","mb-2"],[1,"col-12","divCentered"],[1,"fwcRestrictionsContainer"],[3,"dependencies"],[3,"onHideParent","onRefreshRestrictions","dependencies"],["name","chkOkToDelete","binary","true",3,"ngModelChange","ngModel","label"],[1,"divLoadTemp",3,"ngStyle"],["type","button","styleClass","p-button-danger","icon","fa fa-xmark",3,"label"],["type","button","styleClass","p-button-danger","icon","pi pi-trash",3,"disabled","label"],["type","button","styleClass","p-button-success","icon","fa fa-save",3,"disabled","label"],["type","button","icon","pi pi-check",3,"disabled","label"],["styleClass","fwc-spinner-sm"],["type","button","styleClass","p-button-danger","icon","fa fa-xmark",3,"onClick","label"],["type","button","styleClass","p-button-danger","icon","pi pi-trash",3,"onClick","disabled","label"],["type","button","styleClass","p-button-success","icon","fa fa-save",3,"onClick","disabled","label"],["type","button","icon","pi pi-check",3,"onClick","disabled","label"],["type","button","styleClass","fwc-left-float","icon","fa fa-refresh",3,"disabled","label"],["type","button","styleClass","p-button-danger","icon","fa fa-trash",3,"onClick","disabled","label"],["type","button","icon","pi pi-check",3,"onClick","label"],["type","button","styleClass","fwc-left-float","icon","fa fa-refresh",3,"onClick","disabled","label"]],template:function(t,n){if(t&1){let l=M();p(0,"p-dialog",7,0),H("visibleChange",function(a){return w(l),W(n.displayDialog,a)||(n.displayDialog=a),g(a)}),P("onShow",function(){return w(l),g(n.onShowDialog())})("onHide",function(){return w(l),g(n.onHideDialog())}),J(2,nd,5,4,"ng-template",null,1,pe),x(4,Gd,35,37,"form",8),x(5,Hd,3,2),J(6,Zd,2,2,"ng-template",null,2,pe),f()}t&2&&(V("visible",n.displayDialog),m("modal",!0)("closable",!1)("resizable",!0),c(4),R(n.cluster?4:-1),c(),R(n.clusterToDelete?5:-1))},dependencies:[pt,Gt,Mi,Gi,ai,si,bt,Ni,ci,Bi,Pt,Ui,ki,Wo,Ho,Yi,Fn,Yt,Ht,jt,Wt,mi,Ze,fi,Pn,hi,Rt,dt],styles:[`.fwcGridVertPadding{padding-top:.3em!important;padding-bottom:.3em!important}textarea{resize:none}.btnEye .p-button-text{width:1.6em!important}.divLabelRight{float:right}.selNoMargin{margin:0!important}.fwc-btn-tall{height:2.44rem}::ng-deep .fwc-btn-fill{height:100%!important;min-height:2.44rem;align-items:center;justify-content:center;white-space:normal}::ng-deep .fwc-btn-fill .p-button-label{flex:1 1 auto;min-width:0;white-space:normal!important;text-align:center;line-height:1.2;overflow:visible;text-overflow:clip;overflow-wrap:anywhere;word-break:break-word;margin-top:0!important}.fwc-comment-input{width:85%}.fwc-inline-info-link{display:inline-block;margin-left:.5rem;margin-top:.125rem}.fwc-spinner-sm{width:1.7rem;height:1.7rem}.fwc-cluster-panel-section{display:flex;flex-direction:column;flex:1 1 0%;padding:1rem 1rem .571rem!important;overflow:hidden;box-sizing:border-box;border:1px solid var(--fwcGrey2);border-bottom-right-radius:3px;border-bottom-left-radius:3px;background:var(--surfaceBackgroundColor)}.fwc-cluster-panel-section *{max-width:100%!important;box-sizing:border-box;flex-shrink:1;overflow-wrap:break-word}sts-fwc-cluster-panel .fwc-tabbar{gap:.2rem;background:transparent}.dlgFwcDialog .fwcFirewallPanel .p-inputgroup{align-items:center;width:100%}.compiler-dropdown__value,.compiler-dropdown__item{display:flex;align-items:center}.compiler-dropdown__icon{display:inline-flex;align-items:center;justify-content:center;width:1.5rem;height:1.5rem;line-height:1;flex-shrink:0}.compiler-dropdown__value .compiler-dropdown__icon{margin-right:.25rem}.compiler-dropdown__item .compiler-dropdown__icon{margin-right:.65rem}.compiler-dropdown-panel .p-dropdown-item{display:flex;align-items:center}.compiler-dropdown-panel .compiler-dropdown__item{width:100%}sts-fwc-cluster-panel>p-dialog>div>div>div.ng-tns-c1623988549-21.p-dialog-content.ng-star-inserted{min-width:100%!important}.dlgFwcDialog .ngfw-tools-grid{display:flex;flex-wrap:nowrap;gap:.5rem;width:calc(100% - 14rem)!important}.dlgFwcDialog .ngfw-tools-grid .col-3{flex:1 1 calc((100% - 1.5rem)/4)}
`],encapsulation:2});let r=s;return r})();var Eo=kr(Br());var o_=["tbvItemTabview"],l_=["inputObjName"],Qt=r=>({visibility:r}),r_=r=>({network:r}),a_=()=>({visibility:"hidden"}),vo=()=>({standalone:!0}),vr=()=>({width:"1.7rem",height:"1.7rem"});function s_(r,s){r&1&&(p(0,"i"),C(1),y(2,"translate"),f()),r&2&&(c(),U(E(2,1,"ITEM_PANEL.HEADER.STD_OBJ")))}function c_(r,s){if(r&1&&(p(0,"div",6)(1,"h6",10),O(2,"i",11),C(3),y(4,"translate"),p(5,"strong"),C(6),f(),O(7,"span",12),C(8),y(9,"translate"),O(10,"i",13),y(11,"fwcIcon"),C(12,"\xA0 "),p(13,"strong"),C(14),y(15,"translate"),f(),C(16,"\xA0 "),x(17,s_,3,3,"i"),f()()),r&2){let i=_(4);c(3),F(" ",E(4,8,"ITEM_PANEL.HEADER.EDIT_OBJ."+i.tabIndex)," "),c(3),U(i.object.name),c(2),F(" ",E(9,10,"ITEM_PANEL.HEADER.TYPE"),": \xA0 "),c(2),he(nt("",E(11,12,i.object.type)," fwcOrange")),c(4),U(E(15,14,"GLOBALS.DB_OBJECT_NAMES."+i.object.type)),c(3),R(!i.object.fwcloud&&i.object.type!=i.ObjectTypes.OBJ_INTERFACE_FIREWALL?17:-1)}}function p_(r,s){if(r&1&&(p(0,"div",6)(1,"h6",10),O(2,"i",11),C(3),y(4,"translate"),p(5,"strong"),C(6),f()()()),r&2){let i=_(4);c(3),F(" ",E(4,2,"ITEM_PANEL.HEADER.EDIT_RULE")," "),c(3),U(i.object.id)}}function d_(r,s){if(r&1&&x(0,c_,18,16,"div",6)(1,p_,7,4,"div",6),r&2){let i=_(3);R(i.object.type!=i.ObjectTypes.OBJ_GEN_RULE?0:1)}}function __(r,s){r&1&&(p(0,"span"),C(1),y(2,"translate"),f()),r&2&&(c(),F("",E(2,1,"ITEM_PANEL.HEADER.IN_FW")," "))}function u_(r,s){r&1&&(p(0,"span"),C(1),y(2,"translate"),f()),r&2&&(c(),F("",E(2,1,"ITEM_PANEL.HEADER.IN_CL")," "))}function f_(r,s){r&1&&(p(0,"span"),C(1),y(2,"translate"),f()),r&2&&(c(),F("",E(2,1,"ITEM_PANEL.HEADER.IN_HOST")," "))}function m_(r,s){if(r&1&&(p(0,"strong"),C(1),f()),r&2){let i=_(4);c(),Li("",i.object.parent_id," (",i.object.parent_name,")")}}function h_(r,s){if(r&1&&(p(0,"span"),C(1),y(2,"translate"),p(3,"strong"),C(4),f(),C(5," ("),p(6,"strong"),C(7),f(),C(8,")"),f()),r&2){let i=_(4);c(),F("",E(2,3,"ITEM_PANEL.HEADER.IN_IF")," "),c(3),U(i.object.interface),c(3),U(i.object._fwcParentObjName)}}function w_(r,s){if(r&1&&(p(0,"div",6)(1,"h6",10),O(2,"i",14),C(3),y(4,"translate"),x(5,__,3,3,"span"),x(6,u_,3,3,"span"),x(7,f_,3,3,"span"),x(8,m_,2,2,"strong"),x(9,h_,9,5,"span"),O(10,"span",12),C(11),y(12,"translate"),p(13,"strong"),C(14),y(15,"translate"),f()()()),r&2){let i=_(3);c(3),F(" ",E(4,8,"ITEM_PANEL.HEADER.NEW_OBJ")," "),c(2),R(i.object.firewall&&!i.object.cluster?5:-1),c(),R(i.object.cluster?6:-1),c(),R(i.object.host?7:-1),c(),R(i.object.parent_id?8:-1),c(),R(i.object._fwcParentInterfaceType?9:-1),c(2),F(" ",E(12,10,"ITEM_PANEL.HEADER.TYPE"),": "),c(3),U(E(15,12,"GLOBALS.DB_OBJECT_NAMES."+i.object.type))}}function g_(r,s){if(r&1&&(p(0,"div",6)(1,"h6",10),O(2,"i",11),C(3),y(4,"translate"),p(5,"strong"),C(6),f(),O(7,"span",12),C(8),y(9,"translate"),O(10,"i",13),y(11,"fwcIcon"),C(12,"\xA0 "),p(13,"strong"),C(14),y(15,"translate"),f()()()),r&2){let i=_(3);c(3),F(" ",E(4,7,"ITEM_PANEL.HEADER.DUPLICATE_OBJ")," "),c(3),U(i.object.name),c(2),F(" ",E(9,9,"ITEM_PANEL.HEADER.TYPE"),": \xA0 "),c(2),he(nt("",E(11,11,i.object.type)," fwcOrange")),c(4),U(E(15,13,"GLOBALS.DB_OBJECT_NAMES."+i.object.type))}}function S_(r,s){if(r&1&&(x(0,d_,2,1),x(1,w_,16,14,"div",6),x(2,g_,16,15,"div",6)),r&2){let i=_(2);R(i.object.id&&!i.object.duplicateObjectAction?0:-1),c(),R(!i.object.id&&!i.object.duplicateObjectAction?1:-1),c(),R(i.object.duplicateObjectAction?2:-1)}}function C_(r,s){if(r&1&&(p(0,"div",6)(1,"h6",10),O(2,"i",15),C(3),y(4,"translate"),p(5,"strong"),C(6),f()()()),r&2){let i=_(2);c(3),F(" ",E(4,2,i.deleteDialogTitle)," "),c(3),U(i.objectToDelete==null?null:i.objectToDelete._fwcObjName)}}function y_(r,s){if(r&1){let i=M();p(0,"p-button",16),P("onClick",function(){w(i);let t=_(2);return g(t.showHelp())}),f()}if(r&2){let i=_(2);m("disabled",i.loadingData)}}function E_(r,s){if(r&1){let i=M();x(0,S_,3,3),x(1,C_,7,4,"div",6),p(2,"div",7),x(3,y_,1,1,"p-button",8),p(4,"p-button",9),P("onClick",function(){w(i);let t=_();return g(t.minimizeDialog())}),f()()}if(r&2){let i=_();R(i.object?0:-1),c(),R(i.objectToDelete?1:-1),c(2),R(i.helpSection?3:-1)}}function v_(r,s){if(r&1){let i=M();p(0,"div",27)(1,"div",33)(2,"p-floatlabel",34)(3,"input",35,3),P("drop",function(){w(i);let t=_(3);return g(t.preventDrop())}),f(),p(5,"label",36),C(6),y(7,"translate"),f()()(),p(8,"p",37),C(9),y(10,"translate"),f()()}if(r&2){let i,e=_(3);m("ngClass",e.object.type==e.ObjectTypes.OBJ_GROUP||e.object.type==e.ObjectTypes.OBJ_SERVICE_GROUP?"col-12 noVertPad":"col-6 noVertPad"),c(6),U(E(7,4,e.object.type!=e.ObjectTypes.OBJ_DNS?"ITEM_PANEL.FIELDS.NAME":"ITEM_PANEL.FIELDS.NAME_DNS")),c(2),m("ngStyle",Re(8,Qt,e.formModel.get("name").valid||e.formModel.get("name").pristine?"hidden":"visible")),c(),F(" ",E(10,6,(i=e.formModel.get("name").errors)!=null&&i.pattern?"ITEM_PANEL.ERRORS.FIELD_INVALID_NAME":"ITEM_PANEL.ERRORS.FIELD_EMPTY")," ")}}function I_(r,s){r&1&&O(0,"div",28)}function b_(r,s){r&1&&(p(0,"p",40),C(1),y(2,"translate"),f()),r&2&&(c(),F(" ",E(2,1,"ITEM_PANEL.ERRORS.FIELD_ADDR")," "))}function P_(r,s){if(r&1){let i=M();p(0,"div",29)(1,"div",33)(2,"p-floatlabel",34)(3,"input",38),P("drop",function(){w(i);let t=_(3);return g(t.preventDrop())})("blur",function(){w(i);let t=_(3);return g(t.revalidateForm("address"))}),f(),p(4,"label",39),C(5),y(6,"translate"),f()()(),x(7,b_,3,3,"p",40),f()}if(r&2){let i,e=_(3);c(5),U(E(6,2,"ITEM_PANEL.FIELDS.ADDRESS")),c(2),R((i=e.formModel.get("address"))!=null&&i.touched&&((i=e.formModel.get("address"))!=null&&i.errors)?7:-1)}}function T_(r,s){r&1&&(p(0,"p",40),C(1),y(2,"translate"),f()),r&2&&(c(),F(" ",E(2,1,"ITEM_PANEL.ERRORS.FIELD_NETMASK")," "))}function O_(r,s){if(r&1){let i=M();p(0,"div",29)(1,"div",33)(2,"p-floatlabel",34)(3,"input",41),P("drop",function(){w(i);let t=_(3);return g(t.preventDrop())})("blur",function(){w(i);let t=_(3);return g(t.revalidateForm("netmask"))}),f(),p(4,"label",42),C(5),y(6,"translate"),f()()(),x(7,T_,3,3,"p",40),f()}if(r&2){let i,e=_(3);c(5),U(E(6,2,"ITEM_PANEL.FIELDS.MASK")),c(2),R((i=e.formModel.get("netmask"))!=null&&i.touched&&((i=e.formModel.get("netmask"))!=null&&i.errors)?7:-1)}}function x_(r,s){r&1&&(p(0,"p",40),C(1),y(2,"translate"),f()),r&2&&(c(),F(" ",E(2,1,"ITEM_PANEL.ERRORS.FIELD_ADDR")," "))}function R_(r,s){if(r&1){let i=M();p(0,"div",29)(1,"div",33)(2,"p-floatlabel",34)(3,"input",43),P("drop",function(){w(i);let t=_(3);return g(t.preventDrop())})("blur",function(){w(i);let t=_(3);return g(t.revalidateForm("range_start"))}),f(),p(4,"label",44),C(5),y(6,"translate"),f()()(),x(7,x_,3,3,"p",40),f()}if(r&2){let i,e=_(3);c(5),U(E(6,2,"ITEM_PANEL.FIELDS.RANGE_S")),c(2),R((i=e.formModel.get("range_start"))!=null&&i.touched&&((i=e.formModel.get("range_start"))!=null&&i.errors)?7:-1)}}function F_(r,s){r&1&&(C(0),y(1,"translate")),r&2&&F(" ",E(1,1,"ITEM_PANEL.ERRORS.FIELD_RANGE_VAL")," ")}function A_(r,s){r&1&&(C(0),y(1,"translate")),r&2&&F(" ",E(1,1,"ITEM_PANEL.ERRORS.FIELD_ADDR")," ")}function L_(r,s){if(r&1&&(p(0,"p",40),x(1,F_,2,3)(2,A_,2,3),f()),r&2){let i,e=_(4);c(),R(!((i=e.formModel.get("range_end"))==null||i.errors==null)&&i.errors.rangeorder?1:2)}}function M_(r,s){if(r&1){let i=M();p(0,"div",29)(1,"div",33)(2,"p-floatlabel",34)(3,"input",45),P("drop",function(){w(i);let t=_(3);return g(t.preventDrop())})("blur",function(){w(i);let t=_(3);return g(t.revalidateForm("range_end"))}),f(),p(4,"label",46),C(5),y(6,"translate"),f()()(),x(7,L_,3,1,"p",40),f()}if(r&2){let i,e=_(3);c(5),U(E(6,2,"ITEM_PANEL.FIELDS.RANGE_E")),c(2),R((i=e.formModel.get("range_end"))!=null&&i.touched&&((i=e.formModel.get("range_end"))!=null&&i.errors)?7:-1)}}function D_(r,s){if(r&1){let i=M();p(0,"div",29)(1,"div",33)(2,"p-floatlabel",47)(3,"p-select",48),P("onChange",function(){w(i);let t=_(3);return g(t.revalidateForm())}),f(),p(4,"label",49),C(5),y(6,"translate"),f()()()()}if(r&2){let i=_(3);c(3),m("options",i.ipVersions)("autoDisplayFirst",!0),c(2),U(E(6,3,"ITEM_PANEL.FIELDS.IPV"))}}function N_(r,s){if(r&1&&(p(0,"p",40),C(1),y(2,"translate"),y(3,"translate"),f()),r&2){let i,e=_(4);c(),F(" ",(i=e.formModel.get("address").errors)!=null&&i.networkAddress?oi(2,1,"VPN.PANEL.ERRORS.IP_NOT_IN_NETWORK",Re(6,r_,e.formModel.get("address").errors.networkAddress.network)):E(3,4,"ITEM_PANEL.ERRORS.FIELD_ADDR")," ")}}function G_(r,s){if(r&1){let i=M();p(0,"div",29)(1,"div",33)(2,"p-floatlabel",34)(3,"input",38),P("drop",function(){w(i);let t=_(3);return g(t.preventDrop())})("blur",function(){w(i);let t=_(3);return g(t.revalidateForm("address"))}),f(),p(4,"label",39),C(5),y(6,"translate"),f()()(),x(7,N_,4,8,"p",40),f()}if(r&2){let i,e=_(3);c(5),U(E(6,2,"ITEM_PANEL.FIELDS.ADDRESS")),c(2),R((i=e.formModel.get("address"))!=null&&i.touched&&((i=e.formModel.get("address"))!=null&&i.errors)?7:-1)}}function U_(r,s){r&1&&(p(0,"p",40),C(1),y(2,"translate"),f()),r&2&&(c(),F(" ",E(2,1,"ITEM_PANEL.ERRORS.FIELD_NETMASK")," "))}function k_(r,s){if(r&1){let i=M();p(0,"div",29)(1,"div",33)(2,"p-floatlabel",34)(3,"input",41),P("drop",function(){w(i);let t=_(3);return g(t.preventDrop())})("blur",function(){w(i);let t=_(3);return g(t.revalidateForm("netmask"))}),f(),p(4,"label",42),C(5),y(6,"translate"),f()()(),x(7,U_,3,3,"p",40),f()}if(r&2){let i,e=_(3);c(5),U(E(6,2,"ITEM_PANEL.FIELDS.MASK")),c(2),R((i=e.formModel.get("netmask"))!=null&&i.touched&&((i=e.formModel.get("netmask"))!=null&&i.errors)?7:-1)}}function B_(r,s){if(r&1){let i=M();p(0,"div",29)(1,"div",33)(2,"p-floatlabel",47)(3,"p-select",48),P("onChange",function(){w(i);let t=_(3);return g(t.revalidateForm())}),f(),p(4,"label",49),C(5),y(6,"translate"),f()()()()}if(r&2){let i=_(3);c(3),m("options",i.ipVersions)("autoDisplayFirst",!0),c(2),U(E(6,3,"ITEM_PANEL.FIELDS.IPV"))}}function j_(r,s){if(r&1&&(p(0,"div",30)(1,"div",33)(2,"p-floatlabel",34),O(3,"sts-fwc-object-group",50),p(4,"label",51),C(5),y(6,"translate"),f()()(),O(7,"p",52),f()),r&2){let i=_(3);c(3),m("groupId",i.object.id)("readOnly",!i.object.fwcloud)("groupType",i.object.type)("groupTreeId",i.object.id_node)("ipobjs",i.object.ipobjs),c(2),U(E(6,7,"ITEM_PANEL.FIELDS.OBJ_GROUP")),c(2),m("ngStyle",Y(9,a_))}}function V_(r,s){if(r&1){let i=M();p(0,"div",28)(1,"div",33)(2,"p-floatlabel",34)(3,"input",53),P("drop",function(){w(i);let t=_(3);return g(t.preventDrop())})("click",function(t){return w(i),g(t.target.select())}),f(),p(4,"label",54),C(5),y(6,"translate"),f()()(),p(7,"p",52),C(8),y(9,"translate"),f()()}if(r&2){let i=_(3);c(5),U(E(6,3,"ITEM_PANEL.FIELDS.PROT")),c(2),m("ngStyle",Re(7,Qt,i.formModel.get("protocol").valid||i.formModel.get("protocol").pristine?"hidden":"visible")),c(),F(" ",E(9,5,"ITEM_PANEL.ERRORS.FIELD_PROTOCOL")," ")}}function W_(r,s){r&1&&(p(0,"span"),C(1),y(2,"translate"),O(3,"br"),f()),r&2&&(c(),U(E(2,1,"ITEM_PANEL.ERRORS.FIELD_PORT_VAL")))}function H_(r,s){r&1&&(p(0,"span"),C(1),y(2,"translate"),f()),r&2&&(c(),U(E(2,1,"ITEM_PANEL.ERRORS.FIELD_PORT_VAL2")))}function J_(r,s){r&1&&(p(0,"span"),C(1),y(2,"translate"),O(3,"br"),f()),r&2&&(c(),U(E(2,1,"ITEM_PANEL.ERRORS.FIELD_PORT_VAL")))}function Y_(r,s){r&1&&(p(0,"span"),C(1),y(2,"translate"),f()),r&2&&(c(),U(E(2,1,"ITEM_PANEL.ERRORS.FIELD_PORT_VAL2")))}function K_(r,s){if(r&1){let i=M();p(0,"div",28)(1,"div",26)(2,"div",28)(3,"p-fieldset",55),y(4,"translate"),p(5,"div",26)(6,"div",28)(7,"div",33)(8,"p-floatlabel",34)(9,"input",56),P("drop",function(){w(i);let t=_(3);return g(t.preventDrop())})("click",function(t){return w(i),g(t.target.select())}),f(),p(10,"label",57),C(11),y(12,"translate"),f()()()(),p(13,"div",28)(14,"div",33)(15,"p-floatlabel",34)(16,"input",58),P("drop",function(){w(i);let t=_(3);return g(t.preventDrop())})("click",function(t){return w(i),g(t.target.select())}),f(),p(17,"label",59),C(18),y(19,"translate"),f()()()()(),p(20,"p",52),x(21,W_,4,3,"span"),x(22,H_,3,3,"span"),f()()(),p(23,"div",28)(24,"p-fieldset",55),y(25,"translate"),p(26,"div",26)(27,"div",28)(28,"div",33)(29,"p-floatlabel",34)(30,"input",60),P("drop",function(){w(i);let t=_(3);return g(t.preventDrop())})("click",function(t){return w(i),g(t.target.select())}),f(),p(31,"label",61),C(32),y(33,"translate"),f()()()(),p(34,"div",28)(35,"div",33)(36,"p-floatlabel",34)(37,"input",62),P("drop",function(){w(i);let t=_(3);return g(t.preventDrop())})("click",function(t){return w(i),g(t.target.select())}),f(),p(38,"label",63),C(39),y(40,"translate"),f()()()()(),p(41,"p",52),x(42,J_,4,3,"span"),x(43,Y_,3,3,"span"),f()()()()()}if(r&2){let i,e,t,n,l=_(3);c(3),m("legend",B(E(4,14,"ITEM_PANEL.FIELDS.SRC_PORT"))),c(8),U(E(12,16,"ITEM_PANEL.FIELDS.PORT_S")),c(7),U(E(19,18,"ITEM_PANEL.FIELDS.PORT_E")),c(2),m("ngStyle",Re(26,Qt,(i=l.formModel.get("source_port_start").errors)!=null&&i.min||(i=l.formModel.get("source_port_start").errors)!=null&&i.max||l.formModel.errors!=null&&l.formModel.errors.sourceports?"visible":"hidden")),c(),R((e=l.formModel.get("source_port_start").errors)!=null&&e.min||(e=l.formModel.get("source_port_start").errors)!=null&&e.max?21:-1),c(),R(l.formModel.errors!=null&&l.formModel.errors.sourceports?22:-1),c(2),m("legend",B(E(25,20,"ITEM_PANEL.FIELDS.DEST_PORT"))),c(8),U(E(33,22,"ITEM_PANEL.FIELDS.PORT_S")),c(7),U(E(40,24,"ITEM_PANEL.FIELDS.PORT_E")),c(2),m("ngStyle",Re(28,Qt,(t=l.formModel.get("destination_port_start").errors)!=null&&t.min||(t=l.formModel.get("destination_port_start").errors)!=null&&t.max||l.formModel.errors!=null&&l.formModel.errors.destinationports?"visible":"hidden")),c(),R((n=l.formModel.get("destination_port_start").errors)!=null&&n.min||(n=l.formModel.get("destination_port_start").errors)!=null&&n.max?42:-1),c(),R(l.formModel.errors!=null&&l.formModel.errors.destinationports?43:-1)}}function X_(r,s){if(r&1&&(p(0,"th"),C(1),f()),r&2){let i=s.$implicit;c(),F(" ",i.name," ")}}function z_(r,s){if(r&1){let i=M();p(0,"td")(1,"p-checkbox",67),H("ngModelChange",function(t){let n=w(i).$implicit;return W(n.mask,t)||(n.mask=t),g(t)}),P("onChange",function(){let t=w(i).$index,n=_(4);return g(n.setFormTCPFlags(t))}),f()()}if(r&2){let i=s.$implicit,e=s.$index,t=_(4);c(),m("inputId","tcpFlagMask"+e)("binary",!0),V("ngModel",i.mask),m("ngModelOptions",Y(5,vo))("disabled",!t.object.fwcloud&&t.object.type!=t.ObjectTypes.OBJ_INTERFACE_FIREWALL&&t.object.type!=t.ObjectTypes.OBJ_GEN_RULE)}}function q_(r,s){if(r&1){let i=M();p(0,"td")(1,"p-checkbox",68),H("ngModelChange",function(t){let n=w(i).$implicit;return W(n.status,t)||(n.status=t),g(t)}),P("onChange",function(){let t=w(i).$index,n=_(4);return g(n.setFormTCPFlags(t))}),f()()}if(r&2){let i=s.$implicit,e=s.$index,t=_(4);c(),m("inputId","tcpFlagStatus"+e)("binary",!0),V("ngModel",i.status),m("ngModelOptions",Y(6,vo))("ngStyle",Re(7,Qt,i.mask?"visible":"hidden"))("disabled",!t.object.fwcloud&&t.object.type!=t.ObjectTypes.OBJ_INTERFACE_FIREWALL&&t.object.type!=t.ObjectTypes.OBJ_GEN_RULE)}}function Q_(r,s){if(r&1&&(p(0,"div",28)(1,"div",26)(2,"div",30)(3,"p-fieldset",55),y(4,"translate"),O(5,"input",64)(6,"input",65),p(7,"table",66)(8,"thead")(9,"tr"),O(10,"th"),Et(11,X_,2,1,"th",null,yt),f()(),p(13,"tbody")(14,"tr")(15,"td"),C(16),y(17,"translate"),f(),Et(18,z_,2,6,"td",null,yt),f(),p(20,"tr")(21,"td"),C(22),y(23,"translate"),f(),Et(24,q_,2,9,"td",null,yt),f()()()()()()()),r&2){let i=_(3);c(3),m("legend",B(E(4,4,"ITEM_PANEL.FIELDS.TCP_FLAGS"))),c(8),vt(i.tcpFlagsArray),c(5),F(" ",E(17,6,"ITEM_PANEL.FIELDS.TCP_FLAG_MASK")," "),c(2),vt(i.tcpFlagsArray),c(4),F(" ",E(23,8,"ITEM_PANEL.FIELDS.TCP_FLAG_STATUS")," "),c(2),vt(i.tcpFlagsArray)}}function $_(r,s){if(r&1){let i=M();p(0,"div",31)(1,"div",33)(2,"p-floatlabel",47)(3,"p-select",69),P("onChange",function(){w(i);let t=_(3);return g(t.revalidateForm())}),f(),p(4,"label",70),C(5),y(6,"translate"),f()()()()}if(r&2){let i=_(3);c(3),m("options",i.icmpOptions)("autoDisplayFirst",!0),c(2),U(E(6,3,"ITEM_PANEL.FIELDS.ICMP_TYPE"))}}function Z_(r,s){if(r&1){let i=M();p(0,"div",31)(1,"div",33)(2,"p-floatlabel",47)(3,"p-select",71),P("onChange",function(){w(i);let t=_(3);return g(t.revalidateForm())}),f(),p(4,"label",72),C(5),y(6,"translate"),f()()()()}if(r&2){let i=_(3);c(3),m("options",i.icmpOptions)("autoDisplayFirst",!0),c(2),U(E(6,3,"ITEM_PANEL.FIELDS.ICMP_CODE"))}}function eu(r,s){if(r&1){let i=M();p(0,"div",29)(1,"div",33)(2,"p-floatlabel",34)(3,"input",73),P("drop",function(){w(i);let t=_(3);return g(t.preventDrop())}),f(),p(4,"label",74),C(5),y(6,"translate"),f()()()()}r&2&&(c(5),U(E(6,1,"ITEM_PANEL.FIELDS.LABEL")))}function tu(r,s){if(r&1){let i=M();p(0,"div",29)(1,"div",33)(2,"p-floatlabel",34)(3,"input",75),P("drop",function(){w(i);let t=_(3);return g(t.preventDrop())}),f(),p(4,"label",76),C(5),y(6,"translate"),f()()(),p(7,"p",52),C(8),y(9,"translate"),f()()}if(r&2){let i=_(3);c(5),U(E(6,3,"ITEM_PANEL.FIELDS.MAC")),c(2),m("ngStyle",Re(7,Qt,i.formModel.get("mac").valid||i.formModel.get("mac").pristine?"hidden":"visible")),c(),F(" ",E(9,5,"ITEM_PANEL.ERRORS.FIELD_MAC")," ")}}function iu(r,s){if(r&1){let i=M();p(0,"div",28)(1,"div",33)(2,"p-floatlabel",34)(3,"input",77),P("drop",function(){w(i);let t=_(3);return g(t.preventDrop())}),f(),p(4,"label",78),C(5),y(6,"translate"),f()()(),p(7,"p",52),C(8),y(9,"translate"),f()()}if(r&2){let i=_(3);c(5),U(E(6,3,"ITEM_PANEL.FIELDS.MARK_CODE")),c(2),m("ngStyle",Re(7,Qt,i.formModel.get("code").valid||i.formModel.get("code").pristine?"hidden":"visible")),c(),F(" ",E(9,5,"ITEM_PANEL.ERRORS.FIELD_MARK_CODE")," ")}}function nu(r,s){if(r&1){let i=M();p(0,"div",33)(1,"p-checkbox",90),H("ngModelChange",function(t){let n=w(i).$implicit;return W(n.status,t)||(n.status=t),g(t)}),P("onChange",function(t){let n=w(i).$index,l=_(4);return g(l.onChangeOptionsFlags(n,t==null?null:t.checked))}),f(),p(2,"label",91),C(3),f()()}if(r&2){let i=s.$implicit,e=s.$index,t=_(4);c(),m("inputId","ruleOption"+e)("binary",!0)("disabled",i.disableOnRuleActive&&t.isSpecialRuleNonHookscript()),V("ngModel",i.status),m("ngModelOptions",Y(7,vo)),c(),qe("for","ruleOption"+e),c(),F(" ",i.name," ")}}function ou(r,s){if(r&1){let i=M();p(0,"div",79)(1,"h5",80),C(2),y(3,"translate"),f()(),p(4,"div",81)(5,"h5",80),C(6),y(7,"translate"),f()(),p(8,"div",79),Et(9,nu,4,8,"div",33,yt),f(),p(11,"div",81)(12,"p-tabs",82),H("valueChange",function(t){w(i);let n=_(3);return W(n.hookScriptTab,t)||(n.hookScriptTab=t),g(t)}),p(13,"p-tablist")(14,"p-tab",83),O(15,"i",84),p(16,"span"),C(17),y(18,"translate"),f()(),p(19,"p-tab",83),O(20,"i",85),p(21,"span"),C(22),y(23,"translate"),f()()(),p(24,"p-tabpanels")(25,"p-tabpanel",83),O(26,"textarea",86),y(27,"translate"),p(28,"div",87)(29,"p-button",88),y(30,"translate"),P("onClick",function(){w(i);let t=_(3);return t.formModel.get("run_before").setValue(null),g(t.formModel.markAsDirty())}),f()()(),p(31,"p-tabpanel",83),O(32,"textarea",89),y(33,"translate"),p(34,"div",87)(35,"p-button",88),y(36,"translate"),P("onClick",function(){w(i);let t=_(3);return t.formModel.get("run_after").setValue(null),g(t.formModel.markAsDirty())}),f()()()()()()}if(r&2){let i=_(3);c(2),F(" ",E(3,19,"RULE.OPTION_TITLE")," "),c(4),F(" ",E(7,21,"RULE.HOOKS.TITLE")," "),c(3),vt(i.optionsFlags),c(3),V("value",i.hookScriptTab),c(2),m("value",i.RuleHooks.BEFORE),c(3),U(E(18,23,"RULE.HOOKS.BEFORE_TITLE")),c(2),m("value",i.RuleHooks.AFTER),c(3),U(E(23,25,"RULE.HOOKS.AFTER_TITLE")),c(3),m("value",i.RuleHooks.BEFORE),c(),m("placeholder",B(E(27,27,"RULE.HOOKS.PLACEHOLDER"))),c(3),m("label",B(E(30,29,"CONTEXT.OBJECTS.DELETE")))("disabled",!i.formModel.get("run_before").value),c(2),m("value",i.RuleHooks.AFTER),c(),m("placeholder",B(E(33,31,"RULE.HOOKS.PLACEHOLDER"))),c(3),m("label",B(E(36,33,"CONTEXT.OBJECTS.DELETE")))("disabled",!i.formModel.get("run_after").value)}}function lu(r,s){if(r&1){let i=M();p(0,"div",32)(1,"p-floatlabel",34)(2,"textarea",92),P("drop",function(){w(i);let t=_(3);return g(t.preventDrop())}),f(),p(3,"label",93),C(4),y(5,"translate"),f()()()}r&2&&(c(4),U(E(5,1,"ITEM_PANEL.FIELDS.COMMENTS")))}function ru(r,s){if(r&1&&(p(0,"div",30),O(1,"sts-fwc-message",94),f()),r&2){let i=_(3);c(),m("message",i.objErrorMessage)}}function au(r,s){if(r&1){let i=M();Pe(0),p(1,"div",23)(2,"form",24)(3,"fieldset",25),P("keyup.enter",function(t){w(i);let n=_(2);return g(n.checkForm(t))})("keyup.esc",function(){w(i);let t=_(2);return g(t.onCancel())}),p(4,"div",26),x(5,v_,11,10,"div",27),x(6,I_,1,0,"div",28),x(7,P_,8,4,"div",29),x(8,O_,8,4,"div",29),x(9,R_,8,4,"div",29),x(10,M_,8,4,"div",29),x(11,D_,7,5,"div",29),x(12,G_,8,4,"div",29),x(13,k_,8,4,"div",29),x(14,B_,7,5,"div",29),x(15,j_,8,10,"div",30),x(16,V_,10,9,"div",28),x(17,K_,44,30,"div",28),x(18,Q_,26,10,"div",28),x(19,$_,7,5,"div",31),x(20,Z_,7,5,"div",31),x(21,eu,7,3,"div",29),x(22,tu,10,9,"div",29),x(23,iu,10,9,"div",28),x(24,ou,37,35),x(25,lu,6,3,"div",32),x(26,ru,2,1,"div",30),f()()()(),Te()}if(r&2){let i=_(2);c(2),m("formGroup",i.formModel),c(),m("disabled",i.loadingData||!i.object.fwcloud&&i.object.type!=i.ObjectTypes.OBJ_INTERFACE_FIREWALL&&i.object.type!=i.ObjectTypes.OBJ_GEN_RULE),c(2),R(i.object.type!=i.ObjectTypes.OBJ_GEN_RULE?5:-1),c(),R(i.object.type!=i.ObjectTypes.OBJ_GEN_RULE&&i.object.type!=i.ObjectTypes.OBJ_MARK&&i.object.type!=i.ObjectTypes.OBJ_SERVICE_IP&&i.object.type!=i.ObjectTypes.OBJ_SERVICE_ICMP?6:-1),c(),R(i.object.type==i.ObjectTypes.OBJ_ADDRESS?7:-1),c(),R(i.object.type==i.ObjectTypes.OBJ_ADDRESS?8:-1),c(),R(i.object.type==i.ObjectTypes.OBJ_ADDRESS_RANGE?9:-1),c(),R(i.object.type==i.ObjectTypes.OBJ_ADDRESS_RANGE?10:-1),c(),R(i.object.type==i.ObjectTypes.OBJ_ADDRESS||i.object.type==i.ObjectTypes.OBJ_ADDRESS_RANGE?11:-1),c(),R(i.object.type==i.ObjectTypes.OBJ_NETWORK?12:-1),c(),R(i.object.type==i.ObjectTypes.OBJ_NETWORK?13:-1),c(),R(i.object.type==i.ObjectTypes.OBJ_NETWORK?14:-1),c(),R((i.object.type==i.ObjectTypes.OBJ_GROUP||i.object.type==i.ObjectTypes.OBJ_SERVICE_GROUP)&&i.object.id?15:-1),c(),R(i.object.type==i.ObjectTypes.OBJ_SERVICE_IP?16:-1),c(),R(i.object.type==i.ObjectTypes.OBJ_SERVICE_TCP||i.object.type==i.ObjectTypes.OBJ_SERVICE_UDP?17:-1),c(),R(i.object.type==i.ObjectTypes.OBJ_SERVICE_TCP?18:-1),c(),R(i.object.type==i.ObjectTypes.OBJ_SERVICE_ICMP?19:-1),c(),R(i.object.type==i.ObjectTypes.OBJ_SERVICE_ICMP?20:-1),c(),R(i.object.type==i.ObjectTypes.OBJ_INTERFACE_HOST||i.object.type==i.ObjectTypes.OBJ_INTERFACE_FIREWALL?21:-1),c(),R(i.object.type==i.ObjectTypes.OBJ_INTERFACE_HOST||i.object.type==i.ObjectTypes.OBJ_INTERFACE_FIREWALL?22:-1),c(),R(i.object.type==i.ObjectTypes.OBJ_MARK?23:-1),c(),R(i.object.type==i.ObjectTypes.OBJ_GEN_RULE?24:-1),c(),R(i.object.type!=i.ObjectTypes.OBJ_GEN_RULE?25:-1),c(),R(i.objErrorMessage?26:-1)}}function su(r,s){if(r&1){let i=M();p(0,"div",96)(1,"form",97)(2,"sts-fwc-object-wu",98),P("onHideParent",function(){w(i);let t=_(3);return g(t.minimizeDialog())}),f()()()}if(r&2){let i=_(3);c(2),m("objectInfo",i.object._fwcObjectInfo)}}function cu(r,s){if(r&1&&(Pe(0),p(1,"div",95)(2,"div",26),x(3,su,3,1,"div",96),f()(),Te()),r&2){let i=_(2);c(3),R(i.object._fwcObjectInfo?3:-1)}}function pu(r,s){if(r&1){let i=M();p(0,"div",5)(1,"div",17)(2,"button",18),P("click",function(){w(i);let t=_();return g(t.onTabChange({index:0}))}),O(3,"i",19),p(4,"span"),C(5),y(6,"translate"),f()(),p(7,"button",18),P("click",function(){w(i);let t=_();return g(t.onTabChange({index:1}))}),O(8,"i",20),p(9,"span"),C(10),y(11,"translate"),f()()(),p(12,"section",21),J(13,au,27,24,"ng-container",22)(14,cu,4,1,"ng-container",22),f()()}if(r&2){let i=_();c(2),Je("is-active",i.tabIndex===0),m("disabled",i.loadingData||i.object._fwcObjType==i.ObjectTypes.OBJ_OPENVPN_CONFIG_CLI||i.object._fwcObjType==i.ObjectTypes.OBJ_OPENVPN_PREFIX),c(3),U(E(6,10,"ITEM_PANEL.HEADER.OBJ")),c(2),Je("is-active",i.tabIndex===1),m("disabled",i.loadingData||!i.object._fwcObjectInfo),c(3),U(E(11,12,"ITEM_PANEL.HEADER.INFO")),c(3),m("ngIf",i.tabIndex===0),c(),m("ngIf",i.tabIndex===1)}}function du(r,s){r&1&&(p(0,"div",99),O(1,"p-progressSpinner"),f())}function _u(r,s){if(r&1){let i=M();p(0,"div",100)(1,"sts-fwc-object-restrictions",101),P("onHideParent",function(){w(i);let t=_(3);return g(t.minimizeDialog(!0))})("onRefreshRestrictions",function(){w(i);let t=_(3);return g(t.reloadPanel())}),f()()}if(r&2){let i=_(3);c(),m("dependencies",i.dependencies)}}function uu(r,s){if(r&1&&(O(0,"sts-fwc-message",94),x(1,_u,2,1,"div",100)),r&2){let i=_(2);m("message",i.deleteMsg),c(),R(i.dependencies.restrictionsError?-1:1)}}function fu(r,s){if(r&1&&O(0,"sts-fwc-message",94),r&2){let i=_(2);m("message",i.deleteMsg)}}function mu(r,s){if(r&1&&(x(0,du,2,0,"div",99),x(1,uu,2,2)(2,fu,1,1,"sts-fwc-message",94)),r&2){let i=_();R(i.loadingData&&!i.deleteMsg?0:-1),c(),R(i.dependencies?1:2)}}function hu(r,s){if(r&1){let i=M();p(0,"p-button",107),y(1,"translate"),P("onClick",function(){w(i);let t=_(4);return g(t.onCancel())}),f()}if(r&2){let i=_(4);m("label",B(E(1,3,"GLOBALS.MSG_BUTTONS.CANCEL")))("disabled",!i.object||i.loadingData)}}function wu(r,s){if(r&1){let i=M();p(0,"p-button",108),y(1,"translate"),P("onClick",function(){w(i);let t=_(4);return g(t.onSave())}),f()}if(r&2){let i=_(4);m("label",B(E(1,3,"GLOBALS.MSG_BUTTONS.SAVE")))("disabled",!i.formModel.valid||i.formModel.pristine||i.loadingData)}}function gu(r,s){if(r&1){let i=M();p(0,"p-button",109),y(1,"translate"),P("onClick",function(){w(i);let t=_(4);return g(t.onCancel())}),f()}r&2&&m("label",B(E(1,2,"GLOBALS.MSG_BUTTONS.CLOSE")))}function Su(r,s){if(r&1&&(p(0,"div",104),O(1,"p-progressSpinner"),f(),x(2,hu,2,5,"p-button",105),x(3,wu,2,5,"p-button",106),x(4,gu,2,4,"p-button",103)),r&2){let i=_(3);m("ngStyle",Re(6,Qt,i.loadingData?"visible":"hidden")),c(),Nt(Y(8,vr)),c(),R(i.formModel.pristine?-1:2),c(),R(i.formModel.pristine?-1:3),c(),R(i.formModel.pristine?4:-1)}}function Cu(r,s){if(r&1){let i=M();p(0,"p-button",109),y(1,"translate"),P("onClick",function(){w(i);let t=_(3);return g(t.onCancel())}),f()}r&2&&m("label",B(E(1,2,"GLOBALS.MSG_BUTTONS.CLOSE")))}function yu(r,s){if(r&1&&(x(0,Su,5,9),x(1,Cu,2,4,"p-button",103)),r&2){let i=_(2);R(i.object.fwcloud||i.object.type==i.ObjectTypes.OBJ_INTERFACE_FIREWALL?0:-1),c(),R(!i.object.fwcloud&&i.object.type!=i.ObjectTypes.OBJ_INTERFACE_FIREWALL?1:-1)}}function Eu(r,s){if(r&1){let i=M();p(0,"p-button",112),y(1,"translate"),P("onClick",function(){w(i);let t=_(3);return g(t.reloadPanel())}),f()}if(r&2){let i=_(3);m("label",B(E(1,3,"POLICY_GRID.RELOAD")))("disabled",i.loadingData)}}function vu(r,s){if(r&1){let i=M();x(0,Eu,2,5,"p-button",110),p(1,"div",104),O(2,"p-progressSpinner"),f(),p(3,"p-button",88),y(4,"translate"),P("onClick",function(){w(i);let t=_(2);return g(t.onDeleteObject())}),f(),p(5,"p-button",111),y(6,"translate"),P("onClick",function(){w(i);let t=_(2);return g(t.onCancel())}),f()}if(r&2){let i=_(2);R(i.dependencies?0:-1),c(),m("ngStyle",Re(13,Qt,i.loadingData?"visible":"hidden")),c(),Nt(Y(15,vr)),c(),m("label",B(E(4,9,"ITEM_PANEL.HEADER.DEL_OBJ")))("disabled",!i.okToDelete||i.loadingData),c(2),m("label",B(E(6,11,"GLOBALS.MSG_BUTTONS.CANCEL")))}}function Iu(r,s){if(r&1){let i=M();p(0,"p-button",113),y(1,"translate"),P("onClick",function(){w(i);let t=_(2);return g(t.onCancel())}),f()}if(r&2){let i=_(2);m("label",B(E(1,3,"GLOBALS.MSG_BUTTONS.CLOSE")))("disabled",i.loadingData)}}function bu(r,s){if(r&1&&(x(0,yu,2,2),x(1,vu,7,16),x(2,Iu,2,5,"p-button",102)),r&2){let i=_();R(i.object?0:-1),c(),R(i.objectToDelete?1:-1),c(),R(!i.object&&!i.objectToDelete?2:-1)}}var Ir=(()=>{let s=class s extends Jt{revalidateForm(e){if(e){this.formModel.controls[e].updateValueAndValidity(),e==="netmask"&&this.formModel.controls.address&&this.formModel.controls.address.updateValueAndValidity(),e==="range_start"&&this.formModel.controls.range_end&&this.formModel.controls.range_end.updateValueAndValidity();return}for(let t in this.formModel.controls)this.formModel.controls[t].updateValueAndValidity()}srcPortsValidator(e){let t=e.get("source_port_start").value,n=e.get("source_port_end").value;return t>0&&n>0&&t>n?{sourceports:!0}:null}destPortsValidator(e){let t=e.get("destination_port_start").value,n=e.get("destination_port_end").value;return t>0&&n>0&&t>n?{destinationports:!0}:null}constructor(e,t,n,l,o,a,u,d,h,S,v,b,T,A,N,j,D,Q,X,re,ne,ae,ze,Dt){super(u,S,e,re,ze,Dt),this.itemSelectedService=e,this.ruleSelectedService=t,this.fwcObjectService=n,this.fwcFirewallService=l,this.fwcInterfaceService=o,this.fwcPolicyService=a,this.appDialogPanelsService=u,this.fwcObjectTypeService=d,this.fwcVpnService=h,this.appOptionsService=S,this.fwcMarkService=v,this.fwcUserService=b,this.fwcRoutingTableService=T,this.fwcDhcpPolicyService=A,this.confirmationService=N,this.messageService=j,this.utilService=D,this.translate=Q,this.fwcErrorPipe=X,this.cd=re,this.elementRef=ne,this.renderer=ae,this.store=ze,this.router=Dt,this.fwcUserObject={},this.ObjectTypes=I,this.RuleHooks=Zi,this.SpecialPolicyRules=ke,this.hookScriptTab=Zi.BEFORE,this.ipVersions=[{id:4,text:"IP version 4"},{id:6,text:"IP version 6"}],this.optionsFlags=[{name:this.translate.instant("RULE.OPTION_NAMES.0"),optionGroup:"STATE",status:!1,disableOnRuleActive:!0},{name:this.translate.instant("RULE.OPTION_NAMES.1"),optionGroup:"STATE",status:!1,disableOnRuleActive:!0},{name:this.translate.instant("RULE.OPTION_NAMES.2"),status:!1}],this.tabIndex=0,this.disableTabChange=!1,this.messageObject={},this.minMaxValidator=(at,st)=>rn=>{let $t=!0,Xt=0,yi=0;return this.formModel.controls[at]&&this.formModel.controls[st]&&(Xt=this.formModel.controls[at].value,yi=this.formModel.controls[st].value),$t=yi>=Xt,$t?null:{minmax:!0}},this.ipRangeValidator=(at,st)=>rn=>{let $t=this.formModel.controls[at],Xt=this.formModel.controls[st];if(!$t||!Xt)return null;let yi=$t.value,an=Xt.value;if(!yi||!an||$t.errors||Xt.errors&&Object.keys(Xt.errors).some(Ct=>Ct!=="rangeorder"))return null;try{let Ct=Eo.parse(yi),Pi=Eo.parse(an);if(Ct.kind()!==Pi.kind())return{rangeorder:!0};let Zt=Ct.toByteArray(),qn=Pi.toByteArray(),bo=Ct.kind()==="ipv4"?1:2;for(let At=0;At<Zt.length-bo;At++)if(Zt[At]!==qn[At])return{rangeorder:!0};for(let At=Zt.length-bo;At<Zt.length;At++){if(Zt[At]<qn[At])return null;if(Zt[At]>qn[At])return{rangeorder:!0}}return{rangeorder:!0}}catch{return null}},this.icmp_values=Array(256),this.icmpOptions=[{id:-1,text:"Any"},...Array.from({length:256},(at,st)=>({id:st,text:String(st)}))],this.dependencies=null,this.loadingData=!1,this.okToDelete=!1,this.alive=!0,this.infoTooltipShown=!1,this.createDialog(this.translate.instant("ITEM_PANEL.TITLE"),"fwci-ipobjects",Z.ITEM_PANEL),this.helpSection="/ipobjs"}ngOnInit(){this.icmpOptions=[{id:-1,text:"Any"},...Array.from({length:256},(e,t)=>({id:t,text:t.toString()}))],this.store.pipe(oe(()=>this.alive),di(Ji.selectDialogUuidsToReload)).subscribe(e=>{e&&e.find(t=>t===this.dialogUUID)&&this.reloadPanel()}),this.itemSelectedService.hideObjectPanel().pipe(oe(()=>this.alive)).subscribe(e=>{this.hideDialog()}),this.itemSelectedService.getItem().pipe(oe(()=>this.alive)).subscribe(e=>{if([I.OBJ_FIREWALL,I.OBJ_CLUSTER,I.OBJ_OPENVPN_CONFIG_SER,I.OBJ_OPENVPN_CONFIG_CLI,I.OBJ_WGS_CONFIG_SER,I.OBJ_WGC_CONFIG_CLI,I.OBJ_ISS_CONFIG_SER,I.OBJ_ISC_CONFIG_CLI,I.OBJ_PREFIX_FOLDER,I.OBJ_OPENVPN_PREFIX,I.OBJ_WIREGUARD_PREFIX,I.OBJ_IPSEC_PREFIX].findIndex(n=>e._fwcObjType==n)==-1){if(e.unloadAction||e.fwcloud!==null&&e.fwcloud!=null&&e.fwcloud!=this.fwcUserObject.selectedFwCloud){this.resetProperties(),this.hideDialog();return}if(e.deleteAction)this.resetProperties(),this.recenterDialog(),this.showDialog(),this.checkObjectRestrictions(e);else{let n=e.whereUsedAction;e._onlySelectInTree||(this.disableTabChange=!1,e._fwcObjType!=I.OBJ_GEN_RULE&&(this.resetProperties(),this.onItemSelect(e,n)))}}}),this.ruleSelectedService.getRule().pipe(oe(()=>this.alive)).subscribe(e=>{this.onRuleSelect(e)}),this.fwcUserService.getFwcUser().pipe(oe(()=>this.alive)).subscribe(e=>{if(e){if(this.fwcUserObject&&this.fwcUserObject.user_id==e.user_id&&this.fwcUserObject.selectedFwCloud==e.selectedFwCloud||(this.fwcUserObject=Object.assign({},e),this.fwcUserObject.user_id===null||this.fwcUserObject.user_id===void 0||this.fwcUserObject.selectedFwCloud===null||this.fwcUserObject.selectedFwCloud===void 0))return;this.fwcObjectTypeService.getObjectTypes().subscribe(t=>{if(this.OBJECT_TYPES=[],t.data)for(let n of t.data)this.OBJECT_TYPES[n.id]=n.type},t=>{ri.error("ERROR getting object types",t.error),this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(t)})})}})}ngAfterViewInit(){}ngOnDestroy(){super.ngOnDestroy()}reloadPanel(e){if(this.objectToDelete&&(this.displayDialog||this.dialogMinified)){let t=this.itemSelectedService.getActualLastMinifiedDialogId(),n=Object.assign({},this.objectToDelete);this.resetProperties(),this.recenterDialog(),this.checkObjectRestrictions(n),this.dialogId==t&&(this.showDialog(),this.itemSelectedService.setLastMinifiedDialogId(void 0)),this.store.dispatch(Ce.reloadDialogFinished({dialogUuid:this.dialogUUID}))}else if(this.object&&(this.displayDialog||this.dialogMinified)){let t=this.object.whereUsedAction;if(this.disableTabChange=!0,!e||e._fwcObjType!=I.OBJ_GEN_RULE){let n=Object.assign({},this.object);this.resetProperties(!0),this.onItemSelect(n,t),this.store.dispatch(Ce.reloadDialogFinished({dialogUuid:this.dialogUUID}))}}}showHelp(){this.appOptionsService.showHelp(this.helpSection)}resetProperties(e){e||(this.object=null,this.objectToDelete=null),this.dependencies=null,this.deleteMsg=null}onItemSelect(e,t){let n,l,o,a,u;if(n=e._fwcObjId,l=e._fwcObjType,o=e.fwcloud,a=e._fwcObjName,n==null&&l!==void 0){let d=Object.assign({},e);d.id=n,d.type=l,d.fwcloud=o,d.name=a,this.newObject(d)}else if(n!==void 0&&l!==void 0)switch(l){case I.OBJ_FIREWALL:this.fwcFirewallService.getFirewall(n,this.fwcUserObject.selectedFwCloud).subscribe(S=>{let v=S.data;v.type=l,this.parseObject(v,t,e),this.equalizeTabHeight(),this.recenterDialog(),this.objectToDelete=null,this.showDialog()},S=>{this.errorMessage=S,u=this.translate.instant("ITEM_PANEL.ERRORS.FW_LOAD",{name:a,error:S}),this.showErrorMsg(u)});break;case I.OBJ_INTERFACE_FIREWALL:case I.OBJ_INTERFACE_HOST:let d,h;l==I.OBJ_INTERFACE_HOST?(d=this.getInterfaceHost.bind(this),h=e.parent_id):(d=this.getInterface.bind(this),e._fwcFwId!==void 0&&e._fwcFwId!==null?h=e._fwcFwId:h=e.firewall),Promise.all([d(h,n),this.getInterfaceWhereUsed(n,l)]).then(([S,v])=>{let b=S.data,T=v.data;b.type=b.interface_type,this.parseObject(b,t,e),T._fwcObjType=l,this.object&&(this.object._fwcObjectInfo=T),this.equalizeTabHeight(),this.recenterDialog(),this.objectToDelete=null,this.showDialog()}).catch(S=>{u=this.translate.instant("ITEM_PANEL.ERRORS.IF_LOAD",{name:a,error:this.fwcErrorPipe.transform(S)}),this.showErrorMsg(u)});break;case I.OBJ_CONTINENT:case I.OBJ_GROUP:case I.OBJ_SERVICE_GROUP:Promise.all([this.getObjectGroup(n),this.getObjectGroupWhereUsed(n)]).then(([S,v])=>{let b=v.data,T=S.data;this.parseObject(T,t,e),b._fwcObjType=l,this.object&&(this.object._fwcObjectInfo=b),this.equalizeTabHeight(),this.recenterDialog(),this.objectToDelete=null,this.showDialog()}).catch(S=>{let v;v=this.fwcErrorPipe.transform(S),v&&(this.confirmationService.confirm({header:this.translate.instant("ITEM_PANEL.ERRORS.GROUP_READ.SUMMARY"),icon:"fa fa-exclamation-circle fwcRed iconBig",acceptLabel:"Ok",rejectVisible:!1,message:this.translate.instant("ITEM_PANEL.ERRORS.GROUP_READ.TEXT",{name:a,error:v})}),this.errorMessage=v.toString(),u=this.translate.instant("ITEM_PANEL.ERRORS.GRP_LOAD",{name:a,errorGrp:S}),this.showErrorMsg(u))});break;case I.OBJ_MARK:Promise.all([this.getMark(n),this.getMarkWhereUsed(n)]).then(([S,v])=>{let b=S.data,T=v.data;b.type=l,this.parseObject(b,t,e),T._fwcObjType=l,this.object&&(this.object._fwcObjectInfo=T),this.equalizeTabHeight(),this.recenterDialog(),this.objectToDelete=null,this.showDialog()}).catch(S=>{this.errorMessage=this.fwcErrorPipe.transform(S),u=this.translate.instant("ITEM_PANEL.ERRORS.OBJ_LOAD",{name:a,errorObject:this.errorMessage}),this.showErrorMsg(u)});break;case I.OBJ_OPENVPN_PREFIX:case I.OBJ_OPENVPN_CONFIG_CLI:Promise.all([this.getVPNObject(n,l),this.getVPNObjectWhereUsed(n,l)]).then(([S,v])=>{let b=S.data,T=v.data;b.name=b.cn,b.comment||(b.comment=""),b.fwcloud||(b.fwcloud=this.fwcUserService.getActualFwSelectedCloud()),this.parseObject(b,t,e),T._fwcObjType=l,this.object&&(this.object._fwcObjectInfo=T),this.equalizeTabHeight(),this.recenterDialog(),this.objectToDelete=null,this.showDialog()}).catch(S=>{this.errorMessage=this.fwcErrorPipe.transform(S),u=this.translate.instant("ITEM_PANEL.ERRORS.OBJ_LOAD",{name:a,errorObject:this.errorMessage}),this.showErrorMsg(u)});break;case I.OBJ_WIREGUARD_PREFIX:case I.OBJ_WGC_CONFIG_CLI:Promise.all([this.getWireGuardObject(n,l),this.getWireGuardObjectWhereUsed(n,l)]).then(([S,v])=>{let b=S.data,T=v.data;b.name=b.cn,b.comment||(b.comment=""),b.fwcloud||(b.fwcloud=this.fwcUserService.getActualFwSelectedCloud()),this.parseObject(b,t,e),T._fwcObjType=l,this.object&&(this.object._fwcObjectInfo=T),this.equalizeTabHeight(),this.recenterDialog(),this.objectToDelete=null,this.showDialog()}).catch(S=>{this.errorMessage=this.fwcErrorPipe.transform(S),u=this.translate.instant("ITEM_PANEL.ERRORS.OBJ_LOAD",{name:a,errorObject:this.errorMessage}),this.showErrorMsg(u)});break;case I.OBJ_IPSEC_PREFIX:case I.OBJ_ISS_CONFIG_SER:Promise.all([this.getIPSecObject(n,l),this.getIPSecObjectWhereUsed(n,l)]).then(([S,v])=>{let b=S.data,T=v.data;b.name=b.cn,b.comment||(b.comment=""),b.fwcloud||(b.fwcloud=this.fwcUserService.getActualFwSelectedCloud()),this.parseObject(b,t,e),T._fwcObjType=l,this.object&&(this.object._fwcObjectInfo=T),this.equalizeTabHeight(),this.recenterDialog(),this.objectToDelete=null,this.showDialog()}).catch(S=>{this.errorMessage=this.fwcErrorPipe.transform(S),u=this.translate.instant("ITEM_PANEL.ERRORS.OBJ_LOAD",{name:a,errorObject:this.errorMessage}),this.showErrorMsg(u)});break;default:Promise.all([this.getObject(n),this.getObjectWhereUsed(n,l)]).then(([S,v])=>{let b=S.data,T=v.data;this.parseObject(b,t,e),T._fwcObjType=l,this.object&&(this.object._fwcObjectInfo=T),this.equalizeTabHeight(),this.recenterDialog(),this.objectToDelete=null,this.showDialog()}).catch(S=>{this.errorMessage=this.fwcErrorPipe.transform(S),u=this.translate.instant("ITEM_PANEL.ERRORS.OBJ_LOAD",{name:a,errorObject:this.errorMessage}),this.showErrorMsg(u)});break}}checkObjectRestrictions(e){let t,n,l,o="ITEM_PANEL.DELETE_WARN.TEXT",a="ITEM_PANEL.ERRORS.RESTR_ERROR.TEXT";if(this.deleteDialogTitle="ITEM_PANEL.HEADER.DEL_OBJ",!e)return;let u=v=>{this.okToDelete=!0,this.deleteMsg={type:"warning",title:this.translate.instant("ITEM_PANEL.DELETE_WARN.SUMMARY"),text:this.translate.instant(v,{name:e._fwcObjName})}};this.objectToDelete=e,this.dependencies=null,this.okToDelete=!1;let d={fwcloud:this.fwcUserObject.selectedFwCloud,id:e._fwcObjId,type:e._fwcObjType};switch(e._fwcObjType){case I.OBJ_INTERFACE_FIREWALL:t=this.fwcInterfaceService.checkInterfaceRestrictions.bind(this.fwcInterfaceService),l=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_INTERFACE_FIREWALL"),delete d.type;break;case I.OBJ_INTERFACE_HOST:t=this.fwcInterfaceService.checkInterfaceRestrictions.bind(this.fwcInterfaceService),l=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_INTERFACE_FIREWALL"),d.host=e._fwcHostId,delete d.type;break;case I.OBJ_GROUP:case I.OBJ_SERVICE_GROUP:t=this.fwcObjectService.checkObjectGroupRestrictions.bind(this.fwcObjectService),l=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_GROUP");break;case I.OBJ_FIREWALL:break;case I.OBJ_MARK:t=this.fwcMarkService.checkMarkRestrictions.bind(this.fwcMarkService),l=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_MARK"),d.mark=d.id,delete d.id,delete d.type;break;case I.OBJ_ROUTING_TABLE:t=this.fwcRoutingTableService.checkTableRestrictions.bind(this.fwcRoutingTableService),l=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_ROUTING_TABLE"),d.firewall=e._fwcFwId,o="ITEM_PANEL.DELETE_WARN.TEXT_ROUTING_TABLE",a="ITEM_PANEL.ERRORS.RESTR_ERROR.TEXT_ROUTING_TABLE",this.deleteDialogTitle="ITEM_PANEL.HEADER.DEL_ROUTING_TABLE";break;case I.OBJ_DHCP_GROUP:t=this.fwcDhcpPolicyService.checkGroupRestrictions.bind(this.fwcDhcpPolicyService),l=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_DHCP_GROUP"),d.firewall=e._fwcFwId,o="ITEM_PANEL.DELETE_WARN.TEXT_DHCP_GROUP",a="ITEM_PANEL.ERRORS.RESTR_ERROR.TEXT_DHCP_GROUP",this.deleteDialogTitle="ITEM_PANEL.HEADER.DEL_DHCP_GROUP";break;case I.OBJ_KEEPALIVED_GROUP:t=this.fwcDhcpPolicyService.checkGroupRestrictions.bind(this.fwcDhcpPolicyService),l=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_KEEPALIVED_GROUP"),d.firewall=e._fwcFwId,o="ITEM_PANEL.DELETE_WARN.TEXT_KEEPALIVED_GROUP",a="ITEM_PANEL.ERRORS.RESTR_ERROR.TEXT_KEEPALIVED_GROUP",this.deleteDialogTitle="ITEM_PANEL.HEADER.DEL_KEEPALIVED_GROUP";break;default:t=this.fwcObjectService.checkObjectRestrictions.bind(this.fwcObjectService),l=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_GEN_IP_OBJECT");break}let h,S;e._fwcObjType===I.OBJ_INTERFACE_FIREWALL||e._fwcObjType===I.OBJ_ADDRESS&&e._fwcFwId?e._fwcClusterId?(n=this.fwcFirewallService.getClusterNodes.bind(this.fwcFirewallService),h=e._fwcClusterId,S=this.translate.instant("CLUSTER.CLUSTER_NODE_ROLES.NODE")):(n=this.fwcFirewallService.getFirewall.bind(this.fwcFirewallService),h=e._fwcFwId,S=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.FIREWALL")):n=(v,b)=>Po(null),t&&(this.loadingData=!0,$i(t(d),n(h,this.fwcUserService.getActualFwSelectedCloud())).subscribe(([v,b])=>{let T;if(!b)T=null;else{let A=[],N=b.data;Array.isArray(N)?A=[...N]:A.push(N),T=A.find(j=>e._fwcObjType===I.OBJ_INTERFACE_FIREWALL&&j.install_interface===e._fwcObjId||e._fwcObjType===I.OBJ_ADDRESS&&j.install_ipobj===e._fwcObjId)}if(!T)u(o);else{let A=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_INTERFACE_FIREWALL");e._fwcObjType===I.OBJ_ADDRESS&&(A=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_ADDRESS")),this.deleteMsg={type:"error",title:this.translate.instant("ITEM_PANEL.ERRORS.INTERFACE_IP_INSTALLATION.SUMMARY",{objType:A}),text:this.translate.instant("ITEM_PANEL.ERRORS.INTERFACE_IP_INSTALLATION.TEXT",{objName:e._fwcObjName,objType:A.toLowerCase(),fwName:T.name,fwType:S.toLowerCase()})}}this.dependencies=null,this.loadingData=!1,this.recenterDialog()},v=>{let b,T=v.error;if(T&&(T.restrictions?b=T.restrictions:T.data&&T.data.restrictions&&(b=T.data.restrictions)),b){this.dependencies=b;let A={};for(let N in this.dependencies)N!=="IpobjInterface"&&Array.isArray(this.dependencies[N])&&this.dependencies[N].length&&(A[N]=this.dependencies[N]);Object.keys(A).length?(A._fwcRestrictedObject={_fwcObjId:e._fwcObjId,_fwcObjType:e._fwcObjType},this.deleteMsg={type:"error",title:this.translate.instant("ITEM_PANEL.ERRORS.RESTR_ERROR.SUMMARY"),text:this.translate.instant(a,{name:e._fwcObjName})}):(this.dependencies=null,u(o))}else this.deleteMsg={type:"error",title:this.translate.instant("ITEM_PANEL.ERRORS.DELETE_ERROR.SUMMARY"),text:this.fwcErrorPipe.transform(v)},this.dependencies={restrictionsError:!0};this.loadingData=!1,this.recenterDialog()}))}onDeleteObject(){let e,t;this.loadingData=!0;let n={fwcloud:this.fwcUserObject.selectedFwCloud,id:this.objectToDelete._fwcObjId,type:this.objectToDelete._fwcObjType};switch(this.objectToDelete._fwcObjType){case I.OBJ_INTERFACE_FIREWALL:e=this.fwcInterfaceService.deleteInterfaceFw.bind(this.fwcInterfaceService),t=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_INTERFACE_FIREWALL"),n.firewall=this.objectToDelete._fwcFwId;break;case I.OBJ_INTERFACE_HOST:e=this.fwcInterfaceService.deleteInterfaceHost.bind(this.fwcInterfaceService),t=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_INTERFACE_FIREWALL"),n.host=this.objectToDelete._fwcHostId;break;case I.OBJ_GROUP:case I.OBJ_SERVICE_GROUP:e=this.fwcObjectService.deleteObjectGroup.bind(this.fwcObjectService),t=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_GROUP");break;case I.OBJ_FIREWALL:break;case I.OBJ_MARK:e=this.fwcMarkService.deleteMark.bind(this.fwcMarkService),t=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_MARK"),n.mark=n.id,delete n.id,delete n.type;break;case I.OBJ_ROUTING_TABLE:e=this.fwcRoutingTableService.deleteRoutingTable.bind(this.fwcRoutingTableService),t=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_ROUTING_TABLE"),n.firewall=this.objectToDelete._fwcFwId,delete n.type;break;case I.OBJ_DHCP_GROUP:e=this.fwcDhcpPolicyService.deleteDhcpPolicyRulesGroup.bind(this.fwcDhcpPolicyService),t=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_DHCP_GROUP"),n.firewall=this.objectToDelete._fwcFwId,delete n.type;break;default:e=this.fwcObjectService.deleteObject.bind(this.fwcObjectService),t=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_GEN_IP_OBJECT");break}this.utilService.fwcAPICall(e,n).then(l=>{let o=Object.assign({},this.objectToDelete),a=this.translate.instant("TREE.MSG_DELETE_OBJ_SUCCESS_1",{objtype:t});if(o._fwcTreeAction=Ye.DELETE_ITEM,l.data&&l.data.fw_status&&(o.fw_status=l.data.fw_status),this.itemSelectedService.setModifiedItem(o),this.objectToDelete._fwcObjType===I.OBJ_ROUTING_TABLE){a=this.translate.instant("ROUTING.DELETE_TABLE.SUCCESS"),this.itemSelectedService.setModifiedItem({_fwcTreeAction:Ye.RELOAD_TREE,containerToReload:Ge.C_FIREWALLS});let u=this.fwcPolicyService.getActualSelectedPolicy();u&&u._fwcPolicyType===Ne.ROUTING_TABLE&&u._fwcObjId===this.objectToDelete._fwcObjId&&this.fwcPolicyService.setSelectedPolicy({_fwcFwId:null,fwId:null})}Array.isArray(l.data)&&this.store.dispatch(rt.updateFwStatus({item:l.data})),this.hideDialog(),this.loadingData=!1,this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.OK"),detail:a})}).catch(l=>{this.deleteMsg={type:"error",title:this.translate.instant("ITEM_PANEL.ERRORS.DELETE_ERROR.SUMMARY"),text:this.fwcErrorPipe.transform(l)},this.dependencies={restrictionsError:!0},this.loadingData=!1})}showErrorMsg(e){e&&this.confirmationService.confirm({header:"Error",icon:"fa fa-exclamation-circle fwcRed iconBig",acceptLabel:"Ok",rejectVisible:!1,message:e})}getObject(e){return new Promise((n,l)=>{this.fwcObjectService.getObject(e,this.fwcUserObject.selectedFwCloud).subscribe(o=>{n(o)},o=>{l(o)})})}getObjectWhereUsed(e,t){return new Promise((l,o)=>{this.fwcObjectService.getObjectWhereUsed(e,t,this.fwcUserObject.selectedFwCloud).subscribe(a=>{l(a)},a=>{o(a)})})}getInterface(e,t){return new Promise((l,o)=>{this.fwcInterfaceService.getInterface(e,t,this.fwcUserObject.selectedFwCloud).subscribe(a=>{l(a)},a=>{o(a)})})}getInterfaceHost(e,t){return new Promise((l,o)=>{this.fwcInterfaceService.getInterfaceHost(e,t,this.fwcUserObject.selectedFwCloud).subscribe(a=>{l(a)},a=>{o(a)})})}getInterfaceWhereUsed(e,t){return new Promise((l,o)=>{this.fwcInterfaceService.getInterfaceWhereUsed(e,t,this.fwcUserObject.selectedFwCloud).subscribe(a=>{l(a)},a=>{o(a)})})}getObjectGroup(e){return new Promise((n,l)=>{this.fwcObjectService.getObjectGroup(e,this.fwcUserObject.selectedFwCloud).subscribe(o=>{n(o)},o=>{l(o)})})}getObjectGroupWhereUsed(e){return new Promise((n,l)=>{this.fwcObjectService.getObjectGroupWhereUsed(e,this.fwcUserObject.selectedFwCloud).subscribe(o=>{n(o)},o=>{l(o)})})}getVPNObject(e,t){return new Promise((l,o)=>{let a,u={fwcloud:this.fwcUserService.getActualFwSelectedCloud()};t==I.OBJ_OPENVPN_PREFIX?(a=this.fwcVpnService.getOpenVPNPrefixInfo.bind(this.fwcVpnService),u.prefix=e):t==I.OBJ_OPENVPN_CONFIG_CLI&&(a=this.fwcVpnService.getConfigInfo.bind(this.fwcVpnService),u.openvpn=e),a(u).subscribe(d=>{l(d)},d=>{o(d)})})}getVPNObjectWhereUsed(e,t){return new Promise((l,o)=>{let a,u={fwcloud:this.fwcUserService.getActualFwSelectedCloud()};t==I.OBJ_OPENVPN_PREFIX?(a=this.fwcVpnService.getOpenVPNWhereUsed.bind(this.fwcVpnService),u.prefix=e):t==I.OBJ_OPENVPN_CONFIG_CLI&&(a=this.fwcVpnService.getConfigWhereUsed.bind(this.fwcVpnService),u.openvpn=e),a(u).subscribe(d=>{l(d)},d=>{o(d)})})}getWireGuardObject(e,t){return new Promise((l,o)=>{let a,u={fwcloud:this.fwcUserService.getActualFwSelectedCloud()};t==I.OBJ_WIREGUARD_PREFIX?(a=this.fwcVpnService.getWireGuardPrefixInfo.bind(this.fwcVpnService),u.prefix=e):t==I.OBJ_WGC_CONFIG_CLI&&(a=this.fwcVpnService.getWireGuardConfig.bind(this.fwcVpnService),u.wireguard=e),a(u).subscribe(d=>{l(d)},d=>{o(d)})})}getWireGuardObjectWhereUsed(e,t){return new Promise((l,o)=>{let a,u={fwcloud:this.fwcUserService.getActualFwSelectedCloud()};t==I.OBJ_WIREGUARD_PREFIX?(a=this.fwcVpnService.getWireGuardWhereUsed.bind(this.fwcVpnService),u.prefix=e):t==I.OBJ_WGC_CONFIG_CLI&&(a=this.fwcVpnService.getWireGuardConfigWhereUsed.bind(this.fwcVpnService),u.wireguard=e),a(u).subscribe(d=>{l(d)},d=>{o(d)})})}getIPSecObject(e,t){return new Promise((n,l)=>{let o,a={fwcloud:this.fwcUserService.getActualFwSelectedCloud()};t==I.OBJ_IPSEC_PREFIX?(o=this.fwcVpnService.getIPSecPrefixInfo.bind(this.fwcVpnService),a.prefix=e):t==I.OBJ_ISC_CONFIG_CLI&&(o=this.fwcVpnService.getIPSecConfig.bind(this.fwcVpnService),a.ipsec=e),o(a).subscribe(u=>{n(u)},u=>{l(u)})})}getIPSecObjectWhereUsed(e,t){return new Promise((n,l)=>{let o,a={fwcloud:this.fwcUserService.getActualFwSelectedCloud()};t==I.OBJ_IPSEC_PREFIX?(o=this.fwcVpnService.getIPSecWhereUsed.bind(this.fwcVpnService),a.prefix=e):t==I.OBJ_ISC_CONFIG_CLI&&(o=this.fwcVpnService.getIPSecConfigWhereUsed.bind(this.fwcVpnService),a.ipsec=e),o(a).subscribe(u=>{n(u)},u=>{l(u)})})}getMark(e){return new Promise((n,l)=>{let o={fwcloud:this.fwcUserObject.selectedFwCloud,mark:e};this.fwcMarkService.getMark(o).subscribe(a=>{n(a)},a=>{l(a)})})}getMarkWhereUsed(e){return new Promise((n,l)=>{let o={fwcloud:this.fwcUserObject.selectedFwCloud,mark:e};this.fwcMarkService.getMarkWhereUsed(o).subscribe(a=>{n(a)},a=>{l(a)})})}onRuleSelect(e){let t,n,l,o,a,u;if(t=this.fwcUserObject.customer_id,n=this.fwcUserObject.selectedFwCloud,l=e.firewall,o=e.type,a=e.id,!t||!n||!l||!o||!a){this.showErrorMsg(this.translate.instant("ITEM_PANEL.ERRORS.RULE_LOAD",{id:a}));return}e.type===$[q.DHCP]||e.type===$[q.DHCP_FIXED_IP]||e.type===$[q.KEEPALIVED]||e.type===$[q.HAPROXY]||this.fwcPolicyService.getPolicyRule(l,o,a,this.fwcUserObject.selectedFwCloud).pipe(oe(()=>this.alive)).subscribe(d=>{let h;d.data&&(h=d.data,u=Object.assign({},e),delete u.positions,u.fwcloud=this.fwcUserObject.selectedFwCloud,u.name=this.translate.instant("ITEM_PANEL.RULE_NAME"),u.type=I.OBJ_GEN_RULE,u.ruleType=o,this.parseObject(u),this.showDialog())},d=>{this.errorMessage=this.fwcErrorPipe.transform(d),this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.errorMessage})})}parseObject(e,t,n){let l=0;!e||e.id===void 0||e.name===void 0||e.comment===void 0||(e._fwcObjId=e.id,e._fwcObjName=e.name,e._fwcObjType=e.type,e.type==I.OBJ_CONTINENT?e.name=this.translate.instant("NODE_TYPES."+e.name):e.type==I.OBJ_COUNTRIE&&(e.name=this.translate.instant("COUNTRIES."+e.name)),e.firewall!==null&&e.firewall!=null&&(e._fwcFwId=e.firewall),e.ipobjs&&e.ipobjs.forEach(function(o){o._fwcObjId=o.id,o._fwcObjName=o.name,o._fwcObjType=o.obj_type=o.type}),n&&n.duplicateObjectAction&&(e.id=e._fwcObjId=void 0,e._fwcObjName=e.name=e.name+"-DUP",e.container=n.container,e.containerReadOnly=n.containerReadonly,e.duplicateObjectAction=!0,e.node_parent=n.node_parent,e.node_order=1,e.node_type=n.node_type,e.fwcloud=this.fwcUserObject.selectedFwCloud),this.createForm(e),t&&(l=1,e.whereUsedAction=t),this.object=e,this.disableTabChange||(this.tabIndex=l))}newObject(e){this.createForm(e),this.object=e,this.showDialog()}createForm(e){if(e){switch(this.formModel=new Ei({id:new K(e.id),comment:new K(e.comment),type:new K(e.type)}),e.type!=I.OBJ_GEN_RULE&&this.formModel.addControl("name",new K(e.name,[ee.required,ee.pattern(Fe.nameRegExp)])),e.type){case I.OBJ_FIREWALL:break;case I.OBJ_ADDRESS:this.formModel.addControl("address",new K(e.address,{validators:Fe.ipAddressValidator.bind(this),updateOn:"blur"})),this.formModel.addControl("netmask",new K(e.netmask,{validators:Fe.netmaskValidator.bind(this),updateOn:"blur"})),this.formModel.addControl("ip_version",new K(e.ip_version?e.ip_version:this.ipVersions[0].id)),this.formModel.addControl("interface",new K(e.interface));break;case I.OBJ_ADDRESS_RANGE:this.formModel.addControl("range_start",new K(e.range_start,{validators:Fe.ipAddressValidator.bind(this),updateOn:"blur"})),this.formModel.addControl("range_end",new K(e.range_end,{validators:[Fe.ipAddressValidator.bind(this),this.ipRangeValidator("range_start","range_end")],updateOn:"blur"})),this.formModel.addControl("ip_version",new K(e.ip_version?e.ip_version:this.ipVersions[0].id));break;case I.OBJ_NETWORK:this.formModel.addControl("address",new K(e.address,{validators:Fe.networkAddressValidator.bind(this),updateOn:"blur"})),this.formModel.addControl("netmask",new K(e.netmask,{validators:Fe.netmaskValidator.bind(this),updateOn:"blur"})),this.formModel.addControl("ip_version",new K(e.ip_version?e.ip_version:this.ipVersions[0].id));break;case I.OBJ_HOST:break;case I.OBJ_GROUP:break;case I.OBJ_DNS:this.formModel.controls.name.setValidators([ee.required,ee.pattern(Fe.fqdnRegexp)]);break;case I.OBJ_INTERFACE_HOST:case I.OBJ_INTERFACE_FIREWALL:this.formModel.addControl("labelName",new K(e.labelName,ee.pattern(Fe.nameRegExp))),this.formModel.addControl("mac",new K(e.mac,ee.pattern(Fe.macRegexp)));break;case I.OBJ_SERVICE_IP:this.formModel.addControl("protocol",new K(e.protocol,[ee.min(0),ee.max(255)]));break;case I.OBJ_SERVICE_TCP:this.formModel.addControl("tcp_flags_mask",new K(e.tcp_flags_mask)),this.formModel.addControl("tcp_flags_settings",new K(e.tcp_flags_settings)),this.formModel.addControl("source_port_start",new K(e.source_port_start?e.source_port_start:0,[ee.required,ee.min(0),ee.max(65535)])),this.formModel.addControl("source_port_end",new K(e.source_port_end?e.source_port_end:0,[ee.required,ee.min(0),ee.max(65535)])),this.formModel.addControl("destination_port_start",new K(e.destination_port_start?e.destination_port_start:0,[ee.required,ee.min(0),ee.max(65535)])),this.formModel.addControl("destination_port_end",new K(e.destination_port_end?e.destination_port_end:0,[ee.required,ee.min(0),ee.max(65535)])),this.formModel.addControl("protocol",new K(e.protocol,[ee.min(0),ee.max(255)])),this.formModel.setValidators([this.srcPortsValidator,this.destPortsValidator]),this.setTCPFlags(e.tcp_flags_mask,e.tcp_flags_settings);break;case I.OBJ_SERVICE_ICMP:this.formModel.addControl("icmp_type",new K(e.icmp_type?e.icmp_type:-1,[ee.required,ee.min(-1),ee.max(255)])),this.formModel.addControl("icmp_code",new K(e.icmp_code?e.icmp_code:-1,[ee.required,ee.min(-1),ee.max(255)])),this.formModel.addControl("protocol",new K(e.protocol,[ee.min(0),ee.max(255)]));break;case I.OBJ_SERVICE_UDP:this.formModel.addControl("source_port_start",new K(e.source_port_start?e.source_port_start:0,[ee.required,ee.min(0),ee.max(65535)])),this.formModel.addControl("source_port_end",new K(e.source_port_end?e.source_port_end:0,[ee.required,ee.min(0),ee.max(65535)])),this.formModel.addControl("destination_port_start",new K(e.destination_port_start?e.destination_port_start:0,[ee.required,ee.min(0),ee.max(65535)])),this.formModel.addControl("destination_port_end",new K(e.destination_port_end?e.destination_port_end:0,[ee.required,ee.min(0),ee.max(65535)])),this.formModel.addControl("protocol",new K(e.protocol,[ee.min(0),ee.max(255)])),this.formModel.setValidators([this.srcPortsValidator,this.destPortsValidator]);break;case I.OBJ_SERVICE_GROUP:break;case I.OBJ_GEN_RULE:this.formModel.addControl("firewall",new K(e.firewall)),this.formModel.addControl("options",new K(e.options)),this.formModel.addControl("run_before",new K(e.run_before)),this.formModel.addControl("run_after",new K(e.run_after));let t=!!e.run_before,n=!!e.run_after;this.hookScriptTab=t||!n?Zi.BEFORE:Zi.AFTER,this.setOptionsFlags(e);break;case I.OBJ_MARK:this.formModel.addControl("code",new K(e.code,[ee.required,ee.min(1)]));break}this.formModel.get("ip_version")?.valueChanges.subscribe(()=>{this.formModel.get("address")?.updateValueAndValidity()}),this.formModel.get("netmask")?.valueChanges.subscribe(()=>{this.formModel.get("address")?.updateValueAndValidity()}),e.duplicateObjectAction&&this.formModel.markAsDirty()}}setOptionsFlags(e){if(e){let t;for(let n=0;n<this.optionsFlags.length;n++){let l=this.optionsFlags[n];t=!!(e.options&2**n),l.status=t}}}onChangeOptionsFlags(e,t){let n=0,l=this.optionsFlags[e],o=typeof t=="boolean"?t:!!t;l.status=o,l.optionGroup&&this.optionsFlags.forEach((a,u)=>{u!==e&&a.optionGroup===l.optionGroup&&(a.status=!1)}),this.optionsFlags.forEach((a,u)=>{a.status&&(n|=2**u)}),this.formModel.controls.options.setValue(n),this.formModel.markAsDirty()}isSpecialRuleNonHookscript(){let e=this.object?.special;if(!e)return!1;let t=String(e).toUpperCase(),n=Number(e),l=t==="HOOKSCRIPT"||n===ke.HOOKSCRIPT;return!!e&&!l}setTCPFlags(e,t){let n=["URG","ACK","PSH","RST","SYN","FIN"];this.tcpFlagsArray=[];for(let l=0;l<n.length;l++){let o,a=n[l],u=!!(e&2**l),d=!!(t&2**l);o={name:a,mask:u,status:d},this.tcpFlagsArray.push(o)}}setFormTCPFlags(e){let t=0,n=0;this.tcpFlagsArray[e].mask||(this.tcpFlagsArray[e].status=!1);for(let l=0;l<this.tcpFlagsArray.length;l++){let o=this.tcpFlagsArray[l].mask,a=this.tcpFlagsArray[l].status;o&&(t|=2**l),a&&(n|=2**l)}this.formModel.controls.tcp_flags_mask.setValue(t),this.formModel.controls.tcp_flags_settings.setValue(n),this.formModel.markAsDirty()}checkForm(e){e&&e.target&&e.target.type!="textarea"&&this.formModel.valid&&(e.target.blur(),this.onSave())}onSave(e=0){if(this.object)if(this.loadingData=!0,this.objErrorMessage=null,this.object.id==null){let t={fwcloud:this.fwcUserObject.selectedFwCloud},n=this.object;for(let a in this.formModel.controls)t[a]=n[a]=this.formModel.controls[a].value!==null&&this.formModel.controls[a].value!==void 0?this.formModel.controls[a].value:void 0;this.object.type!=I.OBJ_MARK&&(t.node_parent=+this.object.node_parent,t.node_order=+this.object.node_order,t.node_type=this.object.node_type),e&&(t.force=e);let l,o;switch(this.object.type){case I.OBJ_FIREWALL:o=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.FIREWALL");break;case I.OBJ_INTERFACE_FIREWALL:case I.OBJ_INTERFACE_HOST:l=this.fwcInterfaceService.newInterface.bind(this.fwcInterfaceService),o=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_INTERFACE_FIREWALL"),t.firewall=this.object.firewall||this.object.firewall_id||this.object._fwcFwId,t.host=this.object.host||this.object.host_id||this.object._fwcHostId,t.interface_type=this.object.interface_type;break;case I.OBJ_GROUP:case I.OBJ_SERVICE_GROUP:l=this.fwcObjectService.newObjectGroup.bind(this.fwcObjectService),o=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_GROUP");break;case I.OBJ_MARK:l=this.fwcMarkService.newMark.bind(this.fwcMarkService),o=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_MARK"),t.node_id=this.object.node_parent,delete t.type;break;default:l=this.fwcObjectService.newObject.bind(this.fwcObjectService),o=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_GEN_IP_OBJECT");break}this.utilService.fwcAPICall(l,t).then(a=>{let u=a.data.insertId,d=a.data.TreeinsertId;this.object.id=this.object.id_obj=this.object._fwcObjId=u,this.formModel.controls.id.setValue(u),this.object.id_node=this.object._fwcObjTreeId=d,this.object._fwcObjTreeParentId=this.object.node_parent,this.object.text=this.object.name,this.object.obj_type=this.object._fwcObjType,this.object.firewall!==void 0&&this.object.firewall!==null&&(this.object._fwcFwId=this.object.firewall),n._fwcTreeAction=Ye.NEW_ITEM,this.itemSelectedService.setModifiedItem(n),a.data&&a.data.fw_status&&this.store.dispatch(rt.updateFwStatus({item:a.data.fw_status})),this.formModel.markAsPristine(),this.object._fwcObjType==I.OBJ_GROUP||this.object._fwcObjType==I.OBJ_SERVICE_GROUP?(this.displayDialog=!0,this.onItemSelect(this.object)):this.onCancel(),this.loadingData=!1,this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.OK"),detail:this.translate.instant("ITEM_PANEL.OBJ_CREATED",{objType:o})})}).catch(a=>{if(a&&a.status==400&&a.error&&a.error.fwcErr==1003)if(this.object.type!=I.OBJ_MARK){let u=a.data;this.confirmDuplicateOperation(u)}else this.confirmationService.confirm({header:this.translate.instant("ITEM_PANEL.ERRORS.DUP_MARK_ERROR.SUMMARY"),icon:"fa fa-exclamation-circle fwcRed iconBig",acceptLabel:"Ok",rejectVisible:!1,message:this.translate.instant("ITEM_PANEL.ERRORS.DUP_MARK_ERROR.TEXT")});else this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(a)});this.loadingData=!1})}else{if(!this.object.fwcloud&&this.object.type!=I.OBJ_INTERFACE_FIREWALL)return;let t={fwcloud:this.fwcUserObject.selectedFwCloud},n=Object.assign({},this.object);for(let a in this.formModel.controls)t[a]=n[a]=this.formModel.controls[a].value!==null&&this.formModel.controls[a].value!==void 0?this.formModel.controls[a].value:void 0;this.formModel.controls.name&&(n._fwcObjName=this.formModel.controls.name.value),n._fwcUserId=this.fwcUserObject.user_id;let l,o;switch(n.type){case I.OBJ_FIREWALL:l=this.fwcFirewallService.updateFirewall.bind(this.fwcFirewallService),o=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.FIREWALL");break;case I.OBJ_INTERFACE_FIREWALL:case I.OBJ_INTERFACE_HOST:l=this.fwcInterfaceService.updateInterface.bind(this.fwcInterfaceService),o=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_INTERFACE_FIREWALL"),t.interface_type=this.object.interface_type;break;case I.OBJ_GROUP:case I.OBJ_SERVICE_GROUP:l=this.fwcObjectService.updateObjectGroup.bind(this.fwcObjectService),o=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_GROUP");break;case I.OBJ_GEN_RULE:l=this.fwcPolicyService.updatePolicyRuleAsObject.bind(this.fwcPolicyService),o=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_RULE"),t.type=n.type=n.ruleType,t.run_before||(t.run_before=null),t.run_after||(t.run_after=null),t.rule=t.id,delete t.id;break;case I.OBJ_MARK:l=this.fwcMarkService.updateMark.bind(this.fwcMarkService),o=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_MARK"),t.mark=t.id,delete t.id,delete t.type;break;default:l=this.fwcObjectService.updateObject.bind(this.fwcObjectService),o=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_GEN_IP_OBJECT");break}e&&(t.force=e),this.utilService.fwcAPICall(l,t).then(a=>{if(a.data&&a.data.fw_status&&(n.fw_status=a.data.fw_status),n.ruleType){let u;u={id:n.id,firewall:n.firewall,type:n.ruleType,options:n.options,run_before:n.run_before,run_after:n.run_after},this.ruleSelectedService.setModifiedRule(u),this.store.dispatch(rt.updateFwStatus({item:{cluster:this.object._fwcClusterId,id:this.object._fwcFwId,status:3}}))}else n._fwcTreeAction=Ye.MODIFY_ITEM,this.itemSelectedService.setModifiedItem(n),this.store.dispatch(rt.updateFwStatus({item:n.fw_status})),this.itemSelectedService.updateClipboardItem(n);this.loadingData=!1,this.formModel.markAsPristine(),this.onCancel(),this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.OK"),detail:this.translate.instant("ITEM_PANEL.OBJ_UPDATED",{objType:o})})}).catch(a=>{if(a&&a.status==400&&a.error&&a.error.fwcErr==1003)if(this.object.type!=I.OBJ_MARK){let u;Array.isArray(a.data)&&(u=a.data.filter(d=>d.id!=this.object.id),u&&u.length&&this.confirmDuplicateOperation(u))}else this.confirmationService.confirm({header:this.translate.instant("ITEM_PANEL.ERRORS.DUP_MARK_ERROR.SUMMARY"),icon:"fa fa-exclamation-circle fwcRed iconBig",acceptLabel:"Ok",rejectVisible:!1,message:this.translate.instant("ITEM_PANEL.ERRORS.DUP_MARK_ERROR.TEXT")});else a&&a.status===400&&a.data==="The interface cannot be updated. There are references in dhcp_r."?this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.translate.instant("ITEM_PANEL.ERRORS.INTERFACE_MAC_ERROR.TEXT")}):this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(a)});this.loadingData=!1})}}onCancel(e){!e&&this.formModel&&!this.formModel.pristine&&this.formModel.valid?this.confirmationService.confirm({header:this.translate.instant("GLOBALS.MSG_CONFIRM"),icon:"fa fa-question-circle fwcBlue iconBig",message:this.translate.instant("ITEM_PANEL.MSG_EXIT"),accept:()=>{this.onCancel(!0)},rejectVisible:!0,rejectLabel:"No",acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.YES")}):(this.hideDialog(),this.objErrorMessage=null,this.object=null,this.objectToDelete=null,this.fwcUserService.setConfirmationToken(void 0),this.deleteMsg=null)}equalizeTabHeight(){}onDialogShow(){setTimeout(()=>{this.inputObjName&&this.inputObjName.nativeElement.focus();let e=0;this.object&&this.object.whereUsedAction&&(e=1),this.tabIndex=e,this.equalizeTabHeight(),this.recenterDialog()},150)}onDialogHide(){}onTabChange(e){e&&(this.tabIndex=e.index,this.recenterDialog())}showRestrictions(e,t){e&&(e._fwcShowRestrictions=!0,this.infoTooltipTimer=setTimeout(()=>{this.infoTooltipShown=!0,this.itemSelectedService.setObjectInfo(e,t)},1e3))}hideRestrictions(e){this.infoTooltipTimer&&(clearTimeout(this.infoTooltipTimer),this.infoTooltipTimer=void 0),this.infoTooltipShown&&(this.itemSelectedService.setObjectInfo(void 0,e),this.infoTooltipShown=!1)}confirmDuplicateOperation(e){let t="";if(this.loadingData=!1,e.length){t="<ul>";for(let n=0;n<e.length;n++)t+="<li><strong>"+e[n].name+"</strong> (Id: "+e[n].id+") </li>";t+="</ul>"}this.confirmationService.confirm({header:this.translate.instant("ITEM_PANEL.ERRORS.DUP_WARNING.SUMMARY"),icon:"fa fa-question-circle fwcBlue iconBig",message:this.translate.instant("ITEM_PANEL.ERRORS.DUP_WARNING.TEXT",{objects:t}),rejectVisible:!0,rejectLabel:"No",acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.YES"),accept:()=>{this.onSave(1)}})}};s.\u0275fac=function(t){return new(t||s)(L(He),L(Ue),L(gn),L(fe),L($e),L(ye),L(kt),L(wn),L(nl),L(Ot),L(mn),L(ge),L(Cn),L(wi),L(Le),L(Ee),L(me),L(ue),L(be),L(we),L(Ro),L(Ri),L(Se),L(Ut))},s.\u0275cmp=je({type:s,selectors:[["sts-fwc-item-panel"]],viewQuery:function(t,n){if(t&1&&(_e(o_,5),_e(l_,5)),t&2){let l;se(l=ce())&&(n.tbvItemTabview=l.first),se(l=ce())&&(n.inputObjName=l.first)}},standalone:!1,features:[Ve([gn,fe,$e,wn,mn]),ct],decls:8,vars:6,consts:[["dlgItemPanel",""],["header",""],["footer",""],["inputObjName",""],[3,"visibleChange","onShow","onHide","styleClass","visible","modal","closable"],[1,"first-tabview","tabTabbedMenu","flex","flex-col","w-full","bg-(--surfaceBackgroundColor)"],[1,"divFormHeader"],[1,"divHeaderButtons"],["type","button","icon","fa fa-question",3,"disabled"],["type","button","styleClass","p-button-secondary","icon","fa fa-window-minimize",3,"onClick"],[1,"fwcWhite","fwcIconLeft"],[1,"fwcMenuIcon","fwci-edit","fwcOrange"],[1,"fwcSep"],["aria-hidden","true"],[1,"fwcMenuIcon","fwci-new","fwcOrange"],[1,"fwcMenuIcon","fwci-delete","fwcOrange"],["type","button","icon","fa fa-question",3,"onClick","disabled"],[1,"flex","flex-wrap","fwc-tabbar"],["type","button",1,"fwc-tab-button",3,"click","disabled"],[1,"fa","fa-pencil","fwcOrange"],[1,"fa","fa-info-circle","fwcOrange"],[1,"fwc-item-panel-section"],[4,"ngIf"],[1,"fwcObjectPanel"],[3,"formGroup"],[3,"keyup.enter","keyup.esc","disabled"],[1,"grid"],[3,"ngClass"],[1,"col-6"],[1,"col-4"],[1,"col-12"],[1,"col-3"],[1,"col-12","mt-4"],[1,"p-inputgroup"],[1,"p-float-label"],["pInputText","","type","text","formControlName","name","name","name","maxlength","64",3,"drop"],["for","name"],[1,"fwc-error",2,"margin-bottom","1.2em",3,"ngStyle"],["pInputText","","type","text","maxlength","45","formControlName","address","name","address",3,"drop","blur"],["for","address"],[1,"fwc-error"],["pInputText","","type","text","maxlength","15","formControlName","netmask","name","netmask",3,"drop","blur"],["for","netmask"],["pInputText","","type","text","maxlength","45","formControlName","range_start","name","range_start",3,"drop","blur"],["for","range_start"],["pInputText","","type","text","maxlength","45","formControlName","range_end","name","range_end",3,"drop","blur"],["for","range_end"],[1,"p-float-label","w-full"],["inputId","ip_version","formControlName","ip_version","name","ip_version","optionLabel","text","optionValue","id","dataKey","id","appendTo","body","styleClass","fwcSelect w-full",3,"onChange","options","autoDisplayFirst"],["for","ip_version"],[3,"groupId","readOnly","groupType","groupTreeId","ipobjs"],[1,"fwcFloatLabel"],[1,"fwc-error",3,"ngStyle"],["pInputText","","type","number","formControlName","protocol","name","protocol","min","0","max","255",3,"drop","click"],["for","protocol"],[1,"fieldsetFixed",3,"legend"],["pInputText","","type","number","formControlName","source_port_start","name","source_port_start","min","0","max","65535",3,"drop","click"],["for","source_port_start"],["pInputText","","type","number","formControlName","source_port_end","name","source_port_end","min","0","max","65535",3,"drop","click"],["for","source_port_end"],["pInputText","","type","number","formControlName","destination_port_start","name","destination_port_start","min","0","max","65535",3,"drop","click"],["for","destination_port_start"],["pInputText","","type","number","formControlName","destination_port_end","name","destination_port_end","min","0","max","65535",3,"drop","click"],["for","destination_port_end"],["type","hidden","formControlName","tcp_flags_mask","name","tcp_flags_mask"],["type","hidden","formControlName","tcp_flags_settings","name","tcp_flags_settings"],[1,"unstriped","fwcFlagsTable"],[3,"ngModelChange","onChange","inputId","binary","ngModel","ngModelOptions","disabled"],[3,"ngModelChange","onChange","inputId","binary","ngModel","ngModelOptions","ngStyle","disabled"],["inputId","icmp_type","formControlName","icmp_type","name","icmp_type","optionLabel","text","optionValue","id","dataKey","id","appendTo","body","styleClass","fwcSelect w-full",3,"onChange","options","autoDisplayFirst"],["for","icmp_type"],["inputId","icmp_code","formControlName","icmp_code","name","icmp_code","optionLabel","text","optionValue","id","dataKey","id","appendTo","body","styleClass","fwcSelect w-full",3,"onChange","options","autoDisplayFirst"],["for","icmp_code"],["pInputText","","type","text","maxlength","64","formControlName","labelName","name","labelName",3,"drop"],["for","labelName"],["pInputText","","type","text","maxlength","17","formControlName","mac","name","mac",3,"drop"],["for","mac"],["pInputText","","type","number","formControlName","code","name","code",3,"drop"],["for","code"],[1,"col-12","md:col-4"],[1,"noVertPad","fwcBlue","botBorder"],[1,"col-12","md:col-8"],[1,"tbvRuleHooks",3,"valueChange","value"],[3,"value"],[1,"fa","fa-fw","fa-upload"],[1,"fa","fa-fw","fa-download"],["pInputText","","formControlName","run_before",2,"margin-top","0 !important",3,"placeholder"],[1,"fwc-right"],["type","button","styleClass","p-button-danger","icon","fa fa-trash",3,"onClick","disabled","label"],["pInputText","","formControlName","run_after",2,"margin-top","0 !important",3,"placeholder"],[3,"ngModelChange","onChange","inputId","binary","disabled","ngModel","ngModelOptions"],[1,"fwc-checkbox-label"],["pInputText","","formControlName","comment","name","comment","maxlength","255",3,"drop"],["for","comment"],[3,"message"],["id","infoPanel"],[1,"col-12","grid","grid-nogutter"],[2,"width","100%"],[3,"onHideParent","objectInfo"],[1,"col-12","divCentered"],[1,"fwcRestrictionsContainer"],[3,"onHideParent","onRefreshRestrictions","dependencies"],["icon","pi pi-times",3,"disabled","label"],["icon","pi pi-times",3,"label"],[1,"divLoadTemp",3,"ngStyle"],["styleClass","p-button-danger","icon","pi pi-times",3,"label","disabled"],["styleClass","p-button-success","icon","fa fa-save",3,"label","disabled"],["styleClass","p-button-danger","icon","pi pi-times",3,"onClick","label","disabled"],["styleClass","p-button-success","icon","fa fa-save",3,"onClick","label","disabled"],["icon","pi pi-times",3,"onClick","label"],["type","button","styleClass","fwc-left-float","icon","fa fa-refresh",3,"disabled","label"],["type","button","icon","pi pi-check",3,"onClick","label"],["type","button","styleClass","fwc-left-float","icon","fa fa-refresh",3,"onClick","disabled","label"],["icon","pi pi-times",3,"onClick","disabled","label"]],template:function(t,n){if(t&1){let l=M();p(0,"p-dialog",4,0),H("visibleChange",function(a){return w(l),W(n.displayDialog,a)||(n.displayDialog=a),g(a)}),P("onShow",function(){return w(l),g(n.onDialogShow())})("onHide",function(){return w(l),g(n.onDialogHide())}),J(2,E_,5,3,"ng-template",null,1,pe),x(4,pu,15,14,"div",5),x(5,mu,3,2),J(6,bu,3,3,"ng-template",null,2,pe),f()}t&2&&(m("styleClass",(n.object==null?null:n.object.type)!=n.ObjectTypes.OBJ_GROUP&&(n.object==null?null:n.object.type)!=n.ObjectTypes.OBJ_SERVICE_GROUP?"dlgFwcDialog fwcObjectDialog":"dlgFwcDialog fwcObjectDialog fwcObjectDialog--small"),V("visible",n.displayDialog),m("modal",!1)("closable",!1),c(4),R(n.object?4:-1),c(),R(n.objectToDelete?5:-1))},dependencies:[pt,Gt,Mi,Gi,ai,si,bt,Ni,ci,Bi,Jo,Pt,Vo,Ui,ki,Al,Yi,Yt,Bl,Ht,Wt,Ze,fi,yl,Cl,Sl,wl,gl,vl,hi,Rt,dl,Tn,dt],styles:[`.modalMsg{text-align:center;border-bottom:1px solid}div.fwcItemData{padding-bottom:2rem}.fwcFlagsTable{font-size:.9em}.fwcFlagsTable th,.fwcFlagsTable td{padding:.2rem}.fwcFlagsTable th,.fwcFlagsTable td:first-child{color:var(--fwcDark)}.fieldsetFixed{height:10rem}.fieldsetFixed .p-fieldset-legend-text{font-family:Arial,Montserrat,sans-serif;color:var(--fwcPaleDark)}.tbvRuleHooks.p-tabs{padding:0}.tbvRuleHooks textarea{font-family:monospace!important;height:10rem!important}.tbvRuleHooks .p-tablist{margin-bottom:0}.tbvRuleHooks .p-tablist-tab-list{border:1px solid var(--fwcGrey2);border-bottom:0;border-radius:.2rem .2rem 0 0;overflow:hidden}.tbvRuleHooks .p-tab{display:inline-flex;align-items:center;gap:.5rem;padding:.55rem 1rem;background:var(--fwcGrey4);border:0;color:var(--fwcMidDark);font-weight:600;margin:0}.tbvRuleHooks .p-tab+.p-tab{border-left:1px solid var(--fwcGrey2)}.tbvRuleHooks .p-tab.p-tab-active{background:#0074c7;color:#fff;border-color:#0060a3}.tbvRuleHooks .p-tab .fa{color:var(--fwcOrange)}.tbvRuleHooks .p-tab.p-tab-active .fa{color:#fff}.tbvRuleHooks .p-tabpanels{border:1px solid var(--fwcGrey2);border-radius:0 0 .2rem .2rem;padding:1rem;background:var(--surfaceBackgroundColor)}.fwc-item-panel-section{display:flex;flex-direction:column;flex:1 1 0%;padding:1rem 1rem .571rem!important;overflow:hidden;box-sizing:border-box;border:1px solid var(--fwcGrey2);border-bottom-right-radius:3px;border-bottom-left-radius:3px;background:var(--surfaceBackgroundColor)}.fwc-item-panel-section *{max-width:100%!important;box-sizing:border-box;flex-shrink:1;overflow-wrap:break-word}.p-float-label textarea.p-filled~label{top:0;margin-top:-2rem}.p-float-label textarea:focus~label{margin-top:-.5rem}.fwc-tabbar{gap:.2rem;background:transparent}.p-float-label input.p-filled~label,.p-float-label input:focus~label{top:0;margin-top:-1rem}.p-float-label .p-inputwrapper-filled~label,.p-float-label .p-inputwrapper-focus~label,.p-float-label .p-inputtext-filled~label,.p-float-label .p-inputtext-focus~label{top:0;margin-top:-1rem}.p-floatlabel:has(textarea:focus) label,.p-floatlabel:has(textarea.p-filled) label{top:0;margin-top:-1.4rem}.p-floatlabel:has(textarea.p-filled:not(:focus)) label{margin-top:-2.4rem}
`],encapsulation:2,data:{animation:[bn]}});let r=s;return r})();var Tu=["fwcMessageComponent"];function Ou(r,s){r&1&&(p(0,"div",5)(1,"h6",6),O(2,"i",7),C(3),y(4,"translate"),f()()),r&2&&(c(3),F(" ",E(4,1,"FW.MSG_FW_EDITION.PLUGINS")," "))}function xu(r,s){if(r&1){let i=M();p(0,"p-button",8),y(1,"translate"),P("onClick",function(){w(i);let t=_();return g(t.onCloseDialog())}),f()}if(r&2){let i=_();m("label",B(E(1,3,"GLOBALS.MSG_BUTTONS.CLOSE")))("disabled",i.loadingData)}}var Ru=3e5;var br=(()=>{let s=class s extends Jt{constructor(e,t,n,l,o,a,u,d,h,S,v,b,T,A,N,j){super(u,t,e,A,N,j),this.itemSelectedService=e,this.appOptionsService=t,this.fwcUserService=n,this.fwcFirewallService=l,this.fwcPolicyService=o,this.fwcErrorPipe=a,this.appDialogPanelsService=u,this.confirmationService=d,this.messageService=h,this.inputDataService=S,this.fwcEventService=v,this.utilService=b,this.translate=T,this.cd=A,this.store=N,this.router=j,this.displayDialog=!1,this.loadingData=!1,this.NodesError=[],this.error_plugin=!1,this.isDestroyed=!1,this.pluginEventEmitter=new ti,this.createDialog(this.translate.instant("COMPILE.PANEL_TITLE"),"fwci-compileallfirewalls")}ngOnInit(){this.itemSelectedService.getFirewallToPluginOperation().subscribe(e=>{this.showPanelforFirewall(e)}),this.itemSelectedService.getClusterToPluginOperation().subscribe(e=>{this.showPanelforCluster(e)}),this.channel_id=Ft()}startProcess(){this.loadingData=!0,this.log&&this.log.startDataLoad()}stopProcess(){this.loadingData=!1,clearTimeout(this.timeoutTimer),this.log&&this.log.stopDataLoad()}startTimeoutHandler(){this.timeoutTimer=setTimeout(()=>{this.timeout(),this.eventsSubscription.unsubscribe(),this.stopProcess()},Ru)}refreshTimeoutHandler(){clearTimeout(this.timeoutTimer),this.startTimeoutHandler()}ngOnDestroy(){this.isDestroyed=!0,super.ngOnDestroy()}timeout(){this.addMessageToLog(this.translate.instant("COMPILE.WARN_TIMEOUT"),z.MSG_WARNING)}pingNodes(e){return le(this,null,function*(){let t=!1;for(let n=0;n<e.length;n++){if(this.isDestroyed)return t;let l=e[n];if(l.firewall.install_communication=="agent"){let o={communication:l.firewall.install_communication,host:l.address,port:l.firewall.install_port,protocol:l.firewall.install_protocol,apikey:l.firewall.install_apikey};l.firewall.name?this.addMessageToLog(this.translate.instant("CLUSTER.PLUGINS.PING",{node:l.firewall.name}),z.MSG_INFO):this.addMessageToLog(this.translate.instant("CLUSTER.PLUGINS.PING_NO_NAME"),z.MSG_INFO),yield this.utilService.fwcAPICall(this.fwcFirewallService.checkFwCommunication.bind(this.fwcFirewallService),this.fwcUserService.getActualFwSelectedCloud(),o).then(a=>{this.log.setDataLoad(!1),this.addMessageToLog(this.translate.instant("GLOBALS.MSG_OP_ASK.OK"),z.MSG_OK),this.addMessageToLog("",z.MSG_SEPARATOR)}).catch(a=>{if(this.log.setDataLoad(!1),a.error){let u;u=this.utilService.isCommunicationError(a.error),u?(this.addMessageToLog(this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:u}),z.MSG_ERROR),this.addMessageToLog("",z.MSG_SEPARATOR)):(this.addMessageToLog(this.translate.instant("CLUSTER.PLUGINS.ERROR_PING"),z.MSG_ERROR),this.addMessageToLog("",z.MSG_SEPARATOR))}t=!0})}else l.firewall.name?(this.addMessageToLog(this.translate.instant("CLUSTER.PLUGINS.PING",{node:l.firewall.name}),z.MSG_INFO),this.addMessageToLog(this.translate.instant("CLUSTER.PLUGINS.SSH_COMMUNICATION",{node:l.firewall.name}),z.MSG_WARNING),this.addMessageToLog("",z.MSG_SEPARATOR)):(this.addMessageToLog(this.translate.instant("CLUSTER.PLUGINS.PING_NO_NAME"),z.MSG_INFO),this.addMessageToLog(this.translate.instant("CLUSTER.PLUGINS.SSH_COMMUNICATION_NO_NAME"),z.MSG_WARNING),this.addMessageToLog("",z.MSG_SEPARATOR));this.log.setDataLoad(!1)}return t})}waitWSMessages(){return new Promise((t,n)=>{this.startTimeoutHandler(),this.options.channelId?(this.eventsSubscription=this.fwcEventService.getEvent().pipe(oe(()=>this.displayDialog)).subscribe(l=>{this.refreshTimeoutHandler();let o=new On(l);if(o&&o.payload)if(o.payload.type)if(o.payload.type===z.MSG_END){t(o);return}else o.payload.type===z.MSG_ERROR?(this.operationResult={error:!0},this.NodesError.push(this.nodeName),this.statusMessage={type:"error",text:this.translate.instant("GLOBALS.MSG_OP_RESULT.PROCESS_ERROR")},o.payload.message.includes("socket")&&(this.log.addNewMessage(o),t(null))):this.options.showStatusMessage?this.fwcMessageComponent&&this.fwcMessageComponent.changeStatus(o.payload.message,this.translate.instant("ITEM_BATCH.TABLE_HEADER.1")+":"):this.log&&(o.payload.message==="ENABLED"?this.stopProcess():o.payload.message==="DISABLED"?this.stopProcess():o.payload.message==="NOT_SUPPORTED"?(this.operationResult={error:!0},this.stopProcess()):o.payload.message.toLowerCase().startsWith("error")?(this.log.addNewMessage(o),this.operationResult={error:!0},this.NodesError.push(this.nodeName)):this.log.addNewMessage(o));else this.addMessageToLog(this.translate.instant("API_ERROR.client-socket"),z.MSG_ERROR),this.operationResult={error:!0},this.NodesError.push(this.nodeName),this.stopProcess();else this.addMessageToLog(this.translate.instant("LOG_PANEL.MALFORMED_MSG"),z.MSG_ERROR),this.operationResult={error:!0},this.NodesError.push(this.nodeName),this.stopProcess()}),this.utilService.ioListenOnLogEvent(this.options.channelId)):t(null)})}doApiCall(){return new Promise((t,n)=>{this.options.apiCall?(Array.isArray(this.options.apiParams)||(this.options.apiParams=[]),this.options.showStatusMessage&&(this.statusMessage={type:"loading",text:this.translate.instant("GLOBALS.MSG_OP_RESULT.OPERATION_IN_PROGRESS")}),this.utilService.fwcAPICall(this.options.apiCall,...this.options.apiParams).then(l=>{t(l)}).catch(l=>{n(l)})):t({})})}showPanelforCluster(e){this.showDialog();let t;return new Promise(n=>le(this,null,function*(){if(this.isDestroyed)return n(this.error_plugin);let l=this.utilService.createDynamicComponentRef(tn),o=l.instance;o.setDynamicComponentRef(l),this.mainEventsSubscription=o.socketEventEmitter.subscribe(a=>le(this,null,function*(){if(a=="connected"){if(this.showDialog(),this.startProcess(),this.error_plugin=yield this.pingNodes(e.nodes),!this.error_plugin){e.enable?t=this.translate.instant("FW.PLUGINS.ENABLE_OK",{plugin:this.translate.instant("FW.PLUGINS."+e.plugin.toUpperCase())}):t=this.translate.instant("FW.PLUGINS.DISABLE_OK",{plugin:this.translate.instant("FW.PLUGINS."+e.plugin.toUpperCase())}),e.nodes=e.nodes.filter(u=>u.firewall.install_communication=="agent");for(let u of e.nodes){this.channel_id=Ft(),this.startProcess(),this.nodeName=u.firewall.name,e.enable?u.firewall.name?e.cluster.name?(this.addMessageToLog("",z.MSG_SEPARATOR),this.addMessageToLog(this.translate.instant("CLUSTER.PLUGINS.ENABLE_START_CLUSTER_NAME",{plugin:this.translate.instant("FW.PLUGINS."+e.plugin.toUpperCase()),firewall:u.firewall.name,cluster:e.cluster.name}),z.MSG_INFO)):(this.addMessageToLog("",z.MSG_SEPARATOR),this.addMessageToLog(this.translate.instant("CLUSTER.PLUGINS.ENABLE_START",{plugin:this.translate.instant("FW.PLUGINS."+e.plugin.toUpperCase()),firewall:u.firewall.name}),z.MSG_INFO)):(this.addMessageToLog("",z.MSG_SEPARATOR),this.addMessageToLog(this.translate.instant("CLUSTER.PLUGINS.ENABLE_START_NO_NAME",{plugin:this.translate.instant("FW.PLUGINS."+e.plugin.toUpperCase())}),z.MSG_INFO)):this.nodeName?e.cluster.name?(this.addMessageToLog("",z.MSG_SEPARATOR),this.addMessageToLog(this.translate.instant("CLUSTER.PLUGINS.DISABLE_START_CLUSTER_NAME",{plugin:this.translate.instant("FW.PLUGINS."+e.plugin.toUpperCase()),firewall:u.firewall.name,cluster:e.cluster.name}),z.MSG_INFO)):(this.addMessageToLog("",z.MSG_SEPARATOR),this.addMessageToLog(this.translate.instant("CLUSTER.PLUGINS.DISABLE_START",{plugin:this.translate.instant("FW.PLUGINS."+e.plugin.toUpperCase()),firewall:u.firewall.name}),z.MSG_INFO)):(this.addMessageToLog("",z.MSG_SEPARATOR),this.addMessageToLog(this.translate.instant("CLUSTER.PLUGINS.DISABLE_START_NO_NAME",{plugin:this.translate.instant("FW.PLUGINS."+e.plugin.toUpperCase())}),z.MSG_INFO));let d={channelId:this.channel_id,textHeader:"",apiCall:this.fwcFirewallService.installPlugins.bind(this.fwcFirewallService),apiParams:[this.fwcUserService.getActualFwSelectedCloud(),{protocol:u.firewall.install_protocol,plugin:e.plugin,enable:e.enable,host:u.address,port:u.firewall.install_port,apikey:u.firewall.install_apikey,communication:u.firewall.install_communication},this.channel_id],textMessage:"",showStatusMessage:null};this.options=d;let h=$i(this.waitWSMessages(),this.doApiCall());yield Qn(h).then(S=>{this.stopProcess()}).catch(S=>{this.error_plugin=!0,this.NodesError.filter(v=>v==this.nodeName)||this.NodesError.push(this.nodeName),this.stopProcess()}),this.eventsSubscription.unsubscribe()}this.log.setDataLoad(!1)}if(this.error_plugin)this.addMessageToLog(this.translate.instant("CLUSTER.PLUGINS.ERROR"),z.MSG_ERROR),this.addMessageToLog("",z.MSG_SEPARATOR);else if(this.operationResult){e.enable?(this.addMessageToLog("",z.MSG_SEPARATOR),this.addMessageToLog(this.translate.instant("FW.PLUGINS.ENABLE_ERROR"),z.MSG_ERROR)):(this.addMessageToLog("",z.MSG_SEPARATOR),this.addMessageToLog(this.translate.instant("FW.PLUGINS.DISABLE_ERROR"),z.MSG_ERROR)),this.addMessageToLog("",z.MSG_SEPARATOR),this.addMessageToLog(this.translate.instant("FW.PLUGINS.NODES_ERROR"),z.MSG_ERROR),this.NodesError=[...new Set(this.NodesError)];for(let u=0;u<this.NodesError.length;u++)this.addMessageToLog(this.NodesError[u],z.MSG_ERROR);this.error_plugin=!0}else e.enable?(this.addMessageToLog("",z.MSG_SEPARATOR),this.addMessageToLog(this.translate.instant("FW.PLUGINS.ENABLE_OK",{plugin:this.translate.instant("FW.PLUGINS."+e.plugin.toUpperCase())}),z.MSG_OK)):(this.addMessageToLog("",z.MSG_SEPARATOR),this.addMessageToLog(this.translate.instant("FW.PLUGINS.DISABLE_OK",{plugin:this.translate.instant("FW.PLUGINS."+e.plugin.toUpperCase())}),z.MSG_OK)),this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("FW.MSG_FW_EDITION.PLUGINS"),detail:t})}this.mainEventsSubscription.unsubscribe(),n(this.error_plugin)})),o.checkConnection(),this.loadingData=!1,this.stopProcess()}))}showPanelforFirewall(e){this.showDialog();let t;return new Promise(n=>le(this,null,function*(){if(this.isDestroyed)return n(this.error_plugin);let l=this.utilService.createDynamicComponentRef(tn),o=l.instance;o.setDynamicComponentRef(l),this.mainEventsSubscription=o.socketEventEmitter.subscribe(a=>le(this,null,function*(){if(a=="connected"){this.showDialog(),e.enable?t=this.translate.instant("FW.PLUGINS.ENABLE_OK",{plugin:this.translate.instant("FW.PLUGINS."+e.plugin.toUpperCase())}):t=this.translate.instant("FW.PLUGINS.DISABLE_OK",{plugin:this.translate.instant("FW.PLUGINS."+e.plugin.toUpperCase())}),e.enable?e.firewall.name?this.addMessageToLog(this.translate.instant("FW.PLUGINS.ENABLE_START",{plugin:this.translate.instant("FW.PLUGINS."+e.plugin.toUpperCase()),firewall:e.firewall.name}),z.MSG_INFO):this.addMessageToLog(this.translate.instant("FW.PLUGINS.ENABLE_START_NO_NAME",{plugin:this.translate.instant("FW.PLUGINS."+e.plugin.toUpperCase())}),z.MSG_INFO):e.firewall.name?this.addMessageToLog(this.translate.instant("FW.PLUGINS.DISABLE_START",{plugin:this.translate.instant("FW.PLUGINS."+e.plugin.toUpperCase()),firewall:e.firewall.name}),z.MSG_INFO):this.addMessageToLog(this.translate.instant("FW.PLUGINS.DISABLE_START_NO_NAME",{plugin:this.translate.instant("FW.PLUGINS."+e.plugin.toUpperCase())}),z.MSG_INFO),this.channel_id=Ft();let u={channelId:this.channel_id,textHeader:"",apiCall:this.fwcFirewallService.installPlugins.bind(this.fwcFirewallService),apiParams:[this.fwcUserService.getActualFwSelectedCloud(),{protocol:e.firewall.install_protocol,plugin:e.plugin,enable:e.enable,host:e.address,port:e.firewall.install_port,apikey:e.firewall.install_apikey,communication:e.firewall.install_communication},this.channel_id],textMessage:"",showStatusMessage:null};this.startProcess(),this.options=u;let d=$i(this.waitWSMessages(),this.doApiCall());yield Qn(d).then(h=>{!e.persisted&&!this.operationResult&&this.utilService.fwcAPICall(this.fwcFirewallService.updateFirewall.bind(this.fwcFirewallService),e.firewall).catch(S=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(S)}),this.stopProcess(),this.hideDialog(),this.error_plugin=!0}),this.operationResult?(e.enable?this.addMessageToLog(this.translate.instant("FW.PLUGINS.ENABLE_ERROR"),z.MSG_ERROR):this.addMessageToLog(this.translate.instant("FW.PLUGINS.DISABLE_ERROR"),z.MSG_ERROR),this.error_plugin=!0):(e.enable?this.addMessageToLog(this.translate.instant("FW.PLUGINS.ENABLE_OK",{plugin:this.translate.instant("FW.PLUGINS."+e.plugin.toUpperCase())}),z.MSG_OK):this.addMessageToLog(this.translate.instant("FW.PLUGINS.DISABLE_OK",{plugin:this.translate.instant("FW.PLUGINS."+e.plugin.toUpperCase())}),z.MSG_OK),this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("FW.MSG_FW_EDITION.PLUGINS"),detail:t}),this.error_plugin=!1),this.stopProcess()}).catch(h=>{let S=JSON.parse(h.error.msg);if(h.status===400&&S.message==="ECONNREFUSED: Port is not valid"){if(S!=""){this.addMessageToLog(this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:this.translate.instant("API_ERROR.ECONNREFUSED")}),z.MSG_ERROR),this.stopProcess(),this.error_plugin=!0;return}}else if(h.status===400||h.status===500){let v=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:this.translate.instant("GLOBALS.ERRORS.COMMUNICATION")});if(h.error){let b=this.utilService.isCommunicationError(h.error);if(b&&(v=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:b})),/ERR_BAD_REQUEST/.test(h.error.msg)){let T=JSON.parse(h.error.msg);this.addMessageToLog(this.translate.instant("FW.MSG_FW_EDITION.ERROR_BAD_REQUEST_AGENT",{errorMsg:T.message}),z.MSG_ERROR),this.stopProcess(),this.error_plugin=!0;return}}this.confirmationService.confirm({header:"Error",icon:"fa fa-exclamation-circle fwcRed iconBig",acceptLabel:"Ok",rejectVisible:!1,message:v})}else this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(h)});this.stopProcess(),this.error_plugin=!0}),this.eventsSubscription.unsubscribe()}this.mainEventsSubscription.unsubscribe(),n(this.error_plugin)})),o.checkConnection()}))}onCloseDialog(){this.fwcEventService.emitEvent({type:Hi.EVENT_PLUGIN_PANEL_CLOSED,data:this.error_plugin}),this.eventsSubscription&&this.eventsSubscription.unsubscribe(),this.log&&this.log.clearMessages(),this.operationResult=null,super.hideDialog()}};s.\u0275fac=function(t){return new(t||s)(L(He),L(Ot),L(ge),L(fe),L(ye),L(be),L(kt),L(Le),L(Ee),L(xt),L(pi),L(me),L(ue),L(we),L(Se),L(Ut))},s.\u0275cmp=je({type:s,selectors:[["sts-fwc-firewall-plugin-panel"]],viewQuery:function(t,n){if(t&1&&(_e(Ki,5),_e(Tu,5)),t&2){let l;se(l=ce())&&(n.log=l.first),se(l=ce())&&(n.fwcMessageComponent=l.first)}},outputs:{pluginEventEmitter:"pluginEventEmitter"},standalone:!1,features:[Ve([fe]),ct],decls:7,vars:5,consts:[["header",""],["pluginLog",""],["footer",""],["styleClass","dlgFwcDialog dlgDwcDialog--medium dlgFwcDialog--log-resize",3,"visibleChange","visible","modal","resizable","closable"],[1,"fwc-log-flex",3,"autoResize"],[1,"divFormHeader"],[1,"fwcWhite","fwcIconLeft"],[1,"fwcMenuIcon","fwci-firewalls","fwcOrange"],["type","button","icon","pi pi-check",3,"onClick","disabled","label"]],template:function(t,n){if(t&1){let l=M();p(0,"p-dialog",3),H("visibleChange",function(a){return w(l),W(n.displayDialog,a)||(n.displayDialog=a),g(a)}),J(1,Ou,5,3,"ng-template",null,0,pe),O(3,"sts-fwc-log",4,1),J(5,xu,2,5,"ng-template",null,2,pe),f()}t&2&&(V("visible",n.displayDialog),m("modal",!0)("resizable",!0)("closable",!1),c(3),m("autoResize",!0))},dependencies:[Ki,Ht,Ze,dt],encapsulation:2});let r=s;return r})();var Au=["splitter"],Lu=["dlgCompile"],Mu=["gridContainerDiv"],Du=()=>({height:"100rvm",width:"100%","padding-bottom":"6.5rem"}),Nu=()=>[15,85],Gu=()=>[15,15],Uu=()=>({height:"98%",width:"100%"}),ku=(r,s)=>({copyRules:r,cutRules:s}),Bu=r=>({"divClipContainer--above":r}),ju=(r,s)=>({copyObjects:r,cutObjects:s});function Vu(r,s){if(r&1){let i=M();p(0,"div",null,2)(2,"div",18)(3,"div",19)(4,"input",20,3),P("keyup",function(t){w(i);let n=_(2);return g(n.onSearchType(t.target.value))}),f(),p(6,"p-button",21),P("onClick",function(){w(i);let t=Oe(5);return _(2).onSearchType(""),g(t.value="")}),f(),p(7,"p-button",22),P("onClick",function(t){w(i),_(2);let n=Oe(5);return g(n.toggle(t))}),f()()(),p(8,"div",23)(9,"div",24),y(10,"translate"),O(11,"sts-fwc-tree",25),f(),p(12,"div",26),y(13,"translate"),O(14,"sts-fwc-tree",25),f(),p(15,"div",26),y(16,"translate"),O(17,"sts-fwc-tree",25),f()()()}if(r&2){let i=Oe(5),e=_(2);Nt(Y(24,Uu)),c(4),m("placeholder",e.searchPlaceholderText),c(2),m("disabled",!i.value.length),c(3),m("header",B(E(10,18,"POLICY.MSG_POLICY_TREES.TREE_FW"))),c(2),m("treeOptions",e.optionsTreeFw)("treeSearchOptions",e.treeSearchOptions),c(),m("header",B(E(13,20,"POLICY.MSG_POLICY_TREES.TREE_OBJ")))("expanded",!1),c(2),m("treeOptions",e.optionsTreeObj)("treeSearchOptions",e.treeSearchOptions),c(),m("header",B(E(16,22,"POLICY.MSG_POLICY_TREES.TREE_SER")))("expanded",!1),c(2),m("treeOptions",e.optionsTreeSrv)("treeSearchOptions",e.treeSearchOptions)}}function Wu(r,s){r&1&&(p(0,"div",27,4),O(2,"sts-fwc-policy-grid"),f())}function Hu(r,s){if(r&1){let i=M();p(0,"div",6)(1,"p-splitter",16,1),P("onResizeEnd",function(t){w(i);let n=_();return g(n.onResizeEnd(t))}),J(3,Vu,18,25,"ng-template",17)(4,Wu,3,0,"ng-template",17),f()()}r&2&&(c(),Nt(Y(4,Du)),m("panelSizes",Y(5,Nu))("minSizes",Y(6,Gu)))}function Ju(r,s){if(r&1){let i=M();p(0,"div",7)(1,"div",28),O(2,"i",29),p(3,"div",30)(4,"span"),C(5),y(6,"translate"),f(),O(7,"p",31),f(),p(8,"div",32)(9,"p-button",33),P("onClick",function(){w(i);let t=_();return g(t.emptyRuleClipboard())}),f()()()()}if(r&2){let i=_();m("@fundidoInOut",void 0),c(),m("ngClass",Qe(6,ku,(i.clipboardRules==null?null:i.clipboardRules.action)==i.ClipboardAction.COPY,(i.clipboardRules==null?null:i.clipboardRules.action)==i.ClipboardAction.CUT)),c(4),F(" ",E(6,4,"POLICY.RULE_CLIPBOARD")),c(2),m("innerHTML",i.clipboardRulesTooltip,$n)}}function Yu(r,s){if(r&1){let i=M();p(0,"div",8)(1,"div",28),O(2,"i",34),p(3,"div",30)(4,"span"),C(5),y(6,"translate"),f(),O(7,"p",31),f(),p(8,"div",32)(9,"p-button",33),P("onClick",function(){w(i);let t=_();return g(t.emptyObjectClipboard())}),f()()()()}if(r&2){let i=_();m("@fundidoInOut",void 0)("ngClass",Re(7,Bu,i.clipboardRules)),c(),m("ngClass",Qe(9,ju,(i.clipboardObjects==null?null:i.clipboardObjects.action)==i.ClipboardAction.COPY,(i.clipboardObjects==null?null:i.clipboardObjects.action)==i.ClipboardAction.CUT)),c(4),F(" ",E(6,5,"POLICY.OBJECT_CLIPBOARD")),c(2),m("innerHTML",i.clipboardObjectsTooltip,$n)}}function Ku(r,s){if(r&1){let i=M();p(0,"div",11)(1,"p-checkbox",35),H("ngModelChange",function(t){w(i);let n=_();return W(n.treeSearchOptions.searchFields,t)||(n.treeSearchOptions.searchFields=t),g(t)}),P("onChange",function(t){let n=w(i).$implicit,l=_();return g(l.handleSearchFilterChange(t,n))}),f(),p(2,"label",36),C(3),y(4,"translate"),y(5,"translate"),f()()}if(r&2){let i=s.$implicit,e=_();c(),m("value",i),V("ngModel",e.treeSearchOptions.searchFields),c(2),F("\u2002",E(4,3,"POLICY.TREE_SEARCH_OPTIONS.SEARCH_BY")+" "+E(5,5,i))}}var Pr=(()=>{let s=class s{constructor(e,t,n,l,o,a,u,d,h,S,v){this.appOptionsService=e,this.itemSelectedService=t,this.fwcUserService=n,this.ruleSelectedService=l,this.fwcPolicyService=o,this.fwcSseService=a,this.messageService=u,this.utilService=d,this.cd=h,this.store=S,this.translate=v,this.ClipboardAction=de,this.isSidebarVisible=!0,this.currentPanelSizes=[15,85],this.previousPanelSizes=[15,85],this.draggingSplitter=!1,this.showObjectPanel=!1,this.searchUpdated=new sn,this.searchChangeEmitter=new ti,this.alive=!0,this.tabsExpanded=[!0,!0,!0],this.searchOptionsItems=[],this.searchFiltersOptions=[nn.OBJECT_NAME,nn.TCP_UDP_PORT,nn.IP_ADDRESS,nn.IP_OPENVPN],this.optionsTreeFw=e.optionsTreeFw,this.optionsTreeObj=e.optionsTreeObj,this.optionsTreeSrv=e.optionsTreeSrv,this.searchChangeEmitter=this.searchUpdated.asObservable().pipe(cn(300),Oo(),oe(()=>this.alive)).subscribe(b=>{this.searchString=b,this.treeSearchOptions=Ti(Lt({},this.treeSearchOptions),{keyword:b})}),this.treeSearchOptions={keyword:"",searchFields:this.searchFiltersOptions.slice()},this.searchPlaceholderText=this.translate.instant("POLICY.MSG_POLICY_SEARCH.SEARCH")}ngOnDestroy(){this.alive=!1}ngOnInit(){this.menuClipboardItems=[{label:this.translate.instant("POLICY.RULE_CLIPBOARD_EMPTY"),icon:"fa fa-clipboard fwcBlue",command:()=>{}}],this.store.dispatch(tl.loadPolicyTypes()),this.ruleSelectedService.getClipboardRules().pipe(oe(()=>this.alive)).subscribe(e=>{if(this.clipboardRules=e,this.clipboardRulesTooltip="",e&&e.rules){let t=[];if(e.rules.forEach(n=>{t.push(n.id)}),e.action==de.COPY){let n=t.length===1?"POLICY.RULE_CLIPBOARD_COPY":"POLICY.RULE_CLIPBOARD_COPY_ARRAY";this.clipboardRulesTooltip=this.translate.instant(n,t.length===1?{rule:t[0]}:{n:t.length})}if(e.action==de.CUT){let n=t.length===1?"POLICY.RULE_CLIPBOARD_CUT":"POLICY.RULE_CLIPBOARD_CUT_ARRAY";this.clipboardRulesTooltip=this.translate.instant(n,t.length===1?{rule:t[0]}:{n:t.length})}}}),this.itemSelectedService.getClipboardItem().pipe(oe(()=>this.alive)).subscribe(e=>{this.clipboardObjects=e,this.clipboardObjectsTooltip="",e&&(e.action==de.COPY&&(this.clipboardObjectsTooltip=this.translate.instant("POLICY.OBJECT_CLIPBOARD_COPY",{name:e._fwcObjName})),e.action==de.CUT&&(this.clipboardObjectsTooltip=this.translate.instant("POLICY.OBJECT_CLIPBOARD_CUT",{name:e._fwcObjName})))}),this.fwcUserService.getFwcUser().pipe(oe(()=>this.alive)).subscribe(e=>{(!this.fwcUser||this.fwcUser&&(e.user_id!=this.fwcUser.user_id||e.selectedFwCloud!=this.fwcUser.selectedFwCloud))&&this.loadSelectedFWCloud(e),this.fwcUser=Object.assign({},e),this.showObjectPanel=!1}),this.fwcUserService.reloadSelectedFWCloud().pipe(oe(()=>this.alive)).subscribe(()=>{this.appOptionsService.clearTreeStateForFwcloud(this.fwcUser?.selectedFwCloud),this.loadSelectedFWCloud(this.fwcUser)}),this.utilService.getGridScrollToTop().pipe(oe(()=>this.alive)).subscribe(()=>{this.gridContainerDiv&&(this.gridContainerDiv.nativeElement.scrollTop=0)})}ngAfterViewInit(){this.itemSelectedService.setFwcTreeComponents(this.fwcTreeComponents.toArray());let t=this.splitter.el.nativeElement.querySelector(".p-splitter-gutter");t&&(t.addEventListener("mousedown",()=>this.onDragStart()),t.addEventListener("mouseup",()=>this.onDragEnd()),t.addEventListener("click",()=>this.onGutterClick())),setTimeout(()=>this.restorePolicyPanelState()),this.fwcTreeComponents.changes.pipe(oe(()=>this.alive)).subscribe(()=>{setTimeout(()=>this.restorePolicyPanelState())})}onDragStart(){this.draggingSplitter=!0}onDragEnd(){setTimeout(()=>this.draggingSplitter=!1,100)}onGutterClick(){this.draggingSplitter||this.toggleSidebar()}toggleSidebar(){this.isSidebarVisible?(this.previousPanelSizes=this.splitter.panelSizes,this.splitter.panelSizes=[.001,99.999]):this.splitter.panelSizes=this.previousPanelSizes,this.isSidebarVisible=!this.isSidebarVisible}onResizeEnd(e){this.isSidebarVisible&&(this.currentPanelSizes=e.sizes,this.ensurePanelSizesWithinLimits())}ensurePanelSizesWithinLimits(){this.currentPanelSizes[0]<10?(this.currentPanelSizes[0]=15,this.currentPanelSizes[1]=85):this.currentPanelSizes[0]>90&&(this.currentPanelSizes[0]=85,this.currentPanelSizes[1]=15),this.splitter.panelSizes=this.currentPanelSizes}restorePolicyPanelState(){let e=this.fwcUser?.selectedFwCloud??this.fwcUserService.getActualFwSelectedCloud();e!=null&&this.applyStoredPolicyForFwcloud(e)}resolveTreeName(e){if(e&&e.treeName)return e.treeName;switch(e?.container){case Ge.C_FIREWALLS:case Ge.C_FIREWALLS_CONDENSED:case Ge.C_CLUSTERS:return"firewalls";case Ge.C_OBJECTS:return"objects";case Ge.C_SERVICES:return"services";case Ge.C_CA:return"PKI";default:return"firewalls"}}loadSelectedFWCloud(e){this.loadFwcObjectTree(e.user_id,e.selectedLanguage,e.selectedFwCloud,1,1),this.applyStoredPolicyForFwcloud(e.selectedFwCloud)}onSearchType(e){this.searchUpdated.next(e)}handleSearchFilterChange(e,t){!e&&!this.treeSearchOptions.searchFields.length?this.treeSearchOptions.searchFields=[t]:this.treeSearchOptions=Lt({},this.treeSearchOptions)}loadFwcObjectTree(e,t,n,l,o){let a,u,d;a=Object.assign({},this.optionsTreeFw),u=Object.assign({},this.optionsTreeObj),d=Object.assign({},this.optionsTreeSrv),a.user_id=u.user_id=d.user_id=e,a.fwcloud=u.fwcloud=d.fwcloud=n,a.objStandard=u.objStandard=d.objStandard=l,a.objCloud=u.objCloud=d.objCloud=o,this.optionsTreeFw=Object.assign({},a),this.optionsTreeObj=Object.assign({},u),this.optionsTreeSrv=Object.assign({},d)}applyStoredPolicyForFwcloud(e){let t=this.optionsTreeFw.view??"policy",n=this.resolveTreeName(this.optionsTreeFw),l=()=>{(this.itemSelectedService.getActualFwcTreeComponents()||[]).filter(u=>u?.options?.container===Ge.C_FIREWALLS).forEach(u=>setTimeout(()=>u.restoreSelectionFromStore()))};if(e==null){this.appOptionsService.setTreeSelectedNodeRef(e,t,n,void 0),this.fwcPolicyService.setSelectedPolicy({_fwcFwId:null});return}let o=this.appOptionsService.getTreeSelectedNodeRef(e,t,n);if(o?.policySelection){let a=Ti(Lt({},o.policySelection),{fwcloud:e,_dontLocateInTree:!0}),u=this.fwcPolicyService.getActualSelectedPolicy?.(),d=u&&u._fwcFwId===a._fwcFwId&&u._fwcPolicyType===a._fwcPolicyType&&u._fwcObjId===a._fwcObjId&&u.fwcloud===a.fwcloud;this.fwcPolicyService.setSelectedPolicy(Ti(Lt({},a),{_forcePolicyReload:d?void 0:!0})),d||this.fwcPolicyService.reloadPolicy(),l()}else this.appOptionsService.setTreeSelectedNodeRef(e,t,n,void 0),this.fwcPolicyService.setSelectedPolicy({_fwcFwId:null,fwcloud:e})}emptyRuleClipboard(){this.ruleSelectedService.clearClipboardRules()}emptyObjectClipboard(){this.itemSelectedService.clearClipboardItem()}doSearchTCPUDPPorts(){console.log("Search by ports",this.tcpUdpPortSearchString)}};s.\u0275fac=function(t){return new(t||s)(L(Ot),L(He),L(ge),L(Ue),L(ye),L(Ql),L(Ee),L(me),L(we),L(Se),L(ue))},s.\u0275cmp=je({type:s,selectors:[["sts-fwc-policy-main"]],viewQuery:function(t,n){if(t&1&&(_e(Au,5),_e(Lu,5),_e(Mu,5),_e(Mn,5)),t&2){let l;se(l=ce())&&(n.splitter=l.first),se(l=ce())&&(n.dlgCompile=l.first),se(l=ce())&&(n.gridContainerDiv=l.first),se(l=ce())&&(n.fwcTreeComponents=l)}},outputs:{searchChangeEmitter:"searchChangeEmitter"},standalone:!1,features:[Ve([])],decls:27,vars:11,consts:[["pnlSearchFilters",""],["splitter",""],["fwcDivSidebar",""],["inputSearch",""],["gridContainerDiv",""],[1,"fwcDivBoxed","fwcMainContainer"],[1,"grid-nogutter","fwcDivBoxed"],[1,"divClipContainer"],[1,"divClipContainer",3,"ngClass"],["appendTo","body",1,"ovpSearchFilters"],[1,"grid","grid-nogutter"],[1,"col-12"],[1,"fwcBlue"],["tooltipclass","ttLeft",1,"fa","fa-fw","fa-lg","fa-info-circle",3,"pTooltip","escape"],[1,"col-12","fwc-right"],["icon","pi pi-check",3,"onClick"],[3,"onResizeEnd","panelSizes","minSizes"],["pTemplate",""],[1,"fwcDivPadded","fwcDivBoxed","fwcDivPaddedTB"],[1,"fwcInputGroup"],["type","text","pInputText","","maxlength","255","id","inputSearch","name","inputSearch",3,"keyup","placeholder"],["type","button","icon","pi pi-times",3,"onClick","disabled"],["type","button","icon","pi pi-filter",3,"onClick"],["sts-fwc-tree-accordion","",1,"responsive-accordion"],["sts-fwc-tree-panel","",3,"header"],[3,"treeOptions","treeSearchOptions"],["sts-fwc-tree-panel","",3,"header","expanded"],[1,"fwcPolicyMainContainer","fwcDivOverflow","h-full"],[1,"divClipButton",3,"ngClass"],[1,"fwci-rule"],[1,"divClipButton-msg"],[3,"innerHTML"],[1,"divClipButton-close"],["type","button","styleClass","p-button-warning","icon","fa fa-trash",3,"onClick"],[1,"fwci-ipobjects"],["inputId","chkSearchFilters","name","chkSearchFilters",3,"ngModelChange","onChange","value","ngModel"],["for","chkSearchFilters"]],template:function(t,n){if(t&1){let l=M();p(0,"div",5),x(1,Hu,5,7,"div",6),f(),x(2,Ju,10,9,"div",7),x(3,Yu,10,12,"div",8),p(4,"p-popover",9,0)(6,"div",10)(7,"div",11)(8,"h6",12),C(9),y(10,"translate"),O(11,"i",13),y(12,"translate"),f()(),Et(13,Ku,6,7,"div",11,yt),p(15,"div",14)(16,"p-button",15),P("onClick",function(){w(l);let a=Oe(5);return g(a.hide())}),f()()()(),O(17,"sts-fwc-info-tooltip")(18,"sts-fwc-item-panel")(19,"sts-fwc-firewall-panel")(20,"sts-fwc-firewall-compile-panel")(21,"sts-fwc-cluster-panel")(22,"sts-fwc-ovconfig-panel")(23,"sts-fwc-wireguard-config-panel")(24,"sts-fwc-ipsec-config-panel")(25,"sts-fwc-vpn-status-panel")(26,"sts-fwc-firewall-plugin-panel")}t&2&&(c(),R(n.fwcUser!=null&&n.fwcUser!=null?1:-1),c(),R(n.clipboardRules?2:-1),c(),R(n.clipboardObjects?3:-1),c(6),F(" ",E(10,7,"POLICY.TREE_SEARCH_OPTIONS.HEADER")," "),c(2),m("pTooltip",B(E(12,9,"POLICY.TREE_SEARCH_OPTIONS.TOOLTIP")))("escape",!1),c(2),vt(n.searchFiltersOptions))},dependencies:[pt,bt,Pt,Fl,Mn,Hl,jl,Vl,Wl,jt,ml,mi,Ze,fi,Rt,zl,Hn,pr,dr,wr,Er,Ir,Ln,br,dt],styles:[`@charset "UTF-8";.fwcMainContainer{background:var(--surfaceBackgroundColor)!important;width:100%;height:100%;max-height:100vh}.fwcDivSidebar{padding:.5rem 1.5rem 0 .5rem!important}.fwcDivRuleClipboardNotify{position:fixed;bottom:2em;right:2em;width:3rem;height:3rem;border-radius:50%;box-shadow:2px 2px 10px var(--fwcPaleDark);color:var(--fwcDark)}.fwcDivRuleClipboardNotify.copyRules{background-color:var(--fwcPaleGreen)}.fwcDivRuleClipboardNotify.cutRules{background-color:var(--fwcPaleRed)}.fwcDivRuleClipboardNotify i{text-align:center;display:inherit;line-height:3rem}.divClipContainer{position:fixed;right:2em;bottom:2em;transition:all .25s ease-out}.divClipContainer.divClipContainer--above{bottom:7em}.divClipContainer .divClipButton{height:4em;width:4em;border-radius:2em;overflow:hidden;vertical-align:middle;box-shadow:2px 2px 12px var(--fwcPaleDark);transition:width .25s ease-out}.divClipContainer .divClipButton.copyRules{background-color:var(--fwcPaleGreen)}.divClipContainer .divClipButton.cutRules{background-color:var(--fwcPaleRed)}.divClipContainer .divClipButton.copyObjects{background-color:#b5deb7}.divClipContainer .divClipButton.copyObjects .truncated-text{display:inline-block;max-width:7.5rem;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;text-align:center;vertical-align:middle;margin-right:-7px;font-size:14.5px}.divClipContainer .divClipButton.cutObjects{background-color:#f65e5e}.divClipContainer .divClipButton:hover{width:32em}.divClipContainer .divClipButton i{display:inline-block;height:4em;width:4em;vertical-align:top;text-align:center;line-height:4em}.divClipContainer .divClipButton-msg{font-family:Montserrat,sans-serif;padding:.6em;display:inline-block;margin-right:.5em}.divClipContainer .divClipButton-msg span{font-size:1.1em;font-weight:700}.divClipContainer .divClipButton-msg p{color:var(--fwcPaleDark2)}.divClipContainer .divClipButton-close{display:inline-block;float:right;margin-right:1em;line-height:4em;vertical-align:middle;visibility:visible;text-align:center;border-radius:10px}.divClipContainer .divClipButton-close .p-button.p-button-icon-only{width:2rem!important;height:2rem!important;min-width:2rem!important;min-height:2rem!important;max-width:2rem!important;max-height:2rem!important}.divClipContainer .divClipButton-close button{display:inline-flex;vertical-align:middle;width:2rem;height:2rem;padding:0;align-items:center;justify-content:center;box-sizing:border-box}.divClipContainer .divClipButton-close .p-button{width:2rem!important;height:2rem!important;min-width:2rem!important;min-height:2rem!important}.divClipContainer .divClipButton-close span{margin-left:.1rem;margin-top:.3rem}.divClipContainer .divClipButton-close .p-button-icon{margin:0;line-height:1}.fwcInputGroup{position:relative;height:2.4375em}.fwcInputGroup input{width:100%;float:left;padding-right:2rem}.fwcInputGroup p-button{width:2rem;height:100%!important;border-radius:0!important;position:absolute;right:2rem!important}.fwcInputGroup p-button:last-child{right:0!important}.fwcInputGroup p-button button{min-width:100%;min-height:100%;padding:0;border-radius:0!important;display:flex;align-items:center;justify-content:center}.p-checkbox-checked .p-checkbox-box{border:1px solid #007ad9;background-color:#007ad9}.p-checkbox:not(.p-disabled):has(.p-checkbox-input:hover) .p-checkbox-box{border:1px solid #007ad9}textarea.textCompiledString{height:12rem;font-family:monospace,sans-serif,Courier!important}.ovpSearchFilters{max-width:20rem}.ttLeft{text-align:left}@media screen and (max-height: 767px){.responsive-accordion{height:calc(100% - 3.2em)}}@media screen and (min-height: 768px){.responsive-accordion{height:calc(100% - 3em)}}@media screen and (min-height: 1024px){.responsive-accordion{height:calc(100% - 2.8em)}}@media screen and (min-height: 1150px){.responsive-accordion{height:calc(100% - 2.5em)}}@media screen and (min-height: 1250px){.responsive-accordion{height:calc(100% - 2.2em)}}
`],encapsulation:2,data:{animation:[bn]}});let r=s;return r})();var Xu=[{path:"",component:Pr},{path:"**",pathMatch:"full",redirectTo:""}],Tr=(()=>{let s=class s{};s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=ii({type:s}),s.\u0275inj=ei({imports:[ro.forChild(Xu),ro]});let r=s;return r})();var Or=`
    .p-scrollpanel-content-container {
        overflow: hidden;
        width: 100%;
        height: 100%;
        position: relative;
        z-index: 1;
        float: left;
    }

    .p-scrollpanel-content {
        height: calc(100% + calc(2 * dt('scrollpanel.bar.size')));
        width: calc(100% + calc(2 * dt('scrollpanel.bar.size')));
        padding-inline: 0 calc(2 * dt('scrollpanel.bar.size'));
        padding-block: 0 calc(2 * dt('scrollpanel.bar.size'));
        position: relative;
        overflow: auto;
        box-sizing: border-box;
        scrollbar-width: none;
    }

    .p-scrollpanel-content::-webkit-scrollbar {
        display: none;
    }

    .p-scrollpanel-bar {
        position: relative;
        border-radius: dt('scrollpanel.bar.border.radius');
        z-index: 2;
        cursor: pointer;
        opacity: 0;
        outline-color: transparent;
        background: dt('scrollpanel.bar.background');
        border: 0 none;
        transition:
            outline-color dt('scrollpanel.transition.duration'),
            opacity dt('scrollpanel.transition.duration');
    }

    .p-scrollpanel-bar:focus-visible {
        box-shadow: dt('scrollpanel.bar.focus.ring.shadow');
        outline: dt('scrollpanel.barfocus.ring.width') dt('scrollpanel.bar.focus.ring.style') dt('scrollpanel.bar.focus.ring.color');
        outline-offset: dt('scrollpanel.barfocus.ring.offset');
    }

    .p-scrollpanel-bar-y {
        width: dt('scrollpanel.bar.size');
        inset-block-start: 0;
    }

    .p-scrollpanel-bar-x {
        height: dt('scrollpanel.bar.size');
        inset-block-end: 0;
    }

    .p-scrollpanel-hidden {
        visibility: hidden;
    }

    .p-scrollpanel:hover .p-scrollpanel-bar,
    .p-scrollpanel:active .p-scrollpanel-bar {
        opacity: 1;
    }

    .p-scrollpanel-grabbed {
        user-select: none;
    }
`;var xr=["content"],qu=["xBar"],Qu=["yBar"],$u=["*"];function Zu(r,s){r&1&&Ai(0)}function ef(r,s){r&1&&wt(0)}var tf=`
    ${Or}

    .p-scrollpanel {
        display: block;
    }
`,nf={root:"p-scrollpanel p-component",contentContainer:"p-scrollpanel-content-container",content:"p-scrollpanel-content",barX:"p-scrollpanel-bar p-scrollpanel-bar-x",barY:"p-scrollpanel-bar p-scrollpanel-bar-y"},Rr=(()=>{class r extends yn{name="scrollpanel";style=tf;classes=nf;static \u0275fac=(()=>{let i;return function(t){return(i||(i=Oi(r)))(t||r)}})();static \u0275prov=De({token:r,factory:r.\u0275fac})}return r})();var Fr=new pn("SCROLLPANEL_INSTANCE"),of=(()=>{class r extends vn{$pcScrollPanel=zt(Fr,{optional:!0,skipSelf:!0})??void 0;bindDirectiveInstance=zt(Vt,{self:!0});onAfterViewChecked(){this.bindDirectiveInstance.setAttrs(this.ptms(["host","root"]))}styleClass;step=5;contentViewChild;xBarViewChild;yBarViewChild;contentTemplate;templates;_contentTemplate;scrollYRatio;scrollXRatio;timeoutFrame=i=>setTimeout(i,0);initialized=!1;lastPageY;lastPageX;isXBarClicked=!1;isYBarClicked=!1;lastScrollLeft=0;lastScrollTop=0;orientation="vertical";timer;contentId;windowResizeListener;contentScrollListener;mouseEnterListener;xBarMouseDownListener;yBarMouseDownListener;documentMouseMoveListener;documentMouseUpListener;_componentStyle=zt(Rr);zone=zt(Lo);onInit(){this.contentId=rl("pn_id_")+"_content"}onAfterViewInit(){Bo(this.platformId)&&this.zone.runOutsideAngular(()=>{this.moveBar(),this.moveBar=this.moveBar.bind(this),this.onXBarMouseDown=this.onXBarMouseDown.bind(this),this.onYBarMouseDown=this.onYBarMouseDown.bind(this),this.onDocumentMouseMove=this.onDocumentMouseMove.bind(this),this.onDocumentMouseUp=this.onDocumentMouseUp.bind(this),this.windowResizeListener=this.renderer.listen(window,"resize",this.moveBar),this.contentScrollListener=this.renderer.listen(this.contentViewChild.nativeElement,"scroll",this.moveBar),this.mouseEnterListener=this.renderer.listen(this.contentViewChild.nativeElement,"mouseenter",this.moveBar),this.xBarMouseDownListener=this.renderer.listen(this.xBarViewChild.nativeElement,"mousedown",this.onXBarMouseDown),this.yBarMouseDownListener=this.renderer.listen(this.yBarViewChild.nativeElement,"mousedown",this.onYBarMouseDown),this.calculateContainerHeight(),this.initialized=!0})}onAfterContentInit(){this.templates.forEach(i=>{switch(i.getType()){case"content":this._contentTemplate=i.template;break;default:this._contentTemplate=i.template;break}})}calculateContainerHeight(){let i=this.el.nativeElement,e=this.contentViewChild.nativeElement,t=this.xBarViewChild.nativeElement,n=this.document.defaultView,l=n.getComputedStyle(i),o=n.getComputedStyle(t),a=ll(i)-parseInt(o.height,10);l["max-height"]!="none"&&a==0&&(e.offsetHeight+parseInt(o.height,10)>parseInt(l["max-height"],10)?i.style.height=l["max-height"]:i.style.height=e.offsetHeight+parseFloat(l.paddingTop)+parseFloat(l.paddingBottom)+parseFloat(l.borderTopWidth)+parseFloat(l.borderBottomWidth)+"px")}moveBar(){let i=this.el.nativeElement,e=this.contentViewChild.nativeElement,t=this.xBarViewChild.nativeElement,n=e.scrollWidth,l=e.clientWidth,o=(i.clientHeight-t.clientHeight)*-1;this.scrollXRatio=l/n;let a=this.yBarViewChild.nativeElement,u=e.scrollHeight,d=e.clientHeight,h=(i.clientWidth-a.clientWidth)*-1;this.scrollYRatio=d/u,this.requestAnimationFrame(()=>{if(this.scrollXRatio>=1)t.setAttribute("data-p-scrollpanel-hidden","true"),Bt(t,"p-scrollpanel-hidden");else{t.setAttribute("data-p-scrollpanel-hidden","false"),_i(t,"p-scrollpanel-hidden");let S=Math.max(this.scrollXRatio*100,10),v=Math.abs(e.scrollLeft*(100-S)/(n-l));t.style.cssText="width:"+S+"%; inset-inline-start:"+v+"%;bottom:"+o+"px;"}if(this.scrollYRatio>=1)a.setAttribute("data-p-scrollpanel-hidden","true"),Bt(a,"p-scrollpanel-hidden");else{a.setAttribute("data-p-scrollpanel-hidden","false"),_i(a,"p-scrollpanel-hidden");let S=Math.max(this.scrollYRatio*100,10),v=e.scrollTop*(100-S)/(u-d);a.style.cssText="height:"+S+"%; top: calc("+v+"% - "+t.clientHeight+"px); inset-inline-end:"+h+"px;"}}),this.cd.markForCheck()}onScroll(i){this.lastScrollLeft!==i.target.scrollLeft?(this.lastScrollLeft=i.target.scrollLeft,this.orientation="horizontal"):this.lastScrollTop!==i.target.scrollTop&&(this.lastScrollTop=i.target.scrollTop,this.orientation="vertical"),this.moveBar()}onKeyDown(i){if(this.orientation==="vertical")switch(i.code){case"ArrowDown":{this.setTimer("scrollTop",this.step),i.preventDefault();break}case"ArrowUp":{this.setTimer("scrollTop",this.step*-1),i.preventDefault();break}case"ArrowLeft":case"ArrowRight":{i.preventDefault();break}default:break}else if(this.orientation==="horizontal")switch(i.code){case"ArrowRight":{this.setTimer("scrollLeft",this.step),i.preventDefault();break}case"ArrowLeft":{this.setTimer("scrollLeft",this.step*-1),i.preventDefault();break}case"ArrowDown":case"ArrowUp":{i.preventDefault();break}default:break}}onKeyUp(){this.clearTimer()}repeat(i,e){this.contentViewChild?.nativeElement&&(this.contentViewChild.nativeElement[i]+=e),this.moveBar()}setTimer(i,e){this.clearTimer(),this.timer=setTimeout(()=>{this.repeat(i,e)},40)}clearTimer(){this.timer&&clearTimeout(this.timer)}bindDocumentMouseListeners(){this.documentMouseMoveListener||(this.documentMouseMoveListener=i=>{this.onDocumentMouseMove(i)},this.document.addEventListener("mousemove",this.documentMouseMoveListener)),this.documentMouseUpListener||(this.documentMouseUpListener=i=>{this.onDocumentMouseUp(i)},this.document.addEventListener("mouseup",this.documentMouseUpListener))}unbindDocumentMouseListeners(){this.documentMouseMoveListener&&(this.document.removeEventListener("mousemove",this.documentMouseMoveListener),this.documentMouseMoveListener=null),this.documentMouseUpListener&&(document.removeEventListener("mouseup",this.documentMouseUpListener),this.documentMouseUpListener=null)}onYBarMouseDown(i){this.isYBarClicked=!0,this.yBarViewChild?.nativeElement?.focus(),this.lastPageY=i.pageY,this.yBarViewChild?.nativeElement?.setAttribute("data-p-scrollpanel-grabbed","true"),Bt(this.yBarViewChild.nativeElement,"p-scrollpanel-grabbed"),this.document.body.setAttribute("data-p-scrollpanel-grabbed","true"),Bt(this.document.body,"p-scrollpanel-grabbed"),this.bindDocumentMouseListeners(),i.preventDefault()}onXBarMouseDown(i){this.isXBarClicked=!0,this.xBarViewChild?.nativeElement?.focus(),this.lastPageX=i.pageX,this.xBarViewChild?.nativeElement?.setAttribute("data-p-scrollpanel-grabbed","false"),Bt(this.xBarViewChild.nativeElement,"p-scrollpanel-grabbed"),this.document.body.setAttribute("data-p-scrollpanel-grabbed","false"),Bt(this.document.body,"p-scrollpanel-grabbed"),this.bindDocumentMouseListeners(),i.preventDefault()}onDocumentMouseMove(i){this.isXBarClicked?this.onMouseMoveForXBar(i):this.isYBarClicked?this.onMouseMoveForYBar(i):(this.onMouseMoveForXBar(i),this.onMouseMoveForYBar(i))}onMouseMoveForXBar(i){let e=i.pageX-this.lastPageX;this.lastPageX=i.pageX,this.requestAnimationFrame(()=>{this.contentViewChild.nativeElement.scrollLeft+=e/this.scrollXRatio})}onMouseMoveForYBar(i){let e=i.pageY-this.lastPageY;this.lastPageY=i.pageY,this.requestAnimationFrame(()=>{this.contentViewChild.nativeElement.scrollTop+=e/this.scrollYRatio})}scrollTop(i){let e=this.contentViewChild.nativeElement.scrollHeight-this.contentViewChild.nativeElement.clientHeight;i=i>e?e:i>0?i:0,this.contentViewChild.nativeElement.scrollTop=i}onFocus(i){this.xBarViewChild?.nativeElement?.isSameNode(i.target)?this.orientation="horizontal":this.yBarViewChild?.nativeElement?.isSameNode(i.target)&&(this.orientation="vertical")}onBlur(){this.orientation==="horizontal"&&(this.orientation="vertical")}onDocumentMouseUp(i){this.yBarViewChild?.nativeElement?.setAttribute("data-p-scrollpanel-grabbed","false"),_i(this.yBarViewChild.nativeElement,"p-scrollpanel-grabbed"),this.xBarViewChild?.nativeElement?.setAttribute("data-p-scrollpanel-grabbed","false"),_i(this.xBarViewChild.nativeElement,"p-scrollpanel-grabbed"),this.document.body.setAttribute("data-p-scrollpanel-grabbed","false"),_i(this.document.body,"p-scrollpanel-grabbed"),this.unbindDocumentMouseListeners(),this.isXBarClicked=!1,this.isYBarClicked=!1}requestAnimationFrame(i){(window.requestAnimationFrame||this.timeoutFrame)(i)}unbindListeners(){this.windowResizeListener&&(this.windowResizeListener(),this.windowResizeListener=null),this.contentScrollListener&&(this.contentScrollListener(),this.contentScrollListener=null),this.mouseEnterListener&&(this.mouseEnterListener(),this.mouseEnterListener=null),this.xBarMouseDownListener&&(this.xBarMouseDownListener(),this.xBarMouseDownListener=null),this.yBarMouseDownListener&&(this.yBarMouseDownListener(),this.yBarMouseDownListener=null)}onDestroy(){this.initialized&&this.unbindListeners()}refresh(){this.moveBar()}static \u0275fac=(()=>{let i;return function(t){return(i||(i=Oi(r)))(t||r)}})();static \u0275cmp=je({type:r,selectors:[["p-scroll-panel"],["p-scrollPanel"],["p-scrollpanel"]],contentQueries:function(e,t,n){if(e&1&&(It(n,xr,4),It(n,jt,4)),e&2){let l;se(l=ce())&&(t.contentTemplate=l.first),se(l=ce())&&(t.templates=l)}},viewQuery:function(e,t){if(e&1&&(_e(xr,5),_e(qu,5),_e(Qu,5)),e&2){let n;se(n=ce())&&(t.contentViewChild=n.first),se(n=ce())&&(t.xBarViewChild=n.first),se(n=ce())&&(t.yBarViewChild=n.first)}},hostVars:2,hostBindings:function(e,t){e&2&&he(t.cn(t.cx("root"),t.styleClass))},inputs:{styleClass:"styleClass",step:[2,"step","step",_n]},features:[Ve([Rr,{provide:Fr,useExisting:r},{provide:En,useExisting:r}]),dn([Vt]),ct],ngContentSelectors:$u,decls:9,vars:20,consts:[["content",""],["xBar",""],["yBar",""],[3,"pBind"],[3,"mouseenter","scroll","pBind"],[4,"ngTemplateOutlet"],["tabindex","0","role","scrollbar",3,"mousedown","keydown","keyup","focus","blur","pBind"],["tabindex","0","role","scrollbar",3,"mousedown","keydown","keyup","focus","pBind"]],template:function(e,t){if(e&1){let n=M();Fi(),p(0,"div",3)(1,"div",4,0),P("mouseenter",function(){return w(n),g(t.moveBar())})("scroll",function(o){return w(n),g(t.onScroll(o))}),x(3,Zu,1,0),J(4,ef,1,0,"ng-container",5),f()(),p(5,"div",6,1),P("mousedown",function(o){return w(n),g(t.onXBarMouseDown(o))})("keydown",function(o){return w(n),g(t.onKeyDown(o))})("keyup",function(){return w(n),g(t.onKeyUp())})("focus",function(o){return w(n),g(t.onFocus(o))})("blur",function(){return w(n),g(t.onBlur())}),f(),p(7,"div",7,2),P("mousedown",function(o){return w(n),g(t.onYBarMouseDown(o))})("keydown",function(o){return w(n),g(t.onKeyDown(o))})("keyup",function(){return w(n),g(t.onKeyUp())})("focus",function(o){return w(n),g(t.onFocus(o))}),f()}e&2&&(he(t.cx("contentContainer")),m("pBind",t.ptm("contentContainer")),c(),he(t.cx("content")),m("pBind",t.ptm("content")),c(2),R(!t.contentTemplate&&!t._contentTemplate?3:-1),c(),m("ngTemplateOutlet",t.contentTemplate||t._contentTemplate),c(),he(t.cx("barX")),m("pBind",t.ptm("barX")),qe("aria-orientation","horizontal")("aria-valuenow",t.lastScrollLeft)("aria-controls",t.contentId),c(2),he(t.cx("barY")),m("pBind",t.ptm("barY")),qe("aria-orientation","vertical")("aria-valuenow",t.lastScrollTop)("aria-controls",t.contentId))},dependencies:[un,Di,ui,In,Vt],encapsulation:2,changeDetection:0})}return r})(),Ar=(()=>{class r{static \u0275fac=function(e){return new(e||r)};static \u0275mod=ii({type:r});static \u0275inj=ei({imports:[of,ui,In,ui,In]})}return r})();var Lr=`
    .p-drawer {
        display: flex;
        flex-direction: column;
        transform: translate3d(0px, 0px, 0px);
        position: relative;
        transition: transform 0.3s;
        background: dt('drawer.background');
        color: dt('drawer.color');
        border: 1px solid dt('drawer.border.color');
        box-shadow: dt('drawer.shadow');
    }

    .p-drawer-content {
        overflow-y: auto;
        flex-grow: 1;
        padding: dt('drawer.content.padding');
    }

    .p-drawer-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        flex-shrink: 0;
        padding: dt('drawer.header.padding');
    }

    .p-drawer-footer {
        padding: dt('drawer.footer.padding');
    }

    .p-drawer-title {
        font-weight: dt('drawer.title.font.weight');
        font-size: dt('drawer.title.font.size');
    }

    .p-drawer-full .p-drawer {
        transition: none;
        transform: none;
        width: 100vw !important;
        height: 100vh !important;
        max-height: 100%;
        top: 0px !important;
        left: 0px !important;
        border-width: 1px;
    }

    .p-drawer-left .p-drawer-enter-from,
    .p-drawer-left .p-drawer-leave-to {
        transform: translateX(-100%);
    }

    .p-drawer-right .p-drawer-enter-from,
    .p-drawer-right .p-drawer-leave-to {
        transform: translateX(100%);
    }

    .p-drawer-top .p-drawer-enter-from,
    .p-drawer-top .p-drawer-leave-to {
        transform: translateY(-100%);
    }

    .p-drawer-bottom .p-drawer-enter-from,
    .p-drawer-bottom .p-drawer-leave-to {
        transform: translateY(100%);
    }

    .p-drawer-full .p-drawer-enter-from,
    .p-drawer-full .p-drawer-leave-to {
        opacity: 0;
    }

    .p-drawer-full .p-drawer-enter-active,
    .p-drawer-full .p-drawer-leave-active {
        transition: opacity 400ms cubic-bezier(0.25, 0.8, 0.25, 1);
    }

    .p-drawer-left .p-drawer {
        width: 20rem;
        height: 100%;
        border-inline-end-width: 1px;
    }

    .p-drawer-right .p-drawer {
        width: 20rem;
        height: 100%;
        border-inline-start-width: 1px;
    }

    .p-drawer-top .p-drawer {
        height: 10rem;
        width: 100%;
        border-block-end-width: 1px;
    }

    .p-drawer-bottom .p-drawer {
        height: 10rem;
        width: 100%;
        border-block-start-width: 1px;
    }

    .p-drawer-left .p-drawer-content,
    .p-drawer-right .p-drawer-content,
    .p-drawer-top .p-drawer-content,
    .p-drawer-bottom .p-drawer-content {
        width: 100%;
        height: 100%;
    }

    .p-drawer-open {
        display: flex;
    }

    .p-drawer-mask:dir(rtl) {
        flex-direction: row-reverse;
    }
`;var lf=["header"],rf=["footer"],af=["content"],sf=["closeicon"],cf=["headless"],pf=["container"],df=["closeButton"],_f=["*"],uf=(r,s)=>({transform:r,transition:s}),ff=r=>({value:"visible",params:r});function mf(r,s){r&1&&wt(0)}function hf(r,s){if(r&1&&J(0,mf,1,0,"ng-container",4),r&2){let i=_(2);m("ngTemplateOutlet",i.headlessTemplate||i._headlessTemplate)}}function wf(r,s){r&1&&wt(0)}function gf(r,s){if(r&1&&(p(0,"div",9),C(1),f()),r&2){let i=_(3);he(i.cx("title")),m("pBind",i.ptm("title")),c(),U(i.header)}}function Sf(r,s){r&1&&(te(),O(0,"svg",12)),r&2&&qe("data-pc-section","closeicon")}function Cf(r,s){}function yf(r,s){r&1&&J(0,Cf,0,0,"ng-template")}function Ef(r,s){if(r&1&&J(0,Sf,1,1,"svg",11)(1,yf,1,0,null,4),r&2){let i=_(4);m("ngIf",!i.closeIconTemplate&&!i._closeIconTemplate),c(),m("ngTemplateOutlet",i.closeIconTemplate||i._closeIconTemplate)}}function vf(r,s){if(r&1){let i=M();p(0,"p-button",10),P("onClick",function(t){w(i);let n=_(3);return g(n.close(t))})("keydown.enter",function(t){w(i);let n=_(3);return g(n.close(t))}),J(1,Ef,2,2,"ng-template",null,1,pe),f()}if(r&2){let i=_(3);m("pt",i.ptm("pcCloseButton"))("ngClass",i.cx("pcCloseButton"))("buttonProps",i.closeButtonProps)("ariaLabel",i.ariaCloseLabel),qe("data-pc-group-section","iconcontainer")}}function If(r,s){r&1&&wt(0)}function bf(r,s){r&1&&wt(0)}function Pf(r,s){if(r&1&&(Pe(0),p(1,"div",5),J(2,bf,1,0,"ng-container",4),f(),Te()),r&2){let i=_(3);c(),m("pBind",i.ptm("footer"))("ngClass",i.cx("footer")),qe("data-pc-section","footer"),c(),m("ngTemplateOutlet",i.footerTemplate||i._footerTemplate)}}function Tf(r,s){if(r&1&&(p(0,"div",5),J(1,wf,1,0,"ng-container",4)(2,gf,2,4,"div",6)(3,vf,3,5,"p-button",7),f(),p(4,"div",5),Ai(5),J(6,If,1,0,"ng-container",4),f(),J(7,Pf,3,4,"ng-container",8)),r&2){let i=_(2);m("pBind",i.ptm("header"))("ngClass",i.cx("header")),qe("data-pc-section","header"),c(),m("ngTemplateOutlet",i.headerTemplate||i._headerTemplate),c(),m("ngIf",i.header),c(),m("ngIf",i.showCloseIcon&&i.closable),c(),m("pBind",i.ptm("content"))("ngClass",i.cx("content")),qe("data-pc-section","content"),c(2),m("ngTemplateOutlet",i.contentTemplate||i._contentTemplate),c(),m("ngIf",i.footerTemplate||i._footerTemplate)}}function Of(r,s){if(r&1){let i=M();p(0,"div",3,0),P("@panelState.start",function(t){w(i);let n=_();return g(n.onAnimationStart(t))})("@panelState.done",function(t){w(i);let n=_();return g(n.onAnimationEnd(t))})("keydown",function(t){w(i);let n=_();return g(n.onKeyDown(t))}),x(2,hf,1,1,"ng-container")(3,Tf,8,11),f()}if(r&2){let i=_();Nt(i.style),he(i.cn(i.cx("root"),i.styleClass)),m("pBind",i.ptm("root"))("@panelState",Re(10,ff,Qe(7,uf,i.transformOptions,i.transitionOptions))),c(2),R(i.headlessTemplate||i._headlessTemplate?2:3)}}var xf=`
    ${Lr}

    /** For PrimeNG **/
    .p-drawer {
        position: fixed;
        display: flex;
        flex-direction: column;
    }

    .p-drawer-left {
        top: 0;
        left: 0;
        width: 20rem;
        height: 100%;
    }

    .p-drawer-right {
        top: 0;
        right: 0;
        width: 20rem;
        height: 100%;
    }

    .p-drawer-top {
        top: 0;
        left: 0;
        width: 100%;
        height: 10rem;
    }

    .p-drawer-bottom {
        bottom: 0;
        left: 0;
        width: 100%;
        height: 10rem;
    }

    .p-drawer-full {
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        -webkit-transition: none;
        transition: none;
    }

    .p-overlay-mask-enter {
        animation: p-overlay-mask-enter-animation 150ms forwards;
    }

    .p-overlay-mask-leave {
        animation: p-overlay-mask-leave-animation 150ms forwards;
    }

    @keyframes p-overlay-mask-enter-animation {
        from {
            background-color: transparent;
        }
        to {
            background-color: rgba(0, 0, 0, 0.4);
        }
    }
    @keyframes p-overlay-mask-leave-animation {
        from {
            background-color: rgba(0, 0, 0, 0.4);
        }
        to {
            background-color: transparent;
        }
    }
`,Rf={mask:({instance:r})=>["p-drawer-mask",{"p-overlay-mask p-overlay-mask-enter":r.modal},{"p-drawer-full":r.fullScreen}],root:({instance:r})=>["p-drawer p-component",{"p-drawer-full":r.fullScreen,"p-drawer-open":r.visible},`p-drawer-${r.position}`],header:"p-drawer-header",title:"p-drawer-title",pcCloseButton:"p-drawer-close-button",content:"p-drawer-content",footer:"p-drawer-footer"},Mr=(()=>{class r extends yn{name="drawer";style=xf;classes=Rf;static \u0275fac=(()=>{let i;return function(t){return(i||(i=Oi(r)))(t||r)}})();static \u0275prov=De({token:r,factory:r.\u0275fac})}return r})();var Dr=new pn("DRAWER_INSTANCE"),Ff=oo([io({transform:"{{transform}}",opacity:0}),to("{{transition}}")]),Af=oo([to("{{transition}}",io({transform:"{{transform}}",opacity:0}))]),Nr="translate3d(-100%, 0px, 0px)",Io=(()=>{class r extends vn{$pcDrawer=zt(Dr,{optional:!0,skipSelf:!0})??void 0;bindDirectiveInstance=zt(Vt,{self:!0});onAfterViewChecked(){this.bindDirectiveInstance.setAttrs(this.ptm("host"))}appendTo="body";blockScroll=!1;style;styleClass;ariaCloseLabel;autoZIndex=!0;baseZIndex=0;modal=!0;closeButtonProps={severity:"secondary",text:!0,rounded:!0};dismissible=!0;showCloseIcon=!0;closeOnEscape=!0;transitionOptions="150ms cubic-bezier(0, 0, 0.2, 1)";get visible(){return this._visible??!1}set visible(i){this._visible=i}get position(){return this._position}set position(i){if(this._position=i,i==="full"){this.transformOptions="none";return}switch(i){case"left":this.transformOptions="translate3d(-100%, 0px, 0px)";break;case"right":this.transformOptions="translate3d(100%, 0px, 0px)";break;case"bottom":this.transformOptions="translate3d(0px, 100%, 0px)";break;case"top":this.transformOptions="translate3d(0px, -100%, 0px)";break}}get fullScreen(){return this._fullScreen}set fullScreen(i){this._fullScreen=i,i===!0?this.transformOptions="none":this.transformOptions=Nr}header;maskStyle;closable=!0;onShow=new ti;onHide=new ti;visibleChange=new ti;containerViewChild;closeButtonViewChild;initialized;_visible;_position="left";_fullScreen=!1;container;transformOptions=Nr;mask;maskClickListener;documentEscapeListener;animationEndListener;_componentStyle=zt(Mr);onAfterViewInit(){this.initialized=!0}headerTemplate;footerTemplate;contentTemplate;closeIconTemplate;headlessTemplate;_headerTemplate;_footerTemplate;_contentTemplate;_closeIconTemplate;_headlessTemplate;templates;onAfterContentInit(){this.templates?.forEach(i=>{switch(i.getType()){case"content":this._contentTemplate=i.template;break;case"header":this._headerTemplate=i.template;break;case"footer":this._footerTemplate=i.template;break;case"closeicon":this._closeIconTemplate=i.template;break;case"headless":this._headlessTemplate=i.template;break;default:this._contentTemplate=i.template;break}})}onKeyDown(i){i.code==="Escape"&&this.hide(!1)}show(){this.container?.setAttribute(this.$attrSelector,""),this.autoZIndex&&en.set("modal",this.container,this.baseZIndex||this.config.zIndex.modal),this.modal&&this.enableModality(),this.onShow.emit({}),this.visibleChange.emit(!0)}hide(i=!0){i&&this.onHide.emit({}),this.modal&&this.disableModality()}close(i){this.hide(),this.visibleChange.emit(!1),i.preventDefault()}enableModality(){let i=this.document.querySelectorAll(".p-drawer-open"),e=i.length,t=e==1?String(parseInt(this.container.style.zIndex)-1):String(parseInt(i[e-1].style.zIndex)-1);this.mask||(this.mask=this.renderer.createElement("div"),this.mask&&(ao(this.mask,"style",this.getMaskStyle()),ao(this.mask,"style",`z-index: ${t}`),Bt(this.mask,this.cx("mask"))),this.dismissible&&(this.maskClickListener=this.renderer.listen(this.mask,"click",n=>{this.dismissible&&this.close(n)})),this.renderer.appendChild(this.document.body,this.mask),this.blockScroll&&al())}getMaskStyle(){return this.maskStyle?Object.entries(this.maskStyle).map(([i,e])=>`${i}: ${e}`).join("; "):""}disableModality(){this.mask&&(_i(this.mask,"p-overlay-mask-enter"),Bt(this.mask,"p-overlay-mask-leave"),this.animationEndListener=this.renderer.listen(this.mask,"animationend",this.destroyModal.bind(this)))}destroyModal(){this.unbindMaskClickListener(),this.mask&&this.renderer.removeChild(this.document.body,this.mask),this.blockScroll&&sl(),this.unbindAnimationEndListener(),this.mask=null}onAnimationStart(i){switch(i.toState){case"visible":this.container=i.element,this.appendContainer(),this.show(),this.closeOnEscape&&this.bindDocumentEscapeListener();break}}onAnimationEnd(i){switch(i.toState){case"void":this.hide(!1),en.clear(this.container),this.unbindGlobalListeners();break}}appendContainer(){this.appendTo&&(this.appendTo==="body"&&this.container?this.renderer.appendChild(this.document.body,this.container):this.container&&ol(this.appendTo,this.container))}bindDocumentEscapeListener(){let i=this.el?this.el.nativeElement.ownerDocument:this.document;this.documentEscapeListener=this.renderer.listen(i,"keydown",e=>{e.which==27&&parseInt(this.container.style.zIndex)===en.get(this.container)&&this.close(e)})}unbindDocumentEscapeListener(){this.documentEscapeListener&&(this.documentEscapeListener(),this.documentEscapeListener=null)}unbindMaskClickListener(){this.maskClickListener&&(this.maskClickListener(),this.maskClickListener=null)}unbindGlobalListeners(){this.unbindMaskClickListener(),this.unbindDocumentEscapeListener()}unbindAnimationEndListener(){this.animationEndListener&&this.mask&&(this.animationEndListener(),this.animationEndListener=null)}onDestroy(){this.initialized=!1,this.visible&&this.modal&&this.destroyModal(),this.appendTo&&this.container&&this.renderer.appendChild(this.el.nativeElement,this.container),this.container&&this.autoZIndex&&en.clear(this.container),this.container=null,this.unbindGlobalListeners(),this.unbindAnimationEndListener()}static \u0275fac=(()=>{let i;return function(t){return(i||(i=Oi(r)))(t||r)}})();static \u0275cmp=je({type:r,selectors:[["p-drawer"]],contentQueries:function(e,t,n){if(e&1&&(It(n,lf,4),It(n,rf,4),It(n,af,4),It(n,sf,4),It(n,cf,4),It(n,jt,4)),e&2){let l;se(l=ce())&&(t.headerTemplate=l.first),se(l=ce())&&(t.footerTemplate=l.first),se(l=ce())&&(t.contentTemplate=l.first),se(l=ce())&&(t.closeIconTemplate=l.first),se(l=ce())&&(t.headlessTemplate=l.first),se(l=ce())&&(t.templates=l)}},viewQuery:function(e,t){if(e&1&&(_e(pf,5),_e(df,5)),e&2){let n;se(n=ce())&&(t.containerViewChild=n.first),se(n=ce())&&(t.closeButtonViewChild=n.first)}},inputs:{appendTo:"appendTo",blockScroll:[2,"blockScroll","blockScroll",li],style:"style",styleClass:"styleClass",ariaCloseLabel:"ariaCloseLabel",autoZIndex:[2,"autoZIndex","autoZIndex",li],baseZIndex:[2,"baseZIndex","baseZIndex",_n],modal:[2,"modal","modal",li],closeButtonProps:"closeButtonProps",dismissible:[2,"dismissible","dismissible",li],showCloseIcon:[2,"showCloseIcon","showCloseIcon",li],closeOnEscape:[2,"closeOnEscape","closeOnEscape",li],transitionOptions:"transitionOptions",visible:"visible",position:"position",fullScreen:"fullScreen",header:"header",maskStyle:"maskStyle",closable:[2,"closable","closable",li]},outputs:{onShow:"onShow",onHide:"onHide",visibleChange:"visibleChange"},features:[Ve([Mr,{provide:Dr,useExisting:r},{provide:En,useExisting:r}]),dn([Vt]),ct],ngContentSelectors:_f,decls:1,vars:1,consts:[["container",""],["icon",""],["role","complementary","pFocusTrap","",3,"pBind","class","style","keydown",4,"ngIf"],["role","complementary","pFocusTrap","",3,"keydown","pBind"],[4,"ngTemplateOutlet"],[3,"pBind","ngClass"],[3,"pBind","class",4,"ngIf"],[3,"pt","ngClass","buttonProps","ariaLabel","onClick","keydown.enter",4,"ngIf"],[4,"ngIf"],[3,"pBind"],[3,"onClick","keydown.enter","pt","ngClass","buttonProps","ariaLabel"],["data-p-icon","times",4,"ngIf"],["data-p-icon","times"]],template:function(e,t){e&1&&(Fi(),J(0,Of,4,12,"div",2)),e&2&&m("ngIf",t.visible)},dependencies:[un,pt,Gt,Di,Ze,cl,ui,Vt,ul,_l],encapsulation:2,data:{animation:[jo("panelState",[no("void => visible",[lo(Ff)]),no("visible => void",[lo(Af)])])]},changeDetection:0})}return r})(),Gr=(()=>{class r{static \u0275fac=function(e){return new(e||r)};static \u0275mod=ii({type:r});static \u0275inj=ei({imports:[Io,ui,ui]})}return r})();var Ur=(()=>{let s=class s{transform(e,t,n){let l=[];if(n){let o=0,a=t+n;a>=e.length&&(a=e.length);for(let u=t;u<a;u++)l[o++]=e[u]}else l=e;return l}};s.\u0275fac=function(t){return new(t||s)},s.\u0275pipe=Mo({name:"fwcGridPagination",type:s,pure:!0,standalone:!1});let r=s;return r})();var Mf,jE=(()=>{let s=class s{constructor(e){this.injector=e,Mf=this.injector}};s.\u0275fac=function(t){return new(t||s)(G(xo))},s.\u0275mod=ii({type:s}),s.\u0275inj=ei({providers:[fn],imports:[Kl,Tr,ql,$l,xl,Rl,hl,Xl,Ar,bl,El,Gr,fl,Zo.forChild(),Zl.forFeature([er])]});let r=s;return r})();Do(Hn,function(){return[pt,Go,Gt,Di,ai,si,bt,ci,Pt,Yt,Wt,mi,Ze,Pl,Tl,hi,Rt,Ol,Il,Io]},function(){return[Uo,Tn,dt,Ur]});export{jE as FwcPolicyModule,Mf as PolicyInjector};
