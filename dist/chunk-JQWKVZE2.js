import{a as Fr}from"./chunk-AATWQVNL.js";import{a as Tr,b as xr,c as Ar,e as Lr}from"./chunk-3CTJFI3B.js";import{a as Or,b as Rr}from"./chunk-WASUNZOU.js";import{$a as vi,$c as re,$e as En,$g as Er,Aa as We,Ab as un,Ae as Cn,Af as ji,Ba as Mt,Bb as xo,Be as Xo,Bf as tr,Ca as O,Cb as Fo,Ce as vt,Cf as Vi,Da as Re,Db as Ii,De as Ge,Df as Wi,Ea as xe,Ed as pe,Ee as Le,Eg as Yi,Fa as Fe,Ff as ir,Fg as On,Ga as c,Gd as de,Gf as nr,Ha as _,Hc as Dt,Hd as ot,I as ee,Ia as T,Id as Ho,Ja as ut,Jd as rt,Je as tn,Ka as ft,Kc as Li,Kd as Ni,Ke as Oe,Kg as fr,La as mt,Lc as Nt,Ld as Gi,Le as me,Lf as or,Lg as Ji,Ma as L,Md as ii,Me as zo,Mf as rr,Mg as mr,N as je,Na as P,Nd as ae,Ne as Be,Nf as lr,Ng as Ki,O as Ft,Oa as d,Oc as fl,Od as Ye,Oe as Bi,Of as ar,Og as hr,Pa as Zi,Pb as Qt,Pc as v,Pd as mn,Pe as he,Pg as oo,Q as N,Qa as en,Qc as X,Qd as hn,Qe as Se,Qf as It,Qg as wr,Ra as D,Rc as Pe,Rd as wn,Re as ki,Rf as sr,Rg as Sr,S as De,Sa as yi,Sb as Ao,Sc as it,Sd as Sn,Sf as cr,Sg as gr,T as At,Ta as Ei,Tb as qn,Tc as hi,Te as qo,Ua as ge,Uc as Mi,Ue as yn,Ug as Rn,V as Co,Va as se,Vb as Qn,Vc as Ae,Ve as lt,Wa as ce,Wc as Ne,We as Qo,Wg as xn,X as h,Xa as we,Xb as $n,Xc as Te,Xg as on,Y as w,Ya as g,Yb as Zn,Yc as z,Ye as to,Yg as Fn,Z as ie,Za as V,Zc as G,Ze as oi,Zf as pr,Zg as Cr,_ as ne,_a as R,_b as eo,_c as Uo,_g as yr,aa as yo,ab as W,ad as Ue,ah as vr,b as gi,ba as Kt,bb as H,bd as nt,be as _e,bh as Ir,cb as Y,cd as Ce,ce as ni,cg as li,ch as An,db as Ze,dd as yt,dg as In,dh as br,ea as $i,ec as $t,ed as Bo,eg as dr,eh as Pr,fb as bo,fd as ti,g as wo,gb as B,gc as $,gd as K,ha as cn,hb as Ie,hc as gt,hf as Gt,i as Kn,ia as ui,ib as et,ic as bi,ig as _r,jb as dn,jc as mi,je as Yo,jg as Hi,ka as Eo,kb as Xn,kc as Lo,kg as Bt,la as vo,lb as Po,lc as k,ld as be,lg as kt,ma as a,mb as C,mc as Ct,mf as vn,mg as bn,na as A,nb as y,nc as Pi,nd as Di,ne as qe,nf as Ut,ob as zt,oc as Zt,od as q,og as ai,pa as Wt,pb as To,pc as Ti,q as Qi,qb as He,qc as Mo,qe as Qe,qg as bt,rb as le,rc as Do,re as ue,rg as nn,sa as Lt,sb as fi,sc as Oi,sd as Et,sf as $o,ta as pn,tb as Oo,tc as Ri,td as ko,tf as Zo,tg as Pn,u as Ci,ua as F,uc as xi,ud as jo,ue as Jo,uf as ri,ug as si,v as So,va as ze,vb as zn,vc as Fi,vd as Vo,vf as io,vg as Tn,wa as m,wb as tt,wc as No,wd as Wo,we as Ui,wg as ci,xa as Xt,xb as Ro,xc as Ai,xd as fn,xe as fe,xg as ur,ya as Io,yb as _n,yc as ei,ye as gn,yg as no,z as go,za as Ve,zb as qt,zc as Go,ze as Ko,zf as er}from"./chunk-YJDF2OBW.js";import{a as Si,b as ho,f as ul,g as te}from"./chunk-GAL4ENT6.js";var at=class{constructor(u,e,i,t,n){this.utilService=u,this.firewallId=e,this.clusterId=i,this.fwcloudId=t,this.policyType=n,this.rules=[]}getFirewallId(){return this.firewallId}getFwcloudId(){return this.fwcloudId}getClusterId(){return this.clusterId}getPolicyType(){return this.policyType}getPolicyRules(){return this.rules}getPolicyRule(u){let e=null;if(Array.isArray(this.rules))for(let i=0;i<this.rules.length&&!e;i++){let t=this.rules[i];t.id===u?e=t:t.rule_group&&Array.isArray(t.rules)&&(e=t.rules.find(n=>n.id===u))}return e}getShowAction(){return this.showAction}setShowAction(u){this.showAction=u}setPolicyRules(u){this.rules=u}getPolicyRulesLength(){return this.rules?this.rules.length:0}};var wi=class extends at{constructor(u,e,i,t,n,o,l,p,s,f){super(u,t,n,o,l),this.utilService=u,this.fwcRoutingTableService=e,this.fwcPolicyGridRoutingTableFunctionalityService=i,this.translationKeys={ENTITY_NAME:"ROUTING.NEW_TABLE_PANEL.ROUTE",ENTITY_DELETE:"ROUTING.ROUTE.DELETE_TEXT",DELETE_SUCCESS:"ROUTING.ROUTE.DELETE_SUCCESS",ENTITY_COLOR:"ROUTING.ROUTE.COLOR_TEXT"},this.routingTableId=s,this.routingTableName=f,this.buildPolicyRules(p)}getRoutingTableId(){return this.routingTableId}getRoutingTableName(){return this.routingTableName}buildPolicyRules(u){let e=[];Array.isArray(u)&&(e=this.fwcPolicyGridRoutingTableFunctionalityService.parseRoutingTableRoutes(this.firewallId,this.fwcloudId,u)),this.rules=e}newPolicyRule(u,e){u&&e!==void 0?this.fwcPolicyGridRoutingTableFunctionalityService.showNewRouteDialog(this.clusterId,this.firewallId,this.routingTableId,this.routingTableName,u.id,e):this.fwcPolicyGridRoutingTableFunctionalityService.showNewRouteDialog(this.clusterId,this.firewallId,this.routingTableId,this.routingTableName)}deletePolicyRuleApiCall(u){return this.utilService.fwcAPICall(this.fwcRoutingTableService.deleteRoutingTableRoutes.bind(this.fwcRoutingTableService),this.firewallId,this.fwcloudId,this.routingTableId,u)}convertPolicyRulesToRoutes(){let u=[];if(Array.isArray(this.rules))for(let e of this.rules){let i=this.convertPolicyRuleToRoute(e);u.push(i)}return u}convertPolicyRuleToRoute(u){let e,i,t=[];if(Array.isArray(u.positions)&&u.positions.length){let o=u.positions.find(s=>s.id===hi.GATEWAY_POSITION);if(o){let s=o.ipobjs.find(f=>f.type===v.OBJ_ADDRESS);s&&(e=s.id)}let l=u.positions.find(s=>s.id===hi.INTERFACE_POSITION);if(l){let s=l.ipobjs.find(f=>f.type===v.OBJ_INTERFACE_FIREWALL||f.type===v.OBJ_INTERFACE_HOST);s&&(i=s.id)}let p=u.positions.find(s=>s.id===hi.TO_POSITION);if(p&&Array.isArray(p.ipobjs))for(let s of p.ipobjs)s._fwcObjType!==v.OBJ_ANY&&t.push({id:s.id,name:s.name,type:s.type,firewall_id:s.firewall_id,cluster_id:s.cluster_id,cluster_name:s.cluster_name,position_order:s.position_order})}return{id:u.id,routingTableId:this.routingTableId,routeGroupId:u.idgroup,comment:u.comment,style:u.style,route_order:u.rule_order,active:!!u.active,firewallApplyToId:null,gatewayId:e,interfaceId:i,items:t}}manageObject(u,e,i,t){this.fwcPolicyGridRoutingTableFunctionalityService.updateRoutePosition(this,this.firewallId,this.fwcloudId,this.routingTableId,u,e,i,t)}deleteObject(u,e){this.fwcPolicyGridRoutingTableFunctionalityService.deleteObjectFromPosition(this.firewallId,this.clusterId,this.fwcloudId,this.routingTableId,u.rule,u,e)}compileSelectedRoutes(){this.fwcPolicyGridRoutingTableFunctionalityService.compileRoutes(this.routingTableId)}moveSelectedRules(u,e){this.fwcPolicyGridRoutingTableFunctionalityService.moveSelectedRoutes(this.clusterId,this.firewallId,this.fwcloudId,this.routingTableId,e.pasteOnRuleId,e.rulesIds,e.pasteOffset)}manageSelectedRules(u,e){return this.utilService.fwcAPICall(this.fwcRoutingTableService.manageTableRoutes.bind(this.fwcRoutingTableService),this.firewallId,this.fwcloudId,this.routingTableId,u.pasteOnRuleId,u.pasteOffset,u.rulesIds,e)}setRuleActive(u,e){let i={active:!!e};this.fwcPolicyGridRoutingTableFunctionalityService.updateSelectedRoutes(this.clusterId,this.firewallId,this.fwcloudId,this.routingTableId,i)}setRuleComment(u){this.fwcPolicyGridRoutingTableFunctionalityService.updateRouteComment(this.routingTableId,u)}setRuleApplyTo(u){this.fwcPolicyGridRoutingTableFunctionalityService.updateRuleApplyTo(this.routingTableId,u)}setRuleScript(u){}setRuleStyleApiCall(){return this.fwcPolicyGridRoutingTableFunctionalityService.setRouteStyle.bind(this.fwcPolicyGridRoutingTableFunctionalityService)}newRuleGroupApiCall(){return this.fwcPolicyGridRoutingTableFunctionalityService.newRouteGroup.bind(this.fwcPolicyGridRoutingTableFunctionalityService)}setRuleGroupStyleApiCall(){return this.fwcPolicyGridRoutingTableFunctionalityService.setGroupValues.bind(this.fwcPolicyGridRoutingTableFunctionalityService)}setRuleGroupNameApiCall(){return this.fwcPolicyGridRoutingTableFunctionalityService.setGroupValues.bind(this.fwcPolicyGridRoutingTableFunctionalityService)}removeRulesFromGroupApiCall(u){let e={routeGroupId:null},i=u.rulesIds;return this.utilService.fwcAPICall(this.fwcRoutingTableService.updateRoutingTableRoutes.bind(this.fwcRoutingTableService),this.firewallId,this.fwcloudId,this.routingTableId,i,e)}deleteRuleGroupApiCall(u){return this.utilService.fwcAPICall(this.fwcRoutingTableService.deleteRoutingTableRouteGroup.bind(this.fwcRoutingTableService),this.firewallId,this.fwcloudId,u)}};var jt=class extends at{constructor(u,e,i,t,n,o,l,p,s,f,S){super(u,t,n,o,l),this.utilService=u,this.fwcDhcpPolicyService=e,this.fwcPolicyGridDhcpRulesFunctionalityService=i,this.messageService=f,this.translate=S,this.translationKeys={ENTITY_NAME:"RULE.RULE",ENTITY_DELETE:"RULE.DELETE_TEXT",DELETE_SUCCESS:"RULE.DELETE_SUCCESS",ENTITY_COLOR:"RULE.COLOR_TEXT"},this.dhcpGroupId=s,this.buildPolicyRules(p)}compileSelectedRoutes(u){throw new Error("Method not implemented.")}getDhcpGroupId(){return this.dhcpGroupId}buildPolicyRules(u){let e=[];Array.isArray(u)&&(e=this.fwcPolicyGridDhcpRulesFunctionalityService.parseDhcpPolicyRules(this.firewallId,this.fwcloudId,u)),this.rules=e}newPolicyRule(u,e){u&&e!==void 0?this.fwcPolicyGridDhcpRulesFunctionalityService.showNewRuleDialog(this.clusterId,this.firewallId,u.id,e):this.fwcPolicyGridDhcpRulesFunctionalityService.showNewRuleDialog(this.clusterId,this.firewallId)}deletePolicyRuleApiCall(u){return this.utilService.fwcAPICall(this.fwcDhcpPolicyService.deleteDhcpPolicyRules.bind(this.fwcDhcpPolicyService),this.firewallId,this.fwcloudId,u)}manageObject(u,e,i,t){this.fwcPolicyGridDhcpRulesFunctionalityService.updateRulePosition(this,this.firewallId,this.fwcloudId,u,e,i,t).catch(()=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.translate.instant("DHCP.POLICY.ERROR_MANAGING_OBJECT")})})}deleteObject(u,e){this.fwcPolicyGridDhcpRulesFunctionalityService.deleteObjectFromPosition(this.firewallId,this.clusterId,this.fwcloudId,u.rule,u,e)}compileSelectedRules(){this.fwcPolicyGridDhcpRulesFunctionalityService.compileSelectedRules()}moveSelectedRules(u,e){this.fwcPolicyGridDhcpRulesFunctionalityService.moveSelectedRules(e.firewall,e.fwcloud,e.pasteOnRuleId,e.rulesIds,e.pasteOffset)}manageSelectedRules(u,e){return this.utilService.fwcAPICall(this.fwcDhcpPolicyService.manageDhcpPolicyRules.bind(this.fwcDhcpPolicyService),this.firewallId,this.fwcloudId,u.pasteOnRuleId,u.pasteOffset,u.rulesIds,e)}setRuleActive(u,e){let i={active:!!e};this.fwcPolicyGridDhcpRulesFunctionalityService.updateSelectedRules(this.clusterId,this.firewallId,this.fwcloudId,i)}setRuleComment(u){this.fwcPolicyGridDhcpRulesFunctionalityService.updateRuleComment(u)}setRuleLeaseTime(u){this.fwcPolicyGridDhcpRulesFunctionalityService.updateRuleLeaseTime(u)}setRuleScript(u){this.fwcPolicyGridDhcpRulesFunctionalityService.updateRuleCfgText(u)}setRuleStyleApiCall(){return this.fwcPolicyGridDhcpRulesFunctionalityService.setRuleStyle.bind(this.fwcPolicyGridDhcpRulesFunctionalityService)}newRuleGroupApiCall(){return this.fwcPolicyGridDhcpRulesFunctionalityService.newDhcpRuleGroup.bind(this.fwcPolicyGridDhcpRulesFunctionalityService)}setRuleGroupStyleApiCall(){return this.fwcPolicyGridDhcpRulesFunctionalityService.setGroupValues.bind(this.fwcPolicyGridDhcpRulesFunctionalityService)}setRuleGroupNameApiCall(){return this.fwcPolicyGridDhcpRulesFunctionalityService.setGroupValues.bind(this.fwcPolicyGridDhcpRulesFunctionalityService)}removeRulesFromGroupApiCall(u){let e={group:null},i=u.rulesIds;return this.utilService.fwcAPICall(this.fwcDhcpPolicyService.updateDhcpPolicyRules.bind(this.fwcDhcpPolicyService),this.firewallId,this.fwcloudId,i,e)}deleteRuleGroupApiCall(u){return this.utilService.fwcAPICall(this.fwcDhcpPolicyService.deleteDhcpPolicyRulesGroup.bind(this.fwcDhcpPolicyService),this.firewallId,this.fwcloudId,u)}};var pi=class extends at{constructor(u,e,i,t,n,o,l,p,s){super(u,t,n,o,l),this.utilService=u,this.fwcKeepalivedPolicyService=e,this.fwcPolicyGridKeepalivedRulesFunctionalityService=i,this.translationKeys={ENTITY_NAME:"RULE.RULE",ENTITY_DELETE:"RULE.DELETE_TEXT",DELETE_SUCCESS:"RULE.DELETE_SUCCESS",ENTITY_COLOR:"RULE.COLOR_TEXT"},this.keepalivedGroupId=s,this.buildPolicyRules(p)}compileSelectedRoutes(u){throw new Error("Method not implemented.")}getKeepalivedGroupId(){return this.keepalivedGroupId}buildPolicyRules(u){let e=[];Array.isArray(u)&&(e=this.fwcPolicyGridKeepalivedRulesFunctionalityService.parseKeepalivedPolicyRules(this.firewallId,this.fwcloudId,u)),this.rules=e}newPolicyRule(u,e){u&&e!==void 0?this.fwcPolicyGridKeepalivedRulesFunctionalityService.showNewRuleDialog(this.clusterId,this.firewallId,u.id,e):this.fwcPolicyGridKeepalivedRulesFunctionalityService.showNewRuleDialog(this.clusterId,this.firewallId)}deletePolicyRuleApiCall(u){return this.utilService.fwcAPICall(this.fwcKeepalivedPolicyService.deleteKeepalivedPolicyRules.bind(this.fwcKeepalivedPolicyService),this.firewallId,this.fwcloudId,u)}manageObject(u,e,i,t){this.fwcPolicyGridKeepalivedRulesFunctionalityService.updateRulePosition(this,this.firewallId,this.fwcloudId,u,e,i,t)}deleteObject(u,e){this.fwcPolicyGridKeepalivedRulesFunctionalityService.deleteObjectFromPosition(this.firewallId,this.clusterId,this.fwcloudId,u.rule,u,e)}compileSelectedRules(){this.fwcPolicyGridKeepalivedRulesFunctionalityService.compileSelectedRules()}moveSelectedRules(u,e){this.fwcPolicyGridKeepalivedRulesFunctionalityService.moveSelectedRules(e.firewall,e.fwcloud,e.pasteOnRuleId,e.rulesIds,e.pasteOffset)}manageSelectedRules(u,e){return this.utilService.fwcAPICall(this.fwcKeepalivedPolicyService.manageKeepalivedPolicyRules.bind(this.fwcKeepalivedPolicyService),this.firewallId,this.fwcloudId,u.pasteOnRuleId,u.pasteOffset,u.rulesIds,e)}setRuleActive(u,e){let i={active:!!e};this.fwcPolicyGridKeepalivedRulesFunctionalityService.updateSelectedRules(this.clusterId,this.firewallId,this.fwcloudId,i)}setRuleScript(u){this.fwcPolicyGridKeepalivedRulesFunctionalityService.updateRuleCfgText(u)}setRuleComment(u){this.fwcPolicyGridKeepalivedRulesFunctionalityService.updateRuleComment(u)}setRuleStyleApiCall(){return this.fwcPolicyGridKeepalivedRulesFunctionalityService.setRuleStyle.bind(this.fwcPolicyGridKeepalivedRulesFunctionalityService)}newRuleGroupApiCall(){return this.fwcPolicyGridKeepalivedRulesFunctionalityService.newKeepalivedRuleGroup.bind(this.fwcPolicyGridKeepalivedRulesFunctionalityService)}setRuleGroupStyleApiCall(){return this.fwcPolicyGridKeepalivedRulesFunctionalityService.setGroupValues.bind(this.fwcPolicyGridKeepalivedRulesFunctionalityService)}setRuleGroupNameApiCall(){return this.fwcPolicyGridKeepalivedRulesFunctionalityService.setGroupValues.bind(this.fwcPolicyGridKeepalivedRulesFunctionalityService)}removeRulesFromGroupApiCall(u){let e={group:null},i=u.rulesIds;return this.utilService.fwcAPICall(this.fwcKeepalivedPolicyService.updateKeepalivedPolicyRule.bind(this.fwcKeepalivedPolicyService),this.firewallId,this.fwcloudId,i,e)}deleteRuleGroupApiCall(u){return this.utilService.fwcAPICall(this.fwcKeepalivedPolicyService.deleteKeepalivedPolicyRulesGroup.bind(this.fwcKeepalivedPolicyService),this.firewallId,this.fwcloudId,u)}};var di=class extends at{constructor(u,e,i,t,n,o,l,p,s){super(u,t,n,o,l),this.utilService=u,this.fwcHAProxyPolicyService=e,this.fwcPolicyGridHAProxyRulesFunctionalityService=i,this.translationKeys={ENTITY_NAME:"RULE.RULE",ENTITY_DELETE:"RULE.DELETE_TEXT",DELETE_SUCCESS:"RULE.DELETE_SUCCESS",ENTITY_COLOR:"RULE.COLOR_TEXT"},this.HAProxyGroupId=s,this.buildPolicyRules(p)}compileSelectedRoutes(u){throw new Error("Method not implemented.")}getHAProxyGroupId(){return this.HAProxyGroupId}buildPolicyRules(u){let e=[];Array.isArray(u)&&(e=this.fwcPolicyGridHAProxyRulesFunctionalityService.parseHAProxyPolicyRules(this.firewallId,this.fwcloudId,u)),this.rules=e}newPolicyRule(u,e){u&&e!==void 0?this.fwcPolicyGridHAProxyRulesFunctionalityService.showNewRuleDialog(this.clusterId,this.firewallId,u.id,e):this.fwcPolicyGridHAProxyRulesFunctionalityService.showNewRuleDialog(this.clusterId,this.firewallId)}deletePolicyRuleApiCall(u){return this.utilService.fwcAPICall(this.fwcHAProxyPolicyService.deleteHAProxyPolicyRules.bind(this.fwcHAProxyPolicyService),this.firewallId,this.fwcloudId,u)}manageObject(u,e,i,t){this.fwcPolicyGridHAProxyRulesFunctionalityService.updateRulePosition(this,this.firewallId,this.fwcloudId,u,e,i,t)}deleteObject(u,e){this.fwcPolicyGridHAProxyRulesFunctionalityService.deleteObjectFromPosition(this.firewallId,this.clusterId,this.fwcloudId,u.rule,u,e)}compileSelectedRules(){this.fwcPolicyGridHAProxyRulesFunctionalityService.compileSelectedRules()}moveSelectedRules(u,e){this.fwcPolicyGridHAProxyRulesFunctionalityService.moveSelectedRules(e.firewall,e.fwcloud,e.pasteOnRuleId,e.rulesIds,e.pasteOffset)}manageSelectedRules(u,e){return this.utilService.fwcAPICall(this.fwcHAProxyPolicyService.manageHAProxyPolicyRules.bind(this.fwcHAProxyPolicyService),this.firewallId,this.fwcloudId,u.pasteOnRuleId,u.pasteOffset,u.rulesIds,e)}setRuleActive(u,e){let i={active:!!e};this.fwcPolicyGridHAProxyRulesFunctionalityService.updateSelectedRules(this.clusterId,this.firewallId,this.fwcloudId,i)}setRuleComment(u){this.fwcPolicyGridHAProxyRulesFunctionalityService.updateRuleComment(u)}setRuleScript(u){this.fwcPolicyGridHAProxyRulesFunctionalityService.updateRuleCfgText(u)}setRuleStyleApiCall(){return this.fwcPolicyGridHAProxyRulesFunctionalityService.setRuleStyle.bind(this.fwcPolicyGridHAProxyRulesFunctionalityService)}newRuleGroupApiCall(){return this.fwcPolicyGridHAProxyRulesFunctionalityService.newHAProxyRuleGroup.bind(this.fwcPolicyGridHAProxyRulesFunctionalityService)}setRuleGroupStyleApiCall(){return this.fwcPolicyGridHAProxyRulesFunctionalityService.setGroupValues.bind(this.fwcPolicyGridHAProxyRulesFunctionalityService)}setRuleGroupNameApiCall(){return this.fwcPolicyGridHAProxyRulesFunctionalityService.setGroupValues.bind(this.fwcPolicyGridHAProxyRulesFunctionalityService)}removeRulesFromGroupApiCall(u){let e={group:null},i=u.rulesIds;return this.utilService.fwcAPICall(this.fwcHAProxyPolicyService.updateHAProxyPolicyRules.bind(this.fwcHAProxyPolicyService),this.firewallId,this.fwcloudId,i,e)}deleteRuleGroupApiCall(u){return this.utilService.fwcAPICall(this.fwcHAProxyPolicyService.deleteHAProxyPolicyRulesGroup.bind(this.fwcHAProxyPolicyService),this.firewallId,this.fwcloudId,u)}};var Ln=(()=>{class r{constructor(e,i,t,n,o,l,p,s,f,S,E,I,b,x,J,U,M,Q){this.fwcContextMenuService=e,this.fwcErrorPipe=i,this.fwcPolicyService=t,this.fwcFirewallService=n,this.fwcUserService=o,this.itemSelectedService=l,this.ruleSelectedService=p,this.inputDataService=s,this.utilService=f,this.fwcPolicyGridRoutingTableFunctionalityService=S,this.renderer=E,this.cd=I,this.messageService=b,this.confirmationService=x,this.translate=J,this.store=U,this.fwcAiAssistantService=M,this.aiAssistantCheckEnabledService=Q,this.aiAssistantCheckEnabled=!1,this.infoTooltipShown=!1,this.ruleContextMenu=e.getRuleMenus(),this.aiAssistantCheckEnabledSubscription=this.aiAssistantCheckEnabledService.getaiAssistantCheckEnabled().subscribe(j=>{this.aiAssistantCheckEnabled=j})}ngOnDestroy(){this.aiAssistantCheckEnabledSubscription&&this.aiAssistantCheckEnabledSubscription.unsubscribe()}setRuleTooltip(e){let i="RULE.RULE_ID";e.type===Pe.ROUTING_TABLE&&(i="ROUTING.ROUTE.ROUTE_ID");let t="<h6>"+this.translate.instant(i)+" <strong>"+e.id+"</strong></h6><ul>";return e.special&&e.special!=it.HOOKSCRIPT&&(t+='<li><i class="fa fa-fw fa-exclamation-circle fwcOrange"></i> '+this.translate.instant("RULE.RULE_IS_SPECIAL")+"</li>"),e.options&&(t+='<li><i class="fa fa-fw fa-cog fwcBlue"></i> '+this.translate.instant("RULE.RULE_HAS_OPTIONS")+"</li>"),(e.run_before||e.run_after)&&(t+='<li><i class="fa fa-fw fa-file-code fwcOrange"></i> '+this.translate.instant("RULE.RULE_HAS_HOOKS")+"</li>"),e.active||(t+='<li><i class="fa fa-fw fa-times fwcRed"></i> '+this.translate.instant("RULE.RULE_IS_DISABLED")+"</li>"),t+="</ul>",t}selectRule(e,i){if(i&&i.shiftKey){let t,n,o;this.ruleSelectedService.addSelectedRule(e),o=this.ruleSelectedService.getActualSelectedRules();for(let l=0;l<o.length;l++)(o[l].rule_order<t||t==null)&&(t=o[l].rule_order),(o[l].rule_order>t||n==null)&&(n=o[l].rule_order);t&&n&&t!=n&&this.ruleSelectedService.setSelectedRuleRange(t,n)}else i&&i.ctrlKey?(this.ruleSelectedService.isRuleSelected(e.id)?this.ruleSelectedService.removeSelectedRule(e):this.ruleSelectedService.addSelectedRule(e),i.preventDefault()):(this.ruleSelectedService.clearSelectedRules(),this.ruleSelectedService.addSelectedRule(e))}editRule(e){e.type!==Pe.POLICY_ROUTING&&e.type!==Pe.ROUTING_TABLE&&e.special!==it.HOOKSCRIPT&&e.special!==it.FAIL2BAN&&this.ruleSelectedService.setRule(e)}getRulePolicyType(e){let i;return Array.isArray(e.positions)&&e.positions.length&&(i=e.positions[0].policy_type),i}onContextMenuLoad(e,i){return te(this,null,function*(){let t,n,o,l,p,s,f,S=!1,E,I,b=!1,x,J=!1,U,M,Q=this.fwcUserService.getActualFwcUser();switch(e.type){case Pe.ROUTING_TABLE:M=this.ruleContextMenu.ROUTE;break;case Pe.POLICY_ROUTING:M=this.ruleContextMenu.ROUTING_RULE;break;case z[X.DHCP]:case z[X.DHCP_FIXED_IP]:M=this.ruleContextMenu.DHCP_RULE;break;case z[X.KEEPALIVED]:M=this.ruleContextMenu.KEEPALIVED_RULE;break;case z[X.HAPROXY]:M=this.ruleContextMenu.HAPROXY_RULE;break;default:M=this.ruleContextMenu.RULE}this.ruleSelectedService.isRuleSelected(e.id)||(this.ruleSelectedService.clearSelectedRules(),this.ruleSelectedService.addSelectedRule(e)),t=this.ruleSelectedService.getActualSelectedRules(),I=t.some(oe=>!!oe.special),I&&(b=!t.some(oe=>oe.special&&oe.special!=it.HOOKSCRIPT)),x=t.some(oe=>oe.special==it.CATCHALL),J=t.some(oe=>oe.special==it.FAIL2BAN),n=this.ruleSelectedService.getSelectedRulesLength(),o=this.ruleSelectedService.getActualClipboardRulesLength(),s=this.ruleSelectedService.getSelectedRulesGroups(),l=s.length,p=s.indexOf(-1)!=-1,f=this.checkSequentialSelectedRules(),E=this.ruleSelectedService.getActualClipboardRules(),E&&E.action==re.CUT&&E.rules&&E.rules.length&&(S=E.rules.some(oe=>oe.id==e.id)),n>1?this.fwcContextMenuService.swapMenuOptions(M,"text","textMulti"):this.fwcContextMenuService.swapMenuOptions(M,"text","textSingle"),this.fwcContextMenuService.setMenuOption(M,G.RULE_COMPILE,"visible",l==1),this.fwcContextMenuService.setMenuOption(M,G.RULE_COLOR_CHANGE,"visible",!I||b),this.fwcContextMenuService.setMenuOption(M,G.RULE_EDIT,"visible",n==1&&!b&&!J),U=l==1&&p&&n>=1,U=U&&f,this.fwcContextMenuService.setMenuOption(M,G.RULE_CREATE_GROUP,"visible",U),U=l==1&&!p,this.fwcContextMenuService.setMenuOption(M,G.RULE_REMOVE_GROUP,"visible",U);let j=this.getSelectedRuleIndex();U=l==1&&!p,U=U&&f,U=U&&(j.groupAbove!=j.firstGroup||j.groupBelow!=j.lastGroup),this.fwcContextMenuService.setMenuOption(M,G.RULE_REMOVE_FROM_GROUP,"visible",U),n==1?(this.fwcContextMenuService.setMenuOption(M,G.RULE_ENABLE,"visible",!e.active&&(!I||b)),this.fwcContextMenuService.setMenuOption(M,G.RULE_DISABLE,"visible",!!e.active&&(!I||b))):(this.fwcContextMenuService.setMenuOption(M,G.RULE_ENABLE,"visible",!0),this.fwcContextMenuService.setMenuOption(M,G.RULE_DISABLE,"visible",!I||b)),this.fwcContextMenuService.setMenuOption(M,G.RULE_DELETE,"visible",l==1&&n>1||n==1&&(!I||b)),U=j.ruleAbove!=-1&&!x,this.fwcContextMenuService.setMenuOption(M,G.RULE_MOVE_ABOVE,"visible",l==1&&U),U&&f&&l==1&&j.firstGroup!=j.groupAbove&&j.groupAbove!=-1&&j.groupAbove!=null?this.fwcContextMenuService.swapMenuOptionText(M,G.RULE_MOVE_ABOVE,"text","textGroup"):this.fwcContextMenuService.swapMenuOptionText(M,G.RULE_MOVE_ABOVE,"text","textNormal"),U=j.ruleBelow!=-1&&!j.ruleBelowCatchAll,this.fwcContextMenuService.setMenuOption(M,G.RULE_MOVE_BELOW,"visible",l==1&&U),U&&f&&l==1&&j.lastGroup!=j.groupBelow&&j.groupBelow!=-1&&j.groupBelow!=null?this.fwcContextMenuService.swapMenuOptionText(M,G.RULE_MOVE_BELOW,"text","textGroup"):this.fwcContextMenuService.swapMenuOptionText(M,G.RULE_MOVE_BELOW,"text","textNormal"),this.fwcContextMenuService.setMenuOption(M,G.COPY,"visible",l==1&&(!I||b)),this.fwcContextMenuService.setMenuOption(M,G.CUT,"visible",l==1&&(!I||b)),this.fwcContextMenuService.setMenuOption(M,G.PASTE_ABOVE,"visible",o>=1&&!S),this.fwcContextMenuService.setMenuOption(M,G.PASTE_BELOW,"visible",o>=1&&!S&&!x),this.fwcContextMenuService.setMenuOption(M,G.RULE_NEW_BELOW,"visible",!x),this.fwcContextMenuService.setMenuOption(M,G.RULE_NEW_HS_BELOW,"visible",!x);let Z=Q.lockInfo.result;M.items.forEach(oe=>{oe.enabled=Z}),this.fwcContextMenuService.setMenuOption(M,G.AI_ASSISTANT,"enabled",!!this.aiAssistantCheckEnabled)})}onContextMenuHandler(e,i,t){let n=rt(i);if(t.detail.item){let o=this.ruleSelectedService.getActualSelectedRules(),l=this.ruleSelectedService.getActualClipboardRules();switch(t.detail.item.id){case G.RULE_COMPILE:case G.COMPILE_IPTABLES:case G.COMPILE_NFTABLES:{let p;t.detail.item.id===G.COMPILE_IPTABLES?p=ti[0].id:t.detail.item.id===G.COMPILE_NFTABLES&&(p=ti[1].id),e instanceof jt||e instanceof di||e instanceof pi?e.compileSelectedRules():e.compileSelectedRoutes(p);break}case G.SYSTEM_COMPILE:e instanceof jt&&e.compileSelectedRules();case G.RULE_SELECT:case G.RULE_UNSELECT:this.selectRule(i);break;case G.RULE_EDIT:this.editRule(i);break;case G.RULE_ENABLE:case G.RULE_DISABLE:{let p=t.detail.item.id==G.RULE_ENABLE?1:0;e.setRuleActive(i,p);break}case G.RULE_NEW_HS_ABOVE:case G.RULE_NEW_HS_BELOW:case G.RULE_NEW_ABOVE:case G.RULE_NEW_BELOW:{let p=i.type===Pe.POLICY_ROUTING||i.type===Pe.ROUTING_TABLE||i.type===z[X.DHCP]||i.type===z[X.DHCP_FIXED_IP]||i.type===z[X.KEEPALIVED]||i.type===z[X.HAPROXY]?-1:0,s=t.detail.item.id==G.RULE_NEW_ABOVE||t.detail.item.id==G.RULE_NEW_HS_ABOVE?p:1;[z[X.DHCP],z[X.KEEPALIVED],z[X.HAPROXY]].includes(i.type)&&i.special?n.special=[G.RULE_NEW_ABOVE,G.RULE_NEW_BELOW].includes(t.detail.item.id)?it.HOOKSCRIPT:0:n.special=t.detail.item.id==G.RULE_NEW_HS_ABOVE||t.detail.item.id==G.RULE_NEW_HS_BELOW?it.HOOKSCRIPT:0,e.newPolicyRule(n,s);break}case G.RULE_DELETE:{this.deleteSelectedRules(e,i,o,t.detail.item.id);break}case G.COPY:this.ruleSelectedService.copyRulesToClipboard();break;case G.CUT:this.ruleSelectedService.cutRulesToClipboard();break;case G.PASTE_ABOVE:case G.PASTE_BELOW:{this.pasteSelectedRules(e,i,l,t.detail.item.id);break}case G.RULE_MOVE_ABOVE:case G.RULE_MOVE_BELOW:{let p;p=this.newRulesData(i,o,t.detail.item.id,re.CUT),e.moveSelectedRules(i,p);break}case G.RULE_CREATE_GROUP:{let p=e.newRuleGroupApiCall(),s={header:this.translate.instant("RULE.GROUP_TEXT_HEADER"),helpText:this.translate.instant("RULE.GROUP_TEXT"),formControls:[{name:"groupName",label:this.translate.instant("POLICY_GRID.GR_NAME.NAME"),type:"text",required:!0}],onAccept:f=>p(i.firewall,this.fwcUserService.getActualFwSelectedCloud(),f)};e instanceof wi&&(s.formControls.push({name:"separator",type:"separator"}),s.formControls.push({name:"groupComment",label:this.translate.instant("ITEM_PANEL.FIELDS.COMMENTS"),type:"text"})),e instanceof jt&&(s.formControls.push({name:"separator",type:"separator"}),s.formControls.push({name:"groupComment",label:this.translate.instant("ITEM_PANEL.FIELDS.COMMENTS"),type:"text"})),e instanceof pi&&(s.formControls.push({name:"separator",type:"separator"}),s.formControls.push({name:"groupComment",label:this.translate.instant("ITEM_PANEL.FIELDS.COMMENTS"),type:"text"})),e instanceof di&&(s.formControls.push({name:"separator",type:"separator"}),s.formControls.push({name:"groupComment",label:this.translate.instant("ITEM_PANEL.FIELDS.COMMENTS"),type:"text"})),this.inputDataService.setInputData(s);break}case G.RULE_REMOVE_GROUP:i.idgroup&&this.confirmationService.confirm({header:this.translate.instant("GLOBALS.MSG_CONFIRM"),icon:"fa fa-question-circle fwcBlue iconBig",message:this.translate.instant("POLICY_GRID.GR_DELETE",{name:i.group_name}),rejectVisible:!0,rejectLabel:"No",acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.YES"),accept:()=>{e.deleteRuleGroupApiCall(i.idgroup).then(p=>{this.store.dispatch(ue.reloadDialog({dialogUuids:[q.ITEM_PANEL]}));let s=[];s.push(i),this.policyReload(s)}).catch(p=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(p)})})}});break;case G.RULE_REMOVE_FROM_GROUP:{let p;p=this.newRulesData(i,o,t.detail.item.id,re.DELETE),e.removeRulesFromGroupApiCall(p).then(s=>{this.store.dispatch(ue.reloadDialog({dialogUuids:[q.ITEM_PANEL]}));let f=[];f.push(i),this.policyReload(f)}).catch(s=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(s)})});break}case G.RULE_COLOR_CHANGE:{let p=this.translate.instant(e.translationKeys.ENTITY_COLOR),s=e.setRuleStyleApiCall(),f={header:this.translate.instant("RULE.COLOR_HEADER"),helpText:p,formControls:[{name:"ruleColor",placeholder:this.translate.instant("RULE.COLOR_PLACEHOLDER"),type:"colorpicker",value:i.style}],onAccept:S=>s(i,S)};e instanceof wi&&f.formControls.push({name:"routingTableId",type:"hidden",value:e.getRoutingTableId()}),e instanceof jt&&f.formControls.push({name:"dhcpGroupId",type:"hidden",value:e.getDhcpGroupId()}),e instanceof pi&&f.formControls.push({name:"keepalivedGroupId",type:"hidden",value:e.getKeepalivedGroupId()}),e instanceof di&&f.formControls.push({name:"haproxyGroupId",type:"hidden",value:e.getHAProxyGroupId()}),this.inputDataService.setInputData(f);break}case G.AI_ASSISTANT:{let p=this.utilService.createDynamicComponentRef(br),s=p.instance;s.setDynamicComponentRef(p);let f;f={fwcloud:this.fwcUserService.getActualFwSelectedCloud(),firewall:i.firewall,type:i.type};let S=this.ruleSelectedService.getRulesOrderedIds(o,!0);if(!S)return;f.rulesIds=S.rulesIds,s.showAIDialog({fwcloud:f.fwcloud,firewallId:f.firewall,rulesIds:f.rulesIds});break}case G.NO_MENU:break}}}checkSequentialSelectedRules(){let e=!1,i,t;if(i=this.fwcPolicyService.getActualPolicySequential(),t=this.ruleSelectedService.getActualSelectedRules(),t.length){t.sort(function(n,o){return n.rule_order>o.rule_order?1:n.rule_order<o.rule_order?-1:0});for(let n=0;n<i.length;n++)if(i[n].id==t[0].id){e=!0;for(let o=1;o<t.length&&n+o<i.length;o++)if(i[n+o].id!=t[o].id){e=!1;break}break}}return e}getSelectedRuleIndex(){let e,i,t,n,o,l,p,s;if(i=this.fwcPolicyService.getActualPolicySequential(),t=this.ruleSelectedService.getActualSelectedRules(),t.length){t.sort(function(E,I){return E.rule_order>I.rule_order?1:E.rule_order<I.rule_order?-1:0});let f=t[0],S=t[t.length-1];n=o=l=p=-1;for(let E=0;E<i.length;E++){let I=i[E];if(I.id==f.id)break;n=I.id,l=I.idgroup}for(let E=i.length-1;E>=0;E--){let I=i[E];if(I.id==S.id)break;s=I.special==it.CATCHALL,o=I.id,p=I.idgroup}e={firstRule:f.id,firstGroup:f.idgroup,lastRule:S.id,lastGroup:S.idgroup,ruleBelow:o,ruleBelowCatchAll:s,groupBelow:p,ruleAbove:n,groupAbove:l}}return e}detectChanges(){this.cd.destroyed||(this.cd.markForCheck(),this.cd.detectChanges())}createNewRule(e,i){this.utilService.fwcAPICall(this.fwcPolicyService.newPolicyRule.bind(this.fwcPolicyService),e).then(t=>{i&&this.updateFirewallStatus(i),this.policyReload(),this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("RULE.CREATED")})}).catch(t=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(t)})})}moveSelectedRules(e,i){let t=this.ruleSelectedService.getActualSelectedRules();this.store.dispatch(qe.requestBlockUI()),this.utilService.fwcAPICall(this.fwcPolicyService.managePolicyRules.bind(this.fwcPolicyService),i,re.CUT).then(()=>{this.updateFirewallStatus(e),this.policyReload(t)}).catch(n=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(n)})}).finally(()=>{this.store.dispatch(qe.requestUnblockUI())})}deleteSelectedRules(e,i,t,n){let o;o=this.newRulesData(i,t,n,re.DELETE,!0);let l=o&&o.rulesIds.length;if(l){let p=l+" "+this.translate.instant(e.translationKeys.ENTITY_NAME)+(l>1?"s ":""),s=this.translate.instant(e.translationKeys.ENTITY_DELETE,{text:p}),f=this.translate.instant(e.translationKeys.DELETE_SUCCESS);this.confirmationService.confirm({header:this.translate.instant("GLOBALS.MSG_CONFIRM"),icon:"fa fa-question-circle fwcBlue iconBig",message:s,rejectVisible:!0,rejectLabel:"No",acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.YES"),accept:()=>{e.deletePolicyRuleApiCall(o.rulesIds).then(S=>{this.store.dispatch(ue.reloadDialog({dialogUuids:[q.ITEM_PANEL,q.CLUSTER_PANEL,q.FIREWALL_PANEL,q.OVCONFIG_PANEL,q.WIREGUARD_CONFIG_PANEL,q.IPSEC_CONFIG_PANEL]})),this.updateFirewallStatus(i),this.policyReload(),this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:f})}).catch(S=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(S)}),this.detectChanges()})}})}}pasteSelectedRules(e,i,t,n){let o=!1;if(t&&t.action==re.CUT&&t.rules&&t.rules.length&&(o=t.rules.some(l=>{if(l.id==i.id)return!0})),t&&t.rules&&t.rules.length&&!o){let l;l=this.newRulesData(i,t.rules,n,t.action),this.store.dispatch(qe.requestBlockUI()),e.manageSelectedRules(l,t.action).then(p=>{this.store.dispatch(qe.requestUnblockUI()),this.store.dispatch(ue.reloadDialog({dialogUuids:[q.ITEM_PANEL,q.OVCONFIG_PANEL,q.WIREGUARD_CONFIG_PANEL,q.IPSEC_CONFIG_PANEL]})),this.updateFirewallStatus(i),this.policyReload(t.rules),this.ruleSelectedService.clearClipboardRules()}).catch(p=>{this.store.dispatch(qe.requestUnblockUI()),this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(p)})})}}newRulesData(e,i,t,n,o){let l={};l.action=n,l.fwcloud=this.fwcUserService.getActualFwcUser().selectedFwCloud,l.firewall=e.firewall,t==G.PASTE_ABOVE||t==G.RULE_MOVE_ABOVE?l.pasteOffset=-1:l.pasteOffset=1,l.pasteOnRuleOrder=e.rule_order+l.pasteOffset;let p=this.ruleSelectedService.getRulesOrderedIds(i,o),s=p.rulesIds,f=p.orderedRules;if(l.idgroup=e.idgroup,t==G.PASTE_ABOVE||t==G.PASTE_BELOW)l.pasteOnRuleId=e.id;else{let S,E,I,b,x;if(t==G.RULE_MOVE_ABOVE?S=0:S=f.length-1,E=f[S].id,b=this.fwcPolicyService.getActualPolicySequential(),Array.isArray(b)||(b=[]),x=b.findIndex(J=>J.id==E),x!=-1){let J=x+l.pasteOffset;(J<0||J>=b.length)&&(J=x),I=b[J].id,b[J].idgroup!==b[x].idgroup&&(l.pasteOffset=0)}else I=E;l.pasteOnRuleId=I}if(l.rulesIds=s,l.rulesIds){let S=this.fwcPolicyService.getActualPolicy();S&&(l.rulesOrder=[],l.rulesIds.forEach(E=>{let I=S.findIndex(b=>b.id==E);l.rulesOrder.push(I+1)}))}return l}getFirewallCompiler(e){return new Promise((i,t)=>{this.utilService.fwcAPICall(this.fwcFirewallService.getFirewall.bind(this.fwcFirewallService),e,this.fwcUserService.getActualFwSelectedCloud()).then(n=>{let p=(n.data.options&61440)>>12;i(p)}).catch(n=>{t(n)})})}compileSelectedRules(e){return te(this,null,function*(){let i,t,n,o,l,p=this.ruleSelectedService.getActualSelectedRules(),s=this.ruleSelectedService.getRulesOrderedIds(p),f;if(Array.isArray(s.orderedRules)&&s.orderedRules[0]){if(f=s.orderedRules[0],i=this.fwcUserService.getActualFwcUser().customer_id,t=this.fwcUserService.getActualFwcUser().selectedFwCloud,n=f.firewall,o=f.type,l=s.rulesIds,e===void 0)try{e=yield this.getFirewallCompiler(n)}catch(I){this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(I)}),this.ruleSelectedService.setRuleStatus(null);return}let S=ti.find(I=>I.id===e),E;if(S&&(E=S.name),!i||!t||!n||!o||!Array.isArray(l)||!l.length||!E)return;this.ruleSelectedService.setRuleStatus(""),this.detectChanges(),this.utilService.fwcAPICall(this.fwcPolicyService.getPolicyRulesCompilation.bind(this.fwcPolicyService),n,o,l,this.fwcUserService.getActualFwSelectedCloud(),E).then(I=>{if(Array.isArray(I.data)){let b=this.utilService.createDynamicComponentRef(si),x=b.instance;x.setDynamicComponentRef(b),x.showCompilationData(I.data,p,this.translate.instant("RULE.RULE"),void 0,E)}}).catch(I=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(I)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}})}setRulesProperty(e,i,t){let n,o=!1,l;if(l={fwcloud:this.fwcUserService.getActualFwSelectedCloud(),firewall:e.firewall,type:e.type},i=="active")n=this.fwcPolicyService.updatePolicyRulesActive.bind(this.fwcPolicyService),o=!0,l.active=t;else if(i=="style")n=this.fwcPolicyService.updatePolicyRulesStyle.bind(this.fwcPolicyService),l.style=t;else return;let p=this.ruleSelectedService.getActualSelectedRules();if(!p)return;let s=this.ruleSelectedService.getRulesOrderedIds(p,!0);s&&(l.rulesIds=s.rulesIds,this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(n,l).then(f=>{o&&this.updateFirewallStatus(e);for(let S=0;S<p.length;S++){let E=p[S];(!E.special||E.special===it.HOOKSCRIPT)&&(E[i]=t,E=rt(E))}this.ruleSelectedService.setRuleStatus(null),this.cd.detectChanges()}).catch(f=>{this.ruleSelectedService.setRuleStatus(null),this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(f)}),this.cd.detectChanges()}))}newRuleGroup(e,i,t){let n=this.ruleSelectedService.getActualSelectedRules(),o=t?t.groupName:null;if(!(o==null||o=="")){let l={fwcloud:i,firewall:e,name:o,comment:"",rulesIds:[]},p=[],s=n.slice(0);s.sort(function(f,S){return f.rule_order>S.rule_order?1:f.rule_order<S.rule_order?-1:0});for(let f=0;f<s.length;f++)p.push(s[f].id);l.rulesIds=p,this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcPolicyService.newPolicyRulesGroup.bind(this.fwcPolicyService),l).then(f=>{this.store.dispatch(ue.reloadDialog({dialogUuids:[q.ITEM_PANEL]})),this.policyReload(s)}).catch(f=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(f)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null)})}}onSetRuleCustomColor(e,i){i&&this.setRulesProperty(e,"style",i.ruleColor)}updateFirewallStatus(e){this.store.dispatch(Qe.updateFwStatus({item:{cluster:e._fwcClusterId,id:e.firewall,status:3}}))}policyReload(e){let i=this.fwcPolicyService.getActualSelectedPolicy(),t=Object.assign({},i);t._forcePolicyReload=!0,e&&(t._selectedRules=e.slice()),this.fwcPolicyService.setSelectedPolicy(t),this.detectChanges()}updateRule(e){let i=!1,t=!1,n=!1,o=!1,l=!1,p=!1,s=!1,f;return new Promise((E,I)=>{e.formModel||I(!1);let b=e.formModel.action,x=e.action,J=e.formModel.comment,U=e.comment,M=e.formModel.fw_apply_to,Q=e.fw_apply_to,j=e.formModel.mark,Z=e.mark,oe=e.formModel.run_before,ve=e.run_before;f={rule:e.id,idgroup:e.idgroup,firewall:e.firewall,rule_order:e.rule_order,options:e.options,action:e.action,fw_apply_to:e.fw_apply_to,time_start:e.time_start,time_end:e.time_end,comment:e.comment,active:e.active,style:e.style,type:e.type,fwcloud:this.fwcUserService.getActualFwSelectedCloud(),mark:e.mark,run_before:e.run_before},b!=x&&(f.action=b,i=!0),J!=U&&(f.comment=J,n=!0),M!=Q&&(f.fw_apply_to=M,t=!0),j!=Z&&(f.mark=j,p=!0),oe!=ve&&(f.run_before=oe,s=!0),i||n||t||o||l||p||s?(this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcPolicyService.updatePolicyRule.bind(this.fwcPolicyService),f).then(ke=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("RULE.UPDATED")}),i&&(e.action=b),t&&(e.fw_apply_to=M),p&&(e.mark=j),s&&(e.run_before=oe),n&&(e.comment=J),(i||n||t||o||p||s)&&this.updateFirewallStatus(e),E(ke),this.ruleSelectedService.setRuleStatus(null),this.detectChanges()}).catch(ke=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(ke)}),i&&(e.formModel.action=e.action),t&&(e.formModel.fw_apply_to=e.fw_apply_to),n&&(e.formModel.comment=U),s&&(e.formModel.run_before=ve),E(!1),this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})):E(!0)})}onActionDragEnter(e,i,t){let n=this.itemSelectedService.getDragItem();n&&n._fwcObjType==v.OBJ_MARK&&(this.renderer.addClass(t,"tdActionCell-hovered"),e.labelDraggedOverAction=!0)}onActionDragLeave(e,i,t){i.target==t&&(this.renderer.removeClass(t,"tdActionCell-hovered"),e.labelDraggedOverAction=!1)}onActionDragOver(e){e.preventDefault()}onActionDragDrop(e,i,t){let n=this.itemSelectedService.getDragItem();this.itemSelectedService.clearDragItem(),i.preventDefault();let o=()=>{this.renderer.removeClass(t,"tdActionCell-hovered"),e.labelDraggedOverAction=!1,this.ruleSelectedService.setRuleStatus(null),this.detectChanges()};new Promise((p,s)=>{let f=n&&n._fwcObjType==v.OBJ_MARK&&n.id_obj?n.id_obj:void 0;f&&(f!==e.mark||!e.mark)?(this.ruleSelectedService.setRuleStatus(""),e.formModel.mark=f,this.updateRule(e).then(S=>{e.mark_name=n.text,e.mark=f,p(S)}).catch(S=>s(S))):s(!1)}).then(p=>{o()}).catch(p=>{o()})}onDeleteRuleMark(e){e.mark&&(this.ruleSelectedService.setRuleStatus(""),e.formModel.mark=0,this.updateRule(e).then(i=>{this.ruleSelectedService.setRuleStatus(null),this.store.dispatch(ue.reloadDialog({dialogUuids:[q.ITEM_PANEL]})),this.detectChanges()}).catch(i=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()}))}showMarkInfo(e,i){if(i&&i.preventDefault(),this.itemSelectedService.setObjectInfo(void 0,i),!this.infoTooltipTimer&&!this.infoTooltipShown){let t={objId:e.mark,objType:v.OBJ_MARK,fwId:e.firewall};this.infoTooltipTimer=setTimeout(()=>{this.infoTooltipShown=!0,this.itemSelectedService.setObjectInfo(t,i)},1e3)}}clearMarkInfo(e){e&&e.preventDefault(),this.infoTooltipTimer&&(clearTimeout(this.infoTooltipTimer),this.infoTooltipTimer=void 0),this.infoTooltipShown&&(this.itemSelectedService.setObjectInfo(void 0,e),this.infoTooltipShown=!1)}onCommentFocus(e){e.commentEdit=!0}onCommentBlur(e,i){i.commentEdit=!1,e.setRuleComment(i)}onLeaseTimeFocus(e){e.leaseTimeEdit=!0}onLeaseTimeBlur(e,i){i.leaseTimeEdit=!1,e.setRuleLeaseTime(i)}onScriptFocus(e,i){let t=this.utilService.createDynamicComponentRef(ur),n=t.instance;n.setDynamicComponentRef(t),n.show(e,i)}onSetGroupCustomColor(e){if(e){let i=e.groupData,t=e.group;i.style=e.groupColor,i.groupIds=[i.id],this.updateGroup(t,i,!0)}}onSetGroupName(e){if(e){let i=e.group,t=e.groupData,n=""+e.groupName;i&&t&&n.length&&(t.name=n,this.updateGroup(i,t,!1))}}updateGroup(e,i,t){this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcPolicyService.updatePolicyRulesGroupStyleOrName.bind(this.fwcPolicyService),i,t).then(()=>{if(t){e.group_style=i.style;let n=e.rules;for(let o=0;o<n.length;o++)n[o].group_style=e.group_style}else{e.group_name=i.name;let n=e.rules;for(let o=0;o<n.length;o++)n[o].group_name=e.group_name}e=rt(e)}).catch(n=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(n)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}handleChangeApplyTo(e,i){"setRuleApplyTo"in e&&typeof e.setRuleApplyTo=="function"&&e.setRuleApplyTo(i)}static{this.\u0275fac=function(i){return new(i||r)(N(Ni),N(Se),N(fe),N(ae),N(pe),N(Ge),N(Le),N(vt),N(he),N(ci),N(Wt),N(le),N(me),N(Oe),N(de),N(_e),N(jo),N(Vo))}}static{this.\u0275prov=je({token:r,factory:r.\u0275fac})}}return r})();var Dr=new Map([["OpenVPN",1],["GeoIP",2],["CrowdSec",4],["NtopNG",8],["Suricata",16],["Keepalived",32],["Zeek",64],["Elasticsearch",128],["Filebeat",256],["WebSafety",512],["Kibana",1024],["Logstash",2048],["DnsSafety",4096],["iscbind9",8192],["iscdhcp",16384]]),Mn=(()=>{class r{constructor(e,i,t,n,o,l,p,s,f,S,E,I,b,x,J){this.fwcContextMenuService=e,this.fwcErrorPipe=i,this.changeDetectorRef=t,this.fwcUserService=n,this.fwcPolicyService=o,this.itemSelectedService=l,this.confirmationService=p,this.utilService=s,this.ruleSelectedService=f,this.fwcPolicyGridRoutingTableFunctionalityService=S,this.store=E,this.renderer=I,this.messageService=b,this.fwcFirewallService=x,this.translate=J,this.subjectDragEnter=new gi,this.alive=!0,this.onDragEnd=()=>{this.resetVisibleRulePositions()},this.positionContextMenu=this.fwcContextMenuService.getPositionMenus(),this.subjectDragEnter.asObservable().pipe(Ci(20),ee(()=>this.alive)).subscribe(U=>{this.doListDragEnter(U)}),typeof navigator<"u"&&/firefox/i.test(navigator.userAgent)&&window.addEventListener("dragend",this.onDragEnd)}ngOnDestroy(){this.alive=!1,typeof this.onDragEnd=="function"&&window.removeEventListener("dragend",this.onDragEnd)}onContextMenuHandler(e,i,t,n,o,l,p,s){this.onItemRightClickEvent(l,i);let f=l.selectedItem;if(f&&(f.rightclicked=!1,this.detectChanges()),s.detail.item){switch(s.detail.item.id){case G.POSITION_NEGATE:case G.POSITION_ALLOW:if(l.ipobjs.length>1){let E=s.detail.item.id==G.POSITION_NEGATE,I={fwcloud:this.fwcUserService.getActualFwSelectedCloud(),firewall:t,rule:o,position:l.id};this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcPolicyService.negatePolicyObject.bind(this.fwcPolicyService),I,E).then(b=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("POSITION.POS_UPDATED")}),this.updateFirewallStatus(t,n),l.negate=E}).catch(b=>{this.ruleSelectedService.setRuleStatus(null),this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(b)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.removeRightClickedClass(),this.detectChanges()})}break;case G.PASTE:let S=this.itemSelectedService.getActualClipboardItem();if(S&&p.indexOf(+S._fwcObjType)!=-1){let E=S._fwcRuleId,I=S._fwcPositionId,b=S.action;if(E!=o||I!=l.id){let x;x=this.checkOperation(t,l,p,S),x?this.confirmationService.confirm({header:"Error",icon:"fa fa-exclamation-circle fwcRed iconBig",message:x,rejectVisible:!1,acceptLabel:"Ok",accept:()=>{}}):e.manageObject(o,l,S,b),f&&(f.id===S.id&&this.removeRightClickedClass(),S&&this.removeRightClickedClass()),this.detectChanges()}}break}if(f)switch(s.detail.item.id){case G.OBJECT_EDIT:f._fwcObjId!=v.OBJ_ANY&&(f._fwcObjType===v.OBJ_OPENVPN_PREFIX||f._fwcObjType===v.OBJ_WIREGUARD_PREFIX||f._fwcObjType===v.OBJ_IPSEC_PREFIX?(f.editPrefixAction=!0,this.itemSelectedService.setPrefixItem(f)):this.itemSelectedService.setItem(f));break;case G.COPY:if(f._fwcObjId!=v.OBJ_ANY){let E=Object.assign({},f);this.itemSelectedService.setClipboardItem(E,re.COPY)}this.detectChanges();break;case G.CUT:f._fwcObjId!=v.OBJ_ANY&&this.itemSelectedService.setClipboardItem(f,re.CUT),this.detectChanges();break;case G.DELETE:this.confirmationService.confirm({header:this.translate.instant("GLOBALS.MSG_CONFIRM"),icon:"fa fa-question-circle fwcBlue iconBig",message:this.translate.instant("POSITION.DEL_OBJ",{name:f._fwcObjName}),rejectVisible:!0,rejectLabel:"No",acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.YES"),accept:()=>{e.deleteObject(l,f)}});break;case G.WHERE_USED:let S=Object.assign({},f);S._fwcUserId=this.fwcUserService.getActualFwcUser().user_id,S._fwcCloud=this.fwcUserService.getActualFwcUser().selectedFwCloud,S.whereUsedAction=!0,this.itemSelectedService.setItem(S);break}}this.onContextMenuClose(l),this.detectChanges()}deleteObjectFromPosition(e,i,t,n,o){let l,p={fwcloud:this.fwcUserService.getActualFwSelectedCloud(),firewall:e,rule:t,ipobj:-1,ipobj_g:-1,interface:-1,position:n.id,position_order:void 0},s=0;for(let f=0;f<n.ipobjs.length&&!(n.ipobjs[f]._fwcObjId==o._fwcObjId&&n.ipobjs[f]._fwcObjType==o._fwcObjType);f++)n.ipobjs[f]._fwcObjId!=v.OBJ_ANY&&s++;switch(p.position_order=s+1,n.content){case"I":p.interface=o._fwcObjId,l=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_INTERFACE_FIREWALL"),delete p.ipobj,delete p.ipobj_g;break;case"O":default:o._fwcObjType==v.OBJ_OPENVPN_CONFIG_CLI?(p.openvpn=o._fwcObjId,l=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_OPENVPN_CONFIG")):o._fwcObjType==v.OBJ_OPENVPN_PREFIX&&(p.prefix=o._fwcObjId,l=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_PREFIX")),o._fwcObjType==v.OBJ_WGC_CONFIG_CLI?(p.wireguard=o._fwcObjId,l=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_WG_CONFIG")):o._fwcObjType==v.OBJ_WIREGUARD_PREFIX&&(p.prefix=o._fwcObjId,l=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_PREFIX")),o._fwcObjType==v.OBJ_ISC_CONFIG_CLI?(p.ipsec=o._fwcObjId,l=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_IPSEC_CONFIG")):o._fwcObjType==v.OBJ_IPSEC_PREFIX&&(p.prefix=o._fwcObjId,l=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_PREFIX")),o._fwcObjType==v.OBJ_INTERFACE_FIREWALL||o._fwcObjType==v.OBJ_INTERFACE_HOST?(p.interface=o._fwcObjId,l=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_INTERFACE_FIREWALL")):o._fwcObjType==v.OBJ_GROUP||o._fwcObjType==v.OBJ_SERVICE_GROUP||o._fwcObjType==v.OBJ_CONTINENT?(p.ipobj_g=o._fwcObjId,l=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_GROUP")):(p.ipobj=o._fwcObjId,l=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_GEN_IP_OBJECT")),(o._fwcObjType==v.OBJ_OPENVPN_CONFIG_CLI||o._fwcObjType==v.OBJ_OPENVPN_PREFIX||o._fwcObjType==v.OBJ_WGC_CONFIG_CLI||o._fwcObjType==v.OBJ_WIREGUARD_PREFIX||o._fwcObjType==v.OBJ_ISC_CONFIG_CLI||o._fwcObjType==v.OBJ_IPSEC_PREFIX)&&(delete p.ipobj,delete p.ipobj_g,delete p.interface);break}this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcPolicyService.deletePolicyObject.bind(this.fwcPolicyService),p,n.content,o._fwcObjType).then(f=>{this.removeItem(n,o),this.updateFirewallStatus(e,i);let S=this.itemSelectedService.getActualClipboardItem();S&&S._fwcObjId===o.id&&S._fwcPositionId===o._fwcPositionId&&this.itemSelectedService.clearClipboardItem(),this.store.dispatch(ue.reloadDialog({dialogUuids:[q.ITEM_PANEL,q.CLUSTER_PANEL,q.FIREWALL_PANEL,q.OVCONFIG_PANEL,q.WIREGUARD_CONFIG_PANEL,q.IPSEC_CONFIG_PANEL]})),this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:l+this.translate.instant("POSITION.OBJ_DELETED")})}).catch(f=>{let S=this.fwcErrorPipe.transform(f);this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(f)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}onContextMenuLoad(e,i,t,n,o){let l=!1,p=!1,s,f,S,E=!1,I,b;this.clearObjectInfo(void 0);let x=this.positionContextMenu.POSITION,J=this.fwcUserService.getActualFwcUser(),U=this.itemSelectedService.getActualClipboardItem();o.detail.event&&o.detail.event.target&&!o.detail.event.target.getAttribute("data-obj_id")&&(l=!0,t.selectedItem=void 0);let M=document.querySelectorAll(".divFwcPosition-item");M&&M.forEach(j=>{j.classList.remove("item-rightclicked")});let Q=o.detail.event.target;if(Q&&Q.getAttribute("data-obj_id")&&Q.classList.add("item-rightclicked"),this.listenForOutsideClicks(t),S=t.id==14||t.id==16||t.id==34||t.id==35,(t.selectedItem&&t.selectedItem._fwcObjType==v.OBJ_ANY||t.ipobjs.length<=1||l)&&(p=!0),f=U&&U._fwcRuleId==i&&U._fwcPositionId==t.id,s=U&&n.indexOf(+U._fwcObjType)!=-1,I=e===Pe.POLICY_ROUTING||e===Pe.ROUTING_TABLE,b=[z[X.DHCP_FIXED_IP],z[X.DHCP],z[X.KEEPALIVED],z[X.HAPROXY]].includes(e),x&&x.items){for(let j=0;j<x.items.length;j++){let Z=x.items[j];Z.id==G.POSITION_NEGATE&&(Z.visible=!S&&!b&&!I&&!t.negate&&t.ipobjs.length>1),Z.id==G.POSITION_ALLOW&&(Z.visible=!!(!S&&t.negate&&t.ipobjs.length>1)),(Z.id==G.OBJECT_EDIT||Z.id==G.COPY||Z.id==G.CUT||Z.id==G.DELETE||Z.id==G.WHERE_USED||Z.id==G.SEPARATOR)&&(Z.visible=t.id===Ne.MASTER_NODE&&Z.id===G.WHERE_USED?!1:!p),Z.id==G.PASTE&&(Z.visible=!!(U&&s&&!f)),(Z.id==G.DELETE||Z.id==G.CUT)&&(Z.visible=t.id!==hi.GATEWAY_POSITION&&(t.id!==Mi.FROM_POSITION||t.ipobjs.length>2)?!p:!1),Z.visible&&(E=!0)}J.lockInfo.result||x.items.forEach(j=>{j.enabled=j.id===G.WHERE_USED}),!U&&p&&t.ipobjs.length<=1||!E?o.detail.cancel=!0:t.selectedItem&&(t.selectedItem.rightclicked=!0)}t.selectedItem&&t.selectedItem.rightclicked&&(t.selectedItem.rightclicked=!1),this.detectChanges()}onContextMenuClose(e){e.selectedItem&&(e.selectedItem.rightclicked=!1),this.detectChanges()}listenForOutsideClicks(e){let i=t=>{let n=document.querySelector(".iui-contextmenu"),o=n&&n.contains(t.target),l=t.target.closest(".divFwcPosition-item");!o&&!l&&(this.removeRightClickedClass(),document.removeEventListener("click",i))};document.addEventListener("click",i)}removeRightClickedClass(){document.querySelectorAll(".divFwcPosition-item").forEach(i=>{i.classList.remove("item-rightclicked")})}onListDragOver(e){e.preventDefault()}onListDragEnter(e,i,t,n,o){let l;if(i.draggedOver=!0,n.target==o&&(l=this.itemSelectedService.getDragItem(),l.srcPositionUID!=i.positionUID&&l)){let p={draggedItem:l,firewallId:e,fwcPosition:i,fwcPositionEl:o,typesPositions:t};this.doListDragEnter(p)}}doListDragEnter(e){let{firewallId:i,draggedItem:t,typesPositions:n,fwcPosition:o,fwcPositionEl:l}=e,p=+t._fwcObjType;if(!n){o.objectAllowed=!1;return}n.indexOf(p)==-1||o.ipobjs&&o.ipobjs.some(function(s){return t._fwcObjId==s._fwcObjId&&t._fwcObjType==s._fwcObjType})||o.content=="I"&&p==v.OBJ_INTERFACE_FIREWALL&&t._fwcFwId!=i?o.objectAllowed=!1:o.objectAllowed=!0,this.detectChanges()}onListDragLeave(e,i,t){e.target==t&&(i.draggedOver=!1,i.objectAllowed=void 0,this.resetVisibleRulePositions(),this.detectChanges())}onListDragDrop(e,i,t,n,o,l){let p,s,f=e.getFirewallId(),S=e.getClusterId();if(o.preventDefault(),t.draggedOver=!1,t.objectAllowed=void 0,s=this.itemSelectedService.getDragItem(),s&&(s._fwcPositionId!=t.id||s._fwcRuleId!=i))if(p=this.checkOperation(f,t,n,s),p)this.confirmationService.confirm({header:this.translate.instant("POSITION.ERROR_HEADER"),icon:"fa fa-exclamation-circle fwcRed iconBig",message:p,rejectVisible:!1,acceptLabel:"Ok",accept:()=>{}});else if(S&&(s.obj_type==24||s.obj_type==23))this.fwcFirewallService.getCluster.bind(this.fwcFirewallService)(S,this.fwcUserService.getActualFwSelectedCloud()).subscribe(I=>{let b=I.data;if(b.nodes.find(x=>x.install_communication=="agent")&&!(b.plugins&Dr.get("GeoIP")))this.confirmationService.confirm({header:this.translate.instant("FW.PLUGINS.GEOIP_NOT_ACTIVATED_HEADER"),icon:"fa fa-exclamation-triangle fwcOrange iconBig",message:this.translate.instant("FW.PLUGINS.GEOIP_NOT_ACTIVATED_CLUSTER",{cluster:b.name}),rejectVisible:!0,acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.YES"),rejectLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.NO"),reject:()=>{},accept:()=>{if(s.container&&(s.container=void 0,s.containerReadOnly=!1,s._fwcObjType===v.OBJ_ADDRESS)){let x=/^(.+)\s+\((.+)\)$/.exec(s.text);x&&(s._fwcObjName=x[1])}e.manageObject(i,t,s)}});else{if(s.container&&(s.container=void 0,s.containerReadOnly=!1,s._fwcObjType===v.OBJ_ADDRESS)){let x=/^(.+)\s+\((.+)\)$/.exec(s.text);x&&(s._fwcObjName=x[1])}e.manageObject(i,t,s)}});else if(f&&(s.obj_type==24||s.obj_type==23))this.fwcFirewallService.getFirewall.bind(this.fwcFirewallService)(f,this.fwcUserService.getActualFwSelectedCloud()).subscribe(I=>{let b=I.data;if(!(b.plugins&Dr.get("GeoIP"))&&b.install_communication=="agent")this.confirmationService.confirm({header:this.translate.instant("FW.PLUGINS.GEOIP_NOT_ACTIVATED_HEADER"),icon:"fa fa-exclamation-triangle fwcOrange iconBig",message:this.translate.instant("FW.PLUGINS.GEOIP_NOT_ACTIVATED_FIREWALL",{firewall:b.name}),rejectVisible:!0,acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.YES"),rejectLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.NO"),reject:()=>{},accept:()=>{if(s.container&&(s.container=void 0,s.containerReadOnly=!1,s._fwcObjType===v.OBJ_ADDRESS)){let x=/^(.+)\s+\((.+)\)$/.exec(s.text);x&&(s._fwcObjName=x[1])}e.manageObject(i,t,s)}});else{if(s.container&&(s.container=void 0,s.containerReadOnly=!1,s._fwcObjType===v.OBJ_ADDRESS)){let x=/^(.+)\s+\((.+)\)$/.exec(s.text);x&&(s._fwcObjName=x[1])}e.manageObject(i,t,s)}});else{if(s.container&&(s.container=void 0,s.containerReadOnly=!1,s._fwcObjType===v.OBJ_ADDRESS)){let E=/^(.+)\s+\((.+)\)$/.exec(s.text);E&&(s._fwcObjName=E[1])}e.manageObject(i,t,s)}this.itemSelectedService.clearDragItem(),this.resetVisibleRulePositions()}resetVisibleRulePositions(){typeof navigator<"u"&&/firefox/i.test(navigator.userAgent)&&this.fwcPolicyService.getActualPolicy().filter(e=>e.visible===!0).forEach(e=>{e.positions.forEach(i=>{i.draggedOver=!1,i.objectAllowed=void 0;let t=document.getElementById(`position-${i.id}`);t&&(this.renderer.removeClass(t,"fwcObjectAllowed"),this.renderer.removeClass(t,"fwcObjectForbidden"),this.renderer.removeClass(t,"draggedOver"))})})}onItemRightClickEvent(e,i){e.selectedItem=i}onItemClickEvent(e,i){if(e.selectedItem=i,this.clearObjectInfo(void 0),i._fwcObjId!=v.OBJ_ANY){let t={_fwcObjId:i._fwcObjId,_fwcObjType:i._fwcObjType,highlighted:!i.highlighted};this.itemSelectedService.setModifiedItem(t,!1,!1,!1,!0)}}onItemDblClickEvent(e,i){e.selectedItem=i;let t=Object.assign({},i),n=t._fwcObjType===v.OBJ_OPENVPN_PREFIX||t._fwcObjType===v.OBJ_WIREGUARD_PREFIX||t._fwcObjType===v.OBJ_IPSEC_PREFIX;t.editPrefixAction=n,n?this.itemSelectedService.setPrefixItem(t):t&&t._fwcObjId!=v.OBJ_ANY&&this.itemSelectedService.setItem(t)}onMarkDblClickEvent(e){let i={id:e,fwcloud:this.fwcUserService.getActualFwSelectedCloud(),_fwcObjId:e,_fwcObjType:v.OBJ_MARK};this.itemSelectedService.setItem(i)}itemDragStart(e,i,t){let n;t.stopPropagation(),e.selectedItem=i,n=Object.assign({},i),n.srcPositionUID=e.positionUID,this.itemSelectedService.setDragItem(n),t.dataTransfer.setData("dragItemId",n.id.toString()),t.dataTransfer.dropEffect="move",t.dataTransfer.effectAllowed="copyMove",this.clearObjectInfo(void 0)}showObjectInfo(e,i){if(e&&(i&&i.preventDefault(),e&&!this.infoTooltipTimer&&!this.infoTooltipShown)){let t={objId:e._fwcObjId,objType:e._fwcObjType,fwId:e._fwcFwId,clusterId:e._fwcClusterId,objParentId:e.parent_id};t.objId!==null&&t.objType!==null&&t.objType!=v.OBJ_ANY&&(this.infoTooltipTimer=setTimeout(()=>{this.infoTooltipShown=!0,this.itemSelectedService.setObjectInfo(t,i)},1e3))}}clearObjectInfo(e){e&&e.preventDefault(),this.infoTooltipTimer&&(clearTimeout(this.infoTooltipTimer),this.infoTooltipTimer=void 0),this.infoTooltipShown&&(setTimeout(()=>{this.itemSelectedService.setObjectInfo(void 0,e)},500),this.infoTooltipShown=!1)}manageObject(e,i,t,n,o,l){let p=Object.assign({},o),s,f,S=o._fwcObjId,E=o._fwcObjType,I=o._fwcPositionId,b=o._fwcRuleId,x=n.id,J=t,U=o.position_order,M=this.fwcPolicyService.getActualSelectedPolicy()._fwcPolicyIPVersion;if(f=this.translate.instant("POSITION.ERROR_EMPTY_CONTAINER",{name:o._fwcObjName,ipVersion:M}),l)o.position_order=n.ipobjs.length;else{let j=0;for(let Z=0;Z<n.ipobjs.length&&!(n.ipobjs[Z]._fwcObjId==S&&n.ipobjs[Z]._fwcObjType==E);Z++)n.ipobjs[Z]._fwcObjId!=v.OBJ_ANY&&j++;o.position_order=j+1}o._fwcPositionId=o.position=n.id,o._fwcRuleId=o.rule=t,o.ipobj=void 0,o.ipobj_g=void 0,o.interface=void 0,o.container=void 0,o.ipobj=o.ipobj_g=o.interface=-1;let Q={fwcloud:this.fwcUserService.getActualFwSelectedCloud(),firewall:e,rule:o.rule,position:o.position,position_order:o.position_order};if(o._fwcObjType==v.OBJ_OPENVPN_CONFIG_CLI)Q.openvpn=o._fwcObjId,s=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_OPENVPN_CONFIG");else if(o._fwcObjType==v.OBJ_OPENVPN_PREFIX)Q.prefix=o._fwcObjId,s=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_PREFIX"),f=this.translate.instant("POSITION.ERROR_EMPTY_PREFIX",{name:o._fwcObjName});else if(o._fwcObjType==v.OBJ_WGC_CONFIG_CLI)Q.wireguard=o._fwcObjId,s=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_WG_CONFIG");else if(o._fwcObjType==v.OBJ_WIREGUARD_PREFIX)Q.prefix=o._fwcObjId,s=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_PREFIX"),f=this.translate.instant("POSITION.ERROR_EMPTY_PREFIX",{name:o._fwcObjName});else if(o._fwcObjType==v.OBJ_ISC_CONFIG_CLI)Q.ipsec=o._fwcObjId,s=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_IPSEC_CONFIG");else if(o._fwcObjType==v.OBJ_IPSEC_PREFIX)Q.prefix=o._fwcObjId,s=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_PREFIX"),f=this.translate.instant("POSITION.ERROR_EMPTY_PREFIX",{name:o._fwcObjName});else switch(Q.ipobj=o.ipobj,Q.ipobj_g=o.ipobj_g,Q.interface=o.interface,n.content){case"I":Q.interface=o.interface=o._fwcObjId,s="Interface",delete Q.ipobj,delete Q.ipobj_g;break;case"O":default:o._fwcObjType==v.OBJ_INTERFACE_FIREWALL||o._fwcObjType==v.OBJ_INTERFACE_HOST?(Q.interface=o.interface=o._fwcObjId,s=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_INTERFACE_FIREWALL")):o._fwcObjType==v.OBJ_GROUP||o._fwcObjType==v.OBJ_SERVICE_GROUP||o._fwcObjType==v.OBJ_CONTINENT?(Q.ipobj_g=o.ipobj_g=o._fwcObjId,s=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_GROUP")):(Q.ipobj=o.ipobj=o._fwcObjId,s=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_GEN_IP_OBJECT"));break}if(I==null||b==null||l==re.COPY)this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcPolicyService.newPolicyObject.bind(this.fwcPolicyService),Q,n.content,o._fwcObjType).then(j=>{this.updateFirewallStatus(e,i),this.store.dispatch(ue.reloadDialog({dialogUuids:[q.ITEM_PANEL]})),n.ipobjs.push(o),this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:s+this.translate.instant("POSITION.OBJ_ADDED")}),this.ruleSelectedService.setRuleStatus(null),this.ruleSelectedService.setRuleHeightRecalculate(t),this.detectChanges(),l==re.COPY&&this.store.dispatch(ue.reloadDialog({dialogUuids:[q.ITEM_PANEL,q.OVCONFIG_PANEL,q.WIREGUARD_CONFIG_PANEL,q.IPSEC_CONFIG_PANEL]}))}).catch(j=>{let Z;j.error&&j.error.fwcErr==1003?Z=this.translate.instant("POSITION.ERROR_DUP"):j.error&&j.error.fwcErr==5001?Z=f:this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(j)}),Z&&this.confirmationService.confirm({header:this.translate.instant("POSITION.ERROR_HEADER"),icon:"fa fa-exclamation-circle fwcRed iconBig",message:Z,rejectVisible:!1,acceptLabel:"Ok",accept:()=>{}}),this.ruleSelectedService.setRuleStatus(null),this.detectChanges()});else{let j={fwcloud:this.fwcUserService.getActualFwSelectedCloud(),firewall:e,rule:b,position:I,position_order:U,new_rule:J,new_position:x,new_order:o.position_order};n.content=="O"?o._fwcObjType==v.OBJ_OPENVPN_CONFIG_CLI?j.openvpn=o._fwcObjId:o._fwcObjType==v.OBJ_WGC_CONFIG_CLI?j.wireguard=o._fwcObjId:o._fwcObjType==v.OBJ_ISC_CONFIG_CLI?j.ipsec=o._fwcObjId:o._fwcObjType==v.OBJ_OPENVPN_PREFIX||o._fwcObjType==v.OBJ_WIREGUARD_PREFIX||o._fwcObjType==v.OBJ_IPSEC_PREFIX?j.prefix=o._fwcObjId:(j.ipobj=o.ipobj,j.ipobj_g=o.ipobj_g,j.interface=o.interface):j.interface=o.interface,this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcPolicyService.updatePolicyObject.bind(this.fwcPolicyService),j,n.content,o._fwcObjType).then(Z=>{n.ipobjs.push(o),o.srcRuleId=b,o.srcPositionId=I,this.itemSelectedService.setModifiedItem(o,!0),l&&this.itemSelectedService.clearClipboardItem(),this.updateFirewallStatus(e,i),this.store.dispatch(ue.reloadDialog({dialogUuids:[q.ITEM_PANEL,q.OVCONFIG_PANEL,q.WIREGUARD_CONFIG_PANEL,q.IPSEC_CONFIG_PANEL]})),this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:s+this.translate.instant("POSITION.OBJ_ADDED")}),this.ruleSelectedService.setRuleHeightRecalculate(b),this.ruleSelectedService.setRuleHeightRecalculate(J)}).catch(Z=>{Z.error&&Z.error.respCode=="ACR_ALREADY_EXISTS"?this.confirmationService.confirm({header:this.translate.instant("POSITION.ERROR_HEADER"),icon:"fa fa-exclamation-circle fwcRed iconBig",message:this.translate.instant("POSITION.ERROR_DUP"),rejectVisible:!1,acceptLabel:"Ok",accept:()=>{}}):this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(Z)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}}removeItem(e,i){let t=-1;if(!e.ipobjs)return-1;for(let n=0;n<e.ipobjs.length;n++)if(e.ipobjs[n]._fwcObjId!=v.OBJ_ANY&&e.ipobjs[n]._fwcObjId==i._fwcObjId){t=n;break}return t>=0&&e.ipobjs.splice(t,1),e.ipobjs.length<=1&&(e.negate=!1),t}updateFirewallStatus(e,i){this.store.dispatch(Qe.updateFwStatus({item:{cluster:i,id:e,status:3}}))}checkOperation(e,i,t,n){let o,l=+n._fwcObjType,p=this.translate.instant("GLOBALS.DB_OBJECT_NAMES."+l),s=n.items&&n.items.length,S=(E=>{let I=!1,b=[];for(b.push(E);b.length&&!I;){let x=b.pop();I=x._fwcObjType==v.OBJ_ADDRESS,!I&&x.items&&x.items.length&&b.push(...x.items)}return I})(n);return t.indexOf(l)==-1?o=this.translate.instant("POSITION.ERROR_NOTALLOWED"):i.ipobjs&&i.ipobjs.some(function(E){return n._fwcObjId==E._fwcObjId&&n._fwcObjType==E._fwcObjType})?o=this.translate.instant("POSITION.ERROR_EXISTS",{name:n._fwcObjName}):i.content=="I"&&l==v.OBJ_INTERFACE_FIREWALL&&n._fwcFwId!=e?o=this.translate.instant("POSITION.ERROR_IF"):i.policy_type!==Pe.ROUTING_TABLE&&i.single_object&&i.ipobjs&&i.ipobjs.length>=2?o=this.translate.instant("POSITION.ERROR_ONLY1"):i.policy_type===Pe.ROUTING_TABLE&&i.id===hi.INTERFACE_POSITION&&n._fwcObjType===v.OBJ_INTERFACE_HOST&&(o=this.translate.instant("POSITION.ERROR_HOST_IF_IN_ROUTE")),o}removeItemAt(e,i){return e.ipobjs?(i>=0&&i<e.ipobjs.length&&e.ipobjs.splice(i,1),e.ipobjs.length<=1&&(e.negate=!1),i):-1}detectChanges(){this.changeDetectorRef.destroyed||this.changeDetectorRef.detectChanges()}static{this.\u0275fac=function(i){return new(i||r)(N(Ni),N(Se),N(le),N(pe),N(fe),N(Ge),N(Oe),N(he),N(Le),N(ci),N(_e),N(Wt),N(me),N(ae),N(de))}}static{this.\u0275prov=je({token:r,factory:r.\u0275fac})}}return r})();var Dn=class extends at{constructor(u,e,i,t,n,o,l,p){super(u,t,n,o,l),this.utilService=u,this.fwcRoutingPolicyService=e,this.fwcPolicyGridRoutingRulesFunctionalityService=i,this.translationKeys={ENTITY_NAME:"RULE.RULE",ENTITY_DELETE:"RULE.DELETE_TEXT",DELETE_SUCCESS:"RULE.DELETE_SUCCESS",ENTITY_COLOR:"RULE.COLOR_TEXT"},this.buildPolicyRules(p)}buildPolicyRules(u){let e=[];Array.isArray(u)&&(e=this.fwcPolicyGridRoutingRulesFunctionalityService.parseRoutingPolicyRules(this.firewallId,this.fwcloudId,u)),this.rules=e}convertPolicyRuleToRoutingRule(u){let e=[];if(Array.isArray(u.positions)&&u.positions.length){let t=u.positions.find(n=>n.id===Mi.FROM_POSITION);if(t&&Array.isArray(t.ipobjs))for(let n of t.ipobjs)n._fwcObjType!==v.OBJ_ANY&&e.push({id:n.id,name:n.name,type:n.type,firewall_id:n.firewall_id,cluster_id:n.cluster_id,cluster_name:n.cluster_name,position_order:n.position_order})}return{id:u.id,routingTableId:u.routingTableId,routingGroupId:u.idgroup,comment:u.comment,style:u.style,rule_order:u.rule_order,active:!!u.active,items:e}}newPolicyRule(u,e){u&&e!==void 0?this.fwcPolicyGridRoutingRulesFunctionalityService.showNewRuleDialog(this.clusterId,this.firewallId,u.id,e):this.fwcPolicyGridRoutingRulesFunctionalityService.showNewRuleDialog(this.clusterId,this.firewallId)}updateRule(u){let e=u.formModel.comment,i=u.formModel.style,t=u.formModel.active,n=this.convertPolicyRuleToRoutingRule(u);this.fwcPolicyGridRoutingRulesFunctionalityService.updateRule(this.clusterId,this.firewallId,this.fwcloudId,n,e,i,!!t)}deletePolicyRuleApiCall(u){return this.utilService.fwcAPICall(this.fwcRoutingPolicyService.deleteRoutingPolicyRules.bind(this.fwcRoutingPolicyService),this.firewallId,this.fwcloudId,u)}manageObject(u,e,i,t){this.fwcPolicyGridRoutingRulesFunctionalityService.updateRulePosition(this,this.firewallId,this.fwcloudId,u,e,i,t)}deleteObject(u,e){this.fwcPolicyGridRoutingRulesFunctionalityService.deleteObjectFromPosition(this.firewallId,this.clusterId,this.fwcloudId,u.rule,u,e)}compileSelectedRoutes(){this.fwcPolicyGridRoutingRulesFunctionalityService.compileSelectedRules()}moveSelectedRules(u,e){this.fwcPolicyGridRoutingRulesFunctionalityService.moveSelectedRules(e.firewall,e.fwcloud,e.pasteOnRuleId,e.rulesIds,e.pasteOffset)}manageSelectedRules(u,e){return this.utilService.fwcAPICall(this.fwcRoutingPolicyService.manageRoutingPolicyRules.bind(this.fwcRoutingPolicyService),this.firewallId,this.fwcloudId,u.pasteOnRuleId,u.pasteOffset,u.rulesIds,e)}setRuleActive(u,e){let i={active:!!e};this.fwcPolicyGridRoutingRulesFunctionalityService.updateSelectedRules(this.clusterId,this.firewallId,this.fwcloudId,i)}setRuleComment(u){this.fwcPolicyGridRoutingRulesFunctionalityService.updateRuleComment(u)}setRuleApplyTo(u){this.fwcPolicyGridRoutingRulesFunctionalityService.handleChangeApplyToTable(u)}setRuleScript(u){}setRuleStyleApiCall(){return this.fwcPolicyGridRoutingRulesFunctionalityService.setRuleStyle.bind(this.fwcPolicyGridRoutingRulesFunctionalityService)}newRuleGroupApiCall(){return this.fwcPolicyGridRoutingRulesFunctionalityService.newRoutingRuleGroup.bind(this.fwcPolicyGridRoutingRulesFunctionalityService)}setRuleGroupStyleApiCall(){return this.fwcPolicyGridRoutingRulesFunctionalityService.setGroupValues.bind(this.fwcPolicyGridRoutingRulesFunctionalityService)}setRuleGroupNameApiCall(){return this.fwcPolicyGridRoutingRulesFunctionalityService.setGroupValues.bind(this.fwcPolicyGridRoutingRulesFunctionalityService)}removeRulesFromGroupApiCall(u){let e={routingGroupId:null},i=u.rulesIds;return this.utilService.fwcAPICall(this.fwcRoutingPolicyService.updateRoutingPolicyRules.bind(this.fwcRoutingPolicyService),this.firewallId,this.fwcloudId,i,e)}deleteRuleGroupApiCall(u){return this.utilService.fwcAPICall(this.fwcRoutingPolicyService.deleteRoutingPolicyRulesGroup.bind(this.fwcRoutingPolicyService),this.firewallId,this.fwcloudId,u)}};var Nn=class extends at{constructor(u,e,i,t,n,o,l,p,s){super(u,n,o,l,p),this.utilService=u,this.fwcPolicyService=e,this.fwcPositionFunctionalityService=i,this.fwcRuleFunctionalityService=t,this.translationKeys={ENTITY_NAME:"RULE.RULE",ENTITY_DELETE:"RULE.DELETE_TEXT",DELETE_SUCCESS:"RULE.DELETE_SUCCESS",ENTITY_COLOR:"RULE.COLOR_TEXT"},this.buildPolicyRules(s)}buildPolicyRules(u){this.rules=u||[]}newPolicyRule(u,e){let i;u&&e!==void 0?i={id:void 0,idgroup:u.idgroup,firewall:u.firewall,rule_order:u.rule_order+e,action:u.action,time_start:void 0,time_end:void 0,active:1,options:0,comment:"",type:u.type,style:u.group_style,fwcloud:this.fwcloudId,special:u.special?u.special:0}:i={id:void 0,idgroup:null,firewall:this.firewallId,rule_order:1,action:Wo.FWACTION_ACCEPT,time_start:void 0,time_end:void 0,active:1,options:0,comment:"",type:this.policyType,fwcloud:this.fwcloudId},this.fwcRuleFunctionalityService.createNewRule(i,u)}deletePolicyRuleApiCall(u){return this.utilService.fwcAPICall(this.fwcPolicyService.deletePolicyRules.bind(this.fwcPolicyService),this.firewallId,u,this.fwcloudId)}manageObject(u,e,i,t){this.fwcPositionFunctionalityService.manageObject(this.firewallId,this.clusterId,u,e,i,t)}deleteObject(u,e){this.fwcPositionFunctionalityService.deleteObjectFromPosition(this.firewallId,this.clusterId,u.rule,u,e)}compileSelectedRoutes(u){this.fwcRuleFunctionalityService.compileSelectedRules(u)}moveSelectedRules(u,e){this.fwcRuleFunctionalityService.moveSelectedRules(u,e)}manageSelectedRules(u,e){return this.utilService.fwcAPICall(this.fwcPolicyService.managePolicyRules.bind(this.fwcPolicyService),u,e)}setRuleActive(u,e){this.fwcRuleFunctionalityService.setRulesProperty(u,"active",e)}setRuleComment(u){this.fwcRuleFunctionalityService.updateRule(u)}setRuleScript(u){this.fwcRuleFunctionalityService.updateRule(u)}setRuleStyleApiCall(){return this.fwcRuleFunctionalityService.onSetRuleCustomColor.bind(this.fwcRuleFunctionalityService)}newRuleGroupApiCall(){return this.fwcRuleFunctionalityService.newRuleGroup.bind(this.fwcRuleFunctionalityService)}setRuleGroupStyleApiCall(){return this.fwcRuleFunctionalityService.onSetGroupCustomColor.bind(this.fwcRuleFunctionalityService)}setRuleGroupNameApiCall(){return this.fwcRuleFunctionalityService.onSetGroupName.bind(this.fwcRuleFunctionalityService)}removeRulesFromGroupApiCall(u){return this.utilService.fwcAPICall(this.fwcPolicyService.deletePolicyRulesGroupRuleFromGroup.bind(this.fwcPolicyService),u)}deleteRuleGroupApiCall(u){return this.utilService.fwcAPICall(this.fwcPolicyService.deletePolicyRulesGroup.bind(this.fwcPolicyService),this.firewallId,u,this.fwcloudId)}setRuleApplyTo(u){this.fwcRuleFunctionalityService.updateRule(u)}};var Nr=(()=>{class r{constructor(e,i,t,n,o,l,p,s,f,S,E,I){this.translate=e,this.fwcErrorPipe=i,this.utilService=t,this.fwcUserService=n,this.fwcFirewallService=o,this.fwcPolicyService=l,this.fwcDhcpPolicyService=p,this.ruleSelectedService=s,this.messageService=f,this.confirmationService=S,this.cd=E,this.store=I}setGroupValues(e){if(e){let i=e.groupData,t=e.group,n=e.policyType,o={style:e.groupColor,name:e.groupName};this.updateGroup(n,i.firewall,i.fwcloud,t,o)}}updateGroup(e,i,t,n,o){let l;(e===z[X.DHCP]||e===z[X.DHCP_FIXED_IP])&&(l=this.fwcDhcpPolicyService.updateDhcpPolicyRuleGroup.bind(this.fwcDhcpPolicyService)),l&&(this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(l,i,t,n.idgroup,o).then(()=>{if(o.name){n.group_name=o.name;let p=n.rules;for(let s=0;s<p.length;s++)p[s].group_name=n.group_name}if(o.style){n.group_style=o.style;let p=n.rules;for(let s=0;s<p.length;s++)p[s].group_style=n.group_style}n=rt(n)}).catch(p=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(p)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()}))}compileRules(e){let i,t,n,o=this.ruleSelectedService.getActualSelectedRules(),l=this.ruleSelectedService.getRulesOrderedIds(o),p;if(Array.isArray(l.orderedRules)&&l.orderedRules[0]){p=l.orderedRules[0],i=this.fwcUserService.getActualFwcUser().selectedFwCloud,t=p.firewall,n=l.rulesIds;let s=this.fwcDhcpPolicyService.compileDhcpPolicyRules.bind(this.fwcDhcpPolicyService),f=[t,i,n],S=this.translate.instant("DHCP.NEW_RULE_PANEL.RULE"),E=this.translate.instant("DHCP.POLICY.COMPILE_DIALOG_TITLE");e&&(s=this.fwcDhcpPolicyService.compileDhcpPolicyRules.bind(this.fwcDhcpPolicyService),f=[t,i,e,n],S=this.translate.instant("DHCP.NEW_RULE_PANEL.RULE"),E=this.translate.instant("DHCP.RULE.COMPILE_DIALOG_TITLE")),this.ruleSelectedService.setRuleStatus(""),this.detectChanges(),this.utilService.fwcAPICall(s,...f).then(I=>{if(Array.isArray(I.data)){let b=this.utilService.createDynamicComponentRef(si),x=b.instance;x.setDynamicComponentRef(b),x.showCompilationData(I.data,o,S,E,void 0,void 0)}}).catch(I=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(I)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}}filterIpObjects(e,i){let t=[];return Array.isArray(e)&&(t=e.filter(i).map(n=>({id:n.id,order:n.position_order}))),t}buildCopyApiData(e,i){let t={},n,o,l=e._fwcObjId,p=e._fwcObjType,s=i.ipobjs;switch(p){case v.OBJ_NETWORK:n=this.filterIpObjects(s,f=>f._fwcObjType===v.OBJ_NETWORK)[0],o="networkId";break;case v.OBJ_ADDRESS_RANGE:n=this.filterIpObjects(s,f=>f._fwcObjType===v.OBJ_ADDRESS_RANGE)[0],o="rangeId";break;case v.OBJ_ADDRESS:if(i.id===Ae.DNS){n=this.filterIpObjects(s,f=>f._fwcObjType===v.OBJ_ADDRESS),o="ipObjIds";break}else{n=this.filterIpObjects(s,f=>f._fwcObjType===v.OBJ_ADDRESS)[0],o="routerId";break}case v.OBJ_INTERFACE_HOST:case v.OBJ_INTERFACE_FIREWALL:n=this.filterIpObjects(s,f=>f._fwcObjType===v.OBJ_INTERFACE_FIREWALL||f._fwcObjType===v.OBJ_INTERFACE_HOST)[0],o="interfaceId";break}return t[o]=Array.isArray(n)?[...n,{id:l,order:s?s.length:1}]:l,n&&!Array.isArray(n)&&this.buildRemoveApiData(n,i),t}buildRemoveApiData(e,i){let t={},n,o,l=e._fwcObjId,p=i.ipobjs;switch(e._fwcObjType){case v.OBJ_NETWORK:return this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.ERROR"),detail:this.translate.instant("GLOBALS.MSG_OBJ_DELETE.NETWORK")}),e;case v.OBJ_ADDRESS_RANGE:return this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.ERROR"),detail:this.translate.instant("GLOBALS.MSG_OBJ_DELETE.RANGE")}),e;case v.OBJ_ADDRESS:if(i.id===Ae.DNS){n=this.filterIpObjects(p,f=>f._fwcObjType===v.OBJ_ADDRESS&&f._fwcObjId!==l),o="ipObjIds";break}else return this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.ERROR"),detail:this.translate.instant("GLOBALS.MSG_OBJ_DELETE.ROUTER")}),e;case v.OBJ_INTERFACE_HOST:case v.OBJ_INTERFACE_FIREWALL:return this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.ERROR"),detail:this.translate.instant("GLOBALS.MSG_OBJ_DELETE.INTERFACE")}),e}return t[o]=Array.isArray(n)?[...n]:n,t}removeObjectFromPosition(e,i){if(Array.isArray(e.ipobjs)){e.ipobjs=e.ipobjs.filter(t=>t._fwcObjId!==i._fwcObjId||t._fwcObjType!==i._fwcObjType);for(let t of e.ipobjs)t.position_order!=null&&t.position_order>i.position_order&&t.position_order--}}dispatchFwStatusUpdateAction(e,i){this.store.dispatch(Qe.updateFwStatus({item:{cluster:e,id:i,status:3}}))}dispatchReloadItemPanelAction(){this.store.dispatch(ue.reloadDialog({dialogUuids:[q.ITEM_PANEL]}))}dispatchReloadItemEditingPanels(){this.store.dispatch(ue.reloadDialog({dialogUuids:[q.ITEM_PANEL,q.CLUSTER_PANEL,q.FIREWALL_PANEL,q.OVCONFIG_PANEL,q.WIREGUARD_CONFIG_PANEL,q.IPSEC_CONFIG_PANEL]}))}detectChanges(){this.cd.destroyed||(this.cd.markForCheck(),this.cd.detectChanges())}static{this.\u0275fac=function(i){return new(i||r)(N(de),N(Se),N(he),N(pe),N(ae),N(fe),N(li),N(Le),N(me),N(Oe),N(le),N(_e))}}static{this.\u0275prov=je({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var Gn=(()=>{class r extends Nr{constructor(e,i,t,n,o,l,p,s,f,S,E,I,b){super(e,i,t,n,o,l,s,f,S,E,I,b),this.translate=e,this.fwcErrorPipe=i,this.utilService=t,this.fwcUserService=n,this.fwcFirewallService=o,this.fwcPolicyService=l,this.fwcInterfaceService=p,this.fwcDhcpPolicyService=s,this.ruleSelectedService=f,this.messageService=S,this.confirmationService=E,this.cd=I,this.store=b}parseDhcpPolicyRules(e,i,t){let n=[];for(let o of t){o.group&&(o.dhcpGroup=o.group);let l=o.rule_type;o.rule_type=o.rule_type==2?z[X.DHCP_FIXED_IP]:z[X.DHCP];let p={id:o.id,idgroup:o.group&&o.dhcpGroup.id,group_name:o.group&&o.dhcpGroup.name,group_style:o.group&&o.dhcpGroup.style,comment:o.comment,style:o.style,type:o.rule_type,max_lease:l===1?o.max_lease:null,cfg_text:l===3?o.cfg_text:null,special:l===3?6:null,rule_order:o.rule_order,active:o.active?1:0,firewall:e,fwcloud:i,positions:[]},s=1;if(p.type===z[X.DHCP]){let f={id:Ae.NETWORK,rule:o.id,ipobjs:[],content:"O",name:this.translate.instant("POLICY_GRID.RULES.DHCP_NETWORK"),policy_type:o.rule_type,position_order:s++,single_object:0,fwcloud:i,firewall:e};if(o.network){let b={rule:o.id,position:Ae.NETWORK,id:o.network.id,name:o.network.name,type:o.network.ipObjTypeId,position_order:1,firewall_id:e,cluster_id:o._fwcClusterId};f.ipobjs.push(b)}let S={id:Ae.RANGE,rule:o.id,ipobjs:[],content:"O",name:this.translate.instant("POLICY_GRID.RULES.RANGE"),policy_type:o.rule_type,position_order:s++,single_object:0,fwcloud:i,firewall:e};if(o.range){let b={rule:o.id,position:Ae.RANGE,id:o.range.id,name:o.range.name,type:o.range.ipObjTypeId,position_order:1,firewall_id:e,cluster_id:o._fwcClusterId};S.ipobjs.push(b)}let E={id:Ae.ROUTER,rule:o.id,ipobjs:[],content:"O",name:this.translate.instant("POLICY_GRID.RULES.ROUTER"),policy_type:o.rule_type,position_order:s++,single_object:0,fwcloud:i,firewall:e};if(o.router){let b={rule:o.id,position:Ae.ROUTER,id:o.router.id,name:o.router.name,type:o.router.ipObjTypeId,position_order:1,firewall_id:o.router.interface&&o.router.interface.firewall?o.router.interface.firewall.id:null,firewall_name:o.router.interface&&o.router.interface.firewall?o.router.interface.firewall.name:null,cluster_id:o.router.interface&&o.router.interface.firewall&&o.router.interface.firewall.cluster?o.router.interface.firewall.cluster.id:null,cluster_name:o.router.interface&&o.router.interface.firewall&&o.router.interface.firewall.cluster?o.router.interface.firewall.cluster.name:null,host_id:o.router.interface&&o.router.interface.hosts&&o.router.interface.hosts.length>0&&o.router.interface.hosts[0].hostIPObj?o.router.interface.hosts[0].hostIPObj.id:null,host_name:o.router.interface&&o.router.interface.hosts&&o.router.interface.hosts.length>0&&o.router.interface.hosts[0].hostIPObj?o.router.interface.hosts[0].hostIPObj.name:null};E.ipobjs.push(b)}let I={id:Ae.DNS,rule:o.id,ipobjs:[],content:"O",name:this.translate.instant("POLICY_GRID.RULES.SERVERS"),policy_type:o.rule_type,position_order:s++,single_object:0,fwcloud:i,firewall:e};if(Array.isArray(o.items)){let b=1;for(let x of o.items){let J={rule:o.id,position:Ae.DNS,id:x.id,name:x.name,type:x.type,position_order:b++,firewall_id:x.firewall_id?x.firewall_id:null,firewall_name:x.firewall_name?x.firewall_name:null,cluster_id:x.cluster_id?x.cluster_id:null,cluster_name:x.cluster_name?x.cluster_name:null,host_id:x.host_id?x.host_id:null,host_name:x.host_name?x.host_name:null};I.ipobjs.push(J)}}p.positions.push(f,S,E,I)}if(p.type===z[X.DHCP_FIXED_IP]){let f={id:Ae.INTERFACE,rule:o.id,ipobjs:[],content:"O",name:this.translate.instant("POLICY_GRID.RULES.INTERFACE"),policy_type:o.rule_type,position_order:s++,single_object:0,fwcloud:i,firewall:e};if(o.interface){let E={rule:o.id,position:Ae.INTERFACE,id:o.interface.id,name:o.interface.name,type:o.interface.type,mac:o.interface.mac,position_order:1,firewall_id:o.interface.firewall?o.interface.firewall.id:null,firewall_name:o.interface.firewall?o.interface.firewall.name:null,cluster_id:o.interface.firewall&&o.interface.firewall.cluster?o.interface.firewall.cluster.id:null,cluster_name:o.interface.firewall&&o.interface.firewall.cluster?o.interface.firewall.cluster.name:null,fwcloud:i,host_id:o.interface.hosts&&o.interface.hosts.length>0&&o.interface.hosts[0].hostIPObj?o.interface.hosts[0].hostIPObj.id:null,host_name:o.interface.hosts&&o.interface.hosts.length>0&&o.interface.hosts[0].hostIPObj?o.interface.hosts[0].hostIPObj.name:null};E.mac&&f.ipobjs.push(E)}let S={id:Ae.IP,rule:o.id,ipobjs:[],content:"O",name:this.translate.instant("POLICY_GRID.RULES.IP"),policy_type:o.rule_type,position_order:s++,single_object:0,fwcloud:i,firewall:e};if(o.router){let E={rule:o.id,position:Ae.IP,id:o.router.id,name:o.router.name,type:o.router.ipObjTypeId,position_order:1,firewall_id:o.router.interface&&o.router.interface.firewall?o.router.interface.firewall.id:null,firewall_name:o.router.interface&&o.router.interface.firewall?o.router.interface.firewall.name:null,cluster_id:o.router.interface&&o.router.interface.firewall&&o.router.interface.firewall.cluster?o.router.interface.firewall.cluster.id:null,cluster_name:o.router.interface&&o.router.interface.firewall&&o.router.interface.firewall.cluster?o.router.interface.firewall.cluster.name:null,host_id:o.router.interface&&o.router.interface.hosts&&o.router.interface.hosts.length>0&&o.router.interface.hosts[0].hostIPObj?o.router.interface.hosts[0].hostIPObj.id:null,host_name:o.router.interface&&o.router.interface.hosts&&o.router.interface.hosts.length>0&&o.router.interface.hosts[0].hostIPObj?o.router.interface.hosts[0].hostIPObj.name:null};S.ipobjs.push(E)}p.positions.push(f,S)}n.push(p)}return n}updateSelectedRules(e,i,t,n){let o=this.ruleSelectedService.getActualSelectedRules(),l=!!Object.keys(n).filter(p=>p!=="style").length;if(Array.isArray(o)&&o.length){let p=o.map(s=>s.id);this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcDhcpPolicyService.updateDhcpPolicyRules.bind(this.fwcDhcpPolicyService),i,t,p,n).then(()=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("DHCP.SUCCESS.UPDATE_RULE")}),this.fwcPolicyService.reloadPolicy(),l&&this.dispatchFwStatusUpdateAction(e,i)}).catch(s=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(s)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null)})}}updateRuleComment(e){if(e&&e.formModel){let i=e.formModel.comment;if(e.comment!==i){let t=e.firewall,n=e.fwcloud,o={comment:i};this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcDhcpPolicyService.updateDhcpPolicyRule.bind(this.fwcDhcpPolicyService),t,n,e.id,o).then(()=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("ROUTING.SUCCESS.UPDATE_RULE")}),e.comment=i,this.dispatchFwStatusUpdateAction(e._fwcClusterId,t)}).catch(l=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(l)}),e.formModel.comment=e.comment}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}}}updateRuleCfgText(e){if(e&&e.formModel){let i=e.formModel.cfg_text;if(e.cfg_text!==i){let t=e.firewall,n=e.fwcloud,o={cfg_text:i};this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcDhcpPolicyService.updateDhcpPolicyRule.bind(this.fwcDhcpPolicyService),t,n,e.id,o).then(()=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("ROUTING.SUCCESS.UPDATE_RULE")}),e.cfg_text=i,this.dispatchFwStatusUpdateAction(e._fwcClusterId,t)}).catch(l=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(l)}),e.formModel.cfg_text=e.cfg_text}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}}}updateRuleLeaseTime(e){if(e&&e.formModel){let i=e.formModel.max_lease;if(e.max_lease!==i){let t=e.firewall,n=e.fwcloud,o={max_lease:i};this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcDhcpPolicyService.updateDhcpPolicyRule.bind(this.fwcDhcpPolicyService),t,n,e.id,o).then(()=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("ROUTING.SUCCESS.UPDATE_RULE")}),e.max_lease=i,this.dispatchFwStatusUpdateAction(e._fwcClusterId,t)}).catch(l=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(l)}),e.formModel.max_lease=e.max_lease}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}}}setRuleStyle(e,i){if(i){let t={style:i.ruleColor};this.updateSelectedRules(e._fwcClusterId,e.firewall,this.fwcUserService.getActualFwSelectedCloud(),t)}}updateRulePosition(e,i,t,n,o,l,p){return te(this,null,function*(){let s={},f=l._fwcPositionId,S=l._fwcRuleId,E=this.checkOperation(e,l,p);if(E)this.confirmationService.confirm({header:this.translate.instant("POSITION.ERROR_HEADER"),icon:"fa fa-exclamation-circle fwcRed iconBig",message:E,rejectVisible:!1,acceptLabel:"Ok",accept:()=>{}});else{let I=e.getClusterId();if(l&&(l.obj_type===v.OBJ_INTERFACE_FIREWALL||l.obj_type===v.OBJ_INTERFACE_HOST)){let b=yield this.fwcInterfaceService.getInterface.bind(this.fwcInterfaceService)(i,l.id_obj,l.fwcloud).toPromise();try{if(b.data&&(b.data.mac===null||b.data.mac===void 0||b.data.mac==="")){this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.translate.instant("DHCP.POLICY.ERROR_EMPTY_MAC")});return}}catch{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.translate.instant("DHCP.POLICY.ERROR_GET_INTERFACE")})}}f==null||S==null||p==re.COPY?(s=this.buildCopyApiData(l,o),this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcDhcpPolicyService.updateDhcpPolicyRule.bind(this.fwcDhcpPolicyService),i,t,n,s).then(()=>{this.addObjectToPosition(o,l),this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("DHCP.SUCCESS.UPDATE_RULE")}),this.dispatchFwStatusUpdateAction(I,i),this.dispatchReloadItemEditingPanels(),this.ruleSelectedService.setRuleHeightRecalculate(n)}).catch(b=>{b&&typeof b.error=="string"&&b.status===500&&(b.error==="IP version mismatch"?this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.translate.instant("ITEM_PANEL.ERRORS.INVALID_IP_VERSION.TEXT")}):b.error==="Interface mac is not defined"?this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.translate.instant("DHCP.POLICY.ERROR_EMPTY_MAC")}):this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(b)}))}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})):(this.ruleSelectedService.setRuleStatus(""),this.moveObject(e,i,t,n,o,l).then(()=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("DHCP.SUCCESS.UPDATE_RULE")})}).catch(b=>{b&&typeof b.error=="string"&&b.status===500&&(b.error==="IP version mismatch"?this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.translate.instant("ITEM_PANEL.ERRORS.INVALID_IP_VERSION.TEXT")}):b.error==="Interface mac is not defined"?this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.translate.instant("DHCP.POLICY.ERROR_EMPTY_MAC")}):this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(b)}))}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()}))}})}checkOperation(e,i,t){let n;return i._fwcRuleId&&i._fwcPositionId&&(t===re.CUT||t===re.DELETE)&&e.getPolicyRule(i._fwcRuleId).positions.find(s=>s.id===i._fwcPositionId).ipobjs.filter(s=>s._fwcObjType!==v.OBJ_ANY).length<2&&(n=this.translate.instant("DHCP.POLICY.ERROR_LAST_IPOBJECT")),n}moveObject(e,i,t,n,o,l){return te(this,null,function*(){try{let p,s;switch(l._fwcObjType){case v.OBJ_GROUP:{p="ipObjGroupId";break}case v.OBJ_MARK:{p="markId";break}default:{p="ipObjId";break}}let f=e.getPolicyRule(l._fwcRuleId),S=f.positions.find(I=>I.id===l._fwcPositionId);if(l._fwcPositionId!==Ae.DNS)return Promise.reject(this.translate.instant("DHCP.POLICY.ERROR_MOVING_POSITION"));s={fromId:f.id,toId:n},s[p]=l._fwcObjId,yield this.utilService.fwcAPICall(this.fwcDhcpPolicyService.moveObjectBetweenPositions.bind(this.fwcDhcpPolicyService),i,t,s),this.addObjectToPosition(o,l),this.removeObjectFromPosition(S,l),this.dispatchReloadItemEditingPanels(),this.ruleSelectedService.setRuleHeightRecalculate(f.id),this.ruleSelectedService.setRuleHeightRecalculate(n);let E=e.getClusterId();this.dispatchFwStatusUpdateAction(E,i),Promise.resolve()}catch{Promise.reject()}})}deleteObjectFromPosition(e,i,t,n,o,l){let p={};p=this.buildRemoveApiData(l,o),p!==l&&(this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcDhcpPolicyService.updateDhcpPolicyRule.bind(this.fwcDhcpPolicyService),e,t,n,p).then(()=>{this.removeObjectFromPosition(o,l),this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("DHCP.SUCCESS.UPDATE_RULE")}),this.dispatchFwStatusUpdateAction(i,e),this.dispatchReloadItemEditingPanels(),this.ruleSelectedService.setRuleHeightRecalculate(n)}).catch(s=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(s)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()}))}addObjectToPosition(e,i){let t={cluster_id:i._fwcClusterId,cluster_name:i._fwcClusterName,firewall_id:i._fwcFwId,firewall_name:i._fwcFwName,host_id:i._fwcHostId,host_name:i._fwcHostName,id:i._fwcObjId,id_obj:i._fwcObjId,name:i._fwcObjName,obj_type:i._fwcObjType,parent_id:i.parent_id,position:e.id,position_order:e.ipobjs?e.ipobjs.length:1,rule:e.rule,type:i._fwcObjType,_fwcFwId:i._fwcFwId,_fwcFwName:i._fwcFwName,_fwcObjId:i._fwcObjId,_fwcObjName:i._fwcObjName,_fwcObjType:i._fwcObjType,_fwcPositionId:e.id,_fwcRuleId:e.rule,_fwcUserId:this.fwcUserService.getActualFwcUser().user_id,highlighted:i.highlighted};e.id!==Ae.DNS&&e.id!==Ae.INTERFACE?e.ipobjs=[...e.ipobjs.filter(n=>n.obj_type!==t.obj_type),t]:e.id!==Ae.DNS&&e.id===Ae.INTERFACE?e.ipobjs=[...e.ipobjs.filter(n=>n.obj_type!==v.OBJ_INTERFACE_FIREWALL&&n.obj_type!==v.OBJ_INTERFACE_HOST),t]:e.ipobjs=[...e.ipobjs,t]}showNewRuleDialog(e,i,t,n,o,l,p){let s=this.utilService.createDynamicComponentRef(fr),f=s.instance;f.setDynamicComponentRef(s),f.showNewRuleDialog(e,i,t,n)}moveSelectedRules(e,i,t,n,o){this.store.dispatch(qe.requestBlockUI()),this.utilService.fwcAPICall(this.fwcDhcpPolicyService.manageDhcpPolicyRules.bind(this.fwcDhcpPolicyService),e,i,t,o,n,re.CUT).then(()=>{this.fwcPolicyService.reloadPolicy()}).catch(()=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.translate.instant("GLOBALS.MSG_OP_RESULT.PROCESS_ERROR")})}).finally(()=>{this.store.dispatch(qe.requestUnblockUI())})}newDhcpRuleGroup(e,i,t){let n=t&&t.groupName,o=t&&t.groupComment;if(n){let p=this.ruleSelectedService.getActualSelectedRules().map(s=>s.id);this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcDhcpPolicyService.newDhcpPolicyRuleGroup.bind(this.fwcDhcpPolicyService),e,i,n,o,p).then(()=>{this.dispatchReloadItemPanelAction(),this.fwcPolicyService.reloadPolicy()}).catch(s=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(s)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}else return}compileSelectedRules(){this.compileRules()}static{this.\u0275fac=function(i){return new(i||r)(N(de),N(Se),N(he),N(pe),N(ae),N(fe),N(Ye),N(li),N(Le),N(me),N(Oe),N(le),N(_e))}}static{this.\u0275prov=je({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var Ur=(()=>{class r{constructor(e,i,t,n,o,l,p,s,f,S){this.translate=e,this.fwcErrorPipe=i,this.utilService=t,this.fwcUserService=n,this.fwcPolicyService=o,this.fwcKeepalivedPolicyService=l,this.ruleSelectedService=p,this.messageService=s,this.cd=f,this.store=S}setGroupValues(e){if(e){let i=e.groupData,t=e.group,n=e.policyType,o={style:e.groupColor,name:e.groupName};this.updateGroup(n,i.firewall,i.fwcloud,t,o)}}updateGroup(e,i,t,n,o){let l;e===z[X.KEEPALIVED]&&(l=this.fwcKeepalivedPolicyService.updateKeepalivedPolicyRuleGroup.bind(this.fwcKeepalivedPolicyService)),l&&(this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(l,i,t,n.idgroup,o).then(()=>{if(o.name){n.group_name=o.name;let p=n.rules;for(let s=0;s<p.length;s++)p[s].group_name=n.group_name}if(o.style){n.group_style=o.style;let p=n.rules;for(let s=0;s<p.length;s++)p[s].group_style=n.group_style}n=rt(n)}).catch(p=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(p)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()}))}compileRules(e){let i,t,n,o=this.ruleSelectedService.getActualSelectedRules(),l=this.ruleSelectedService.getRulesOrderedIds(o),p;if(Array.isArray(l.orderedRules)&&l.orderedRules[0]){p=l.orderedRules[0],i=this.fwcUserService.getActualFwcUser().selectedFwCloud,t=p.firewall,n=l.rulesIds;let s=this.fwcKeepalivedPolicyService.compileKeepalivedPolicyRules.bind(this.fwcKeepalivedPolicyService),f=[t,i,n],S=this.translate.instant("KEEPALIVED.POLICY.RULE"),E=this.translate.instant("KEEPALIVED.POLICY.COMPILE_DIALOG_TITLE");e&&(s=this.fwcKeepalivedPolicyService.compileKeepalivedPolicyRules.bind(this.fwcKeepalivedPolicyService),f=[t,i,e,n],S=this.translate.instant("KEEPALIVED.NEW_RULE_PANEL.RULE"),E=this.translate.instant("KEEPALIVED.RULE.COMPILE_DIALOG_TITLE")),this.ruleSelectedService.setRuleStatus(""),this.detectChanges(),this.utilService.fwcAPICall(s,...f).then(I=>{if(Array.isArray(I.data)){let b=this.utilService.createDynamicComponentRef(si),x=b.instance;x.setDynamicComponentRef(b),x.showCompilationData(I.data,o,S,E,void 0,void 0)}}).catch(I=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(I)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}}filterIpObjects(e,i){let t=[];return Array.isArray(e)&&(t=e.filter(i).map(n=>({id:n.id,order:n.position_order}))),t}buildCopyApiData(e,i){let t={},n,o,l=e._fwcObjId,p=e._fwcObjType,s=i.ipobjs;switch(p){case v.OBJ_INTERFACE_FIREWALL:n=this.filterIpObjects(s,f=>f._fwcObjType===v.OBJ_INTERFACE_FIREWALL)[0],o="interfaceId";break;case v.OBJ_ADDRESS:n=this.filterIpObjects(s,f=>f._fwcObjType===v.OBJ_ADDRESS),o="virtualIpsIds";break;case v.OBJ_FIREWALL:n=this.filterIpObjects(s,f=>f._fwcObjType===v.OBJ_FIREWALL)[0],o="masterNodeId";break}return t[o]=p===v.OBJ_ADDRESS?[...(Array.isArray(n)?n:[n]).filter(f=>f.id!==l),{id:l,order:s?s.length:1}]:l,n&&this.buildRemoveApiData(Array.isArray(n)?n[0]:n,i),t}buildRemoveApiData(e,i){let t={},n,o,l=i.ipobjs,p=e._fwcObjId,s=e._fwcObjType;switch(s===void 0&&i.ipobjs[0]._fwcObjType===v.OBJ_INTERFACE_FIREWALL&&(s=i.ipobjs[0]._fwcObjType,p=i.ipobjs[0]._fwcObjId),s){case v.OBJ_INTERFACE_FIREWALL:return this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.translate.instant("KEEPALIVED.POLICY.ERROR_INTERFACE_DELETE")}),e;case v.OBJ_ADDRESS:n=this.filterIpObjects(l,f=>f._fwcObjType===v.OBJ_ADDRESS&&f._fwcObjId!==p)[0],o="virtualIpsIds";break;case v.OBJ_FIREWALL:return this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.translate.instant("KEEPALIVED.POLICY.ERROR_MASTERNODE_DELETE")}),e}return t[o]=Array.isArray(n)?[...n]:n,t}removeObjectFromPosition(e,i){if(Array.isArray(e.ipobjs)){e.ipobjs=e.ipobjs.filter(t=>t._fwcObjId!==i._fwcObjId||t._fwcObjType!==i._fwcObjType);for(let t of e.ipobjs)t.position_order!=null&&t.position_order>i.position_order&&t.position_order--}}dispatchFwStatusUpdateAction(e,i){this.store.dispatch(Qe.updateFwStatus({item:{cluster:e,id:i,status:3}}))}dispatchReloadItemPanelAction(){this.store.dispatch(ue.reloadDialog({dialogUuids:[q.ITEM_PANEL]}))}dispatchReloadItemEditingPanels(){this.store.dispatch(ue.reloadDialog({dialogUuids:[q.ITEM_PANEL,q.CLUSTER_PANEL,q.FIREWALL_PANEL,q.OVCONFIG_PANEL,q.WIREGUARD_CONFIG_PANEL,q.IPSEC_CONFIG_PANEL]}))}detectChanges(){this.cd.destroyed||(this.cd.markForCheck(),this.cd.detectChanges())}static{this.\u0275fac=function(i){return new(i||r)(N(de),N(Se),N(he),N(pe),N(fe),N(Ji),N(Le),N(me),N(le),N(_e))}}static{this.\u0275prov=je({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var Un=(()=>{class r extends Ur{constructor(e,i,t,n,o,l,p,s,f,S,E,I){super(e,i,t,n,o,l,s,f,E,I),this.translate=e,this.fwcErrorPipe=i,this.utilService=t,this.fwcUserService=n,this.fwcPolicyService=o,this.fwcKeepalivedPolicyService=l,this.fwcInterfaceService=p,this.ruleSelectedService=s,this.messageService=f,this.confirmationService=S,this.cd=E,this.store=I}parseKeepalivedPolicyRules(e,i,t){let n=[];for(let o of t){o.group&&(o.keepalivedGroup=o.group);let l=o.rule_type,p={id:o.id,idgroup:o.group&&o.keepalivedGroup.id,group_name:o.group&&o.keepalivedGroup.name,group_style:o.group&&o.keepalivedGroup.style,comment:o.comment,style:o.style,type:z[X.KEEPALIVED],cfg_text:l===2?o.cfg_text:null,special:l===2?6:null,rule_order:o.rule_order,active:o.active?1:0,firewall:e,fwcloud:i,positions:[]},s=1,f={id:Ne.INTERFACE,rule:o.id,ipobjs:[],content:"O",name:this.translate.instant("POLICY_GRID.RULES.INTERFACE"),policy_type:p.type,position_order:s++,single_object:0,fwcloud:i,firewall:e};if(o.interface){let I={rule:o.id,position:Ne.INTERFACE,id:o.interface.id,name:o.interface.name,type:o.interface.type,position_order:1,firewall_id:o.interface.firewall?o.interface.firewall.id:null,firewall_name:o.interface.firewall?o.interface.firewall.name:null,cluster_id:o.interface.firewall&&o.interface.firewall.cluster?o.interface.firewall.cluster.id:null,cluster_name:o.interface.firewall&&o.interface.firewall.cluster?o.interface.firewall.cluster.name:null,fwcloud:i};f.ipobjs.push(I)}let S={id:Ne.VIRTUAL_IPS,rule:o.id,ipobjs:[],content:"O",name:this.translate.instant("POLICY_GRID.RULES.VIRTUAL_IPS"),policy_type:p.type,position_order:s++,single_object:0,fwcloud:i,firewall:e};if(Array.isArray(o.items))for(let b of o.items){let x={rule:o.id,position:Ne.VIRTUAL_IPS,id:b.id,name:b.name,type:b.type,position_order:1,firewall_id:b.firewall_id?b.firewall_id:null,firewall_name:b.firewall_name?b.firewall_name:null,cluster_id:b.cluster_id?b.cluster_id:null,cluster_name:b.cluster_name?b.cluster_name:null,host_id:b.host_id?b.host_id:null,host_name:b.host_name?b.host_name:null};S.ipobjs.push(x)}let E={id:Ne.MASTER_NODE,rule:o.id,ipobjs:[],content:"O",name:this.translate.instant("POLICY_GRID.RULES.MASTER_NODE"),policy_type:p.type,position_order:s++,single_object:0,fwcloud:i,firewall:e};if(o.masterNode){let I={rule:o.id,position:Ne.MASTER_NODE,id:o.masterNode.id,name:o.masterNode.name,type:v.OBJ_FIREWALL,position_order:1};E.ipobjs.push(I)}p.positions.push(f,S,E),n.push(p)}return n}updateSelectedRules(e,i,t,n){let o=this.ruleSelectedService.getActualSelectedRules(),l=!!Object.keys(n).filter(p=>p!=="style").length;if(Array.isArray(o)&&o.length){let p=o.map(s=>s.id);this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcKeepalivedPolicyService.updateKeepalivedPolicyRules.bind(this.fwcKeepalivedPolicyService),i,t,p,n).then(()=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("KEEPALIVED.SUCCESS.UPDATE_RULE")}),this.fwcPolicyService.reloadPolicy(),l&&this.dispatchFwStatusUpdateAction(e,i)}).catch(s=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(s)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null)})}}updateRuleCfgText(e){if(e&&e.formModel){let i=e.formModel.cfg_text;if(e.cfg_text!==i){let t=e.firewall,n=e.fwcloud,o={cfg_text:i};this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcKeepalivedPolicyService.updateKeepalivedPolicyRule.bind(this.fwcKeepalivedPolicyService),t,n,e.id,o).then(()=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("ROUTING.SUCCESS.UPDATE_RULE")}),e.cfg_text=i,this.dispatchFwStatusUpdateAction(e._fwcClusterId,t)}).catch(l=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(l)}),e.formModel.cfg_text=e.cfg_text}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}}}updateRuleComment(e){if(e&&e.formModel){let i=e.formModel.comment;if(e.comment!==i){let t=e.firewall,n=e.fwcloud,o={comment:i};this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcKeepalivedPolicyService.updateKeepalivedPolicyRule.bind(this.fwcKeepalivedPolicyService),t,n,e.id,o).then(()=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("ROUTING.SUCCESS.UPDATE_RULE")}),e.comment=i,this.dispatchFwStatusUpdateAction(e._fwcClusterId,t)}).catch(l=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(l)}),e.formModel.comment=e.comment}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}}}setRuleStyle(e,i){if(i){let t={style:i.ruleColor};this.updateSelectedRules(e._fwcClusterId,e.firewall,this.fwcUserService.getActualFwSelectedCloud(),t)}}updateRulePosition(e,i,t,n,o,l,p){return te(this,null,function*(){let s={},f=l._fwcPositionId,S=l._fwcRuleId,E=this.checkOperation(e,l,p);if(E)this.confirmationService.confirm({header:this.translate.instant("POSITION.ERROR_HEADER"),icon:"fa fa-exclamation-circle fwcRed iconBig",message:E,rejectVisible:!1,acceptLabel:"Ok",accept:()=>{}});else{let I=e.getClusterId();if(l&&l.obj_type===v.OBJ_FIREWALL){if(l.position===Ne.MASTER_NODE){this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.translate.instant("KEEPALIVED.POLICY.ERROR_MASTER_NODE")});return}if(l.cluster_id!==I){this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.translate.instant("KEEPALIVED.POLICY.ERROR_CLUSTER_NODES")});return}}f==null||S==null||p==re.COPY?(s=this.buildCopyApiData(l,o),this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcKeepalivedPolicyService.updateKeepalivedPolicyRule.bind(this.fwcKeepalivedPolicyService),i,t,n,s).then(()=>{this.addObjectToPosition(o,l),this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("KEEPALIVED.SUCCESS.UPDATE_RULE")}),this.dispatchFwStatusUpdateAction(I,i),this.dispatchReloadItemEditingPanels(),this.ruleSelectedService.setRuleHeightRecalculate(n)}).catch(b=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(b)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})):(this.ruleSelectedService.setRuleStatus(""),this.moveObject(e,i,t,n,o,l).then(()=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("KEEPALIVED.SUCCESS.UPDATE_RULE")})}).catch(b=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(b)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()}))}})}checkOperation(e,i,t){let n;return i._fwcRuleId&&i._fwcPositionId&&(t===re.CUT||t===re.DELETE)&&e.getPolicyRule(i._fwcRuleId).positions.find(s=>s.id===i._fwcPositionId).ipobjs.filter(s=>s._fwcObjType!==v.OBJ_ANY).length<2&&(n=this.translate.instant("KEEPALIVED.POLICY.ERROR_LAST_IPOBJECT")),n}moveObject(e,i,t,n,o,l){return te(this,null,function*(){try{let p,s;switch(l._fwcObjType){case v.OBJ_GROUP:{p="ipObjGroupId";break}case v.OBJ_MARK:{p="markId";break}default:{p="ipObjId";break}}let f=e.getPolicyRule(l._fwcRuleId),S=f.positions.find(I=>I.id===l._fwcPositionId);if(l._fwcPositionId!==Ne.VIRTUAL_IPS)return Promise.reject(this.translate.instant("KEEPALIVED.POLICY.ERROR_MOVING_POSITION"));s={fromId:f.id,toId:n},s[p]=l._fwcObjId,yield this.utilService.fwcAPICall(this.fwcKeepalivedPolicyService.moveObjectBetweenPositions.bind(this.fwcKeepalivedPolicyService),i,t,s),this.addObjectToPosition(o,l),this.removeObjectFromPosition(S,l),this.dispatchReloadItemEditingPanels(),this.ruleSelectedService.setRuleHeightRecalculate(f.id),this.ruleSelectedService.setRuleHeightRecalculate(n);let E=e.getClusterId();this.dispatchFwStatusUpdateAction(E,i),Promise.resolve()}catch{Promise.reject()}})}deleteObjectFromPosition(e,i,t,n,o,l){let p={};p=this.buildRemoveApiData(l,o),p!==l&&(this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcKeepalivedPolicyService.updateKeepalivedPolicyRule.bind(this.fwcKeepalivedPolicyService),e,t,n,p).then(()=>{this.removeObjectFromPosition(o,l),this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("KEEPALIVED.SUCCESS.UPDATE_RULE")}),this.dispatchFwStatusUpdateAction(i,e),this.dispatchReloadItemEditingPanels(),this.ruleSelectedService.setRuleHeightRecalculate(n)}).catch(s=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(s)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()}))}addObjectToPosition(e,i){let t={cluster_id:i._fwcClusterId,cluster_name:i._fwcClusterName,firewall_id:i._fwcFwId,firewall_name:i._fwcFwName,host_id:i._fwcHostId,host_name:i._fwcHostName,id:i._fwcObjId,id_obj:i._fwcObjId,name:i._fwcObjName,obj_type:i._fwcObjType,parent_id:i.parent_id,position:e.id,position_order:e.ipobjs?e.ipobjs.length:1,rule:e.rule,type:i._fwcObjType,_fwcFwId:i._fwcFwId,_fwcFwName:i._fwcFwName,_fwcObjId:i._fwcObjId,_fwcObjName:i._fwcObjName,_fwcObjType:i._fwcObjType,_fwcPositionId:e.id,_fwcRuleId:e.rule,_fwcUserId:this.fwcUserService.getActualFwcUser().user_id,highlighted:i.highlighted};e.id!==Ne.VIRTUAL_IPS&&e.id!==Ne.INTERFACE?e.ipobjs=[...e.ipobjs.filter(n=>n.obj_type!==t.obj_type),t]:e.id!==Ne.INTERFACE&&e.id===Ne.VIRTUAL_IPS?e.ipobjs=[...e.ipobjs.filter(n=>n.obj_type!==v.OBJ_INTERFACE_FIREWALL),t]:e.id===Ne.INTERFACE?e.ipobjs=[...e.ipobjs.filter(n=>n.obj_type!==v.OBJ_INTERFACE_FIREWALL),t]:e.ipobjs=[...e.ipobjs,t]}showNewRuleDialog(e,i,t,n,o,l,p){let s=this.utilService.createDynamicComponentRef(mr),f=s.instance;f.setDynamicComponentRef(s),f.showNewRuleDialog(e,i,t,n)}moveSelectedRules(e,i,t,n,o){this.store.dispatch(qe.requestBlockUI()),this.utilService.fwcAPICall(this.fwcKeepalivedPolicyService.manageKeepalivedPolicyRules.bind(this.fwcKeepalivedPolicyService),e,i,t,o,n,re.CUT).then(()=>{this.fwcPolicyService.reloadPolicy()}).catch(()=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.translate.instant("GLOBALS.MSG_OP_RESULT.PROCESS_ERROR")})}).finally(()=>{this.store.dispatch(qe.requestUnblockUI())})}newKeepalivedRuleGroup(e,i,t){let n=t&&t.groupName,o=t&&t.groupComment;if(n){let p=this.ruleSelectedService.getActualSelectedRules().map(s=>s.id);this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcKeepalivedPolicyService.newKeepalivedPolicyRuleGroup.bind(this.fwcKeepalivedPolicyService),e,i,n,o,p).then(()=>{this.dispatchReloadItemPanelAction(),this.fwcPolicyService.reloadPolicy()}).catch(s=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(s)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}else return}compileSelectedRules(){this.compileRules()}static{this.\u0275fac=function(i){return new(i||r)(N(de),N(Se),N(he),N(pe),N(fe),N(Ji),N(Ye),N(Le),N(me),N(Oe),N(le),N(_e))}}static{this.\u0275prov=je({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var kr=(()=>{class r{constructor(e,i,t,n,o,l,p,s,f,S){this.translate=e,this.fwcErrorPipe=i,this.utilService=t,this.fwcUserService=n,this.fwcPolicyService=o,this.fwcHAProxyPolicyService=l,this.ruleSelectedService=p,this.messageService=s,this.cd=f,this.store=S}setGroupValues(e){if(e){let i=e.groupData,t=e.group,n=e.policyType,o={style:e.groupColor,name:e.groupName};this.updateGroup(n,i.firewall,i.fwcloud,t,o)}}updateGroup(e,i,t,n,o){let l;e===z[X.HAPROXY]&&(l=this.fwcHAProxyPolicyService.updateHAProxyPolicyRuleGroup.bind(this.fwcHAProxyPolicyService)),l&&(this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(l,i,t,n.idgroup,o).then(()=>{if(o.name){n.group_name=o.name;let p=n.rules;for(let s=0;s<p.length;s++)p[s].group_name=n.group_name}if(o.style){n.group_style=o.style;let p=n.rules;for(let s=0;s<p.length;s++)p[s].group_style=n.group_style}n=rt(n)}).catch(p=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(p)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()}))}compileRules(e){let i,t,n,o=this.ruleSelectedService.getActualSelectedRules(),l=this.ruleSelectedService.getRulesOrderedIds(o),p;if(Array.isArray(l.orderedRules)&&l.orderedRules[0]){p=l.orderedRules[0],i=this.fwcUserService.getActualFwcUser().selectedFwCloud,t=p.firewall,n=l.rulesIds;let s=this.fwcHAProxyPolicyService.compileHAProxyPolicyRules.bind(this.fwcHAProxyPolicyService),f=[t,i,n],S=this.translate.instant("HAPROXY.POLICY.RULE"),E=this.translate.instant("HAPROXY.POLICY.COMPILE_DIALOG_TITLE");e&&(s=this.fwcHAProxyPolicyService.compileHAProxyPolicyRules.bind(this.fwcHAProxyPolicyService),f=[t,i,e,n],S=this.translate.instant("HAPROXY.NEW_RULE_PANEL.RULE"),E=this.translate.instant("HAPROXY.RULE.COMPILE_DIALOG_TITLE")),this.ruleSelectedService.setRuleStatus(""),this.detectChanges(),this.utilService.fwcAPICall(s,...f).then(I=>{if(Array.isArray(I.data)){let b=this.utilService.createDynamicComponentRef(si),x=b.instance;x.setDynamicComponentRef(b),x.showCompilationData(I.data,o,S,E,void 0,void 0)}}).catch(I=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(I)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}}filterIpObjects(e,i){let t=[];return Array.isArray(e)&&(t=e.filter(i).map(n=>({id:n.id,order:n.position_order}))),t}buildCopyApiData(e,i){let t={},n,o,l=e._fwcObjId,p=e._fwcObjType,s=i.ipobjs;switch(p){case v.OBJ_ADDRESS:i.id===Te.FRONTEND_IP?(n=this.filterIpObjects(s,f=>f._fwcObjType===v.OBJ_ADDRESS)[0],o="frontendIpId"):i.id===Te.BACKEND_IPS&&(n=this.filterIpObjects(s,f=>f._fwcObjType===v.OBJ_ADDRESS),o="backendIpsIds");break;case v.OBJ_SERVICE_TCP:case v.OBJ_SERVICE_UDP:i.id===Te.FRONTEND_PORT?(n=this.filterIpObjects(s,f=>f._fwcObjType===v.OBJ_SERVICE_UDP||f._fwcObjType===v.OBJ_SERVICE_TCP)[0],o="frontendPortId"):i.id===Te.BACKEND_PORT&&(n=this.filterIpObjects(s,f=>f._fwcObjType===v.OBJ_SERVICE_UDP||f._fwcObjType===v.OBJ_SERVICE_TCP)[0],o="backendPortId");break}return t[o]=Array.isArray(n)?[...n,{id:l,order:s?s.length:1}]:l,n&&!Array.isArray(n)&&this.buildRemoveApiData(n,i),t}buildRemoveApiData(e,i){let t={},n,o,l=e._fwcObjId,p=i.ipobjs;switch(e._fwcObjType){case v.OBJ_ADDRESS:if(i.id===Te.BACKEND_IPS){if(n=this.filterIpObjects(p,f=>f._fwcObjType===v.OBJ_ADDRESS&&f._fwcObjId!==l),!n||n.length===0)return this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.ERROR"),detail:this.translate.instant("GLOBALS.MSG_OBJ_DELETE.BACKEND_IP")}),e;o="backendIpsIds";break}else return this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.ERROR"),detail:this.translate.instant("GLOBALS.MSG_OBJ_DELETE.FRONTEND_IP")}),e;case v.OBJ_SERVICE_TCP:case v.OBJ_SERVICE_UDP:return i.id===Te.FRONTEND_PORT?this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.ERROR"),detail:this.translate.instant("GLOBALS.MSG_OBJ_DELETE.FRONTEND_PORT")}):i.id===Te.BACKEND_PORT&&this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.ERROR"),detail:this.translate.instant("GLOBALS.MSG_OBJ_DELETE.BACKEND_PORT")}),e}return t[o]=Array.isArray(n)?[...n]:n,t}removeObjectFromPosition(e,i){if(Array.isArray(e.ipobjs)){e.ipobjs=e.ipobjs.filter(t=>t._fwcObjId!==i._fwcObjId||t._fwcObjType!==i._fwcObjType);for(let t of e.ipobjs)t.position_order!=null&&t.position_order>i.position_order&&t.position_order--}}dispatchFwStatusUpdateAction(e,i){this.store.dispatch(Qe.updateFwStatus({item:{cluster:e,id:i,status:3}}))}dispatchReloadItemPanelAction(){this.store.dispatch(ue.reloadDialog({dialogUuids:[q.ITEM_PANEL]}))}dispatchReloadItemEditingPanels(){this.store.dispatch(ue.reloadDialog({dialogUuids:[q.ITEM_PANEL,q.CLUSTER_PANEL,q.FIREWALL_PANEL,q.OVCONFIG_PANEL,q.WIREGUARD_CONFIG_PANEL,q.IPSEC_CONFIG_PANEL]}))}detectChanges(){this.cd.destroyed||(this.cd.markForCheck(),this.cd.detectChanges())}static{this.\u0275fac=function(i){return new(i||r)(N(de),N(Se),N(he),N(pe),N(fe),N(Ki),N(Le),N(me),N(le),N(_e))}}static{this.\u0275prov=je({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var Bn=(()=>{class r extends kr{constructor(e,i,t,n,o,l,p,s,f,S,E){super(e,i,t,n,o,l,p,s,S,E),this.translate=e,this.fwcErrorPipe=i,this.utilService=t,this.fwcUserService=n,this.fwcPolicyService=o,this.fwcHAProxyPolicyService=l,this.ruleSelectedService=p,this.messageService=s,this.confirmationService=f,this.cd=S,this.store=E}parseHAProxyPolicyRules(e,i,t){let n=[];for(let o of t){o.group&&(o.HAProxyGroup=o.group);let l=o.rule_type,p={id:o.id,idgroup:o.group&&o.HAProxyGroup.id,group_name:o.group&&o.HAProxyGroup.name,group_style:o.group&&o.HAProxyGroup.style,comment:o.comment,style:o.style,type:z[X.HAPROXY],cfg_text:l===2?o.cfg_text:null,special:l===2?6:null,rule_order:o.rule_order,active:o.active?1:0,firewall:e,fwcloud:i,positions:[]},s=1,f={id:Te.FRONTEND_IP,rule:o.id,ipobjs:[],content:"O",name:this.translate.instant("POLICY_GRID.RULES.HAPROXY_FRONTEND_IP"),policy_type:p.type,position_order:s++,single_object:0,fwcloud:i,firewall:e};if(o.frontendIp){let b={rule:o.id,position:Te.FRONTEND_IP,id:o.frontendIp.id,name:o.frontendIp.name,type:o.frontendIp.ipObjTypeId,position_order:1,if_id:o.frontendIp.interface?o.frontendIp.interface.id:null,if_name:o.frontendIp.interface?o.frontendIp.interface.name:null,firewall_id:o.frontendIp.interface&&o.frontendIp.interface.firewall?o.frontendIp.interface.firewall.id:null,firewall_name:o.frontendIp.interface&&o.frontendIp.interface.firewall?o.frontendIp.interface.firewall.name:null,cluster_id:o.frontendIp.interface&&o.frontendIp.interface.firewall&&o.frontendIp.interface.firewall.cluster?o.frontendIp.interface.firewall.cluster.id:null,cluster_name:o.frontendIp.interface&&o.frontendIp.interface.firewall&&o.frontendIp.interface.firewall.cluster?o.frontendIp.interface.firewall.cluster.name:null,host_id:o.frontendIp.interface&&o.frontendIp.interface.hosts&&o.frontendIp.interface.hosts.length>0&&o.frontendIp.interface.hosts[0].hostIPObj?o.frontendIp.interface.hosts[0].hostIPObj.id:null,host_name:o.frontendIp.interface&&o.frontendIp.interface.hosts&&o.frontendIp.interface.hosts.length>0&&o.frontendIp.interface.hosts[0].hostIPObj?o.frontendIp.interface.hosts[0].hostIPObj.name:null};f.ipobjs.push(b)}let S={id:Te.FRONTEND_PORT,rule:o.id,ipobjs:[],content:"O",name:this.translate.instant("POLICY_GRID.RULES.HAPROXY_FRONTEND_PORT"),policy_type:p.type,position_order:s++,single_object:0,fwcloud:i,firewall:e};if(o.frontendPort){let b={rule:o.id,position:Te.FRONTEND_PORT,id:o.frontendPort.id,name:o.frontendPort.name,type:o.frontendPort.ipObjTypeId,position_order:1};S.ipobjs.push(b)}let E={id:Te.BACKEND_IPS,rule:o.id,ipobjs:[],content:"O",name:this.translate.instant("POLICY_GRID.RULES.HAPROXY_BACKEND_IPS"),policy_type:p.type,position_order:s++,single_object:0,fwcloud:i,firewall:e};if(Array.isArray(o.items))for(let x of o.items){let J={rule:o.id,position:Te.BACKEND_IPS,id:x.id,name:x.name,type:x.type,position_order:1,if_id:x.interface?x.interface.id:null,if_name:x.interface?x.interface.name:null,firewall_id:x.firewall_id?x.firewall_id:null,firewall_name:x.firewall_name?x.firewall_name:null,cluster_id:x.cluster_id?x.cluster_id:null,cluster_name:x.cluster_name?x.cluster_name:null,host_id:x.host_id?x.host_id:null,host_name:x.host_name?x.host_name:null};E.ipobjs.push(J)}let I={id:Te.BACKEND_PORT,rule:o.id,ipobjs:[],content:"O",name:this.translate.instant("POLICY_GRID.RULES.HAPROXY_BACKEND_PORT"),policy_type:p.type,position_order:s++,single_object:0,fwcloud:i,firewall:e};if(o.backendPort){let b={rule:o.id,position:Te.BACKEND_PORT,id:o.backendPort.id,name:o.backendPort.name,type:o.backendPort.ipObjTypeId,position_order:1};I.ipobjs.push(b)}p.positions.push(f,S,E,I),n.push(p)}return n}updateRule(e,i,t,n,o,l,p){this.ruleSelectedService.setRuleStatus("");let s={},f=!1;o&&(s.comment=o,f=!0),l&&(s.style=l,f=!0),p!==void 0&&(s.active=p,f=!0),this.utilService.fwcAPICall(this.fwcHAProxyPolicyService.updateHAProxyPolicyRule.bind(this.fwcHAProxyPolicyService),i,t,n.id,s).then(S=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("HAPROXY.SUCCESS.UPDATE_RULE")}),this.fwcPolicyService.reloadPolicy(),f&&this.dispatchFwStatusUpdateAction(e,i)}).catch(S=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(S)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null)})}updateSelectedRules(e,i,t,n){let o=this.ruleSelectedService.getActualSelectedRules(),l=!!Object.keys(n).filter(p=>p!=="style").length;if(Array.isArray(o)&&o.length){let p=o.map(s=>s.id);this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcHAProxyPolicyService.updateHAProxyPolicyRules.bind(this.fwcHAProxyPolicyService),i,t,p,n).then(s=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("HAPROXY.SUCCESS.UPDATE_RULE")}),this.fwcPolicyService.reloadPolicy(),l&&this.dispatchFwStatusUpdateAction(e,i)}).catch(s=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(s)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null)})}}updateRuleComment(e){if(e&&e.formModel){let i=e.formModel.comment;if(e.comment!==i){let t=e.firewall,n=e.fwcloud,o={comment:i};this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcHAProxyPolicyService.updateHAProxyPolicyRule.bind(this.fwcHAProxyPolicyService),t,n,e.id,o).then(l=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("ROUTING.SUCCESS.UPDATE_RULE")}),e.comment=i,this.dispatchFwStatusUpdateAction(e._fwcClusterId,t)}).catch(l=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(l)}),e.formModel.comment=e.comment}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}}}updateRuleCfgText(e){if(e&&e.formModel){let i=e.formModel.cfg_text;if(e.cfg_text!==i){let t=e.firewall,n=e.fwcloud,o={cfg_text:i};this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcHAProxyPolicyService.updateHAProxyPolicyRule.bind(this.fwcHAProxyPolicyService),t,n,e.id,o).then(()=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("ROUTING.SUCCESS.UPDATE_RULE")}),e.cfg_text=i,this.dispatchFwStatusUpdateAction(e._fwcClusterId,t)}).catch(l=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(l)}),e.formModel.cfg_text=e.cfg_text}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}}}setRuleStyle(e,i){if(i){let t={style:i.ruleColor};this.updateSelectedRules(e._fwcClusterId,e.firewall,this.fwcUserService.getActualFwSelectedCloud(),t)}}updateRulePosition(e,i,t,n,o,l,p){let s={},f=l._fwcPositionId,S=l._fwcRuleId,E=this.checkOperation(e,l,p);if(E)this.confirmationService.confirm({header:this.translate.instant("POSITION.ERROR_HEADER"),icon:"fa fa-exclamation-circle fwcRed iconBig",message:E,rejectVisible:!1,acceptLabel:"Ok",accept:()=>{}});else{let I=e.getClusterId();if(f==null||S==null||p==re.COPY)s=this.buildCopyApiData(l,o),this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcHAProxyPolicyService.updateHAProxyPolicyRule.bind(this.fwcHAProxyPolicyService),i,t,n,s).then(b=>{this.addObjectToPosition(o,l),this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("HAPROXY.SUCCESS.UPDATE_RULE")}),this.dispatchFwStatusUpdateAction(I,i),this.dispatchReloadItemEditingPanels(),this.ruleSelectedService.setRuleHeightRecalculate(n)}).catch(b=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(b)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()});else{if(l&&(l.obj_type===v.OBJ_ADDRESS&&l.position!=Te.BACKEND_IPS||l.obj_type!==v.OBJ_ADDRESS)){this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.translate.instant("HAPROXY.POLICY.ERROR_MOVING_POSITION")});return}this.ruleSelectedService.setRuleStatus(""),this.moveObject(e,i,t,n,o,l).then(()=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("HAPROXY.SUCCESS.UPDATE_RULE")})}).catch(b=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(b)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}}}checkOperation(e,i,t){let n;return i._fwcRuleId&&i._fwcPositionId&&(t===re.CUT||t===re.DELETE)&&e.getPolicyRule(i._fwcRuleId).positions.find(s=>s.id===i._fwcPositionId).ipobjs.filter(s=>s._fwcObjType!==v.OBJ_ANY).length<2&&(n=this.translate.instant("HAPROXY.POLICY.ERROR_LAST_IPOBJECT")),n}moveObjectAlt(e,i,t,n,o,l){return te(this,null,function*(){try{let p=this.buildCopyApiData(l,o);yield this.utilService.fwcAPICall(this.fwcHAProxyPolicyService.updateHAProxyPolicyRule.bind(this.fwcHAProxyPolicyService),i,t,n,p);let s=e.getPolicyRule(l._fwcRuleId),f=s.positions.find(I=>I.id===l._fwcPositionId),S=this.buildRemoveApiData(l,f);yield this.utilService.fwcAPICall(this.fwcHAProxyPolicyService.updateHAProxyPolicyRule.bind(this.fwcHAProxyPolicyService),i,t,s.id,S),this.addObjectToPosition(o,l),this.removeObjectFromPosition(f,l),this.ruleSelectedService.setRuleHeightRecalculate(s.id),this.ruleSelectedService.setRuleHeightRecalculate(n),this.dispatchReloadItemEditingPanels();let E=e.getClusterId();this.dispatchFwStatusUpdateAction(E,i),Promise.resolve()}catch{Promise.reject()}})}moveObject(e,i,t,n,o,l){return te(this,null,function*(){try{let p,s;switch(l._fwcObjType){case v.OBJ_GROUP:{p="ipObjGroupId";break}case v.OBJ_MARK:{p="markId";break}default:{p="ipObjId";break}}let f=e.getPolicyRule(l._fwcRuleId),S=f.positions.find(I=>I.id===l._fwcPositionId);if(l._fwcPositionId!==Te.BACKEND_IPS)return Promise.reject(this.translate.instant("HAPROXY.POLICY.ERROR_MOVING_POSITION"));s={fromId:f.id,toId:n},s[p]=l._fwcObjId,yield this.utilService.fwcAPICall(this.fwcHAProxyPolicyService.moveObjectBetweenPositions.bind(this.fwcHAProxyPolicyService),i,t,s),this.addObjectToPosition(o,l),this.removeObjectFromPosition(S,l),this.dispatchReloadItemEditingPanels(),this.ruleSelectedService.setRuleHeightRecalculate(f.id),this.ruleSelectedService.setRuleHeightRecalculate(n);let E=e.getClusterId();this.dispatchFwStatusUpdateAction(E,i),Promise.resolve()}catch{Promise.reject()}})}deleteObjectFromPosition(e,i,t,n,o,l){let p={};p=this.buildRemoveApiData(l,o),p!==l&&(this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcHAProxyPolicyService.updateHAProxyPolicyRule.bind(this.fwcHAProxyPolicyService),e,t,n,p).then(s=>{this.removeObjectFromPosition(o,l),this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("HAPROXY.SUCCESS.UPDATE_RULE")}),this.dispatchFwStatusUpdateAction(i,e),this.dispatchReloadItemEditingPanels(),this.ruleSelectedService.setRuleHeightRecalculate(n)}).catch(s=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(s)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()}))}addObjectToPosition(e,i){let t={cluster_id:i._fwcClusterId,cluster_name:i._fwcClusterName,firewall_id:i._fwcFwId,firewall_name:i._fwcFwName,host_id:i._fwcHostId,host_name:i._fwcHostName,id:i._fwcObjId,id_obj:i._fwcObjId,name:i._fwcObjName,obj_type:i._fwcObjType,parent_id:i.parent_id,position:e.id,position_order:e.ipobjs?e.ipobjs.length:1,rule:e.rule,type:i._fwcObjType,_fwcFwId:i._fwcFwId,_fwcFwName:i._fwcFwName,_fwcObjId:i._fwcObjId,_fwcObjName:i._fwcObjName,_fwcObjType:i._fwcObjType,_fwcPositionId:e.id,_fwcRuleId:e.rule,_fwcUserId:this.fwcUserService.getActualFwcUser().user_id,highlighted:i.highlighted};e.id===Te.FRONTEND_PORT||e.id===Te.BACKEND_PORT?e.ipobjs=[...e.ipobjs.filter(n=>n.obj_type!==v.OBJ_SERVICE_TCP&&n.obj_type!==v.OBJ_SERVICE_UDP),t]:e.id!==Te.BACKEND_IPS?e.ipobjs=[...e.ipobjs.filter(n=>n.obj_type!==t.obj_type),t]:e.ipobjs=[...e.ipobjs,t]}showNewRuleDialog(e,i,t,n,o,l,p){let s=this.utilService.createDynamicComponentRef(hr),f=s.instance;f.setDynamicComponentRef(s),f.showNewRuleDialog(e,i,t,n)}moveSelectedRules(e,i,t,n,o){this.store.dispatch(qe.requestBlockUI()),this.utilService.fwcAPICall(this.fwcHAProxyPolicyService.manageHAProxyPolicyRules.bind(this.fwcHAProxyPolicyService),e,i,t,o,n,re.CUT).then(()=>{this.fwcPolicyService.reloadPolicy()}).catch(l=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.translate.instant("GLOBALS.MSG_OP_RESULT.PROCESS_ERROR")})}).finally(()=>{this.store.dispatch(qe.requestUnblockUI())})}newHAProxyRuleGroup(e,i,t){let n=t&&t.groupName,o=t&&t.groupComment;if(n){let p=this.ruleSelectedService.getActualSelectedRules().map(s=>s.id);this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcHAProxyPolicyService.newHAProxyPolicyRuleGroup.bind(this.fwcHAProxyPolicyService),e,i,n,o,p).then(s=>{this.dispatchReloadItemPanelAction(),this.fwcPolicyService.reloadPolicy()}).catch(s=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(s)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}else return}compileSelectedRules(){this.compileRules()}handleChangeApplyToGroup(e){if(e&&e.formModel){let i=e.firewall,t=e.fwcloud,n={firewallApplyToId:e.formModel.fw_apply_to};this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcHAProxyPolicyService.updateHAProxyPolicyRule.bind(this.fwcHAProxyPolicyService),i,t,e.id,n).then(o=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("ROUTING.SUCCESS.UPDATE_RULE")}),this.dispatchFwStatusUpdateAction(e._fwcClusterId,e.firewall),this.dispatchReloadItemEditingPanels(),this.detectChanges()}).catch(o=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(o)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}}static{this.\u0275fac=function(i){return new(i||r)(N(de),N(Se),N(he),N(pe),N(fe),N(Ki),N(Le),N(me),N(Oe),N(le),N(_e))}}static{this.\u0275prov=je({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var El=["gridPaginator"],vl=["policyTable"],Il=()=>({width:"100%"}),bl=(r,u,e)=>({$implicit:r,groupHide:u,rowIndex:e}),Pl=(r,u)=>({$implicit:r,groupHide:!1,rowIndex:u}),Tl=(r,u,e)=>({first:r,last:u,totalRecords:e}),Ol=()=>({width:"2rem",height:"2rem"}),Rl=(r,u,e,i)=>({fwcRuleSelected:r,fwcRuleDisabled:u,fwcRuleHighlighted:e,fwcRuleSpecial:i}),xl=(r,u,e,i)=>({fwcPositionHighlighted:r,draggedOver:u,fwcObjectForbidden:e,fwcObjectAllowed:i}),Fl=r=>({divCommentPopup:r});function Al(r,u){r&1&&(c(0,"h1",22),T(1,"i",23),g(2),C(3,"translate"),_()),r&2&&(a(2),R(" ",y(3,1,"POLICY_GRID.POL_PANEL"),`
`))}function Ll(r,u){r&1&&(ut(0),T(1,"i",34),g(2,"\xA0 "),c(3,"span",28),g(4,"Cluster: "),_(),ft())}function Ml(r,u){r&1&&(T(0,"i",35),g(1,"\xA0 "),c(2,"span",28),g(3,"Firewall: "),_())}function Dl(r,u){if(r&1){let e=L();c(0,"p-button",36),P("click",function(){h(e);let t=d(2);return w(t.settingsSidebar=!0)}),_()}}function Nl(r,u){r&1&&mt(0)}function Gl(r,u){r&1&&T(0,"div",39)}function Ul(r,u){r&1&&T(0,"col")}function Bl(r,u){r&1&&T(0,"col")}function kl(r,u){r&1&&T(0,"col")}function jl(r,u){r&1&&T(0,"col")}function Vl(r,u){r&1&&T(0,"col")}function Wl(r,u){if(r&1&&(c(0,"colgroup"),T(1,"col"),F(2,Ul,1,0,"col",50)(3,Bl,1,0,"col",49)(4,kl,1,0,"col",49)(5,jl,1,0,"col",49)(6,Vl,1,0,"col",49),_()),r&2){let e=d(3);a(),Xt("width","3rem"),a(),m("ngForOf",e.fwcPolicyPositions),a(),m("ngIf",(e.fwcSelectedPolicy==null?null:e.fwcSelectedPolicy._fwcPolicyType)===e.SpecialPolicyTypes.POLICY_ROUTING),a(),m("ngIf",e.fwcSelectedPolicy==null?null:e.fwcSelectedPolicy.show_action),a(),m("ngIf",e.columnVisibility.applyTo&&(e.fwcSelectedPolicy==null?null:e.fwcSelectedPolicy._fwcClusterId)!==null&&(e.fwcSelectedPolicy==null?null:e.fwcSelectedPolicy._fwcClusterId)!==void 0&&e.fwcSelectedPolicy._fwcPolicyType!==e.SpecialPolicyTypes.ROUTING_TABLE&&e.fwcSelectedPolicy._fwcPolicyType!==e.SpecialPolicyTypes.POLICY_ROUTING&&e.fwcSelectedPolicy._fwcPolicyType!==e.POLICY_TYPES_FROM_NODES[e.NodeTypes.DHCP]&&e.fwcSelectedPolicy._fwcPolicyType!==e.POLICY_TYPES_FROM_NODES[e.NodeTypes.DHCP_FIXED_IP]&&e.fwcSelectedPolicy._fwcPolicyType!==e.POLICY_TYPES_FROM_NODES[e.NodeTypes.KEEPALIVED]&&e.fwcSelectedPolicy._fwcPolicyType!==e.POLICY_TYPES_FROM_NODES[e.NodeTypes.HAPROXY]),a(),m("ngIf",e.columnVisibility.comments)}}function Hl(r,u){if(r&1&&(c(0,"th",55),g(1),_()),r&2){let e=u.$implicit;Xt("width",e.name==="Source"||e.name==="Destination"?"20%":""),a(),R(" ",e.name," ")}}function Yl(r,u){r&1&&(c(0,"th"),g(1),C(2,"translate"),_()),r&2&&(a(),R(" ",y(2,1,"ROUTING.NEW_TABLE_PANEL.TABLE")," "))}function Jl(r,u){r&1&&(c(0,"th",55),g(1),C(2,"translate"),_()),r&2&&(a(),R(" ",y(2,1,"POLICY_GRID.RULES.ACTION")," "))}function Kl(r,u){r&1&&(c(0,"th",55),g(1),C(2,"translate"),_()),r&2&&(a(),R(" ",y(2,1,"POLICY_GRID.RULES.APPLY_TO")," "))}function Xl(r,u){r&1&&(c(0,"th",56),g(1),C(2,"translate"),_()),r&2&&(a(),R(" ",y(2,1,"POLICY_GRID.RULES.LEASE_TIME")," "))}function zl(r,u){r&1&&(c(0,"th",55),g(1),C(2,"translate"),_()),r&2&&(a(),R(" ",y(2,1,"POLICY_GRID.RULES.COMMENT")," "))}function ql(r,u){if(r&1&&(c(0,"tr")(1,"th",51),g(2,"#"),_(),F(3,Hl,2,3,"th",52)(4,Yl,3,3,"th",49)(5,Jl,3,3,"th",53)(6,Kl,3,3,"th",53)(7,Xl,3,3,"th",54)(8,zl,3,3,"th",53),_()),r&2){let e=d(4);a(3),m("ngForOf",e.fwcPolicyPositions),a(),m("ngIf",(e.fwcSelectedPolicy==null?null:e.fwcSelectedPolicy._fwcPolicyType)===e.SpecialPolicyTypes.POLICY_ROUTING),a(),m("ngIf",e.fwcSelectedPolicy==null?null:e.fwcSelectedPolicy.show_action),a(),m("ngIf",(e.fwcSelectedPolicy==null?null:e.fwcSelectedPolicy._fwcClusterId)!==null&&(e.fwcSelectedPolicy==null?null:e.fwcSelectedPolicy._fwcClusterId)!==void 0&&e.fwcSelectedPolicy._fwcPolicyType!==e.POLICY_TYPES_FROM_NODES[e.NodeTypes.DHCP]&&e.fwcSelectedPolicy._fwcPolicyType!==e.POLICY_TYPES_FROM_NODES[e.NodeTypes.DHCP_FIXED_IP]&&e.fwcSelectedPolicy._fwcPolicyType!==e.POLICY_TYPES_FROM_NODES[e.NodeTypes.KEEPALIVED]&&e.fwcSelectedPolicy._fwcPolicyType!==e.POLICY_TYPES_FROM_NODES[e.NodeTypes.HAPROXY]),a(),m("ngIf",e.fwcSelectedPolicy._fwcPolicyType===e.POLICY_TYPES_FROM_NODES[e.NodeTypes.DHCP]),a(),m("ngIf",e.columnVisibility.comments)}}function Ql(r,u){if(r&1&&F(0,ql,9,6,"tr",49),r&2){let e=d(3);m("ngIf",(e.fwcPolicyPositions==null?null:e.fwcPolicyPositions.length)||e.fwcSelectedPolicy._fwcPolicyType==e.POLICY_TYPES_FROM_NODES[e.NodeTypes.DHCP]||e.fwcSelectedPolicy._fwcPolicyType==e.POLICY_TYPES_FROM_NODES[e.NodeTypes.DHCP_FIXED_IP]||e.fwcSelectedPolicy._fwcPolicyType==e.POLICY_TYPES_FROM_NODES[e.NodeTypes.KEEPALIVED]||e.fwcSelectedPolicy._fwcPolicyType==e.POLICY_TYPES_FROM_NODES[e.NodeTypes.HAPROXY])}}function $l(r,u){r&1&&mt(0)}function Zl(r,u){r&1&&T(0,"i",67)}function ea(r,u){r&1&&T(0,"i",68)}function ta(r,u){if(r&1&&(ut(0),c(1,"span"),g(2," ("),c(3,"strong"),g(4),_(),g(5),C(6,"translate"),_(),ft()),r&2){let e=d(2).$implicit;a(4),V(e.rules.length),a(),R(" ",y(6,2,"POLICY_GRID.RULES.RULES"),") ")}}function ia(r,u){r&1&&(c(0,"span"),g(1),C(2,"translate"),_()),r&2&&(a(),R("(",y(2,1,"POLICY_GRID.RULES.NO_RULES"),")"))}function na(r,u){r&1&&mt(0)}function oa(r,u){if(r&1&&(ut(0),F(1,na,1,0,"ng-container",70),ft()),r&2){let e=u.$implicit,i=d(3).$implicit;d(3);let t=we(7);a(),m("ngTemplateOutlet",t)("ngTemplateOutletContext",dn(2,bl,e,i.groupHide,i.idgroup))}}function ra(r,u){if(r&1&&(ut(0),F(1,oa,2,6,"ng-container",69),ft()),r&2){let e=d(2).$implicit,i=d(3);a(),m("ngForOf",e.rules)("ngForTrackBy",i.policyRowTrackBy)}}function la(r,u){if(r&1){let e=L();c(0,"tr",57)(1,"td")(2,"div",58)(3,"iui-contextmenu",59),P("menuOpening",function(t){h(e);let n=d().$implicit,o=d(3);return w(o.contextMenuLoad(n,t))})("menuClick",function(t){h(e);let n=d().$implicit,o=d(3);return w(o.contextMenuHandler(o.fwcPolicyObject,n,t))})("menuOpening",function(t){h(e);let n=d(4);return w(n.adjustMenuPosition(t))}),c(4,"div",60)(5,"span",61),P("click",function(){h(e);let t=d().$implicit,n=d(3);return w(n.toggleGroupVisible(t))}),F(6,Zl,1,0,"i",62)(7,ea,1,0,"i",63),_(),g(8," \xA0 "),c(9,"span",64),T(10,"i",65),g(11,"\xA0\xA0"),c(12,"strong"),g(13),_(),T(14,"span",66),F(15,ta,7,4,"ng-container",27)(16,ia,3,3,"ng-template",null,7,He),_()()()()()(),F(18,ra,2,2,"ng-container",49)}if(r&2){let e=we(17),i=d().$implicit,t=d(3);Xt("background-color",i.group_style?t.RulesStylesBg[i.group_style]!=null&&t.RulesStylesBg[i.group_style].length?t.RulesStylesBg[i.group_style]:i.group_style:t.RulesStylesBg[1e3]),a(),ze("colspan",t.fwcSelectedPolicy._fwcPolicyType===t.POLICY_TYPES_FROM_NODES[t.NodeTypes.HAPROXY]?t.fwcSelectedPolicy._fwcClusterId!==null&&t.fwcSelectedPolicy._fwcClusterId!==void 0?t.getColumnsCount():t.getColumnsCount()-1:t.fwcSelectedPolicy._fwcPolicyType===t.POLICY_TYPES_FROM_NODES[t.NodeTypes.DHCP]||t.fwcSelectedPolicy._fwcPolicyType===t.POLICY_TYPES_FROM_NODES[t.NodeTypes.DHCP_FIXED_IP]?t.getColumnsCount():t.fwcSelectedPolicy._fwcPolicyType===t.POLICY_TYPES_FROM_NODES[t.NodeTypes.KEEPALIVED]?t.getColumnsCount()-2:t.getColumnsCount()),a(2),m("allowAnimation",!1)("customStyle",t.contextMenuStyle)("colorScheme",t.currentColorScheme)("settings",t.ruleGroupContextMenu.RULE_GROUP),a(3),m("ngIf",!i.groupHide),a(),m("ngIf",i.groupHide),a(2),D("pTooltip","ID: <strong>"+i.idgroup+"</strong>"),m("escape",!1),a(4),V(i.group_name),a(2),m("ngIf",i.rules==null?null:i.rules.length)("ngIfElse",e),a(3),m("ngIf",!i.groupHide)}}function aa(r,u){r&1&&mt(0)}function sa(r,u){if(r&1&&F(0,aa,1,0,"ng-container",70),r&2){let e=d().$implicit;d(3);let i=we(7);m("ngTemplateOutlet",i)("ngTemplateOutletContext",et(2,Pl,e,e.id))}}function ca(r,u){if(r&1&&F(0,$l,1,0,"ng-container",33)(1,la,19,15,"ng-template",null,5,He)(3,sa,1,5,"ng-template",null,6,He),r&2){let e=u.$implicit,i=we(2),t=we(4);m("ngIf",e.rule_group)("ngIfThen",i)("ngIfElse",t)}}function pa(r,u){if(r&1&&(c(0,"span",72),g(1),C(2,"translate"),_()),r&2){d();let e=we(2),i=d(3);a(),R(" ",zt(2,1,"POLICY_GRID.PAGINATOR_REPORT",dn(4,Tl,e.first+1,e.first+i.MAX_ROWS_PER_PAGE>e.totalRecords?e.totalRecords:e.first+i.MAX_ROWS_PER_PAGE,e.totalRecords))," ")}}function da(r,u){if(r&1){let e=L();ut(0),c(1,"p-paginator",71,8),P("onPageChange",function(t){h(e);let n=d(3);return w(n.onPageChange(t))}),_(),F(3,pa,3,8,"ng-template",null,9,He),ft()}if(r&2){let e=we(4),i=d(3);a(),m("rows",i.MAX_ROWS_PER_PAGE)("totalRecords",i.getPolicyRulesLength())("alwaysShow",!1)("templateLeft",e)}}function _a(r,u){if(r&1){let e=L();c(0,"p-sidebar",37),Y("visibleChange",function(t){h(e);let n=d(2);return H(n.settingsSidebar,t)||(n.settingsSidebar=t),w(t)}),c(1,"div",38)(2,"div",39)(3,"h5",40),g(4),C(5,"translate"),_()(),c(6,"div",39)(7,"b"),g(8),C(9,"translate"),_(),c(10,"div",38),F(11,Gl,1,0,"div",41),c(12,"div",39)(13,"p-checkbox",42),C(14,"translate"),Y("ngModelChange",function(t){h(e);let n=d(2);return H(n.columnVisibility.comments,t)||(n.columnVisibility.comments=t),w(t)}),_()()()()(),c(15,"button",43),C(16,"translate"),P("click",function(){h(e);let t=d(2);return w(t.settingsSidebar=!1)}),_()(),c(17,"div",44)(18,"p-table",45,4),C(20,"fwcGridPagination"),F(21,Wl,7,7,"ng-template",46)(22,Ql,1,1,"ng-template",47)(23,ca,5,3,"ng-template",48),_()(),F(24,da,5,4,"ng-container",49)}if(r&2){let e=d(2);W("visible",e.settingsSidebar),m("baseZIndex",1e4),a(4),R(" ",y(5,18,"POLICY_GRID.GRID_SETTINGS")," "),a(4),V(y(9,20,"POLICY_GRID.COLUMN_VISIBILITY")),a(3),m("ngIf",(e.fwcSelectedPolicy==null?null:e.fwcSelectedPolicy._fwcClusterId)!==null&&(e.fwcSelectedPolicy==null?null:e.fwcSelectedPolicy._fwcClusterId)!==void 0&&e.fwcSelectedPolicy._fwcPolicyType!==e.SpecialPolicyTypes.ROUTING_TABLE&&e.fwcSelectedPolicy._fwcPolicyType!==e.SpecialPolicyTypes.POLICY_ROUTING&&e.fwcSelectedPolicy._fwcPolicyType!==e.POLICY_TYPES_FROM_NODES[e.NodeTypes.DHCP]&&e.fwcSelectedPolicy._fwcPolicyType!==e.POLICY_TYPES_FROM_NODES[e.NodeTypes.DHCP_FIXED_IP]),a(2),D("label",y(14,22,"POLICY_GRID.RULES.COMMENT")),W("ngModel",e.columnVisibility.comments),a(2),D("label",y(16,24,"GLOBALS.MSG_BUTTONS.CLOSE")),a(3),Ve(B(30,Il)),m("value",To(20,26,e.fwcPolicyObject.getPolicyRules(),(e.gridPaginator==null?null:e.gridPaginator.first)||0,(e.gridPaginator==null?null:e.gridPaginator.rows)||0))("rowTrackBy",e.policyRowTrackBy)("resizableColumns",!0)("scrollable",!0)("virtualScrollOptions",e.scrollerOptions)("virtualScroll",!0)("virtualScrollItemSize",37),a(6),m("ngIf",e.showPaginator)}}function ua(r,u){if(r&1){let e=L();c(0,"div"),T(1,"sts-fwc-message",73),c(2,"div",74)(3,"button",75),C(4,"translate"),P("click",function(){h(e);let t=d(2);return w(t.createNewRule(t.fwcPolicyObject))}),_()()()}if(r&2){let e=d(2);a(),m("message",e.msgNoRules),a(2),m("label",y(4,2,(e.fwcSelectedPolicy==null?null:e.fwcSelectedPolicy._fwcPolicyType)!==e.SpecialPolicyTypes.ROUTING_TABLE?"POLICY_GRID.RULES.CREATE":"CONTEXT.ROUTING.NEW_TABLE_ROUTE"))}}function fa(r,u){if(r&1){let e=L();c(0,"div",24)(1,"div",25)(2,"h6",26),F(3,Ll,5,0,"ng-container",27)(4,Ml,4,0,"ng-template",null,1,He),c(6,"span",28)(7,"strong"),g(8),_(),T(9,"span",29),g(10),C(11,"translate"),c(12,"strong"),g(13),_()(),c(14,"span",30),F(15,Dl,1,0,"p-button",31),g(16," \xA0 "),c(17,"button",32),C(18,"translate"),P("click",function(){h(e);let t=d();return w(t.onPolicySelect(t.fwcSelectedPolicy,!0))}),_()()()(),F(19,Nl,1,0,"ng-container",33)(20,_a,25,31,"ng-template",null,2,He)(22,ua,5,4,"ng-template",null,3,He),_()}if(r&2){let e=we(5),i=we(21),t=we(23),n=d();a(3),m("ngIf",n.fwcSelectedPolicy==null?null:n.fwcSelectedPolicy._fwcClusterId)("ngIfElse",e),a(5),V(n.fwcSelectedPolicy._fwcFwName),a(2),R(" ",y(11,10,n.fwcSelectedPolicy._fwcPolicyType!==n.SpecialPolicyTypes.ROUTING_TABLE?"POLICY_GRID.POL_TYPE":"ROUTING.NEW_TABLE_PANEL.TABLE"),": "),a(3),V(n.fwcSelectedPolicy._fwcPolicyName),a(2),m("ngIf",n.fwcSelectedPolicy._fwcPolicyType!==n.POLICY_TYPES_FROM_NODES[n.NodeTypes.DHCP]&&n.fwcSelectedPolicy._fwcPolicyType!==n.POLICY_TYPES_FROM_NODES[n.NodeTypes.DHCP_FIXED_IP]&&n.fwcSelectedPolicy._fwcPolicyType!==n.POLICY_TYPES_FROM_NODES[n.NodeTypes.HAPROXY]),a(2),m("label",y(18,12,"POLICY_GRID.RELOAD")),a(2),m("ngIf",n.fwcPolicyObject==null?null:n.fwcPolicyObject.getPolicyRulesLength())("ngIfThen",i)("ngIfElse",t)}}function ma(r,u){if(r&1&&(c(0,"div",76),T(1,"p-progressSpinner"),c(2,"span",28),g(3),_()()),r&2){let e=d();a(),Ve(B(3,Ol)),a(2),R(" ",e.ruleStatus," ")}}function ha(r,u){r&1&&(c(0,"div",89)(1,"span"),T(2,"i",90),_()())}function wa(r,u){r&1&&(c(0,"span",91),T(1,"i",92),_())}function Sa(r,u){r&1&&(c(0,"span"),T(1,"i",93),_())}function ga(r,u){r&1&&T(0,"i",107)}function Ca(r,u){r&1&&(c(0,"span"),g(1,"6"),_())}function ya(r,u){if(r&1&&(c(0,"span",108),T(1,"i",109),g(2," crowdsec"),F(3,Ca,2,0,"span",49),g(4,"-blacklists "),_()),r&2){let e=d(6).$implicit;a(3),m("ngIf",e.type>60)}}function Ea(r,u){if(r&1&&(c(0,"span",110),g(1," ("),T(2,"i",106),C(3,"fwcIcon"),c(4,"span"),g(5),_(),g(6,")\xA0 "),_()),r&2){let e=d(2).$implicit,i=d(5);a(2),Mt("fwcIcon ",y(3,4,i.ObjectTypes.OBJ_CLUSTER),""),a(3),V(e.cluster_name)}}function va(r,u){if(r&1&&(c(0,"span",110),g(1," ("),T(2,"i",106),C(3,"fwcIcon"),c(4,"span"),g(5),_(),g(6,")\xA0 "),_()),r&2){let e=d(2).$implicit,i=d(5);a(2),Mt("fwcIcon ",y(3,4,i.ObjectTypes.OBJ_FIREWALL),""),a(3),V(e.firewall_name)}}function Ia(r,u){if(r&1&&(c(0,"span",110),g(1," ("),T(2,"i",106),C(3,"fwcIcon"),c(4,"span"),g(5),_(),g(6,")\xA0 "),_()),r&2){let e=d(2).$implicit,i=d(5);a(2),Mt("fwcIcon ",y(3,4,i.ObjectTypes.OBJ_HOST),""),a(3),V(e.host_name)}}function ba(r,u){if(r&1&&(T(0,"img",111),C(1,"lowercase"),C(2,"lowercase")),r&2){let e=d(2).$implicit;Mt("flag-icon flag-icon-",y(1,4,e.name),""),m("src","assets/flags/4x3/"+y(2,6,e.name)+".svg",ui)}}function Pa(r,u){if(r&1&&(T(0,"i",106),C(1,"fwcIcon")),r&2){let e=d(2).$implicit;Mt("fwcIcon ",zt(1,3,e.name,e.name),"")}}function Ta(r,u){r&1&&mt(0)}function Oa(r,u){if(r&1&&g(0),r&2){let e=d(2).$implicit;V(e._fwcObjName)}}function Ra(r,u){if(r&1&&g(0),r&2){let e=d(2).$implicit;R("[",e.labelName,"]")}}function xa(r,u){if(r&1&&(ut(0),F(1,ga,1,0,"i",99)(2,ya,5,1,"span",100),c(3,"span",101),F(4,Ea,7,6,"span",102)(5,va,7,6,"span",102)(6,Ia,7,6,"span",102),c(7,"span",103),F(8,ba,3,8,"img",104)(9,Pa,2,6,"i",105),T(10,"i",106),C(11,"fwcIcon"),F(12,Ta,1,0,"ng-container",33)(13,Oa,1,1,"ng-template",null,13,He)(15,Ra,1,1,"ng-template",null,14,He),_()(),ft()),r&2){let e=we(14),i=we(16),t=d().$implicit,n=d().$implicit,o=d(3).$implicit,l=d();a(),m("ngIf",n.negate),a(),m("ngIf",o.special==l.SpecialPolicyRules.CROWDSEC&&n.name==="Source"),a(2),m("ngIf",n.ipobjs.length>1&&t.cluster_id!=null&&t.cluster_id!==o._fwcClusterId&&t.host_id==null&&!(t.firewall_id!=null&&t.cluster_id==null)),a(),m("ngIf",t.firewall_id!=null&&t.cluster_id==null&&t.firewall_id!=o.firewall&&l.isObjectTypesValid(t._fwcObjType)&&!(t.firewall_id===o.firewall&&t.cluster_id===o._fwcClusterId)&&!t.host_id&&(l.isPolicyNotInSelected(l.fwcSelectedPolicy)&&t.firewall_id&&!t.cluster_id&&t.firewall_id!=o.firewall||t.firewall_id!=o.firewall&&t._fwcObjType==l.ObjectTypes.OBJ_ADDRESS&&l.fwcSelectedPolicy!==l.POLICY_TYPES_FROM_NODES[l.NodeTypes.HAPROXY]||l.fwcSelectedPolicy===l.POLICY_TYPES_FROM_NODES[l.NodeTypes.HAPROXY]&&t.firewall_id!=o.firewall&&!o._fwcClusterId||l.fwcSelectedPolicy===l.POLICY_TYPES_FROM_NODES[l.NodeTypes.DHCP]&&t.firewall_id!=o.firewall&&!o._fwcClusterId&&t.firewall_id||t.firewall_id==o.firewall&&t._fwcObjType==l.ObjectTypes.OBJ_ADDRESS&&l.fwcSelectedPolicy!==l.POLICY_TYPES_FROM_NODES[l.NodeTypes.KEEPALIVED])),a(),m("ngIf",(t._fwcObjType==l.ObjectTypes.OBJ_INTERFACE_HOST||t._fwcObjType==l.ObjectTypes.OBJ_ADDRESS||t._fwcObjType==l.ObjectTypes.OBJ_ADDRESS&&l.fwcSelectedPolicy!==l.POLICY_TYPES_FROM_NODES[l.NodeTypes.KEEPALIVED]||t._fwcObjType==l.ObjectTypes.OBJ_OPENVPN_PREFIX)&&t.host_id),a(2),m("ngIf",t._fwcObjType===l.ObjectTypes.OBJ_COUNTRIE),a(),m("ngIf",t._fwcObjType===l.ObjectTypes.OBJ_CONTINENT),a(),Mt("fwcIcon ",y(11,13,t._fwcObjType),""),a(2),m("ngIf",(t._fwcObjType==l.ObjectTypes.OBJ_INTERFACE_FIREWALL||t._fwcObjType==l.ObjectTypes.OBJ_INTERFACE_HOST)&&t.labelName&&t.labelName.length)("ngIfThen",i)("ngIfElse",e)}}function Fa(r,u){if(r&1){let e=L();c(0,"div")(1,"iui-contextmenu",80),P("menuOpening",function(t){h(e);let n=d().$implicit,o=d(3).$implicit,l=d();return w(l.fwcPositionFunctionalityService.onContextMenuLoad(o.type,o.id,n,l.fwcTypesPositions[n.id],t))})("menuClick",function(t){let n=h(e).$implicit,o=d().$implicit,l=d(3).$implicit,p=d();return w(p.fwcPositionFunctionalityService.onContextMenuHandler(p.fwcPolicyObject,n,l.firewall,l._fwcClusterId,l.id,o,p.fwcTypesPositions[o.id],t))})("menuOpening",function(t){h(e);let n=d(5);return w(n.adjustMenuPosition(t))}),c(2,"div",98),P("click",function(){let t=h(e).$implicit,n=d().$implicit,o=d(4);return w(o.fwcPositionFunctionalityService.onItemClickEvent(n,t))})("dblclick",function(){let t=h(e).$implicit,n=d().$implicit,o=d(4);return w(o.fwcPositionFunctionalityService.onItemDblClickEvent(n,t))})("mouseenter",function(t){let n=h(e).$implicit,o=d(5);return w(o.fwcPositionFunctionalityService.showObjectInfo(n,t))})("mouseleave",function(t){h(e);let n=d(5);return w(n.fwcPositionFunctionalityService.clearObjectInfo(t))})("dragstart",function(t){let n=h(e).$implicit,o=d().$implicit,l=d(4);return w(l.fwcPositionFunctionalityService.itemDragStart(o,n,t))}),F(3,xa,17,15,"ng-container",49),_()()()}if(r&2){let e=u.$implicit,i=d().$implicit,t=d(4);a(),m("allowAnimation",!1)("customStyle",t.contextMenuStyle)("colorScheme",t.currentColorScheme)("settings",t.fwcPositionFunctionalityService.positionContextMenu.POSITION),a(),Io("item-highlighted",e.highlighted==!0)("item-rightclicked",e.rightclicked==!0),m("ngClass",e.hidden&&(i.ipobjs==null?null:i.ipobjs.length)>1?"item-general-hidden":"item-general-default")("draggable",e.allowDrag!==!1&&!(i.id===t.RoutingPolicyPositions.FROM_POSITION&&(i.ipobjs==null?null:i.ipobjs.length)<=2||i.id===t.DhcpPolicyPositions.NETWORK||i.id===t.DhcpPolicyPositions.INTERFACE||i.id===t.DhcpPolicyPositions.ROUTER||i.id===t.DhcpPolicyPositions.RANGE||i.id===t.DhcpPolicyPositions.IP)),ze("data-obj_id",e.id),a(),m("ngIf",e.hidden&&(i.ipobjs==null?null:i.ipobjs.length)==1||!e.hidden&&(i.ipobjs==null?null:i.ipobjs.length)>1)}}function Aa(r,u){if(r&1){let e=L();c(0,"td",95)(1,"div",96,12),P("dragenter",function(t){let n=h(e).$implicit,o=we(2),l=d(3).$implicit,p=d();return w(p.fwcPositionFunctionalityService.onListDragEnter(l.firewall,n,p.fwcTypesPositions[n.id],t,o))})("dragleave",function(t){let n=h(e).$implicit,o=we(2),l=d(4);return w(l.fwcPositionFunctionalityService.onListDragLeave(t,n,o))})("dragover",function(t){h(e);let n=d(4);return w(n.fwcPositionFunctionalityService.onListDragOver(t))})("drop",function(t){let n=h(e).$implicit,o=we(2),l=d(3).$implicit,p=d();return w(p.fwcPositionFunctionalityService.onListDragDrop(p.fwcPolicyObject,l.id,n,p.fwcTypesPositions[n.id],t,o))}),F(3,Fa,4,12,"div",69),c(4,"iui-contextmenu",80),P("menuOpening",function(t){let n=h(e).$implicit,o=d(3).$implicit,l=d();return w(l.fwcPositionFunctionalityService.onContextMenuLoad(o.type,o.id,n,l.fwcTypesPositions[n.id],t))})("menuClick",function(t){let n=h(e).$implicit,o=d(3).$implicit,l=d();return w(l.fwcPositionFunctionalityService.onContextMenuHandler(l.fwcPolicyObject,void 0,o.firewall,o._fwcClusterId,o.id,n,l.fwcTypesPositions[n.id],t))})("menuOpening",function(t){h(e);let n=d(4);return w(n.adjustMenuPosition(t))}),T(5,"div",97),_()()()}if(r&2){let e=u.$implicit,i=d(4);a(),m("ngClass",Xn(7,xl,e.highlighted,e.draggedOver,e.objectAllowed===!1,e.objectAllowed===!0)),a(2),m("ngForOf",e.ipobjs)("ngForTrackBy",i.positionObjectsTrackBy),a(),m("allowAnimation",!1)("customStyle",i.contextMenuStyle)("colorScheme",i.currentColorScheme)("settings",i.fwcPositionFunctionalityService.positionContextMenu.POSITION)}}function La(r,u){if(r&1&&(ut(0),F(1,Aa,6,12,"td",94),ft()),r&2){let e=d(2).$implicit;a(),m("ngForOf",e.positions)}}function Ma(r,u){if(r&1){let e=L();c(0,"td")(1,"div",112)(2,"textarea",113),P("ngModelChange",function(t){h(e);let n=d(2).$implicit;return w(n.formModel.run_before||(n.formModel.cfg_text=t))})("focus",function(){h(e);let t=d(2).$implicit,n=d();return w(n.fwcRuleFunctionalityService.onScriptFocus(n.fwcPolicyObject,t))}),g(3,"            "),_()()()}if(r&2){let e=d(2).$implicit,i=d();ze("colspan",(i.fwcSelectedPolicy==null?null:i.fwcSelectedPolicy._fwcClusterId)!==null&&(i.fwcSelectedPolicy==null?null:i.fwcSelectedPolicy._fwcClusterId)!==void 0?i.fwcSelectedPolicy._fwcPolicyType===i.POLICY_TYPES_FROM_NODES[i.NodeTypes.DHCP]||i.fwcSelectedPolicy._fwcPolicyType===i.POLICY_TYPES_FROM_NODES[i.NodeTypes.HAPROXY]?i.getColumnsCount()-1:i.getColumnsCount()-3:i.fwcSelectedPolicy._fwcPolicyType===i.POLICY_TYPES_FROM_NODES[i.NodeTypes.HAPROXY]?i.getColumnsCount()-2:i.getColumnsCount()-1),a(2),m("ngModel",e.formModel.run_before||e.formModel.cfg_text)}}function Da(r,u){if(r&1){let e=L();c(0,"td")(1,"p-dropdown",114),Y("ngModelChange",function(t){h(e);let n=d(2).$implicit;return H(n.formModel.routingTableId,t)||(n.formModel.routingTableId=t),w(t)}),P("onChange",function(t){h(e);let n=d(2).$implicit,o=d();return w(o.fwcPolicyGridRoutingRulesFunctionalityService.handleChangeRoutingTable(n,t.value))}),_()()}if(r&2){let e=d(2).$implicit,i=d();a(),m("options",i.routingTablesItems),W("ngModel",e.formModel.routingTableId),m("disabled",!i.fwcUserLock)}}function Na(r,u){if(r&1&&(T(0,"i"),g(1)),r&2){let e=u.$implicit;We(e.icon),a(),R(" ",e.label," ")}}function Ga(r,u){if(r&1&&(T(0,"i"),g(1)),r&2){let e=u.$implicit;We(e.icon),a(),R(" ",e.label," ")}}function Ua(r,u){if(r&1){let e=L();c(0,"p-dropdown",119),Y("ngModelChange",function(t){h(e);let n=d(3).$implicit;return H(n.formModel.action,t)||(n.formModel.action=t),w(t)}),P("onChange",function(){h(e);let t=d(3).$implicit,n=d();return w(n.fwcRuleFunctionalityService.updateRule(t))}),F(1,Na,2,4,"ng-template",120)(2,Ga,2,4,"ng-template",121),_()}if(r&2){let e=d(3).$implicit,i=d();m("options",i.fwActionsService.getActionsItems(e.special)),W("ngModel",e.formModel.action),m("disabled",!i.fwcUserLock)}}function Ba(r,u){r&1&&(c(0,"span",108),T(1,"i",122),g(2," Accept established, related "),_())}function ka(r,u){r&1&&(c(0,"div",126),T(1,"i",127),g(2),C(3,"translate"),T(4,"i",127),_()),r&2&&(a(2),R(" ",y(3,1,"RULE.DROP_MARK")," "))}function ja(r,u){if(r&1){let e=L();c(0,"div",128),P("mouseenter",function(t){h(e);let n=d(4).$implicit,o=d();return w(o.fwcRuleFunctionalityService.showMarkInfo(n,t))})("mouseleave",function(t){h(e);let n=d(5);return w(n.fwcRuleFunctionalityService.clearMarkInfo(t))})("wheel",function(t){h(e);let n=d(5);return w(n.fwcRuleFunctionalityService.clearMarkInfo(t))})("dblclick",function(){h(e);let t=d(4).$implicit,n=d();return w(n.fwcPositionFunctionalityService.onMarkDblClickEvent(t.mark))}),c(1,"span",129),T(2,"i",130),g(3),_(),c(4,"div",131)(5,"i",132),P("click",function(){h(e);let t=d(4).$implicit,n=d();return w(n.fwcRuleFunctionalityService.onDeleteRuleMark(t))}),_()()()}if(r&2){let e=d(4).$implicit;a(3),R(" ",e.mark_name," ")}}function Va(r,u){if(r&1&&(c(0,"div",123,16),F(2,ka,5,3,"div",124)(3,ja,6,1,"div",125),_()),r&2){let e=d(3).$implicit;a(2),m("ngIf",!e.mark&&e.labelDraggedOverAction),a(),m("ngIf",e.mark)}}function Wa(r,u){if(r&1){let e=L();c(0,"td",115,15),P("dragenter",function(t){h(e);let n=we(1),o=d(2).$implicit,l=d();return w(l.fwcRuleFunctionalityService.onActionDragEnter(o,t,n))})("dragleave",function(t){h(e);let n=we(1),o=d(2).$implicit,l=d();return w(l.fwcRuleFunctionalityService.onActionDragLeave(o,t,n))})("dragover",function(t){h(e);let n=d(3);return w(n.fwcRuleFunctionalityService.onActionDragOver(t))})("drop",function(t){h(e);let n=we(1),o=d(2).$implicit,l=d();return w(l.fwcRuleFunctionalityService.onActionDragDrop(o,t,n))}),c(2,"div",116),F(3,Ua,3,3,"p-dropdown",117)(4,Ba,3,0,"span",100)(5,Va,4,2,"div",118),_()()}if(r&2){let e=d(2).$implicit,i=d();a(3),m("ngIf",e.special!=i.SpecialPolicyRules.STATEFUL),a(),m("ngIf",e.special==i.SpecialPolicyRules.STATEFUL),a(),m("ngIf",e.special!=i.SpecialPolicyRules.STATEFUL)}}function Ha(r,u){if(r&1&&(c(0,"span"),T(1,"i"),C(2,"fwcIcon"),g(3,"\xA0 "),_()),r&2){let e=d(6);a(),We(y(2,3,e.ObjectTypes.OBJ_FIREWALL))}}function Ya(r,u){if(r&1&&(F(0,Ha,4,5,"span",49),g(1)),r&2){let e=u.$implicit;m("ngIf",e.value),a(),R(" ",e.label," ")}}function Ja(r,u){if(r&1&&(c(0,"span"),T(1,"i"),C(2,"fwcIcon"),g(3,"\xA0 "),_()),r&2){let e=d(6);a(),We(y(2,3,e.ObjectTypes.OBJ_FIREWALL))}}function Ka(r,u){if(r&1&&(F(0,Ja,4,5,"span",49),g(1)),r&2){let e=u.$implicit;m("ngIf",e.value),a(),R(" ",e.label," ")}}function Xa(r,u){if(r&1){let e=L();c(0,"p-dropdown",119),Y("ngModelChange",function(t){h(e);let n=d(3).$implicit;return H(n.formModel.fw_apply_to,t)||(n.formModel.fw_apply_to=t),w(t)}),P("onChange",function(){h(e);let t=d(3).$implicit,n=d();return w(n.fwcRuleFunctionalityService.handleChangeApplyTo(n.fwcPolicyObject,t))}),F(1,Ya,2,2,"ng-template",120)(2,Ka,2,2,"ng-template",121),_()}if(r&2){let e=d(3).$implicit,i=d();m("options",i.clusterNodesItems),W("ngModel",e.formModel.fw_apply_to),m("disabled",!i.fwcUserLock)}}function za(r,u){r&1&&(c(0,"span"),g(1),C(2,"translate"),_()),r&2&&(a(),R(" ",y(2,1,"RULE.ALL_NODES")," "))}function qa(r,u){if(r&1&&(c(0,"td",133)(1,"div",116),F(2,Xa,3,3,"p-dropdown",117)(3,za,3,3,"span",49),_()()),r&2){let e=d(2).$implicit,i=d();a(2),m("ngIf",!e.special||e.special==i.SpecialPolicyRules.HOOKSCRIPT||e.special==i.SpecialPolicyRules.FAIL2BAN),a(),m("ngIf",e.special&&e.special!=i.SpecialPolicyRules.HOOKSCRIPT&&e.special!=i.SpecialPolicyRules.FAIL2BAN)}}function Qa(r,u){if(r&1){let e=L();c(0,"td",95)(1,"div",116)(2,"input",134),Y("ngModelChange",function(t){h(e);let n=d(2).$implicit;return H(n.formModel.max_lease,t)||(n.formModel.max_lease=t),w(t)}),P("focus",function(){h(e);let t=d(2).$implicit,n=d();return w(n.fwcRuleFunctionalityService.onLeaseTimeFocus(t))})("blur",function(){h(e);let t=d(2).$implicit,n=d();return w(n.fwcRuleFunctionalityService.onLeaseTimeBlur(n.fwcPolicyObject,t))}),_()()()}if(r&2){let e=d(2).$implicit,i=d();a(2),m("id",i.max_lease_time),W("ngModel",e.formModel.max_lease)}}function $a(r,u){if(r&1){let e=L();c(0,"td",135)(1,"div",136)(2,"textarea",137),C(3,"translate"),Y("ngModelChange",function(t){h(e);let n=d(2).$implicit;return H(n.formModel.comment,t)||(n.formModel.comment=t),w(t)}),P("focus",function(){h(e);let t=d(2).$implicit,n=d();return w(n.fwcRuleFunctionalityService.onCommentFocus(t))})("blur",function(){h(e);let t=d(2).$implicit,n=d();return w(n.fwcRuleFunctionalityService.onCommentBlur(n.fwcPolicyObject,t))}),g(4,"            "),_()()()}if(r&2){let e=d(2).$implicit,i=d();a(),Xt("max-height",e.heightPx+"px"),m("ngClass",Ie(8,Fl,e.commentEdit)),a(),D("placeholder",y(3,6,"GLOBALS.DB_FIELDS.comment")),W("ngModel",e.formModel.comment),m("disabled",!i.fwcUserLock)}}function Za(r,u){if(r&1){let e=L();ut(0),c(1,"tr",77),P("mouseenter",function(t){h(e);let n=d().$implicit,o=d();return w(o.onRuleEnter(n,t))}),c(2,"td",78),P("click",function(t){h(e);let n=d().$implicit,o=d();return w(o.fwcRuleFunctionalityService.selectRule(n,t))})("dblclick",function(){h(e);let t=d().$implicit,n=d();return w(n.fwcRuleFunctionalityService.editRule(t))}),c(3,"div",58)(4,"div",79)(5,"iui-contextmenu",80),P("menuOpening",function(t){h(e);let n=d().$implicit,o=d();return w(o.fwcRuleFunctionalityService.onContextMenuLoad(n,t))})("menuOpening",function(t){h(e);let n=d(2);return w(n.adjustMenuPosition(t))})("menuClick",function(t){h(e);let n=d().$implicit,o=d();return w(o.fwcRuleFunctionalityService.onContextMenuHandler(o.fwcPolicyObject,n,t))}),c(6,"div",81)(7,"div"),F(8,ha,3,0,"div",82),_(),c(9,"div")(10,"span",83),g(11),_(),T(12,"br"),F(13,wa,2,0,"span",84)(14,Sa,2,0,"span",49),_()()()()()(),F(15,La,2,1,"ng-container",27)(16,Ma,4,2,"ng-template",null,11,He)(18,Da,2,3,"td",49)(19,Wa,6,3,"td",85)(20,qa,4,2,"td",86)(21,Qa,3,2,"td",87)(22,$a,5,10,"td",88),_(),ft()}if(r&2){let e=we(17),i=d().$implicit,t=d();a(),Xt("background-color",i.style&&t.RulesStylesBg[i.style]?t.RulesStylesBg[i.style]:i.style),yi("id","rule_",i.id,""),m("ngClass",Xn(25,Rl,t.isRuleSelected(i),!i.active,i.highlighted,i.special&&i.special!=t.SpecialPolicyRules.HOOKSCRIPT)),a(),m("pTooltip",t.fwcRuleFunctionalityService.setRuleTooltip(i))("escape",!1),a(3),m("allowAnimation",!1)("customStyle",t.contextMenuStyle)("colorScheme",t.currentColorScheme)("settings",i.type===t.SpecialPolicyTypes.ROUTING_TABLE?t.fwcRuleFunctionalityService.ruleContextMenu.ROUTE:i.type===t.SpecialPolicyTypes.POLICY_ROUTING?t.fwcRuleFunctionalityService.ruleContextMenu.ROUTING_RULE:i.type===t.POLICY_TYPES_FROM_NODES[t.NodeTypes.DHCP]||i.type===t.POLICY_TYPES_FROM_NODES[t.NodeTypes.DHCP_FIXED_IP]?t.fwcRuleFunctionalityService.ruleContextMenu.DHCP_RULE:i.type===t.POLICY_TYPES_FROM_NODES[t.NodeTypes.KEEPALIVED]?t.fwcRuleFunctionalityService.ruleContextMenu.KEEPALIVED_RULE:i.type===t.POLICY_TYPES_FROM_NODES[t.NodeTypes.HAPROXY]?t.fwcRuleFunctionalityService.ruleContextMenu.HAPROXY_RULE:t.fwcRuleFunctionalityService.ruleContextMenu.RULE),a(),Xt("min-height",t.fwcPolicyGridFunctionalityService.calcRuleHeight(i),"px"),m("ngClass",i.idgroup?"fwcGroupCell":"fwcGridCell"),a(2),m("ngIf",!i.active),a(3),V(i._fwcRuleOrder),a(2),m("ngIf",i.options),a(),m("ngIf",i.run_before||i.run_after||i.special==t.SpecialPolicyRules.HOOKSCRIPT),a(),m("ngIf",i.special!=t.SpecialPolicyRules.HOOKSCRIPT&&i.special!=t.SpecialPolicyRules.FAIL2BAN)("ngIfElse",e),a(3),m("ngIf",(t.fwcSelectedPolicy==null?null:t.fwcSelectedPolicy._fwcPolicyType)===t.SpecialPolicyTypes.POLICY_ROUTING),a(),m("ngIf",(t.fwcSelectedPolicy==null?null:t.fwcSelectedPolicy.show_action)&&i.special!=t.SpecialPolicyRules.HOOKSCRIPT&&i.special!=t.SpecialPolicyRules.FAIL2BAN),a(),m("ngIf",(i==null?null:i._fwcClusterId)!==null&&(i==null?null:i._fwcClusterId)!==void 0&&t.fwcSelectedPolicy._fwcPolicyType!==t.POLICY_TYPES_FROM_NODES[t.NodeTypes.DHCP]&&t.fwcSelectedPolicy._fwcPolicyType!==t.POLICY_TYPES_FROM_NODES[t.NodeTypes.DHCP_FIXED_IP]&&t.fwcSelectedPolicy._fwcPolicyType!==t.POLICY_TYPES_FROM_NODES[t.NodeTypes.KEEPALIVED]&&t.fwcSelectedPolicy._fwcPolicyType!==t.POLICY_TYPES_FROM_NODES[t.NodeTypes.HAPROXY]),a(),m("ngIf",t.fwcSelectedPolicy._fwcPolicyType===t.POLICY_TYPES_FROM_NODES[t.NodeTypes.DHCP]&&i.special!==6),a(),m("ngIf",t.columnVisibility.comments&&i.special!=t.SpecialPolicyRules.HOOKSCRIPT)}}function es(r,u){r&1&&T(0,"div",141)}function ts(r,u){r&1&&(c(0,"div",89)(1,"span"),T(2,"i",90),_()())}function is(r,u){r&1&&(c(0,"span"),T(1,"i",142),_())}function ns(r,u){r&1&&(c(0,"span"),T(1,"i",143),_())}function os(r,u){if(r&1&&(c(0,"tr",138)(1,"td",139),F(2,es,1,0,"div",140),c(3,"div",81)(4,"div"),F(5,ts,3,0,"div",82),c(6,"span",83),g(7),_(),T(8,"br"),F(9,is,2,0,"span",49)(10,ns,2,0,"span",49),_()()(),T(11,"td"),_()),r&2){let e=d().$implicit,i=d();Xt("height",e.heightPx+"px"),D("id","rule_"+e.id),a(2),m("ngIf",e.idgroup),a(),m("ngClass",e.idgroup?"fwcGroupCell":"fwcGridCell"),a(2),m("ngIf",!e.active),a(2),V(e._fwcRuleOrder),a(2),m("ngIf",e.options),a(),m("ngIf",e.run_before||e.run_after),a(),ze("colSpan",i.getColumnsCount()-1)}}function rs(r,u){if(r&1&&F(0,Za,23,30,"ng-container",27)(1,os,12,10,"ng-template",null,10,He),r&2){let e=u.$implicit,i=we(2);m("ngIf",e.visible)("ngIfElse",i)}}var kn=(()=>{class r{constructor(e,i,t,n,o,l,p,s,f,S,E,I,b,x,J,U,M,Q,j,Z,oe,ve,ke,xt,_t,Pt,an,Yt,Vt,_i){this.refService=e,this.fwcFirewallService=i,this.fwcPolicyService=t,this.fwcRoutingPolicyService=n,this.fwcRoutingTableService=o,this.fwcPositionService=l,this.itemSelectedService=p,this.ruleSelectedService=s,this.fwcContextMenuService=f,this.fwcRuleFunctionalityService=S,this.fwcPositionFunctionalityService=E,this.fwcPolicyGridFunctionalityService=I,this.fwcPolicyGridRoutingRulesFunctionalityService=b,this.fwcPolicyGridRoutingTableFunctionalityService=x,this.fwcDhcpPolicyService=J,this.fwcPolicyGridDhcpRulesFunctionalityService=U,this.fwcKeepalivedPolicyService=M,this.fwcPolicyGridKeepalivedRulesFunctionalityService=Q,this.fwcHAProxyPolicyService=j,this.fwcPolicyGridHAProxyRulesFunctionalityService=Z,this.fwcUserService=oe,this.fwActionsService=ve,this.fwcErrorPipe=ke,this.confirmationService=xt,this.messageService=_t,this.inputDataService=Pt,this.utilService=an,this.store=Yt,this.cd=Vt,this.translate=_i,this.contextMenuStyle=[wr,gr,Sr],this.applicationRef=null,this.contextMenuReference=null,this.ruleGroupsExpanded=[],this.fwcSelectedPolicy={},this.RulesStylesBg=Uo,this.POLICY_TYPES_FROM_NODES=z,this.NodeTypes=X,this.gridColumns=[],this.selectedGridColumns=[],this.alive=!0,this.loadingData=!1,this.ObjectTypes=v,this.showPaginator=!1,this.MAX_ROWS_PER_PAGE=100,this.SpecialPolicyTypes=Pe,this.SpecialPolicyRules=it,this.RoutingPolicyPositions=Mi,this.DhcpPolicyPositions=Ae,this.KeepalivedPolicyPositions=Ne,this.HAProxyPolicyPositions=Te,this.scrollerOptions={delay:100,appendOnly:!0,scrollHeight:"calc(99vh - 8.8rem)",autoSize:!1,onScroll:sn=>{let St=sn.originalEvent.target,qi=document.querySelector(".divTableScroll.fwcDivPadded.fwcDivPaddedTB");St.scrollTop>0?qi.classList.add("fwcSticky"):qi.classList.remove("fwcSticky");let Jt={scrollTop:St.scrollTop,scrollHeight:St.scrollHeight,offsetTop:St.offsetTop,offsetHeight:St.offsetHeight};this.utilService.setGridScroll(Jt)}},this.selectedRules=[],this.columnVisibility={applyTo:!0,comments:!0},this.fwcSelectedPolicy&&this.fwcSelectedPolicy._fwcPolicyType!==Pe.ROUTING_TABLE?this.msgNoRules={type:"warning",title:this.translate.instant("POLICY_GRID.ERR_EMPTY.SUMMARY"),text:this.translate.instant("POLICY_GRID.ERR_EMPTY.TEXT")}:this.msgNoRules={type:"warning",title:this.translate.instant("POLICY_GRID.ERR_EMPTY_ROUTING_TABLE.SUMMARY"),text:this.translate.instant("POLICY_GRID.ERR_EMPTY_ROUTING_TABLE.TEXT")}}ngAfterViewInit(){let e=this;setTimeout(function(){let i=e.refService.getAppRef();e.contextMenuReference=i,e.applicationRef=i},1),this.wheelListener=this.onWheelEvent.bind(this),window.addEventListener("wheel",this.wheelListener)}onWheelEvent(e){window.innerHeight>450&&this.closeContextMenu()}ngOnInit(){this.fwcPolicyService.reloadPolicy().pipe(ee(()=>this.alive)).subscribe(()=>{this.onPolicySelect(this.fwcSelectedPolicy,!0)}),this.store.pipe(ee(()=>this.alive),ni(Yo)).subscribe(e=>{e==="dark"?this.currentColorScheme=oo.Dark:this.currentColorScheme=oo.Light}),this.fwcPolicyService.getSelectedPolicy().pipe(ee(()=>this.alive)).subscribe(e=>{this.onPolicySelect(e,e&&e._forcePolicyReload)}),this.ruleSelectedService.getSelectedRules().pipe(ee(()=>this.alive)).subscribe(e=>{this.selectedRules=e}),this.ruleSelectedService.getRuleStatus().pipe(ee(()=>this.alive)).subscribe(e=>{e||e===""?this.ruleStatus=e||this.translate.instant("GLOBALS.MSG_OP_RESULT.LOADING"):this.ruleStatus=null}),this.ruleSelectedService.getRuleHeightRecalculate().pipe(ee(()=>this.alive)).subscribe(e=>{let i=this.fwcPolicyObject.getPolicyRule(e);i&&this.fwcPolicyGridFunctionalityService.calcRuleHeight(i)}),this.ruleSelectedService.getModifiedRule().pipe(ee(()=>this.alive)).subscribe(e=>{if(e){let i;for(let t of this.fwcPolicyGridFunctionalityService.policyIterator(this.fwcPolicyObject.getPolicyRules()))if(t.id===e.id){i=t;break}i&&(i.options=e.options,i.run_before=e.run_before,i.run_after=e.run_after,this.fwcRuleFunctionalityService.setRuleTooltip(i),this.refreshComponent())}}),this.ruleSelectedService.getSelectedRuleRange().pipe(ee(()=>this.alive)).subscribe(e=>{let i=[];if(e){let t=this.fwcPolicyObject.getPolicyRules();for(let n=0;n<t.length;n++){let o=t[n];if(o.rule_group)for(let l=0;l<o.rules.length;l++){let p=o.rules[l];p.rule_order>=e.minRuleOrder&&p.rule_order<=e.maxRuleOrder&&i.push(p)}else o.rule_order>=e.minRuleOrder&&o.rule_order<=e.maxRuleOrder&&i.push(o)}}this.ruleSelectedService.setSelectedRules(i)}),this.ruleGroupContextMenu=this.fwcContextMenuService.getRuleGroupMenus(),this.fwcUserService.getFwcUser().pipe(ee(()=>this.alive)).subscribe(e=>{e&&(this.fwcUserObject=e,this.fwcUserLock=e.lockInfo.result,this.fwcUser=e.user_id,this.fwCloud=e.selectedFwCloud)}),this.itemSelectedService.getModifiedItem().pipe(ee(()=>this.alive)).subscribe(e=>{if(this.fwcPolicyObject){let i=this.fwcPolicyObject.getPolicyRules();if(i){if(e.deleteFromList){let t=null;for(let n of this.fwcPolicyGridFunctionalityService.policyIterator(i))if(e.srcRuleId==n.id){t=n;break}if(t&&t.positions){let n=null;for(let o=0;o<t.positions.length;o++){let l=t.positions[o];if(e.srcPositionId==l.id){n=l;break}}if(n&&n.ipobjs)for(let o=0;o<n.ipobjs.length;o++){let l=n.ipobjs[o];l._fwcObjId==e._fwcObjId&&l._fwcObjType==e._fwcObjType&&this.fwcPositionFunctionalityService.removeItemAt(n,o)}}}else if(e.highlightItem){for(let t of this.fwcPolicyGridFunctionalityService.policyIterator(this.fwcPolicyObject.getPolicyRules()))if(Array.isArray(t.positions))for(let n=0;n<t.positions.length;n++){let o=t.positions[n];if(Array.isArray(o.ipobjs))for(let l=0;l<o.ipobjs.length;l++){let p=o.ipobjs[l];p._fwcObjId==e._fwcObjId&&p._fwcObjType==e._fwcObjType?p.highlighted=e.highlighted:p.highlighted=!1}}}else if(e._fwcObjType!=v.OBJ_FIREWALL&&e._fwcObjType!=v.OBJ_CLUSTER){for(let t of this.fwcPolicyGridFunctionalityService.policyIterator(this.fwcPolicyObject.getPolicyRules()))if(Array.isArray(t.positions))for(let n=0;n<t.positions.length;n++){let o=t.positions[n];if(Array.isArray(o.ipobjs))for(let l=0;l<o.ipobjs.length;l++){let p=o.ipobjs[l];if(p._fwcObjId==e._fwcObjId&&p._fwcObjType==e._fwcObjType)for(let s of Object.keys(p))e[s]!==void 0&&(p[s]=e[s])}}if(e._fwcObjType===v.OBJ_MARK)for(let t of this.fwcPolicyGridFunctionalityService.policyIterator(this.fwcPolicyObject.getPolicyRules()))t.mark&&e._fwcObjId===t.mark&&(t.mark_name=e._fwcObjName,e.code&&(t.mark_code=e.code))}this.refreshComponent()}}}),this.utilService.getGridScroll().pipe(ee(()=>this.alive)).subscribe(e=>{this.fwcPolicyGridFunctionalityService.showRulesInViewport(this.fwcPolicyObject.getPolicyRules(),e)}),this.utilService.getGridScrollToTop().pipe(ee(()=>this.alive)).subscribe(()=>{setTimeout(()=>{this.policyTable.scrollTo({top:0})},100)}),this.cd.detectChanges()}ngOnDestroy(){this.alive=!1,this.wheelListener&&window.removeEventListener("wheel",this.wheelListener)}refreshComponent(){this.cd.destroyed||this.cd.detectChanges()}onPolicySelect(e,i){if(!e){Qt.log(">> Undefined selected policy");return}if(e._fwcFwId===null||e._fwcFwId===void 0){this.fwcTypesPositions=[],this.fwcPolicyPositions=[],this.fwcSelectedPolicy=e,this.fwcPolicyObject&&this.fwcPolicyObject.setPolicyRules(null),this.fwcPolicyService.setActualPolicy(null),this.refreshComponent();return}if(this.fwcSelectedPolicy&&e._fwcPolicyName!==this.fwcSelectedPolicy._fwcPolicyName&&(this.fwcSelectedPolicy._fwcPolicyName=e._fwcPolicyName),e.fwcloud!==null&&e.fwcloud!==void 0&&e.fwcloud!=this.fwCloud){this.confirmationService.confirm({header:"ERROR",icon:"fa fa-exclamation-circle fwcRed iconBig",message:this.translate.instant("POLICY_GRID.MSG_POL_LOAD_ERROR"),rejectVisible:!1,acceptLabel:"Ok"});return}e._fwcFwId!==null&&e._fwcFwId!==void 0&&this.fwcSelectedPolicy&&e._fwcFwId!=this.fwcSelectedPolicy._fwcFwId&&Qt.log(this.translate.instant("POLICY_GRID.MSG_POL_LOAD_FW"));let t={};i||(t._fwcSelectRuleId=e._fwcSelectRuleId,t._fwcSelectRulePositionIds=e._fwcSelectRulePositionIds,t._fwcSelectObjId=e._fwcSelectObjId,t._fwcSelectObjType=e._fwcSelectObjType),t._selectedRules=e._selectedRules;let n=this.fwcSelectedPolicy&&this.fwcSelectedPolicy._fwcFwId==e._fwcFwId&&this.fwcSelectedPolicy._fwcPolicyType==e._fwcPolicyType&&this.fwcSelectedPolicy._fwcObjId===e._fwcObjId;n&&!i?(this.clearHighlightedRules(),t._fwcSelectRuleId!==null&&t._fwcSelectRuleId!==void 0&&(this.highlightRule(t._fwcSelectRuleId,t._fwcSelectRulePositionIds),this.itemSelectedService.setSearchItem(t)),this.refreshComponent()):(this.loadingData=!0,this.refreshComponent(),this.fwcSelectedPolicy&&(this.fwcSelectedPolicy._fwcFwId!=e._fwcFwId||this.fwcSelectedPolicy._fwcPolicyType!=e._fwcPolicyType)&&(this.ruleGroupsExpanded=[],this.ruleSelectedService.clearClipboardRules(),this.ruleSelectedService.clearSelectedRules(),this.itemSelectedService.clearClipboardItem()),Promise.all([this.getPolicy(e._fwcFwId,e._fwcClusterId,e._fwcPolicyType,e._fwcObjId),this.getTypesPositions(),this.getClusterNodes(e._fwcClusterId),this.getRoutingTables(e._fwcFwId,e._fwcPolicyType)]).then(([o,l,p,s])=>{this.fwcPolicyObject=o;let f=o.getPolicyRules(),S=l.data,E=p.data,I=s.data;if(t._selectedRules&&this.ruleSelectedService.updateSelectedRules(t._selectedRules,f),this.clusterNodesItems=[{label:this.translate.instant("RULE.ALL_NODES"),value:null}],E&&Array.isArray(E)&&E.forEach(b=>{this.clusterNodesItems.push({label:b.name,value:b.id,icon:"&#x1F6E1;"})}),I){this.routingTablesItems=[];for(let b of I)this.routingTablesItems.push({label:b.name,value:b.id})}n||(this.fwcPolicyGridFunctionalityService.clearActualViewportInfo(),this.fwcPolicyGridFunctionalityService.resetMaximumRuleHeight(),this.utilService.setGridScrollToTop()),this.parsePolicy(f,S,e),this.ruleSelectedService.clearSelectedRules(),t._fwcSelectRuleId!==null&&t._fwcSelectRuleId!==void 0&&(this.highlightRule(t._fwcSelectRuleId,t._fwcSelectRulePositionIds),this.itemSelectedService.setSearchItem(t))}).catch(o=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(o)})}).finally(()=>{this.loadingData=!1,this.refreshComponent()}))}getPolicy(e,i,t,n){return new Promise((l,p)=>{switch(t){case Pe.POLICY_ROUTING:this.fwcRoutingPolicyService.getRoutingPolicyGrid(e,this.fwCloud).pipe(ee(()=>this.alive)).subscribe(s=>{let f=new Dn(this.utilService,this.fwcRoutingPolicyService,this.fwcPolicyGridRoutingRulesFunctionalityService,e,i,this.fwCloud,t,s.data);l(f)},s=>{p(s)});break;case Pe.ROUTING_TABLE:this.fwcRoutingTableService.getRoutingTableRoutesGrid(e,this.fwCloud,n).pipe(ee(()=>this.alive)).subscribe(s=>{let f=new wi(this.utilService,this.fwcRoutingTableService,this.fwcPolicyGridRoutingTableFunctionalityService,e,i,this.fwCloud,t,s.data,n,this.fwcPolicyService.getActualSelectedPolicy()._fwcPolicyName);l(f)},s=>{p(s)});break;case z[X.DHCP]:this.fwcDhcpPolicyService.getDhcpPolicyGrid(e,this.fwCloud,1).pipe(ee(()=>this.alive)).subscribe(s=>{let f=new jt(this.utilService,this.fwcDhcpPolicyService,this.fwcPolicyGridDhcpRulesFunctionalityService,e,i,this.fwCloud,t,s.data);l(f)},s=>{p(s)});break;case z[X.DHCP_FIXED_IP]:this.fwcDhcpPolicyService.getDhcpPolicyGrid(e,this.fwCloud,2).pipe(ee(()=>this.alive)).subscribe(s=>{let f=new jt(this.utilService,this.fwcDhcpPolicyService,this.fwcPolicyGridDhcpRulesFunctionalityService,e,i,this.fwCloud,t,s.data);l(f)},s=>{p(s)});break;case z[X.KEEPALIVED]:this.fwcKeepalivedPolicyService.getKeepalivedPolicyGrid(e,this.fwCloud).pipe(ee(()=>this.alive)).subscribe(s=>{let f=new pi(this.utilService,this.fwcKeepalivedPolicyService,this.fwcPolicyGridKeepalivedRulesFunctionalityService,e,i,this.fwCloud,t,s.data);l(f)},s=>{p(s)});break;case z[X.HAPROXY]:this.fwcHAProxyPolicyService.getHAProxyPolicyGrid(e,this.fwCloud).pipe(ee(()=>this.alive)).subscribe(s=>{let f=new di(this.utilService,this.fwcHAProxyPolicyService,this.fwcPolicyGridHAProxyRulesFunctionalityService,e,i,this.fwCloud,t,s.data);l(f)},s=>{p(s)});break;default:this.fwcPolicyService.getPolicy(e,t,this.fwCloud).pipe(ee(()=>this.alive)).subscribe(s=>{let f=new Nn(this.utilService,this.fwcPolicyService,this.fwcPositionFunctionalityService,this.fwcRuleFunctionalityService,e,i,this.fwCloud,t,s.data);l(f)},s=>{p(s)})}})}getTypesPositions(){return new Promise((i,t)=>{this.fwcPositionService.getTypesPositions().pipe(ee(()=>this.alive)).subscribe(n=>{i(n)},n=>{t(n)})})}getClusterNodes(e){return new Promise((t,n)=>{e!=null?this.fwcFirewallService.getClusterNodes(e,this.fwCloud).pipe(ee(()=>this.alive)).subscribe(o=>{t(o)},o=>{n(o)}):t({data:[]})})}getRoutingTables(e,i){return new Promise((n,o)=>{i===Pe.POLICY_ROUTING?this.utilService.fwcAPICall(this.fwcRoutingTableService.getRoutingTables.bind(this.fwcRoutingTableService),e,this.fwcUserService.getActualFwSelectedCloud()).then(l=>{n(l)}).catch(l=>{o(l)}):n({data:null})})}policyRowTrackBy(e,i){return i.id||null}positionObjectsTrackBy(e,i){return i.id||null}parsePolicy(e,i,t){return te(this,null,function*(){let n=!1,o=[],l,p=0;if(!t||!e||!i){Qt.log("Wrong data in policy parsing");return}t._fwcUserId=this.fwcUser,t.show_action=!(t._fwcPolicyType===z[X.POLICY_SNAT]||t._fwcPolicyType===z[X.POLICY_DNAT]||t._fwcPolicyType===z[X.POLICY_ROUTING]||t._fwcPolicyType===z[X.ROUTING_TABLE]||t._fwcPolicyType===z[X.DHCP]||t._fwcPolicyType===z[X.DHCP_FIXED_IP]||t._fwcPolicyType===z[X.KEEPALIVED]||t._fwcPolicyType===z[X.HAPROXY]),Object.keys(e).length===0&&e.constructor===Object&&(e=[]);for(let s of e){p++,s._fwcRuleOrder=p,s._fwcUserId=this.fwcUser,s._fwcClusterId=t._fwcClusterId,s.formModel={action:s.action,comment:s.comment,fw_apply_to:s.fw_apply_to,mark:s.mark,style:s.style,active:s.active,run_before:s.run_before,routingTableId:s.routingTableId,max_lease:s.max_lease,cfg_text:s.cfg_text},s.idgroup&&(n=!0);let f=s.negate,S=[];if(f&&(S=f.split(" ").map(E=>Number(E))),Array.isArray(s.positions)){let E=0;for(let I=0;I<s.positions.length;I++){let b=s.positions[I],x=`${s.firewall}-${s.id}-${b.id}`;b.positionUID=x.split("").reduce(function(U,M){return U=(U<<5)-U+M.charCodeAt(0),U&U},0),b.rule=s.id;let J=+b.id;if(S&&S.findIndex(U=>U==J)!=-1&&(b.negate=!0),Array.isArray(b.ipobjs)){b.ipobjs.length>E&&(E=b.ipobjs.length);for(let U=0;U<b.ipobjs.length;U++){let M=b.ipobjs[U];M.position_order!=U+1&&(M.position_order=U+1),M.type=+M.type,M.type==v.OBJ_CONTINENT?M._fwcObjName=this.translate.instant("NODE_TYPES."+M.name):M.type==v.OBJ_COUNTRIE?M._fwcObjName=this.translate.instant("COUNTRIES."+M.name):M._fwcObjName=M.name,M._fwcObjType=M.obj_type=M.type,M._fwcObjId=M.id_obj=M.id,M._fwcFwId=M.parent_id=M.firewall_id,M._fwcFwName=M.firewall_name,M._fwcRuleId=s.id,M._fwcPositionId=b.id,M._fwcUserId=this.fwcUser,M._fwcOpenVPNId=M.openvpn,M._fwcWireguardId=M.wireguard,M.cluster_id!==void 0&&M.cluster_id!==null&&(M.parent_id=M._fwcClusterId=M.cluster_id),M.host_id!==void 0&&M.host_id!==null&&(M.parent_id=M._fwcHostId=M.host_id)}}else b.ipobjs=[];b.ipobjs.push({_fwcObjId:v.OBJ_ANY,_fwcObjName:`${s.special==it.CROWDSEC&&b.name=="Source"?"":"(Any)"}`,_fwcObjType:v.OBJ_ANY,allowDrag:!1,hidden:!0})}this.fwcPolicyGridFunctionalityService.calcRuleHeight(s,E)}}e[0]&&e[0].positions&&(l=e[0].positions);for(let s of i){let f=s.type,S=s.position;o[S]||(o[S]=[]),o[S].push(f)}n&&(e=this.parsePolicyWithGroups(e)),this.fwcPolicyGridFunctionalityService.showRulesInViewport(e),this.fwcTypesPositions=o,this.fwcPolicyObject.setPolicyRules(e),this.fwcPolicyPositions=l,this.fwcSelectedPolicy=t,this.numberOfGridColumns=l?l.length+2:0,this.fwcSelectedPolicy._fwcClusterId!==null&&this.fwcSelectedPolicy._fwcClusterId!==void 0&&this.numberOfGridColumns++,this.fwcSelectedPolicy.show_action&&this.numberOfGridColumns++,this.fwcSelectedPolicy._fwcPolicyType===Pe.POLICY_ROUTING&&this.numberOfGridColumns++,this.fwcSelectedPolicy._fwcPolicyType===z[X.DHCP]&&this.numberOfGridColumns++,this.fwcSelectedPolicy._fwcPolicyType===z[X.DHCP_FIXED_IP]&&this.numberOfGridColumns++,this.fwcSelectedPolicy._fwcPolicyType===z[X.KEEPALIVED]&&this.numberOfGridColumns++,this.fwcSelectedPolicy._fwcPolicyType===z[X.HAPROXY]&&this.numberOfGridColumns++,this.fwcPolicyService.setActualPolicy(e)})}parsePolicyWithGroups(e){let i=[];for(let t=0;t<e.length;t++){let n=e[t];if(!n.idgroup)i.push(n);else{let o=n.idgroup,l={rule_group:!0,idgroup:o,group_name:n.group_name,group_style:n.group_style,rules:[],groupHide:!0};this.fwcPolicyGridFunctionalityService.calcRuleHeight(l),this.ruleGroupsExpanded.findIndex(s=>s==l.idgroup)!=-1&&(l.groupHide=!1);let p;for(p=t;p<e.length&&e[p].idgroup==o;p++)l.rules.push(e[p]);i.push(l),t=p-1}}return i}isRuleSelected(e){for(let i=0;i<this.selectedRules.length;i++)if(this.selectedRules[i].id==e.id)return!0;return!1}clearHighlightedRules(){let e=this.fwcPolicyObject.getPolicyRules();if(e){let i=[],t=e;if(t&&t.length)for(i.push(...t);i.length;){let n=i.pop();if(n.highlighted&&delete n.highlighted,n.positions)for(let o=0;o<n.positions.length;o++)n.positions[o].highlighted&&delete n.positions[o].highlighted;n.rule_group&&n.rules&&n.rules.length&&i.push(...n.rules)}}}highlightRule(e,i){this.expandGroup(e);let t=this.fwcPolicyObject.getPolicyRules();if(t){let n=t;if(n&&n.length)for(let s=0;s<n.length;s++){let f=n[s];if(f.rule_group&&f.rules&&f.rules.length)for(let S=0;S<f.rules.length;S++){let E=f.rules[S];if(E.id===e){this.highlightRulePosition(E,i);break}}else if(f.id===e){this.highlightRulePosition(f,i);break}}this.refreshComponent();let o=document.querySelector("#rule_"+e),l=0,p=Array.from(document.querySelectorAll("tr"));for(let s of p)l+=s.clientHeight;if(o){let s=o.clientHeight,f=l;l=0;for(let S of p){if(S===o)break;l+=S.clientHeight}l<f&&(l-=s),this.policyTable.scrollTo({top:l,behavior:"smooth"})}}}highlightRulePosition(e,i){let t=!1;if(Array.isArray(i)||(i=[]),e&&e.positions){for(let n=0;n<e.positions.length;n++){let o=e.positions[n];i.find(l=>l===o.id)&&(o.highlighted=!0,t=!0,setTimeout(()=>{o.highlighted=!1,this.refreshComponent()},4e3))}t||(e.highlighted=!0,setTimeout(()=>{e.highlighted=!1,this.refreshComponent()},4e3))}}expandGroup(e){let i=this.fwcPolicyObject.getPolicyRules();if(i){let t=i;if(t&&t.length){for(let n=0;n<t.length;n++)if(t[n].rule_group){let o=t[n],l=o.rules;l&&l.length&&l.find(s=>s.id===e)&&this.toggleGroupVisible(o,!1)}}}}toggleGroupVisible(e,i){i===!0||i===!1?e.groupHide=i:e.groupHide=!e.groupHide,!e.groupHide&&this.ruleGroupsExpanded.findIndex(t=>t===e.idgroup)==-1&&this.ruleGroupsExpanded.push(e.idgroup),e.groupHide&&(this.ruleGroupsExpanded=this.ruleGroupsExpanded.filter(t=>t!==e.idgroup)),this.fwcPolicyGridFunctionalityService.showRulesInViewport(this.fwcPolicyObject.getPolicyRules())}createNewRule(e){e.newPolicyRule()}policyReload(e){let i={};i=Object.assign(this.fwcSelectedPolicy),i._forcePolicyReload=!0,e&&(i._selectedRules=e.slice(0)),this.fwcPolicyService.setSelectedPolicy(i)}onRuleEnter(e,i){e.highlighted&&delete e.highlighted,this.itemSelectedService.setObjectInfo(void 0,i)}contextMenuLoad(e,i){let t=this.ruleGroupContextMenu.RULE_GROUP.items;if(t)for(let n=0;n<t.length;n++){let o=t[n];o.id==G.FOLDER_EXPAND?o.visible=!!e.groupHide:o.id==G.FOLDER_COLLAPSE?o.visible=!e.groupHide:this.fwcUserLock||(o.enabled=!1)}}contextMenuHandler(e,i,t){let n=i.rules[0];if(t.detail.item)switch(t.detail.item.id){case G.FOLDER_EXPAND:case G.FOLDER_COLLAPSE:this.toggleGroupVisible(i);break;case G.RULE_GROUP_EDIT:case G.RULE_GROUP_COLOR_CHANGE:{let o={id:n.idgroup,fwcloud:this.fwcUserService.getActualFwSelectedCloud(),firewall:n.firewall,style:i.group_style,name:i.group_name,comment:void 0,groupIds:[]},l={header:this.translate.instant("POLICY_GRID.GR_NAME.HEADER"),helpText:this.translate.instant("POLICY_GRID.GR_NAME.TEXT"),formControls:[{name:"groupData",type:"hidden",value:o},{name:"group",type:"hidden",value:i},{name:"policyType",type:"hidden",value:e.getPolicyType()}],onAccept:e.setRuleGroupNameApiCall()};t.detail.item.id==G.RULE_GROUP_EDIT?(l.formControls.push({name:"groupName",label:this.translate.instant("POLICY_GRID.GR_NAME.NAME"),type:"text",required:!0,value:i.group_name}),this.inputDataService.setInputData(l)):(l.formControls.push({name:"groupColor",placeholder:this.translate.instant("RULE.COLOR_PLACEHOLDER"),type:"colorpicker",value:i.group_style}),l.header=this.translate.instant("RULE.COLOR_HEADER"),l.helpText=this.translate.instant("RULE.GROUP_COLOR_TEXT"),l.onAccept=e.setRuleGroupStyleApiCall(),this.inputDataService.setInputData(l));break}case G.RULE_REMOVE_GROUP:n.idgroup&&this.confirmationService.confirm({header:this.translate.instant("GLOBALS.MSG_CONFIRM"),icon:"fa fa-question-circle fwcBlue iconBig",message:this.translate.instant("POLICY_GRID.GR_DELETE",{name:n.group_name}),rejectVisible:!0,rejectLabel:"No",acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.YES"),accept:()=>{e.deleteRuleGroupApiCall(n.idgroup).then(o=>{this.store.dispatch(ue.reloadDialog({dialogUuids:[q.ITEM_PANEL]}));let l=[];l.push(n),this.policyReload(l)}).catch(o=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(o)})})}});break}}onKeyup(e){if(e&&e.key&&e.target.nodeName==="BODY"){let i=e.key.toUpperCase(),t=e.ctrlKey,n=e.shiftKey;if(t){let o=this.ruleSelectedService.getActualSelectedRules(),l=this.ruleSelectedService.getActualClipboardRules();if(i=="C"&&o&&(e.preventDefault(),this.ruleSelectedService.copyRulesToClipboard()),i=="X"&&o&&(e.preventDefault(),this.ruleSelectedService.cutRulesToClipboard()),i=="V"&&o&&l){e.preventDefault();let p=G.PASTE_BELOW,s=o[o.length-1];n&&(p=G.PASTE_ABOVE,s=o[0]),this.fwcRuleFunctionalityService.pasteSelectedRules(this.fwcPolicyObject,s,l,p)}if((i==="ARROWUP"||i==="ARROWDOWN")&&o){e.preventDefault();let p=o[o.length-1],s=G.RULE_MOVE_BELOW;i==="ARROWUP"&&(p=o[0],s=G.RULE_MOVE_ABOVE);let f;f=this.fwcRuleFunctionalityService.newRulesData(p,o,s,re.CUT),this.fwcRuleFunctionalityService.moveSelectedRules(p,f)}}if(i=="DELETE"){let o=this.ruleSelectedService.getActualSelectedRules();if(e.preventDefault(),o){let l=o[0];this.fwcRuleFunctionalityService.deleteSelectedRules(this.fwcPolicyObject,l,o,G.RULE_DELETE)}}}}getPolicyRulesLength(){let e=0,i=this.fwcPolicyObject.getPolicyRules();if(i)for(let t=0;t<i.length;t++){let n=i[t];n.rules?e+=n.rules.length:e++}return e}onPageChange(e){this.refreshComponent()}getColumnsCount(){let e=this.numberOfGridColumns;return this.columnVisibility.comments===!1&&(e-=1),this.fwcSelectedPolicy&&this.fwcSelectedPolicy._fwcClusterId!==null&&this.fwcSelectedPolicy._fwcClusterId!==void 0&&this.fwcSelectedPolicy._fwcPolicyType!==Pe.ROUTING_TABLE&&this.fwcSelectedPolicy._fwcPolicyType!==Pe.POLICY_ROUTING&&this.fwcSelectedPolicy._fwcPolicyType!==z[X.DHCP]&&this.fwcSelectedPolicy._fwcPolicyType!==z[X.DHCP_FIXED_IP]&&this.fwcSelectedPolicy._fwcPolicyType!==z[X.KEEPALIVED]&&this.fwcSelectedPolicy._fwcPolicyType!==z[X.HAPROXY]&&this.columnVisibility.applyTo===!1&&(e-=1),this.fwcSelectedPolicy&&this.fwcSelectedPolicy._fwcPolicyType===z[X.DHCP_FIXED_IP]?(e-=1,this.fwcSelectedPolicy._fwcClusterId!==null&&this.fwcSelectedPolicy._fwcClusterId!==void 0&&(e-=1)):this.fwcSelectedPolicy&&this.fwcSelectedPolicy._fwcPolicyType===z[X.DHCP]&&this.fwcSelectedPolicy._fwcClusterId!==null&&this.fwcSelectedPolicy._fwcClusterId!==void 0?e-=1:this.fwcSelectedPolicy&&this.fwcSelectedPolicy._fwcPolicyType===z[X.HAPROXY]&&this.fwcSelectedPolicy._fwcClusterId!==null&&this.fwcSelectedPolicy._fwcClusterId!==void 0&&(e-=2),e}isObjectTypesValid(e){return[v.OBJ_INTERFACE_FIREWALL,v.OBJ_ADDRESS,v.OBJ_OPENVPN_PREFIX,v.OBJ_WIREGUARD_PREFIX,v.OBJ_IPSEC_PREFIX,v.OBJ_DHCP_RULE_INTERFACE,v.OBJ_OPENVPN_CONFIG_CLI,v.OBJ_WGC_CONFIG_CLI,v.OBJ_ISC_CONFIG_CLI].includes(e)}isPolicyNotInSelected(e){return![z[X.HAPROXY],z[X.DHCP]].includes(e)}adjustMenuPosition(e){requestAnimationFrame(()=>{let i=document.querySelector("iui-contextmenu-win");i&&(i.classList.add("context-menu-hidden"),setTimeout(()=>{if(i&&i.shadowRoot){let n=i.shadowRoot.querySelector('[data-ctrl="contextmenu-win"]');if(n){let o=n.getBoundingClientRect(),l=window.innerHeight,p=window.innerWidth,s=e.detail.event.pageX,f=e.detail.event.pageY,S=f,E=s;f+o.height>l&&(S=f-o.height,S<0&&(S=0)),s+o.width>p&&(E=s-o.width,E<0&&(E=0)),n.style.top=`${S}px`,n.style.left=`${E}px`,i.classList.remove("context-menu-hidden"),i.classList.add("context-menu-visible")}}},30))})}closeContextMenu(){setTimeout(()=>{let e=document.querySelector("iui-contextmenu-win");if(e&&e.shadowRoot){let t=e.shadowRoot.querySelector('[data-ctrl="contextmenu-win"]');t&&(t.style.display="none")}},50)}static{this.\u0275fac=function(i){return new(i||r)(A(ko),A(ae),A(fe),A(Ko),A(Cn),A(gn),A(Ge),A(Le),A(Ni),A(Ln),A(Mn),A(Pn),A(Tn),A(ci),A(li),A(Gn),A(Ji),A(Un),A(Ki),A(Bn),A(pe),A(fn),A(Se),A(Oe),A(me),A(vt),A(he),A(_e),A(le),A(de))}}static{this.\u0275cmp=De({type:r,selectors:[["sts-fwc-policy-grid"]],viewQuery:function(i,t){if(i&1&&(ge(El,5),ge(vl,5)),i&2){let n;se(n=ce())&&(t.gridPaginator=n.first),se(n=ce())&&(t.policyTable=n.first)}},hostBindings:function(i,t){i&1&&P("keyup",function(o){return t.onKeyup(o)},!1,vo)},features:[Ze([ae,gn,Ln,Mn,Pn,Tn,ci,Gn,Un,Bn])],decls:8,vars:4,consts:[["fwcGridRule",""],["showFwHeader",""],["showTable",""],["noData",""],["policyTable",""],["ruleGroup",""],["ruleNormal",""],["noRulesInGroup",""],["gridPaginator",""],["paginatorInfo",""],["showRulePlaceholder",""],["specialHookScriptRulePlaceholder",""],["fwcPositionEl",""],["objectName",""],["labelName",""],["tdActionPosition",""],["divMarkContainer",""],["class","fwcIconHeader",4,"ngIf"],["class","divTableScroll fwcDivPadded fwcDivPaddedTB",4,"ngIf"],[3,"blocked"],[1,"divCenterHV"],["class","divGridLoader",4,"ngIf"],[1,"fwcIconHeader"],[1,"fa","fa-eye"],[1,"divTableScroll","fwcDivPadded","fwcDivPaddedTB"],[1,"divFormHeader","fwcHead"],[1,"fwcLeftIcon"],[4,"ngIf","ngIfElse"],[1,"fwcBlue"],[1,"fwcSep"],[1,"fwc-right-float"],["type","button","class","mr-2 ml-2","icon","pi pi-cog",3,"click",4,"ngIf"],["pButton","","icon","fwcMenuIcon fwci-loadpolicy",1,"p-button-primary",3,"click","label"],[4,"ngIf","ngIfThen","ngIfElse"],["aria-hidden","true",1,"fwcMenuIcon","fwci-cluster","fwcOrange"],["aria-hidden","true",1,"fwcMenuIcon","fwci-firewall","fwcOrange"],["type","button","icon","pi pi-cog",1,"mr-2","ml-2",3,"click"],["position","right",3,"visibleChange","visible","baseZIndex"],[1,"grid"],[1,"col-12"],[1,"fwcBlue","botBorder"],["class","col-12",4,"ngIf"],["name","comments","binary","true",3,"ngModelChange","label","ngModel"],["pButton","","type","button",1,"p-button-secondary",3,"click","label"],[1,"p-table-wrapper"],["styleClass","fwcGridTable",3,"value","rowTrackBy","resizableColumns","scrollable","virtualScrollOptions","virtualScroll","virtualScrollItemSize"],["pTemplate","colgroup"],["pTemplate","header"],["pTemplate","body"],[4,"ngIf"],[4,"ngFor","ngForOf"],[2,"text-align","center"],["pResizableColumn","",3,"width",4,"ngFor","ngForOf"],["pResizableColumn","",4,"ngIf"],["pResizableColumn","","style","width:6rem",4,"ngIf"],["pResizableColumn",""],["pResizableColumn","",2,"width","6rem"],[1,"fwcGridGroup"],[1,"context-menu-wrapper"],["contextMenuRef","contextMenuReference",3,"menuOpening","menuClick","allowAnimation","customStyle","colorScheme","settings"],[1,"clickable-area",2,"padding","0.5rem"],[3,"click"],["class","fa fa-fw fa-chevron-down","aria-hidden","true",4,"ngIf"],["class","fa fa-fw fa-chevron-right","aria-hidden","true",4,"ngIf"],["showDelay","700","tooltipPosition","bottom",1,"spanGroupName",3,"pTooltip","escape"],["aria-hidden","true",1,"fwcMenuIcon","fwci-objectgroup","fwcOrange"],[1,"fwcSepShort"],["aria-hidden","true",1,"fa","fa-fw","fa-chevron-down"],["aria-hidden","true",1,"fa","fa-fw","fa-chevron-right"],[4,"ngFor","ngForOf","ngForTrackBy"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"onPageChange","rows","totalRecords","alwaysShow","templateLeft"],[1,"p-paginator-current"],[3,"message"],[1,"divCentered"],["type","button","pButton","","icon","fa fa-plus",3,"click","label"],[1,"divGridLoader"],[3,"mouseenter","id","ngClass"],["showDelay","700","tooltipPosition","bottom",1,"fwc-centered",2,"filter","none !important",3,"click","dblclick","pTooltip","escape"],[1,"clickable-area"],[3,"menuOpening","menuClick","allowAnimation","customStyle","colorScheme","settings"],[1,"fwcCont",3,"ngClass"],["class","leftRibbon",4,"ngIf"],[1,"fwcRuleOrder"],["class","fwcRuleOptions",4,"ngIf"],["class","fwcActionPosition tdActionCell p-resizable-column",3,"dragenter","dragleave","dragover","drop",4,"ngIf"],["class","fwcActionPosition p-resizable-column",4,"ngIf"],["class","fwcPositionTd p-resizable-column",4,"ngIf"],["class","fwcCommentPosition p-resizable-column",4,"ngIf"],[1,"leftRibbon"],[1,"fa","fa-times","fwcWhite"],[1,"fwcRuleOptions"],[1,"fa","fa-fw","fa-cog","fwcBlue"],[1,"fa","fa-file-code","fwcOrange"],["class","fwcPositionTd p-resizable-column",4,"ngFor","ngForOf"],[1,"fwcPositionTd","p-resizable-column"],[1,"divFwcPosition",3,"dragenter","dragleave","dragover","drop","ngClass"],[2,"height","100%","width","100%"],[1,"divFwcPosition-item",3,"click","dblclick","mouseenter","mouseleave","dragstart","ngClass","draggable"],["class","fwcIcon fwci-negateposition fwcRed","aria-hidden","true",4,"ngIf"],["class","spanActionSpecial",4,"ngIf"],[1,"fwc-label-grid"],["class","fwcPaleDark",4,"ngIf"],[1,"fwc-label-grid-name"],["aria-hidden","true","width","18","height","18",3,"class","src",4,"ngIf"],["aria-hidden","true",3,"class",4,"ngIf"],["aria-hidden","true"],["aria-hidden","true",1,"fwcIcon","fwci-negateposition","fwcRed"],[1,"spanActionSpecial"],[1,"fwcIcon","fwci-address","fwcBlue"],[1,"fwcPaleDark"],["aria-hidden","true","width","18","height","18",3,"src"],[1,"fwcTextArea"],["ondragstart","() => {return false}","ondrop","() => {return false}",2,"border","0",3,"ngModelChange","focus","ngModel"],["appendTo","body",3,"ngModelChange","onChange","options","ngModel","disabled"],[1,"fwcActionPosition","tdActionCell","p-resizable-column",3,"dragenter","dragleave","dragover","drop"],[1,"divFwcPosition"],["styleClass","dropDownAction",3,"options","ngModel","disabled","ngModelChange","onChange",4,"ngIf"],["class","divMarkContainer",4,"ngIf"],["styleClass","dropDownAction",3,"ngModelChange","onChange","options","ngModel","disabled"],["pTemplate","selectedItem"],["pTemplate","item"],[1,"fa","fa-fw","fa-check","fwcOrange"],[1,"divMarkContainer"],["class","divMarkPlaceholder",4,"ngIf"],["class","divMark",3,"mouseenter","mouseleave","wheel","dblclick",4,"ngIf"],[1,"divMarkPlaceholder"],["aria-hidden","true",1,"fa","fa-arrow-circle-down","fwcGreen"],[1,"divMark",3,"mouseenter","mouseleave","wheel","dblclick"],[1,"divMark--label"],[1,"fwci2-label"],[1,"divMark--button"],[1,"fa","fa-times",3,"click"],[1,"fwcActionPosition","p-resizable-column"],["name","max_lease_time","type","number",2,"text-align","right",3,"ngModelChange","focus","blur","id","ngModel"],[1,"fwcCommentPosition","p-resizable-column"],[3,"ngClass"],["maxlength","255","ondragstart","() => {return false}","ondrop","() => {return false}",3,"ngModelChange","focus","blur","ngModel","placeholder","disabled"],[1,"fwcRulePlaceholder",3,"id"],[1,"fwc-centered",2,"filter","none !important"],["class","fwcGroupSpacerDiv",4,"ngIf"],[1,"fwcGroupSpacerDiv"],[1,"fa","fa-cog","fwcBlue"],[1,"fa","fa-terminal","fwcOrange"]],template:function(i,t){i&1&&(F(0,Al,4,3,"h1",17)(1,fa,24,14,"div",18),c(2,"p-blockUI",19)(3,"div",20),T(4,"p-progressSpinner"),_()(),F(5,ma,4,4,"div",21)(6,rs,3,2,"ng-template",null,0,He)),i&2&&(m("ngIf",!(t.fwcPolicyObject!=null&&t.fwcPolicyObject.getPolicyRules())),a(),m("ngIf",!!(t.fwcPolicyObject!=null&&t.fwcPolicyObject.getPolicyRules())),a(),m("blocked",t.loadingData),a(3),m("ngIf",t.ruleStatus))},styles:[".fwcTableContainer[_ngcontent-%COMP%]{overflow-x:auto;overflow-y:hidden;box-sizing:border-box;padding-right:1.5rem}.fwcSticky[_ngcontent-%COMP%]{padding-top:0!important}div.fwcDivRPad[_ngcontent-%COMP%]{padding-right:1.5rem!important}.divGridLoader[_ngcontent-%COMP%]{display:flex;align-items:center;position:fixed;bottom:1rem;left:50%;transform:translate(-50%);padding:.2rem 1rem;background:#ffffffb3;border-radius:1rem}.divGridLoader[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-left:.3rem}.id-column[_ngcontent-%COMP%]{min-width:100%;min-height:44px;height:100%}.max-lease[_ngcontent-%COMP%]{min-height:44px}.context-menu-wrapper[_ngcontent-%COMP%]{width:100%;height:100%}.clickable-area[_ngcontent-%COMP%]{display:block;width:100%;height:100%}[_nghost-%COMP%]     p-button .p-button{width:2.357rem;padding:8px}tr[_ngcontent-%COMP%]{height:100%}  .fwc-right-float button{margin-bottom:2px}  .context-menu-hidden{opacity:0;transform:scale(.95)}  .context-menu-visible{transition:opacity .4s ease,transform .4s ease;opacity:1;transform:scale(1)}"],changeDetection:0})}}return r})();var as=["fwcTreeAccordion"],ss=["sts-fwc-tree-accordion",""],cs=["*"],Wr=(()=>{class r{hostWindowResize(){this.subjectWindowResized.next(void 0)}constructor(){this.subjectWindowResized=new gi,this.alive=!0}ngOnInit(){}ngAfterViewInit(){this.containerHeight=this.fwcTreeAccordion.nativeElement.offsetHeight,this.calcPanels(),this.treePanels.forEach(e=>{e.onChange().pipe(ee(()=>this.alive)).subscribe(()=>{this.calcPanels()})}),this.onWindowResize().pipe(Ci(300),ee(()=>this.alive)).subscribe(()=>{this.containerHeight=this.fwcTreeAccordion.nativeElement.offsetHeight,this.calcPanels()})}ngOnDestroy(){this.alive=!1}calcPanels(){let e=0,i=[],t,n=0;if(this.treePanels){if(this.treePanels.forEach(o=>{e+=o.expanded?0:1,n||(n=o.getMinHeight()),i.push(o)}),e<i.length){t=(this.containerHeight-e*n)/(i.length-e);for(let o=0;o<i.length;o++){let l=i[o];l.expanded?l.setHeight(t):l.setHeight(n)}}for(let o=0;o<i.length;o++){let l=i[o];setTimeout(()=>{l.divContent.nativeElement.querySelector("iui-treeview").updateLayout()},300)}}}onWindowResize(){return this.subjectWindowResized.asObservable()}static{this.\u0275fac=function(i){return new(i||r)}}static{this.\u0275cmp=De({type:r,selectors:[["","sts-fwc-tree-accordion",""]],contentQueries:function(i,t,n){if(i&1&&Ei(n,xn,4),i&2){let o;se(o=ce())&&(t.treePanels=o)}},viewQuery:function(i,t){if(i&1&&ge(as,5),i&2){let n;se(n=ce())&&(t.fwcTreeAccordion=n.first)}},hostBindings:function(i,t){i&1&&P("resize",function(){return t.hostWindowResize()},!1,Eo)},attrs:ss,ngContentSelectors:cs,decls:3,vars:0,consts:[["fwcTreeAccordion",""],[1,"fwcTreeAccordion"]],template:function(i,t){i&1&&(Zi(),c(0,"div",1,0),en(2),_())},styles:[".fwcTreeAccordion[_ngcontent-%COMP%]{box-sizing:border-box;width:100%;height:100%;padding-left:.5rem;padding-right:.5rem}"]})}}return r})();function _s(r,u){r&1&&(c(0,"div",7)(1,"h6",8),T(2,"i",9),g(3),C(4,"translate"),_()()),r&2&&(a(3),R(" ",y(4,1,"COMPILE.FORM.SELECT")," "))}function us(r,u){r&1&&(c(0,"div",7)(1,"h6",8),T(2,"i",10),g(3),C(4,"translate"),_()()),r&2&&(a(3),R(" ",y(4,1,"COMPILE.FORM.COMP_INST")," "))}function fs(r,u){if(r&1&&F(0,_s,5,3,"div",7)(1,us,5,3,"div",7),r&2){let e=d();O(e.displaySelectOptions?0:-1),a(),O(e.displayCompileOptions?1:-1)}}function ms(r,u){if(r&1&&(c(0,"span"),T(1,"i",17),g(2),_()),r&2){let e=d().$implicit;a(2),R("\xA0",e.name," ")}}function hs(r,u){if(r&1&&(c(0,"span"),T(1,"i",18),g(2,"\xA0"),c(3,"strong"),g(4),_(),g(5," ("),c(6,"strong"),g(7),_(),g(8),_()),r&2){let e=d().$implicit;a(4),V(e.name),a(3),V(e.fwnodes==null?null:e.fwnodes.length),a(),R(" node",(e.fwnodes==null?null:e.fwnodes.length)>1?"s":"",") ")}}function ws(r,u){if(r&1&&(c(0,"span"),g(1),C(2,"date"),_()),r&2){let e=d().$implicit;a(),V(zt(2,1,e.compiled_at,"yyyy-MM-dd HH:mm:ss"))}}function Ss(r,u){r&1&&(c(0,"span"),g(1,"-"),_())}function gs(r,u){if(r&1&&(c(0,"span"),g(1),C(2,"date"),_()),r&2){let e=d().$implicit;a(),V(zt(2,1,e.installed_at,"yyyy-MM-dd HH:mm:ss"))}}function Cs(r,u){r&1&&(c(0,"span"),g(1,"-"),_())}function ys(r,u){if(r&1){let e=L();c(0,"tr")(1,"td"),F(2,ms,3,1,"span")(3,hs,9,3,"span"),_(),c(4,"td")(5,"p-checkbox",16),Y("ngModelChange",function(t){let n=h(e).$index,o=d(3);return H(o.compileChecks[n],t)||(o.compileChecks[n]=t),w(t)}),P("onChange",function(t){h(e);let n=d(3);return w(n.checkCompileInstallCheckboxes(t))}),_()(),c(6,"td")(7,"p-checkbox",16),Y("ngModelChange",function(t){let n=h(e).$index,o=d(3);return H(o.installChecks[n],t)||(o.installChecks[n]=t),w(t)}),P("onChange",function(t){h(e);let n=d(3);return w(n.checkCompileInstallCheckboxes(t))}),_()(),c(8,"td"),F(9,ws,3,4,"span")(10,Ss,2,0,"span"),_(),c(11,"td"),F(12,gs,3,4,"span")(13,Cs,2,0,"span"),_()()}if(r&2){let e=u.$implicit,i=u.$index,t=d(3);a(2),O(e.cluster===null?2:-1),a(),O(e.cluster!==null?3:-1),a(2),m("name","compile_"+e.id),W("ngModel",t.compileChecks[i]),m("binary",!0),a(2),m("name","install_"+e.id),W("ngModel",t.installChecks[i]),m("binary",!0),a(2),O(e!=null&&e.compiled_at?9:-1),a(),O(e!=null&&e.compiled_at?-1:10),a(2),O(e!=null&&e.installed_at?12:-1),a(),O(e!=null&&e.installed_at?-1:13)}}function Es(r,u){if(r&1){let e=L();c(0,"div",11)(1,"table",13)(2,"thead")(3,"tr")(4,"th"),g(5),C(6,"translate"),_(),c(7,"th")(8,"p-checkbox",14),Y("ngModelChange",function(t){h(e);let n=d(2);return H(n.compileAllCheck,t)||(n.compileAllCheck=t),w(t)}),P("onChange",function(){h(e);let t=d(2);return w(t.compileOrInstallAll(!1))}),_(),g(9),C(10,"translate"),_(),c(11,"th")(12,"p-checkbox",15),Y("ngModelChange",function(t){h(e);let n=d(2);return H(n.installAllCheck,t)||(n.installAllCheck=t),w(t)}),P("onChange",function(){h(e);let t=d(2);return w(t.compileOrInstallAll(!0))}),_(),g(13),C(14,"translate"),_(),c(15,"th"),g(16),C(17,"translate"),_(),c(18,"th"),g(19),C(20,"translate"),_()()(),c(21,"tbody"),xe(22,ys,14,12,"tr",null,Re),_()()()}if(r&2){let e=d(2);a(5),V(y(6,9,"GLOBALS.MSG_OBJ_TYPES.FIREWALL")),a(3),W("ngModel",e.compileAllCheck),m("binary",!0),a(),R(" ",y(10,11,"CONTEXT.FW.COMPILE")," "),a(3),W("ngModel",e.installAllCheck),m("binary",!0),a(),R(" ",y(14,13,"CONTEXT.FW.INSTALL")," "),a(3),V(y(17,15,"COMPILE.FORM.LAST_COMP")),a(3),V(y(20,17,"COMPILE.FORM.LAST_INST")),a(3),Fe(e.firewalls)}}function vs(r,u){if(r&1&&(c(0,"div",11),T(1,"sts-fwc-message",19),_()),r&2){let e=d(2);a(),m("message",e.errorMessage)}}function Is(r,u){r&1&&(c(0,"div",12),T(1,"p-progressSpinner"),_())}function bs(r,u){if(r&1&&(c(0,"div",4),F(1,Es,24,19,"div",11)(2,vs,2,1,"div",11)(3,Is,2,0,"div",12),_()),r&2){let e=d();a(),O(e.firewalls&&e.firewalls.length?1:-1),a(),O(e.errorMessage?2:-1),a(),O(e.loadingData?3:-1)}}function Ps(r,u){if(r&1&&(c(0,"span"),T(1,"i",18),g(2,"\xA0"),c(3,"strong"),g(4),_()()),r&2){let e=d(2).$implicit;a(4),V(e.firewallName)}}function Ts(r,u){if(r&1&&(c(0,"span"),T(1,"span",26)(2,"i",17),g(3),_()),r&2){let e=d(2).$implicit;a(3),R("\xA0",e.firewallName,"")}}function Os(r,u){if(r&1&&(c(0,"td"),F(1,Ps,5,1,"span")(2,Ts,4,1,"span"),_()),r&2){let e=d().$implicit;a(),O(e.isNode?-1:1),a(),O(e.isNode?2:-1)}}function Rs(r,u){if(r&1&&(c(0,"td"),T(1,"i",17),g(2),_()),r&2){let e=d().$implicit;a(2),R("\xA0",e.firewallName," ")}}function xs(r,u){if(r&1){let e=L();c(0,"a",29),P("click",function(){h(e);let t=d(3).$implicit,n=d(2);return w(n.showPolicyDialog(t.firewallId))}),_()}}function Fs(r,u){if(r&1&&T(0,"i"),r&2){let e=d(3).$implicit,i=d(2);We(i.FirewallOpsIcons[e.compileState])}}function As(r,u){if(r&1&&(c(0,"span"),F(1,xs,1,0,"a",27)(2,Fs,1,3,"i",28),_()),r&2){let e=d(2).$implicit,i=d(2);a(),O(e.compileState===3||e.compileState!==1&&e.compileState!==2&&i.getFirewallStatusCompiled(e.firewallId)===0?1:-1),a(),O(e.compileState===4?2:-1)}}function Ls(r,u){if(r&1&&(c(0,"td",23),F(1,As,3,2,"span"),_()),r&2){let e=d().$implicit;a(),O(e.isNode?-1:1)}}function Ms(r,u){if(r&1){let e=L();c(0,"a",29),P("click",function(){h(e);let t=d(2).$implicit,n=d(2);return w(n.showPolicyDialog(t.firewallId))}),_()}}function Ds(r,u){if(r&1&&T(0,"i"),r&2){let e=d(2).$implicit,i=d(2);We(i.FirewallOpsIcons[e.compileState])}}function Ns(r,u){if(r&1&&(c(0,"td",23),F(1,Ms,1,0,"a",27)(2,Ds,1,3,"i",28),_()),r&2){let e=d().$implicit,i=d(2);a(),O(e.compileState===3||e.compileState!==1&&e.compileState!==2&&i.getFirewallStatusCompiled(e.firewallId)===0?1:-1),a(),O(e.compileState===4?2:-1)}}function Gs(r,u){if(r&1){let e=L();c(0,"a",31),P("click",function(){h(e);let t=d(3).$implicit,n=d(2);return w(n.downloadPolicyScript(t.firewallId))}),_()}}function Us(r,u){if(r&1&&T(0,"i"),r&2){let e=d(3).$implicit,i=d(2);We(i.FirewallOpsIcons[e.compileState])}}function Bs(r,u){if(r&1&&(c(0,"span"),F(1,Gs,1,0,"a",30)(2,Us,1,3,"i",28),_()),r&2){let e=d(2).$implicit,i=d(2);a(),O(e.compileState===3||e.compileState!==1&&e.compileState!==2&&i.getFirewallStatusCompiled(e.firewallId)===0?1:-1),a(),O(e.compileState===4?2:-1)}}function ks(r,u){if(r&1&&(c(0,"td",23),F(1,Bs,3,2,"span"),_()),r&2){let e=d().$implicit;a(),O(e.isNode?-1:1)}}function js(r,u){if(r&1){let e=L();c(0,"a",31),P("click",function(){h(e);let t=d(2).$implicit,n=d(2);return w(n.downloadPolicyScript(t.firewallId))}),_()}}function Vs(r,u){if(r&1&&T(0,"i"),r&2){let e=d(2).$implicit,i=d(2);We(i.FirewallOpsIcons[e.compileState])}}function Ws(r,u){if(r&1&&(c(0,"td",23),F(1,js,1,0,"a",30)(2,Vs,1,3,"i",28),_()),r&2){let e=d().$implicit,i=d(2);a(),O(e.compileState===3||e.compileState!==1&&e.compileState!==2&&i.getFirewallStatusCompiled(e.firewallId)===0?1:-1),a(),O(e.compileState===4?2:-1)}}function Hs(r,u){if(r&1&&(c(0,"tr",24),F(1,Os,3,2,"td")(2,Rs,3,1,"td"),c(3,"td",23),T(4,"i"),_(),c(5,"td",23),T(6,"i"),_(),F(7,Ls,2,1,"td",23)(8,Ns,3,2,"td",23)(9,ks,2,1,"td",23)(10,Ws,3,2,"td",23),_()),r&2){let e=u.$implicit,i=d(2);m("ngClass",e.coloredBg?"bgColored":"bgNormal"),a(),O(e.clusterId!==null&&e.clusterId!==void 0?1:-1),a(),O(e.clusterId===null||e.clusterId===void 0?2:-1),a(2),We(i.FirewallOpsIcons[e.compileState]),a(2),We(i.FirewallOpsIcons[e.installState]),a(),O(e.clusterId!==null&&e.clusterId!==void 0?7:-1),a(),O(e.clusterId===null||e.clusterId===void 0?8:-1),a(),O(e.clusterId!==null&&e.clusterId!==void 0?9:-1),a(),O(e.clusterId===null||e.clusterId===void 0?10:-1)}}function Ys(r,u){if(r&1&&(c(0,"div",5)(1,"div",20)(2,"div",21)(3,"table",22)(4,"caption"),g(5),C(6,"translate"),_(),c(7,"thead")(8,"tr")(9,"th"),g(10),C(11,"translate"),_(),c(12,"th",23),g(13,"C"),_(),c(14,"th",23),g(15,"I"),_(),c(16,"th",23),g(17,"V"),_(),c(18,"th",23),g(19,"D"),_()()(),c(20,"tbody"),xe(21,Hs,11,13,"tr",24,Re),_()()()(),c(23,"div",25),T(24,"sts-fwc-log",null,1),_()()),r&2){let e=d();a(5),R(" ",y(6,2,"COMPILE.FORM.SEL_FW")," "),a(5),V(y(11,4,"COMPILE.FORM.NAME")),a(11),Fe(e.operationQueue)}}function Js(r,u){if(r&1){let e=L();c(0,"button",34),C(1,"translate"),P("click",function(){h(e);let t=d(3);return w(t.showCompileDialog())}),_()}if(r&2){let e=d(3);D("label",y(1,2,"GLOBALS.MSG_BUTTONS.NEXT")),m("disabled",!e.firewalls||!(e.firewalls!=null&&e.firewalls.length))}}function Ks(r,u){if(r&1){let e=L();c(0,"div"),F(1,Js,2,4,"button",32),c(2,"button",33),C(3,"translate"),P("click",function(){h(e);let t=d(2);return w(t.hideDialog())}),_()()}if(r&2){let e=d(2);a(),O(e.enableProcess?1:-1),a(),D("label",y(3,2,"GLOBALS.MSG_BUTTONS.CLOSE"))}}function Xs(r,u){if(r&1){let e=L();c(0,"button",42),C(1,"translate"),P("click",function(){h(e);let t=d(3);return w(t.doPauseProcess(!0))}),_()}if(r&2){let e=d(3);D("label",y(1,2,"COMPILE.PAUSE")),m("disabled",e.disableButtons)}}function zs(r,u){if(r&1){let e=L();c(0,"button",43),P("click",function(){h(e);let t=d(3);return w(t.doContinueProcess())}),_()}if(r&2){let e=d(3);m("disabled",e.disableButtons)("label",e.continueButtonText)}}function qs(r,u){if(r&1){let e=L();c(0,"button",44),C(1,"translate"),P("click",function(){h(e);let t=d(3);return w(t.downloadPolicyScript(t.operationQueue[0].firewallId))}),_()}r&2&&D("label",y(1,1,"CONTEXT.FW.DOWNLOAD"))}function Qs(r,u){if(r&1){let e=L();c(0,"button",45),C(1,"translate"),P("click",function(){h(e);let t=d(3);return w(t.showPolicyDialog(t.operationQueue[0].firewallId))}),_()}r&2&&D("label",y(1,1,"CONTEXT.FW.SHOW"))}function $s(r,u){if(r&1){let e=L();c(0,"button",46),C(1,"translate"),P("click",function(){h(e);let t=d(3);return w(t.doDownloadCompileLog())}),_()}if(r&2){let e=d(3);D("label",y(1,2,"LOG_PANEL.BTN_DOWNLOAD")),m("disabled",e.loadingData||e.disableButtons)}}function Zs(r,u){if(r&1){let e=L();c(0,"div"),F(1,Xs,2,4,"button",35)(2,zs,1,2,"button",36),T(3,"span",37),F(4,qs,2,3,"button",38)(5,Qs,2,3,"button",39)(6,$s,2,4,"button",40),c(7,"button",41),C(8,"translate"),P("click",function(){h(e);let t=d(2);return w(t.hideDialog())}),_()()}if(r&2){let e=d(2);a(),O(!e.pauseProcess&&e.operationInProcessId<e.operationQueue.length-1?1:-1),a(),O(e.pauseProcess&&e.operationInProcessId<e.operationQueue.length?2:-1),a(2),O(!e.pauseProcess&&!(e.operationInProcessId<e.operationQueue.length)&&e.getDifferentCompiled()?4:-1),a(),O(!e.pauseProcess&&!(e.operationInProcessId<e.operationQueue.length)&&e.getDifferentCompiled()?5:-1),a(),O(e.pauseProcess===!1&&!(e.operationInProcessId<e.operationQueue.length)?6:-1),a(),D("label",y(8,7,"GLOBALS.MSG_BUTTONS.CLOSE")),m("disabled",e.loadingData||e.disableButtons)}}function ec(r,u){if(r&1&&F(0,Ks,4,4,"div")(1,Zs,9,9,"div"),r&2){let e=d();O(e.displaySelectOptions?0:-1),a(),O(e.displayCompileOptions?1:-1)}}var tc=6e4,Hr=(()=>{class r extends Bt{constructor(e,i,t,n,o,l,p,s,f,S,E,I,b,x,J,U){super(p,i,e,x,J,U),this.itemSelectedService=e,this.appOptionsService=i,this.fwcUserService=t,this.fwcFirewallService=n,this.fwcPolicyService=o,this.fwcErrorPipe=l,this.appDialogPanelsService=p,this.confirmationService=s,this.messageService=f,this.inputDataService=S,this.fwcEventService=E,this.utilService=I,this.translate=b,this.cd=x,this.store=J,this.router=U,this.displaySelectOptions=!1,this.displayCompileOptions=!1,this.firewalls=[],this.compileChecks=[],this.installChecks=[],this.operationQueue=[],this.operationStatus={},this.loadingData=!1,this.FirewallOpsIcons=Bo,this.disableButtons=!1,this.pauseProcess=!1,this.alive=!0,this.createDialog(this.translate.instant("COMPILE.PANEL_TITLE"),"fwci-compileallfirewalls")}ngOnInit(){let e,i;this.continueButtonText=this.translate.instant("COMPILE.CONTINUE");let t=[];this.itemSelectedService.getCloudToCompile().pipe(ee(()=>this.alive)).subscribe(n=>{switch(this.loadingData=!0,n.compileWhat){case yt.COMP_CLOUD:e=this.fwcFirewallService.getFirewallsByCloud.bind(this.fwcFirewallService),i=this.translate.instant("COMPILE.NO_DATA");break;case yt.COMP_CLUSTER:e=this.fwcFirewallService.getClusterNodes.bind(this.fwcFirewallService);break;case yt.COMP_FIREWALL:e=this.fwcFirewallService.getFirewall.bind(this.fwcFirewallService);break;case yt.COMP_CLUSTERS_ALL:e=this.fwcFirewallService.getFirewallsByCloud.bind(this.fwcFirewallService),i=this.translate.instant("COMPILE.NO_DATA_CL");break;case yt.COMP_FIREWALLS_ALL:e=this.fwcFirewallService.getFirewallsByCloud.bind(this.fwcFirewallService),i=this.translate.instant("COMPILE.NO_DATA_FW");break}this.fwcFirewallService.getClustersByCloud(this.fwcUserService.getActualFwSelectedCloud()).subscribe(o=>{o.data&&Array.isArray(o.data)?t=o.data:t=[],e(n.compileId,this.fwcUserService.getActualFwSelectedCloud()).subscribe(l=>{let p=[],s,f;Array.isArray(l.data)&&l.data.length?p.push(...l.data):l.data&&l.data.id&&p.push(l.data),this.firewalls=[];for(let S=0;S<p.length;S++)if(p[S].status_compiled=p[S].status&1,p[S].status_installed=p[S].status&2,s=p[S].cluster,s==null)(n.compileWhat===yt.COMP_CLOUD||n.compileWhat===yt.COMP_FIREWALLS_ALL||n.compileWhat===yt.COMP_FIREWALL)&&this.firewalls.push(p[S]);else if(n.compileWhat===yt.COMP_CLOUD||n.compileWhat===yt.COMP_CLUSTERS_ALL||n.compileWhat===yt.COMP_CLUSTER){f=!1;for(let b=0;b<this.firewalls.length&&!f;b++)this.firewalls[b].cluster==s&&(this.firewalls[b].fwnodes.push(p[S]),f=!0);let E="",I=t.filter(b=>b.id==s);if(I&&I.length&&(E=I[0].name),!f){let b=Object.assign({},p[S]);p[S].name=E,p[S].fwnodes=[],p[S].fwnodes.push(b),this.firewalls.push(p[S])}}if(this.loadingData=!1,this.firewalls.length){for(let S=0;S<this.firewalls.length;S++)this.compileChecks[S]=!!this.firewalls[S].status_compiled,this.installChecks[S]=!!n.compileAction&&!!this.firewalls[S].status_installed;this.checkCompileInstallCheckboxes()}else this.errorMessage={type:"warning",title:this.translate.instant("COMPILE.NO_DATA_HEAD"),text:i};this.recenterDialog()},l=>{l.error&&l.error.fwcErr==1002?this.errorMessage={type:"warning",title:this.translate.instant("COMPILE.NO_DATA_HEAD"),text:i}:l.error&&this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(l)}),this.loadingData=!1})},o=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(o)}),this.loadingData=!1}),this.displaySelectOptions=!0,this.showDialog()})}checkCompileInstallCheckboxes(e){this.compileChecks.every(i=>i)?this.compileAllCheck=!0:this.compileAllCheck=!1,this.installChecks.every(i=>i)?this.installAllCheck=!0:this.installAllCheck=!1,this.enableProcess=this.compileChecks.some(i=>i)||this.installChecks.some(i=>i)}ngOnDestroy(){clearTimeout(this.opTimeout),super.ngOnDestroy()}onDialogHide(e){this.displaySelectOptions=!1,this.displayCompileOptions=!1,this.firewalls=[],this.compileChecks=[],this.errorMessage=null,this.installChecks=[],this.log&&this.log.clearMessages(),this.channel_id&&this.utilService.ioReleaseLogEvent(this.channel_id),this.operationQueue=[],this.pauseProcess=!1,this.eventsSubscription&&this.eventsSubscription.unsubscribe(),this.operationInProcessId!==void 0&&this.itemSelectedService.setModifiedItem({_fwcTreeAction:Ue.RELOAD_TREE,containerToReload:nt.C_FIREWALLS}),this.actualFirewallCompileSSHInputData=null,this.operationInProcessId=void 0,this.opTimeout&&clearTimeout(this.opTimeout)}compileAll(){this.displaySelectOptions=!0}compileOrInstallAll(e){let i,t;e?(i=this.installAllCheck,t=this.installChecks):(i=this.compileAllCheck,t=this.compileChecks),i?t.fill(!0):t.fill(!1),this.checkCompileInstallCheckboxes()}showCompileDialog(){this.displaySelectOptions=!1,this.displayCompileOptions=!0,this.recenterDialog(),this.startCompileProcess()}resetTimer(){this.opTimeout&&clearTimeout(this.opTimeout),this.opTimeout=setTimeout(()=>{this.doTimeoutOp()},tc)}startCompileProcess(){let e,i=!1;if(!this.firewalls)return;this.operationQueue=[];for(let o=0;o<this.firewalls.length;o++)if(this.compileChecks[o]||this.installChecks[o]){let l=this.firewalls[o];if(l.cluster===null||l.cluster===void 0)e={clusterId:l.cluster,firewallId:l.id,firewallName:l.name,compileState:this.compileChecks[o]?Ce.FW_PENDING:Ce.FW_DISABLED,installState:this.installChecks[o]?Ce.FW_PENDING:Ce.FW_DISABLED,coloredBg:i,opCompiled:!1,opInstalled:!1},this.operationQueue.push(Object.assign({},e));else{e={clusterId:l.cluster,clusterName:l.name,firewallId:l.id,firewallName:l.name,compileState:this.compileChecks[o]?Ce.FW_PENDING:Ce.FW_DISABLED,installState:Ce.FW_DISABLED,coloredBg:i,opCompiled:!1,opInstalled:!1},this.operationQueue.push(Object.assign({},e));for(let p=0;l.fwnodes&&p<l.fwnodes.length;p++){let s=l.fwnodes[p];e={clusterId:l.cluster,clusterName:l.name,isNode:!0,firewallId:s.id,firewallName:s.name,compileState:Ce.FW_DISABLED,installState:this.installChecks[o]?Ce.FW_PENDING:Ce.FW_DISABLED,coloredBg:i,opCompiled:!1,opInstalled:!1},this.operationQueue.push(Object.assign({},e))}}i=!i}let t=this.utilService.createDynamicComponentRef(nn),n=t.instance;n.setDynamicComponentRef(t),this.communicationSubscription=n.socketEventEmitter.subscribe(o=>{o=="connected"&&(this.channel_id=bt(),this.utilService.ioListenOnLogEvent(this.channel_id),this.eventsSubscription=this.fwcEventService.getEvent().pipe(ee(()=>this.displayCompileOptions)).subscribe(l=>{let p=new bn(l),s;p.payload.type===K.MSG_ERROR&&(this.pauseProcess=!0,s=this.utilService.isCommunicationErrorStr(p.payload.message),this.operationStatus.opMsg=this.translate.instant("COMPILE.GEN_ERROR"),this.operationStatus.opMsgType=K.MSG_ERROR,s?this.continueButtonText=this.translate.instant("COMPILE.RETRY"):this.continueButtonText=this.translate.instant("COMPILE.CONTINUE")),s||this.log.addNewMessage(p),this.resetTimer()}),this.operationInProcessId=0,this.actualFirewallCompileSSHInputData=null,this.processFirewallOperation()),this.communicationSubscription.unsubscribe()}),n.checkConnection()}processFirewallOperation(e){let i;if(!this.pauseProcess&&(clearTimeout(this.opTimeout),this.operationQueue&&this.operationInProcessId<this.operationQueue.length)){let t=this.operationQueue[this.operationInProcessId];if(!t)return;if(t.clusterId!==null&&t.clusterId!==void 0?t.firewallName?i=this.translate.instant("COMPILE.INST_CLUSTER_NODE",{clusterName:t.clusterName,firewallName:t.firewallName}):i=this.translate.instant("COMPILE.INST_CLUSTER",{clusterName:t.clusterName}):i=this.translate.instant("COMPILE.INST_FW",{firewallName:t.firewallName}),t.compileState==Ce.FW_PENDING)t.compileState=Ce.FW_PROCESSING,this.addMessageToLog(this.translate.instant("COMPILE.COMP_START",{name:i}),K.MSG_INFO),this.operationStatus.opMsg=this.translate.instant("COMPILE.COMP_SUCCESS",{name:i}),this.operationStatus.opMsgType=K.MSG_OK,this.resetTimer(),this.loadingData=!0,this.log.startDataLoad(),this.utilService.fwcAPICall(this.fwcPolicyService.compileFirewall.bind(this.fwcPolicyService),t.firewallId,this.fwcUserService.getActualFwSelectedCloud(),this.channel_id).then(n=>{t.compileState=Ce.FW_OK,this.loadingData=!1,this.log.stopDataLoad(),clearTimeout(this.opTimeout),setTimeout(()=>{this.addMessageToLog(this.operationStatus.opMsg,this.operationStatus.opMsgType),this.addMessageToLog("",K.MSG_SEPARATOR),this.processFirewallOperation()})}).catch(n=>{this.addMessageToLog(this.translate.instant("COMPILE.COMP_ERROR",{name:i,error:this.fwcErrorPipe.transform(n)}),K.MSG_ERROR),t.compileState=Ce.FW_ERROR,this.doPauseProcess(),this.log.stopDataLoad()});else if(t.installState==Ce.FW_PENDING){t.installState=Ce.FW_PROCESSING,(this.operationInProcessId||!this.operationInProcessId&&t.compileState!=Ce.FW_DISABLED)&&this.addMessageToLog("",K.MSG_SEPARATOR),this.addMessageToLog(this.translate.instant("COMPILE.INST_START",{name:i}),K.MSG_INFO);let n={header:this.translate.instant("COMPILE.INST_SSH",{name:i}),helpText:this.translate.instant("COMPILE.INST_SSH_TEXT"),modal:!1,formControls:[{name:"firewall_id",type:"hidden",value:t.firewallId}],onAccept:this.installFirewall.bind(this)};this.fwcFirewallService.getFirewall(t.firewallId,this.fwcUserService.getActualFwSelectedCloud()).subscribe(o=>te(this,null,function*(){let l=o.data;if(l){let p=this.fwcUserService.getActualFwcUser().privateKey,s=l.install_user,f=l.install_pass,S=l.install_apikey;try{s&&(s=yield this.utilService.openPGPDecrypt(s,p)),f&&(f=yield this.utilService.openPGPDecrypt(f,p)),S&&(S=yield this.utilService.openPGPDecrypt(S,p))}catch{}if(l.install_interface&&l.install_ipobj){n.formControls.push({name:"install_communication",type:"hidden",value:l.install_communication}),l.install_communication==="ssh"&&(n.formControls.push({name:"install_user",label:this.translate.instant("CLUSTER.MSG_CLUSTER_EDITION.SSH_USER"),type:"text",required:!0,value:this.actualFirewallCompileSSHInputData?this.actualFirewallCompileSSHInputData.install_user:s,setFocus:!0}),n.formControls.push({name:"",label:"",type:"separator"}),n.formControls.push({name:"install_pass",label:this.translate.instant("CLUSTER.MSG_CLUSTER_EDITION.SSH_PASS"),type:"password",required:!0,value:this.actualFirewallCompileSSHInputData?this.actualFirewallCompileSSHInputData.install_pass:f}));let E={name:"btnPauseProcess",label:this.translate.instant("COMPILE.PAUSE"),type:"button",icon:"fa fa-pause",class:"p-button-warning",value:0};if(n.formControls.push(E),n.formControls.unshift({name:"",label:"",type:"separator"}),n.formControls.unshift({name:"ip_name",label:this.translate.instant("COMPILE.FIELDS.INST_IP"),icon:"fwci-address fwcBlue",type:"text",value:l.ip_name?l.ip_name+" ("+l.ip+")":"-",readonly:!0,halfSized:!0}),n.formControls.unshift({name:"interface_name",label:this.translate.instant("COMPILE.FIELDS.INST_IF"),icon:"fwci-interface fwcGreen",type:"text",value:l.interface_name||"-",readonly:!0,halfSized:!0}),l.install_communication==="agent"&&l.install_protocol&&l.install_apikey){let I=this.inputDataService.getInputDataValue(n);this.installFirewall(I)}else this.disableButtons=!0,this.inputDataService.setInputData(n)}else t.installState=Ce.FW_ERROR,setTimeout(()=>{this.confirmationService.confirm({key:"cdErrorFw",header:this.translate.instant("COMPILE.INST_SSH_ERROR"),message:this.translate.instant("COMPILE.INST_SSH_ERROR_TEXT",{name:l.name}),reject:()=>{this.doPauseProcess()},accept:()=>{let E=this.translate.instant("COMPILE.INST_SSH_ERROR_TEXT",{name:l.name});this.addMessageToLog(this.translate.instant("COMPILE.INST_ERROR",{name:i,error:E}),K.MSG_ERROR),this.operationInProcessId++,this.actualFirewallCompileSSHInputData=null,this.processFirewallOperation()}})},100)}else t.installState=Ce.FW_ERROR,this.doPauseProcess(),this.log.stopDataLoad(),this.addMessageToLog(this.translate.instant("COMPILE.INST_FW_ERROR",{name:i}),K.MSG_ERROR)}),o=>{t.installState=Ce.FW_ERROR,this.doPauseProcess(),this.log.stopDataLoad(),this.addMessageToLog(this.translate.instant("COMPILE.INST_DATA_ERROR",{name:i,error:this.fwcErrorPipe.transform(o)}),K.MSG_ERROR)})}else this.operationInProcessId++,this.actualFirewallCompileSSHInputData=null,this.processFirewallOperation()}}installFirewall(e){return te(this,null,function*(){let i,t;if(this.operationQueue&&this.operationInProcessId<this.operationQueue.length&&(t=this.operationQueue[this.operationInProcessId]),!!t)if(t.clusterId!==null&&t.clusterId!==void 0?i=`cluster ${t.clusterId} - firewall ${t.firewallId} (${t.firewallName})`:i=`firewall ${t.firewallId} (${t.firewallName})`,this.disableButtons=!1,e){if(this.actualFirewallCompileSSHInputData=e,e.btnPauseProcess){t.installState=Ce.FW_PENDING,this.doPauseProcess(!0);return}let n=this.fwcUserService.getActualFwcUser().publicKey,o=e.install_user,l=e.install_pass,p=e.install_apikey;o&&(o=yield this.utilService.openPGPEncrypt(o,n)),l&&(l=yield this.utilService.openPGPEncrypt(l,n)),this.resetTimer(),this.loadingData=!0,this.log.startDataLoad(),this.utilService.fwcAPICall(this.fwcPolicyService.installFirewall.bind(this.fwcPolicyService),e.firewall_id,this.fwcUserService.getActualFwSelectedCloud(),o,l,this.channel_id).then(s=>{t.installState=Ce.FW_OK,this.operationStatus.opMsg=this.translate.instant("COMPILE.INST_SUCCESS",{name:i}),this.operationStatus.opMsgType=K.MSG_OK,this.loadingData=!1,this.log.stopDataLoad(),this.actualFirewallCompileSSHInputData=null,setTimeout(()=>{this.addMessageToLog(this.operationStatus.opMsg,this.operationStatus.opMsgType),this.addMessageToLog("",K.MSG_SEPARATOR),this.processFirewallOperation()})}).catch(s=>{let f=this.utilService.isCommunicationError(s.error);f?(t.installState=Ce.FW_PENDING,this.addMessageToLog(this.translate.instant("COMPILE.INST_ERROR",{name:i,error:f}),K.MSG_ERROR),this.continueButtonText=this.translate.instant("COMPILE.RETRY")):(s.error.fwcErr==9e3?this.confirmationService.confirm({header:this.translate.instant("GLOBALS.MSG_OP_RESULT.ERROR"),icon:"fa fa-exclamation-circle fwcRed iconBig",message:this.translate.instant("API_ERROR.SSH_FORBIDDEN"),rejectVisible:!1,acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.OK")}):(t.installState=Ce.FW_ERROR,this.addMessageToLog(this.translate.instant("COMPILE.INST_ERROR",{name:i,error:this.fwcErrorPipe.transform(s)}),K.MSG_ERROR)),this.continueButtonText=this.translate.instant("COMPILE.CONTINUE"),this.actualFirewallCompileSSHInputData=null),this.loadingData=!1,this.log.stopDataLoad(),this.operationInProcessId<this.operationQueue.length-1?this.doPauseProcess():clearTimeout(this.opTimeout)})}else t.installState=Ce.FW_WARNING,this.addMessageToLog(this.translate.instant("COMPILE.INST_WARNING",{name:i}),K.MSG_ERROR),this.operationInProcessId++,this.actualFirewallCompileSSHInputData=null,this.processFirewallOperation()})}doTimeoutOp(){this.pauseProcess=!0,this.loadingData=!1,this.log&&(this.log.stopDataLoad(),this.addMessageToLog(this.translate.instant("COMPILE.WARN_TIMEOUT"),K.MSG_WARNING))}doPauseProcess(e){this.pauseProcess=!0,this.loadingData=!1,this.log&&this.log.stopDataLoad(),clearTimeout(this.opTimeout),e&&this.addMessageToLog(this.translate.instant("COMPILE.WARN_PAUSE"),K.MSG_WARNING)}doContinueProcess(){this.pauseProcess=!1,this.processFirewallOperation()}doDownloadCompileLog(){this.log&&this.log.downloadLog()}showPolicyDialog(e){let i=this.utilService.createDynamicComponentRef(no),t=i.instance;t.setDynamicComponentRef(i),t.show(e)}downloadPolicyScript(e){let i=this.utilService.createDynamicComponentRef(no),t=i.instance;t.setDynamicComponentRef(i),t.downloadPolicyScript(e)}getDifferentCompiled(){let e=[...new Set(this.operationQueue.map(i=>i.clusterId))];return e.length===1&&e[0]===null&&[...new Set(this.operationQueue.map(i=>i.firewallId))].length===1?this.getFirewallStatusCompiled(this.operationQueue[0].firewallId)===3:e.length===1?this.operationQueue.find(i=>i.firewallId===this.firewalls[0].id).compileState===3:!1}getFirewallStatusCompiled(e){return this.operationQueue.find(i=>i.firewallId===e).compileState}static{this.\u0275fac=function(i){return new(i||r)(A(Ge),A(Et),A(pe),A(ae),A(fe),A(Se),A(Nt),A(Oe),A(me),A(vt),A(ii),A(he),A(de),A(le),A(_e),A(Dt))}}static{this.\u0275cmp=De({type:r,selectors:[["sts-fwc-firewall-compile-panel"]],viewQuery:function(i,t){if(i&1&&ge(ai,5),i&2){let n;se(n=ce())&&(t.log=n.first)}},features:[Ze([ae]),Lt],decls:6,vars:6,consts:[["fwCompileDialog",""],["compileLog",""],["styleClass","dlgFwcDialog dlgFwcDialog--medium",3,"visibleChange","onHide","visible","modal","resizable","closable"],["pTemplate","header"],[1,"grid","divTableScroll"],[1,"grid","divFw"],["pTemplate","footer"],[1,"divFormHeader"],[1,"fwcWhite","fwcIconLeft"],[1,"fwcMenuIcon","fwci-firewalls","fwcOrange"],[1,"fwcMenuIcon","fwci-compileallfirewalls","fwcOrange"],[1,"col-12"],[1,"col-12","divLoader"],[1,"tableFw"],["name","compile_all","styleClass","compileCheckbox",3,"ngModelChange","onChange","ngModel","binary"],["name","install_all","styleClass","compileCheckbox",3,"ngModelChange","onChange","ngModel","binary"],["styleClass","compileCheckbox",3,"ngModelChange","onChange","name","ngModel","binary"],[1,"fwcMenuIcon","fwci-firewall","fwcBlue"],[1,"fwcMenuIcon","fwci-cluster","fwcOrange"],[3,"message"],[1,"col-4"],[1,"divFwBar","divTableScroll"],[1,"tableFw","unstriped"],[1,"fwc-centered"],[3,"ngClass"],[1,"col-8"],[1,"fwcSepShort"],[1,"fa","fa-eye","fwcBlue"],[3,"class"],[1,"fa","fa-eye","fwcBlue",3,"click"],[1,"fa","fa-download"],[1,"fa","fa-download",3,"click"],["type","button","pButton","","icon","fa fa-arrow-right",1,"p-button-success",3,"disabled","label"],["type","button","pButton","","icon","pi pi-check",1,"p-button-primary",3,"click","label"],["type","button","pButton","","icon","fa fa-arrow-right",1,"p-button-success",3,"click","disabled","label"],["type","button","pButton","","icon","fa fa-pause",1,"p-button-warning",3,"disabled","label"],["type","button","pButton","","icon","fa fa-play",1,"p-button-success",3,"disabled","label"],[1,"spanSep"],["type","button","pButton","","icon","fa fa-download",1,"p-button-secondary",3,"label"],["type","button","pButton","","icon","fa fa-eye",1,"p-button-secondary",3,"label"],["type","button","pButton","","icon","fa fa-download",1,"p-button-secondary",3,"disabled","label"],["type","button","pButton","","icon","pi pi-check",1,"p-button-primary",3,"click","disabled","label"],["type","button","pButton","","icon","fa fa-pause",1,"p-button-warning",3,"click","disabled","label"],["type","button","pButton","","icon","fa fa-play",1,"p-button-success",3,"click","disabled","label"],["type","button","pButton","","icon","fa fa-download",1,"p-button-secondary",3,"click","label"],["type","button","pButton","","icon","fa fa-eye",1,"p-button-secondary",3,"click","label"],["type","button","pButton","","icon","fa fa-download",1,"p-button-secondary",3,"click","disabled","label"]],template:function(i,t){if(i&1){let n=L();c(0,"p-dialog",2,0),Y("visibleChange",function(l){return h(n),H(t.displayDialog,l)||(t.displayDialog=l),w(l)}),P("onHide",function(l){return h(n),w(t.onDialogHide(l))}),F(2,fs,2,2,"ng-template",3)(3,bs,4,3,"div",4)(4,Ys,26,6,"div",5)(5,ec,2,2,"ng-template",6),_()}i&2&&(W("visible",t.displayDialog),m("modal",!0)("resizable",!0)("closable",!1),a(3),O(t.displaySelectOptions?3:-1),a(),O(t.displayCompileOptions?4:-1))},dependencies:[tt,gt,Ct,ai,kt,Ut,Be,lt,Gt,It,Fo,ot],styles:[`.divFw{height:33rem}.divFwBar{height:32rem}
`],encapsulation:2})}}return r})();var ac=["inputFirewallName"],sc=["fwcInterfacesEditor"],cc=()=>({width:"80vw"}),zr=r=>({visibility:r}),ye=()=>({standalone:!0}),qr=(r,u)=>({type:"error",title:r,text:u}),pc=()=>({width:"1.7rem",height:"1.7rem"});function dc(r,u){if(r&1&&(c(0,"div",9)(1,"h6",13),T(2,"i",14),g(3),C(4,"translate"),c(5,"strong"),g(6),_()()()),r&2){let e=d(4);a(3),R(" ",y(4,2,"FW.MSG_FW_EDITION.EDIT")," "),a(3),V(e.firewall==null?null:e.firewall.name)}}function _c(r,u){r&1&&(c(0,"span")(1,"i"),g(2,"(Master)"),_()())}function uc(r,u){if(r&1&&(c(0,"div",9)(1,"h6",13),T(2,"i",14),g(3," Cluster "),c(4,"strong"),g(5),_(),g(6),C(7,"translate"),F(8,_c,3,0,"span"),_()()),r&2){let e=d(4);a(5),V(e.firewall==null?null:e.firewall._fwcClusterId),a(),R(" - ",y(7,3,"FW.MSG_FW_EDITION.EDIT_NODE")," "),a(2),O(e.firewall!=null&&e.firewall.fwmaster?8:-1)}}function fc(r,u){if(r&1&&F(0,dc,7,4,"div",9)(1,uc,9,5,"div",9),r&2){let e=d(3);O(e.firewall!=null&&e.firewall._fwcClusterId?-1:0),a(),O(e.firewall!=null&&e.firewall._fwcClusterId?1:-1)}}function mc(r,u){r&1&&(c(0,"div",9)(1,"h6",13),T(2,"i",14),g(3),C(4,"translate"),_()()),r&2&&(a(3),R(" ",y(4,1,"FW.MSG_FW_EDITION.EDIT")," "))}function hc(r,u){if(r&1&&F(0,fc,2,2)(1,mc,5,3,"div",9),r&2){let e=d(2);O(e.firewall!=null&&e.firewall.id?0:1)}}function wc(r,u){if(r&1&&(c(0,"div",9)(1,"h6",13),T(2,"i",15),g(3),C(4,"translate"),c(5,"strong"),g(6),_()()()),r&2){let e=d(2);a(3),R(" ",y(4,2,"FW.MSG_FW_EDITION.DELETE")," "),a(3),V(e.firewallToDelete._fwcObjName)}}function Sc(r,u){if(r&1){let e=L();c(0,"button",16),P("click",function(){h(e);let t=d(2);return w(t.showHelp())}),_()}if(r&2){let e=d(2);m("disabled",e.loadingData)}}function gc(r,u){if(r&1){let e=L();F(0,hc,2,1)(1,wc,7,4,"div",9),c(2,"div",10),F(3,Sc,1,1,"button",11),c(4,"button",12),P("click",function(){h(e);let t=d();return w(t.minimizeDialog())}),_()()}if(r&2){let e=d();O(e.firewall?0:-1),a(),O(e.firewallToDelete?1:-1),a(2),O(e.helpSection?3:-1),a(),m("disabled",e.loadingData)}}function Cc(r,u){if(r&1&&(c(0,"option",32),g(1),_()),r&2){let e=u.$implicit;m("ngValue",e.id),a(),R(" ",e.name," ")}}function yc(r,u){if(r&1){let e=L();c(0,"div",64)(1,"div",25)(2,"label",65),g(3),C(4,"translate"),_(),c(5,"select",66),P("change",function(){return h(e),w(!0)}),c(6,"option",35),g(7),C(8,"translate"),_(),c(9,"option",67),g(10,"HTTPS"),_(),c(11,"option",68),g(12,"HTTP"),_()()()(),c(13,"div",69)(14,"div",25)(15,"label",70),g(16),C(17,"translate"),_(),T(18,"input",71),C(19,"translate"),c(20,"button",72),P("mousedown",function(){h(e);let t=d(2);return w(t.displayApiKey=!0)})("mouseup",function(){h(e);let t=d(2);return w(t.displayApiKey=!1)})("mouseout",function(){h(e);let t=d(2);return w(t.displayApiKey=!1)}),_()()()}if(r&2){let e=d(2);a(3),V(y(4,7,"FW.MSG_FW_EDITION.AGENT_PROTOCOL")),a(3),m("value",null),a(),R(" ",y(8,9,"FW.MSG_FW_EDITION.AGENT_PROTOCOL")," "),a(9),V(y(17,11,"FW.MSG_FW_EDITION.AGENT_APIKEY")),a(2),D("placeholder",y(19,13,"FW.MSG_FW_EDITION.AGENT_APIKEY")),m("showPassword",e.displayApiKey)("feedback",!1)}}function Ec(r,u){r&1&&(c(0,"p",75),g(1),C(2,"translate"),_()),r&2&&(a(),R(" ",y(2,1,"ITEM_PANEL.ERRORS.FIELD_USERNAME")," "))}function vc(r,u){if(r&1){let e=L();c(0,"div",69)(1,"div",25)(2,"label",73),g(3),C(4,"translate"),_(),T(5,"input",74),C(6,"translate"),_(),F(7,Ec,3,3,"p",75),_(),c(8,"div",64)(9,"div",25,4)(11,"label",76),g(12),C(13,"translate"),_(),T(14,"input",77),C(15,"translate"),C(16,"translate"),C(17,"translate"),C(18,"translate"),C(19,"translate"),c(20,"button",78),P("mousedown",function(){h(e);let t=d(2);return w(t.displaySSH=!0)})("mouseup",function(){h(e);let t=d(2);return w(t.displaySSH=!1)})("mouseout",function(){h(e);let t=d(2);return w(t.displaySSH=!1)}),_()()()}if(r&2){let e=d(2);a(3),V(y(4,10,"FW.MSG_FW_EDITION.SSH_USER")),a(2),D("placeholder",y(6,12,"FW.MSG_FW_EDITION.SSH_USER")),a(2),O(!e.formModel.get("install_user").valid&&!e.formModel.get("install_user").pristine?7:-1),a(5),V(y(13,14,"FW.MSG_FW_EDITION.SSH_PASS")),a(2),D("placeholder",y(15,16,"FW.MSG_FW_EDITION.SSH_PASS")),m("showPassword",e.displaySSH)("promptLabel",y(16,18,"GLOBALS.MSG_PASSWORD.PASS"))("weakLabel",y(17,20,"GLOBALS.MSG_PASSWORD.WEAK"))("mediumLabel",y(18,22,"GLOBALS.MSG_PASSWORD.NORMAL"))("strongLabel",y(19,24,"GLOBALS.MSG_PASSWORD.SAFE"))}}function Ic(r,u){if(r&1){let e=L();c(0,"div",38)(1,"div")(2,"button",83),C(3,"translate"),C(4,"translate"),P("click",function(){h(e);let t=d(3);return w(t.onTestFwcAgentCommunicationDiscoverInterfaces())}),_(),c(5,"button",84),C(6,"translate"),C(7,"translate"),P("click",function(){h(e);let t=d(3);return w(t.showFirewallInfo())}),_()(),T(8,"div"),_()}if(r&2){let e=d(3);a(2),D("pTooltip",y(3,6,"FW.MSG_FW_EDITION.AGENT_TOOLTIP")),D("label",y(4,8,"FW.MSG_FW_EDITION.AGENT_TEST")),m("disabled",e.loadingData),a(3),D("pTooltip",y(6,10,"FW.FW_MORE_INFO.AGENT_TOOLTIP")),D("label",y(7,12,"FW.FW_MORE_INFO.MORE_INFO")),m("disabled",e.loadingData)}}function bc(r,u){if(r&1&&(c(0,"div",64)(1,"div",25)(2,"label"),T(3,"i",79),C(4,"translate"),g(5),C(6,"translate"),_(),T(7,"input",80),_()(),c(8,"div",64)(9,"div",25)(10,"label"),g(11),C(12,"translate"),_(),T(13,"input",80),_()(),c(14,"div",38)(15,"div",25)(16,"label",81),g(17),C(18,"translate"),_(),T(19,"input",82),C(20,"translate"),_()(),F(21,Ic,9,14,"div",38)),r&2){let e,i=d(2);a(3),D("pTooltip",y(4,9,"FW.MSG_FW_EDITION.TOOLTIP_NEW_INSTALL")),a(2),R(" \xA0 ",y(6,11,"FW.MSG_FW_EDITION.NEW_IF")," "),a(2),D("value",i.discoveredInstallOptions.interface==null?null:i.discoveredInstallOptions.interface.name),a(4),V(y(12,13,"FW.MSG_FW_EDITION.NEW_IP")),a(2),D("value",(i.discoveredInstallOptions.ipobj==null?null:i.discoveredInstallOptions.ipobj.address)+" ("+(i.discoveredInstallOptions.ipobj==null?null:i.discoveredInstallOptions.ipobj.name)+")"),a(4),V(y(18,15,"FW.MSG_FW_EDITION.PORT")),a(2),D("placeholder",y(20,17,"FW.MSG_FW_EDITION.PORT")),D("value",i.install_port_agent),a(2),O(((e=i.formModel.get("install_communication"))==null?null:e.value)==="agent"?21:-1)}}function Pc(r,u){if(r&1&&(c(0,"option",32),g(1),_()),r&2){let e=u.$implicit;m("ngValue",e.id),a(),vi(" ",e.id," - ",e.name," ")}}function Tc(r,u){if(r&1&&(c(0,"span"),g(1),_()),r&2){let e=d().$implicit;a(),R("(",e.address,")")}}function Oc(r,u){r&1&&(c(0,"span"),g(1),C(2,"translate"),_()),r&2&&(a(),R("(",y(2,1,"FW.MSG_FW_EDITION.NO_IP"),")"))}function Rc(r,u){if(r&1&&(c(0,"option",32),g(1),F(2,Tc,2,1,"span")(3,Oc,3,3,"span"),_()),r&2){let e=u.$implicit;m("ngValue",e.id),a(),R(" ",e.name,"\xA0 "),a(),O(e.address?2:-1),a(),O(e.address?-1:3)}}function xc(r,u){if(r&1){let e=L();c(0,"div",90)(1,"div",91)(2,"label",92),g(3,"\xA0"),_(),c(4,"div",93)(5,"button",94),C(6,"translate"),C(7,"translate"),P("click",function(){h(e);let t=d(4);return w(t.onTestFwcAgentCommunication())}),_()(),c(8,"div",95)(9,"button",96),C(10,"translate"),C(11,"translate"),P("click",function(){h(e);let t=d(4);return w(t.showFirewallInfo())}),_()()()()}if(r&2){let e=d(4);a(5),D("pTooltip",y(6,6,"FW.MSG_FW_EDITION.AGENT_TOOLTIP")),D("label",y(7,8,"FW.MSG_FW_EDITION.AGENT_TEST")),m("disabled",e.loadingData||e.formModel.get("install_protocol").invalid||e.formModel.get("install_apikey").invalid||!e.formModel.get("install_interface").value||!e.formModel.get("install_ipobj").value||e.formModel.get("install_port").invalid),a(4),D("pTooltip",y(10,10,"FW.FW_MORE_INFO.AGENT_TOOLTIP")),D("label",y(11,12,"FW.FW_MORE_INFO.MORE_INFO")),m("disabled",e.loadingData||!e.formModel.get("install_ipobj").value)}}function Fc(r,u){if(r&1){let e=L();c(0,"div",64)(1,"div")(2,"label",85),g(3),C(4,"translate"),_(),c(5,"select",86,2),P("change",function(t){h(e);let n=d(3);return w(n.onChangeInstallData(t))}),c(7,"option",35),g(8),C(9,"translate"),_(),xe(10,Pc,2,3,"option",32,Re),_()()(),c(12,"div",64)(13,"div")(14,"label",87),g(15),C(16,"translate"),_(),c(17,"select",88),P("change",function(t){h(e);let n=d(3);return w(n.onChangeInstallData(t))}),c(18,"option",35),g(19),C(20,"translate"),_(),xe(21,Rc,4,4,"option",32,Re),_()()(),c(23,"div",38)(24,"div")(25,"label",81),g(26),C(27,"translate"),_(),T(28,"input",89),_()(),F(29,xc,12,14,"div",90)}if(r&2){let e,i=d(3);a(3),V(y(4,8,"GLOBALS.MSG_OBJ_TYPES.OBJ_INTERFACE_FIREWALL")),a(4),m("value",null),a(),R(" ",y(9,10,"GLOBALS.MSG_OBJ_TYPES.OBJ_INTERFACE_FIREWALL")," "),a(2),Fe(i.interfaces),a(5),V(y(16,12,"GLOBALS.MSG_OBJ_TYPES.OBJ_ADDRESS")),a(3),m("value",null),a(),R(" ",y(20,14,"GLOBALS.MSG_OBJ_TYPES.OBJ_ADDRESS")," "),a(2),Fe(i.interfacesIpObjs),a(5),V(y(27,16,"FW.MSG_FW_EDITION.PORT")),a(3),O(((e=i.formModel.get("install_communication"))==null?null:e.value)==="agent"?29:-1)}}function Ac(r,u){r&1&&(c(0,"p"),g(1),C(2,"translate"),_()),r&2&&(a(),V(y(2,1,"FW.MSG_FW_EDITION.NO_IF")))}function Lc(r,u){if(r&1&&F(0,Fc,30,18)(1,Ac,3,3,"p"),r&2){let e=d(2);O(e.interfaces!=null&&e.interfaces.length?0:1)}}function Mc(r,u){if(r&1&&(c(0,"div",21)(1,"div",50),T(2,"sts-fwc-message",97),_()()),r&2){let e=d(2);a(2),m("message",et(1,qr,e.translate.instant("PLUGINS.TITLE"),e.translate.instant("PLUGINS.ERRORS.COMMUNICATION.TEXT")))}}function Dc(r,u){if(r&1){let e=L();c(0,"div",21)(1,"div",22)(2,"h5",23),g(3),C(4,"translate"),_()(),c(5,"div",24)(6,"div",50)(7,"div",25)(8,"p-checkbox",52),Y("ngModelChange",function(t){h(e);let n=d(2);return H(n.optionsPlugins.openvpn,t)||(n.optionsPlugins.openvpn=t),w(t)}),P("onChange",function(){h(e);let t=d(2);return w(t.onChangePlugins())}),_(),g(9," \xA0\xA0 "),c(10,"a",98),ie(),c(11,"svg",54),T(12,"use",99),_()(),ne(),c(13,"p",45),g(14),C(15,"translate"),_()()(),c(16,"div",50)(17,"div",25)(18,"p-checkbox",52),Y("ngModelChange",function(t){h(e);let n=d(2);return H(n.optionsPlugins.wireguard,t)||(n.optionsPlugins.wireguard=t),w(t)}),P("onChange",function(){h(e);let t=d(2);return w(t.onChangePlugins())}),_(),g(19," \xA0\xA0 "),c(20,"a",100),ie(),c(21,"svg",54),T(22,"use",101),_()(),ne(),c(23,"p",45),g(24),C(25,"translate"),_()()(),c(26,"div",50)(27,"div",25)(28,"p-checkbox",52),Y("ngModelChange",function(t){h(e);let n=d(2);return H(n.optionsPlugins.ipsec,t)||(n.optionsPlugins.ipsec=t),w(t)}),P("onChange",function(){h(e);let t=d(2);return w(t.onChangePlugins())}),_(),g(29," \xA0\xA0 "),c(30,"a",102),ie(),c(31,"svg",54),T(32,"use",103),_()(),ne(),c(33,"p",45),g(34),C(35,"translate"),_()()(),c(36,"div",50)(37,"div",25)(38,"p-checkbox",52),Y("ngModelChange",function(t){h(e);let n=d(2);return H(n.optionsPlugins.keepalived,t)||(n.optionsPlugins.keepalived=t),w(t)}),P("onChange",function(){h(e);let t=d(2);return w(t.onChangePlugins())}),_(),g(39," \xA0\xA0 "),c(40,"a",104),ie(),c(41,"svg",54),T(42,"use",105),_()(),ne(),c(43,"p",45),g(44),C(45,"translate"),_()()(),c(46,"div",50)(47,"div",25)(48,"p-checkbox",52),Y("ngModelChange",function(t){h(e);let n=d(2);return H(n.optionsPlugins.geoip,t)||(n.optionsPlugins.geoip=t),w(t)}),P("onChange",function(){h(e);let t=d(2);return w(t.onChangePlugins())}),_(),g(49," \xA0\xA0 "),c(50,"a",106),ie(),c(51,"svg",54),T(52,"use",107),_()(),ne(),c(53,"p",45),g(54),C(55,"translate"),_()()(),c(56,"div",50)(57,"div",25)(58,"p-checkbox",52),Y("ngModelChange",function(t){h(e);let n=d(2);return H(n.optionsPlugins.crowdsec,t)||(n.optionsPlugins.crowdsec=t),w(t)}),P("onChange",function(){h(e);let t=d(2);return w(t.onChangePlugins())}),_(),g(59," \xA0\xA0 "),c(60,"a",57),ie(),c(61,"svg",54),T(62,"use",58),_()(),ne(),c(63,"p",45),g(64),C(65,"translate"),_()()(),c(66,"div",50)(67,"div",25)(68,"p-checkbox",52),Y("ngModelChange",function(t){h(e);let n=d(2);return H(n.optionsPlugins.ntopng,t)||(n.optionsPlugins.ntopng=t),w(t)}),P("onChange",function(){h(e);let t=d(2);return w(t.onChangePlugins())}),_(),g(69," \xA0\xA0 "),c(70,"a",108),ie(),c(71,"svg",54),T(72,"use",109),_()(),ne(),c(73,"p",45),g(74),C(75,"translate"),_()()(),c(76,"div",50)(77,"div",25)(78,"p-checkbox",52),Y("ngModelChange",function(t){h(e);let n=d(2);return H(n.optionsPlugins.websafety,t)||(n.optionsPlugins.websafety=t),w(t)}),P("onChange",function(){h(e);let t=d(2);return w(t.onChangePlugins())}),_(),g(79," \xA0\xA0 "),c(80,"a",110),ie(),c(81,"svg",54),T(82,"use",111),_()(),ne(),c(83,"p",45),g(84),C(85,"translate"),_()()(),c(86,"div",50)(87,"div",25)(88,"p-checkbox",52),Y("ngModelChange",function(t){h(e);let n=d(2);return H(n.optionsPlugins.dnssafety,t)||(n.optionsPlugins.dnssafety=t),w(t)}),P("onChange",function(){h(e);let t=d(2);return w(t.onChangePlugins())}),_(),g(89," \xA0\xA0 "),c(90,"a",112),ie(),c(91,"svg",54),T(92,"use",113),_()(),ne(),c(93,"p",45),g(94),C(95,"translate"),_()()()(),c(96,"div",24)(97,"div",50)(98,"div",25)(99,"p-checkbox",52),Y("ngModelChange",function(t){h(e);let n=d(2);return H(n.optionsPlugins.suricata,t)||(n.optionsPlugins.suricata=t),w(t)}),P("onChange",function(){h(e);let t=d(2);return w(t.onChangePlugins())}),_(),g(100," \xA0\xA0 "),c(101,"a",114),ie(),c(102,"svg",54),T(103,"use",115),_()(),ne(),c(104,"p",45),g(105),C(106,"translate"),_()()(),c(107,"div",50)(108,"div",25)(109,"p-checkbox",52),Y("ngModelChange",function(t){h(e);let n=d(2);return H(n.optionsPlugins.zeek,t)||(n.optionsPlugins.zeek=t),w(t)}),P("onChange",function(){h(e);let t=d(2);return w(t.onChangePlugins())}),_(),g(110," \xA0\xA0 "),c(111,"a",116),ie(),c(112,"svg",54),T(113,"use",117),_()(),ne(),c(114,"p",45),g(115),C(116,"translate"),_()()(),c(117,"div",50)(118,"div",25)(119,"p-checkbox",52),Y("ngModelChange",function(t){h(e);let n=d(2);return H(n.optionsPlugins.elasticsearch,t)||(n.optionsPlugins.elasticsearch=t),w(t)}),P("onChange",function(){h(e);let t=d(2);return w(t.onChangePlugins())}),_(),g(120," \xA0\xA0 "),c(121,"a",118),ie(),c(122,"svg",54),T(123,"use",119),_()(),ne(),c(124,"p",45),g(125),C(126,"translate"),_()()(),c(127,"div",50)(128,"div",25)(129,"p-checkbox",52),Y("ngModelChange",function(t){h(e);let n=d(2);return H(n.optionsPlugins.kibana,t)||(n.optionsPlugins.kibana=t),w(t)}),P("onChange",function(){h(e);let t=d(2);return w(t.onChangePlugins())}),_(),g(130," \xA0\xA0 "),c(131,"a",120),ie(),c(132,"svg",54),T(133,"use",121),_()(),ne(),c(134,"p",45),g(135),C(136,"translate"),_()()(),c(137,"div",50)(138,"div",25)(139,"p-checkbox",52),Y("ngModelChange",function(t){h(e);let n=d(2);return H(n.optionsPlugins.logstash,t)||(n.optionsPlugins.logstash=t),w(t)}),P("onChange",function(){h(e);let t=d(2);return w(t.onChangePlugins())}),_(),g(140," \xA0\xA0 "),c(141,"a",122),ie(),c(142,"svg",54),T(143,"use",123),_()(),ne(),c(144,"p",45),g(145),C(146,"translate"),_()()(),c(147,"div",50)(148,"div",25)(149,"p-checkbox",52),Y("ngModelChange",function(t){h(e);let n=d(2);return H(n.optionsPlugins.filebeat,t)||(n.optionsPlugins.filebeat=t),w(t)}),P("onChange",function(){h(e);let t=d(2);return w(t.onChangePlugins())}),_(),g(150," \xA0\xA0 "),c(151,"a",124),ie(),c(152,"svg",54),T(153,"use",125),_()(),ne(),c(154,"p",45),g(155),C(156,"translate"),_()()(),c(157,"div",50)(158,"div",25)(159,"p-checkbox",52),Y("ngModelChange",function(t){h(e);let n=d(2);return H(n.optionsPlugins.iscdhcp,t)||(n.optionsPlugins.iscdhcp=t),w(t)}),P("onChange",function(){h(e);let t=d(2);return w(t.onChangePlugins())}),_(),g(160," \xA0\xA0 "),c(161,"a",126),ie(),c(162,"svg",54),T(163,"use",127),_()(),ne(),c(164,"p",45),g(165),C(166,"translate"),_()()(),c(167,"div",50)(168,"div",25)(169,"p-checkbox",52),Y("ngModelChange",function(t){h(e);let n=d(2);return H(n.optionsPlugins.haproxy,t)||(n.optionsPlugins.haproxy=t),w(t)}),P("onChange",function(){h(e);let t=d(2);return w(t.onChangePlugins())}),_(),g(170," \xA0\xA0 "),c(171,"a",128),ie(),c(172,"svg",54),T(173,"use",129),_()(),ne(),c(174,"p",45),g(175),C(176,"translate"),_()()(),c(177,"div",50)(178,"div",25)(179,"p-checkbox",52),Y("ngModelChange",function(t){h(e);let n=d(2);return H(n.optionsPlugins.iscbind9,t)||(n.optionsPlugins.iscbind9=t),w(t)}),P("onChange",function(){h(e);let t=d(2);return w(t.onChangePlugins())}),_(),g(180," \xA0\xA0 "),c(181,"a",130),ie(),c(182,"svg",54),T(183,"use",131),_()(),ne(),c(184,"p",45),g(185),C(186,"translate"),_()()()()()}if(r&2){let e=d(2);a(3),R(" ",y(4,73,"FW.MSG_FW_EDITION.PLUGINS")," "),a(5),m("binary",!0),W("ngModel",e.optionsPlugins.openvpn),m("ngModelOptions",B(111,ye)),a(6),R("\xA0\xA0",y(15,75,"FW.PLUGINS.OPENVPN"),""),a(4),m("binary",!0),W("ngModel",e.optionsPlugins.wireguard),m("ngModelOptions",B(112,ye)),a(6),R("\xA0\xA0",y(25,77,"FW.PLUGINS.WIREGUARD"),""),a(4),m("binary",!0),W("ngModel",e.optionsPlugins.ipsec),m("ngModelOptions",B(113,ye)),a(6),R("\xA0\xA0",y(35,79,"FW.PLUGINS.IPSEC"),""),a(4),m("binary",!0),W("ngModel",e.optionsPlugins.keepalived),m("ngModelOptions",B(114,ye)),a(6),R("\xA0\xA0",y(45,81,"FW.PLUGINS.KEEPALIVED"),""),a(4),m("binary",!0),W("ngModel",e.optionsPlugins.geoip),m("ngModelOptions",B(115,ye)),a(6),R("\xA0\xA0",y(55,83,"FW.PLUGINS.GEOIP"),""),a(4),m("binary",!0),W("ngModel",e.optionsPlugins.crowdsec),m("ngModelOptions",B(116,ye)),a(6),R("\xA0\xA0",y(65,85,"FW.PLUGINS.CROWDSEC"),""),a(4),m("binary",!0),W("ngModel",e.optionsPlugins.ntopng),m("ngModelOptions",B(117,ye)),a(6),R("\xA0\xA0",y(75,87,"FW.PLUGINS.NTOPNG"),""),a(4),m("binary",!0),W("ngModel",e.optionsPlugins.websafety),m("ngModelOptions",B(118,ye)),a(6),R("\xA0\xA0",y(85,89,"FW.PLUGINS.WEBSAFETY"),""),a(4),m("binary",!0),W("ngModel",e.optionsPlugins.dnssafety),m("ngModelOptions",B(119,ye)),a(6),R("\xA0\xA0",y(95,91,"CLUSTER.PLUGINS.DNSSAFETY"),""),a(5),m("binary",!0),W("ngModel",e.optionsPlugins.suricata),m("ngModelOptions",B(120,ye)),a(6),R("\xA0\xA0",y(106,93,"FW.PLUGINS.SURICATA"),""),a(4),m("binary",!0),W("ngModel",e.optionsPlugins.zeek),m("ngModelOptions",B(121,ye)),a(6),R("\xA0\xA0",y(116,95,"FW.PLUGINS.ZEEK"),""),a(4),m("binary",!0),W("ngModel",e.optionsPlugins.elasticsearch),m("ngModelOptions",B(122,ye)),a(6),R("\xA0\xA0",y(126,97,"CLUSTER.PLUGINS.ELASTICSEARCH"),""),a(4),m("binary",!0),W("ngModel",e.optionsPlugins.kibana),m("ngModelOptions",B(123,ye)),a(6),R("\xA0\xA0",y(136,99,"CLUSTER.PLUGINS.KIBANA"),""),a(4),m("binary",!0),W("ngModel",e.optionsPlugins.logstash),m("ngModelOptions",B(124,ye)),a(6),R("\xA0\xA0",y(146,101,"CLUSTER.PLUGINS.LOGSTASH"),""),a(4),m("binary",!0),W("ngModel",e.optionsPlugins.filebeat),m("ngModelOptions",B(125,ye)),a(6),R("\xA0\xA0",y(156,103,"FW.PLUGINS.FILEBEAT"),""),a(4),m("binary",!0),W("ngModel",e.optionsPlugins.iscdhcp),m("ngModelOptions",B(126,ye)),a(6),R("\xA0\xA0",y(166,105,"FW.PLUGINS.ISCDHCP"),""),a(4),m("binary",!0),W("ngModel",e.optionsPlugins.haproxy),m("ngModelOptions",B(127,ye)),a(6),R("\xA0\xA0",y(176,107,"FW.PLUGINS.HAPROXY"),""),a(4),m("binary",!0),W("ngModel",e.optionsPlugins.iscbind9),m("ngModelOptions",B(128,ye)),a(6),R("\xA0\xA0",y(186,109,"FW.PLUGINS.ISCBIND9"),"")}}function Nc(r,u){if(r&1&&(c(0,"div",21)(1,"div",50),T(2,"sts-fwc-message",97),_()()),r&2){let e=d(2);a(2),m("message",et(1,qr,e.translate.instant("NGFW.TITLE"),e.translate.instant("NGFW.ERRORS.COMMUNICATION.TEXT")))}}function Gc(r,u){if(r&1){let e=L();c(0,"div",21)(1,"div",29)(2,"label",132)(3,"a",108),ie(),c(4,"svg",54),T(5,"use",109),_()(),g(6),C(7,"translate"),_(),ne(),c(8,"button",133),C(9,"translate"),C(10,"translate"),P("click",function(){h(e);let t=d(3);return w(t.onClickButtonNGFW("NTOPNG"))}),_()(),c(11,"div",29)(12,"label",134)(13,"a",110),ie(),c(14,"svg",54),T(15,"use",111),_()(),g(16),C(17,"translate"),_(),ne(),c(18,"button",133),C(19,"translate"),C(20,"translate"),P("click",function(){h(e);let t=d(3);return w(t.onClickButtonNGFW("WEBSAFETYPROXY"))}),_()(),c(21,"div",29)(22,"label",135)(23,"a",112),ie(),c(24,"svg",54),T(25,"use",113),_()(),g(26),C(27,"translate"),_(),ne(),c(28,"button",133),C(29,"translate"),C(30,"translate"),P("click",function(){h(e);let t=d(3);return w(t.onClickButtonNGFW("DNSSAFETY"))}),_()(),c(31,"div",29)(32,"label",136)(33,"a",118),ie(),c(34,"svg",54),T(35,"use",119),_()(),g(36),C(37,"translate"),_(),ne(),c(38,"button",133),C(39,"translate"),C(40,"translate"),P("click",function(){h(e);let t=d(3);return w(t.onClickButtonNGFW("ELASTICSEARCH"))}),_()()()}if(r&2){let e=d(3);a(6),R(" ",y(7,16,"CONTEXT.FW.NTOPNG"),""),a(2),D("pTooltip",y(9,18,"CONTEXT.FW.NTOPNG")),D("label",y(10,20,"CONTEXT.FW.NTOPNG")),m("disabled",!e.checksNtopNGConfig()),a(8),R(" ",y(17,22,"CONTEXT.FW.WEBSAFETYPROXY"),""),a(2),D("pTooltip",y(19,24,"CONTEXT.FW.WEBSAFETYPROXY")),D("label",y(20,26,"CONTEXT.FW.WEBSAFETYPROXY")),m("disabled",!e.checksWebSafetyProxyActie()),a(8),R(" ",y(27,28,"CONTEXT.FW.DNSSAFETY"),""),a(2),D("pTooltip",y(29,30,"CONTEXT.FW.DNSSAFETY")),D("label",y(30,32,"CONTEXT.FW.DNSSAFETY")),m("disabled",!e.checksDNSSafetyActive()),a(8),R(" ",y(37,34,"CLUSTER.PLUGINS.ELASTICSEARCH"),""),a(2),D("pTooltip",y(39,36,"CLUSTER.PLUGINS.ELASTICSEARCH")),D("label",y(40,38,"CLUSTER.PLUGINS.ELASTICSEARCH")),m("disabled",!e.checksElasticSearchActive())}}function Uc(r,u){if(r&1&&(c(0,"div",21)(1,"div",22)(2,"h5",23),g(3),C(4,"translate"),_()(),g(5," \xA0 "),F(6,Gc,41,40,"div",21),_()),r&2){let e,i=d(2);a(3),R(" ",y(4,2,"NGFW.DESCRIPTION")," "),a(3),O(((e=i.formModel.get("install_communication"))==null?null:e.value)==="agent"?6:-1)}}function Bc(r,u){if(r&1){let e=L();c(0,"form",17),P("keyup.enter",function(t){h(e);let n=d();return w(n.checkForm(t))})("keyup.esc",function(){h(e);let t=d();return w(t.onCancel())}),c(1,"fieldset",18)(2,"p-tabView",19),P("onChange",function(t){h(e);let n=d();return w(n.onChangeTab(t))}),c(3,"p-tabPanel",20),C(4,"translate"),c(5,"div",21)(6,"div",22)(7,"h5",23),g(8),C(9,"translate"),_()(),c(10,"div",24)(11,"div",25)(12,"label",26),g(13),C(14,"translate"),_(),T(15,"input",27,1),C(17,"translate"),_(),c(18,"p",28),g(19),C(20,"translate"),_()(),c(21,"div",29)(22,"div",25)(23,"label",30),g(24),C(25,"translate"),_(),c(26,"select",31,2),P("change",function(){h(e);let t=d();return w(t.changeCompilerOptions())}),xe(28,Cc,2,2,"option",32,Re),_()()(),c(30,"div",29)(31,"div",25)(32,"label",33),g(33),C(34,"translate"),_(),c(35,"select",34),P("change",function(t){h(e);let n=d();return w(n.handleFirewallManagementChange(t))}),c(36,"option",35),g(37),C(38,"translate"),_(),c(39,"option",36),g(40,"SSH"),_(),c(41,"option",37),g(42,"FWCloud-Agent"),_()()()(),c(43,"div",38)(44,"div",25)(45,"label",39),g(46),C(47,"translate"),_()()(),c(48,"div",40),T(49,"textarea",41),_()(),c(50,"div",21)(51,"div",22)(52,"h5",42),g(53),C(54,"translate"),C(55,"translate"),_()(),F(56,yc,21,15)(57,vc,21,26),c(58,"div",43)(59,"button",44),C(60,"translate"),P("click",function(){h(e);let t=d();return w(t.onDiscoverInterfaces())}),_()()(),c(61,"div",21)(62,"div",22)(63,"h5",45),g(64),C(65,"translate"),_()(),F(66,bc,22,19)(67,Lc,2,1),_()(),c(68,"p-tabPanel",46),C(69,"translate"),c(70,"sts-fwc-interfaces-tree-editor",47,3),P("onInstallModified",function(t){h(e);let n=d();return w(n.onEditorInstallModified(t))})("onIpObjectModified",function(t){h(e);let n=d();return w(n.onEditorInterfaceOrIpModified(t))})("onStartAutodiscover",function(){h(e);let t=d();return w(t.onDiscoverInterfaces(!0))}),_()(),c(72,"p-tabPanel",48),C(73,"translate"),T(74,"input",49),c(75,"div",21)(76,"div",22)(77,"h5",23),g(78),C(79,"translate"),_()(),c(80,"div",24)(81,"div",50)(82,"div",25)(83,"p-checkbox",51),Y("ngModelChange",function(t){h(e);let n=d();return H(n.optionsFlags.stateful,t)||(n.optionsFlags.stateful=t),w(t)}),P("onChange",function(){h(e);let t=d();return w(t.onChangeOptionsFlags())}),_()()(),c(84,"div",50)(85,"div",25)(86,"p-checkbox",51),Y("ngModelChange",function(t){h(e);let n=d();return H(n.optionsFlags.ipv4,t)||(n.optionsFlags.ipv4=t),w(t)}),P("onChange",function(){h(e);let t=d();return w(t.onChangeOptionsFlags())}),_()()(),c(87,"div",50)(88,"div",25)(89,"p-checkbox",51),Y("ngModelChange",function(t){h(e);let n=d();return H(n.optionsFlags.ipv6,t)||(n.optionsFlags.ipv6=t),w(t)}),P("onChange",function(){h(e);let t=d();return w(t.onChangeOptionsFlags())}),_()()(),c(90,"div",50)(91,"div",25)(92,"p-checkbox",51),Y("ngModelChange",function(t){h(e);let n=d();return H(n.optionsFlags.debug,t)||(n.optionsFlags.debug=t),w(t)}),P("onChange",function(){h(e);let t=d();return w(t.onChangeOptionsFlags())}),_()()(),c(93,"div",50)(94,"div",25)(95,"p-checkbox",51),Y("ngModelChange",function(t){h(e);let n=d();return H(n.optionsFlags.report,t)||(n.optionsFlags.report=t),w(t)}),P("onChange",function(){h(e);let t=d();return w(t.onChangeOptionsFlags())}),_()()()(),c(96,"div",24)(97,"div",50)(98,"div",25)(99,"p-checkbox",52),Y("ngModelChange",function(t){h(e);let n=d();return H(n.optionsFlags.docker,t)||(n.optionsFlags.docker=t),w(t)}),P("onChange",function(){h(e);let t=d();return w(t.onChangeOptionsFlags())}),_(),g(100," \xA0\xA0 "),c(101,"a",53),ie(),c(102,"svg",54),T(103,"use",55),_()(),ne(),c(104,"p",45),g(105),C(106,"translate"),_(),c(107,"a",56),g(108,"(+ info)"),_()()(),c(109,"div",50)(110,"div",25)(111,"p-checkbox",52),Y("ngModelChange",function(t){h(e);let n=d();return H(n.optionsFlags.crowdsec,t)||(n.optionsFlags.crowdsec=t),w(t)}),P("onChange",function(){h(e);let t=d();return w(t.onChangeOptionsFlags())}),_(),g(112," \xA0\xA0 "),c(113,"a",57),ie(),c(114,"svg",54),T(115,"use",58),_()(),ne(),c(116,"p",45),g(117),C(118,"translate"),_()()(),c(119,"div",50)(120,"div",25)(121,"p-checkbox",52),Y("ngModelChange",function(t){h(e);let n=d();return H(n.optionsFlags.fail2ban,t)||(n.optionsFlags.fail2ban=t),w(t)}),P("onChange",function(){h(e);let t=d();return w(t.onChangeOptionsFlags())}),_(),g(122," \xA0\xA0 "),c(123,"a",59),ie(),c(124,"svg",54),T(125,"use",60),_()(),ne(),c(126,"p",45),g(127),C(128,"translate"),_()()()()()(),c(129,"p-tabPanel",61),C(130,"translate"),T(131,"input",62),F(132,Mc,3,4,"div",21)(133,Dc,187,129,"div",21),_(),c(134,"p-tabPanel",63),C(135,"translate"),F(136,Nc,3,4,"div",21)(137,Uc,7,4,"div",21),_()()()()}if(r&2){let e,i,t,n,o,l,p,s,f=d();m("formGroup",f.formModel),a(),m("disabled",f.loadingData),a(),m("activeIndex",f.shownPanel),a(),D("header",y(4,71,"FW.MSG_FW_TAB.FT_0")),m("disabled",f.loadingData),a(5),R(" ",y(9,73,"FW.MSG_FW_EDITION.BASIC_DATA")," "),a(5),V(y(14,75,"FW.MSG_FW_EDITION.NAME")),a(2),D("placeholder",y(17,77,"FW.MSG_FW_EDITION.NAME")),a(3),m("ngStyle",Ie(113,zr,f.formModel.get("name").valid||f.formModel.get("name").pristine?"hidden":"visible")),a(),R(" ",y(20,79,"ITEM_PANEL.ERRORS.FIELD_INVALID_NAME")," "),a(5),V(y(25,81,"FW.MSG_FW_EDITION.COMPILER")),a(4),Fe(f.FirewallCompilerOptions),a(5),V(y(34,83,"FW.MSG_FW_EDITION.COMM_TYPE")),a(3),m("value",null),a(),R(" ",y(38,85,"FW.MSG_FW_EDITION.COMM_TYPE")," "),a(2),m("disabled",f.isSSHCommunicationDisabled),a(7),V(y(47,87,"FW.MSG_FW_EDITION.DESC")),a(3),m("rows",3)("cols",30),a(4),R(" ",((e=f.formModel.get("install_communication"))==null?null:e.value)==="agent"?y(54,89,"FW.MSG_FW_EDITION.AGENT_DATA"):y(55,91,"FW.MSG_FW_EDITION.SSH")," "),a(3),O(((i=f.formModel.get("install_communication"))==null?null:i.value)==="agent"?56:57),a(3),D("label",y(60,93,"FW.MSG_FW_EDITION.DISCOVER_IF")),m("disabled",f.loadingData),a(5),R(" ",y(65,95,"FW.MSG_FW_EDITION.INSTALL")," "),a(2),O(f.discoveredInstallOptions?66:67),a(2),D("header",y(69,97,"FW.MSG_FW_TAB.FT_1")),m("disabled",f.loadingData),a(2),m("options",f.interfacesEditorOptions),a(2),D("header",y(73,99,"FW.MSG_FW_TAB.FT_2")),m("disabled",f.loadingData),a(6),R(" ",y(79,101,"FW.MSG_FW_EDITION.OPTIONS_DATA")," "),a(5),m("binary",!0),W("ngModel",f.optionsFlags.stateful),m("ngModelOptions",B(115,ye))("label",f.translate.instant("FW.OPTION_NAMES.stateful")),a(3),m("binary",!0),W("ngModel",f.optionsFlags.ipv4),m("ngModelOptions",B(116,ye))("label",f.translate.instant("FW.OPTION_NAMES.ipv4")),a(3),m("binary",!0),W("ngModel",f.optionsFlags.ipv6),m("ngModelOptions",B(117,ye))("label",f.translate.instant("FW.OPTION_NAMES.ipv6")),a(3),m("binary",!0),W("ngModel",f.optionsFlags.debug),m("ngModelOptions",B(118,ye))("label",f.translate.instant("FW.OPTION_NAMES.debug")),a(3),m("binary",!0),W("ngModel",f.optionsFlags.report),m("ngModelOptions",B(119,ye))("label",f.translate.instant("FW.OPTION_NAMES.report")),a(4),m("binary",!0),W("ngModel",f.optionsFlags.docker),m("ngModelOptions",B(120,ye)),a(6),R("\xA0\xA0",y(106,103,"FW.OPTION_NAMES.docker"),""),a(2),D("href",f.dockerDocURL,ui),a(4),m("binary",!0),W("ngModel",f.optionsFlags.crowdsec),m("ngModelOptions",B(121,ye)),a(6),R("\xA0\xA0",y(118,105,"FW.OPTION_NAMES.crowdsec"),""),a(4),m("binary",!0),W("ngModel",f.optionsFlags.fail2ban),m("ngModelOptions",B(122,ye)),a(6),R("\xA0\xA0",y(128,107,"FW.OPTION_NAMES.fail2ban"),""),a(2),D("header",y(130,109,"FW.MSG_FW_EDITION.PLUGINS")),m("disabled",f.loadingData||((t=f.formModel.get("install_communication"))==null?null:t.value)!=="agent"),a(3),O(((n=f.formModel.get("install_communication"))==null?null:n.value)!=="agent"?132:-1),a(),O(((o=f.formModel.get("install_communication"))==null?null:o.value)==="agent"?133:-1),a(),D("header",y(135,111,"NGFW.TITLE")),m("disabled",f.loadingData||((l=f.formModel.get("install_communication"))==null?null:l.value)!=="agent"),a(2),O(((p=f.formModel.get("install_communication"))==null?null:p.value)!=="agent"?136:-1),a(),O(((s=f.formModel.get("install_communication"))==null?null:s.value)==="agent"?137:-1)}}function kc(r,u){if(r&1&&(c(0,"div",137),T(1,"sts-fwc-message",97),_()),r&2){let e=d(2);a(),m("message",e.delMessage)}}function jc(r,u){if(r&1){let e=L();c(0,"div",138),T(1,"sts-fwc-message",97),c(2,"sts-fwc-object-restrictions",139),P("onHideParent",function(){h(e);let t=d(3);return w(t.minimizeDialog(!0))})("onRefreshRestrictions",function(){h(e);let t=d(3);return w(t.reloadPanel())}),_()()}if(r&2){let e=d(3);a(),m("message",e.deleteMsgError),a(),m("dependencies",e.dependencies)}}function Vc(r,u){if(r&1&&F(0,jc,3,2,"div",138),r&2){let e=d(2);O(e.dependencies.restrictionsError?-1:0)}}function Wc(r,u){if(r&1){let e=L();c(0,"div",137)(1,"p-checkbox",140),C(2,"translate"),Y("ngModelChange",function(t){h(e);let n=d(3);return H(n.okToDelete,t)||(n.okToDelete=t),w(t)}),_()()}if(r&2){let e=d(3);a(),D("label",y(2,2,"FW.MSG_FW_DELETE.DEL_5")),W("ngModel",e.okToDelete)}}function Hc(r,u){if(r&1&&(T(0,"sts-fwc-message",97),F(1,Wc,3,4,"div",137)),r&2){let e=d(2);m("message",e.deleteMsgError),a(),O(e.loadingData?-1:1)}}function Yc(r,u){if(r&1&&F(0,kc,2,1,"div",137)(1,Vc,1,1)(2,Hc,2,2),r&2){let e=d();O(e.loadingData&&!e.deleteMsgError?0:-1),a(),O(e.dependencies?1:2)}}function Jc(r,u){if(r&1&&(c(0,"div",141),T(1,"p-progressSpinner"),_()),r&2){let e=d(3);m("ngStyle",Ie(3,zr,e.loadingData?"visible":"hidden")),a(),Ve(B(5,pc))}}function Kc(r,u){if(r&1){let e=L();c(0,"button",146),C(1,"translate"),P("click",function(){h(e);let t=d(3);return w(t.onCloseDialog())}),_()}r&2&&D("label",y(1,1,"GLOBALS.MSG_BUTTONS.STOP"))}function Xc(r,u){if(r&1){let e=L();c(0,"button",147),C(1,"translate"),P("click",function(){h(e);let t=d(3);return w(t.onCancel())}),_()}if(r&2){let e=d(3);D("label",y(1,2,"GLOBALS.MSG_BUTTONS.CANCEL")),m("disabled",e.loadingData)}}function zc(r,u){if(r&1){let e=L();c(0,"button",148),C(1,"translate"),P("click",function(){h(e);let t=d(3);return w(t.onSave())}),_()}if(r&2){let e=d(3);D("label",y(1,2,"GLOBALS.MSG_BUTTONS.SAVE")),m("disabled",!e.formModel.valid||e.loadingData)}}function qc(r,u){if(r&1){let e=L();c(0,"button",149),C(1,"translate"),P("click",function(){h(e);let t=d(3);return w(t.onCancel())}),_()}if(r&2){let e=d(3);D("label",y(1,2,"GLOBALS.MSG_BUTTONS.CLOSE")),m("disabled",e.loadingData)}}function Qc(r,u){if(r&1&&F(0,Jc,2,6,"div",141)(1,Kc,2,3,"button",142)(2,Xc,2,4,"button",143)(3,zc,2,4,"button",144)(4,qc,2,4,"button",145),r&2){let e=d(2);O(e.loadingCommunication?0:-1),a(),O(e.loadingCommunication?1:-1),a(),O(!e.formModel.pristine&&!e.loadingCommunication?2:-1),a(),O(e.formModel.pristine?-1:3),a(),O(e.formModel.pristine?4:-1)}}function $c(r,u){if(r&1){let e=L();c(0,"button",152),C(1,"translate"),P("click",function(){h(e);let t=d(3);return w(t.reloadPanel())}),_()}if(r&2){let e=d(3);D("label",y(1,2,"POLICY_GRID.RELOAD")),m("disabled",e.loadingData)}}function Zc(r,u){if(r&1){let e=L();F(0,$c,2,4,"button",150),c(1,"button",151),C(2,"translate"),P("click",function(){h(e);let t=d(2);return w(t.onDeleteFirewall())}),_(),c(3,"button",149),C(4,"translate"),P("click",function(){h(e);let t=d(2);return w(t.onCancel())}),_()}if(r&2){let e=d(2);O(e.dependencies?0:-1),a(),D("label",y(2,5,"FW.MSG_FW_EDITION.DELETE")),m("disabled",!e.okToDelete||e.loadingData),a(2),D("label",y(4,7,"GLOBALS.MSG_BUTTONS.CANCEL")),m("disabled",e.loadingData)}}function ep(r,u){if(r&1&&F(0,Qc,5,5)(1,Zc,5,9),r&2){let e=d();O(e.firewall?0:-1),a(),O(e.firewallToDelete?1:-1)}}var Ot=function(r){return r.stateful="stateful",r.ipv4="ipv4",r.ipv6="ipv6",r.debug="debug",r.report="report",r.docker="docker",r.crowdsec="crowdsec",r.fail2ban="fail2ban",r}(Ot||{}),Xe=function(r){return r.openvpn="openvpn",r.wireguard="wireguard",r.ipsec="ipsec",r.geoip="geoip",r.crowdsec="crowdsec",r.ntopng="ntopng",r.suricata="suricata",r.keepalived="keepalived",r.zeek="zeek",r.elasticsearch="elasticsearch",r.filebeat="filebeat",r.websafety="websafety",r.kibana="kibana",r.logstash="logstash",r.dnssafety="dnssafety",r.iscbind9="iscbind9",r.iscdhcp="iscdhcp",r.haproxy="haproxy",r}(Xe||{}),Yr=new Map([[Ot.stateful,0],[Ot.ipv4,1],[Ot.ipv6,2],[Ot.debug,3],[Ot.report,4],[Ot.docker,5],[Ot.crowdsec,6],[Ot.fail2ban,7]]),Ke=new Map([["openvpn",1],["geoip",2],["crowdsec",4],["ntopng",8],["suricata",16],["keepalived",32],["zeek",64],["elasticsearch",128],["filebeat",256],["websafety",512],["kibana",1024],["logstash",2048],["dnssafety",4096],["iscbind9",8192],["iscdhcp",16384],["haproxy",32768],["wireguard",65536],["ipsec",131072]]),Qr=(()=>{class r extends Bt{userAndPassValidator(e){let i=this,t=i.controls.install_user.value,n=i.controls.install_pass.value;return(!t||!t.length)&&n&&n.length?{userandpass:!0}:null}constructor(e,i,t,n,o,l,p,s,f,S,E,I,b,x,J,U,M){super(S,l,i,J,U,M),this.fwcUserService=e,this.itemSelectedService=i,this.fwcFirewallService=t,this.fwcInterfaceService=n,this.confirmationService=o,this.appOptionsService=l,this.fwcPolicyService=p,this.fwcEventService=s,this.fwcErrorPipe=f,this.appDialogPanelsService=S,this.messageService=E,this.translate=I,this.utilService=b,this.inputDataService=x,this.cd=J,this.store=U,this.router=M,this.firewall=null,this.firewallToDelete=null,this.interfaces=[],this.interfacesIpObjs=[],this.displaySSH=!1,this.loadingData=!1,this.loadingCommunication=!1,this.dependencies=null,this.okToDelete=!1,this.alive=!0,this.displayApiKey=!1,this.isSSHCommunicationDisabled=!1,this.FirewallCompilerOptions=ti,this.optionsFlags={stateful:!1,ipv4:!1,ipv6:!1,debug:!1,report:!1,docker:!1,crowdsec:!1,fail2ban:!1},this.optionsPlugins={openvpn:!1,wireguard:!1,ipsec:!1,geoip:!1,crowdsec:!1,ntopng:!1,suricata:!1,keepalived:!1,zeek:!1,elasticsearch:!1,filebeat:!1,websafety:!1,kibana:!1,logstash:!1,dnssafety:!1,iscbind9:!1,iscdhcp:!1,haproxy:!1},this.createDialog(this.translate.instant("FW.PANEL_TITLE"),"fwci-firewalls",q.FIREWALL_PANEL),this.helpSection="/firewalls",this.resetForm()}ngOnInit(){this.dockerDocURL=`https://fwcloud.net/${this.translate.currentLang!=="es"?this.translate.currentLang+"/":""}documentation/fwcloud-docker`,this.deleteMsgError=null,this.store.pipe(ee(()=>this.alive),ni(Ui.selectDialogUuidsToReload)).subscribe(e=>{e&&e.find(i=>i===this.dialogUUID)&&this.reloadPanel()}),this.checkSSHCommunicationConfig(),this.itemSelectedService.getItem().pipe(ee(()=>this.alive)).subscribe(e=>{e._fwcObjType==v.OBJ_FIREWALL&&(this.itemSelectedService.hideObjectPanel(),e.deleteAction?(this.showDialog(),this.checkFirewallRestrictions(e)):(this.resetForm(),e.id_obj!==null&&e.id_obj!=null?Promise.all([this.getClusterNodes(e._fwcClusterId,e.id_obj)]).then(([i])=>{let t=this.getMasterFirewall(i);t||(t=e.id_obj),Promise.all([this.getFirewall(e.id_obj),this.getFirewallInterfaces(t)]).then(l=>te(this,[l],function*([n,o]){this.firewall=n.data;let p=this.fwcUserService.getActualFwcUser().privateKey;try{this.firewall.install_user&&(this.firewall.install_user=yield this.utilService.openPGPDecrypt(this.firewall.install_user,p)),this.firewall.install_pass&&(this.firewall.install_pass=yield this.utilService.openPGPDecrypt(this.firewall.install_pass,p)),this.firewall.install_apikey&&(this.firewall.install_apikey=yield this.utilService.openPGPDecrypt(this.firewall.install_apikey,p))}catch{}this.firewall._fwcClusterId=e._fwcClusterId,this.firewall.firewallUUID=bt(),this.interfaces=o.data;let s,f;Array.isArray(this.interfaces)&&this.interfaces.forEach(S=>{S.interfaceUUID=Yi(),this.firewall.install_interface&&this.firewall.install_interface===S.id&&(this.firewall.installInterfaceUUID=S.interfaceUUID,s=S),Array.isArray(S.ipobjs)&&S.ipobjs.forEach(E=>{E.ipObjUUID=S.interfaceUUID+Yi(),this.firewall.install_ipobj&&this.firewall.install_ipobj===E.id&&(this.firewall.installIpObjUUID=E.ipObjUUID,f=E)})}),Array.isArray(this.interfaces)&&(this.interfacesEditorOptions={isCluster:!1,firewalls:[{firewallUUID:this.firewall.firewallUUID,firewall_name:this.firewall.name,firewall:this.firewall.id,cluster:null,installOptions:{firewallUUID:this.firewall.firewallUUID,interface:s,ipobj:f}}],discoveredFirewallUUID:this.firewall.firewallUUID,discoveredIfs:[],existingIfs:this.interfaces}),this.fillForm(),this.showDialog()})).catch(n=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(n)})})}).catch(i=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(i)})}):(this.firewall={firewallUUID:bt(),id:void 0,fwmaster:1,node_id:e.node_id,options:3,plugins:0},this.fillForm(),this.showDialog())))})}ngOnDestroy(){super.ngOnDestroy()}reloadPanel(){if(this.firewallToDelete&&this.firewallToDelete&&(this.displayDialog||this.dialogMinified)){let e=Object.assign({},this.firewallToDelete),i=this.itemSelectedService.getActualLastMinifiedDialogId();this.checkFirewallRestrictions(e),this.dialogId==i&&(this.showDialog(),this.itemSelectedService.setLastMinifiedDialogId(void 0)),this.store.dispatch(ue.reloadDialogFinished({dialogUuid:this.dialogUUID}))}}resetProperties(){this.firewall=null,this.firewallToDelete=null,this.interfaces=[],this.interfacesIpObjs=[],this.dependencies=null,this.deleteMsgError=null,this.delMessage=null,this.fwcUserService.setConfirmationToken(void 0),this.interfacesEditorOptions=null,this.fwcInterfacesEditor&&this.fwcInterfacesEditor.resetProperties(),this.discoveredInstallOptions=null,this.formModel&&this.formModel.reset()}resetForm(){this.formModel=new mi({cluster:new k(null),name:new k("",$.required),comment:new k(""),fwcloud:new k(this.fwcUserService.getActualFwSelectedCloud()),install_user:new k(""),install_pass:new k(""),save_user_pass:new k(1),install_interface:new k(null),install_ipobj:new k(null),fwmaster:new k(1),install_port:new k(33033),options:new k(3),node_id:new k(null),firewall:new k(null),plugins:new k(0),compiler:new k(0),install_communication:new k("agent",[$.required]),install_protocol:new k("https"),install_apikey:new k("")}),this.formModel.get("install_interface").valueChanges.subscribe(e=>{this.onInterfaceChange(+e)})}fillForm(){if(this.firewall){this.formModel.controls.cluster.setValue(this.firewall.cluster),this.formModel.controls.name.setValue(this.firewall.name,[$.pattern(be.nameRegExp)]),this.formModel.controls.comment.setValue(this.firewall.comment),this.formModel.controls.install_user.setValue(this.firewall.install_user,[$.pattern(be.linuxUsername)]),this.formModel.controls.install_pass.setValue(this.firewall.install_pass,[$.pattern(be.linuxPassword)]),this.formModel.controls.save_user_pass.setValue(1),this.formModel.controls.install_interface.setValue(this.firewall.install_interface),this.formModel.controls.install_ipobj.setValue(this.firewall.install_ipobj),this.formModel.controls.fwmaster.setValue(this.firewall.fwmaster),this.firewall.install_port&&this.formModel.controls.install_port.setValue(this.firewall.install_port),this.formModel.controls.options.setValue(this.firewall.options),this.setOptionsFlags(),this.formModel.controls.plugins.setValue(this.firewall.plugins),this.setOptionsPlugins(),this.formModel.controls.node_id.setValue(this.firewall.node_id),this.formModel.controls.firewall.setValue(this.firewall.id),this.firewall.install_communication&&this.formModel.controls.install_communication.setValue(this.firewall.install_communication),this.firewall.install_protocol&&this.formModel.controls.install_protocol.setValue(this.firewall.install_protocol),this.firewall.install_apikey&&this.formModel.controls.install_apikey.setValue(this.firewall.install_apikey),this.firewall.type=v.OBJ_FIREWALL,this.firewall.container=nt.C_FIREWALLS;let e=this.firewall.options&61440;this.formModel.controls.compiler.setValue(e>>12)}}onInterfaceChange(e){if(this.interfaces){for(let i=0;i<this.interfaces.length;i++)this.interfaces[i]&&this.interfaces[i].id==e&&(this.interfacesIpObjs=this.interfaces[i].ipobjs);this.formModel.get("install_ipobj").setValue(null)}}setOptionsFlags(){this.firewall&&Object.values(Ot).forEach(e=>{this.optionsFlags[e]=!!(this.firewall.options&2**Yr.get(e))})}onChangeOptionsFlags(){let e=[];for(let i of Object.values(Ot)){let t=Yr.get(i);e[t]=this.optionsFlags[i]?"1":"0"}this.formModel.controls.options.setValue(parseInt(e.reduce((i,t)=>t+i,""),2)),this.formModel.markAsDirty()}changeCompilerOptions(){let e=this.formModel.get("compiler").value,i=this.formModel.get("options").value,t=e<<12,n=i&4095;this.formModel.get("options").setValue(t|n)}getMasterFirewall(e){let i=null;if(e.data)for(let t=0;t<e.data.length;t++){let n=e.data[t];if(n.fwmaster){i=n.id;break}}return i}getClusterNodes(e,i){let t={};return new Promise((o,l)=>{e?this.fwcFirewallService.getClusterNodes(e,this.fwcUserService.getActualFwSelectedCloud()).subscribe(p=>{o(p)},p=>{l(p)}):o(t)})}getFirewalls(){return new Promise((i,t)=>{this.fwcFirewallService.getFirewallsByCloud(this.fwcUserService.getActualFwSelectedCloud()).subscribe(n=>{i(n)},n=>{t(n)})})}getClusters(){return new Promise((i,t)=>{this.fwcFirewallService.getClustersByCloud(this.fwcUserService.getActualFwSelectedCloud()).subscribe(n=>{i(n)},n=>{t(n)})})}getFirewall(e){return new Promise((t,n)=>{this.fwcFirewallService.getFirewall(e,this.fwcUserService.getActualFwSelectedCloud()).subscribe(o=>{t(o)},o=>{n(o)})})}getFirewallInterfaces(e){return new Promise((t,n)=>{this.fwcInterfaceService.getInterfacesInFwFull(e,this.fwcUserService.getActualFwSelectedCloud()).subscribe(o=>{t(o)},o=>{n(o)})})}onCancel(e){!e&&this.formModel&&!this.formModel.pristine&&this.formModel.valid?this.confirmationService.confirm({header:this.translate.instant("GLOBALS.MSG_CONFIRM"),icon:"fa fa-question-circle fwcBlue iconBig",message:this.translate.instant("FW.MSG_FW_EXIT"),accept:()=>{this.onCancel(!0)},rejectVisible:!0,rejectLabel:"No",acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.YES")}):(this.hideDialog(),this.resetProperties()),this.shownPanel=0}checkFirewallRestrictions(e){e&&(this.loadingData=!0,this.firewallToDelete=e,this.dependencies=null,this.deleteMsgError=null,this.delMessage={type:"loading",title:e._fwcClusterId?this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.CHECKING_HEAD"):this.translate.instant("FW.MSG_FW_DELETE.CHECKING_HEAD"),text:e._fwcClusterId?this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.CHECKING_TEXT"):this.translate.instant("FW.MSG_FW_DELETE.CHECKING_TEXT")},this.okToDelete=!1,Promise.all([this.getClusterNodes(e._fwcClusterId,e.id_obj),this.getFirewalls(),this.getClusters()]).then(([i,t,n])=>{let o=t.data,l=n.data;for(let s=0;s<o.length;s++){let f=o[s];if(f.cluster!==null&&f.cluster!==void 0)for(let S=0;S<l.length;S++){let E=l[S];if(f.cluster==E.id){f.cluster_name=E.name;break}}}let p=this.getMasterFirewall(i);if(p||(p=e.id_obj),e._fwcClusterId){this.fwcFirewallService.checkClusterRestrictions(p,this.fwcUserService.getActualFwSelectedCloud()).subscribe(()=>{this.deleteMsgError={type:"warning",title:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.DEL_2"),text:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.DEL_3",{name:e._fwcObjName})},this.dependencies=null,this.loadingData=!1,this.recenterDialog()},s=>{if(s.error&&s.error.restrictions)try{this.dependencies=s.error.restrictions,this.dependencies._fwcRestrictedObject={_fwcObjId:p,_fwcObjType:v.OBJ_CLUSTER},this.deleteMsgError={type:"error",title:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.DEL_0"),text:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.DEL_1",{name:e._fwcObjName})},this.recenterDialog()}catch(f){this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:f})}else this.deleteMsgError={type:"error",title:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.ERROR_RES_HEAD"),text:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.ERROR_DEL_TEXT",{error:this.fwcErrorPipe.transform(s)})},this.dependencies={restrictionsError:!0};this.loadingData=!1});return}this.fwcFirewallService.checkFwRestrictions(e.id_obj,this.fwcUserService.getActualFwSelectedCloud()).subscribe(s=>{let f=s.data.fwc_confirm_token;this.fwcUserService.setConfirmationToken(f),this.deleteMsgError={type:"warning",title:this.translate.instant("FW.MSG_FW_DELETE.DEL_2"),text:this.translate.instant("FW.MSG_FW_DELETE.DEL_3",{name:e._fwcObjName})},this.dependencies=null,this.loadingData=!1,this.recenterDialog()},s=>{if(s.error){if(s.error.restrictions)try{this.dependencies=s.error.restrictions,this.dependencies._fwcRestrictedObject={_fwcObjId:e.id_obj,_fwcObjType:v.OBJ_FIREWALL},this.deleteMsgError={type:"error",title:this.translate.instant("FW.MSG_FW_DELETE.DEL_0"),text:this.translate.instant("FW.MSG_FW_DELETE.DEL_1",{name:e._fwcObjName})},this.recenterDialog()}catch(f){this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:f})}else this.deleteMsgError={type:"error",title:this.translate.instant("FW.MSG_FW_DELETE.DEL_0"),text:this.translate.instant("FW.MSG_FW_DELETE.ERROR_RES_TEXT",{error:this.fwcErrorPipe.transform(s)})},this.dependencies={restrictionsError:!0};this.loadingData=!1}})}).catch(i=>{this.loadingData=!1,this.deleteMsgError={type:"error",title:this.translate.instant("FW.MSG_FW_DELETE.DEL_0"),text:this.translate.instant("FW.MSG_FW_DELETE.ERROR_RES_TEXT",{error:this.fwcErrorPipe.transform(i)})},this.dependencies={restrictionsError:!0}}))}checkForm(e){e&&e.target&&e.target.type!="textarea"&&this.formModel.valid&&(e.target.blur(),this.onSave())}onSave(e=!1){return te(this,null,function*(){if(!this.firewall)return;if(!e&&this.fwcInterfacesEditor&&!this.fwcInterfacesEditor.isThereAnySelectedNode()){this.confirmationService.confirm({header:this.translate.instant("IF_EDITOR.TREE.MSG_NO_SELECTED.TITLE"),icon:"fa fa-question-circle fwcBlue iconBig",message:this.translate.instant("IF_EDITOR.TREE.MSG_NO_SELECTED.TEXT",{obj_name:this.translate.instant("GLOBALS.MSG_OBJ_TYPES.FIREWALL").toLowerCase()}),accept:()=>{this.onSave(!0)},rejectVisible:!0,rejectLabel:"No",acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.YES")});return}this.loadingData=!0;let i,t,n=Object.assign({},this.firewall),o={};for(let p in this.formModel.controls)o[p]=n[p]=this.formModel.controls[p].value!==null&&this.formModel.controls[p].value!==void 0?this.formModel.controls[p].value:void 0;let l=this.fwcUserService.getActualFwcUser().publicKey;o.install_user&&(o.install_user=yield this.utilService.openPGPEncrypt(o.install_user,l)),o.install_pass&&(o.install_pass=yield this.utilService.openPGPEncrypt(o.install_pass,l)),this.firewall.id===null||this.firewall.id===void 0?(i=this.fwcFirewallService.newFirewall.bind(this.fwcFirewallService),t=this.translate.instant("FW.MSG_FW_CREATE")):(i=this.fwcFirewallService.updateFirewall.bind(this.fwcFirewallService),t=this.translate.instant("FW.MSG_FW_UPDATE",{name:n.name})),o.install_apikey?o.install_apikey=yield this.utilService.openPGPEncrypt(o.install_apikey,l):o.install_apikey=null,delete o.compiler,o.install_communication=="ssh"&&(o.install_apikey=""),o.install_communication=="agent"&&(o.install_user="",o.install_pass=""),this.utilService.fwcAPICall(i,o).then(p=>te(this,null,function*(){let s;p.data&&p.data.insertId?s=p.data.insertId:s=this.firewall.id,o.firewall=s,n.container=nt.C_FIREWALLS,n._fwcObjId=s,n._fwcObjType=v.OBJ_FIREWALL,n._fwcTreeAction=Ue.NEW_ITEM,this.itemSelectedService.setModifiedItem(n),this.loadingData=!1,this.itemSelectedService.getSelectedTreeNode().pipe(So(1)).subscribe(f=>{let S=()=>{if(n.id!==null&&n.id!==void 0||this.fwcInterfacesEditor&&this.fwcInterfacesEditor.operationsModified()){let E=this.fwcPolicyService.getActualSelectedPolicy();E._fwcFwId!==null&&E._fwcFwId!==void 0&&(E._fwcFwId==n.id&&(E._fwcFwName=n.name,E._dontLocateInTree=!0),this.fwcPolicyService.setSelectedPolicy(E),this.fwcPolicyService.reloadPolicy())}this.loadingData=!1,this.hideDialog(),this.resetProperties(),this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:t})};if(this.fwcInterfacesEditor&&this.fwcInterfacesEditor.areTherePendingOperations()){let E=this.fwcInterfacesEditor.getSelectedTreeNodes();if(p.data&&p.data.loData&&this.fwcInterfacesEditor.setNewLoIds(p.data),Array.isArray(f.items)){let I=f.items.find(b=>b.node_type===X.FOLDER_INTERFACES);if(I){let b={parentObject:{fwcloud:this.fwcUserService.getActualFwSelectedCloud(),name:f._fwcFwName,type:v.OBJ_FIREWALL,id:s,id_node:I.id},objectTreeNodes:E,onClose:J=>te(this,null,function*(){let U,M,Q=!1;if(J.forEach(j=>{j.operationStatus===Di.SUCCESS&&j.operationResult&&j.object.installFirewallUUIDs&&j.object.installFirewallUUIDs.has(this.firewall.firewallUUID)&&(j.object.type===v.OBJ_INTERFACE_FIREWALL?U=j.operationResult.insertId:j.object.type===v.OBJ_ADDRESS&&(M=j.operationResult.insertId)),j.operationStatus===Di.ERROR&&(Q=!0)}),!Q&&U&&M){o.install_interface=U,o.install_ipobj=M;try{let j=new Rn(o).getValue(),Z=yield this.utilService.fwcAPICall(this.fwcFirewallService.updateFirewall.bind(this.fwcFirewallService),j)}catch(j){Qt.log("ERROR UPDATING: ",j)}}this.itemSelectedService.setModifiedItem(n),S()})},x={uuid:q.ITEM_BATCH_MANAGER,data:b};this.appDialogPanelsService.searchAndShowDialog(x)}else S()}}else S()})})).catch(p=>{p.status==400&&p.error.fwcErr==8001?(this.confirmationService.confirm({header:this.translate.instant("GLOBALS.MSG_OP_RESULT.ERROR"),icon:"fa fa-exclamation-circle fwcRed iconBig",message:this.translate.instant("API_ERROR."+p.error.fwcErr),rejectVisible:!1,acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.OK"),accept:()=>{}}),this.loadingData=!1):(this.loadingData=!1,this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(p)}))})})}manageInterfacesAndIps(e){let i=this.itemSelectedService.getActualFwcTreeComponents();Array.isArray(i)&&i.forEach(t=>{})}onDeleteFirewall(){this.okToDelete&&this.firewallToDelete&&(this.loadingData=!0,this.deleteMsgError=null,this.delMessage={type:"loading",title:this.translate.instant("FW.MSG_FW_DELETE.DELETING_HEAD"),text:this.translate.instant("FW.MSG_FW_DELETE.DELETING_TEXT")},this.utilService.fwcAPICall(this.fwcFirewallService.deleteFirewall.bind(this.fwcFirewallService),this.firewallToDelete.id_obj,this.fwcUserService.getActualFwSelectedCloud()).then(e=>{let i=this.firewallToDelete,t={_fwcFwId:null,fwId:null},n=this.fwcPolicyService.getActualSelectedPolicy();this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("FW.MSG_FW_DELETE.DEL_4")}),i._fwcTreeAction=Ue.DELETE_ITEM,this.itemSelectedService.setModifiedItem(i),this.itemSelectedService.setModifiedItem({_fwcTreeAction:Ue.RELOAD_TREE,containerToReload:nt.C_OBJECTS}),n&&n._fwcFwId==this.firewallToDelete.id_obj&&this.fwcPolicyService.setSelectedPolicy(t),this.loadingData=!1,this.hideDialog(),this.resetProperties()}).catch(e=>{this.deleteMsgError={type:"error",title:this.translate.instant("FW.MSG_FW_DELETE.ERROR_RES_HEAD"),text:this.translate.instant("FW.MSG_FW_DELETE.ERROR_RES_TEXT",{error:this.fwcErrorPipe.transform(e)})},this.fwcUserService.setConfirmationToken(void 0),this.loadingData=!1}))}onDiscoverInterfaces(e=!0){Array.isArray(this.interfacesIpObjs)&&(!e&&this.interfacesEditorOptions&&this.fwcInterfacesEditor.operationsModified()?this.confirmationService.confirm({header:this.translate.instant("FW.MSG_FW_EDITION.CONFIRM_DISCOVER_HEADER"),icon:"fa fa-question-circle fwcBlue iconBig",message:this.translate.instant("FW.MSG_FW_EDITION.CONFIRM_DISCOVER_TEXT"),accept:()=>{this.doShowDiscoverDialog()},rejectVisible:!0,rejectLabel:"No",acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.YES")}):this.doShowDiscoverDialog())}onTestFwcAgentCommunication(){return te(this,null,function*(){let e=this.formModel.get("install_ipobj").value;if(e){this.loadingData=!0,this.loadingCommunication=!0;let i=this.formModel.value,t=this.interfacesIpObjs.find(n=>n.id===e);if(t){let n="Error",o="fa fa-exclamation-circle fwcRed iconBig",l=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:this.translate.instant("GLOBALS.ERRORS.COMMUNICATION")}),p=this.fwcUserService.getActualFwcUser().publicKey,s={communication:i.install_communication,host:t.address,port:i.install_port};if(i.install_communication==="ssh"){let f=i.install_user,S=i.install_pass;f&&(f=yield this.utilService.openPGPEncrypt(f,p)),S&&(S=yield this.utilService.openPGPEncrypt(S,p)),s.username=f,s.password=S}else{let f=i.install_apikey;f&&(f=yield this.utilService.openPGPEncrypt(f,p)),s.protocol=i.install_protocol,s.apikey=f}this.communicationSubscription=this.utilService.fwcAPICallObservable(this.fwcFirewallService.checkFwCommunication.bind(this.fwcFirewallService),this.fwcUserService.getActualFwSelectedCloud(),s).subscribe({next:()=>{n=this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),o="fa fa-check-circle fwcGreen iconBig",l=this.translate.instant("FW.MSG_FW_EDITION.PING_AGENT_OK"),this.confirmationService.confirm({header:n,icon:o,acceptLabel:"Ok",rejectVisible:!1,message:l}),this.loadingData=!1,this.loadingCommunication=!1},error:f=>te(this,null,function*(){let S;S=this.utilService.isCommunicationError(f.error),S&&(l=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:S})),this.confirmationService.confirm({header:n,icon:o,acceptLabel:"Ok",rejectVisible:!1,message:l}),this.loadingData=!1,this.loadingCommunication=!1})})}}})}onTestFwcAgentCommunicationDiscoverInterfaces(){return te(this,null,function*(){if(this.discoveredInstallOptions.ipobj){this.loadingData=!0;let e="Error",i="fa fa-exclamation-circle fwcRed iconBig",t=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:this.translate.instant("GLOBALS.ERRORS.COMMUNICATION")}),n=this.fwcUserService.getActualFwcUser().publicKey,o={communication:this.formModel.value.install_communication,host:this.discoveredInstallOptions.ipobj.address,port:this.install_port_agent},l=this.formModel.value.install_apikey;l&&(l=yield this.utilService.openPGPEncrypt(l,n)),o.protocol=this.formModel.value.install_protocol,o.apikey=l,this.utilService.fwcAPICall(this.fwcFirewallService.checkFwCommunication.bind(this.fwcFirewallService),this.fwcUserService.getActualFwSelectedCloud(),o).then(p=>{e=this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),i="fa fa-check-circle fwcGreen iconBig",t=this.translate.instant("FW.MSG_FW_EDITION.PING_AGENT_OK")}).catch(p=>{if(p.error){let s;s=this.utilService.isCommunicationError(p.error),s&&(t=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:s}))}}).finally(()=>{this.confirmationService.confirm({header:e,icon:i,acceptLabel:"Ok",rejectVisible:!1,message:t}),this.loadingData=!1})}})}doShowDiscoverDialog(e){let i=this.formModel.get("install_ipobj").value,t="",n=this.formModel.get("install_communication").value||"ssh";if(i){let l=this.interfacesIpObjs.find(p=>p.id===i);l&&(t=l.address)}else this.discoveredInstallOptions&&(t=this.discoveredInstallOptions.ipobj.address);let o={header:this.firewall.name?this.translate.instant("COMPILE.INST_SSH",{name:this.firewall.name}):this.translate.instant("COMPILE.INST_SSH_GEN"),helpText:this.translate.instant("IF_EDITOR.TREE.INST_SSH_TEXT"),modal:!0,formControls:[{name:"install_communication",type:"hidden",value:n},{name:"address",label:this.translate.instant("ITEM_PANEL.FIELDS.ADDRESS"),regexp:be.ipV4Regexp,type:"text",required:!0,value:e?e.address:t,setFocus:!0},{name:"",label:"",type:"separator"},{name:"install_port",label:this.translate.instant("CLUSTER.MSG_CLUSTER_EDITION.PORT"),regexp:be.portRegexp,type:"number",required:!0,value:e?e.install_port:this.formModel.get("install_port").value},{name:"",label:"",type:"separator"}],onAccept:this.doDiscoverInterfaces.bind(this)};n==="ssh"?o.formControls.push({name:"install_user",label:this.translate.instant("CLUSTER.MSG_CLUSTER_EDITION.SSH_USER"),type:"text",required:!0,value:e?e.install_user:this.formModel.get("install_user").value},{name:"",label:"",type:"separator"},{name:"install_pass",label:this.translate.instant("CLUSTER.MSG_CLUSTER_EDITION.SSH_PASS"),type:"password",required:!0,value:e?e.install_pass:this.formModel.get("install_pass").value}):o.formControls.push({name:"install_protocol",label:this.translate.instant("FW.MSG_FW_EDITION.AGENT_PROTOCOL"),type:"select",required:!0,value:e?e.install_protocol:this.formModel.get("install_protocol").value,options:[{id:"https",text:"HTTPS"},{id:"http",text:"HTTP"}]},{name:"",label:"",type:"separator"},{name:"install_apikey",label:this.translate.instant("FW.MSG_FW_EDITION.AGENT_APIKEY"),type:"password",required:!0,value:e?e.install_apikey:this.formModel.get("install_apikey").value}),this.inputDataService.setInputData(o)}doDiscoverInterfaces(e){return te(this,null,function*(){if(e){let i=this.fwcUserService.getActualFwcUser().publicKey,t={fwcloud:this.fwcUserService.getActualFwSelectedCloud(),ip:e.address,port:+e.install_port,communication:e.install_communication};if(e.install_communication==="ssh"){let n=e.install_user,o=e.install_pass;n&&(n=yield this.utilService.openPGPEncrypt(n,i)),o&&(o=yield this.utilService.openPGPEncrypt(o,i)),t.sshuser=n,t.sshpass=o,this.formModel.get("install_user").value!==e.install_user&&(this.formModel.get("install_user").setValue(e.install_user),this.formModel.markAsDirty())}else{let n=e.install_apikey;n&&(n=yield this.utilService.openPGPEncrypt(n,i)),t.apikey=n,t.protocol=e.install_protocol,this.formModel.get("install_protocol").value!==e.install_protocol&&(this.formModel.get("install_protocol").setValue(e.install_protocol),this.formModel.markAsDirty()),this.formModel.get("install_apikey").value!==e.install_apikey&&(this.formModel.get("install_apikey").setValue(e.install_apikey),this.formModel.markAsDirty())}this.loadingData=!0,this.loadingCommunication=!0,this.communicationSubscription=this.utilService.fwcAPICallObservable(this.fwcFirewallService.autoDiscoverInterfaces.bind(this.fwcFirewallService),t).subscribe({next:n=>{if(Array.isArray(n.data)){let o=n.data,l=this.getInterfaceAndAddressByUUID(this.firewall.installInterfaceUUID,this.firewall.installIpObjUUID);this.interfacesEditorOptions={isCluster:!1,firewalls:[{firewallUUID:this.firewall.firewallUUID,firewall_name:this.firewall.name,firewall:this.firewall.id,cluster:null,installOptions:{firewallUUID:this.firewall.firewallUUID,interface:l.interfaceInfo,ipobj:l.ipObjInfo}}],discoveredFirewallUUID:this.firewall.firewallUUID,discoveredAddress:e.address,discoveredIfs:o,existingIfs:this.interfaces},this.install_port_agent=e.install_port,this.formModel.markAsDirty(),this.shownPanel=1,this.recenterDialog()}this.loadingData=!1,this.loadingCommunication=!1},error:n=>te(this,null,function*(){if(n.error.fwcErr==9e3)this.confirmationService.confirm({header:this.translate.instant("GLOBALS.MSG_OP_RESULT.ERROR"),icon:"fa fa-exclamation-circle fwcRed iconBig",message:this.translate.instant("API_ERROR.SSH_FORBIDDEN"),rejectVisible:!1,acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.OK")});else{let o;n&&(o=this.utilService.isCommunicationError(n.error)),this.confirmationService.confirm({header:"Error",icon:"fa fa-exclamation-circle fwcRed iconBig",acceptLabel:"Ok",rejectVisible:!1,message:this.translate.instant("FW.MSG_FW_EDITION.ERROR_DISCOVER")+(o?":<br/>"+o:""),accept:()=>{if(o)return this.doShowDiscoverDialog(e)}})}this.loadingData=!1,this.loadingCommunication=!1})})}})}showFirewallInfo(){return te(this,null,function*(){this.loadingData=!0,this.loadingCommunication=!0;let e=this.formModel.get("install_ipobj").value;if(e){let i=this.formModel.value,t=this.interfacesIpObjs.find(n=>n.id===e);if(t){let n=this.fwcUserService.getActualFwcUser().publicKey,o={communication:i.install_communication,host:t.address,port:i.install_port};if(i.install_communication!=="ssh"){let l=i.install_apikey;l&&(l=yield this.utilService.openPGPEncrypt(l,n)),o.protocol=i.install_protocol,o.apikey=l}this.communicationSubscription=this.utilService.fwcAPICallObservable(this.fwcFirewallService.getFirewallInformation.bind(this.fwcFirewallService),this.fwcUserService.getActualFwSelectedCloud(),o).subscribe({next:l=>{let p=this.utilService.createDynamicComponentRef(An),s=p.instance;s.setDynamicComponentRef(p),s.showFirewallPanel(l.data.data.fwc_agent_version,l.data.data.host_name,l.data.data.system_name,l.data.data.os_version,l.data.data.os_version,l.data.data.kernel_version),this.loadingData=!1,this.loadingCommunication=!1},error:l=>te(this,null,function*(){let p=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:this.translate.instant("GLOBALS.ERRORS.COMMUNICATION")}),s;s=this.utilService.isCommunicationError(l.error),s&&(p=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:s})),this.confirmationService.confirm({header:"Error",icon:"fa fa-exclamation-circle fwcRed iconBig",acceptLabel:"Ok",rejectVisible:!1,message:p}),this.loadingData=!1,this.loadingCommunication=!1})})}}})}getInterfaceAndAddressByUUID(e,i){let t,n;return Array.isArray(this.interfaces)&&this.interfaces.forEach(o=>{o.interfaceUUID&&o.interfaceUUID===e&&(t=o),Array.isArray(o.ipobjs)&&o.ipobjs.forEach(l=>{l.ipObjUUID&&l.ipObjUUID===i&&(n=l)})}),!t&&this.discoveredInstallOptions&&this.discoveredInstallOptions.interface.interfaceUUID===e&&(t=this.discoveredInstallOptions.interface),!n&&this.discoveredInstallOptions&&this.discoveredInstallOptions.ipobj.ipObjUUID===i&&(n=this.discoveredInstallOptions.ipobj),{interfaceInfo:t,ipObjInfo:n}}onChangeInstallData(e){let i=this.formModel.get("install_interface").value,t=this.formModel.get("install_ipobj").value,n=null;i&&Array.isArray(this.interfaces)&&(n=this.interfaces.find(p=>p.id===i),this.firewall.installInterfaceUUID=n?n.interfaceUUID:void 0);let o=null;t&&n&&Array.isArray(n.ipobjs)&&(o=n.ipobjs.find(p=>p.id===t),this.firewall.installIpObjUUID=o?o.ipObjUUID:void 0);let l={firewallUUID:this.firewall.firewallUUID,interface:n,ipobj:o};this.refreshDialog(),this.fwcInterfacesEditor.updateInstallOptions(l)}onEditorInstallModified(e){if(e)if(!e.interface&&!e.ipobj)this.formModel.get("install_interface").setValue(null),this.formModel.get("install_ipobj").setValue(null),this.firewall.installInterfaceUUID=null,this.firewall.installIpObjUUID=null,this.discoveredInstallOptions=null;else{let i=e.interface.id,t=e.ipobj.id;this.formModel.get("install_interface").setValue(i),this.formModel.get("install_ipobj").setValue(t),this.firewall.installInterfaceUUID=e.interface.interfaceUUID,this.firewall.installIpObjUUID=e.ipobj.ipObjUUID,i&&t?this.discoveredInstallOptions=null:this.discoveredInstallOptions={interface:e.interface,ipobj:e.ipobj}}this.formModel.markAsDirty()}onEditorInterfaceOrIpModified(e){if(e&&Object.keys(e).length){if(e.id&&Array.isArray(this.interfaces)){let i=!1;for(let t=0;t<this.interfaces.length&&!i;t++){let n=this.interfaces[t];if(e.id===n.id&&e.type===n.type&&(n.name=e.name,i=!0),Array.isArray(n.ipobjs))for(let o=0;o<n.ipobjs.length&&!i;o++){let l=n.ipobjs[o];e.id===l.id&&e.type===l.type&&(l.name=e.name,l.address=e.address,i=!0)}}}else this.discoveredInstallOptions&&(e.type===v.OBJ_INTERFACE_FIREWALL?this.discoveredInstallOptions.interface&&(this.discoveredInstallOptions.interface.name=e.name):this.discoveredInstallOptions.ipobj&&(this.discoveredInstallOptions.ipobj.name=e.name,this.discoveredInstallOptions.ipobj.address=e.address));this.formModel.markAsDirty()}}handleFirewallManagementChange(e){e&&e.target&&(e.target.value==="agent"?(this.formModel.get("install_protocol").setValidators([$.required]),this.formModel.get("install_apikey").setValidators([$.required]),this.formModel.get("install_port").setValue(33033)):(this.formModel.get("install_protocol").clearValidators(),this.formModel.get("install_apikey").clearValidators(),this.formModel.get("install_port").setValue(22)),this.formModel.get("install_protocol").updateValueAndValidity(),this.formModel.get("install_apikey").updateValueAndValidity())}setOptionsPlugins(){this.firewall&&Object.values(Xe).forEach(e=>{this.optionsPlugins[e]=!!(this.firewall.plugins&Ke.get(e))})}onChangePluginsDevelop(){let e=[];for(let t of Object.values(Xe)){let n=Ke.get(t);e[n]=this.optionsPlugins[t]?"1":"0"}this.formModel.controls.plugins.setValue(parseInt(e.reduce((t,n)=>n+t,""),2));let i;Object.values(Xe).forEach(t=>{(this.formModel.controls.plugins.value&2**Ke.get(t))!==(this.firewall.plugins&2**Ke.get(t))&&(i=t)}),this.confirmationService.confirm({header:this.translate.instant("FW.PLUGINS.HEADER"),icon:"fa fa-exclamation-circle fwcRed iconBig",acceptLabel:"Ok",rejectVisible:!1,message:this.translate.instant("FW.PLUGINS.NOT_IMPLEMENTED"),reject:()=>{this.setOptionsPlugins()},accept:()=>{this.setOptionsPlugins()}})}onChangePlugins(){let e=[],i="",t;if(this.firewall.id?(t=this.firewall.plugins,!this.firewall.install_communication&&!this.formModel.value.install_communication?i=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:this.translate.instant("API_ERROR.client-tiemeout")}):!this.firewall.install_apikey&&!this.formModel.value.install_apikey?i=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:this.translate.instant("API_ERROR.ApiKeyNotFound")}):!this.firewall.ip&&!this.formModel.value.install_ipobj?i=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:this.translate.instant("API_ERROR.ETIMEDOUT")}):!this.firewall.install_port&&!this.formModel.value.install_ipobj?i=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:this.translate.instant("API_ERROR.ECONNRESET")}):!this.firewall.install_protocol&&!this.formModel.value.install_protocol&&(i=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:this.translate.instant("API_ERROR.EPROTO")}))):(t=this.formModel.controls.plugins.value,this.formModel.value.install_communication?this.formModel.value.install_apikey?this.discoveredInstallOptions?this.formModel.value.install_protocol||(i=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:this.translate.instant("API_ERROR.EPROTO")})):i=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT_IP_PORT"):i=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:this.translate.instant("API_ERROR.ApiKeyNotFound")}):i=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:this.translate.instant("API_ERROR.client-tiemeout")})),i!=""){this.confirmationService.confirm({header:"Error",icon:"fa fa-exclamation-circle fwcRed iconBig",acceptLabel:"Ok",rejectVisible:!1,message:i,reject:()=>{this.setOptionsPlugins()},accept:()=>{this.setOptionsPlugins()}});return}for(let l of Object.values(Xe)){let p=Ke.get(l);e[p]=this.optionsPlugins[l]?"1":"0"}this.formModel.controls.plugins.setValue(parseInt(e.reduce((l,p)=>p+l,""),2));let n,o;Object.values(Xe).forEach(l=>te(this,null,function*(){if((this.formModel.controls.plugins.value&Ke.get(l))!==(this.firewall.plugins&Ke.get(l))){l==Xe.iscbind9?n="isc-bind9":l==Xe.iscdhcp?n="isc-dhcp":n=l,o=this.optionsPlugins[l];let p;this.formModel.controls.plugins.value&Ke.get(l)?p=this.translate.instant("FW.PLUGINS.ENABLE",{plugin:this.translate.instant("FW.PLUGINS."+l.toUpperCase())}):p=this.translate.instant("FW.PLUGINS.DISABLE",{plugin:this.translate.instant("FW.PLUGINS."+l.toUpperCase())}),this.confirmationService.confirm({header:this.translate.instant("FW.PLUGINS.HEADER"),message:p,reject:()=>{this.setOptionsPlugins()},accept:()=>te(this,null,function*(){this.loadingData=!0;let s=this.firewall.install_user,f=this.firewall.install_pass,S=this.firewall.install_apikey;s&&(s.startsWith("-")||(s=yield this.utilService.openPGPEncrypt(s,this.fwcUserService.getActualFwcUser().publicKey))),f&&(f.startsWith("-")||(f=yield this.utilService.openPGPEncrypt(f,this.fwcUserService.getActualFwcUser().publicKey))),S?S.startsWith("-")||(S=yield this.utilService.openPGPEncrypt(S,this.fwcUserService.getActualFwcUser().publicKey)):S=null;let E,I,b,x,J,U;this.discoveredInstallOptions?(J=this.formModel.value.install_communication,I=this.discoveredInstallOptions.ipobj.address,b=this.install_port_agent,x=yield this.utilService.openPGPEncrypt(this.formModel.value.install_apikey,this.fwcUserService.getActualFwcUser().publicKey),E=this.formModel.value.install_protocol,U=!0):this.formModel.value.install_ipobj&&(J=this.formModel.value.install_communication,I=this.interfacesIpObjs.find(oe=>oe.id==this.formModel.value.install_ipobj).address,b=this.formModel.value.install_port,x=yield this.utilService.openPGPEncrypt(this.formModel.value.install_apikey,this.fwcUserService.getActualFwcUser().publicKey),E=this.formModel.value.install_protocol,U=!1);let M=Object.assign({},this.firewall),Q={};for(let oe in this.formModel.controls)Q[oe]=M[oe]=this.formModel.controls[oe].value!==null&&this.formModel.controls[oe].value!==void 0?this.formModel.controls[oe].value:void 0;let j=this.fwcUserService.getActualFwcUser().publicKey;s&&(Q.install_user=s),f&&(Q.install_pass=f),S?Q.install_apikey=S:Q.install_apikey&&(Q.install_apikey.startsWith("-")||(Q.install_apikey=yield this.utilService.openPGPEncrypt(Q.install_apikey,this.fwcUserService.getActualFwcUser().publicKey))),delete Q.compiler,Q.plugins=this.formModel.controls.plugins.value,this.eventsSubscription=this.fwcEventService.getEvent().pipe(ee(()=>this.alive)).subscribe(oe=>{oe.type==Gi.EVENT_PLUGIN_PANEL_CLOSED&&(this.eventsSubscription.unsubscribe(),oe.data?(this.setOptionsPlugins(),this.formModel.controls.plugins.setValue(t)):this.firewall.plugins=this.formModel.controls.plugins.value)});let Z={firewall:Q,plugin:n,enable:o,address:I,persisted:U};this.itemSelectedService.setFirewallToPluginOperation(Z),this.loadingData=!1}),icon:"fa fa-question-circle fwcBlue iconBig",rejectVisible:!0,rejectLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.NO"),acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.YES")})}}))}checkSSHCommunicationConfig(){return te(this,null,function*(){this.isSSHCommunicationDisabled=!(yield this.utilService.fwcAPICall(this.fwcFirewallService.loadBackEndConfig.bind(this.fwcFirewallService))).data.availablecommunications.includes("ssh")})}checksNtopNGConfig(){return this.interfacesIpObjs.find(e=>e.id==this.formModel.value.install_ipobj)?!!(this.firewall.plugins&Ke.get(Xe.ntopng)):this.discoveredInstallOptions&&Array.from(this.discoveredInstallOptions.interface.installFirewallUUIDs).find(e=>e===this.firewall.firewallUUID)?!!(this.firewall.plugins&Ke.get(Xe.ntopng)):!1}checksWebSafetyProxyActie(){return this.interfacesIpObjs.find(e=>e.id==this.formModel.value.install_ipobj)?!!(this.firewall.plugins&Ke.get(Xe.websafety)):this.discoveredInstallOptions&&Array.from(this.discoveredInstallOptions.interface.installFirewallUUIDs).find(e=>e===this.firewall.firewallUUID)?!!(this.firewall.plugins&Ke.get(Xe.websafety)):!1}checksDNSSafetyActive(){return this.interfacesIpObjs.find(e=>e.id==this.formModel.value.install_ipobj)?!!(this.firewall.plugins&Ke.get(Xe.dnssafety)):this.discoveredInstallOptions&&Array.from(this.discoveredInstallOptions.interface.installFirewallUUIDs).find(e=>e===this.firewall.firewallUUID)?!!(this.firewall.plugins&Ke.get(Xe.dnssafety)):!1}checksElasticSearchActive(){return this.interfacesIpObjs.find(e=>e.id==this.formModel.value.install_ipobj)?!!(this.firewall.plugins&Ke.get(Xe.elasticsearch)):this.discoveredInstallOptions&&Array.from(this.discoveredInstallOptions.interface.installFirewallUUIDs).find(e=>e===this.firewall.firewallUUID)?!!(this.firewall.plugins&Ke.get(Xe.elasticsearch)):!1}onClickButtonNGFW(e){let i,t=this.interfacesIpObjs.length!==0?this.interfacesIpObjs.find(n=>n.id==this.formModel.value.install_ipobj).address:this.discoveredInstallOptions.ipobj.address;switch(e){case"NTOPNG":i="http://"+t+":3000";break;case"WEBSAFETYPROXY":i="https://"+t+":8095";break;case"DNSSAFETY":i="https://"+t+":8096";break;case"ELASTICSEARCH":i="http://"+t+":5601";break}try{window.open(i)}catch(n){this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(n)})}}onShowDialog(e){this.itemSelectedService.getActualItem().ngfw==!0?this.shownPanel=4:this.itemSelectedService.getActualItem().plugins===!0?this.shownPanel=3:this.shownPanel=0,this.recenterDialog();let i=this.itemSelectedService.getActualItem();delete i.ngfw,delete i.plugins,setTimeout(()=>{this.inputFirewallName&&this.inputFirewallName.nativeElement.focus()},150)}onChangeTab(e){this.shownPanel=e.index}onHideDialog(e){}onCloseDialog(){this.communicationSubscription&&(this.communicationSubscription.unsubscribe(),this.communicationSubscription=null,this.loadingData=!1,this.loadingCommunication=!1)}static{this.\u0275fac=function(i){return new(i||r)(A(pe),A(Ge),A(ae),A(Ye),A(Oe),A(Et),A(fe),A(ii),A(Se),A(Nt),A(me),A(de),A(he),A(vt),A(le),A(_e),A(Dt))}}static{this.\u0275cmp=De({type:r,selectors:[["sts-fwc-firewall-panel"]],viewQuery:function(i,t){if(i&1&&(ge(ac,5),ge(sc,5)),i&2){let n;se(n=ce())&&(t.inputFirewallName=n.first),se(n=ce())&&(t.fwcInterfacesEditor=n.first)}},features:[Ze([ae,Ye]),Lt],decls:6,vars:8,consts:[["firewallDialog",""],["inputFirewallName",""],["ifSelect",""],["fwcInterfacesEditor",""],["divPass",""],["styleClass","dlgFwcDialog",3,"visibleChange","onShow","onHide","visible","modal","closable"],["pTemplate","header"],[1,"fwcFirewallPanel",3,"formGroup"],["pTemplate","footer"],[1,"divFormHeader"],[1,"divHeaderButtons"],["pButton","","type","button","icon","fa fa-question",1,"p-button-primary",3,"disabled"],["pButton","","type","button","icon","fa fa-window-minimize",1,"p-button-secondary",3,"click","disabled"],[1,"fwcWhite","fwcIconLeft"],[1,"fwcMenuIcon","fwci-firewall","fwcOrange"],[1,"fwcMenuIcon","fwci-delete","fwcOrange"],["pButton","","type","button","icon","fa fa-question",1,"p-button-primary",3,"click","disabled"],[1,"fwcFirewallPanel",3,"keyup.enter","keyup.esc","formGroup"],[3,"disabled"],[3,"onChange","activeIndex"],["leftIcon","fwci-editfirewall",3,"header","disabled"],[1,"grid"],[1,"col-12","noVertPad"],[1,"noVertPad","fwcBlue","botBorder"],[1,"col-6"],[1,"p-inputgroup"],["for","name"],["type","text","maxlength","64","pInputText","","formControlName","name","name","name",3,"placeholder"],[1,"fwc-error",3,"ngStyle"],[1,"col-3"],["for","compiler"],["formControlName","compiler","name","compiler",3,"change"],[3,"ngValue"],["for","install_communication"],["formControlName","install_communication","name","install_communication",3,"change"],["disabled","",3,"value"],["value","ssh",3,"disabled"],["value","agent"],[1,"col-2"],["for","comment"],[1,"col-10"],["maxlength","255","pInputTextarea","","formControlName","comment","name","comment",3,"rows","cols"],[1,"noVertPad","fwcBlue"],["ngClass","col-3"],["type","button","pButton","","icon","fa fa-search-plus",1,"p-button-primary",2,"height","2.44rem","width","100%",3,"click","disabled","label"],[1,"fwcBlue"],["leftIcon","fwci-interfaces",3,"header","disabled"],[3,"onInstallModified","onIpObjectModified","onStartAutodiscover","options"],["leftIcon","fwci-config",3,"header","disabled"],["type","hidden","formControlName","options","name","options"],[1,"col-12"],[3,"ngModelChange","onChange","binary","ngModel","ngModelOptions","label"],[3,"ngModelChange","onChange","binary","ngModel","ngModelOptions"],["href","https://www.docker.com","target","_blank"],["width","20","height","20",1,"icon"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-docker"],["target","_blank",2,"margin-left","8px","margin-top","2px",3,"href"],["href","https://crowdsec.net/","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-crowdsec"],["href","https://www.fail2ban.org","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-fail2ban"],["leftIcon","fa fa-puzzle-piece fwcOrange",3,"header","disabled"],["type","hidden","formControlName","plugins","name","plugins"],["leftIcon","fa fa-n fwcOrange",3,"header","disabled"],[1,"col-4"],["for","install_protocol"],["formControlName","install_protocol","name","install_protocol",1,"selNoMargin",3,"change"],["value","https"],["value","http"],[1,"col-5"],["for","install_apikey"],["pPassword","","formControlName","install_apikey","name","install_apikey","maxlength","64",3,"showPassword","placeholder","feedback"],["pButton","","type","button","icon","fa fa-eye",1,"p-button-secondary","fwcButtonHeight",3,"mousedown","mouseup","mouseout"],["for","install_user"],["type","text","pInputText","","maxlength","32","formControlName","install_user","name","install_user",3,"placeholder"],[1,"fwc-error"],["for","install_pass"],["pPassword","","formControlName","install_pass","name","install_pass","maxlength","64",3,"showPassword","placeholder","promptLabel","weakLabel","mediumLabel","strongLabel"],["pButton","","type","button","icon","fa fa-eye",1,"p-button-secondary",3,"mousedown","mouseup","mouseout"],[1,"fa","fa-lg","fa-info-circle","fwcBlue",3,"pTooltip"],["type","text","pInputText","","readonly","",3,"value"],["for","install_port"],["type","text","pInputText","","readonly","",3,"placeholder","value"],["type","button","pButton","","tooltipPosition","top","showDelay","500","icon","fa fa-plug",1,"p-button-primary",2,"display","inline-flex","height","2.44rem","width","50%",3,"click","disabled","pTooltip","label"],["type","button","pButton","","tooltipPosition","top","showDelay","500","icon","fa fa-info-circle",1,"p-button-primary",2,"display","inline-flex","height","2.44rem","width","50%",3,"click","disabled","pTooltip","label"],["for","install_interface"],["formControlName","install_interface","name","install_interface",3,"change"],["for","install_ipobj"],["formControlName","install_ipobj","name","install_ipobj",3,"change"],["type","number","pInputText","","min","1","placeholder","Port","formControlName","install_port","name","install_port"],[1,"col-2",2,"align-content","center","padding","0"],[1,"button-container"],[2,"display","block","margin-top","-7px"],[1,"col-6",2,"min-width","0"],["type","button","pButton","","tooltipPosition","top","showDelay","500","icon","fa fa-plug",1,"p-button-primary","responsive-button",3,"click","disabled","pTooltip","label"],[1,"col-6",2,"min-width","0","margin-right","2px"],["type","button","pButton","","tooltipPosition","top","showDelay","500","icon","fa fa-info-circle","id","btnMoreInfo",1,"p-button-primary","responsive-button",3,"click","disabled","pTooltip","label"],[3,"message"],["href","https://www.openvpn.net/","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-openvpn"],["href","https://www.wireguard.com/","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-wireguard"],["href","","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-ipsec"],["href","https://github.com/acassen/keepalived","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-keepalived"],["href","https://ipgeolocation.io/","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-geoip"],["href","https://www.ntop.org/","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-ntopng"],["href","https://www.diladele.com/","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-websafety"],["href","https://dnssafety.diladele.com/","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-dnssafety"],["href","https://suricata.io/","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-suricata"],["href","https://zeek.org/","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-zeek"],["href","https://www.elastic.co/what-is/elasticsearch","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-elasticsearch"],["href","https://www.elastic.co/what-is/kibana","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-kibana"],["href","https://www.elastic.co/logstash/","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-logstash"],["href","https://www.elastic.co/beats/filebeat","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-filebeat"],["href","https://www.isc.org/dhcp/","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-isc-dhcp"],["href","https://www.haproxy.org/","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-ha-proxy"],["href","https://www.isc.org/bind/","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-isc-bind9"],["for","NTOPNG_BUTTON"],["type","button","pButton","","tooltipPosition","top","showDelay","500",1,"p-button-primary",2,"height","2.44rem","width","100%",3,"click","disabled","pTooltip","label"],["for","WEBSAFETYPROXY_BUTTON"],["for","DNSSAFETY_BUTTON"],["for","ELASTICSEARCH_BUTTON"],[1,"col-12","divCentered"],[1,"fwcRestrictionsContainer"],[3,"onHideParent","onRefreshRestrictions","dependencies"],["name","chkOkToDelete","binary","true",3,"ngModelChange","ngModel","label"],[1,"divLoadTemp",3,"ngStyle"],["type","button","pButton","","icon","fa fa-xmark",1,"p-button-danger",3,"label"],["type","button","pButton","","icon","pi pi-trash",1,"p-button-danger",3,"disabled","label"],["type","button","pButton","","icon","fa fa-save",1,"p-button-success",3,"disabled","label"],["type","button","pButton","","icon","pi pi-check",1,"p-button-primary",3,"disabled","label"],["type","button","pButton","","icon","fa fa-xmark",1,"p-button-danger",3,"click","label"],["type","button","pButton","","icon","pi pi-trash",1,"p-button-danger",3,"click","disabled","label"],["type","button","pButton","","icon","fa fa-save",1,"p-button-success",3,"click","disabled","label"],["type","button","pButton","","icon","pi pi-check",1,"p-button-primary",3,"click","disabled","label"],["type","button","pButton","","icon","fa fa-refresh",1,"fwc-left-float","p-button-primary",3,"disabled","label"],["type","button","pButton","","icon","fa fa-trash",1,"p-button-danger",3,"click","disabled","label"],["type","button","pButton","","icon","fa fa-refresh",1,"fwc-left-float","p-button-primary",3,"click","disabled","label"]],template:function(i,t){if(i&1){let n=L();c(0,"p-dialog",5,0),Y("visibleChange",function(l){return h(n),H(t.displayDialog,l)||(t.displayDialog=l),w(l)}),P("onShow",function(l){return h(n),w(t.onShowDialog(l))})("onHide",function(l){return h(n),w(t.onHideDialog(l))}),F(2,gc,5,4,"ng-template",6)(3,Bc,138,123,"form",7)(4,Yc,3,2)(5,ep,2,2,"ng-template",8),_()}i&2&&(Ve(B(7,cc)),W("visible",t.displayDialog),m("modal",!0)("closable",!1),a(3),O(t.firewall?3:-1),a(),O(t.firewallToDelete?4:-1))},dependencies:[tt,qt,Pi,xi,Fi,$t,Zt,Ri,gt,bi,ei,Ai,Ct,Ti,Oi,Hi,On,kt,Ut,Be,lt,Gt,ri,oi,ji,En,Wi,Vi,It,ot],styles:[`p-tabview li a{height:100%;color:var(--fwcDark)!important}p-tabview li.p-highlight .p-tabview-nav-link{color:#dedede!important}.p-tabview-nav-content{font-size:.9rem!important}sts-fwc-firewall-panel>p-dialog>div>div>div.ng-tns-c1623988549-19.p-dialog-content.ng-star-inserted{min-width:100%!important}.button-container{display:flex;width:100%;min-width:0;gap:.5rem}.button-container .col-6{flex:1 1 50%;min-width:0;max-width:100%}.responsive-button{display:flex!important;width:100%!important;height:2.44rem!important;align-items:center!important;justify-content:flex-start!important;min-width:0!important;overflow:hidden;padding:0 .5rem!important}.responsive-button .p-button-label{white-space:nowrap;overflow:hidden;flex:1 1 auto;min-width:0;text-align:center;margin:0 .25rem}.responsive-button#btnMoreInfo .p-button-label{padding-right:3rem}.responsive-button .fa{flex:0 0 auto;margin:0 .25rem;font-size:1rem!important}
`],encapsulation:2})}}return r})();var ip=["inputClusterName"],np=["fwcInterfacesEditor"],op=["nodeInput"],rp=()=>({width:"80vw"}),el=r=>({visibility:r}),Ee=()=>({standalone:!0}),lp=r=>({"background-color":r}),ap=()=>["col-12","lg:col-2"],sp=()=>["col-12","lg:col-3"],cp=()=>["col-4","lg:col-2"],_o=()=>["col-4","lg:col-3"],$r=()=>["col-6","lg:col-2"],tl=(r,u)=>({type:"error",title:r,text:u}),pp=()=>({width:"1.7rem",height:"1.7rem"});function dp(r,u){if(r&1&&(c(0,"div",9)(1,"h6",13),T(2,"i",14),g(3),C(4,"translate"),c(5,"strong"),g(6),_()()()),r&2){let e=d(3);a(3),R(" ",y(4,2,"CLUSTER.MSG_CLUSTER_EDITION.EDIT")," "),a(3),V(e.cluster==null?null:e.cluster.name)}}function _p(r,u){r&1&&(c(0,"div",9)(1,"h6",13),T(2,"i",14),g(3),C(4,"translate"),_()()),r&2&&(a(3),R(" ",y(4,1,"CLUSTER.MSG_CLUSTER_EDITION.NEW")," "))}function up(r,u){if(r&1&&F(0,dp,7,4,"div",9)(1,_p,5,3,"div",9),r&2){let e=d(2);O(e.cluster!=null&&e.cluster.id?0:1)}}function fp(r,u){if(r&1&&(c(0,"div",9)(1,"h6",13),T(2,"i",15),g(3),C(4,"translate"),c(5,"strong"),g(6),_()()()),r&2){let e=d(2);a(3),R(" ",y(4,2,"CLUSTER.MSG_CLUSTER_EDITION.DELETE")," "),a(3),V(e.clusterToDelete._fwcObjName)}}function mp(r,u){if(r&1){let e=L();c(0,"button",16),P("click",function(){h(e);let t=d(2);return w(t.showHelp())}),_()}if(r&2){let e=d(2);m("disabled",e.loadingData)}}function hp(r,u){if(r&1){let e=L();F(0,up,2,1)(1,fp,7,4,"div",9),c(2,"div",10),F(3,mp,1,1,"button",11),c(4,"button",12),P("click",function(){h(e);let t=d();return w(t.minimizeDialog())}),_()()}if(r&2){let e=d();O(e.cluster?0:-1),a(),O(e.clusterToDelete?1:-1),a(2),O(e.helpSection?3:-1),a(),m("disabled",e.loadingData)}}function wp(r,u){if(r&1&&(c(0,"option",30),g(1),_()),r&2){let e=u.$implicit;m("ngValue",e.id),a(),R(" ",e.name," ")}}function Sp(r,u){r&1&&(c(0,"p",60),g(1),C(2,"translate"),_()),r&2&&(a(),R(" ",y(2,1,"ITEM_PANEL.ERRORS.FIELD_INVALID_NAME")," "))}function gp(r,u){if(r&1){let e=L();c(0,"div",67)(1,"div",57)(2,"select",68),P("change",function(){return h(e),w(!0)}),c(3,"option",69),g(4),C(5,"translate"),_(),c(6,"option",70),g(7,"HTTPS"),_(),c(8,"option",71),g(9,"HTTP"),_()()()(),c(10,"div",72)(11,"div",57),T(12,"input",73),C(13,"translate"),c(14,"button",74),P("mousedown",function(){h(e);let t=d().$index,n=d(2);return w(n.displayApiKey[t]=!0)})("mouseup",function(){h(e);let t=d().$index,n=d(2);return w(n.displayApiKey[t]=!1)})("mouseout",function(){h(e);let t=d().$index,n=d(2);return w(n.displayApiKey[t]=!1)}),_()()()}if(r&2){let e=d().$index,i=d(2);a(3),m("value",null),a(),R(" ",y(5,5,"FW.MSG_FW_EDITION.AGENT_PROTOCOL")," "),a(8),D("placeholder",y(13,7,"FW.MSG_FW_EDITION.AGENT_APIKEY")),m("showPassword",i.displayApiKey[e])("feedback",!1)}}function Cp(r,u){r&1&&(c(0,"p",60),g(1),C(2,"translate"),_()),r&2&&(a(),R(" ",y(2,1,"ITEM_PANEL.ERRORS.FIELD_USERNAME")," "))}function yp(r,u){if(r&1){let e=L();c(0,"div",75),T(1,"input",76),C(2,"translate"),F(3,Cp,3,3,"p",60),_(),c(4,"div",56)(5,"div",57),T(6,"input",77),C(7,"translate"),C(8,"translate"),C(9,"translate"),C(10,"translate"),C(11,"translate"),c(12,"button",74),P("mousedown",function(){h(e);let t=d().$index,n=d(2);return w(n.displaySSH[t]=!0)})("mouseup",function(){h(e);let t=d().$index,n=d(2);return w(n.displaySSH[t]=!1)})("mouseout",function(){h(e);let t=d().$index,n=d(2);return w(n.displaySSH[t]=!1)}),_()()()}if(r&2){let e=d(),i=e.$implicit,t=e.$index,n=d(2);m("ngClass",n.interfaces!=null&&n.interfaces.length||n.discoveredInstallOptions.has(i.get("firewallUUID").value)?B(24,$r):B(25,_o)),a(),yi("id","fwSSHUser",t,""),D("placeholder",y(2,12,"CLUSTER.MSG_CLUSTER_EDITION.SSH_USER")),a(2),O(!i.get("install_user").valid&&!i.get("install_user").pristine?3:-1),a(),m("ngClass",n.interfaces!=null&&n.interfaces.length||n.discoveredInstallOptions.has(i.get("firewallUUID").value)?B(26,$r):B(27,_o)),a(2),D("placeholder",y(7,14,"CLUSTER.MSG_CLUSTER_EDITION.SSH_PASS")),m("showPassword",n.displaySSH[t])("promptLabel",y(8,16,"GLOBALS.MSG_PASSWORD.PASS"))("weakLabel",y(9,18,"GLOBALS.MSG_PASSWORD.WEAK"))("mediumLabel",y(10,20,"GLOBALS.MSG_PASSWORD.NORMAL"))("strongLabel",y(11,22,"GLOBALS.MSG_PASSWORD.SAFE"))}}function Ep(r,u){if(r&1&&(c(0,"div",78)(1,"div",57)(2,"label"),T(3,"i",79),C(4,"translate"),_(),T(5,"input",80),_()(),c(6,"div",78)(7,"div",57),T(8,"input",80),_()()),r&2){let e,i,t=d().$implicit,n=d(2);a(3),D("pTooltip",y(4,3,"FW.MSG_FW_EDITION.TOOLTIP_NEW_INSTALL")),a(2),D("value",(e=n.discoveredInstallOptions.get(t.get("firewallUUID").value).interface)==null?null:e.name),a(3),D("value",((i=n.discoveredInstallOptions.get(t.get("firewallUUID").value).ipobj)==null?null:i.address)+" ("+((i=n.discoveredInstallOptions.get(t.get("firewallUUID").value).ipobj)==null?null:i.name)+")")}}function vp(r,u){if(r&1&&(c(0,"option",83),g(1),_()),r&2){let e=u.$implicit;m("value",e.id),a(),vi(" ",e.id," - ",e.name," ")}}function Ip(r,u){if(r&1){let e=L();c(0,"div",81)(1,"select",82),P("change",function(t){h(e);let n=d(2).$index,o=d(2);return w(o.onInterfaceChange(n,t.target.value))}),c(2,"option",69),g(3),C(4,"translate"),_(),xe(5,vp,2,3,"option",83,Re),_()()}if(r&2){let e=d(4);a(2),m("value",null),a(),R(" ",y(4,2,"GLOBALS.MSG_OBJ_TYPES.OBJ_INTERFACE_FIREWALL")," "),a(2),Fe(e.interfaces)}}function bp(r,u){if(r&1&&(c(0,"span"),g(1),_()),r&2){let e=d().$implicit;a(),R("(",e.address,")")}}function Pp(r,u){r&1&&(c(0,"span"),g(1),C(2,"translate"),_()),r&2&&(a(),R("(",y(2,1,"CLUSTER.MSG_CLUSTER_EDITION.NO_IP"),")"))}function Tp(r,u){if(r&1&&(c(0,"option",83),g(1),F(2,bp,2,1,"span")(3,Pp,3,3,"span"),_()),r&2){let e=u.$implicit;m("value",e.id),a(),R(" ",e.name,"\xA0 "),a(),O(e.address?2:-1),a(),O(e.address?-1:3)}}function Op(r,u){if(r&1){let e=L();c(0,"div",81)(1,"select",84),P("change",function(){h(e);let t=d(2).$index,n=d(2);return w(n.onChangeInstallData(t))}),c(2,"option",69),g(3),C(4,"translate"),_(),xe(5,Tp,4,4,"option",83,Re),_()()}if(r&2){let e=d(2),i=e.$implicit,t=e.$index,n=d(2);a(),yi("name","fwIP",t,""),a(),m("value",null),a(),R(" ",y(4,4,"GLOBALS.MSG_OBJ_TYPES.OBJ_ADDRESS")," "),a(2),Fe(n.interfacesIpObjs.get(i.get("firewallUUID").value))}}function Rp(r,u){if(r&1&&F(0,Ip,7,4,"div",81)(1,Op,7,6,"div",81),r&2){let e=d(3);O(e.interfaces.length?0:-1),a(),O(e.interfaces.length?1:-1)}}function xp(r,u){r&1&&(T(0,"input",61),C(1,"translate")),r&2&&D("placeholder",y(1,1,"CLUSTER.MSG_CLUSTER_EDITION.PORT"))}function Fp(r,u){if(r&1){let e=L();c(0,"button",85),C(1,"translate"),P("click",function(){h(e);let t=d().$implicit,n=d(2);return w(n.onTestFwcAgentCommunication(t))}),_()}if(r&2){let e=d().$implicit,i=d(2);D("pTooltip",y(1,2,"FW.MSG_FW_EDITION.AGENT_TEST_LONG")),m("disabled",i.loadingData||e.get("install_protocol").invalid||e.get("install_apikey").invalid||e.get("install_port").invalid||!i.NodeHaveDiscoveredIp(e))}}function Ap(r,u){if(r&1){let e=L();c(0,"button",86),C(1,"translate"),P("click",function(){h(e);let t=d().$implicit,n=d(2);return w(n.showClusterInfo(t))}),_()}if(r&2){let e=d().$implicit,i=d(2);D("pTooltip",y(1,2,"FW.FW_MORE_INFO.AGENT_TOOLTIP")),m("disabled",i.loadingData||e.get("install_protocol").invalid||e.get("install_apikey").invalid||e.get("install_port").invalid||!i.NodeHaveDiscoveredIp(e))}}function Lp(r,u){if(r&1){let e=L();c(0,"button",87),C(1,"translate"),P("click",function(){h(e);let t=d().$index,n=d(2);return w(n.nodeRemove(t))}),_()}if(r&2){let e=d(3);D("pTooltip",y(1,2,"CLUSTER.MSG_CLUSTER_EDITION.TT_NODE_DELETE")),m("disabled",e.loadingData)}}function Mp(r,u){if(r&1){let e=L();c(0,"button",88),C(1,"translate"),P("click",function(){h(e);let t=d().$index,n=d(2);return w(n.nodeAdd(t))}),_()}if(r&2){let e=d(3);D("pTooltip",y(1,2,"CLUSTER.MSG_CLUSTER_EDITION.TT_NODE_ADD")),m("disabled",e.loadingData)}}function Dp(r,u){if(r&1){let e=L();c(0,"div",37)(1,"div",56)(2,"div",57)(3,"button",58),C(4,"translate"),C(5,"translate"),P("click",function(){let t=h(e).$implicit,n=d(2);return w(n.onClusterNodeInstallCommChange(t))}),_(),c(6,"input",59,4),C(8,"translate"),P("change",function(){let t=h(e).$implicit,n=d(2);return w(n.onClusterNodeNameChange(t))}),_()(),F(9,Sp,3,3,"p",60),_(),F(10,gp,15,9)(11,yp,13,28)(12,Ep,9,5)(13,Rp,2,2),c(14,"div",56)(15,"div",57),F(16,xp,2,3,"input",61)(17,Fp,2,4,"button",62)(18,Ap,2,4,"button",63)(19,Lp,2,4,"button",64)(20,Mp,2,4,"button",65),c(21,"button",66),C(22,"translate"),P("click",function(){let t=h(e).$index,n=d(2);return w(n.nodeAutoDiscoverInterfaces(t))}),_()()()()}if(r&2){let e,i,t,n=u.$implicit,o=u.$index,l=d(2);m("ngStyle",Ie(28,lp,o?"":"aliceblue"))("formGroupName",o),a(),m("ngClass",l.interfaces!=null&&l.interfaces.length||l.discoveredInstallOptions.has(n.get("firewallUUID").value)?B(30,ap):B(31,sp)),a(2),m("icon",n.get("install_communication").value==="agent"?"fa fa-user-secret":"fa fa-terminal")("disabled",l.loadingData)("pTooltip",n.get("install_communication").value==="agent"?y(4,20,"CLUSTER.MSG_CLUSTER_EDITION.COMM_FWCAGENT"):y(5,22,"CLUSTER.MSG_CLUSTER_EDITION.COMM_SSH")),a(3),yi("id","fwName",o,""),D("placeholder",y(8,24,"CLUSTER.MSG_CLUSTER_EDITION.NODE_NAME")),a(3),O(!n.get("name").valid&&!n.get("name").pristine?9:-1),a(),O(n.get("install_communication").value==="agent"?10:11),a(2),O(l.discoveredInstallOptions.has(n.get("firewallUUID").value)?12:13),a(2),m("ngClass",l.interfaces!=null&&l.interfaces.length||l.discoveredInstallOptions.has(n.get("firewallUUID").value)?B(32,cp):B(33,_o)),a(2),O(l.interfaces.length||n.get("install_port")?16:-1),a(),O(((e=n.get("install_communication"))==null?null:e.value)==="agent"?17:-1),a(),O(((i=n.get("install_communication"))==null?null:i.value)==="agent"?18:-1),a(),O((t=n.get("id"))!=null&&t.value&&l.getNumberOfExistingNodes()>1||!((t=n.get("id"))!=null&&t.value)&&l.getFormNodes().controls.length>1?19:-1),a(),O(o+1==l.getFormNodes().controls.length?20:-1),a(),D("pTooltip",y(22,26,"CLUSTER.MSG_CLUSTER_EDITION.TT_NODE_DISCOVER")),m("disabled",l.loadingData)}}function Np(r,u){if(r&1&&(c(0,"div",20)(1,"div",21),T(2,"sts-fwc-message",89),_()()),r&2){let e=d(2);a(2),m("message",et(1,tl,e.translate.instant("PLUGINS.TITLE"),e.translate.instant("PLUGINS.ERRORS.COMMUNICATION.TEXT")))}}function Gp(r,u){if(r&1){let e=L();c(0,"div",20)(1,"div",42)(2,"h5",22),g(3),C(4,"translate"),_()(),c(5,"div",23)(6,"div",21)(7,"div",24)(8,"p-checkbox",44),Y("ngModelChange",function(t){h(e);let n=d(2);return H(n.optionsPlugins.openvpn,t)||(n.optionsPlugins.openvpn=t),w(t)}),P("onChange",function(){h(e);let t=d(2);return w(t.onChangePlugins())}),_(),g(9," \xA0\xA0 "),c(10,"a",90),ie(),c(11,"svg",46),T(12,"use",91),_()(),ne(),c(13,"p",36),g(14),C(15,"translate"),_()()(),c(16,"div",21)(17,"div",24)(18,"p-checkbox",44),Y("ngModelChange",function(t){h(e);let n=d(2);return H(n.optionsPlugins.wireguard,t)||(n.optionsPlugins.wireguard=t),w(t)}),P("onChange",function(){h(e);let t=d(2);return w(t.onChangePlugins())}),_(),g(19," \xA0\xA0 "),c(20,"a",92),ie(),c(21,"svg",46),T(22,"use",93),_()(),ne(),c(23,"p",36),g(24),C(25,"translate"),_()()(),c(26,"div",21)(27,"div",24)(28,"p-checkbox",44),Y("ngModelChange",function(t){h(e);let n=d(2);return H(n.optionsPlugins.ipsec,t)||(n.optionsPlugins.ipsec=t),w(t)}),P("onChange",function(){h(e);let t=d(2);return w(t.onChangePlugins())}),_(),g(29," \xA0\xA0 "),c(30,"a",94),ie(),c(31,"svg",46),T(32,"use",95),_()(),ne(),c(33,"p",36),g(34),C(35,"translate"),_()()(),c(36,"div",21)(37,"div",24)(38,"p-checkbox",44),Y("ngModelChange",function(t){h(e);let n=d(2);return H(n.optionsPlugins.keepalived,t)||(n.optionsPlugins.keepalived=t),w(t)}),P("onChange",function(){h(e);let t=d(2);return w(t.onChangePlugins())}),_(),g(39," \xA0\xA0 "),c(40,"a",96),ie(),c(41,"svg",46),T(42,"use",97),_()(),ne(),c(43,"p",36),g(44),C(45,"translate"),_()()(),c(46,"div",21)(47,"div",24)(48,"p-checkbox",44),Y("ngModelChange",function(t){h(e);let n=d(2);return H(n.optionsPlugins.geoip,t)||(n.optionsPlugins.geoip=t),w(t)}),P("onChange",function(){h(e);let t=d(2);return w(t.onChangePlugins())}),_(),g(49," \xA0\xA0 "),c(50,"a",98),ie(),c(51,"svg",46),T(52,"use",99),_()(),ne(),c(53,"p",36),g(54),C(55,"translate"),_()()(),c(56,"div",21)(57,"div",24)(58,"p-checkbox",44),Y("ngModelChange",function(t){h(e);let n=d(2);return H(n.optionsPlugins.crowdsec,t)||(n.optionsPlugins.crowdsec=t),w(t)}),P("onChange",function(){h(e);let t=d(2);return w(t.onChangePlugins())}),_(),g(59," \xA0\xA0 "),c(60,"a",49),ie(),c(61,"svg",46),T(62,"use",50),_()(),ne(),c(63,"p",36),g(64),C(65,"translate"),_()()(),c(66,"div",21)(67,"div",24)(68,"p-checkbox",44),Y("ngModelChange",function(t){h(e);let n=d(2);return H(n.optionsPlugins.ntopng,t)||(n.optionsPlugins.ntopng=t),w(t)}),P("onChange",function(){h(e);let t=d(2);return w(t.onChangePlugins())}),_(),g(69," \xA0\xA0 "),c(70,"a",100),ie(),c(71,"svg",46),T(72,"use",101),_()(),ne(),c(73,"p",36),g(74),C(75,"translate"),_()()(),c(76,"div",21)(77,"div",24)(78,"p-checkbox",44),Y("ngModelChange",function(t){h(e);let n=d(2);return H(n.optionsPlugins.websafety,t)||(n.optionsPlugins.websafety=t),w(t)}),P("onChange",function(){h(e);let t=d(2);return w(t.onChangePlugins())}),_(),g(79," \xA0\xA0 "),c(80,"a",102),ie(),c(81,"svg",46),T(82,"use",103),_()(),ne(),c(83,"p",36),g(84),C(85,"translate"),_()()(),c(86,"div",21)(87,"div",24)(88,"p-checkbox",44),Y("ngModelChange",function(t){h(e);let n=d(2);return H(n.optionsPlugins.dnssafety,t)||(n.optionsPlugins.dnssafety=t),w(t)}),P("onChange",function(){h(e);let t=d(2);return w(t.onChangePlugins())}),_(),g(89," \xA0\xA0 "),c(90,"a",104),ie(),c(91,"svg",46),T(92,"use",105),_()(),ne(),c(93,"p",36),g(94),C(95,"translate"),_()()()(),c(96,"div",23)(97,"div",21)(98,"div",24)(99,"p-checkbox",44),Y("ngModelChange",function(t){h(e);let n=d(2);return H(n.optionsPlugins.suricata,t)||(n.optionsPlugins.suricata=t),w(t)}),P("onChange",function(){h(e);let t=d(2);return w(t.onChangePlugins())}),_(),g(100," \xA0\xA0 "),c(101,"a",106),ie(),c(102,"svg",46),T(103,"use",107),_()(),ne(),c(104,"p",36),g(105),C(106,"translate"),_()()(),c(107,"div",21)(108,"div",24)(109,"p-checkbox",44),Y("ngModelChange",function(t){h(e);let n=d(2);return H(n.optionsPlugins.zeek,t)||(n.optionsPlugins.zeek=t),w(t)}),P("onChange",function(){h(e);let t=d(2);return w(t.onChangePlugins())}),_(),g(110," \xA0\xA0 "),c(111,"a",108),ie(),c(112,"svg",46),T(113,"use",109),_()(),ne(),c(114,"p",36),g(115),C(116,"translate"),_()()(),c(117,"div",21)(118,"div",24)(119,"p-checkbox",44),Y("ngModelChange",function(t){h(e);let n=d(2);return H(n.optionsPlugins.elasticsearch,t)||(n.optionsPlugins.elasticsearch=t),w(t)}),P("onChange",function(){h(e);let t=d(2);return w(t.onChangePlugins())}),_(),g(120," \xA0\xA0 "),c(121,"a",110),ie(),c(122,"svg",46),T(123,"use",111),_()(),ne(),c(124,"p",36),g(125),C(126,"translate"),_()()(),c(127,"div",21)(128,"div",24)(129,"p-checkbox",44),Y("ngModelChange",function(t){h(e);let n=d(2);return H(n.optionsPlugins.kibana,t)||(n.optionsPlugins.kibana=t),w(t)}),P("onChange",function(){h(e);let t=d(2);return w(t.onChangePlugins())}),_(),g(130," \xA0\xA0 "),c(131,"a",112),ie(),c(132,"svg",46),T(133,"use",113),_()(),ne(),c(134,"p",36),g(135),C(136,"translate"),_()()(),c(137,"div",21)(138,"div",24)(139,"p-checkbox",44),Y("ngModelChange",function(t){h(e);let n=d(2);return H(n.optionsPlugins.logstash,t)||(n.optionsPlugins.logstash=t),w(t)}),P("onChange",function(){h(e);let t=d(2);return w(t.onChangePlugins())}),_(),g(140," \xA0\xA0 "),c(141,"a",114),ie(),c(142,"svg",46),T(143,"use",115),_()(),ne(),c(144,"p",36),g(145),C(146,"translate"),_()()(),c(147,"div",21)(148,"div",24)(149,"p-checkbox",44),Y("ngModelChange",function(t){h(e);let n=d(2);return H(n.optionsPlugins.filebeat,t)||(n.optionsPlugins.filebeat=t),w(t)}),P("onChange",function(){h(e);let t=d(2);return w(t.onChangePlugins())}),_(),g(150," \xA0\xA0 "),c(151,"a",116),ie(),c(152,"svg",46),T(153,"use",117),_()(),ne(),c(154,"p",36),g(155),C(156,"translate"),_()()(),c(157,"div",21)(158,"div",24)(159,"p-checkbox",44),Y("ngModelChange",function(t){h(e);let n=d(2);return H(n.optionsPlugins.iscdhcp,t)||(n.optionsPlugins.iscdhcp=t),w(t)}),P("onChange",function(){h(e);let t=d(2);return w(t.onChangePlugins())}),_(),g(160," \xA0\xA0 "),c(161,"a",118),ie(),c(162,"svg",46),T(163,"use",119),_()(),ne(),c(164,"p",36),g(165),C(166,"translate"),_()()(),c(167,"div",21)(168,"div",24)(169,"p-checkbox",44),Y("ngModelChange",function(t){h(e);let n=d(2);return H(n.optionsPlugins.haproxy,t)||(n.optionsPlugins.haproxy=t),w(t)}),P("onChange",function(){h(e);let t=d(2);return w(t.onChangePlugins())}),_(),g(170," \xA0\xA0 "),c(171,"a",120),ie(),c(172,"svg",46),T(173,"use",121),_()(),ne(),c(174,"p",36),g(175),C(176,"translate"),_()()(),c(177,"div",21)(178,"div",24)(179,"p-checkbox",44),Y("ngModelChange",function(t){h(e);let n=d(2);return H(n.optionsPlugins.iscbind9,t)||(n.optionsPlugins.iscbind9=t),w(t)}),P("onChange",function(){h(e);let t=d(2);return w(t.onChangePlugins())}),_(),g(180," \xA0\xA0 "),c(181,"a",122),ie(),c(182,"svg",46),T(183,"use",123),_()(),ne(),c(184,"p",36),g(185),C(186,"translate"),_()()()()()}if(r&2){let e=d(2);a(3),R(" ",y(4,73,"FW.MSG_FW_EDITION.PLUGINS")," "),a(5),m("binary",!0),W("ngModel",e.optionsPlugins.openvpn),m("ngModelOptions",B(111,Ee)),a(6),R("\xA0\xA0",y(15,75,"CLUSTER.PLUGINS.OPENVPN"),""),a(4),m("binary",!0),W("ngModel",e.optionsPlugins.wireguard),m("ngModelOptions",B(112,Ee)),a(6),R("\xA0\xA0",y(25,77,"FW.PLUGINS.WIREGUARD"),""),a(4),m("binary",!0),W("ngModel",e.optionsPlugins.ipsec),m("ngModelOptions",B(113,Ee)),a(6),R("\xA0\xA0",y(35,79,"FW.PLUGINS.IPSEC"),""),a(4),m("binary",!0),W("ngModel",e.optionsPlugins.keepalived),m("ngModelOptions",B(114,Ee)),a(6),R("\xA0\xA0",y(45,81,"CLUSTER.PLUGINS.KEEPALIVED"),""),a(4),m("binary",!0),W("ngModel",e.optionsPlugins.geoip),m("ngModelOptions",B(115,Ee)),a(6),R("\xA0\xA0",y(55,83,"CLUSTER.PLUGINS.GEOIP"),""),a(4),m("binary",!0),W("ngModel",e.optionsPlugins.crowdsec),m("ngModelOptions",B(116,Ee)),a(6),R("\xA0\xA0",y(65,85,"CLUSTER.PLUGINS.CROWDSEC"),""),a(4),m("binary",!0),W("ngModel",e.optionsPlugins.ntopng),m("ngModelOptions",B(117,Ee)),a(6),R("\xA0\xA0",y(75,87,"CLUSTER.PLUGINS.NTOPNG"),""),a(4),m("binary",!0),W("ngModel",e.optionsPlugins.websafety),m("ngModelOptions",B(118,Ee)),a(6),R("\xA0\xA0",y(85,89,"CLUSTER.PLUGINS.WEBSAFETY"),""),a(4),m("binary",!0),W("ngModel",e.optionsPlugins.dnssafety),m("ngModelOptions",B(119,Ee)),a(6),R("\xA0\xA0",y(95,91,"CLUSTER.PLUGINS.DNSSAFETY"),""),a(5),m("binary",!0),W("ngModel",e.optionsPlugins.suricata),m("ngModelOptions",B(120,Ee)),a(6),R("\xA0\xA0",y(106,93,"CLUSTER.PLUGINS.SURICATA"),""),a(4),m("binary",!0),W("ngModel",e.optionsPlugins.zeek),m("ngModelOptions",B(121,Ee)),a(6),R("\xA0\xA0",y(116,95,"CLUSTER.PLUGINS.ZEEK"),""),a(4),m("binary",!0),W("ngModel",e.optionsPlugins.elasticsearch),m("ngModelOptions",B(122,Ee)),a(6),R("\xA0\xA0",y(126,97,"CLUSTER.PLUGINS.ELASTICSEARCH"),""),a(4),m("binary",!0),W("ngModel",e.optionsPlugins.kibana),m("ngModelOptions",B(123,Ee)),a(6),R("\xA0\xA0",y(136,99,"CLUSTER.PLUGINS.KIBANA"),""),a(4),m("binary",!0),W("ngModel",e.optionsPlugins.logstash),m("ngModelOptions",B(124,Ee)),a(6),R("\xA0\xA0",y(146,101,"CLUSTER.PLUGINS.LOGSTASH"),""),a(4),m("binary",!0),W("ngModel",e.optionsPlugins.filebeat),m("ngModelOptions",B(125,Ee)),a(6),R("\xA0\xA0",y(156,103,"CLUSTER.PLUGINS.FILEBEAT"),""),a(4),m("binary",!0),W("ngModel",e.optionsPlugins.iscdhcp),m("ngModelOptions",B(126,Ee)),a(6),R("\xA0\xA0",y(166,105,"FW.PLUGINS.ISCDHCP"),""),a(4),m("binary",!0),W("ngModel",e.optionsPlugins.haproxy),m("ngModelOptions",B(127,Ee)),a(6),R("\xA0\xA0",y(176,107,"FW.PLUGINS.HAPROXY"),""),a(4),m("binary",!0),W("ngModel",e.optionsPlugins.iscbind9),m("ngModelOptions",B(128,Ee)),a(6),R("\xA0\xA0",y(186,109,"FW.PLUGINS.ISCBIND9"),"")}}function Up(r,u){if(r&1&&(c(0,"div",20)(1,"div",21),T(2,"sts-fwc-message",89),_()()),r&2){let e=d(2);a(2),m("message",et(1,tl,e.translate.instant("NGFW.TITLE"),e.translate.instant("NGFW.ERRORS.COMMUNICATION.TEXT")))}}function Bp(r,u){if(r&1){let e=L();c(0,"div",20)(1,"div",42)(2,"h5",22),g(3),C(4,"translate"),_()(),g(5," \xA0 "),c(6,"div",20)(7,"div",72)(8,"label",124)(9,"a",100),ie(),c(10,"svg",46),T(11,"use",101),_()(),g(12),C(13,"translate"),_(),ne(),c(14,"button",125),C(15,"translate"),C(16,"translate"),P("click",function(){h(e);let t=d(2);return w(t.onClickButtonNGFW("NTOPNG",t.node))}),_()(),c(17,"div",72)(18,"label",126)(19,"a",102),ie(),c(20,"svg",46),T(21,"use",103),_()(),g(22),C(23,"translate"),_(),ne(),c(24,"button",125),C(25,"translate"),C(26,"translate"),P("click",function(){h(e);let t=d(2);return w(t.onClickButtonNGFW("WEBSAFETYPROXY",t.node))}),_()(),c(27,"div",72)(28,"label",127)(29,"a",104),ie(),c(30,"svg",46),T(31,"use",105),_()(),g(32),C(33,"translate"),_(),ne(),c(34,"button",125),C(35,"translate"),C(36,"translate"),P("click",function(){h(e);let t=d(2);return w(t.onClickButtonNGFW("DNSSAFETY",t.node))}),_()(),c(37,"div",72)(38,"label",128)(39,"a",110),ie(),c(40,"svg",46),T(41,"use",111),_()(),g(42),C(43,"translate"),_(),ne(),c(44,"button",125),C(45,"translate"),C(46,"translate"),P("click",function(){h(e);let t=d(2);return w(t.onClickButtonNGFW("ELASTICSEARCH",t.node))}),_()()()()}if(r&2){let e=d(2);a(3),R(" ",y(4,17,"NGFW.DESCRIPTION")," "),a(9),R(" ",y(13,19,"CONTEXT.FW.NTOPNG"),""),a(2),D("pTooltip",y(15,21,"CONTEXT.FW.NTOPNG")),D("label",y(16,23,"CONTEXT.FW.NTOPNG")),m("disabled",!e.checksNodeNtopNGConfig()),a(8),R(" ",y(23,25,"CONTEXT.FW.WEBSAFETYPROXY"),""),a(2),D("pTooltip",y(25,27,"CONTEXT.FW.WEBSAFETYPROXY")),D("label",y(26,29,"CONTEXT.FW.WEBSAFETYPROXY")),m("disabled",!e.checksNodeWebSafetyProxyActie()),a(8),R(" ",y(33,31,"CONTEXT.FW.DNSSAFETY"),""),a(2),D("pTooltip",y(35,33,"CONTEXT.FW.DNSSAFETY")),D("label",y(36,35,"CONTEXT.FW.DNSSAFETY")),m("disabled",!e.checksNodeDNSSafetyActive()),a(8),R(" ",y(43,37,"CLUSTER.PLUGINS.ELASTICSEARCH"),""),a(2),D("pTooltip",y(45,39,"CLUSTER.PLUGINS.ELASTICSEARCH")),D("label",y(46,41,"CLUSTER.PLUGINS.ELASTICSEARCH")),m("disabled",!e.checksNodeElasticSearchActive())}}function kp(r,u){if(r&1){let e=L();c(0,"form",17),P("keyup.enter",function(t){h(e);let n=d();return w(n.checkForm(t))})("keyup.esc",function(){h(e);let t=d();return w(t.onCancel())}),c(1,"p-tabView",18),P("onChange",function(t){h(e);let n=d();return w(n.onChangeTab(t))}),c(2,"p-tabPanel",19),C(3,"translate"),c(4,"div",20)(5,"div",21)(6,"h5",22),g(7),C(8,"translate"),_()(),c(9,"div",23)(10,"div",24)(11,"label",25),g(12),C(13,"translate"),_(),T(14,"input",26,1),C(16,"translate"),_(),c(17,"p",27),g(18),C(19,"translate"),_()(),c(20,"div",23)(21,"div",24)(22,"label",28),g(23),C(24,"translate"),_(),c(25,"select",29,2),P("change",function(){h(e);let t=d();return w(t.changeCompilerOptions())}),xe(27,wp,2,2,"option",30,Re),_()()(),c(29,"div",31)(30,"div",24)(31,"label",32),g(32),C(33,"translate"),_()()(),c(34,"div",33),T(35,"textarea",34),_()(),c(36,"div",35)(37,"div",21)(38,"h5",36),g(39),C(40,"translate"),_()(),xe(41,Dp,23,34,"div",37,Re),_()(),c(43,"p-tabPanel",38),C(44,"translate"),c(45,"sts-fwc-interfaces-tree-editor",39,3),P("onInstallModified",function(t){h(e);let n=d();return w(n.onEditorInstallModified(t))})("onIpObjectModified",function(t){h(e);let n=d();return w(n.onEditorInterfaceOrIpModified(t))})("onStartAutodiscover",function(){h(e);let t=d();return w(t.onDiscoverInterfaces(!0))}),_()(),c(47,"p-tabPanel",40),C(48,"translate"),T(49,"input",41),c(50,"div",20)(51,"div",42)(52,"h5",22),g(53),C(54,"translate"),_()(),c(55,"div",23)(56,"div",21)(57,"div",24)(58,"p-checkbox",43),Y("ngModelChange",function(t){h(e);let n=d();return H(n.optionsFlags.stateful,t)||(n.optionsFlags.stateful=t),w(t)}),P("onChange",function(){h(e);let t=d();return w(t.setFormOptionsFlags())}),_()()(),c(59,"div",21)(60,"div",24)(61,"p-checkbox",43),Y("ngModelChange",function(t){h(e);let n=d();return H(n.optionsFlags.ipv4,t)||(n.optionsFlags.ipv4=t),w(t)}),P("onChange",function(){h(e);let t=d();return w(t.setFormOptionsFlags())}),_()()(),c(62,"div",21)(63,"div",24)(64,"p-checkbox",43),Y("ngModelChange",function(t){h(e);let n=d();return H(n.optionsFlags.ipv6,t)||(n.optionsFlags.ipv6=t),w(t)}),P("onChange",function(){h(e);let t=d();return w(t.setFormOptionsFlags())}),_()()(),c(65,"div",21)(66,"div",24)(67,"p-checkbox",43),Y("ngModelChange",function(t){h(e);let n=d();return H(n.optionsFlags.debug,t)||(n.optionsFlags.debug=t),w(t)}),P("onChange",function(){h(e);let t=d();return w(t.setFormOptionsFlags())}),_()()(),c(68,"div",21)(69,"div",24)(70,"p-checkbox",43),Y("ngModelChange",function(t){h(e);let n=d();return H(n.optionsFlags.report,t)||(n.optionsFlags.report=t),w(t)}),P("onChange",function(){h(e);let t=d();return w(t.setFormOptionsFlags())}),_()()()(),c(71,"div",23)(72,"div",21)(73,"div",24)(74,"p-checkbox",44),Y("ngModelChange",function(t){h(e);let n=d();return H(n.optionsFlags.docker,t)||(n.optionsFlags.docker=t),w(t)}),P("onChange",function(){h(e);let t=d();return w(t.setFormOptionsFlags())}),_(),g(75," \xA0\xA0 "),c(76,"a",45),ie(),c(77,"svg",46),T(78,"use",47),_()(),g(79," \xA0\xA0 "),ne(),c(80,"p",36),g(81),C(82,"translate"),_(),c(83,"a",48),g(84,"(+ info)"),_()()(),c(85,"div",21)(86,"div",24)(87,"p-checkbox",44),Y("ngModelChange",function(t){h(e);let n=d();return H(n.optionsFlags.crowdsec,t)||(n.optionsFlags.crowdsec=t),w(t)}),P("onChange",function(){h(e);let t=d();return w(t.setFormOptionsFlags())}),_(),g(88," \xA0\xA0 "),c(89,"a",49),ie(),c(90,"svg",46),T(91,"use",50),_()(),g(92," \xA0\xA0 "),ne(),c(93,"p",36),g(94),C(95,"translate"),_()()(),c(96,"div",21)(97,"div",24)(98,"p-checkbox",44),Y("ngModelChange",function(t){h(e);let n=d();return H(n.optionsFlags.fail2ban,t)||(n.optionsFlags.fail2ban=t),w(t)}),P("onChange",function(){h(e);let t=d();return w(t.setFormOptionsFlags())}),_(),g(99," \xA0\xA0 "),c(100,"a",51),ie(),c(101,"svg",46),T(102,"use",52),_()(),g(103," \xA0\xA0 "),ne(),c(104,"p",36),g(105),C(106,"translate"),_()()()()()(),c(107,"p-tabPanel",53),C(108,"translate"),T(109,"input",54),F(110,Np,3,4,"div",20)(111,Gp,187,129,"div",20),_(),c(112,"p-tabPanel",55),C(113,"translate"),F(114,Up,3,4,"div",20)(115,Bp,47,43,"div",20),_()()()}if(r&2){let e=d();m("formGroup",e.formModel),a(),m("activeIndex",e.shownPanel),a(),D("header",y(3,61,"CLUSTER.MSG_CLUSTER_TAB.CT_0")),m("selected",!0)("disabled",e.loadingData),a(5),R(" ",y(8,63,"CLUSTER.MSG_CLUSTER_EDITION.BASIC")," "),a(5),V(y(13,65,"CLUSTER.MSG_CLUSTER_EDITION.NAME")),a(2),D("placeholder",y(16,67,"CLUSTER.MSG_CLUSTER_EDITION.NAME")),a(3),m("ngStyle",Ie(93,el,e.formModel.get("name").valid||e.formModel.get("name").pristine?"hidden":"visible")),a(),R(" ",y(19,69,"ITEM_PANEL.ERRORS.FIELD_INVALID_NAME")," "),a(5),V(y(24,71,"FW.MSG_FW_EDITION.COMPILER")),a(4),Fe(e.FirewallCompilerOptions),a(5),R("",y(33,73,"CLUSTER.MSG_CLUSTER_EDITION.DESC")," "),a(3),m("rows",3),a(4),R(" ",y(40,75,"CLUSTER.MSG_CLUSTER_EDITION.NODES")," "),a(2),Fe(e.getFormNodes().controls),a(2),D("header",y(44,77,"FW.MSG_FW_TAB.FT_1")),m("disabled",e.loadingData),a(2),m("options",e.interfacesEditorOptions),a(2),D("header",y(48,79,"CLUSTER.MSG_CLUSTER_TAB.CT_1")),m("disabled",e.loadingData),a(6),R(" ",y(54,81,"FW.MSG_FW_EDITION.OPTIONS_DATA")," "),a(5),m("binary",!0),W("ngModel",e.optionsFlags.stateful),m("ngModelOptions",B(95,Ee))("label",e.translate.instant("FW.OPTION_NAMES.stateful")),a(3),m("binary",!0),W("ngModel",e.optionsFlags.ipv4),m("ngModelOptions",B(96,Ee))("label",e.translate.instant("FW.OPTION_NAMES.ipv4")),a(3),m("binary",!0),W("ngModel",e.optionsFlags.ipv6),m("ngModelOptions",B(97,Ee))("label",e.translate.instant("FW.OPTION_NAMES.ipv6")),a(3),m("binary",!0),W("ngModel",e.optionsFlags.debug),m("ngModelOptions",B(98,Ee))("label",e.translate.instant("FW.OPTION_NAMES.debug")),a(3),m("binary",!0),W("ngModel",e.optionsFlags.report),m("ngModelOptions",B(99,Ee))("label",e.translate.instant("FW.OPTION_NAMES.report")),a(4),m("binary",!0),W("ngModel",e.optionsFlags.docker),m("ngModelOptions",B(100,Ee)),a(7),R("\xA0\xA0",y(82,83,"FW.OPTION_NAMES.docker"),""),a(2),D("href",e.dockerDocURL,ui),a(4),m("binary",!0),W("ngModel",e.optionsFlags.crowdsec),m("ngModelOptions",B(101,Ee)),a(7),R("\xA0\xA0",y(95,85,"FW.OPTION_NAMES.crowdsec"),""),a(4),m("binary",!0),W("ngModel",e.optionsFlags.fail2ban),m("ngModelOptions",B(102,Ee)),a(7),R("\xA0\xA0",y(106,87,"FW.OPTION_NAMES.fail2ban"),""),a(2),D("header",y(108,89,"FW.MSG_FW_EDITION.PLUGINS")),m("disabled",e.loadingData||e.NodesComunicateViaSsh()),a(3),O(e.NodesComunicateViaSsh()?110:-1),a(),O(e.NodesComunicateViaSsh()?-1:111),a(),D("header",y(113,91,"NGFW.TITLE")),m("disabled",e.loadingData||e.NodesComunicateViaSsh()),a(2),O(e.NodesComunicateViaSsh()?114:-1),a(),O(e.NodesComunicateViaSsh()?-1:115)}}function jp(r,u){if(r&1&&(c(0,"div",129),T(1,"sts-fwc-message",89),_()),r&2){let e=d(2);a(),m("message",e.delMessage)}}function Vp(r,u){if(r&1&&T(0,"sts-fwc-message",89),r&2){let e=d(3);m("message",e.deleteMsgError)}}function Wp(r,u){if(r&1){let e=L();c(0,"sts-fwc-object-restrictions",132),P("onHideParent",function(){h(e);let t=d(3);return w(t.minimizeDialog(!0))})("onRefreshRestrictions",function(){h(e);let t=d(3);return w(t.reloadPanel())}),_()}if(r&2){let e=d(3);m("dependencies",e.dependencies)}}function Hp(r,u){if(r&1&&(c(0,"div",130),F(1,Vp,1,1,"sts-fwc-message",89)(2,Wp,1,1,"sts-fwc-object-restrictions",131),_()),r&2){let e=d(2);a(),O(e.deleteMsgError?1:-1),a(),O(e.dependencies.restrictionsError?-1:2)}}function Yp(r,u){if(r&1){let e=L();c(0,"div",129)(1,"p-checkbox",133),C(2,"translate"),Y("ngModelChange",function(t){h(e);let n=d(3);return H(n.okToDelete,t)||(n.okToDelete=t),w(t)}),_()()}if(r&2){let e=d(3);a(),D("label",y(2,2,"CLUSTER.MSG_CLUSTER_DELETE.DEL_5")),W("ngModel",e.okToDelete)}}function Jp(r,u){if(r&1&&(T(0,"sts-fwc-message",89),F(1,Yp,3,4,"div",129)),r&2){let e=d(2);m("message",e.deleteMsgError),a(),O(e.loadingData?-1:1)}}function Kp(r,u){if(r&1&&F(0,jp,2,1,"div",129)(1,Hp,3,2,"div",130)(2,Jp,2,2),r&2){let e=d();O(e.loadingData&&!e.deleteMsgError?0:-1),a(),O(e.dependencies?1:2)}}function Xp(r,u){if(r&1&&(c(0,"div",134),T(1,"p-progressSpinner"),_()),r&2){let e=d(3);m("ngStyle",Ie(3,el,e.loadingData?"visible":"hidden")),a(),Ve(B(5,pp))}}function zp(r,u){if(r&1){let e=L();c(0,"button",139),C(1,"translate"),P("click",function(){h(e);let t=d(3);return w(t.onCloseDialog())}),_()}r&2&&D("label",y(1,1,"GLOBALS.MSG_BUTTONS.STOP"))}function qp(r,u){if(r&1){let e=L();c(0,"button",140),C(1,"translate"),P("click",function(){h(e);let t=d(3);return w(t.onCancel())}),_()}if(r&2){let e=d(3);D("label",y(1,2,"GLOBALS.MSG_BUTTONS.CANCEL")),m("disabled",e.loadingData)}}function Qp(r,u){if(r&1){let e=L();c(0,"button",141),C(1,"translate"),P("click",function(){h(e);let t=d(3);return w(t.onSave())}),_()}if(r&2){let e=d(3);D("label",y(1,2,"GLOBALS.MSG_BUTTONS.SAVE")),m("disabled",!e.formModel.valid||e.loadingData)}}function $p(r,u){if(r&1){let e=L();c(0,"button",142),C(1,"translate"),P("click",function(){h(e);let t=d(3);return w(t.onCancel())}),_()}if(r&2){let e=d(3);D("label",y(1,2,"GLOBALS.MSG_BUTTONS.CLOSE")),m("disabled",e.loadingData)}}function Zp(r,u){if(r&1&&F(0,Xp,2,6,"div",134)(1,zp,2,3,"button",135)(2,qp,2,4,"button",136)(3,Qp,2,4,"button",137)(4,$p,2,4,"button",138),r&2){let e=d(2);O(e.loadingCommunication?0:-1),a(),O(e.loadingCommunication?1:-1),a(),O(!e.formModel.pristine&&!e.loadingCommunication?2:-1),a(),O(e.formModel.pristine?-1:3),a(),O(e.formModel.pristine?4:-1)}}function ed(r,u){if(r&1){let e=L();c(0,"button",146),C(1,"translate"),P("click",function(){h(e);let t=d(3);return w(t.reloadPanel())}),_()}if(r&2){let e=d(3);D("label",y(1,2,"POLICY_GRID.RELOAD")),m("disabled",e.loadingData)}}function td(r,u){if(r&1){let e=L();F(0,ed,2,4,"button",143),c(1,"button",144),C(2,"translate"),P("click",function(){h(e);let t=d(2);return w(t.onDeleteCluster())}),_(),c(3,"button",145),C(4,"translate"),P("click",function(){h(e);let t=d(2);return w(t.onCancel())}),_()}if(r&2){let e=d(2);O(e.dependencies?0:-1),a(),D("label",y(2,4,"CLUSTER.MSG_CLUSTER_EDITION.DELETE")),m("disabled",!e.okToDelete||e.loadingData),a(2),D("label",y(4,6,"GLOBALS.MSG_BUTTONS.CANCEL"))}}function id(r,u){if(r&1&&F(0,Zp,5,5)(1,td,5,8),r&2){let e=d();O(e.cluster?0:-1),a(),O(e.clusterToDelete?1:-1)}}var Rt=function(r){return r.stateful="stateful",r.ipv4="ipv4",r.ipv6="ipv6",r.debug="debug",r.report="report",r.docker="docker",r.crowdsec="crowdsec",r.fail2ban="fail2ban",r}(Rt||{}),pt=function(r){return r.openvpn="openvpn",r.wireguard="wireguard",r.ipsec="ipsec",r.geoip="geoip",r.crowdsec="crowdsec",r.ntopng="ntopng",r.suricata="suricata",r.keepalived="keepalived",r.zeek="zeek",r.elasticsearch="elasticsearch",r.filebeat="filebeat",r.websafety="websafety",r.kibana="kibana",r.logstash="logstash",r.dnssafety="dnssafety",r.iscbind9="iscbind9",r.iscdhcp="iscdhcp",r.haproxy="haproxy",r}(pt||{}),Zr=new Map([[Rt.stateful,0],[Rt.ipv4,1],[Rt.ipv6,2],[Rt.debug,3],[Rt.report,4],[Rt.docker,5],[Rt.crowdsec,6],[Rt.fail2ban,7]]),wt=new Map([["openvpn",1],["geoip",2],["crowdsec",4],["ntopng",8],["suricata",16],["keepalived",32],["zeek",64],["elasticsearch",128],["filebeat",256],["websafety",512],["kibana",1024],["logstash",2048],["dnssafety",4096],["iscbind9",8192],["iscdhcp",16384],["haproxy",32768],["wireguard",65536],["ipsec",131072]]),il=(()=>{class r extends Bt{constructor(e,i,t,n,o,l,p,s,f,S,E,I,b,x,J,U,M,Q){super(E,p,i,J,M,Q),this.fwcUserService=e,this.itemSelectedService=i,this.fwcFirewallService=t,this.fwcInterfaceService=n,this.confirmationService=o,this.fwcObjectTreeService=l,this.appOptionsService=p,this.fwcPolicyService=s,this.fwcEventService=f,this.fwcErrorPipe=S,this.appDialogPanelsService=E,this.messageService=I,this.utilService=b,this.inputDataService=x,this.cd=J,this.translate=U,this.store=M,this.router=Q,this.cluster=null,this.clusterToDelete=null,this.interfaces=[],this.interfacesIpObjs=new Map,this.clusterNodes=[],this.displaySSH=[],this.displayApiKey=[],this.dependencies=null,this.okToDelete=!1,this.loadingData=!1,this.loadingCommunication=!1,this.alive=!0,this.discoveredInstallOptions=new Map,this.FirewallCompilerOptions=ti,this.optionsFlags={stateful:!1,ipv4:!1,ipv6:!1,debug:!1,report:!1,docker:!1,crowdsec:!1,fail2ban:!1},this.optionsPlugins={openvpn:!1,wireguard:!1,ipsec:!1,geoip:!1,crowdsec:!1,ntopng:!1,suricata:!1,keepalived:!1,zeek:!1,elasticsearch:!1,filebeat:!1,websafety:!1,kibana:!1,logstash:!1,dnssafety:!1,iscbind9:!1,iscdhcp:!1,haproxy:!1},this.createDialog(this.translate.instant("CLUSTER.PANEL_TITLE"),"fwci-clusters",q.CLUSTER_PANEL),this.helpSection="/firewalls",this.resetForm()}ngOnInit(){this.dockerDocURL=`https://fwcloud.net/${this.translate.currentLang!=="es"?this.translate.currentLang+"/":""}documentation/fwcloud-docker`,this.deleteMsgError=null,this.store.pipe(ee(()=>this.alive),ni(Ui.selectDialogUuidsToReload)).subscribe(e=>{e&&e.find(i=>i===this.dialogUUID)&&this.reloadPanel()}),this.itemSelectedService.getItem().pipe(ee(()=>this.alive)).subscribe(e=>{if(e._fwcObjType==v.OBJ_CLUSTER)if(this.itemSelectedService.hideObjectPanel(),e.deleteAction)this.showDialog(),this.checkClusterRestrictions(e);else if(e.id_obj!==null&&e.id_obj!=null){let i=[],t;for(i.push(e);i.length&&!t;){let n=i.pop();n.node_type==X.FOLDER_CLUSTER_FW?t=n.id:n.items&&n.items.length&&i.push(...n.items)}this.fwcFirewallService.getCluster(e.id_obj,this.fwcUserService.getActualFwSelectedCloud()).subscribe({next:n=>te(this,null,function*(){let o,l;if(n.data){this.cluster=n.data,this.cluster.interfaces&&Array.isArray(this.cluster.interfaces)&&(this.interfaces=this.cluster.interfaces,this.interfaces.forEach(S=>{let E=Yi();S.interfaceUUID=E,Array.isArray(S.ipobjs)&&S.ipobjs.forEach(I=>{I.ipObjUUID=E+Yi()})}));let p=this.fwcUserService.getActualFwcUser().privateKey,s=this.cluster.nodes,f=[];for(let S=0;s&&S<s.length;S++){let E=s[S];o=E.options,l=E.plugins,E.firewallUUID=bt();try{E.install_user&&(E.install_user=yield this.utilService.openPGPDecrypt(E.install_user,p)),E.install_pass&&(E.install_pass=yield this.utilService.openPGPDecrypt(E.install_pass,p)),E.install_apikey&&(E.install_apikey.startsWith("-")||(E.install_apikey=yield this.utilService.openPGPDecrypt(E.install_apikey,p)))}catch{}let I,b;Array.isArray(this.interfaces)&&this.interfaces.forEach(x=>{E.install_interface&&E.install_interface===x.id&&(E.installInterfaceUUID=x.interfaceUUID,I=x),Array.isArray(x.ipobjs)&&x.ipobjs.forEach(J=>{E.install_ipobj&&E.install_ipobj===J.id&&(E.installIpObjUUID=J.ipObjUUID,b=J)})}),this.setNode(this.cluster.nodes[0].id.toString()+","+this.cluster.nodes[0].name),f.push({firewallUUID:E.firewallUUID,firewall_name:E.name,firewall:E.id,cluster:this.cluster.id,installOptions:{firewallUUID:E.firewallUUID,interface:I,ipobj:b}});for(let x=0;x<this.interfaces.length;x++)if(E.install_interface==this.interfaces[x].id){this.interfacesIpObjs.set(E.firewallUUID,this.interfaces[x].ipobjs);break}}Array.isArray(this.interfaces)&&(this.interfacesEditorOptions={isCluster:!0,firewalls:f,discoveredFirewallUUID:void 0,discoveredIfs:[],existingIfs:this.interfaces}),this.cluster.options=o,this.cluster.nodesParentId=t,this.resetForm(),this.fillForm(),this.showDialog()}}),error:n=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(n)})},complete:()=>{}})}else this.cluster={id:void 0,node_id:e.node_id,options:3,plugins:0},this.resetForm(),this.fillForm(),this.showDialog()})}ngOnDestroy(){super.ngOnDestroy()}reloadPanel(){if(this.clusterToDelete&&this.clusterToDelete&&(this.displayDialog||this.dialogMinified)){let e=Object.assign({},this.clusterToDelete),i=this.itemSelectedService.getActualLastMinifiedDialogId();this.checkClusterRestrictions(e),this.dialogId==i&&(this.showDialog(),this.itemSelectedService.setLastMinifiedDialogId(void 0)),this.store.dispatch(ue.reloadDialogFinished({dialogUuid:this.dialogUUID}))}}getInterfaceAndAddressByUUID(e,i,t){let n,o;if(Array.isArray(this.interfaces)&&this.interfaces.forEach(l=>{l.interfaceUUID&&l.interfaceUUID===i&&(n=l),Array.isArray(l.ipobjs)&&l.ipobjs.forEach(p=>{p.ipObjUUID&&p.ipObjUUID===t&&(o=p)})}),(!n||!o)&&this.discoveredInstallOptions){let l=this.discoveredInstallOptions.get(e);l&&(n=n||l.interface,o=o||l.ipobj)}return{interfaceInfo:n,ipObjInfo:o}}resetProperties(){this.fwcUserService.setConfirmationToken(void 0),this.cluster=null,this.clusterNodes=[],this.clusterToDelete=null,this.interfaces=[],this.interfacesIpObjs=new Map,this.dependencies=null,this.interfacesEditorOptions=null,this.fwcInterfacesEditor&&this.fwcInterfacesEditor.resetProperties(),this.discoveredInstallOptions=new Map,this.deleteMsgError=null,this.delMessage=null,this.displaySSH=[],this.displayApiKey=[],this.okToDelete=!1,this.loadingData=!1,this.formModel&&this.formModel.reset()}resetForm(){this.formModel=new mi({cluster:new k(""),name:new k("",[$.required,$.pattern(be.nameRegExp)]),comment:new k(""),options:new k(3),plugins:new k(0),node_id:new k(null),fwnodes:new Go([this.createNode()],be.distinctNameValidator.bind(this)),compiler:new k(0)})}createNode(e){let i,t,n,o,l,p,s,f,S,E,I,b,x,J,U,M,Q,j;e?(i=e.id,t=e.name,n=e.comment,o=e.fwcloud,l=e.install_user,p=e.install_pass,s=e.save_user_pass,f=e.install_interface,S=e.install_ipobj,E=e.fwmaster,I=e.install_port,b=e.firewallUUID,J=e.installInterfaceUUID,U=e.installIpObjUUID,M=e.install_communication,Q=e.install_protocol,j=e.install_apikey):b=bt(),this.cluster&&(x=this.cluster.id),s===void 0&&(s=1),E===void 0&&(E=0),I===void 0&&(I=33033);let Z=new mi({name:new k(t,[$.required,$.pattern(be.nameRegExp)]),comment:new k(n),install_user:new k(l,$.pattern(be.linuxUsername)),install_pass:new k(p,$.pattern(be.linuxPassword)),save_user_pass:new k(s),install_interface:new k(f),install_ipobj:new k(S),fwmaster:new k(E),install_port:new k(I),firewallUUID:new k(b),installInterfaceUUID:new k(J),installIpObjUUID:new k(U),install_communication:new k(M||"agent",$.required),install_protocol:new k(Q||"https"),install_apikey:new k(j)});return i!=null&&Z.addControl("id",new k(i)),x!=null&&Z.addControl("cluster",new k(x)),Z}fillForm(){if(this.cluster){if(this.formModel.controls.cluster.setValue(this.cluster.id),this.formModel.controls.name.setValue(this.cluster.name),this.formModel.controls.comment.setValue(this.cluster.comment),this.formModel.controls.node_id.setValue(this.cluster.node_id),this.formModel.controls.options.setValue(this.cluster.options),this.setOptionsFlags(),this.formModel.controls.plugins.setValue(this.cluster.plugins),this.setOptionsPlugins(),this.cluster.nodes&&this.cluster.nodes.length){let i=this.formModel.controls.fwnodes;for(;i.length!==0;)i.removeAt(0);for(let t=0;t<this.cluster.nodes.length;t++){let n=this.cluster.nodes[t];this.formModel.controls.fwnodes.push(this.createNode(n))}}this.cluster.type=v.OBJ_CLUSTER,this.cluster.container=nt.C_FIREWALLS;let e=this.cluster.options&61440;this.formModel.controls.compiler.setValue(e>>12)}}setOptionsFlags(){this.cluster&&Object.values(Rt).forEach(e=>{this.optionsFlags[e]=!!(this.cluster.options&2**Zr.get(e))})}setFormOptionsFlags(){let e=[];for(let i of Object.values(Rt)){let t=Zr.get(i);e[t]=this.optionsFlags[i]?"1":"0"}this.formModel.controls.options.setValue(parseInt(e.reduce((i,t)=>t+i,""),2)),this.formModel.markAsDirty()}getFormNodes(){return this.formModel.get("fwnodes")}NodesComunicateViaSsh(){return!this.formModel.value.fwnodes.find(e=>e.install_communication!=="ssh")}setOptionsPlugins(){this.cluster&&Object.values(pt).forEach(e=>{this.optionsPlugins[e]=!!(this.cluster.plugins&wt.get(e))})}onChangePluginsDevelop(){this.confirmationService.confirm({header:this.translate.instant("FW.PLUGINS.HEADER"),icon:"fa fa-exclamation-circle fwcRed iconBig",acceptLabel:"Ok",rejectVisible:!1,message:this.translate.instant("FW.PLUGINS.NOT_IMPLEMENTED"),reject:()=>{this.setOptionsPlugins()},accept:()=>{this.setOptionsPlugins()}})}NodeHaveDiscoveredIp(e){if(this.discoveredInstallOptions.get(e.value.firewallUUID)){if(this.discoveredInstallOptions.get(e.value.firewallUUID).ipobj.address!=null)return!0}else if(this.interfacesIpObjs.get(e.value.firewallUUID))return!0;return!1}onChangePlugins(){let e=[],i,t;this.cluster.id?(i=this.cluster.name,t=this.cluster.plugins):(t=this.formModel.controls.plugins.value,i=this.formModel.controls.name.value);for(let s of Object.values(pt)){let f=wt.get(s);e[f]=this.optionsPlugins[s]?"1":"0"}this.formModel.controls.plugins.setValue(parseInt(e.reduce((s,f)=>f+s,""),2));let n=this.fwcUserService.getActualFwcUser().publicKey,o,l,p=[];Object.values(pt).forEach(s=>{if((this.formModel.controls.plugins.value&wt.get(s))!==(this.cluster.plugins&wt.get(s))){s==pt.iscbind9?o="isc-bind9":s==pt.iscdhcp?o="isc-dhcp":o=s,l=this.optionsPlugins[s];let f,S;this.formModel.controls.plugins.value&wt.get(s)?(f=this.translate.instant("CLUSTER.PLUGINS.ENABLE",{plugin:this.translate.instant("CLUSTER.PLUGINS."+s.toUpperCase())}),S=this.translate.instant("CLUSTER.PLUGINS.ENABLE_OK",{plugin:this.translate.instant("CLUSTER.PLUGINS."+s.toUpperCase())})):(f=this.translate.instant("CLUSTER.PLUGINS.DISABLE",{plugin:this.translate.instant("CLUSTER.PLUGINS."+s.toUpperCase())}),S=this.translate.instant("CLUSTER.PLUGINS.DISABLE_OK",{plugin:this.translate.instant("CLUSTER.PLUGINS."+s.toUpperCase())})),this.confirmationService.confirm({header:this.translate.instant("CLUSTER.PLUGINS.HEADER"),message:f,reject:()=>{this.setOptionsPlugins()},accept:()=>te(this,null,function*(){this.loadingData=!0;for(let I=0;I<this.formModel.value.fwnodes.length;I++)if(this.discoveredInstallOptions.get(this.getFormNodes().value[I].firewallUUID)){let b=this.getFormNodes().value[I].install_apikey;b&&(b.startsWith("-")||(this.getFormNodes().value[I].install_apikey=yield this.utilService.openPGPEncrypt(this.getFormNodes().value[I].install_apikey,n))),p.push({firewall:this.getFormNodes().value[I],plugin:o,enable:l,address:this.discoveredInstallOptions.get(this.getFormNodes().value[I].firewallUUID).ipobj.address,persisted:!1})}else{let b=this.formModel.value.fwnodes[I].install_apikey;b&&(b.startsWith("-")||(this.formModel.value.fwnodes[I].install_apikey=yield this.utilService.openPGPEncrypt(this.formModel.value.fwnodes[I].install_apikey,n))),p.push({firewall:this.formModel.value.fwnodes[I],plugin:o,enable:l,address:this.interfacesIpObjs.get(this.formModel.value.fwnodes[I].firewallUUID)?this.interfacesIpObjs.get(this.formModel.value.fwnodes[I].firewallUUID).filter(x=>x.id==this.formModel.value.fwnodes[I].install_ipobj)[0].address:null,persisted:!1})}this.eventsSubscription=this.fwcEventService.getEvent().pipe(ee(()=>this.alive)).subscribe(I=>{if(I.type==Gi.EVENT_PLUGIN_PANEL_CLOSED)if(this.eventsSubscription.unsubscribe(),I.data)this.formModel.controls.plugins.setValue(t),this.setOptionsPlugins();else if(this.formModel.controls.plugins.setValue(this.formModel.controls.plugins.value),this.cluster.id){let x=this.formModel.value;x={cluster:this.cluster.id,name:this.cluster.name,comment:this.cluster.comment,options:this.cluster.options,plugins:this.formModel.controls.plugins.value},delete x.compiler;let J=this.fwcUserService.getActualFwSelectedCloud();x=rt(x),this.utilService.fwcAPICall(this.fwcFirewallService.updateCluster.bind(this.fwcFirewallService),x,J,null).then(U=>{let M=this.formModel.get("fwnodes");for(let Q=0;Q<M.length;Q++){let j=M.at(Q);j.value.plugins=this.formModel.controls.plugins.value,j.markAllAsTouched()}this.updateNodesAsync().then(()=>{this.processInterfacesOperations(this.cluster.id).then(()=>{this.cluster.plugins=this.formModel.controls.plugins.value}).catch(Q=>{this.setOptionsPlugins()})})}).catch(U=>{this.setOptionsPlugins(),this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(U)})})}else this.cluster.plugins=this.formModel.controls.plugins.value});let E={cluster:this.cluster,nodes:p,plugin:o,enable:l};this.itemSelectedService.setClusterToPluginOperation(E),this.loadingData=!1}),icon:"fa fa-question-circle fwcBlue iconBig",rejectVisible:!0,rejectLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.NO"),acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.YES")})}}),this.loadingData=!1}onClusterNodeNameChange(e){this.fwcInterfacesEditor&&this.fwcInterfacesEditor.updateFirewallName(e.get("firewallUUID").value,e.get("name").value)}onClusterNodeInstallCommChange(e){return te(this,null,function*(){if(e){let i=e.get("install_communication").value,t,n=!1;n=!(yield this.utilService.fwcAPICall(this.fwcFirewallService.loadBackEndConfig.bind(this.fwcFirewallService))).data.availablecommunications.includes("ssh"),i==="ssh"?t="agent":n&&i==="agent"?(this.confirmationService.confirm({header:this.translate.instant("GLOBALS.MSG_OP_RESULT.ERROR"),icon:"fa fa-exclamation-circle fwcRed iconBig",message:this.translate.instant("API_ERROR.SSH_FORBIDDEN"),rejectVisible:!1,acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.OK")}),t="agent"):t="ssh",e.get("install_communication").setValue(t),t==="agent"?(e.get("install_protocol").setValidators([$.required]),e.get("install_port").setValue(33033)):(e.get("install_protocol").clearValidators(),e.get("install_apikey").clearValidators(),e.get("install_port").setValue(22)),e.get("install_protocol").updateValueAndValidity(),e.get("install_apikey").updateValueAndValidity()}})}onInterfaceChange(e,i,t=null,n=!0){let o=this.formModel.get("fwnodes");if(o&&e>=0&&e<o.length){let l=o.at(e);if(!i)this.interfacesIpObjs.delete(l.get("firewallUUID").value);else{let p=this.interfaces.find(s=>s.id===+i);if(p&&(this.interfacesIpObjs.set(l.get("firewallUUID").value,p.ipobjs),l.get("installInterfaceUUID").setValue(p.interfaceUUID),Array.isArray(p.ipobjs))){let s=p.ipobjs.find(f=>f.id===+t);l.get("install_ipobj").setValue(t),l.get("installIpObjUUID").setValue(s?s.ipObjUUID:null)}}this.onChangeInstallData(e,n)}}onChangeInstallData(e,i=!0){let t=this.formModel.get("fwnodes"),n=t.at(e);if(n){let o=n.value,l,p;this.interfacesIpObjs.get(o.firewallUUID)&&(p=this.interfacesIpObjs.get(o.firewallUUID).find(S=>S.id===+o.install_ipobj)),p&&(l=p.ipObjUUID,n.get("installIpObjUUID").setValue(l));let s=o.installInterfaceUUID,f=o.firewallUUID;if(i){let S=this.getInterfaceAndAddressByUUID(f,s,l);this.fwcInterfacesEditor.updateInstallOptions({firewallUUID:f,interface:S.interfaceInfo,ipobj:S.ipObjInfo})}for(let S=0;S<t.length;S++){let E=t.at(S),I=E.value;S!==e&&I.installInterfaceUUID===s&&I.installIpObjUUID===l&&(E.get("install_interface").setValue(null),E.get("install_ipobj").setValue(null),E.get("installInterfaceUUID").setValue(null),E.get("installIpObjUUID").setValue(null),E.markAsTouched(),i&&this.fwcInterfacesEditor.updateInstallOptions({firewallUUID:I.firewallUUID,interface:null,ipobj:null}),this.interfacesIpObjs.delete(I.firewallUUID))}this.refreshDialog()}}nodeAdd(e){let i=this.formModel.get("fwnodes");if(i){let t=this.createNode();i.push(t);let n=t.get("firewallUUID").value;this.fwcInterfacesEditor&&this.fwcInterfacesEditor.addFirewall({cluster:this.cluster.id,firewall:void 0,firewallUUID:n,firewall_name:"",installOptions:{firewallUUID:n,interface:null,ipobj:null}})}this.recenterDialog();try{this.nodeInputs.last.nativeElement.focus()}catch{}}getNumberOfExistingNodes(){let e=0,i=this.formModel.get("fwnodes");if(i)for(let t=0;t<i.length;t++){let n=i.at(t);n.get("id")&&n.get("id").value&&e++}return e}nodeRemove(e){let i=this.formModel.get("fwnodes"),t=this.getNumberOfExistingNodes();if(!i||i.length<2||e<0||e>=i.length)return;let n=i.at(e).value;if(!(n.id&&t<2)){if(this.cluster.id!==null&&this.cluster.id!==void 0&&n.id!==null&&n.id!==void 0)this.confirmationService.confirm({header:this.translate.instant("GLOBALS.MSG_CONFIRM"),icon:"fa fa-question-circle fwcBlue iconBig",rejectVisible:!0,rejectLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.NO"),acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.YES"),message:this.translate.instant("CLUSTER.MSG_CLUSTER_NODE_DEL",{name:n.name}),accept:()=>{this.loadingData=!0,this.utilService.fwcAPICall(this.fwcFirewallService.deleteClusterNode.bind(this.fwcFirewallService),n.cluster,n.id,this.fwcUserService.getActualFwSelectedCloud()).then(o=>{let l=n.fwmaster,p=n.id,s=n.cluster,f=n.firewallUUID;if(i.removeAt(e),this.interfacesIpObjs.delete(n.firewallUUID),this.discoveredInstallOptions.delete(f),this.recenterDialog(),l){let E=i.at(0);E.get("fwmaster").setValue(1);let I={_fwcFwId:null,fwId:null},b=Object.assign({},this.fwcPolicyService.getActualSelectedPolicy());b&&b._fwcFwId==p&&(b._fwcFwId=b.fwId=E.get("id").value,this.fwcPolicyService.setSelectedPolicy(b))}this.fwcInterfacesEditor&&this.fwcInterfacesEditor.deleteFirewall(f);let S={_fwcObjId:s,_fwcObjType:v.OBJ_CLUSTER,container:nt.C_FIREWALLS,_fwcTreeAction:Ue.NEW_ITEM};this.itemSelectedService.setModifiedItem(S),this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("CLUSTER.MSG_CLUSTER_NODES.CN_5",{name:n.name})}),this.loadingData=!1}).catch(o=>{o.error&&o.error.restrictions?setTimeout(()=>{this.confirmationService.confirm({icon:"fa fa-exclamation-circle fwcRed iconBig",header:this.translate.instant("CLUSTER.MSG_CLUSTER_NODE_RESTR.RESTR_0"),message:this.translate.instant("CLUSTER.MSG_CLUSTER_NODE_RESTR.RESTR_1"),accept:()=>{console.log("Restrictions")},acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.OK"),rejectVisible:!1})},500):this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(o)}),this.loadingData=!1})}});else{let o=n.firewallUUID;i.removeAt(e),this.interfacesIpObjs.delete(o),this.discoveredInstallOptions.delete(o),this.fwcInterfacesEditor&&this.fwcInterfacesEditor.deleteFirewall(o),this.recenterDialog()}this.nodeNGFW=this.formModel.get("fwnodes")[0]}}onTestFwcAgentCommunication(e){return te(this,null,function*(){let i=+e.get("install_ipobj").value;if(i){let t=e.value,n=this.interfacesIpObjs.get(t.firewallUUID);if(n){let o=n.find(l=>l.id===i);if(o){let l="Error",p="fa fa-exclamation-circle fwcRed iconBig",s=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:this.translate.instant("GLOBALS.ERRORS.COMMUNICATION")});this.loadingData=!0,this.loadingCommunication=!0;let f=this.fwcUserService.getActualFwcUser().publicKey,S={communication:t.install_communication,host:o.address,port:t.install_port};if(t.install_communication==="ssh"){let E=t.install_user,I=t.install_pass;E&&(E=yield this.utilService.openPGPEncrypt(E,f)),I&&(I=yield this.utilService.openPGPEncrypt(I,f)),S.username=E,S.password=I}else{let E=t.install_apikey;E&&(E.startsWith("-")||(E=yield this.utilService.openPGPEncrypt(E,f))),S.protocol=t.install_protocol,S.apikey=E}({msgHeader:l,msgIcon:p,msgMessage:s}=this.pingSubscription(S,l,p,s))}}}else{let t="Error",n="fa fa-exclamation-circle fwcRed iconBig",o=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:this.translate.instant("GLOBALS.ERRORS.COMMUNICATION")});this.loadingData=!0,this.loadingCommunication=!0;let l=this.fwcUserService.getActualFwcUser().publicKey;if(e.value.install_communication=="agent"){let p=e.value.install_apikey;p&&(p.startsWith("-")||(p=yield this.utilService.openPGPEncrypt(p,l)));let s;this.discoveredInstallOptions.get(e.value.firewallUUID)?s=this.discoveredInstallOptions.get(e.value.firewallUUID).ipobj.address:s=null;let f={communication:e.value.install_communication,host:s,port:e.value.install_port,protocol:e.value.install_protocol,apikey:p};({msgHeader:t,msgIcon:n,msgMessage:o}=this.pingSubscription(f,t,n,o))}}})}pingSubscription(e,i,t,n){return this.communicationSubscription=this.utilService.fwcAPICallObservable(this.fwcFirewallService.checkFwCommunication.bind(this.fwcFirewallService),this.fwcUserService.getActualFwSelectedCloud(),e).subscribe({next:()=>{i=this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),t="fa fa-check-circle fwcGreen iconBig",n=this.translate.instant("FW.MSG_FW_EDITION.PING_AGENT_OK"),this.confirmationService.confirm({header:i,icon:t,acceptLabel:"Ok",rejectVisible:!1,message:n}),this.loadingData=!1,this.loadingCommunication=!1},error:o=>te(this,null,function*(){let l;l=this.utilService.isCommunicationError(o.error),l&&(n=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:l})),this.confirmationService.confirm({header:i,icon:t,acceptLabel:"Ok",rejectVisible:!1,message:n}),this.loadingData=!1,this.loadingCommunication=!1})}),{msgHeader:i,msgIcon:t,msgMessage:n}}showClusterInfo(e){return te(this,null,function*(){let i=+e.get("install_ipobj").value;if(this.loadingData=!0,this.loadingCommunication=!0,i){let t=e.value;if(i){let n=this.interfacesIpObjs.get(t.firewallUUID),o=n.find(l=>l.id===i);if(n){let l=this.fwcUserService.getActualFwcUser().publicKey,p={communication:t.install_communication,host:o.address,port:t.install_port};if(t.install_communication!=="ssh"){let s=t.install_apikey;s&&(s=yield this.utilService.openPGPEncrypt(s,l)),p.protocol=t.install_protocol,p.apikey=s}this.communicationSubscription=this.utilService.fwcAPICallObservable(this.fwcFirewallService.getFirewallInformation.bind(this.fwcFirewallService),this.fwcUserService.getActualFwSelectedCloud(),p).subscribe({next:s=>{let f=this.utilService.createDynamicComponentRef(An),S=f.instance;S.setDynamicComponentRef(f),S.showFirewallPanel(s.data.data.fwc_agent_version,s.data.data.host_name,s.data.data.system_name,s.data.data.os_version,s.data.data.os_version,s.data.data.kernel_version),this.loadingData=!1,this.loadingCommunication=!1},error:s=>te(this,null,function*(){let f=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:this.translate.instant("GLOBALS.ERRORS.COMMUNICATION")}),S;S=this.utilService.isCommunicationError(s.error),S&&(f=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:S})),this.confirmationService.confirm({header:"Error",icon:"fa fa-exclamation-circle fwcRed iconBig",acceptLabel:"Ok",rejectVisible:!1,message:f}),this.loadingData=!1,this.loadingCommunication=!1})})}}}})}onDiscoverInterfaces(){let e=this.formModel.get("fwnodes");if(!e||!e.controls.some(o=>o.get("name").value)){this.confirmationService.confirm({icon:"fa fa-exclamation-circle fwcRed iconBig",header:this.translate.instant("CLUSTER.MSG_CLUSTER_NO_NODES.HEADER"),message:this.translate.instant("CLUSTER.MSG_CLUSTER_NO_NODES.TEXT"),accept:()=>{this.shownPanel=0},rejectVisible:!1,acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.OK")});return}let i=[],t=!1;e.controls.forEach((o,l)=>{o.get("name").value&&(i.push({id:l,text:o.get("name").value,default:!t}),t=!0)});let n={header:this.translate.instant("CLUSTER.MSG_NODE_SELECT.HEADER"),helpText:this.translate.instant("CLUSTER.MSG_NODE_SELECT.TEXT"),modal:!0,formControls:[{name:"nodeId",label:this.translate.instant("CLUSTER.MSG_CLUSTER_EDITION.NODE_NAME"),type:"select",options:i,required:!0}],onAccept:o=>{o&&this.nodeAutoDiscoverInterfaces(o.nodeId)}};this.inputDataService.setInputData(n)}nodeAutoDiscoverInterfaces(e,i){let t=this.formModel.get("fwnodes");if(!t||e<0||e>=t.length||!this.interfacesIpObjs)return;let n=t.at(e).value,o="",l=this.interfacesIpObjs.get(n.firewallUUID),p=n.install_ipobj,s=n.install_communication||"agent";if(p){let S=l.find(E=>E.id===p);S&&(o=S.address)}let f={header:this.translate.instant("COMPILE.INST_SSH_GEN"),helpText:this.translate.instant("IF_EDITOR.TREE.INST_SSH_TEXT"),modal:!0,formControls:[{name:"nodeId",value:e,type:"hidden"},{name:"install_communication",value:s,type:"hidden"},{name:"name",label:this.translate.instant("CLUSTER.MSG_CLUSTER_EDITION.NODE_NAME"),type:"text",readonly:!0,halfSized:!0,value:n.name},{name:"firewallUUID",type:"hidden",value:n.firewallUUID},{name:"role",label:this.translate.instant("CLUSTER.MSG_CLUSTER_EDITION.ROLE"),type:"select",halfSized:!0,options:[{id:null,text:this.translate.instant("CLUSTER.CLUSTER_NODE_ROLES.NO_ROLE"),default:!0},{id:"M",text:this.translate.instant("CLUSTER.CLUSTER_NODE_ROLES.MASTER")},{id:"S",text:this.translate.instant("CLUSTER.CLUSTER_NODE_ROLES.SLAVE")},{id:"N",text:this.translate.instant("CLUSTER.CLUSTER_NODE_ROLES.NODE")}],value:i?i.role:null},{name:"address",label:this.translate.instant("ITEM_PANEL.FIELDS.ADDRESS"),regexp:be.ipV4Regexp,type:"text",required:!0,value:i?i.address:o,setFocus:!0},{name:"",label:"",type:"separator"},{name:"install_port",label:this.translate.instant("CLUSTER.MSG_CLUSTER_EDITION.PORT"),regexp:be.portRegexp,type:"number",required:!0,value:i?i.install_port:n.install_port},{name:"",label:"",type:"separator"}],onAccept:this.doDiscoverInterfaces.bind(this)};s==="ssh"?f.formControls.push({name:"install_user",label:this.translate.instant("CLUSTER.MSG_CLUSTER_EDITION.SSH_USER"),type:"text",required:!0,value:i?i.install_user:n.install_user},{name:"",label:"",type:"separator"},{name:"install_pass",label:this.translate.instant("CLUSTER.MSG_CLUSTER_EDITION.SSH_PASS"),type:"password",required:!0,value:i?i.install_pass:n.install_pass}):f.formControls.push({name:"install_protocol",label:this.translate.instant("FW.MSG_FW_EDITION.AGENT_PROTOCOL"),type:"select",required:!0,value:i?i.install_protocol:n.install_protocol,options:[{id:"https",text:"HTTPS"},{id:"http",text:"HTTP"}]},{name:"",label:"",type:"separator"},{name:"install_apikey",label:this.translate.instant("FW.MSG_FW_EDITION.AGENT_APIKEY"),type:"password",required:!0,value:i?i.install_apikey:n.install_apikey}),this.inputDataService.setInputData(f)}doDiscoverInterfaces(e){return te(this,null,function*(){if(e){let i=this.fwcUserService.getActualFwcUser().publicKey,t={fwcloud:this.fwcUserService.getActualFwSelectedCloud(),ip:e.address,port:+e.install_port,communication:e.install_communication};if(e.install_communication==="ssh"){let s=e.install_user,f=e.install_pass;s&&(s=yield this.utilService.openPGPEncrypt(s,i)),f&&(f=yield this.utilService.openPGPEncrypt(f,i)),t.sshuser=s,t.sshpass=f}else{let s=e.install_apikey;s&&(s.startsWith("-")||(s=yield this.utilService.openPGPEncrypt(s,i))),t.apikey=s,t.protocol=e.install_protocol}let n=[],o=this.formModel.get("fwnodes"),l;for(let s=0;s<o.length;s++){let f=o.at(s),S=f.value,E;if(this.discoveredInstallOptions){let b=this.discoveredInstallOptions.get(S.firewallUUID);b&&b.ipobj&&(E=b.ipobj.address)}S.firewallUUID&&S.firewallUUID===e.firewallUUID&&(l=f,E=e.address);let I=this.getInterfaceAndAddressByUUID(S.firewallUUID,S.installInterfaceUUID,S.installIpObjUUID);n.push({firewallUUID:S.firewallUUID,firewall_name:S.name,firewall:S.id,cluster:S.cluster,installOptions:{firewallUUID:S.firewallUUID,interface:I.interfaceInfo,ipobj:I.ipObjInfo}})}if(!l)return;e.install_communication==="ssh"?l.get("install_user").value!==e.install_user&&(l.get("install_user").setValue(e.install_user),l.markAsDirty()):(l.get("install_protocol").value!==e.install_protocol&&(l.get("install_protocol").setValue(e.install_protocol),l.markAsDirty()),l.get("install_apikey").value!==e.install_apikey&&(l.get("install_apikey").setValue(e.install_apikey),l.markAsDirty()));let p=e.role;p==="N"&&(p=l.get("name").value),this.loadingData=!0,this.loadingCommunication=!0,this.communicationSubscription=this.utilService.fwcAPICallObservable(this.fwcFirewallService.autoDiscoverInterfaces.bind(this.fwcFirewallService),t).subscribe({next:s=>{if(Array.isArray(s.data)){let f=s.data;Array.isArray(f)&&f.length&&(p&&(f=f.map(S=>(S.suffixToAdd=p,S))),this.interfacesEditorOptions={isCluster:!0,firewalls:n,discoveredFirewallUUID:l.get("firewallUUID").value,discoveredAddress:e.address,discoveredIfs:f,existingIfs:this.interfaces},this.formModel.markAsDirty(),this.shownPanel=1,this.recenterDialog())}this.loadingData=!1,this.loadingCommunication=!1},error:s=>te(this,null,function*(){if(s.error.fwcErr==9e3)this.confirmationService.confirm({header:this.translate.instant("GLOBALS.MSG_OP_RESULT.ERROR"),icon:"fa fa-exclamation-circle fwcRed iconBig",message:this.translate.instant("API_ERROR.SSH_FORBIDDEN"),rejectVisible:!1,acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.OK")});else{let f;s&&(f=this.utilService.isCommunicationError(s.error)),this.confirmationService.confirm({header:"Error",icon:"fa fa-exclamation-circle fwcRed iconBig",acceptLabel:"Ok",rejectVisible:!1,message:this.translate.instant("FW.MSG_FW_EDITION.ERROR_DISCOVER")+(f?":<br/>"+f:""),accept:()=>{if(f)return this.nodeAutoDiscoverInterfaces(e.nodeId,e)}})}this.loadingData=!1,this.loadingCommunication=!1})})}})}onEditorInstallModified(e){if(e){let i=this.formModel.get("fwnodes"),t,n;for(let o=0;o<i.length;o++){let l=i.at(o),p=l.value;e.interface&&p.installInterfaceUUID===e.interface.interfaceUUID&&e.ipobj&&p.installIpObjUUID===e.ipobj.ipObjUUID&&(l.get("install_interface").setValue(null),l.get("install_ipobj").setValue(null),l.get("installInterfaceUUID").setValue(null),l.get("installIpObjUUID").setValue(null),this.discoveredInstallOptions.delete(p.firewallUUID),this.onInterfaceChange(o,null,null,!1),l.markAsTouched(),this.interfacesIpObjs.delete(l.get("firewallUUID").value)),p.firewallUUID&&p.firewallUUID===e.firewallUUID&&(t=l,n=o)}if(t){if(!e.interface&&!e.ipobj)t.get("install_interface").setValue(null),t.get("install_ipobj").setValue(null),t.get("installInterfaceUUID").setValue(null),t.get("installIpObjUUID").setValue(null),this.discoveredInstallOptions.delete(e.firewallUUID);else{let o=e.interface.id,l=e.ipobj.id;if(o&&l)this.discoveredInstallOptions.delete(e.firewallUUID),t.get("install_interface").setValue(o),t.get("install_ipobj").setValue(l),t.get("installInterfaceUUID").setValue(e.interface.interfaceUUID),t.get("installIpObjUUID").setValue(e.ipobj.ipObjUUID),this.onInterfaceChange(n,o,l,!1);else{let p={interface:e.interface,ipobj:e.ipobj};this.discoveredInstallOptions.set(e.firewallUUID,p)}}t.markAsTouched(),this.formModel.markAsDirty()}}}onEditorInterfaceOrIpModified(e){e&&e.installFirewallUUIDs&&e.installFirewallUUIDs.forEach(i=>{if(e.id&&Array.isArray(this.interfaces)){let t=!1;for(let n=0;n<this.interfaces.length&&!t;n++){let o=this.interfaces[n];if(e.id===o.id&&e.type===o.type&&(o.name=e.name,t=!0),Array.isArray(o.ipobjs))for(let l=0;l<o.ipobjs.length&&!t;l++){let p=o.ipobjs[l];e.id===p.id&&e.type===p.type&&(p.name=e.name,p.address=e.address,t=!0)}}}else if(this.discoveredInstallOptions){let t=this.discoveredInstallOptions.get(i);t&&(e.type===v.OBJ_INTERFACE_FIREWALL?t.interface.name=e.name:(t.ipobj.name=e.name,t.ipobj.address=e.address))}this.formModel.markAsDirty()})}changeCompilerOptions(){let e=this.formModel.get("compiler").value,i=this.formModel.get("options").value,t=e<<12,n=i&4095;this.formModel.get("options").setValue(t|n)}checkClusterRestrictions(e){e&&(this.loadingData=!0,this.clusterToDelete=e,this.dependencies=null,this.deleteMsgError=null,this.delMessage={type:"loading",title:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.CHECKING_HEAD"),text:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.CHECKING_TEXT")},this.okToDelete=!1,this.fwcFirewallService.getClusterMasterNode(e.id_obj,this.fwcUserService.getActualFwSelectedCloud()).subscribe(i=>{i.error?(this.deleteMsgError={type:"error",title:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.ERROR_RES_HEAD"),text:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.ERROR_RES_TEXT",{error:this.fwcErrorPipe.transform(i.error)})},this.dependencies={restrictionsError:!0},this.loadingData=!1):(e.masterFwId=i.data.id,this.fwcFirewallService.checkClusterRestrictions(e.masterFwId,this.fwcUserService.getActualFwSelectedCloud()).subscribe(t=>{this.deleteMsgError={type:"warning",title:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.DEL_2"),text:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.DEL_3",{name:e._fwcObjName})},this.dependencies=null,this.loadingData=!1,this.recenterDialog()},t=>{if(t.error&&t.error.restrictions)try{this.dependencies=t.error.restrictions,this.dependencies._fwcRestrictedObject={_fwcObjId:e.masterFwId,_fwcObjType:v.OBJ_CLUSTER},this.deleteMsgError={type:"error",title:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.DEL_0"),text:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.DEL_1",{name:e._fwcObjName})}}catch(n){this.dependencies={restrictionsError:!0},this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:n})}else this.deleteMsgError={type:"error",title:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.ERROR_RES_HEAD"),text:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.ERROR_DEL_TEXT",{error:this.fwcErrorPipe.transform(t)})},this.dependencies={restrictionsError:!0};this.loadingData=!1,this.recenterDialog()}))},i=>{this.loadingData=!1,this.deleteMsgError={type:"error",title:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.ERROR_RES_HEAD"),text:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.ERROR_RES_TEXT",{error:this.fwcErrorPipe.transform(i)})},this.dependencies={restrictionsError:!0},this.recenterDialog()}))}onShowDialog(){this.itemSelectedService.getActualItem().ngfw?this.shownPanel=4:this.itemSelectedService.getActualItem().plugins?this.shownPanel=3:(this.shownPanel=0,setTimeout(()=>{this.inputClusterName&&this.inputClusterName.nativeElement.focus()},150));let e=this.itemSelectedService.getActualItem();delete e.ngfw,delete e.plugins}onChangeTab(e){this.fwcInterfacesEditor&&this.fwcInterfacesEditor.hideFirewallSelector(),this.shownPanel=e.index}onHideDialog(){}onCancel(e){!e&&this.formModel&&!this.formModel.pristine&&this.formModel.valid?this.confirmationService.confirm({header:this.translate.instant("GLOBALS.MSG_CONFIRM"),icon:"fa fa-question-circle fwcBlue iconBig",message:this.translate.instant("CLUSTER.MSG_CLUSTER_CONFIRM"),accept:()=>{this.onCancel(!0)},rejectVisible:!0,rejectLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.NO"),acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.YES")}):(this.hideDialog(),this.resetProperties()),this.shownPanel=0}checkForm(e){e&&e.target&&e.target.type!="textarea"&&this.formModel.valid&&(e.target.blur(),this.onSave())}onSave(e=!1){return te(this,null,function*(){if(!e&&this.fwcInterfacesEditor&&!this.fwcInterfacesEditor.isThereAnySelectedNode()){this.confirmationService.confirm({header:this.translate.instant("IF_EDITOR.TREE.MSG_NO_SELECTED.TITLE"),icon:"fa fa-question-circle fwcBlue iconBig",message:this.translate.instant("IF_EDITOR.TREE.MSG_NO_SELECTED.TEXT",{obj_name:this.translate.instant("GLOBALS.MSG_OBJ_TYPES.CLUSTER").toLowerCase()}),accept:()=>{this.onSave(!0)},rejectVisible:!0,rejectLabel:"No",acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.YES")});return}let i,t;this.formModel.get("fwnodes").at(0).get("fwmaster").setValue(1);let o=rt(this.cluster),l=this.formModel.value;this.cluster.id===null||this.cluster.id===void 0?(i=this.fwcFirewallService.newCluster.bind(this.fwcFirewallService),t=this.translate.instant("CLUSTER.MSG_CLUSTER_NEW")):(i=this.fwcFirewallService.updateCluster.bind(this.fwcFirewallService),t=this.translate.instant("CLUSTER.MSG_CLUSTER_UPDATE_1",{name:this.cluster.name}),l={cluster:o.id,name:l.name,comment:l.comment,options:l.options,plugins:l.plugins}),delete l.compiler;let p=this.fwcUserService.getActualFwSelectedCloud(),s=l.node_id;if(delete l.node_id,l=rt(l),Array.isArray(l.fwnodes)){let f=this.fwcUserService.getActualFwcUser().publicKey;l.fwnodes=l.fwnodes.splice(0);for(let S=0;S<l.fwnodes.length;S++){let E=l.fwnodes[S];delete E.firewallUUID,delete E.installInterfaceUUID,delete E.installIpObjUUID;let I=E.install_user,b=E.install_pass;I&&(I=yield this.utilService.openPGPEncrypt(I,f)),b&&(b=yield this.utilService.openPGPEncrypt(b,f)),E.install_user=I,E.install_pass=b,E.install_apikey?E.install_apikey.startsWith("-")||(E.install_apikey=yield this.utilService.openPGPEncrypt(E.install_apikey,f)):E.install_apikey=null}}this.loadingData=!0,this.utilService.fwcAPICall(i,l,p,s).then(f=>{if(o._fwcObjType=v.OBJ_CLUSTER,o.container=nt.C_FIREWALLS,o._fwcTreeAction=Ue.NEW_ITEM,this.cluster.id===null||this.cluster.id===void 0){let S=f.data.insertId;o.id=o.id_obj=o._fwcObjId=S,this.processInterfacesOperations(S,f.data).then(E=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:t})}).catch(E=>{this.confirmationService.confirm({icon:"fa fa-exclamation-circle fwcRed iconBig",header:this.translate.instant("CLUSTER.MSG_CLUSTER_BATCH.ERR_CREATING_IFS"),message:E.message,accept:()=>{},acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.OK"),rejectVisible:!1})}).finally(()=>{this.itemSelectedService.setModifiedItem(o),this.hideDialog(),this.resetProperties(),this.loadingData=!1})}else this.updateNodesAsync().then(S=>{o.id=o.id_obj=o._fwcObjId=this.cluster.id,o._fwcTreeAction=Ue.NEW_ITEM,o.container=nt.C_FIREWALLS,this.processInterfacesOperations(o.id).then(E=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:t})}).catch(E=>{this.confirmationService.confirm({icon:"fa fa-exclamation-circle fwcRed iconBig",header:this.translate.instant("CLUSTER.MSG_CLUSTER_BATCH.ERR_CREATING_IFS"),message:E.message,accept:()=>{},acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.OK"),rejectVisible:!1})}).finally(()=>{this.itemSelectedService.setModifiedItem(o);let E=this.fwcPolicyService.getActualSelectedPolicy();E._fwcFwId!==null&&E._fwcFwId!==void 0&&(E._fwcClusterId==o.id&&(E._fwcFwName=o.name,E._dontLocateInTree=!0),this.fwcPolicyService.setSelectedPolicy(E),this.fwcPolicyService.reloadPolicy()),this.hideDialog(),this.resetProperties(),this.loadingData=!1})},S=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:this.translate.instant("CLUSTER.MSG_CLUSTER_UPDATE_ERR"),detail:S}),this.loadingData=!1})}).catch(f=>{f.status==400&&f.error.fwcErr==8002?(this.confirmationService.confirm({header:this.translate.instant("GLOBALS.MSG_OP_RESULT.ERROR"),icon:"fa fa-exclamation-circle fwcRed iconBig",message:this.translate.instant("API_ERROR."+f.error.fwcErr),rejectVisible:!1,acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.OK"),accept:()=>{}}),this.loadingData=!1):f.status==400&&f.error.fwcErr==8003?(this.confirmationService.confirm({header:this.translate.instant("GLOBALS.MSG_OP_RESULT.ERROR"),icon:"fa fa-exclamation-circle fwcRed iconBig",message:this.translate.instant("API_ERROR."+f.error.fwcErr),rejectVisible:!1,acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.OK"),accept:()=>{}}),this.loadingData=!1):(this.loadingData=!1,this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(f)}))})})}processInterfacesOperations(e,i){return new Promise((t,n)=>te(this,null,function*(){try{if(this.fwcInterfacesEditor&&this.fwcInterfacesEditor.areTherePendingOperations()){let o=this.fwcInterfacesEditor.getSelectedTreeNodes();i&&i.loData&&this.fwcInterfacesEditor.setNewLoIds(i);let[l,p]=yield Promise.all([this.utilService.fwcAPICall(this.fwcFirewallService.getCluster.bind(this.fwcFirewallService),e,this.fwcUserService.getActualFwSelectedCloud()),this.utilService.fwcAPICall(this.fwcObjectTreeService.getTree.bind(this.fwcObjectTreeService),this.appOptionsService.optionsTreeFw,this.fwcUserService.getActualFwSelectedCloud())]),s=l.data,f;if(s&&Array.isArray(s.nodes)&&(f=s.nodes),!f||!f.length)return n(new Error(this.translate.instant("CLUSTER.MSG_CLUSTER_BATCH.ERR_EMPTY_CLUSTER")));let S=this.formModel.get("fwnodes").value,E,I=this.fwcUserService.getActualFwcUser().publicKey;for(let U=0;U<f.length;U++){let M=f[U],Q=S.find(j=>j.name===M.name);if(Q){M.firewallUUID=Q.firewallUUID;let j=Q.install_user,Z=Q.install_pass,oe=Q.install_apikey;j&&(M.install_user=yield this.utilService.openPGPEncrypt(j,I)),Z&&(M.install_pass=yield this.utilService.openPGPEncrypt(Z,I)),oe&&(oe.startsWith("-")?M.install_apikey=oe:M.install_apikey=yield this.utilService.openPGPEncrypt(oe,I))}else return n(new Error(this.translate.instant("CLUSTER.MSG_CLUSTER_BATCH.ERR_MISSING_NODE")));M.fwmaster&&(E=M.id),M.plugins=this.formModel.controls.plugins.value}let b=p.data,x=[];x.push(b);let J=this.fwcObjectTreeService.getNodesFull(x,X.OBJ_CLUSTER,e);if(J&&Array.isArray(J.items)){let U=J.items.find(M=>M.node_type===X.FOLDER_INTERFACES);if(U){let M={parentObject:{fwcloud:this.fwcUserService.getActualFwSelectedCloud(),name:J.text,type:v.OBJ_FIREWALL,id:E,id_node:U.id},objectTreeNodes:o,onClose:j=>te(this,null,function*(){let Z=!1,oe=new Map;if(j.forEach(ve=>{if(ve.operationStatus===Di.SUCCESS&&ve.operationResult&&ve.object.installFirewallUUIDs){let ke;ve.object.type===v.OBJ_INTERFACE_FIREWALL?ke={install_interface:ve.operationResult.insertId}:ve.object.type===v.OBJ_ADDRESS&&(ke={install_ipobj:ve.operationResult.insertId}),ve.object.installFirewallUUIDs&&ve.object.installFirewallUUIDs.forEach(xt=>{let _t=oe.get(xt);ke=Si(Si({},_t),ke),oe.set(xt,ke)})}ve.operationStatus===Di.ERROR&&(Z=!0)}),Z)return n(new Error(this.translate.instant("CLUSTER.MSG_CLUSTER_BATCH.ERR_IFS_OPERATIONS")));{let ve;if(oe.size)for(let[ke,xt]of oe){let _t=f.find(Pt=>Pt.firewallUUID===ke);if(_t){ve=new Rn(_t),ve.fwcloud=this.fwcUserService.getActualFwSelectedCloud(),ve.firewall=_t.id,ve.install_interface=xt.install_interface,ve.install_ipobj=xt.install_ipobj;try{let Pt=ve.getValue(),an=yield this.utilService.fwcAPICall(this.fwcFirewallService.updateFirewall.bind(this.fwcFirewallService),Pt)}catch{return n(new Error(this.translate.instant("CLUSTER.MSG_CLUSTER_BATCH.ERR_UPDATING_INST",{name:_t.name})))}}else return n(new Error(this.translate.instant("CLUSTER.MSG_CLUSTER_BATCH.ERR_UPDATING_INST_MISSING")))}}t()})},Q={uuid:q.ITEM_BATCH_MANAGER,data:M};this.appDialogPanelsService.searchAndShowDialog(Q)}else return n(new Error(this.translate.instant("CLUSTER.MSG_CLUSTER_BATCH.ERR_NO_IFS_NODE")))}else return n(new Error(this.translate.instant("CLUSTER.MSG_CLUSTER_BATCH.ERR_MISSING_CLUSTER_NODE")))}else t()}catch{n(new Error(this.translate.instant("CLUSTER.MSG_CLUSTER_BATCH.ERR_UNKNOWN")))}}))}updateOrSaveNode(e){let i,t="";return new Promise((o,l)=>{let p=Object.assign({},e),s;p.options=this.formModel.controls.options.value,p.plugins=this.formModel.controls.plugins.value,e.id===null||e.id===void 0?(p.node_id=this.cluster.nodesParentId,i=this.translate.instant("CLUSTER.MSG_CLUSTER_NODES.CN_0"),s=this.fwcFirewallService.newFirewall.bind(this.fwcFirewallService)):(p.firewall=p.id,delete p.id,i=this.translate.instant("CLUSTER.MSG_CLUSTER_NODES.CN_1"),s=this.fwcFirewallService.updateFirewall.bind(this.fwcFirewallService)),p.fwcloud=this.fwcUserService.getActualFwSelectedCloud(),p.install_interface=+p.install_interface||p.install_interface,p.install_ipobj=+p.install_ipobj||p.install_ipobj,delete p.firewallUUID,delete p.installInterfaceUUID,delete p.installIpObjUUID,p.install_communication==="ssh"?(p.install_protocol=null,p.install_apikey=null):(delete p.install_user,delete p.install_pass),this.utilService.fwcAPICall(s,p).then(f=>{t=this.translate.instant("CLUSTER.MSG_CLUSTER_NODES.CN_3",{name:e.name}),f.response=t,o(f)}).catch(f=>{if(f.status==400&&f.error.fwcErr==8003)this.confirmationService.confirm({header:this.translate.instant("GLOBALS.MSG_OP_RESULT.ERROR"),icon:"fa fa-exclamation-circle fwcRed iconBig",message:this.translate.instant("API_ERROR."+f.error.fwcErr),rejectVisible:!1,acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.OK"),accept:()=>{}}),this.loadingData=!1;else{let S="";S=this.fwcErrorPipe.transform(f),t=this.translate.instant("CLUSTER.MSG_CLUSTER_NODES.CN_2",{action:i,name:e.name,err_code:"",err_msg:S}),f.error=S,l(f)}})})}updateNodesAsync(){return new Promise((i,t)=>te(this,null,function*(){let n={opResult:!0,opResults:[]},o=this.formModel.get("fwnodes"),l=this.fwcUserService.getActualFwcUser().publicKey;for(let p=0;p<o.length;p++){let s=o.at(p);if(s.touched){let f=s.value,S=s.get("install_user").value,E=s.get("install_pass").value,I=s.get("install_apikey").value;S&&(f.install_user=yield this.utilService.openPGPEncrypt(S,l)),E&&(f.install_pass=yield this.utilService.openPGPEncrypt(E,l)),I&&(I.startsWith("-")?f.install_apikey=I:f.install_apikey=yield this.utilService.openPGPEncrypt(I,l)),yield this.updateOrSaveNode(f).then(b=>{n.opResults.push(b)},b=>(n.opResult=!1,n.opResults.push(b),t(n)))}}i(n)}))}onDeleteCluster(){this.okToDelete&&this.clusterToDelete&&(this.loadingData=!0,this.deleteMsgError=null,this.delMessage={type:"loading",title:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.DELETING_HEAD"),text:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.DELETING_TEXT")},this.utilService.fwcAPICall(this.fwcFirewallService.deleteCluster.bind(this.fwcFirewallService),this.clusterToDelete.id_obj,this.fwcUserService.getActualFwSelectedCloud()).then(e=>{let i=this.clusterToDelete,t={_fwcFwId:null,fwId:null},n=this.fwcPolicyService.getActualSelectedPolicy();this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.DEL_4")}),i._fwcTreeAction=Ue.DELETE_ITEM,this.itemSelectedService.setModifiedItem(i),this.itemSelectedService.setModifiedItem({_fwcTreeAction:Ue.RELOAD_TREE,containerToReload:nt.C_OBJECTS}),n&&n._fwcClusterId==this.clusterToDelete.id_obj&&this.fwcPolicyService.setSelectedPolicy(t),this.loadingData=!1,this.hideDialog(),this.resetProperties()}).catch(e=>{this.deleteMsgError={type:"error",title:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.ERROR_RES_HEAD"),text:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.ERROR_RES_TEXT",{error:this.fwcErrorPipe.transform(e)})},this.dependencies={restrictionsError:!0},this.loadingData=!1}))}setNode(e){let i=e.split(",");i[0]!=""?this.fwcFirewallService.getFirewall(+i[0],this.fwcUserService.getActualFwSelectedCloud()).subscribe(t=>{this.nodeNGFW=t.data}):this.nodeNGFW=this.getFormNodes().value.find(t=>t.name===i[1])}checksNtopNGActive(){return!!(this.cluster.plugins&wt.get(pt.ntopng))}checksNodeNtopNGConfig(){let e=this.formModel.controls.fwnodes.value;if(this.nodeNGFW&&e.find(t=>t.name===this.nodeNGFW.name)){let t=e.find(n=>n.name===this.nodeNGFW.name);if(this.nodeNGFW=t,t.install_ipobj)return t.install_ipobj&&!!(this.nodeNGFW.plugins&wt.get(pt.ntopng));if(this.discoveredInstallOptions.get(t.firewallUUID))return this.checksNtopNGActive()}let i=this.nodeNGFW?this.nodeNGFW.firewallUUID:e[0]?e[0].firewallUUID:void 0;return i&&this.discoveredInstallOptions.get(i)?(this.nodeNGFW=e.find(t=>t.firewallUUID===i),this.checksNtopNGActive()):!1}checksWebSafetyProxyActie(){return!!(this.cluster.plugins&wt.get(pt.websafety))}checksNodeWebSafetyProxyActie(){let e=this.formModel.controls.fwnodes.value;if(this.nodeNGFW&&e.find(t=>t.name===this.nodeNGFW.name)){let t=e.find(n=>n.name===this.nodeNGFW.name);if(this.nodeNGFW=t,t.install_ipobj)return t.install_ipobj&&!!(this.nodeNGFW.plugins&wt.get(pt.websafety));if(this.discoveredInstallOptions.get(t.firewallUUID))return this.checksWebSafetyProxyActie()}let i=this.nodeNGFW?this.nodeNGFW.firewallUUID:e[0]?e[0].firewallUUID:void 0;return i&&this.discoveredInstallOptions.get(i)?(this.nodeNGFW=e.find(t=>t.firewallUUID===i),this.checksWebSafetyProxyActie()):!1}checksDNSSafetyActive(){return!!(this.cluster.plugins&wt.get(pt.dnssafety))}checksNodeDNSSafetyActive(){let e=this.formModel.controls.fwnodes.value;if(this.nodeNGFW&&e.find(t=>t.name===this.nodeNGFW.name)){let t=e.find(n=>n.name===this.nodeNGFW.name);if(this.nodeNGFW=t,t.install_ipobj)return t.install_ipobj&&!!(this.nodeNGFW.plugins&wt.get(pt.dnssafety));if(this.discoveredInstallOptions.get(t.firewallUUID))return this.checksDNSSafetyActive()}let i=this.nodeNGFW?this.nodeNGFW.firewallUUID:e[0]?e[0].firewallUUID:void 0;return i&&this.discoveredInstallOptions.get(i)?(this.nodeNGFW=e.find(t=>t.firewallUUID===i),this.checksDNSSafetyActive()):!1}checksElasticSearchActive(){return!!(this.cluster.plugins&wt.get(pt.elasticsearch))}checksNodeElasticSearchActive(){let e=this.formModel.controls.fwnodes.value;if(this.nodeNGFW&&e.find(t=>t.name===this.nodeNGFW.name)){let t=e.find(n=>n.name===this.nodeNGFW.name);if(this.nodeNGFW=t,t.install_ipobj)return t.install_ipobj&&!!(this.nodeNGFW.plugins&wt.get(pt.elasticsearch));if(this.discoveredInstallOptions.get(t.firewallUUID))return this.checksElasticSearchActive()}let i=this.nodeNGFW?this.nodeNGFW.firewallUUID:e[0]?e[0].firewallUUID:void 0;return i&&this.discoveredInstallOptions.get(i)?(this.nodeNGFW=e.find(t=>t.firewallUUID===i),this.checksElasticSearchActive()):!1}onClickButtonNGFW(e,i){let t,n=this.discoveredInstallOptions.get(this.getFormNodes().value.find(o=>o.name===this.nodeNGFW.name).firewallUUID)?this.discoveredInstallOptions.get(this.getFormNodes().value.find(o=>o.name===this.nodeNGFW.name).firewallUUID).ipobj.address:this.interfacesIpObjs.get(this.getFormNodes().value.find(o=>o.name===this.nodeNGFW.name).firewallUUID).filter(o=>o.id==this.getFormNodes().value.find(l=>l.name===this.nodeNGFW.name).install_ipobj)[0].address;switch(e){case"NTOPNG":t="http://"+n+":3000";break;case"WEBSAFETYPROXY":t="https://"+n+":8095";break;case"DNSSAFETY":t="https://"+n+":8096";break;case"ELASTICSEARCH":t="http://"+n+":5601";break}try{window.open(t)}catch(o){this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(o)})}}onCloseDialog(){this.communicationSubscription&&(this.communicationSubscription.unsubscribe(),this.communicationSubscription=null,this.loadingData=!1,this.loadingCommunication=!1)}static{this.\u0275fac=function(i){return new(i||r)(A(pe),A(Ge),A(ae),A(Ye),A(Oe),A(hn),A(Et),A(fe),A(ii),A(Se),A(Nt),A(me),A(he),A(vt),A(le),A(de),A(_e),A(Dt))}}static{this.\u0275cmp=De({type:r,selectors:[["sts-fwc-cluster-panel"]],viewQuery:function(i,t){if(i&1&&(ge(ip,5),ge(np,5),ge(op,5)),i&2){let n;se(n=ce())&&(t.inputClusterName=n.first),se(n=ce())&&(t.fwcInterfacesEditor=n.first),se(n=ce())&&(t.nodeInputs=n)}},features:[Ze([ae,hn,Ye]),Lt],decls:6,vars:9,consts:[["clusterDialog",""],["inputClusterName",""],["ifSelect",""],["fwcInterfacesEditor",""],["nodeInput",""],["styleClass","dlgFwcDialog",3,"visibleChange","onShow","onHide","visible","modal","closable","resizable"],["pTemplate","header"],["id","clusterData",3,"formGroup"],["pTemplate","footer"],[1,"divFormHeader"],[1,"divHeaderButtons"],["pButton","","type","button","icon","fa fa-question",1,"p-button-primary",3,"disabled"],["pButton","","type","button","icon","fa fa-window-minimize",1,"p-button-secondary",3,"click","disabled"],[1,"fwcWhite","fwcIconLeft"],[1,"fwcMenuIcon","fwci-cluster","fwcOrange"],[1,"fwcMenuIcon","fwci-delete","fwcOrange"],["pButton","","type","button","icon","fa fa-question",1,"p-button-primary",3,"click","disabled"],["id","clusterData",3,"keyup.enter","keyup.esc","formGroup"],[3,"onChange","activeIndex"],["leftIcon","fwci-cluster",3,"header","selected","disabled"],[1,"grid"],[1,"col-12"],[1,"noVertPad","fwcBlue","botBorder"],[1,"col-6"],[1,"p-inputgroup"],["for","name"],["type","text","maxlength","64","pInputText","","formControlName","name","name","name",3,"placeholder"],[1,"fwc-error",3,"ngStyle"],["for","compiler"],["formControlName","compiler","name","compiler",3,"change"],[3,"ngValue"],[1,"col-2"],["for","comment"],[1,"col-10"],["maxlength","255","pInputTextarea","","formControlName","comment","name","comment",3,"rows"],["formArrayName","fwnodes",1,"grid"],[1,"fwcBlue"],[1,"col-12","grid","grid-nogutter",3,"ngStyle","formGroupName"],["leftIcon","fwci-interfaces",3,"header","disabled"],[3,"onInstallModified","onIpObjectModified","onStartAutodiscover","options"],["leftIcon","fwci-config",3,"header","disabled"],["type","hidden","formControlName","options","name","options"],[1,"col-12","noVertPad"],[3,"ngModelChange","onChange","binary","ngModel","ngModelOptions","label"],[3,"ngModelChange","onChange","binary","ngModel","ngModelOptions"],["href","https://www.docker.com","target","_blank"],["width","20","height","20",1,"icon"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-docker"],["target","_blank",2,"margin-left","8px","margin-top","2px",3,"href"],["href","https://crowdsec.net/","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-crowdsec"],["href","https://www.fail2ban.org","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-fail2ban"],["leftIcon","fa fa-puzzle-piece fwcOrange",3,"header","disabled"],["type","hidden","formControlName","plugins","name","plugins"],["leftIcon","fa fa-n fwcOrange",3,"header","disabled"],[3,"ngClass"],[1,"p-inputgroup",2,"padding-right","13px"],["pButton","","type","button","tooltipPosition","top","showDelay","500",1,"p-button-primary","fwcButtonHeight",3,"click","icon","disabled","pTooltip"],["formControlName","name","maxlength","64","type","text","pInputText","",3,"change","id","placeholder"],[1,"fwc-error"],["formControlName","install_port","type","number","pInputText","","min","1",2,"min-width","1rem !important",3,"placeholder"],["tooltipPosition","bottom","showDelay","500","pButton","","type","button","icon","fa fa-plug",1,"p-button-primary","fwcButtonHeight",3,"disabled","pTooltip"],["tooltipPosition","bottom","showDelay","500","pButton","","type","button","icon","fa fa-info-circle",1,"p-button-primary","fwcButtonHeight",3,"disabled","pTooltip"],["tooltipPosition","bottom","showDelay","500","pButton","","type","button","icon","pi pi-minus",1,"p-button-danger","fwcButtonHeight",3,"disabled","pTooltip"],["pButton","","type","button","icon","fa fa-plus","tooltipPosition","bottom","showDelay","500",1,"p-button-primary","fwcButtonHeight",3,"disabled","pTooltip"],["pButton","","type","button","icon","fa fa-search-plus","tooltipPosition","bottom","showDelay","500",1,"p-button-primary","fwcButtonHeight",3,"click","disabled","pTooltip"],[1,"col-1"],["formControlName","install_protocol","name","install_protocol",1,"selNoMargin",3,"change"],["disabled","",3,"value"],["value","https"],["value","http"],[1,"col-3"],["formControlName","install_apikey","name","install_apikey","pPassword","","maxlength","64",3,"showPassword","placeholder","feedback"],["pButton","","type","button","icon","fa fa-eye",1,"p-button-secondary",3,"mousedown","mouseup","mouseout"],[2,"padding-right","13px",3,"ngClass"],["formControlName","install_user","maxlength","32","type","text","pInputText","",3,"id","placeholder"],["formControlName","install_pass","pPassword","","maxlength","64",3,"showPassword","placeholder","promptLabel","weakLabel","mediumLabel","strongLabel"],[1,"col-4","lg:col-2"],[1,"fa","fa-lg","fa-info-circle","fwcBlue",2,"margin-top","0.9rem",3,"pTooltip"],["type","text","pInputText","","readonly","",3,"value"],[1,"col-4","lg:col-2",2,"padding-right","13px"],["formControlName","install_interface",1,"selNoMargin",3,"change"],[3,"value"],["formControlName","install_ipobj",1,"selNoMargin",3,"change","name"],["tooltipPosition","bottom","showDelay","500","pButton","","type","button","icon","fa fa-plug",1,"p-button-primary","fwcButtonHeight",3,"click","disabled","pTooltip"],["tooltipPosition","bottom","showDelay","500","pButton","","type","button","icon","fa fa-info-circle",1,"p-button-primary","fwcButtonHeight",3,"click","disabled","pTooltip"],["tooltipPosition","bottom","showDelay","500","pButton","","type","button","icon","pi pi-minus",1,"p-button-danger","fwcButtonHeight",3,"click","disabled","pTooltip"],["pButton","","type","button","icon","fa fa-plus","tooltipPosition","bottom","showDelay","500",1,"p-button-primary","fwcButtonHeight",3,"click","disabled","pTooltip"],[3,"message"],["href","https://www.openvpn.net/","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-openvpn"],["href","https://www.wireguard.com/","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-wireguard"],["href","","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-ipsec"],["href","https://github.com/acassen/keepalived","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-keepalived"],["href","https://ipgeolocation.io/","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-geoip"],["href","https://www.ntop.org/","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-ntopng"],["href","https://www.diladele.com/","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-websafety"],["href","https://dnssafety.diladele.com/","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-dnssafety"],["href","https://suricata.io/","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-suricata"],["href","https://zeek.org/","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-zeek"],["href","https://www.elastic.co/what-is/elasticsearch","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-elasticsearch"],["href","https://www.elastic.co/what-is/kibana","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-kibana"],["href","https://www.elastic.co/logstash/","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-logstash"],["href","https://www.elastic.co/beats/filebeat","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-filebeat"],["href","https://www.isc.org/dhcp/","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-isc-dhcp"],["href","https://www.haproxy.org/","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-ha-proxy"],["href","https://www.isc.org/bind/","target","_blank"],[0,"xlink","href","assets/img/fwcIcons-symbol-defs.svg#fwci2-isc-bind9"],["for","NTOPNG_BUTTON"],["type","button","pButton","","tooltipPosition","top","showDelay","500",1,"p-button-primary",2,"height","2.44rem","width","100%",3,"click","disabled","pTooltip","label"],["for","WEBSAFETYPROXY_BUTTON"],["for","DNSSAFETY_BUTTON"],["for","ELASTICSEARCH_BUTTON"],[1,"col-12","divCentered"],[1,"fwcRestrictionsContainer"],[3,"dependencies"],[3,"onHideParent","onRefreshRestrictions","dependencies"],["name","chkOkToDelete","binary","true",3,"ngModelChange","ngModel","label"],[1,"divLoadTemp",3,"ngStyle"],["type","button","pButton","","icon","fa fa-xmark",1,"p-button-danger",3,"label"],["type","button","pButton","","icon","pi pi-trash",1,"p-button-danger",3,"disabled","label"],["type","button","pButton","","icon","fa fa-save",1,"p-button-success",3,"disabled","label"],["type","button","pButton","","icon","pi pi-check",1,"p-button-primary",3,"disabled","label"],["type","button","pButton","","icon","fa fa-xmark",1,"p-button-danger",3,"click","label"],["type","button","pButton","","icon","pi pi-trash",1,"p-button-danger",3,"click","disabled","label"],["type","button","pButton","","icon","fa fa-save",1,"p-button-success",3,"click","disabled","label"],["type","button","pButton","","icon","pi pi-check",1,"p-button-primary",3,"click","disabled","label"],["type","button","pButton","","icon","fa fa-refresh",1,"fwc-left-float","p-button-primary",3,"disabled","label"],["type","button","pButton","","icon","fa fa-trash",1,"p-button-danger",3,"click","disabled","label"],["type","button","pButton","","icon","pi pi-check",1,"p-button-primary",3,"click","label"],["type","button","pButton","","icon","fa fa-refresh",1,"fwc-left-float","p-button-primary",3,"click","disabled","label"]],template:function(i,t){if(i&1){let n=L();c(0,"p-dialog",5,0),Y("visibleChange",function(l){return h(n),H(t.displayDialog,l)||(t.displayDialog=l),w(l)}),P("onShow",function(){return h(n),w(t.onShowDialog())})("onHide",function(){return h(n),w(t.onHideDialog())}),F(2,hp,5,4,"ng-template",6)(3,kp,116,103,"form",7)(4,Kp,3,2)(5,id,2,2,"ng-template",8),_()}i&2&&(Ve(B(8,rp)),W("visible",t.displayDialog),m("modal",!0)("closable",!1)("resizable",!0),a(3),O(t.cluster?3:-1),a(),O(t.clusterToDelete?4:-1))},dependencies:[tt,qt,Pi,xi,Fi,$t,Zt,Ri,gt,bi,ei,Ai,Ct,Ti,Oi,Mo,Do,Hi,On,kt,Ut,Be,lt,Gt,ri,oi,ji,En,Wi,Vi,It,ot],styles:[`.fwcGridVertPadding{padding-top:.3em!important;padding-bottom:.3em!important}textarea{resize:none}.btnEye .p-button-text{width:1.6em!important}.divLabelRight{float:right}.selNoMargin{margin:0!important}.p-inputgroup button.fwcButtonHeight{width:auto;padding:5px}sts-fwc-cluster-panel>p-dialog>div>div>div.ng-tns-c1623988549-21.p-dialog-content.ng-star-inserted{min-width:100%!important}
`],encapsulation:2})}}return r})();var uo=ul(fl());var rd=["tbvItemTabview"],ld=["inputObjName"],Ht=r=>({visibility:r}),ad=r=>({network:r}),sd=()=>({visibility:"hidden"}),fo=()=>({standalone:!0}),nl=()=>({width:"1.7rem",height:"1.7rem"});function cd(r,u){r&1&&(c(0,"i"),g(1),C(2,"translate"),_()),r&2&&(a(),V(y(2,1,"ITEM_PANEL.HEADER.STD_OBJ")))}function pd(r,u){if(r&1&&(c(0,"div",7)(1,"h6",11),T(2,"i",12),g(3),C(4,"translate"),c(5,"strong"),g(6),_(),T(7,"span",13),g(8),C(9,"translate"),T(10,"i",14),C(11,"fwcIcon"),g(12,"\xA0 "),c(13,"strong"),g(14),C(15,"translate"),_(),g(16,"\xA0 "),F(17,cd,3,3,"i"),_()()),r&2){let e=d(4);a(3),R(" ",y(4,8,"ITEM_PANEL.HEADER.EDIT_OBJ."+e.tabIndex)," "),a(3),V(e.object.name),a(2),R(" ",y(9,10,"ITEM_PANEL.HEADER.TYPE"),": \xA0 "),a(2),Mt("",y(11,12,e.object.type)," fwcOrange"),a(4),V(y(15,14,"GLOBALS.DB_OBJECT_NAMES."+e.object.type)),a(3),O(!e.object.fwcloud&&e.object.type!=e.ObjectTypes.OBJ_INTERFACE_FIREWALL?17:-1)}}function dd(r,u){if(r&1&&(c(0,"div",7)(1,"h6",11),T(2,"i",12),g(3),C(4,"translate"),c(5,"strong"),g(6),_()()()),r&2){let e=d(4);a(3),R(" ",y(4,2,"ITEM_PANEL.HEADER.EDIT_RULE")," "),a(3),V(e.object.id)}}function _d(r,u){if(r&1&&F(0,pd,18,16,"div",7)(1,dd,7,4,"div",7),r&2){let e=d(3);O(e.object.type!=e.ObjectTypes.OBJ_GEN_RULE?0:1)}}function ud(r,u){r&1&&(c(0,"span"),g(1),C(2,"translate"),_()),r&2&&(a(),R("",y(2,1,"ITEM_PANEL.HEADER.IN_FW")," "))}function fd(r,u){r&1&&(c(0,"span"),g(1),C(2,"translate"),_()),r&2&&(a(),R("",y(2,1,"ITEM_PANEL.HEADER.IN_CL")," "))}function md(r,u){r&1&&(c(0,"span"),g(1),C(2,"translate"),_()),r&2&&(a(),R("",y(2,1,"ITEM_PANEL.HEADER.IN_HOST")," "))}function hd(r,u){if(r&1&&(c(0,"strong"),g(1),_()),r&2){let e=d(4);a(),vi("",e.object.parent_id," (",e.object.parent_name,")")}}function wd(r,u){if(r&1&&(c(0,"span"),g(1),C(2,"translate"),c(3,"strong"),g(4),_(),g(5," ("),c(6,"strong"),g(7),_(),g(8,")"),_()),r&2){let e=d(4);a(),R("",y(2,3,"ITEM_PANEL.HEADER.IN_IF")," "),a(3),V(e.object.interface),a(3),V(e.object._fwcParentObjName)}}function Sd(r,u){if(r&1&&(c(0,"div",7)(1,"h6",11),T(2,"i",15),g(3),C(4,"translate"),F(5,ud,3,3,"span")(6,fd,3,3,"span")(7,md,3,3,"span")(8,hd,2,2,"strong")(9,wd,9,5,"span"),T(10,"span",13),g(11),C(12,"translate"),c(13,"strong"),g(14),C(15,"translate"),_()()()),r&2){let e=d(3);a(3),R(" ",y(4,8,"ITEM_PANEL.HEADER.NEW_OBJ")," "),a(2),O(e.object.firewall&&!e.object.cluster?5:-1),a(),O(e.object.cluster?6:-1),a(),O(e.object.host?7:-1),a(),O(e.object.parent_id?8:-1),a(),O(e.object._fwcParentInterfaceType?9:-1),a(2),R(" ",y(12,10,"ITEM_PANEL.HEADER.TYPE"),": "),a(3),V(y(15,12,"GLOBALS.DB_OBJECT_NAMES."+e.object.type))}}function gd(r,u){if(r&1&&(c(0,"div",7)(1,"h6",11),T(2,"i",12),g(3),C(4,"translate"),c(5,"strong"),g(6),_(),T(7,"span",13),g(8),C(9,"translate"),T(10,"i",14),C(11,"fwcIcon"),g(12,"\xA0 "),c(13,"strong"),g(14),C(15,"translate"),_()()()),r&2){let e=d(3);a(3),R(" ",y(4,7,"ITEM_PANEL.HEADER.DUPLICATE_OBJ")," "),a(3),V(e.object.name),a(2),R(" ",y(9,9,"ITEM_PANEL.HEADER.TYPE"),": \xA0 "),a(2),Mt("",y(11,11,e.object.type)," fwcOrange"),a(4),V(y(15,13,"GLOBALS.DB_OBJECT_NAMES."+e.object.type))}}function Cd(r,u){if(r&1&&F(0,_d,2,1)(1,Sd,16,14,"div",7)(2,gd,16,15,"div",7),r&2){let e=d(2);O(e.object.id&&!e.object.duplicateObjectAction?0:-1),a(),O(!e.object.id&&!e.object.duplicateObjectAction?1:-1),a(),O(e.object.duplicateObjectAction?2:-1)}}function yd(r,u){if(r&1&&(c(0,"div",7)(1,"h6",11),T(2,"i",16),g(3),C(4,"translate"),c(5,"strong"),g(6),_()()()),r&2){let e=d(2);a(3),R(" ",y(4,2,e.deleteDialogTitle)," "),a(3),V(e.objectToDelete==null?null:e.objectToDelete._fwcObjName)}}function Ed(r,u){if(r&1){let e=L();c(0,"button",17),P("click",function(){h(e);let t=d(2);return w(t.showHelp())}),_()}if(r&2){let e=d(2);m("disabled",e.loadingData)}}function vd(r,u){if(r&1){let e=L();F(0,Cd,3,3)(1,yd,7,4,"div",7),c(2,"div",8),F(3,Ed,1,1,"button",9),c(4,"button",10),P("click",function(){h(e);let t=d();return w(t.minimizeDialog())}),_()()}if(r&2){let e=d();O(e.object?0:-1),a(),O(e.objectToDelete?1:-1),a(2),O(e.helpSection?3:-1)}}function Id(r,u){if(r&1){let e=L();c(0,"div",24)(1,"div",32)(2,"span",33)(3,"input",34,2),P("drop",function(){h(e);let t=d(2);return w(t.preventDrop())}),_(),c(5,"label",35),g(6),C(7,"translate"),_()()(),c(8,"p",36),g(9),C(10,"translate"),_()()}if(r&2){let e,i=d(2);m("ngClass",i.object.type==i.ObjectTypes.OBJ_GROUP||i.object.type==i.ObjectTypes.OBJ_SERVICE_GROUP?"col-12":"col-6"),a(6),V(y(7,4,i.object.type!=i.ObjectTypes.OBJ_DNS?"ITEM_PANEL.FIELDS.NAME":"ITEM_PANEL.FIELDS.NAME_DNS")),a(2),m("ngStyle",Ie(8,Ht,i.formModel.get("name").valid||i.formModel.get("name").pristine?"hidden":"visible")),a(),R(" ",y(10,6,(e=i.formModel.get("name").errors)!=null&&e.pattern?"ITEM_PANEL.ERRORS.FIELD_INVALID_NAME":"ITEM_PANEL.ERRORS.FIELD_EMPTY")," ")}}function bd(r,u){r&1&&T(0,"div",25)}function Pd(r,u){r&1&&(c(0,"p",39),g(1),C(2,"translate"),_()),r&2&&(a(),R(" ",y(2,1,"ITEM_PANEL.ERRORS.FIELD_ADDR")," "))}function Td(r,u){if(r&1){let e=L();c(0,"div",26)(1,"div",32)(2,"span",33)(3,"input",37),P("drop",function(){h(e);let t=d(2);return w(t.preventDrop())})("blur",function(){h(e);let t=d(2);return w(t.revalidateForm("address"))}),_(),c(4,"label",38),g(5),C(6,"translate"),_()()(),F(7,Pd,3,3,"p",39),_()}if(r&2){let e,i=d(2);a(5),V(y(6,2,"ITEM_PANEL.FIELDS.ADDRESS")),a(2),O((e=i.formModel.get("address"))!=null&&e.touched&&((e=i.formModel.get("address"))!=null&&e.errors)?7:-1)}}function Od(r,u){r&1&&(c(0,"p",39),g(1),C(2,"translate"),_()),r&2&&(a(),R(" ",y(2,1,"ITEM_PANEL.ERRORS.FIELD_NETMASK")," "))}function Rd(r,u){if(r&1){let e=L();c(0,"div",26)(1,"div",32)(2,"span",33)(3,"input",40),P("drop",function(){h(e);let t=d(2);return w(t.preventDrop())})("blur",function(){h(e);let t=d(2);return w(t.revalidateForm("netmask"))}),_(),c(4,"label",41),g(5),C(6,"translate"),_()()(),F(7,Od,3,3,"p",39),_()}if(r&2){let e,i=d(2);a(5),V(y(6,2,"ITEM_PANEL.FIELDS.MASK")),a(2),O((e=i.formModel.get("netmask"))!=null&&e.touched&&((e=i.formModel.get("netmask"))!=null&&e.errors)?7:-1)}}function xd(r,u){r&1&&(c(0,"p",39),g(1),C(2,"translate"),_()),r&2&&(a(),R(" ",y(2,1,"ITEM_PANEL.ERRORS.FIELD_ADDR")," "))}function Fd(r,u){if(r&1){let e=L();c(0,"div",26)(1,"div",32)(2,"span",33)(3,"input",42),P("drop",function(){h(e);let t=d(2);return w(t.preventDrop())})("blur",function(){h(e);let t=d(2);return w(t.revalidateForm("range_start"))}),_(),c(4,"label",43),g(5),C(6,"translate"),_()()(),F(7,xd,3,3,"p",39),_()}if(r&2){let e,i=d(2);a(5),V(y(6,2,"ITEM_PANEL.FIELDS.RANGE_S")),a(2),O((e=i.formModel.get("range_start"))!=null&&e.touched&&((e=i.formModel.get("range_start"))!=null&&e.errors)?7:-1)}}function Ad(r,u){r&1&&(g(0),C(1,"translate")),r&2&&R(" ",y(1,1,"ITEM_PANEL.ERRORS.FIELD_RANGE_VAL")," ")}function Ld(r,u){r&1&&(g(0),C(1,"translate")),r&2&&R(" ",y(1,1,"ITEM_PANEL.ERRORS.FIELD_ADDR")," ")}function Md(r,u){if(r&1&&(c(0,"p",39),F(1,Ad,2,3)(2,Ld,2,3),_()),r&2){let e,i=d(3);a(),O(!((e=i.formModel.get("range_end"))==null||e.errors==null)&&e.errors.rangeorder?1:2)}}function Dd(r,u){if(r&1){let e=L();c(0,"div",26)(1,"div",32)(2,"span",33)(3,"input",44),P("drop",function(){h(e);let t=d(2);return w(t.preventDrop())})("blur",function(){h(e);let t=d(2);return w(t.revalidateForm("range_end"))}),_(),c(4,"label",45),g(5),C(6,"translate"),_()()(),F(7,Md,3,1,"p",39),_()}if(r&2){let e,i=d(2);a(5),V(y(6,2,"ITEM_PANEL.FIELDS.RANGE_E")),a(2),O((e=i.formModel.get("range_end"))!=null&&e.touched&&((e=i.formModel.get("range_end"))!=null&&e.errors)?7:-1)}}function Nd(r,u){if(r&1&&(c(0,"option",47),g(1),_()),r&2){let e=u.$implicit;m("ngValue",e.id),a(),R(" ",e.text," ")}}function Gd(r,u){if(r&1){let e=L();c(0,"div",26)(1,"div",32)(2,"span",33)(3,"select",46),P("change",function(){h(e);let t=d(2);return w(t.revalidateForm())}),xe(4,Nd,2,2,"option",47,Re),_(),c(6,"label",48),g(7),C(8,"translate"),_()()()()}if(r&2){let e=d(2);a(4),Fe(e.ipVersions),a(3),V(y(8,1,"ITEM_PANEL.FIELDS.IPV"))}}function Ud(r,u){if(r&1&&(c(0,"p",39),g(1),C(2,"translate"),C(3,"translate"),_()),r&2){let e,i=d(3);a(),R(" ",(e=i.formModel.get("address").errors)!=null&&e.networkAddress?zt(2,1,"VPN.PANEL.ERRORS.IP_NOT_IN_NETWORK",Ie(6,ad,i.formModel.get("address").errors.networkAddress.network)):y(3,4,"ITEM_PANEL.ERRORS.FIELD_ADDR")," ")}}function Bd(r,u){if(r&1){let e=L();c(0,"div",26)(1,"div",32)(2,"span",33)(3,"input",37),P("drop",function(){h(e);let t=d(2);return w(t.preventDrop())})("blur",function(){h(e);let t=d(2);return w(t.revalidateForm("address"))}),_(),c(4,"label",38),g(5),C(6,"translate"),_()()(),F(7,Ud,4,8,"p",39),_()}if(r&2){let e,i=d(2);a(5),V(y(6,2,"ITEM_PANEL.FIELDS.ADDRESS")),a(2),O((e=i.formModel.get("address"))!=null&&e.touched&&((e=i.formModel.get("address"))!=null&&e.errors)?7:-1)}}function kd(r,u){r&1&&(c(0,"p",39),g(1),C(2,"translate"),_()),r&2&&(a(),R(" ",y(2,1,"ITEM_PANEL.ERRORS.FIELD_NETMASK")," "))}function jd(r,u){if(r&1){let e=L();c(0,"div",26)(1,"div",32)(2,"span",33)(3,"input",40),P("drop",function(){h(e);let t=d(2);return w(t.preventDrop())})("blur",function(){h(e);let t=d(2);return w(t.revalidateForm("netmask"))}),_(),c(4,"label",41),g(5),C(6,"translate"),_()()(),F(7,kd,3,3,"p",39),_()}if(r&2){let e,i=d(2);a(5),V(y(6,2,"ITEM_PANEL.FIELDS.MASK")),a(2),O((e=i.formModel.get("netmask"))!=null&&e.touched&&((e=i.formModel.get("netmask"))!=null&&e.errors)?7:-1)}}function Vd(r,u){if(r&1&&(c(0,"option",47),g(1),_()),r&2){let e=u.$implicit;m("ngValue",e.id),a(),R(" ",e.text," ")}}function Wd(r,u){if(r&1){let e=L();c(0,"div",26)(1,"div",32)(2,"span",33)(3,"select",46),P("change",function(){h(e);let t=d(2);return w(t.revalidateForm())}),xe(4,Vd,2,2,"option",47,Re),_(),c(6,"label",48),g(7),C(8,"translate"),_()()()()}if(r&2){let e=d(2);a(4),Fe(e.ipVersions),a(3),V(y(8,1,"ITEM_PANEL.FIELDS.IPV"))}}function Hd(r,u){if(r&1&&(c(0,"div",27)(1,"div",32)(2,"span",33),T(3,"sts-fwc-object-group",49),c(4,"label",50),g(5),C(6,"translate"),_()()(),T(7,"p",51),_()),r&2){let e=d(2);a(3),m("groupId",e.object.id)("readOnly",!e.object.fwcloud)("groupType",e.object.type)("groupTreeId",e.object.id_node)("ipobjs",e.object.ipobjs),a(2),V(y(6,7,"ITEM_PANEL.FIELDS.OBJ_GROUP")),a(2),m("ngStyle",B(9,sd))}}function Yd(r,u){if(r&1){let e=L();c(0,"div",25)(1,"div",32)(2,"span",33)(3,"input",52),P("drop",function(){h(e);let t=d(2);return w(t.preventDrop())})("click",function(t){return h(e),w(t.target.select())}),_(),c(4,"label",53),g(5),C(6,"translate"),_()()(),c(7,"p",51),g(8),C(9,"translate"),_()()}if(r&2){let e=d(2);a(5),V(y(6,3,"ITEM_PANEL.FIELDS.PROT")),a(2),m("ngStyle",Ie(7,Ht,e.formModel.get("protocol").valid||e.formModel.get("protocol").pristine?"hidden":"visible")),a(),R(" ",y(9,5,"ITEM_PANEL.ERRORS.FIELD_PROTOCOL")," ")}}function Jd(r,u){r&1&&(c(0,"span"),g(1),C(2,"translate"),T(3,"br"),_()),r&2&&(a(),V(y(2,1,"ITEM_PANEL.ERRORS.FIELD_PORT_VAL")))}function Kd(r,u){r&1&&(c(0,"span"),g(1),C(2,"translate"),_()),r&2&&(a(),V(y(2,1,"ITEM_PANEL.ERRORS.FIELD_PORT_VAL2")))}function Xd(r,u){r&1&&(c(0,"span"),g(1),C(2,"translate"),T(3,"br"),_()),r&2&&(a(),V(y(2,1,"ITEM_PANEL.ERRORS.FIELD_PORT_VAL")))}function zd(r,u){r&1&&(c(0,"span"),g(1),C(2,"translate"),_()),r&2&&(a(),V(y(2,1,"ITEM_PANEL.ERRORS.FIELD_PORT_VAL2")))}function qd(r,u){if(r&1){let e=L();c(0,"div",25)(1,"div",23)(2,"div",25)(3,"p-fieldset",54),C(4,"translate"),c(5,"div",23)(6,"div",25)(7,"div",32)(8,"span",33)(9,"input",55),P("drop",function(){h(e);let t=d(2);return w(t.preventDrop())})("click",function(t){return h(e),w(t.target.select())}),_(),c(10,"label",56),g(11),C(12,"translate"),_()()()(),c(13,"div",25)(14,"div",32)(15,"span",33)(16,"input",57),P("drop",function(){h(e);let t=d(2);return w(t.preventDrop())})("click",function(t){return h(e),w(t.target.select())}),_(),c(17,"label",58),g(18),C(19,"translate"),_()()()()(),c(20,"p",51),F(21,Jd,4,3,"span")(22,Kd,3,3,"span"),_()()(),c(23,"div",25)(24,"p-fieldset",54),C(25,"translate"),c(26,"div",23)(27,"div",25)(28,"div",32)(29,"span",33)(30,"input",59),P("drop",function(){h(e);let t=d(2);return w(t.preventDrop())})("click",function(t){return h(e),w(t.target.select())}),_(),c(31,"label",60),g(32),C(33,"translate"),_()()()(),c(34,"div",25)(35,"div",32)(36,"span",33)(37,"input",61),P("drop",function(){h(e);let t=d(2);return w(t.preventDrop())})("click",function(t){return h(e),w(t.target.select())}),_(),c(38,"label",62),g(39),C(40,"translate"),_()()()()(),c(41,"p",51),F(42,Xd,4,3,"span")(43,zd,3,3,"span"),_()()()()()}if(r&2){let e,i,t,n,o=d(2);a(3),D("legend",y(4,12,"ITEM_PANEL.FIELDS.SRC_PORT")),a(8),V(y(12,14,"ITEM_PANEL.FIELDS.PORT_S")),a(7),V(y(19,16,"ITEM_PANEL.FIELDS.PORT_E")),a(2),m("ngStyle",Ie(24,Ht,(e=o.formModel.get("source_port_start").errors)!=null&&e.min||(e=o.formModel.get("source_port_start").errors)!=null&&e.max||o.formModel.errors!=null&&o.formModel.errors.sourceports?"visible":"hidden")),a(),O((i=o.formModel.get("source_port_start").errors)!=null&&i.min||(i=o.formModel.get("source_port_start").errors)!=null&&i.max?21:-1),a(),O(o.formModel.errors!=null&&o.formModel.errors.sourceports?22:-1),a(2),D("legend",y(25,18,"ITEM_PANEL.FIELDS.DEST_PORT")),a(8),V(y(33,20,"ITEM_PANEL.FIELDS.PORT_S")),a(7),V(y(40,22,"ITEM_PANEL.FIELDS.PORT_E")),a(2),m("ngStyle",Ie(26,Ht,(t=o.formModel.get("destination_port_start").errors)!=null&&t.min||(t=o.formModel.get("destination_port_start").errors)!=null&&t.max||o.formModel.errors!=null&&o.formModel.errors.destinationports?"visible":"hidden")),a(),O((n=o.formModel.get("destination_port_start").errors)!=null&&n.min||(n=o.formModel.get("destination_port_start").errors)!=null&&n.max?42:-1),a(),O(o.formModel.errors!=null&&o.formModel.errors.destinationports?43:-1)}}function Qd(r,u){if(r&1&&(c(0,"th"),g(1),_()),r&2){let e=u.$implicit;a(),R(" ",e.name," ")}}function $d(r,u){if(r&1){let e=L();c(0,"td")(1,"p-checkbox",66),Y("ngModelChange",function(t){let n=h(e).$implicit;return H(n.mask,t)||(n.mask=t),w(t)}),P("onChange",function(){let t=h(e).$index,n=d(3);return w(n.setFormTCPFlags(t))}),_()()}if(r&2){let e=u.$implicit,i=d(3);a(),m("binary",!0),W("ngModel",e.mask),m("ngModelOptions",B(4,fo))("disabled",!i.object.fwcloud&&i.object.type!=i.ObjectTypes.OBJ_INTERFACE_FIREWALL&&i.object.type!=i.ObjectTypes.OBJ_GEN_RULE)}}function Zd(r,u){if(r&1){let e=L();c(0,"td")(1,"p-checkbox",67),Y("ngModelChange",function(t){let n=h(e).$implicit;return H(n.status,t)||(n.status=t),w(t)}),P("onChange",function(){let t=h(e).$index,n=d(3);return w(n.setFormTCPFlags(t))}),_()()}if(r&2){let e=u.$implicit,i=d(3);a(),m("binary",!0),W("ngModel",e.status),m("ngModelOptions",B(5,fo))("ngStyle",Ie(6,Ht,e.mask?"visible":"hidden"))("disabled",!i.object.fwcloud&&i.object.type!=i.ObjectTypes.OBJ_INTERFACE_FIREWALL&&i.object.type!=i.ObjectTypes.OBJ_GEN_RULE)}}function e_(r,u){if(r&1&&(c(0,"div",25)(1,"div",23)(2,"div",27)(3,"p-fieldset",54),C(4,"translate"),T(5,"input",63)(6,"input",64),c(7,"table",65)(8,"thead")(9,"tr"),T(10,"th"),xe(11,Qd,2,1,"th",null,Re),_()(),c(13,"tbody")(14,"tr")(15,"td"),g(16),C(17,"translate"),_(),xe(18,$d,2,5,"td",null,Re),_(),c(20,"tr")(21,"td"),g(22),C(23,"translate"),_(),xe(24,Zd,2,8,"td",null,Re),_()()()()()()()),r&2){let e=d(2);a(3),D("legend",y(4,3,"ITEM_PANEL.FIELDS.TCP_FLAGS")),a(8),Fe(e.tcpFlagsArray),a(5),R(" ",y(17,5,"ITEM_PANEL.FIELDS.TCP_FLAG_MASK")," "),a(2),Fe(e.tcpFlagsArray),a(4),R(" ",y(23,7,"ITEM_PANEL.FIELDS.TCP_FLAG_STATUS")," "),a(2),Fe(e.tcpFlagsArray)}}function t_(r,u){if(r&1&&(c(0,"option",47),g(1),_()),r&2){let e=u.$index;m("ngValue",e),a(),R(" ",e," ")}}function i_(r,u){if(r&1&&(c(0,"div",28)(1,"div",32)(2,"span",33)(3,"select",68)(4,"option",47),g(5,"Any"),_(),xe(6,t_,2,2,"option",47,Re),_(),c(8,"label",69),g(9),C(10,"translate"),_()()()()),r&2){let e=d(2);a(4),m("ngValue",-1),a(2),Fe(e.icmp_values),a(3),V(y(10,2,"ITEM_PANEL.FIELDS.ICMP_TYPE"))}}function n_(r,u){if(r&1&&(c(0,"option",47),g(1),_()),r&2){let e=u.$index;m("ngValue",e),a(),R(" ",e," ")}}function o_(r,u){if(r&1&&(c(0,"div",28)(1,"div",32)(2,"span",33)(3,"select",70)(4,"option",47),g(5,"Any"),_(),xe(6,n_,2,2,"option",47,Re),_(),c(8,"label",71),g(9),C(10,"translate"),_()()()()),r&2){let e=d(2);a(4),m("ngValue",-1),a(2),Fe(e.icmp_values),a(3),V(y(10,2,"ITEM_PANEL.FIELDS.ICMP_CODE"))}}function r_(r,u){if(r&1){let e=L();c(0,"div",26)(1,"div",32)(2,"span",33)(3,"input",72),P("drop",function(){h(e);let t=d(2);return w(t.preventDrop())}),_(),c(4,"label",73),g(5),C(6,"translate"),_()()()()}r&2&&(a(5),V(y(6,1,"ITEM_PANEL.FIELDS.LABEL")))}function l_(r,u){if(r&1){let e=L();c(0,"div",26)(1,"div",32)(2,"span",33)(3,"input",74),P("drop",function(){h(e);let t=d(2);return w(t.preventDrop())}),_(),c(4,"label",75),g(5),C(6,"translate"),_()()(),c(7,"p",51),g(8),C(9,"translate"),_()()}if(r&2){let e=d(2);a(5),V(y(6,3,"ITEM_PANEL.FIELDS.MAC")),a(2),m("ngStyle",Ie(7,Ht,e.formModel.get("mac").valid||e.formModel.get("mac").pristine?"hidden":"visible")),a(),R(" ",y(9,5,"ITEM_PANEL.ERRORS.FIELD_MAC")," ")}}function a_(r,u){if(r&1){let e=L();c(0,"div",25)(1,"div",32)(2,"span",33)(3,"input",76),P("drop",function(){h(e);let t=d(2);return w(t.preventDrop())}),_(),c(4,"label",77),g(5),C(6,"translate"),_()()(),c(7,"p",51),g(8),C(9,"translate"),_()()}if(r&2){let e=d(2);a(5),V(y(6,3,"ITEM_PANEL.FIELDS.MARK_CODE")),a(2),m("ngStyle",Ie(7,Ht,e.formModel.get("code").valid||e.formModel.get("code").pristine?"hidden":"visible")),a(),R(" ",y(9,5,"ITEM_PANEL.ERRORS.FIELD_MARK_CODE")," ")}}function s_(r,u){if(r&1){let e=L();c(0,"div",32)(1,"p-checkbox",88),Y("ngModelChange",function(t){let n=h(e).$implicit;return H(n.status,t)||(n.status=t),w(t)}),P("onChange",function(){let t=h(e).$index,n=d(3);return w(n.onChangeOptionsFlags(t))}),_()()}if(r&2){let e=u.$implicit,i=d(3);a(),m("binary",!0)("disabled",i.object.special&&e.disableOnRuleActive),W("ngModel",e.status),m("ngModelOptions",B(5,fo))("label",e.name)}}function c_(r,u){if(r&1){let e=L();c(0,"div",78)(1,"h5",79),g(2),C(3,"translate"),_()(),c(4,"div",80)(5,"h5",79),g(6),C(7,"translate"),_()(),c(8,"div",78),xe(9,s_,2,6,"div",32,Re),_(),c(11,"div",80)(12,"p-tabView",81)(13,"p-tabPanel",82),C(14,"translate"),T(15,"textarea",83),C(16,"translate"),c(17,"div",84)(18,"button",85),C(19,"translate"),P("click",function(){h(e);let t=d(2);return t.formModel.get("run_before").setValue(null),w(t.formModel.markAsDirty())}),_()()(),c(20,"p-tabPanel",86),C(21,"translate"),T(22,"textarea",87),C(23,"translate"),c(24,"div",84)(25,"button",85),C(26,"translate"),P("click",function(){h(e);let t=d(2);return t.formModel.get("run_after").setValue(null),w(t.formModel.markAsDirty())}),_()()()()()}if(r&2){let e=d(2);a(2),R(" ",y(3,10,"RULE.OPTION_TITLE")," "),a(4),R(" ",y(7,12,"RULE.HOOKS.TITLE")," "),a(3),Fe(e.optionsFlags),a(4),D("header",y(14,14,"RULE.HOOKS.BEFORE_TITLE")),a(2),D("placeholder",y(16,16,"RULE.HOOKS.PLACEHOLDER")),a(3),D("label",y(19,18,"CONTEXT.OBJECTS.DELETE")),m("disabled",!e.formModel.get("run_before").value),a(2),D("header",y(21,20,"RULE.HOOKS.AFTER_TITLE")),a(2),D("placeholder",y(23,22,"RULE.HOOKS.PLACEHOLDER")),a(3),D("label",y(26,24,"CONTEXT.OBJECTS.DELETE")),m("disabled",!e.formModel.get("run_after").value)}}function p_(r,u){if(r&1){let e=L();c(0,"div",27)(1,"span",33)(2,"textarea",89),P("drop",function(){h(e);let t=d(2);return w(t.preventDrop())}),_(),c(3,"label",90),g(4),C(5,"translate"),_()()()}r&2&&(a(4),V(y(5,1,"ITEM_PANEL.FIELDS.COMMENTS")))}function d_(r,u){if(r&1&&(c(0,"div",27),T(1,"sts-fwc-message",91),_()),r&2){let e=d(2);a(),m("message",e.objErrorMessage)}}function __(r,u){if(r&1){let e=L();c(0,"div",31)(1,"form",92)(2,"sts-fwc-object-wu",93),P("onHideParent",function(){h(e);let t=d(2);return w(t.minimizeDialog())}),_()()()}if(r&2){let e=d(2);a(2),m("objectInfo",e.object._fwcObjectInfo)}}function u_(r,u){if(r&1){let e=L();c(0,"p-tabView",18,1),P("onChange",function(t){h(e);let n=d();return w(n.onTabChange(t))}),c(2,"p-tabPanel",19),C(3,"translate"),c(4,"div",20)(5,"form",21)(6,"fieldset",22),P("keyup.enter",function(t){h(e);let n=d();return w(n.checkForm(t))})("keyup.esc",function(){h(e);let t=d();return w(t.onCancel())}),c(7,"div",23),F(8,Id,11,10,"div",24)(9,bd,1,0,"div",25)(10,Td,8,4,"div",26)(11,Rd,8,4,"div",26)(12,Fd,8,4,"div",26)(13,Dd,8,4,"div",26)(14,Gd,9,3,"div",26)(15,Bd,8,4,"div",26)(16,jd,8,4,"div",26)(17,Wd,9,3,"div",26)(18,Hd,8,10,"div",27)(19,Yd,10,9,"div",25)(20,qd,44,28,"div",25)(21,e_,26,9,"div",25)(22,i_,11,4,"div",28)(23,o_,11,4,"div",28)(24,r_,7,3,"div",26)(25,l_,10,9,"div",26)(26,a_,10,9,"div",25)(27,c_,27,26)(28,p_,6,3,"div",27)(29,d_,2,1,"div",27),_()()()()(),c(30,"p-tabPanel",29),C(31,"translate"),c(32,"div",30)(33,"div",23),F(34,__,3,1,"div",31),_()()()()}if(r&2){let e=d();m("activeIndex",e.tabIndex),a(2),D("header",y(3,30,"ITEM_PANEL.HEADER.OBJ")),m("disabled",e.loadingData||e.object._fwcObjType==e.ObjectTypes.OBJ_OPENVPN_CONFIG_CLI||e.object._fwcObjType==e.ObjectTypes.OBJ_OPENVPN_PREFIX),a(3),m("formGroup",e.formModel),a(),m("disabled",e.loadingData||!e.object.fwcloud&&e.object.type!=e.ObjectTypes.OBJ_INTERFACE_FIREWALL&&e.object.type!=e.ObjectTypes.OBJ_GEN_RULE),a(2),O(e.object.type!=e.ObjectTypes.OBJ_GEN_RULE?8:-1),a(),O(e.object.type!=e.ObjectTypes.OBJ_GEN_RULE&&e.object.type!=e.ObjectTypes.OBJ_MARK&&e.object.type!=e.ObjectTypes.OBJ_SERVICE_IP&&e.object.type!=e.ObjectTypes.OBJ_SERVICE_ICMP?9:-1),a(),O(e.object.type==e.ObjectTypes.OBJ_ADDRESS?10:-1),a(),O(e.object.type==e.ObjectTypes.OBJ_ADDRESS?11:-1),a(),O(e.object.type==e.ObjectTypes.OBJ_ADDRESS_RANGE?12:-1),a(),O(e.object.type==e.ObjectTypes.OBJ_ADDRESS_RANGE?13:-1),a(),O(e.object.type==e.ObjectTypes.OBJ_ADDRESS||e.object.type==e.ObjectTypes.OBJ_ADDRESS_RANGE?14:-1),a(),O(e.object.type==e.ObjectTypes.OBJ_NETWORK?15:-1),a(),O(e.object.type==e.ObjectTypes.OBJ_NETWORK?16:-1),a(),O(e.object.type==e.ObjectTypes.OBJ_NETWORK?17:-1),a(),O((e.object.type==e.ObjectTypes.OBJ_GROUP||e.object.type==e.ObjectTypes.OBJ_SERVICE_GROUP)&&e.object.id?18:-1),a(),O(e.object.type==e.ObjectTypes.OBJ_SERVICE_IP?19:-1),a(),O(e.object.type==e.ObjectTypes.OBJ_SERVICE_TCP||e.object.type==e.ObjectTypes.OBJ_SERVICE_UDP?20:-1),a(),O(e.object.type==e.ObjectTypes.OBJ_SERVICE_TCP?21:-1),a(),O(e.object.type==e.ObjectTypes.OBJ_SERVICE_ICMP?22:-1),a(),O(e.object.type==e.ObjectTypes.OBJ_SERVICE_ICMP?23:-1),a(),O(e.object.type==e.ObjectTypes.OBJ_INTERFACE_HOST||e.object.type==e.ObjectTypes.OBJ_INTERFACE_FIREWALL?24:-1),a(),O(e.object.type==e.ObjectTypes.OBJ_INTERFACE_HOST||e.object.type==e.ObjectTypes.OBJ_INTERFACE_FIREWALL?25:-1),a(),O(e.object.type==e.ObjectTypes.OBJ_MARK?26:-1),a(),O(e.object.type==e.ObjectTypes.OBJ_GEN_RULE?27:-1),a(),O(e.object.type!=e.ObjectTypes.OBJ_GEN_RULE?28:-1),a(),O(e.objErrorMessage?29:-1),a(),D("header",y(31,32,"ITEM_PANEL.HEADER.INFO")),m("disabled",e.loadingData||!e.object._fwcObjectInfo),a(4),O(e.object._fwcObjectInfo?34:-1)}}function f_(r,u){r&1&&(c(0,"div",94),T(1,"p-progressSpinner"),_())}function m_(r,u){if(r&1){let e=L();c(0,"div",95)(1,"sts-fwc-object-restrictions",96),P("onHideParent",function(){h(e);let t=d(3);return w(t.minimizeDialog(!0))})("onRefreshRestrictions",function(){h(e);let t=d(3);return w(t.reloadPanel())}),_()()}if(r&2){let e=d(3);a(),m("dependencies",e.dependencies)}}function h_(r,u){if(r&1&&(T(0,"sts-fwc-message",91),F(1,m_,2,1,"div",95)),r&2){let e=d(2);m("message",e.deleteMsg),a(),O(e.dependencies.restrictionsError?-1:1)}}function w_(r,u){if(r&1&&T(0,"sts-fwc-message",91),r&2){let e=d(2);m("message",e.deleteMsg)}}function S_(r,u){if(r&1&&F(0,f_,2,0,"div",94)(1,h_,2,2)(2,w_,1,1,"sts-fwc-message",91),r&2){let e=d();O(e.loadingData&&!e.deleteMsg?0:-1),a(),O(e.dependencies?1:2)}}function g_(r,u){if(r&1){let e=L();c(0,"button",102),C(1,"translate"),P("click",function(){h(e);let t=d(4);return w(t.onCancel())}),_()}if(r&2){let e=d(4);D("label",y(1,2,"GLOBALS.MSG_BUTTONS.CANCEL")),m("disabled",!e.object||e.loadingData)}}function C_(r,u){if(r&1){let e=L();c(0,"button",103),C(1,"translate"),P("click",function(){h(e);let t=d(4);return w(t.onSave())}),_()}if(r&2){let e=d(4);D("label",y(1,2,"GLOBALS.MSG_BUTTONS.SAVE")),m("disabled",!e.formModel.valid||e.formModel.pristine||e.loadingData)}}function y_(r,u){if(r&1){let e=L();c(0,"button",104),C(1,"translate"),P("click",function(){h(e);let t=d(4);return w(t.onCancel())}),_()}r&2&&D("label",y(1,1,"GLOBALS.MSG_BUTTONS.CLOSE"))}function E_(r,u){if(r&1&&(c(0,"div",99),T(1,"p-progressSpinner"),_(),F(2,g_,2,4,"button",100)(3,C_,2,4,"button",101)(4,y_,2,3,"button",98)),r&2){let e=d(3);m("ngStyle",Ie(6,Ht,e.loadingData?"visible":"hidden")),a(),Ve(B(8,nl)),a(),O(e.formModel.pristine?-1:2),a(),O(e.formModel.pristine?-1:3),a(),O(e.formModel.pristine?4:-1)}}function v_(r,u){if(r&1){let e=L();c(0,"button",104),C(1,"translate"),P("click",function(){h(e);let t=d(3);return w(t.onCancel())}),_()}r&2&&D("label",y(1,1,"GLOBALS.MSG_BUTTONS.CLOSE"))}function I_(r,u){if(r&1&&F(0,E_,5,9)(1,v_,2,3,"button",98),r&2){let e=d(2);O(e.object.fwcloud||e.object.type==e.ObjectTypes.OBJ_INTERFACE_FIREWALL?0:-1),a(),O(!e.object.fwcloud&&e.object.type!=e.ObjectTypes.OBJ_INTERFACE_FIREWALL?1:-1)}}function b_(r,u){if(r&1){let e=L();c(0,"button",107),C(1,"translate"),P("click",function(){h(e);let t=d(3);return w(t.reloadPanel())}),_()}if(r&2){let e=d(3);D("label",y(1,2,"POLICY_GRID.RELOAD")),m("disabled",e.loadingData)}}function P_(r,u){if(r&1){let e=L();F(0,b_,2,4,"button",105),c(1,"div",99),T(2,"p-progressSpinner"),_(),c(3,"button",85),C(4,"translate"),P("click",function(){h(e);let t=d(2);return w(t.onDeleteObject())}),_(),c(5,"button",106),C(6,"translate"),P("click",function(){h(e);let t=d(2);return w(t.onCancel())}),_()}if(r&2){let e=d(2);O(e.dependencies?0:-1),a(),m("ngStyle",Ie(11,Ht,e.loadingData?"visible":"hidden")),a(),Ve(B(13,nl)),a(),D("label",y(4,7,"ITEM_PANEL.HEADER.DEL_OBJ")),m("disabled",!e.okToDelete||e.loadingData),a(2),D("label",y(6,9,"GLOBALS.MSG_BUTTONS.CANCEL"))}}function T_(r,u){if(r&1){let e=L();c(0,"button",108),C(1,"translate"),P("click",function(){h(e);let t=d(2);return w(t.onCancel())}),_()}if(r&2){let e=d(2);D("label",y(1,2,"GLOBALS.MSG_BUTTONS.CLOSE")),m("disabled",e.loadingData)}}function O_(r,u){if(r&1&&F(0,I_,2,2)(1,P_,7,14)(2,T_,2,4,"button",97),r&2){let e=d();O(e.object?0:-1),a(),O(e.objectToDelete?1:-1),a(),O(!e.object&&!e.objectToDelete?2:-1)}}var ol=(()=>{class r extends Bt{revalidateForm(e){if(e){this.formModel.controls[e].updateValueAndValidity(),e==="netmask"&&this.formModel.controls.address&&this.formModel.controls.address.updateValueAndValidity(),e==="range_start"&&this.formModel.controls.range_end&&this.formModel.controls.range_end.updateValueAndValidity();return}for(let i in this.formModel.controls)this.formModel.controls[i].updateValueAndValidity()}srcPortsValidator(e){let i=e.get("source_port_start").value,t=e.get("source_port_end").value;return i>0&&t>0&&i>t?{sourceports:!0}:null}destPortsValidator(e){let i=e.get("destination_port_start").value,t=e.get("destination_port_end").value;return i>0&&t>0&&i>t?{destinationports:!0}:null}constructor(e,i,t,n,o,l,p,s,f,S,E,I,b,x,J,U,M,Q,j,Z,oe,ve,ke,xt){super(p,S,e,Z,ke,xt),this.itemSelectedService=e,this.ruleSelectedService=i,this.fwcObjectService=t,this.fwcFirewallService=n,this.fwcInterfaceService=o,this.fwcPolicyService=l,this.appDialogPanelsService=p,this.fwcObjectTypeService=s,this.fwcVpnService=f,this.appOptionsService=S,this.fwcMarkService=E,this.fwcUserService=I,this.fwcRoutingTableService=b,this.fwcDhcpPolicyService=x,this.confirmationService=J,this.messageService=U,this.utilService=M,this.translate=Q,this.fwcErrorPipe=j,this.cd=Z,this.elementRef=oe,this.renderer=ve,this.store=ke,this.router=xt,this.fwcUserObject={},this.ObjectTypes=v,this.ipVersions=[{id:4,text:"IP version 4"},{id:6,text:"IP version 6"}],this.optionsFlags=[{name:this.translate.instant("RULE.OPTION_NAMES.0"),optionGroup:"STATE",status:!1,disableOnRuleActive:!0},{name:this.translate.instant("RULE.OPTION_NAMES.1"),optionGroup:"STATE",status:!1,disableOnRuleActive:!0},{name:this.translate.instant("RULE.OPTION_NAMES.2"),status:!1}],this.tabIndex=0,this.disableTabChange=!1,this.messageObject={},this.minMaxValidator=(_t,Pt)=>an=>{let Yt=!0,Vt=0,_i=0;return this.formModel.controls[_t]&&this.formModel.controls[Pt]&&(Vt=this.formModel.controls[_t].value,_i=this.formModel.controls[Pt].value),Yt=_i>=Vt,Yt?null:{minmax:!0}},this.ipRangeValidator=(_t,Pt)=>an=>{let Yt=this.formModel.controls[_t],Vt=this.formModel.controls[Pt];if(!Yt||!Vt)return null;let _i=Yt.value,sn=Vt.value;if(!_i||!sn||Yt.errors||Vt.errors&&Object.keys(Vt.errors).some(St=>St!=="rangeorder"))return null;try{let St=uo.parse(_i),qi=uo.parse(sn);if(St.kind()!==qi.kind())return{rangeorder:!0};let Jt=St.toByteArray(),Jn=qi.toByteArray(),mo=St.kind()==="ipv4"?1:2;for(let Tt=0;Tt<Jt.length-mo;Tt++)if(Jt[Tt]!==Jn[Tt])return{rangeorder:!0};for(let Tt=Jt.length-mo;Tt<Jt.length;Tt++){if(Jt[Tt]<Jn[Tt])return null;if(Jt[Tt]>Jn[Tt])return{rangeorder:!0}}return{rangeorder:!0}}catch{return null}},this.icmp_values=Array(256),this.dependencies=null,this.loadingData=!1,this.okToDelete=!1,this.alive=!0,this.infoTooltipShown=!1,this.createDialog(this.translate.instant("ITEM_PANEL.TITLE"),"fwci-ipobjects",q.ITEM_PANEL),this.helpSection="/ipobjs"}ngOnInit(){this.store.pipe(ee(()=>this.alive),ni(Ui.selectDialogUuidsToReload)).subscribe(e=>{e&&e.find(i=>i===this.dialogUUID)&&this.reloadPanel()}),this.itemSelectedService.hideObjectPanel().pipe(ee(()=>this.alive)).subscribe(e=>{this.hideDialog()}),this.itemSelectedService.getItem().pipe(ee(()=>this.alive)).subscribe(e=>{if([v.OBJ_FIREWALL,v.OBJ_CLUSTER,v.OBJ_OPENVPN_CONFIG_SER,v.OBJ_OPENVPN_CONFIG_CLI,v.OBJ_WGS_CONFIG_SER,v.OBJ_WGC_CONFIG_CLI,v.OBJ_ISS_CONFIG_SER,v.OBJ_ISC_CONFIG_CLI,v.OBJ_PREFIX_FOLDER,v.OBJ_OPENVPN_PREFIX,v.OBJ_WIREGUARD_PREFIX,v.OBJ_IPSEC_PREFIX].findIndex(t=>e._fwcObjType==t)==-1){if(e.unloadAction||e.fwcloud!==null&&e.fwcloud!=null&&e.fwcloud!=this.fwcUserObject.selectedFwCloud){this.resetProperties(),this.hideDialog();return}if(e.deleteAction)this.resetProperties(),this.recenterDialog(),this.showDialog(),this.checkObjectRestrictions(e);else{let t=e.whereUsedAction;e._onlySelectInTree||(this.disableTabChange=!1,e._fwcObjType!=v.OBJ_GEN_RULE&&(this.resetProperties(),this.onItemSelect(e,t)))}}}),this.ruleSelectedService.getRule().pipe(ee(()=>this.alive)).subscribe(e=>{this.onRuleSelect(e)}),this.fwcUserService.getFwcUser().pipe(ee(()=>this.alive)).subscribe(e=>{if(e){if(this.fwcUserObject&&this.fwcUserObject.user_id==e.user_id&&this.fwcUserObject.selectedFwCloud==e.selectedFwCloud||(this.fwcUserObject=Object.assign({},e),this.fwcUserObject.user_id===null||this.fwcUserObject.user_id===void 0||this.fwcUserObject.selectedFwCloud===null||this.fwcUserObject.selectedFwCloud===void 0))return;this.fwcObjectTypeService.getObjectTypes().subscribe(i=>{if(this.OBJECT_TYPES=[],i.data)for(let t of i.data)this.OBJECT_TYPES[t.id]=t.type},i=>{Qt.error("ERROR getting object types",i.error),this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(i)})})}})}ngAfterViewInit(){}ngOnDestroy(){super.ngOnDestroy()}reloadPanel(e){if(this.objectToDelete&&(this.displayDialog||this.dialogMinified)){let i=this.itemSelectedService.getActualLastMinifiedDialogId(),t=Object.assign({},this.objectToDelete);this.resetProperties(),this.recenterDialog(),this.checkObjectRestrictions(t),this.dialogId==i&&(this.showDialog(),this.itemSelectedService.setLastMinifiedDialogId(void 0)),this.store.dispatch(ue.reloadDialogFinished({dialogUuid:this.dialogUUID}))}else if(this.object&&(this.displayDialog||this.dialogMinified)){let i=this.object.whereUsedAction;if(this.disableTabChange=!0,!e||e._fwcObjType!=v.OBJ_GEN_RULE){let t=Object.assign({},this.object);this.resetProperties(!0),this.onItemSelect(t,i),this.store.dispatch(ue.reloadDialogFinished({dialogUuid:this.dialogUUID}))}}}showHelp(){this.appOptionsService.showHelp(this.helpSection)}resetProperties(e){e||(this.object=null,this.objectToDelete=null),this.dependencies=null,this.deleteMsg=null}onItemSelect(e,i){let t,n,o,l,p;if(t=e._fwcObjId,n=e._fwcObjType,o=e.fwcloud,l=e._fwcObjName,t==null&&n!==void 0){let s=Object.assign({},e);s.id=t,s.type=n,s.fwcloud=o,s.name=l,this.newObject(s)}else if(t!==void 0&&n!==void 0)switch(n){case v.OBJ_FIREWALL:this.fwcFirewallService.getFirewall(t,this.fwcUserObject.selectedFwCloud).subscribe(S=>{let E=S.data;E.type=n,this.parseObject(E,i,e),this.equalizeTabHeight(),this.recenterDialog(),this.objectToDelete=null,this.showDialog()},S=>{this.errorMessage=S,p=this.translate.instant("ITEM_PANEL.ERRORS.FW_LOAD",{name:l,error:S}),this.showErrorMsg(p)});break;case v.OBJ_INTERFACE_FIREWALL:case v.OBJ_INTERFACE_HOST:let s,f;n==v.OBJ_INTERFACE_HOST?(s=this.getInterfaceHost.bind(this),f=e.parent_id):(s=this.getInterface.bind(this),e._fwcFwId!==void 0&&e._fwcFwId!==null?f=e._fwcFwId:f=e.firewall),Promise.all([s(f,t),this.getInterfaceWhereUsed(t,n)]).then(([S,E])=>{let I=S.data,b=E.data;I.type=I.interface_type,this.parseObject(I,i,e),b._fwcObjType=n,this.object&&(this.object._fwcObjectInfo=b),this.equalizeTabHeight(),this.recenterDialog(),this.objectToDelete=null,this.showDialog()}).catch(S=>{p=this.translate.instant("ITEM_PANEL.ERRORS.IF_LOAD",{name:l,error:this.fwcErrorPipe.transform(S)}),this.showErrorMsg(p)});break;case v.OBJ_CONTINENT:case v.OBJ_GROUP:case v.OBJ_SERVICE_GROUP:Promise.all([this.getObjectGroup(t),this.getObjectGroupWhereUsed(t)]).then(([S,E])=>{let I=E.data,b=S.data;this.parseObject(b,i,e),I._fwcObjType=n,this.object&&(this.object._fwcObjectInfo=I),this.equalizeTabHeight(),this.recenterDialog(),this.objectToDelete=null,this.showDialog()}).catch(S=>{let E;E=this.fwcErrorPipe.transform(S),E&&(this.confirmationService.confirm({header:this.translate.instant("ITEM_PANEL.ERRORS.GROUP_READ.SUMMARY"),icon:"fa fa-exclamation-circle fwcRed iconBig",acceptLabel:"Ok",rejectVisible:!1,message:this.translate.instant("ITEM_PANEL.ERRORS.GROUP_READ.TEXT",{name:l,error:E})}),this.errorMessage=E.toString(),p=this.translate.instant("ITEM_PANEL.ERRORS.GRP_LOAD",{name:l,errorGrp:S}),this.showErrorMsg(p))});break;case v.OBJ_MARK:Promise.all([this.getMark(t),this.getMarkWhereUsed(t)]).then(([S,E])=>{let I=S.data,b=E.data;I.type=n,this.parseObject(I,i,e),b._fwcObjType=n,this.object&&(this.object._fwcObjectInfo=b),this.equalizeTabHeight(),this.recenterDialog(),this.objectToDelete=null,this.showDialog()}).catch(S=>{this.errorMessage=this.fwcErrorPipe.transform(S),p=this.translate.instant("ITEM_PANEL.ERRORS.OBJ_LOAD",{name:l,errorObject:this.errorMessage}),this.showErrorMsg(p)});break;case v.OBJ_OPENVPN_PREFIX:case v.OBJ_OPENVPN_CONFIG_CLI:Promise.all([this.getVPNObject(t,n),this.getVPNObjectWhereUsed(t,n)]).then(([S,E])=>{let I=S.data,b=E.data;I.name=I.cn,I.comment||(I.comment=""),I.fwcloud||(I.fwcloud=this.fwcUserService.getActualFwSelectedCloud()),this.parseObject(I,i,e),b._fwcObjType=n,this.object&&(this.object._fwcObjectInfo=b),this.equalizeTabHeight(),this.recenterDialog(),this.objectToDelete=null,this.showDialog()}).catch(S=>{this.errorMessage=this.fwcErrorPipe.transform(S),p=this.translate.instant("ITEM_PANEL.ERRORS.OBJ_LOAD",{name:l,errorObject:this.errorMessage}),this.showErrorMsg(p)});break;case v.OBJ_WIREGUARD_PREFIX:case v.OBJ_WGC_CONFIG_CLI:Promise.all([this.getWireGuardObject(t,n),this.getWireGuardObjectWhereUsed(t,n)]).then(([S,E])=>{let I=S.data,b=E.data;I.name=I.cn,I.comment||(I.comment=""),I.fwcloud||(I.fwcloud=this.fwcUserService.getActualFwSelectedCloud()),this.parseObject(I,i,e),b._fwcObjType=n,this.object&&(this.object._fwcObjectInfo=b),this.equalizeTabHeight(),this.recenterDialog(),this.objectToDelete=null,this.showDialog()}).catch(S=>{this.errorMessage=this.fwcErrorPipe.transform(S),p=this.translate.instant("ITEM_PANEL.ERRORS.OBJ_LOAD",{name:l,errorObject:this.errorMessage}),this.showErrorMsg(p)});break;case v.OBJ_IPSEC_PREFIX:case v.OBJ_ISS_CONFIG_SER:Promise.all([this.getIPSecObject(t,n),this.getIPSecObjectWhereUsed(t,n)]).then(([S,E])=>{let I=S.data,b=E.data;I.name=I.cn,I.comment||(I.comment=""),I.fwcloud||(I.fwcloud=this.fwcUserService.getActualFwSelectedCloud()),this.parseObject(I,i,e),b._fwcObjType=n,this.object&&(this.object._fwcObjectInfo=b),this.equalizeTabHeight(),this.recenterDialog(),this.objectToDelete=null,this.showDialog()}).catch(S=>{this.errorMessage=this.fwcErrorPipe.transform(S),p=this.translate.instant("ITEM_PANEL.ERRORS.OBJ_LOAD",{name:l,errorObject:this.errorMessage}),this.showErrorMsg(p)});break;default:Promise.all([this.getObject(t),this.getObjectWhereUsed(t,n)]).then(([S,E])=>{let I=S.data,b=E.data;this.parseObject(I,i,e),b._fwcObjType=n,this.object&&(this.object._fwcObjectInfo=b),this.equalizeTabHeight(),this.recenterDialog(),this.objectToDelete=null,this.showDialog()}).catch(S=>{this.errorMessage=this.fwcErrorPipe.transform(S),p=this.translate.instant("ITEM_PANEL.ERRORS.OBJ_LOAD",{name:l,errorObject:this.errorMessage}),this.showErrorMsg(p)});break}}checkObjectRestrictions(e){let i,t,n,o="ITEM_PANEL.DELETE_WARN.TEXT",l="ITEM_PANEL.ERRORS.RESTR_ERROR.TEXT";if(this.deleteDialogTitle="ITEM_PANEL.HEADER.DEL_OBJ",!e)return;let p=E=>{this.okToDelete=!0,this.deleteMsg={type:"warning",title:this.translate.instant("ITEM_PANEL.DELETE_WARN.SUMMARY"),text:this.translate.instant(E,{name:e._fwcObjName})}};this.objectToDelete=e,this.dependencies=null,this.okToDelete=!1;let s={fwcloud:this.fwcUserObject.selectedFwCloud,id:e._fwcObjId,type:e._fwcObjType};switch(e._fwcObjType){case v.OBJ_INTERFACE_FIREWALL:i=this.fwcInterfaceService.checkInterfaceRestrictions.bind(this.fwcInterfaceService),n=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_INTERFACE_FIREWALL"),delete s.type;break;case v.OBJ_INTERFACE_HOST:i=this.fwcInterfaceService.checkInterfaceRestrictions.bind(this.fwcInterfaceService),n=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_INTERFACE_FIREWALL"),s.host=e._fwcHostId,delete s.type;break;case v.OBJ_GROUP:case v.OBJ_SERVICE_GROUP:i=this.fwcObjectService.checkObjectGroupRestrictions.bind(this.fwcObjectService),n=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_GROUP");break;case v.OBJ_FIREWALL:break;case v.OBJ_MARK:i=this.fwcMarkService.checkMarkRestrictions.bind(this.fwcMarkService),n=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_MARK"),s.mark=s.id,delete s.id,delete s.type;break;case v.OBJ_ROUTING_TABLE:i=this.fwcRoutingTableService.checkTableRestrictions.bind(this.fwcRoutingTableService),n=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_ROUTING_TABLE"),s.firewall=e._fwcFwId,o="ITEM_PANEL.DELETE_WARN.TEXT_ROUTING_TABLE",l="ITEM_PANEL.ERRORS.RESTR_ERROR.TEXT_ROUTING_TABLE",this.deleteDialogTitle="ITEM_PANEL.HEADER.DEL_ROUTING_TABLE";break;case v.OBJ_DHCP_GROUP:i=this.fwcDhcpPolicyService.checkGroupRestrictions.bind(this.fwcDhcpPolicyService),n=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_DHCP_GROUP"),s.firewall=e._fwcFwId,o="ITEM_PANEL.DELETE_WARN.TEXT_DHCP_GROUP",l="ITEM_PANEL.ERRORS.RESTR_ERROR.TEXT_DHCP_GROUP",this.deleteDialogTitle="ITEM_PANEL.HEADER.DEL_DHCP_GROUP";break;case v.OBJ_KEEPALIVED_GROUP:i=this.fwcDhcpPolicyService.checkGroupRestrictions.bind(this.fwcDhcpPolicyService),n=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_KEEPALIVED_GROUP"),s.firewall=e._fwcFwId,o="ITEM_PANEL.DELETE_WARN.TEXT_KEEPALIVED_GROUP",l="ITEM_PANEL.ERRORS.RESTR_ERROR.TEXT_KEEPALIVED_GROUP",this.deleteDialogTitle="ITEM_PANEL.HEADER.DEL_KEEPALIVED_GROUP";break;default:i=this.fwcObjectService.checkObjectRestrictions.bind(this.fwcObjectService),n=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_GEN_IP_OBJECT");break}let f,S;e._fwcObjType===v.OBJ_INTERFACE_FIREWALL||e._fwcObjType===v.OBJ_ADDRESS&&e._fwcFwId?e._fwcClusterId?(t=this.fwcFirewallService.getClusterNodes.bind(this.fwcFirewallService),f=e._fwcClusterId,S=this.translate.instant("CLUSTER.CLUSTER_NODE_ROLES.NODE")):(t=this.fwcFirewallService.getFirewall.bind(this.fwcFirewallService),f=e._fwcFwId,S=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.FIREWALL")):t=(E,I)=>wo(null),i&&(this.loadingData=!0,Qi(i(s),t(f,this.fwcUserService.getActualFwSelectedCloud())).subscribe(([E,I])=>{let b;if(!I)b=null;else{let x=[],J=I.data;Array.isArray(J)?x=[...J]:x.push(J),b=x.find(U=>e._fwcObjType===v.OBJ_INTERFACE_FIREWALL&&U.install_interface===e._fwcObjId||e._fwcObjType===v.OBJ_ADDRESS&&U.install_ipobj===e._fwcObjId)}if(!b)p(o);else{let x=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_INTERFACE_FIREWALL");e._fwcObjType===v.OBJ_ADDRESS&&(x=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_ADDRESS")),this.deleteMsg={type:"error",title:this.translate.instant("ITEM_PANEL.ERRORS.INTERFACE_IP_INSTALLATION.SUMMARY",{objType:x}),text:this.translate.instant("ITEM_PANEL.ERRORS.INTERFACE_IP_INSTALLATION.TEXT",{objName:e._fwcObjName,objType:x.toLowerCase(),fwName:b.name,fwType:S.toLowerCase()})}}this.dependencies=null,this.loadingData=!1,this.recenterDialog()},E=>{let I,b=E.error;if(b&&(b.restrictions?I=b.restrictions:b.data&&b.data.restrictions&&(I=b.data.restrictions)),I){this.dependencies=I;let x={};for(let J in this.dependencies)J!=="IpobjInterface"&&Array.isArray(this.dependencies[J])&&this.dependencies[J].length&&(x[J]=this.dependencies[J]);Object.keys(x).length?(x._fwcRestrictedObject={_fwcObjId:e._fwcObjId,_fwcObjType:e._fwcObjType},this.deleteMsg={type:"error",title:this.translate.instant("ITEM_PANEL.ERRORS.RESTR_ERROR.SUMMARY"),text:this.translate.instant(l,{name:e._fwcObjName})}):(this.dependencies=null,p(o))}else this.deleteMsg={type:"error",title:this.translate.instant("ITEM_PANEL.ERRORS.DELETE_ERROR.SUMMARY"),text:this.fwcErrorPipe.transform(E)},this.dependencies={restrictionsError:!0};this.loadingData=!1,this.recenterDialog()}))}onDeleteObject(){let e,i;this.loadingData=!0;let t={fwcloud:this.fwcUserObject.selectedFwCloud,id:this.objectToDelete._fwcObjId,type:this.objectToDelete._fwcObjType};switch(this.objectToDelete._fwcObjType){case v.OBJ_INTERFACE_FIREWALL:e=this.fwcInterfaceService.deleteInterfaceFw.bind(this.fwcInterfaceService),i=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_INTERFACE_FIREWALL"),t.firewall=this.objectToDelete._fwcFwId;break;case v.OBJ_INTERFACE_HOST:e=this.fwcInterfaceService.deleteInterfaceHost.bind(this.fwcInterfaceService),i=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_INTERFACE_FIREWALL"),t.host=this.objectToDelete._fwcHostId;break;case v.OBJ_GROUP:case v.OBJ_SERVICE_GROUP:e=this.fwcObjectService.deleteObjectGroup.bind(this.fwcObjectService),i=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_GROUP");break;case v.OBJ_FIREWALL:break;case v.OBJ_MARK:e=this.fwcMarkService.deleteMark.bind(this.fwcMarkService),i=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_MARK"),t.mark=t.id,delete t.id,delete t.type;break;case v.OBJ_ROUTING_TABLE:e=this.fwcRoutingTableService.deleteRoutingTable.bind(this.fwcRoutingTableService),i=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_ROUTING_TABLE"),t.firewall=this.objectToDelete._fwcFwId,delete t.type;break;case v.OBJ_DHCP_GROUP:e=this.fwcDhcpPolicyService.deleteDhcpPolicyRulesGroup.bind(this.fwcDhcpPolicyService),i=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_DHCP_GROUP"),t.firewall=this.objectToDelete._fwcFwId,delete t.type;break;default:e=this.fwcObjectService.deleteObject.bind(this.fwcObjectService),i=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_GEN_IP_OBJECT");break}this.utilService.fwcAPICall(e,t).then(n=>{let o=Object.assign({},this.objectToDelete),l=this.translate.instant("TREE.MSG_DELETE_OBJ_SUCCESS_1",{objtype:i});if(o._fwcTreeAction=Ue.DELETE_ITEM,n.data&&n.data.fw_status&&(o.fw_status=n.data.fw_status),this.itemSelectedService.setModifiedItem(o),this.objectToDelete._fwcObjType===v.OBJ_ROUTING_TABLE){l=this.translate.instant("ROUTING.DELETE_TABLE.SUCCESS"),this.itemSelectedService.setModifiedItem({_fwcTreeAction:Ue.RELOAD_TREE,containerToReload:nt.C_FIREWALLS});let p=this.fwcPolicyService.getActualSelectedPolicy();p&&p._fwcPolicyType===Pe.ROUTING_TABLE&&p._fwcObjId===this.objectToDelete._fwcObjId&&this.fwcPolicyService.setSelectedPolicy({_fwcFwId:null,fwId:null})}Array.isArray(n.data)&&this.store.dispatch(Qe.updateFwStatus({item:n.data})),this.hideDialog(),this.loadingData=!1,this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.OK"),detail:l})}).catch(n=>{this.deleteMsg={type:"error",title:this.translate.instant("ITEM_PANEL.ERRORS.DELETE_ERROR.SUMMARY"),text:this.fwcErrorPipe.transform(n)},this.dependencies={restrictionsError:!0},this.loadingData=!1})}showErrorMsg(e){e&&this.confirmationService.confirm({header:"Error",icon:"fa fa-exclamation-circle fwcRed iconBig",acceptLabel:"Ok",rejectVisible:!1,message:e})}getObject(e){return new Promise((t,n)=>{this.fwcObjectService.getObject(e,this.fwcUserObject.selectedFwCloud).subscribe(o=>{t(o)},o=>{n(o)})})}getObjectWhereUsed(e,i){return new Promise((n,o)=>{this.fwcObjectService.getObjectWhereUsed(e,i,this.fwcUserObject.selectedFwCloud).subscribe(l=>{n(l)},l=>{o(l)})})}getInterface(e,i){return new Promise((n,o)=>{this.fwcInterfaceService.getInterface(e,i,this.fwcUserObject.selectedFwCloud).subscribe(l=>{n(l)},l=>{o(l)})})}getInterfaceHost(e,i){return new Promise((n,o)=>{this.fwcInterfaceService.getInterfaceHost(e,i,this.fwcUserObject.selectedFwCloud).subscribe(l=>{n(l)},l=>{o(l)})})}getInterfaceWhereUsed(e,i){return new Promise((n,o)=>{this.fwcInterfaceService.getInterfaceWhereUsed(e,i,this.fwcUserObject.selectedFwCloud).subscribe(l=>{n(l)},l=>{o(l)})})}getObjectGroup(e){return new Promise((t,n)=>{this.fwcObjectService.getObjectGroup(e,this.fwcUserObject.selectedFwCloud).subscribe(o=>{t(o)},o=>{n(o)})})}getObjectGroupWhereUsed(e){return new Promise((t,n)=>{this.fwcObjectService.getObjectGroupWhereUsed(e,this.fwcUserObject.selectedFwCloud).subscribe(o=>{t(o)},o=>{n(o)})})}getVPNObject(e,i){return new Promise((n,o)=>{let l,p={fwcloud:this.fwcUserService.getActualFwSelectedCloud()};i==v.OBJ_OPENVPN_PREFIX?(l=this.fwcVpnService.getOpenVPNPrefixInfo.bind(this.fwcVpnService),p.prefix=e):i==v.OBJ_OPENVPN_CONFIG_CLI&&(l=this.fwcVpnService.getConfigInfo.bind(this.fwcVpnService),p.openvpn=e),l(p).subscribe(s=>{n(s)},s=>{o(s)})})}getVPNObjectWhereUsed(e,i){return new Promise((n,o)=>{let l,p={fwcloud:this.fwcUserService.getActualFwSelectedCloud()};i==v.OBJ_OPENVPN_PREFIX?(l=this.fwcVpnService.getOpenVPNWhereUsed.bind(this.fwcVpnService),p.prefix=e):i==v.OBJ_OPENVPN_CONFIG_CLI&&(l=this.fwcVpnService.getConfigWhereUsed.bind(this.fwcVpnService),p.openvpn=e),l(p).subscribe(s=>{n(s)},s=>{o(s)})})}getWireGuardObject(e,i){return new Promise((n,o)=>{let l,p={fwcloud:this.fwcUserService.getActualFwSelectedCloud()};i==v.OBJ_WIREGUARD_PREFIX?(l=this.fwcVpnService.getWireGuardPrefixInfo.bind(this.fwcVpnService),p.prefix=e):i==v.OBJ_WGC_CONFIG_CLI&&(l=this.fwcVpnService.getWireGuardConfig.bind(this.fwcVpnService),p.wireguard=e),l(p).subscribe(s=>{n(s)},s=>{o(s)})})}getWireGuardObjectWhereUsed(e,i){return new Promise((n,o)=>{let l,p={fwcloud:this.fwcUserService.getActualFwSelectedCloud()};i==v.OBJ_WIREGUARD_PREFIX?(l=this.fwcVpnService.getWireGuardWhereUsed.bind(this.fwcVpnService),p.prefix=e):i==v.OBJ_WGC_CONFIG_CLI&&(l=this.fwcVpnService.getWireGuardConfigWhereUsed.bind(this.fwcVpnService),p.wireguard=e),l(p).subscribe(s=>{n(s)},s=>{o(s)})})}getIPSecObject(e,i){return new Promise((t,n)=>{let o,l={fwcloud:this.fwcUserService.getActualFwSelectedCloud()};i==v.OBJ_IPSEC_PREFIX?(o=this.fwcVpnService.getIPSecPrefixInfo.bind(this.fwcVpnService),l.prefix=e):i==v.OBJ_ISC_CONFIG_CLI&&(o=this.fwcVpnService.getIPSecConfig.bind(this.fwcVpnService),l.ipsec=e),o(l).subscribe(p=>{t(p)},p=>{n(p)})})}getIPSecObjectWhereUsed(e,i){return new Promise((t,n)=>{let o,l={fwcloud:this.fwcUserService.getActualFwSelectedCloud()};i==v.OBJ_IPSEC_PREFIX?(o=this.fwcVpnService.getIPSecWhereUsed.bind(this.fwcVpnService),l.prefix=e):i==v.OBJ_ISC_CONFIG_CLI&&(o=this.fwcVpnService.getIPSecConfigWhereUsed.bind(this.fwcVpnService),l.ipsec=e),o(l).subscribe(p=>{t(p)},p=>{n(p)})})}getMark(e){return new Promise((t,n)=>{let o={fwcloud:this.fwcUserObject.selectedFwCloud,mark:e};this.fwcMarkService.getMark(o).subscribe(l=>{t(l)},l=>{n(l)})})}getMarkWhereUsed(e){return new Promise((t,n)=>{let o={fwcloud:this.fwcUserObject.selectedFwCloud,mark:e};this.fwcMarkService.getMarkWhereUsed(o).subscribe(l=>{t(l)},l=>{n(l)})})}onRuleSelect(e){let i,t,n,o,l,p;if(i=this.fwcUserObject.customer_id,t=this.fwcUserObject.selectedFwCloud,n=e.firewall,o=e.type,l=e.id,!i||!t||!n||!o||!l){this.showErrorMsg(this.translate.instant("ITEM_PANEL.ERRORS.RULE_LOAD",{id:l}));return}e.type===z[X.DHCP]||e.type===z[X.DHCP_FIXED_IP]||e.type===z[X.KEEPALIVED]||e.type===z[X.HAPROXY]||this.fwcPolicyService.getPolicyRule(n,o,l,this.fwcUserObject.selectedFwCloud).pipe(ee(()=>this.alive)).subscribe(s=>{let f;s.data&&(f=s.data,p=Object.assign({},e),delete p.positions,p.fwcloud=this.fwcUserObject.selectedFwCloud,p.name=this.translate.instant("ITEM_PANEL.RULE_NAME"),p.type=v.OBJ_GEN_RULE,p.ruleType=o,this.parseObject(p),this.showDialog())},s=>{this.errorMessage=this.fwcErrorPipe.transform(s),this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.errorMessage})})}parseObject(e,i,t){let n=0;!e||e.id===void 0||e.name===void 0||e.comment===void 0||(e._fwcObjId=e.id,e._fwcObjName=e.name,e._fwcObjType=e.type,e.type==v.OBJ_CONTINENT?e.name=this.translate.instant("NODE_TYPES."+e.name):e.type==v.OBJ_COUNTRIE&&(e.name=this.translate.instant("COUNTRIES."+e.name)),e.firewall!==null&&e.firewall!=null&&(e._fwcFwId=e.firewall),e.ipobjs&&e.ipobjs.forEach(function(o){o._fwcObjId=o.id,o._fwcObjName=o.name,o._fwcObjType=o.obj_type=o.type}),t&&t.duplicateObjectAction&&(e.id=e._fwcObjId=void 0,e._fwcObjName=e.name=e.name+"-DUP",e.container=t.container,e.containerReadOnly=t.containerReadonly,e.duplicateObjectAction=!0,e.node_parent=t.node_parent,e.node_order=1,e.node_type=t.node_type,e.fwcloud=this.fwcUserObject.selectedFwCloud),this.createForm(e),i&&(n=1,e.whereUsedAction=i),this.object=e,this.disableTabChange||(this.tabIndex=n))}newObject(e){this.createForm(e),this.object=e,this.showDialog()}createForm(e){if(e){switch(this.formModel=new mi({id:new k(e.id),comment:new k(e.comment),type:new k(e.type)}),e.type!=v.OBJ_GEN_RULE&&this.formModel.addControl("name",new k(e.name,[$.required,$.pattern(be.nameRegExp)])),e.type){case v.OBJ_FIREWALL:break;case v.OBJ_ADDRESS:this.formModel.addControl("address",new k(e.address,{validators:be.ipAddressValidator.bind(this),updateOn:"blur"})),this.formModel.addControl("netmask",new k(e.netmask,{validators:be.netmaskValidator.bind(this),updateOn:"blur"})),this.formModel.addControl("ip_version",new k(e.ip_version?e.ip_version:this.ipVersions[0].id)),this.formModel.addControl("interface",new k(e.interface));break;case v.OBJ_ADDRESS_RANGE:this.formModel.addControl("range_start",new k(e.range_start,{validators:be.ipAddressValidator.bind(this),updateOn:"blur"})),this.formModel.addControl("range_end",new k(e.range_end,{validators:[be.ipAddressValidator.bind(this),this.ipRangeValidator("range_start","range_end")],updateOn:"blur"})),this.formModel.addControl("ip_version",new k(e.ip_version?e.ip_version:this.ipVersions[0].id));break;case v.OBJ_NETWORK:this.formModel.addControl("address",new k(e.address,{validators:be.networkAddressValidator.bind(this),updateOn:"blur"})),this.formModel.addControl("netmask",new k(e.netmask,{validators:be.netmaskValidator.bind(this),updateOn:"blur"})),this.formModel.addControl("ip_version",new k(e.ip_version?e.ip_version:this.ipVersions[0].id));break;case v.OBJ_HOST:break;case v.OBJ_GROUP:break;case v.OBJ_DNS:this.formModel.controls.name.setValidators([$.required,$.pattern(be.fqdnRegexp)]);break;case v.OBJ_INTERFACE_HOST:case v.OBJ_INTERFACE_FIREWALL:this.formModel.addControl("labelName",new k(e.labelName,$.pattern(be.nameRegExp))),this.formModel.addControl("mac",new k(e.mac,$.pattern(be.macRegexp)));break;case v.OBJ_SERVICE_IP:this.formModel.addControl("protocol",new k(e.protocol,[$.min(0),$.max(255)]));break;case v.OBJ_SERVICE_TCP:this.formModel.addControl("tcp_flags_mask",new k(e.tcp_flags_mask)),this.formModel.addControl("tcp_flags_settings",new k(e.tcp_flags_settings)),this.formModel.addControl("source_port_start",new k(e.source_port_start?e.source_port_start:0,[$.required,$.min(0),$.max(65535)])),this.formModel.addControl("source_port_end",new k(e.source_port_end?e.source_port_end:0,[$.required,$.min(0),$.max(65535)])),this.formModel.addControl("destination_port_start",new k(e.destination_port_start?e.destination_port_start:0,[$.required,$.min(0),$.max(65535)])),this.formModel.addControl("destination_port_end",new k(e.destination_port_end?e.destination_port_end:0,[$.required,$.min(0),$.max(65535)])),this.formModel.addControl("protocol",new k(e.protocol,[$.min(0),$.max(255)])),this.formModel.setValidators([this.srcPortsValidator,this.destPortsValidator]),this.setTCPFlags(e.tcp_flags_mask,e.tcp_flags_settings);break;case v.OBJ_SERVICE_ICMP:this.formModel.addControl("icmp_type",new k(e.icmp_type?e.icmp_type:-1,[$.required,$.min(-1),$.max(255)])),this.formModel.addControl("icmp_code",new k(e.icmp_code?e.icmp_code:-1,[$.required,$.min(-1),$.max(255)])),this.formModel.addControl("protocol",new k(e.protocol,[$.min(0),$.max(255)]));break;case v.OBJ_SERVICE_UDP:this.formModel.addControl("source_port_start",new k(e.source_port_start?e.source_port_start:0,[$.required,$.min(0),$.max(65535)])),this.formModel.addControl("source_port_end",new k(e.source_port_end?e.source_port_end:0,[$.required,$.min(0),$.max(65535)])),this.formModel.addControl("destination_port_start",new k(e.destination_port_start?e.destination_port_start:0,[$.required,$.min(0),$.max(65535)])),this.formModel.addControl("destination_port_end",new k(e.destination_port_end?e.destination_port_end:0,[$.required,$.min(0),$.max(65535)])),this.formModel.addControl("protocol",new k(e.protocol,[$.min(0),$.max(255)])),this.formModel.setValidators([this.srcPortsValidator,this.destPortsValidator]);break;case v.OBJ_SERVICE_GROUP:break;case v.OBJ_GEN_RULE:this.formModel.addControl("firewall",new k(e.firewall)),this.formModel.addControl("options",new k(e.options)),this.formModel.addControl("run_before",new k(e.run_before)),this.formModel.addControl("run_after",new k(e.run_after)),this.setOptionsFlags(e);break;case v.OBJ_MARK:this.formModel.addControl("code",new k(e.code,[$.required,$.min(1)]));break}this.formModel.get("ip_version")?.valueChanges.subscribe(()=>{this.formModel.get("address")?.updateValueAndValidity()}),this.formModel.get("netmask")?.valueChanges.subscribe(()=>{this.formModel.get("address")?.updateValueAndValidity()}),e.duplicateObjectAction&&this.formModel.markAsDirty()}}setOptionsFlags(e){if(e){let i;for(let t=0;t<this.optionsFlags.length;t++){let n=this.optionsFlags[t];i=!!(e.options&2**t),n.status=i}}}onChangeOptionsFlags(e){let i,t=0;i=this.optionsFlags[e].optionGroup;for(let n=0;n<this.optionsFlags.length;n++)i==this.optionsFlags[n].optionGroup&&n!=e&&(this.optionsFlags[n].status=!1),this.optionsFlags[n].status&&(t|=2**n);this.formModel.controls.options.setValue(t),this.formModel.markAsDirty()}setTCPFlags(e,i){let t=["URG","ACK","PSH","RST","SYN","FIN"];this.tcpFlagsArray=[];for(let n=0;n<t.length;n++){let o,l=t[n],p=!!(e&2**n),s=!!(i&2**n);o={name:l,mask:p,status:s},this.tcpFlagsArray.push(o)}}setFormTCPFlags(e){let i=0,t=0;this.tcpFlagsArray[e].mask||(this.tcpFlagsArray[e].status=!1);for(let n=0;n<this.tcpFlagsArray.length;n++){let o=this.tcpFlagsArray[n].mask,l=this.tcpFlagsArray[n].status;o&&(i|=2**n),l&&(t|=2**n)}this.formModel.controls.tcp_flags_mask.setValue(i),this.formModel.controls.tcp_flags_settings.setValue(t),this.formModel.markAsDirty()}checkForm(e){e&&e.target&&e.target.type!="textarea"&&this.formModel.valid&&(e.target.blur(),this.onSave())}onSave(e=0){if(this.object)if(this.loadingData=!0,this.objErrorMessage=null,this.object.id==null){let i={fwcloud:this.fwcUserObject.selectedFwCloud},t=this.object;for(let l in this.formModel.controls)i[l]=t[l]=this.formModel.controls[l].value!==null&&this.formModel.controls[l].value!==void 0?this.formModel.controls[l].value:void 0;this.object.type!=v.OBJ_MARK&&(i.node_parent=+this.object.node_parent,i.node_order=+this.object.node_order,i.node_type=this.object.node_type),e&&(i.force=e);let n,o;switch(this.object.type){case v.OBJ_FIREWALL:o=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.FIREWALL");break;case v.OBJ_INTERFACE_FIREWALL:case v.OBJ_INTERFACE_HOST:n=this.fwcInterfaceService.newInterface.bind(this.fwcInterfaceService),o=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_INTERFACE_FIREWALL"),i.firewall=this.object.firewall||this.object.firewall_id||this.object._fwcFwId,i.host=this.object.host||this.object.host_id||this.object._fwcHostId,i.interface_type=this.object.interface_type;break;case v.OBJ_GROUP:case v.OBJ_SERVICE_GROUP:n=this.fwcObjectService.newObjectGroup.bind(this.fwcObjectService),o=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_GROUP");break;case v.OBJ_MARK:n=this.fwcMarkService.newMark.bind(this.fwcMarkService),o=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_MARK"),i.node_id=this.object.node_parent,delete i.type;break;default:n=this.fwcObjectService.newObject.bind(this.fwcObjectService),o=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_GEN_IP_OBJECT");break}this.utilService.fwcAPICall(n,i).then(l=>{let p=l.data.insertId,s=l.data.TreeinsertId;this.object.id=this.object.id_obj=this.object._fwcObjId=p,this.formModel.controls.id.setValue(p),this.object.id_node=this.object._fwcObjTreeId=s,this.object._fwcObjTreeParentId=this.object.node_parent,this.object.text=this.object.name,this.object.obj_type=this.object._fwcObjType,this.object.firewall!==void 0&&this.object.firewall!==null&&(this.object._fwcFwId=this.object.firewall),t._fwcTreeAction=Ue.NEW_ITEM,this.itemSelectedService.setModifiedItem(t),l.data&&l.data.fw_status&&this.store.dispatch(Qe.updateFwStatus({item:l.data.fw_status})),this.formModel.markAsPristine(),this.object._fwcObjType==v.OBJ_GROUP||this.object._fwcObjType==v.OBJ_SERVICE_GROUP?(this.displayDialog=!0,this.onItemSelect(this.object)):this.onCancel(),this.loadingData=!1,this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.OK"),detail:this.translate.instant("ITEM_PANEL.OBJ_CREATED",{objType:o})})}).catch(l=>{if(l&&l.status==400&&l.error&&l.error.fwcErr==1003)if(this.object.type!=v.OBJ_MARK){let p=l.data;this.confirmDuplicateOperation(p)}else this.confirmationService.confirm({header:this.translate.instant("ITEM_PANEL.ERRORS.DUP_MARK_ERROR.SUMMARY"),icon:"fa fa-exclamation-circle fwcRed iconBig",acceptLabel:"Ok",rejectVisible:!1,message:this.translate.instant("ITEM_PANEL.ERRORS.DUP_MARK_ERROR.TEXT")});else this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(l)});this.loadingData=!1})}else{if(!this.object.fwcloud&&this.object.type!=v.OBJ_INTERFACE_FIREWALL)return;let i={fwcloud:this.fwcUserObject.selectedFwCloud},t=Object.assign({},this.object);for(let l in this.formModel.controls)i[l]=t[l]=this.formModel.controls[l].value!==null&&this.formModel.controls[l].value!==void 0?this.formModel.controls[l].value:void 0;this.formModel.controls.name&&(t._fwcObjName=this.formModel.controls.name.value),t._fwcUserId=this.fwcUserObject.user_id;let n,o;switch(t.type){case v.OBJ_FIREWALL:n=this.fwcFirewallService.updateFirewall.bind(this.fwcFirewallService),o=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.FIREWALL");break;case v.OBJ_INTERFACE_FIREWALL:case v.OBJ_INTERFACE_HOST:n=this.fwcInterfaceService.updateInterface.bind(this.fwcInterfaceService),o=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_INTERFACE_FIREWALL"),i.interface_type=this.object.interface_type;break;case v.OBJ_GROUP:case v.OBJ_SERVICE_GROUP:n=this.fwcObjectService.updateObjectGroup.bind(this.fwcObjectService),o=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_GROUP");break;case v.OBJ_GEN_RULE:n=this.fwcPolicyService.updatePolicyRuleAsObject.bind(this.fwcPolicyService),o=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_RULE"),i.type=t.type=t.ruleType,i.run_before||(i.run_before=null),i.run_after||(i.run_after=null),i.rule=i.id,delete i.id;break;case v.OBJ_MARK:n=this.fwcMarkService.updateMark.bind(this.fwcMarkService),o=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_MARK"),i.mark=i.id,delete i.id,delete i.type;break;default:n=this.fwcObjectService.updateObject.bind(this.fwcObjectService),o=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_GEN_IP_OBJECT");break}e&&(i.force=e),this.utilService.fwcAPICall(n,i).then(l=>{if(l.data&&l.data.fw_status&&(t.fw_status=l.data.fw_status),t.ruleType){let p;p={id:t.id,firewall:t.firewall,type:t.ruleType,options:t.options,run_before:t.run_before,run_after:t.run_after},this.ruleSelectedService.setModifiedRule(p),this.store.dispatch(Qe.updateFwStatus({item:{cluster:this.object._fwcClusterId,id:this.object._fwcFwId,status:3}}))}else t._fwcTreeAction=Ue.MODIFY_ITEM,this.itemSelectedService.setModifiedItem(t),this.store.dispatch(Qe.updateFwStatus({item:t.fw_status})),this.itemSelectedService.updateClipboardItem(t);this.loadingData=!1,this.formModel.markAsPristine(),this.onCancel(),this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.OK"),detail:this.translate.instant("ITEM_PANEL.OBJ_UPDATED",{objType:o})})}).catch(l=>{if(l&&l.status==400&&l.error&&l.error.fwcErr==1003)if(this.object.type!=v.OBJ_MARK){let p;Array.isArray(l.data)&&(p=l.data.filter(s=>s.id!=this.object.id),p&&p.length&&this.confirmDuplicateOperation(p))}else this.confirmationService.confirm({header:this.translate.instant("ITEM_PANEL.ERRORS.DUP_MARK_ERROR.SUMMARY"),icon:"fa fa-exclamation-circle fwcRed iconBig",acceptLabel:"Ok",rejectVisible:!1,message:this.translate.instant("ITEM_PANEL.ERRORS.DUP_MARK_ERROR.TEXT")});else l&&l.status===400&&l.data==="The interface cannot be updated. There are references in dhcp_r."?this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.translate.instant("ITEM_PANEL.ERRORS.INTERFACE_MAC_ERROR.TEXT")}):this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(l)});this.loadingData=!1})}}onCancel(e){!e&&this.formModel&&!this.formModel.pristine&&this.formModel.valid?this.confirmationService.confirm({header:this.translate.instant("GLOBALS.MSG_CONFIRM"),icon:"fa fa-question-circle fwcBlue iconBig",message:this.translate.instant("ITEM_PANEL.MSG_EXIT"),accept:()=>{this.onCancel(!0)},rejectVisible:!0,rejectLabel:"No",acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.YES")}):(this.hideDialog(),this.objErrorMessage=null,this.object=null,this.objectToDelete=null,this.fwcUserService.setConfirmationToken(void 0),this.deleteMsg=null)}equalizeTabHeight(){}onDialogShow(){setTimeout(()=>{this.inputObjName&&this.inputObjName.nativeElement.focus();let e=0;this.object&&this.object.whereUsedAction&&(e=1),this.tabIndex=e,this.equalizeTabHeight(),this.recenterDialog()},150)}onDialogHide(){}onTabChange(e){e&&(this.tabIndex=e.index,this.recenterDialog())}showRestrictions(e,i){e&&(e._fwcShowRestrictions=!0,this.infoTooltipTimer=setTimeout(()=>{this.infoTooltipShown=!0,this.itemSelectedService.setObjectInfo(e,i)},1e3))}hideRestrictions(e){this.infoTooltipTimer&&(clearTimeout(this.infoTooltipTimer),this.infoTooltipTimer=void 0),this.infoTooltipShown&&(this.itemSelectedService.setObjectInfo(void 0,e),this.infoTooltipShown=!1)}confirmDuplicateOperation(e){let i="";if(this.loadingData=!1,e.length){i="<ul>";for(let t=0;t<e.length;t++)i+="<li><strong>"+e[t].name+"</strong> (Id: "+e[t].id+") </li>";i+="</ul>"}this.confirmationService.confirm({header:this.translate.instant("ITEM_PANEL.ERRORS.DUP_WARNING.SUMMARY"),icon:"fa fa-question-circle fwcBlue iconBig",message:this.translate.instant("ITEM_PANEL.ERRORS.DUP_WARNING.TEXT",{objects:i}),rejectVisible:!0,rejectLabel:"No",acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.YES"),accept:()=>{this.onSave(1)}})}static{this.\u0275fac=function(i){return new(i||r)(A(Ge),A(Le),A(Sn),A(ae),A(Ye),A(fe),A(Nt),A(wn),A(Xo),A(Et),A(mn),A(pe),A(Cn),A(li),A(Oe),A(me),A(he),A(de),A(Se),A(le),A($i),A(Wt),A(_e),A(Dt))}}static{this.\u0275cmp=De({type:r,selectors:[["sts-fwc-item-panel"]],viewQuery:function(i,t){if(i&1&&(ge(rd,5),ge(ld,5)),i&2){let n;se(n=ce())&&(t.tbvItemTabview=n.first),se(n=ce())&&(t.inputObjName=n.first)}},features:[Ze([Sn,ae,Ye,wn,mn]),Lt],decls:6,vars:6,consts:[["dlgItemPanel",""],["tbvItemTabview",""],["inputObjName",""],[3,"visibleChange","onShow","onHide","styleClass","visible","modal","closable"],["pTemplate","header"],["styleClass","objectInfoTab",3,"activeIndex"],["pTemplate","footer"],[1,"divFormHeader"],[1,"divHeaderButtons"],["pButton","","type","button","icon","fa fa-question",1,"p-button-primary",3,"disabled"],["pButton","","type","button","icon","fa fa-window-minimize",1,"p-button-secondary",3,"click"],[1,"fwcWhite","fwcIconLeft"],[1,"fwcMenuIcon","fwci-edit","fwcOrange"],[1,"fwcSep"],["aria-hidden","true"],[1,"fwcMenuIcon","fwci-new","fwcOrange"],[1,"fwcMenuIcon","fwci-delete","fwcOrange"],["pButton","","type","button","icon","fa fa-question",1,"p-button-primary",3,"click","disabled"],["styleClass","objectInfoTab",3,"onChange","activeIndex"],["leftIcon","fa fa-pencil",3,"header","disabled"],[1,"fwcObjectPanel"],[3,"formGroup"],[3,"keyup.enter","keyup.esc","disabled"],[1,"grid"],[3,"ngClass"],[1,"col-6"],[1,"col-4"],[1,"col-12"],[1,"col-3"],["leftIcon","fa fa-info-circle",3,"header","disabled"],["id","infoPanel"],[1,"col-12","grid","grid-nogutter"],[1,"p-inputgroup"],[1,"p-float-label"],["pInputText","","type","text","formControlName","name","name","name","maxlength","64",3,"drop"],["for","name"],[1,"fwc-error",2,"margin-bottom","1.2em",3,"ngStyle"],["pInputText","","type","text","maxlength","45","formControlName","address","name","address",3,"drop","blur"],["for","address"],[1,"fwc-error"],["pInputText","","type","text","maxlength","15","formControlName","netmask","name","netmask",3,"drop","blur"],["for","netmask"],["pInputText","","type","text","maxlength","45","formControlName","range_start","name","range_start",3,"drop","blur"],["for","range_start"],["pInputText","","type","text","maxlength","45","formControlName","range_end","name","range_end",3,"drop","blur"],["for","range_end"],["formControlName","ip_version","name","ip_version",1,"fwcSelect",3,"change"],[3,"ngValue"],["for","ip_version"],[3,"groupId","readOnly","groupType","groupTreeId","ipobjs"],[1,"fwcFloatLabel"],[1,"fwc-error",3,"ngStyle"],["pInputText","","type","number","formControlName","protocol","name","protocol","min","0","max","255",3,"drop","click"],["for","protocol"],["styleClass","fieldsetFixed",3,"legend"],["pInputText","","type","number","formControlName","source_port_start","name","source_port_start","min","0","max","65535",3,"drop","click"],["for","source_port_start"],["pInputText","","type","number","formControlName","source_port_end","name","source_port_end","min","0","max","65535",3,"drop","click"],["for","source_port_end"],["pInputText","","type","number","formControlName","destination_port_start","name","destination_port_start","min","0","max","65535",3,"drop","click"],["for","destination_port_start"],["pInputText","","type","number","formControlName","destination_port_end","name","destination_port_end","min","0","max","65535",3,"drop","click"],["for","destination_port_end"],["type","hidden","formControlName","tcp_flags_mask","name","tcp_flags_mask"],["type","hidden","formControlName","tcp_flags_settings","name","tcp_flags_settings"],[1,"unstriped","fwcFlagsTable"],[3,"ngModelChange","onChange","binary","ngModel","ngModelOptions","disabled"],[3,"ngModelChange","onChange","binary","ngModel","ngModelOptions","ngStyle","disabled"],["formControlName","icmp_type","name","icmp_type",1,"fwcSelect"],["for","icmp_type"],["formControlName","icmp_code","name","icmp_code",1,"fwcSelect"],["for","icmp_code"],["pInputText","","type","text","maxlength","64","formControlName","labelName","name","labelName",3,"drop"],["for","labelName"],["pInputText","","type","text","maxlength","17","formControlName","mac","name","mac",3,"drop"],["for","mac"],["pInputText","","type","number","formControlName","code","name","code",3,"drop"],["for","code"],[1,"col-12","md:col-4"],[1,"noVertPad","fwcBlue","botBorder"],[1,"col-12","md:col-8"],["styleClass","tbvRuleHooks"],["leftIcon","fa fa-fw fa-upload",3,"header"],["pInputTextarea","","formControlName","run_before",2,"margin-top","0 !important",3,"placeholder"],[1,"fwc-right"],["type","button","pButton","","icon","fa fa-trash",1,"p-button-danger",3,"click","disabled","label"],["leftIcon","fa fa-fw fa-download",3,"header"],["pInputTextarea","","formControlName","run_after",2,"margin-top","0 !important",3,"placeholder"],[3,"ngModelChange","onChange","binary","disabled","ngModel","ngModelOptions","label"],["pInputTextarea","","formControlName","comment","name","comment","maxlength","255",3,"drop"],["for","comment"],[3,"message"],[2,"width","100%"],[3,"onHideParent","objectInfo"],[1,"col-12","divCentered"],[1,"fwcRestrictionsContainer"],[3,"onHideParent","onRefreshRestrictions","dependencies"],["pButton","","icon","pi pi-times",1,"p-button-primary",3,"disabled","label"],["pButton","","icon","pi pi-times",1,"p-button-primary",3,"label"],[1,"divLoadTemp",3,"ngStyle"],["pButton","","icon","pi pi-times",1,"p-button-danger",3,"label","disabled"],["pButton","","icon","fa fa-save",1,"p-button-success",3,"label","disabled"],["pButton","","icon","pi pi-times",1,"p-button-danger",3,"click","label","disabled"],["pButton","","icon","fa fa-save",1,"p-button-success",3,"click","label","disabled"],["pButton","","icon","pi pi-times",1,"p-button-primary",3,"click","label"],["type","button","pButton","","icon","fa fa-refresh",1,"fwc-left-float","p-button-primary",3,"disabled","label"],["type","button","pButton","","icon","pi pi-check",1,"p-button-primary",3,"click","label"],["type","button","pButton","","icon","fa fa-refresh",1,"fwc-left-float","p-button-primary",3,"click","disabled","label"],["pButton","","icon","pi pi-times",1,"p-button-primary",3,"click","disabled","label"]],template:function(i,t){if(i&1){let n=L();c(0,"p-dialog",3,0),Y("visibleChange",function(l){return h(n),H(t.displayDialog,l)||(t.displayDialog=l),w(l)}),P("onShow",function(){return h(n),w(t.onDialogShow())})("onHide",function(){return h(n),w(t.onDialogHide())}),F(2,vd,5,3,"ng-template",4)(3,u_,35,34,"p-tabView",5)(4,S_,3,2)(5,O_,3,3,"ng-template",6),_()}i&2&&(m("styleClass",(t.object==null?null:t.object.type)!=t.ObjectTypes.OBJ_GROUP&&(t.object==null?null:t.object.type)!=t.ObjectTypes.OBJ_SERVICE_GROUP?"dlgFwcDialog fwcObjectDialog":"dlgFwcDialog fwcObjectDialog fwcObjectDialog--small"),W("visible",t.displayDialog),m("modal",!1)("closable",!1),a(3),O(t.object?3:-1),a(),O(t.objectToDelete?4:-1))},dependencies:[tt,qt,Pi,xi,Fi,$t,Zt,Ri,gt,bi,ei,Ai,No,Ct,Lo,Ti,Oi,_r,Hi,kt,Cr,Ut,Be,lt,Gt,oi,ji,Wi,Vi,ir,It,In,ot],styles:[`:root{--lightColor: #eee;--darkColor: #222;--inputBackgroundColor: #eee;--inputBorderColor: #cacaca;--inputColor: #222;--surfaceBackgroundColor: white;--fixedWhiteColor: #eee;--fixedDarkColor: #333;--translucidColor: transparent;--menuBackground: url(/assets/img/fwc-fondo-menu.jpg);--mainBackground: url(/assets/img/fwc-fondo-home.jpg);--fwcBlue: #0069a7;--fwcBlueDarkened: #005e96;--fwcDarkBlue: #003351;--fwcDarkBlue2: #014071;--fwcLightBlue: #1779ba;--fwcPaleBlue: #689fe1;--fwcPaleBlue2: #cce2f8;--fwcPaleBlue3: #e6f1fd;--fwcBlueGradient1: #386ea0;--fwcBlueGradient2: #21517e;--fwcLightGreyGradient1: #f6f7f9;--fwcLightGreyGradient2: #ebedf0;--fwcOrange: #eb6400;--fwcPaleOrange: #e67e22;--fwcPaleOrange2: #ffcfa4;--fwcPaleOrange3: #fe7815;--fwcOrangeRed: #e74c3c;--fwcRed: #f00;--fwcRed2: #b40b00;--fwcPaleRed: #f77676;--fwcPaleRed2: #ffe1e1;--fwcTranslucidRed: rgba(255, 0, 0, .15);--fwcDarkGreen: #023008;--fwcGreen: #009900;--fwcLightGreen: #28ff28;--fwcPaleGreen: #c7e6c8;--fwcLime: #baf649;--fwcWhite: #eee;--fwcPaleWhite: #f5f5f5;--fwcPaleWhite2: #f4f4f4;--fwcDark: #222;--fwcLightDark: #1e1e1e;--fwcMidDark: #555;--fwcMidDark2: #333;--fwcPaleDark: #888;--fwcPaleDark2: #383838;--fwcGrey: #cacaca;--fwcGrey2: #cecece;--fwcGrey3: #eee;--fwcGrey4: #e5e5e5;--fwcGrey5: #c8c8c8;--fwcGrey6: #efefef;--fwcGrey7: #dedede;--fwcAccent: #ff4081;--fwcShadow: #bbb;--fwcSelected: #ddd;--fwcSelectedB: #0069a7;--fwcRulePink: #ef9a9a;--fwcRulePurple: #ce93d8;--fwcRuleBlue: #90caf9;--fwcRuleTeal: #80cbc4;--fwcRuleGreen: #a5d6a7;--fwcRuleYellow: #fff59d;--fwcRuleOrange: #ffcc80}.modalMsg{text-align:center;border-bottom:1px solid}div.fwcItemData{padding-bottom:2rem}.fwcFlagsTable{font-size:.9em}.fwcFlagsTable th,.fwcFlagsTable td{padding:.2rem}.fieldsetFixed{height:10rem}.fieldsetFixed .p-fieldset-legend-text{font-family:Arial,Montserrat,sans-serif;color:var(--fwcPaleDark)}.tbvRuleHooks.p-tabview{padding:0}.tbvRuleHooks textarea{font-family:monospace!important;height:10rem!important}.p-float-label textarea.p-filled~label{top:0;margin-top:-2rem}.p-float-label textarea:focus~label{margin-top:-.5rem}
`],encapsulation:2,data:{animation:[vn]}})}}return r})();var x_=["fwcMessageComponent"];function F_(r,u){r&1&&(c(0,"div",4)(1,"h6",5),T(2,"i",6),g(3),C(4,"translate"),_()()),r&2&&(a(3),R(" ",y(4,1,"FW.MSG_FW_EDITION.PLUGINS")," "))}function A_(r,u){if(r&1){let e=L();c(0,"button",7),C(1,"translate"),P("click",function(){h(e);let t=d();return w(t.onCloseDialog())}),_()}if(r&2){let e=d();D("label",y(1,2,"GLOBALS.MSG_BUTTONS.CLOSE")),m("disabled",e.loadingData)}}var L_=3e5,dt=new Map([["openvpn","OpenVPN"],["wireguard","WireGuard"],["ipsec","IPSec"],["geoip","GeoIP"],["crowdsec","Crowdsec"],["ntopng","NtopNG"],["suricata","Suricata"],["keepalived","Keepalived"],["zeek","Zeek"],["elasticsearch","Elasticsearch"],["filebeat","Filebeat"],["websafety","Web Safety"],["kibana","Kibana"],["logstash","Logstash"],["dnssafety","DNS Safety"],["isc-bind9","ISC Bind9"],["isc-dhcp","ISC DHCP"],["haproxy","HAProxy"]]),rl=(()=>{class r extends Bt{constructor(e,i,t,n,o,l,p,s,f,S,E,I,b,x,J,U){super(p,i,e,x,J,U),this.itemSelectedService=e,this.appOptionsService=i,this.fwcUserService=t,this.fwcFirewallService=n,this.fwcPolicyService=o,this.fwcErrorPipe=l,this.appDialogPanelsService=p,this.confirmationService=s,this.messageService=f,this.inputDataService=S,this.fwcEventService=E,this.utilService=I,this.translate=b,this.cd=x,this.store=J,this.router=U,this.displayDialog=!1,this.loadingData=!1,this.NodesError=[],this.error_plugin=!1,this.isDestroyed=!1,this.pluginEventEmitter=new Kt,this.createDialog(this.translate.instant("COMPILE.PANEL_TITLE"),"fwci-compileallfirewalls")}ngOnInit(){this.itemSelectedService.getFirewallToPluginOperation().subscribe(e=>{this.showPanelforFirewall(e)}),this.itemSelectedService.getClusterToPluginOperation().subscribe(e=>{this.showPanelforCluster(e)}),this.channel_id=bt()}startProcess(){this.loadingData=!0,this.log&&this.log.startDataLoad()}stopProcess(){this.loadingData=!1,clearTimeout(this.timeoutTimer),this.log&&this.log.stopDataLoad()}startTimeoutHandler(){this.timeoutTimer=setTimeout(()=>{this.timeout(),this.eventsSubscription.unsubscribe(),this.stopProcess()},L_)}refreshTimeoutHandler(){clearTimeout(this.timeoutTimer),this.startTimeoutHandler()}ngOnDestroy(){this.isDestroyed=!0,super.ngOnDestroy()}timeout(){this.addMessageToLog(this.translate.instant("COMPILE.WARN_TIMEOUT"),K.MSG_WARNING)}pingNodes(e){return te(this,null,function*(){let i=!1;for(let t=0;t<e.length;t++){if(this.isDestroyed)return i;let n=e[t];if(n.firewall.install_communication=="agent"){let o={communication:n.firewall.install_communication,host:n.address,port:n.firewall.install_port,protocol:n.firewall.install_protocol,apikey:n.firewall.install_apikey};n.firewall.name?this.addMessageToLog(this.translate.instant("CLUSTER.PLUGINS.PING",{node:n.firewall.name}),K.MSG_INFO):this.addMessageToLog(this.translate.instant("CLUSTER.PLUGINS.PING_NO_NAME"),K.MSG_INFO),yield this.utilService.fwcAPICall(this.fwcFirewallService.checkFwCommunication.bind(this.fwcFirewallService),this.fwcUserService.getActualFwSelectedCloud(),o).then(l=>{this.log.setDataLoad(!1),this.addMessageToLog(this.translate.instant("GLOBALS.MSG_OP_ASK.OK"),K.MSG_OK),this.addMessageToLog("",K.MSG_SEPARATOR)}).catch(l=>{if(this.log.setDataLoad(!1),l.error){let p;p=this.utilService.isCommunicationError(l.error),p?(this.addMessageToLog(this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:p}),K.MSG_ERROR),this.addMessageToLog("",K.MSG_SEPARATOR)):(this.addMessageToLog(this.translate.instant("CLUSTER.PLUGINS.ERROR_PING"),K.MSG_ERROR),this.addMessageToLog("",K.MSG_SEPARATOR))}i=!0})}else n.firewall.name?(this.addMessageToLog(this.translate.instant("CLUSTER.PLUGINS.PING",{node:n.firewall.name}),K.MSG_INFO),this.addMessageToLog(this.translate.instant("CLUSTER.PLUGINS.SSH_COMMUNICATION",{node:n.firewall.name}),K.MSG_WARNING),this.addMessageToLog("",K.MSG_SEPARATOR)):(this.addMessageToLog(this.translate.instant("CLUSTER.PLUGINS.PING_NO_NAME"),K.MSG_INFO),this.addMessageToLog(this.translate.instant("CLUSTER.PLUGINS.SSH_COMMUNICATION_NO_NAME"),K.MSG_WARNING),this.addMessageToLog("",K.MSG_SEPARATOR));this.log.setDataLoad(!1)}return i})}waitWSMessages(){return new Promise((i,t)=>{this.startTimeoutHandler(),this.options.channelId?(this.eventsSubscription=this.fwcEventService.getEvent().pipe(ee(()=>this.displayDialog)).subscribe(n=>{this.refreshTimeoutHandler();let o=new bn(n);if(o&&o.payload)if(o.payload.type)if(o.payload.type===K.MSG_END){i(o);return}else o.payload.type===K.MSG_ERROR?(this.operationResult={error:!0},this.NodesError.push(this.nodeName),this.statusMessage={type:"error",text:this.translate.instant("GLOBALS.MSG_OP_RESULT.PROCESS_ERROR")},o.payload.message.includes("socket")&&(this.log.addNewMessage(o),i(null))):this.options.showStatusMessage?this.fwcMessageComponent&&this.fwcMessageComponent.changeStatus(o.payload.message,this.translate.instant("ITEM_BATCH.TABLE_HEADER.1")+":"):this.log&&(o.payload.message==="ENABLED"?this.stopProcess():o.payload.message==="DISABLED"?this.stopProcess():o.payload.message==="NOT_SUPPORTED"?(this.operationResult={error:!0},this.stopProcess()):o.payload.message.toLowerCase().startsWith("error")?(this.log.addNewMessage(o),this.operationResult={error:!0},this.NodesError.push(this.nodeName)):this.log.addNewMessage(o));else this.addMessageToLog(this.translate.instant("API_ERROR.client-socket"),K.MSG_ERROR),this.operationResult={error:!0},this.NodesError.push(this.nodeName),this.stopProcess();else this.addMessageToLog(this.translate.instant("LOG_PANEL.MALFORMED_MSG"),K.MSG_ERROR),this.operationResult={error:!0},this.NodesError.push(this.nodeName),this.stopProcess()}),this.utilService.ioListenOnLogEvent(this.options.channelId)):i(null)})}doApiCall(){return new Promise((i,t)=>{this.options.apiCall?(Array.isArray(this.options.apiParams)||(this.options.apiParams=[]),this.options.showStatusMessage&&(this.statusMessage={type:"loading",text:this.translate.instant("GLOBALS.MSG_OP_RESULT.OPERATION_IN_PROGRESS")}),this.utilService.fwcAPICall(this.options.apiCall,...this.options.apiParams).then(n=>{i(n)}).catch(n=>{t(n)})):i({})})}showPanelforCluster(e){this.showDialog();let i;return new Promise(t=>te(this,null,function*(){if(this.isDestroyed)return t(this.error_plugin);let n=this.utilService.createDynamicComponentRef(nn),o=n.instance;o.setDynamicComponentRef(n),this.mainEventsSubscription=o.socketEventEmitter.subscribe(l=>te(this,null,function*(){if(l=="connected"){if(this.showDialog(),this.startProcess(),this.error_plugin=yield this.pingNodes(e.nodes),!this.error_plugin){e.enable?i=this.translate.instant("FW.PLUGINS.ENABLE_OK",{plugin:this.translate.instant("FW.PLUGINS."+e.plugin.toUpperCase())}):i=this.translate.instant("FW.PLUGINS.DISABLE_OK",{plugin:this.translate.instant("FW.PLUGINS."+e.plugin.toUpperCase())}),e.nodes=e.nodes.filter(p=>p.firewall.install_communication=="agent");for(let p of e.nodes){this.channel_id=bt(),this.startProcess(),this.nodeName=p.firewall.name,e.enable?p.firewall.name?e.cluster.name?(this.addMessageToLog("",K.MSG_SEPARATOR),this.addMessageToLog(this.translate.instant("CLUSTER.PLUGINS.ENABLE_START_CLUSTER_NAME",{plugin:dt.get(e.plugin),firewall:p.firewall.name,cluster:e.cluster.name}),K.MSG_INFO)):(this.addMessageToLog("",K.MSG_SEPARATOR),this.addMessageToLog(this.translate.instant("CLUSTER.PLUGINS.ENABLE_START",{plugin:dt.get(e.plugin),firewall:p.firewall.name}),K.MSG_INFO)):(this.addMessageToLog("",K.MSG_SEPARATOR),this.addMessageToLog(this.translate.instant("CLUSTER.PLUGINS.ENABLE_START_NO_NAME",{plugin:dt.get(e.plugin)}),K.MSG_INFO)):this.nodeName?e.cluster.name?(this.addMessageToLog("",K.MSG_SEPARATOR),this.addMessageToLog(this.translate.instant("CLUSTER.PLUGINS.DISABLE_START_CLUSTER_NAME",{plugin:dt.get(e.plugin),firewall:p.firewall.name,cluster:e.cluster.name}),K.MSG_INFO)):(this.addMessageToLog("",K.MSG_SEPARATOR),this.addMessageToLog(this.translate.instant("CLUSTER.PLUGINS.DISABLE_START",{plugin:dt.get(e.plugin),firewall:p.firewall.name}),K.MSG_INFO)):(this.addMessageToLog("",K.MSG_SEPARATOR),this.addMessageToLog(this.translate.instant("CLUSTER.PLUGINS.DISABLE_START_NO_NAME",{plugin:dt.get(e.plugin)}),K.MSG_INFO));let s={channelId:this.channel_id,textHeader:"",apiCall:this.fwcFirewallService.installPlugins.bind(this.fwcFirewallService),apiParams:[this.fwcUserService.getActualFwSelectedCloud(),{protocol:p.firewall.install_protocol,plugin:e.plugin,enable:e.enable,host:p.address,port:p.firewall.install_port,apikey:p.firewall.install_apikey,communication:p.firewall.install_communication},this.channel_id],textMessage:"",showStatusMessage:null};this.options=s;let f=Qi(this.waitWSMessages(),this.doApiCall());yield Kn(f).then(S=>{this.stopProcess()}).catch(S=>{this.error_plugin=!0,this.NodesError.filter(E=>E==this.nodeName)||this.NodesError.push(this.nodeName),this.stopProcess()}),this.eventsSubscription.unsubscribe()}this.log.setDataLoad(!1)}if(this.error_plugin)this.addMessageToLog(this.translate.instant("CLUSTER.PLUGINS.ERROR"),K.MSG_ERROR),this.addMessageToLog("",K.MSG_SEPARATOR);else if(this.operationResult){e.enable?(this.addMessageToLog("",K.MSG_SEPARATOR),this.addMessageToLog(this.translate.instant("FW.PLUGINS.ENABLE_ERROR"),K.MSG_ERROR)):(this.addMessageToLog("",K.MSG_SEPARATOR),this.addMessageToLog(this.translate.instant("FW.PLUGINS.DISABLE_ERROR"),K.MSG_ERROR)),this.addMessageToLog("",K.MSG_SEPARATOR),this.addMessageToLog(this.translate.instant("FW.PLUGINS.NODES_ERROR"),K.MSG_ERROR),this.NodesError=[...new Set(this.NodesError)];for(let p=0;p<this.NodesError.length;p++)this.addMessageToLog(this.NodesError[p],K.MSG_ERROR);this.error_plugin=!0}else e.enable?(this.addMessageToLog("",K.MSG_SEPARATOR),this.addMessageToLog(this.translate.instant("FW.PLUGINS.ENABLE_OK",{plugin:dt.get(e.plugin)}),K.MSG_OK)):(this.addMessageToLog("",K.MSG_SEPARATOR),this.addMessageToLog(this.translate.instant("FW.PLUGINS.DISABLE_OK",{plugin:dt.get(e.plugin)}),K.MSG_OK)),this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("FW.MSG_FW_EDITION.PLUGINS"),detail:i})}this.mainEventsSubscription.unsubscribe(),t(this.error_plugin)})),o.checkConnection(),this.loadingData=!1,this.stopProcess()}))}showPanelforFirewall(e){this.showDialog();let i;return new Promise(t=>te(this,null,function*(){if(this.isDestroyed)return t(this.error_plugin);let n=this.utilService.createDynamicComponentRef(nn),o=n.instance;o.setDynamicComponentRef(n),this.mainEventsSubscription=o.socketEventEmitter.subscribe(l=>te(this,null,function*(){if(l=="connected"){this.showDialog(),e.enable?i=this.translate.instant("FW.PLUGINS.ENABLE_OK",{plugin:this.translate.instant("FW.PLUGINS."+e.plugin.toUpperCase())}):i=this.translate.instant("FW.PLUGINS.DISABLE_OK",{plugin:this.translate.instant("FW.PLUGINS."+e.plugin.toUpperCase())}),e.enable?e.firewall.name?this.addMessageToLog(this.translate.instant("FW.PLUGINS.ENABLE_START",{plugin:dt.get(e.plugin),firewall:e.firewall.name}),K.MSG_INFO):this.addMessageToLog(this.translate.instant("FW.PLUGINS.ENABLE_START_NO_NAME",{plugin:dt.get(e.plugin)}),K.MSG_INFO):e.firewall.name?this.addMessageToLog(this.translate.instant("FW.PLUGINS.DISABLE_START",{plugin:dt.get(e.plugin),firewall:e.firewall.name}),K.MSG_INFO):this.addMessageToLog(this.translate.instant("FW.PLUGINS.DISABLE_START_NO_NAME",{plugin:dt.get(e.plugin)}),K.MSG_INFO),this.channel_id=bt();let p={channelId:this.channel_id,textHeader:"",apiCall:this.fwcFirewallService.installPlugins.bind(this.fwcFirewallService),apiParams:[this.fwcUserService.getActualFwSelectedCloud(),{protocol:e.firewall.install_protocol,plugin:e.plugin,enable:e.enable,host:e.address,port:e.firewall.install_port,apikey:e.firewall.install_apikey,communication:e.firewall.install_communication},this.channel_id],textMessage:"",showStatusMessage:null};this.startProcess(),this.options=p;let s=Qi(this.waitWSMessages(),this.doApiCall());yield Kn(s).then(f=>{!e.persisted&&!this.operationResult&&this.utilService.fwcAPICall(this.fwcFirewallService.updateFirewall.bind(this.fwcFirewallService),e.firewall).catch(S=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(S)}),this.stopProcess(),this.hideDialog(),this.error_plugin=!0}),this.operationResult?(e.enable?this.addMessageToLog(this.translate.instant("FW.PLUGINS.ENABLE_ERROR"),K.MSG_ERROR):this.addMessageToLog(this.translate.instant("FW.PLUGINS.DISABLE_ERROR"),K.MSG_ERROR),this.error_plugin=!0):(e.enable?this.addMessageToLog(this.translate.instant("FW.PLUGINS.ENABLE_OK",{plugin:dt.get(e.plugin)}),K.MSG_OK):this.addMessageToLog(this.translate.instant("FW.PLUGINS.DISABLE_OK",{plugin:dt.get(e.plugin)}),K.MSG_OK),this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("FW.MSG_FW_EDITION.PLUGINS"),detail:i}),this.error_plugin=!1),this.stopProcess()}).catch(f=>{let S=JSON.parse(f.error.msg);if(f.status===400&&S.message==="ECONNREFUSED: Port is not valid"){if(S!=""){this.addMessageToLog(this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:this.translate.instant("API_ERROR.ECONNREFUSED")}),K.MSG_ERROR),this.stopProcess(),this.error_plugin=!0;return}}else if(f.status===400||f.status===500){let E=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:this.translate.instant("GLOBALS.ERRORS.COMMUNICATION")});if(f.error){let I=this.utilService.isCommunicationError(f.error);if(I&&(E=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:I})),/ERR_BAD_REQUEST/.test(f.error.msg)){let b=JSON.parse(f.error.msg);this.addMessageToLog(this.translate.instant("FW.MSG_FW_EDITION.ERROR_BAD_REQUEST_AGENT",{errorMsg:b.message}),K.MSG_ERROR),this.stopProcess(),this.error_plugin=!0;return}}this.confirmationService.confirm({header:"Error",icon:"fa fa-exclamation-circle fwcRed iconBig",acceptLabel:"Ok",rejectVisible:!1,message:E})}else this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(f)});this.stopProcess(),this.error_plugin=!0}),this.eventsSubscription.unsubscribe()}this.mainEventsSubscription.unsubscribe(),t(this.error_plugin)})),o.checkConnection()}))}onCloseDialog(){this.fwcEventService.emitEvent({type:Gi.EVENT_PLUGIN_PANEL_CLOSED,data:this.error_plugin}),this.eventsSubscription&&this.eventsSubscription.unsubscribe(),this.log&&this.log.clearMessages(),this.operationResult=null,super.hideDialog()}static{this.\u0275fac=function(i){return new(i||r)(A(Ge),A(Et),A(pe),A(ae),A(fe),A(Se),A(Nt),A(Oe),A(me),A(vt),A(ii),A(he),A(de),A(le),A(_e),A(Dt))}}static{this.\u0275cmp=De({type:r,selectors:[["sts-fwc-firewall-plugin-panel"]],viewQuery:function(i,t){if(i&1&&(ge(ai,5),ge(x_,5)),i&2){let n;se(n=ce())&&(t.log=n.first),se(n=ce())&&(t.fwcMessageComponent=n.first)}},outputs:{pluginEventEmitter:"pluginEventEmitter"},features:[Ze([ae]),Lt],decls:5,vars:4,consts:[["pluginLog",""],["styleClass","dlgFwcDialog dlgDwcDialog--medium",3,"visibleChange","visible","modal","resizable","closable"],["pTemplate","header"],["pTemplate","footer"],[1,"divFormHeader"],[1,"fwcWhite","fwcIconLeft"],[1,"fwcMenuIcon","fwci-firewalls","fwcOrange"],["type","button","pButton","","icon","pi pi-check",1,"p-button-primary",3,"click","disabled","label"]],template:function(i,t){if(i&1){let n=L();c(0,"p-dialog",1),Y("visibleChange",function(l){return h(n),H(t.displayDialog,l)||(t.displayDialog=l),w(l)}),F(1,F_,5,3,"ng-template",2),T(2,"sts-fwc-log",null,0),F(4,A_,2,4,"ng-template",3),_()}i&2&&(W("visible",t.displayDialog),m("modal",!0)("resizable",!0)("closable",!1))},dependencies:[ai,Ut,Be,lt,ot],encapsulation:2})}}return r})();var D_=["splitter"],N_=["dlgCompile"],G_=["gridContainerDiv"],U_=()=>({height:"100rvm",width:"100%","padding-bottom":"6.5rem"}),B_=()=>[15,85],k_=()=>[15,15],j_=()=>({height:"98%",width:"100%"}),V_=()=>({width:"100%"}),W_=(r,u)=>({copyRules:r,cutRules:u}),H_=r=>({"divClipContainer--above":r}),Y_=(r,u)=>({copyObjects:r,cutObjects:u});function J_(r,u){if(r&1){let e=L();c(0,"div",null,2)(2,"div",18)(3,"div",19)(4,"input",20,3),P("keyup",function(t){h(e);let n=d(2);return w(n.onSearchType(t.target.value))}),_(),c(6,"button",21),P("click",function(){h(e);let t=we(5);return d(2).onSearchType(""),w(t.value="")}),_(),c(7,"button",22),P("click",function(t){h(e),d(2);let n=we(5);return w(n.toggle(t))}),_()()(),c(8,"div",23)(9,"div",24),C(10,"translate"),T(11,"sts-fwc-tree",25),_(),c(12,"div",26),C(13,"translate"),T(14,"sts-fwc-tree",25),_(),c(15,"div",26),C(16,"translate"),T(17,"sts-fwc-tree",25),_()()()}if(r&2){let e=we(5),i=d(2);Ve(B(21,j_)),a(4),m("placeholder",i.searchPlaceholderText),a(2),m("disabled",!e.value.length),a(3),D("header",y(10,15,"POLICY.MSG_POLICY_TREES.TREE_FW")),a(2),m("treeOptions",i.optionsTreeFw)("treeSearchOptions",i.treeSearchOptions),a(),D("header",y(13,17,"POLICY.MSG_POLICY_TREES.TREE_OBJ")),m("expanded",!1),a(2),m("treeOptions",i.optionsTreeObj)("treeSearchOptions",i.treeSearchOptions),a(),D("header",y(16,19,"POLICY.MSG_POLICY_TREES.TREE_SER")),m("expanded",!1),a(2),m("treeOptions",i.optionsTreeSrv)("treeSearchOptions",i.treeSearchOptions)}}function K_(r,u){r&1&&(c(0,"div",27,4),T(2,"sts-fwc-policy-grid"),_()),r&2&&Ve(B(2,V_))}function X_(r,u){if(r&1){let e=L();c(0,"div",6)(1,"p-splitter",16,1),P("onResizeEnd",function(t){h(e);let n=d();return w(n.onResizeEnd(t))}),F(3,J_,18,22,"ng-template",17)(4,K_,3,3,"ng-template",17),_()()}r&2&&(a(),Ve(B(4,U_)),m("panelSizes",B(5,B_))("minSizes",B(6,k_)))}function z_(r,u){if(r&1){let e=L();c(0,"div",7)(1,"div",28),T(2,"i",29),c(3,"div",30)(4,"span"),g(5),C(6,"translate"),_(),T(7,"p",31),_(),c(8,"div",32)(9,"button",33),P("click",function(){h(e);let t=d();return w(t.emptyRuleClipboard())}),_()()()()}if(r&2){let e=d();m("@fundidoInOut",void 0),a(),m("ngClass",et(6,W_,(e.clipboardRules==null?null:e.clipboardRules.action)==e.ClipboardAction.COPY,(e.clipboardRules==null?null:e.clipboardRules.action)==e.ClipboardAction.CUT)),a(4),R(" ",y(6,4,"POLICY.RULE_CLIPBOARD"),""),a(2),m("innerHTML",e.clipboardRulesTooltip,cn)}}function q_(r,u){if(r&1){let e=L();c(0,"div",8)(1,"div",28),T(2,"i",34),c(3,"div",30)(4,"span"),g(5),C(6,"translate"),_(),T(7,"p",31),_(),c(8,"div",32)(9,"button",33),P("click",function(){h(e);let t=d();return w(t.emptyObjectClipboard())}),_()()()()}if(r&2){let e=d();m("@fundidoInOut",void 0)("ngClass",Ie(7,H_,e.clipboardRules)),a(),m("ngClass",et(9,Y_,(e.clipboardObjects==null?null:e.clipboardObjects.action)==e.ClipboardAction.COPY,(e.clipboardObjects==null?null:e.clipboardObjects.action)==e.ClipboardAction.CUT)),a(4),R(" ",y(6,5,"POLICY.OBJECT_CLIPBOARD"),""),a(2),m("innerHTML",e.clipboardObjectsTooltip,cn)}}function Q_(r,u){if(r&1){let e=L();c(0,"div",11)(1,"p-checkbox",35),C(2,"translate"),C(3,"translate"),Y("ngModelChange",function(t){h(e);let n=d();return H(n.treeSearchOptions.searchFields,t)||(n.treeSearchOptions.searchFields=t),w(t)}),P("onChange",function(t){let n=h(e).$implicit,o=d();return w(o.handleSearchFilterChange(t,n))}),_()()}if(r&2){let e=u.$implicit,i=d();a(),D("label",y(2,3,"POLICY.TREE_SEARCH_OPTIONS.SEARCH_BY")+" "+y(3,5,e)),m("value",e),W("ngModel",i.treeSearchOptions.searchFields)}}var ll=(()=>{class r{constructor(e,i,t,n,o,l,p,s,f,S,E){this.appOptionsService=e,this.itemSelectedService=i,this.fwcUserService=t,this.ruleSelectedService=n,this.fwcPolicyService=o,this.fwcSseService=l,this.messageService=p,this.utilService=s,this.cd=f,this.store=S,this.translate=E,this.ClipboardAction=re,this.isSidebarVisible=!0,this.currentPanelSizes=[15,85],this.previousPanelSizes=[15,85],this.draggingSplitter=!1,this.fwcStaticMessages=[],this.showObjectPanel=!1,this.searchUpdated=new gi,this.searchChangeEmitter=new Kt,this.alive=!0,this.tabsExpanded=[!0,!0,!0],this.searchOptionsItems=[],this.searchFiltersOptions=[on.OBJECT_NAME,on.TCP_UDP_PORT,on.IP_ADDRESS,on.IP_OPENVPN],this.optionsTreeFw=e.optionsTreeFw,this.optionsTreeObj=e.optionsTreeObj,this.optionsTreeSrv=e.optionsTreeSrv,this.searchChangeEmitter=this.searchUpdated.asObservable().pipe(Ci(300),go(),ee(()=>this.alive)).subscribe(I=>{this.searchString=I,this.treeSearchOptions=ho(Si({},this.treeSearchOptions),{keyword:I})}),this.treeSearchOptions={keyword:"",searchFields:this.searchFiltersOptions.slice()},this.searchPlaceholderText=this.translate.instant("POLICY.MSG_POLICY_SEARCH.SEARCH")}ngOnDestroy(){this.alive=!1}ngOnInit(){this.menuClipboardItems=[{label:this.translate.instant("POLICY.RULE_CLIPBOARD_EMPTY"),icon:"fa fa-clipboard fwcBlue",command:()=>{}}],this.store.dispatch(Jo.loadPolicyTypes()),this.ruleSelectedService.getClipboardRules().pipe(ee(()=>this.alive)).subscribe(e=>{if(this.clipboardRules=e,this.clipboardRulesTooltip="",e&&e.rules){let i=[];if(e.rules.forEach(t=>{i.push(t.id)}),e.action==re.COPY){let t=i.length===1?"POLICY.RULE_CLIPBOARD_COPY":"POLICY.RULE_CLIPBOARD_COPY_ARRAY";this.clipboardRulesTooltip=this.translate.instant(t,i.length===1?{rule:i[0]}:{n:i.length})}if(e.action==re.CUT){let t=i.length===1?"POLICY.RULE_CLIPBOARD_CUT":"POLICY.RULE_CLIPBOARD_CUT_ARRAY";this.clipboardRulesTooltip=this.translate.instant(t,i.length===1?{rule:i[0]}:{n:i.length})}}}),this.itemSelectedService.getClipboardItem().pipe(ee(()=>this.alive)).subscribe(e=>{this.clipboardObjects=e,this.clipboardObjectsTooltip="",e&&(e.action==re.COPY&&(this.clipboardObjectsTooltip=this.translate.instant("POLICY.OBJECT_CLIPBOARD_COPY",{name:e._fwcObjName})),e.action==re.CUT&&(this.clipboardObjectsTooltip=this.translate.instant("POLICY.OBJECT_CLIPBOARD_CUT",{name:e._fwcObjName})))}),this.fwcUserService.getFwcUser().pipe(ee(()=>this.alive)).subscribe(e=>{(!this.fwcUser||this.fwcUser&&(e.user_id!=this.fwcUser.user_id||e.selectedFwCloud!=this.fwcUser.selectedFwCloud))&&this.loadSelectedFWCloud(e),this.fwcUser=Object.assign({},e),this.showObjectPanel=!1}),this.fwcUserService.reloadSelectedFWCloud().pipe(ee(()=>this.alive)).subscribe(()=>{this.loadSelectedFWCloud(this.fwcUser)}),this.utilService.getGridScrollToTop().pipe(ee(()=>this.alive)).subscribe(()=>{this.gridContainerDiv&&(this.gridContainerDiv.nativeElement.scrollTop=0)})}ngAfterViewInit(){this.itemSelectedService.setFwcTreeComponents(this.fwcTreeComponents.toArray());let i=this.splitter.containerViewChild.nativeElement.querySelector(".p-splitter-gutter");i&&(i.addEventListener("mousedown",()=>this.onDragStart()),i.addEventListener("mouseup",()=>this.onDragEnd()),i.addEventListener("click",()=>this.onGutterClick()))}onDragStart(){this.draggingSplitter=!0}onDragEnd(){setTimeout(()=>this.draggingSplitter=!1,100)}onGutterClick(){this.draggingSplitter||this.toggleSidebar()}toggleSidebar(){this.isSidebarVisible?(this.previousPanelSizes=this.splitter.panelSizes,this.splitter.panelSizes=[.001,99.999]):this.splitter.panelSizes=this.previousPanelSizes,this.isSidebarVisible=!this.isSidebarVisible}onResizeEnd(e){this.isSidebarVisible&&(this.currentPanelSizes=e.sizes,this.ensurePanelSizesWithinLimits())}ensurePanelSizesWithinLimits(){this.currentPanelSizes[0]<10?(this.currentPanelSizes[0]=15,this.currentPanelSizes[1]=85):this.currentPanelSizes[0]>90&&(this.currentPanelSizes[0]=85,this.currentPanelSizes[1]=15),this.splitter.panelSizes=this.currentPanelSizes}loadSelectedFWCloud(e){this.loadFwcObjectTree(e.user_id,e.selectedLanguage,e.selectedFwCloud,1,1);let i={_fwcFwId:null};this.fwcPolicyService.setSelectedPolicy(i)}onSearchType(e){this.searchUpdated.next(e)}handleSearchFilterChange(e,i){!e&&!this.treeSearchOptions.searchFields.length?this.treeSearchOptions.searchFields=[i]:this.treeSearchOptions=Si({},this.treeSearchOptions)}loadFwcObjectTree(e,i,t,n,o){let l,p,s;l=Object.assign({},this.optionsTreeFw),p=Object.assign({},this.optionsTreeObj),s=Object.assign({},this.optionsTreeSrv),l.user_id=p.user_id=s.user_id=e,l.fwcloud=p.fwcloud=s.fwcloud=t,l.objStandard=p.objStandard=s.objStandard=n,l.objCloud=p.objCloud=s.objCloud=o,this.optionsTreeFw=Object.assign({},l),this.optionsTreeObj=Object.assign({},p),this.optionsTreeSrv=Object.assign({},s)}emptyRuleClipboard(){this.ruleSelectedService.clearClipboardRules()}emptyObjectClipboard(){this.itemSelectedService.clearClipboardItem()}doSearchTCPUDPPorts(){console.log("Search by ports",this.tcpUdpPortSearchString)}static{this.\u0275fac=function(i){return new(i||r)(A(Et),A(Ge),A(pe),A(Le),A(fe),A(xr),A(me),A(he),A(le),A(_e),A(de))}}static{this.\u0275cmp=De({type:r,selectors:[["sts-fwc-policy-main"]],viewQuery:function(i,t){if(i&1&&(ge(D_,5),ge(N_,5),ge(G_,5),ge(Fn,5)),i&2){let n;se(n=ce())&&(t.splitter=n.first),se(n=ce())&&(t.dlgCompile=n.first),se(n=ce())&&(t.gridContainerDiv=n.first),se(n=ce())&&(t.fwcTreeComponents=n)}},outputs:{searchChangeEmitter:"searchChangeEmitter"},features:[Ze([])],decls:27,vars:10,consts:[["pnlSearchFilters",""],["splitter",""],["fwcDivSidebar",""],["inputSearch",""],["gridContainerDiv",""],[1,"fwcDivBoxed","fwcMainContainer"],[1,"grid-nogutter","fwcDivBoxed"],[1,"divClipContainer"],[1,"divClipContainer",3,"ngClass"],["styleClass","ovpSearchFilters","appendTo","body"],[1,"grid","grid-nogutter"],[1,"col-12"],[1,"fwcBlue"],["tooltipStyleClass","ttLeft",1,"fa","fa-fw","fa-lg","fa-info-circle",3,"pTooltip","escape"],[1,"col-12","fwc-right"],["pButton","","icon","pi pi-check",1,"p-button-primary",3,"click"],[3,"onResizeEnd","panelSizes","minSizes"],["pTemplate",""],[1,"fwcDivPadded","fwcDivBoxed","fwcDivPaddedTB"],[1,"fwcInputGroup"],["type","text","pInputText","","maxlength","255","id","inputSearch","name","inputSearch",3,"keyup","placeholder"],["pButton","","type","button","icon","pi pi-times",1,"p-button-primary",3,"click","disabled"],["pButton","","type","button","icon","pi pi-filter",1,"p-button-primary",3,"click"],["sts-fwc-tree-accordion","",1,"responsive-accordion"],["sts-fwc-tree-panel","",3,"header"],[3,"treeOptions","treeSearchOptions"],["sts-fwc-tree-panel","",3,"header","expanded"],[1,"fwcPolicyMainContainer","fwcDivOverflow"],[1,"divClipButton",3,"ngClass"],[1,"fwci-rule"],[1,"divClipButton-msg"],[3,"innerHTML"],[1,"divClipButton-close"],["type","button","pButton","","icon","fa fa-trash",1,"p-button-warning",3,"click"],[1,"fwci-ipobjects"],["name","chkSearchFilters",3,"ngModelChange","onChange","label","value","ngModel"]],template:function(i,t){if(i&1){let n=L();c(0,"div",5),F(1,X_,5,7,"div",6),_(),F(2,z_,10,9,"div",7)(3,q_,10,12,"div",8),c(4,"p-overlayPanel",9,0)(6,"div",10)(7,"div",11)(8,"h6",12),g(9),C(10,"translate"),T(11,"i",13),C(12,"translate"),_()(),xe(13,Q_,4,7,"div",11,Re),c(15,"div",14)(16,"button",15),P("click",function(){h(n);let l=we(5);return w(l.hide())}),_()()()(),T(17,"sts-fwc-info-tooltip")(18,"sts-fwc-item-panel")(19,"sts-fwc-firewall-panel")(20,"sts-fwc-firewall-compile-panel")(21,"sts-fwc-cluster-panel")(22,"sts-fwc-ovconfig-panel")(23,"sts-fwc-wireguard-config-panel")(24,"sts-fwc-ipsec-config-panel")(25,"sts-fwc-vpn-status-panel")(26,"sts-fwc-firewall-plugin-panel")}i&2&&(a(),O(t.fwcUser!=null&&t.fwcUser!=null?1:-1),a(),O(t.clipboardRules?2:-1),a(),O(t.clipboardObjects?3:-1),a(6),R(" ",y(10,6,"POLICY.TREE_SEARCH_OPTIONS.HEADER")," "),a(2),D("pTooltip",y(12,8,"POLICY.TREE_SEARCH_OPTIONS.TOOLTIP")),m("escape",!1),a(2),Fe(t.searchFiltersOptions))},dependencies:[tt,gt,Ct,dr,Fn,Ir,yr,Er,vr,Be,lt,$o,ri,oi,It,Or,kn,Wr,Hr,Qr,il,ol,xn,rl,ot],styles:[`@charset "UTF-8";:root{--lightColor: #eee;--darkColor: #222;--inputBackgroundColor: #eee;--inputBorderColor: #cacaca;--inputColor: #222;--surfaceBackgroundColor: white;--fixedWhiteColor: #eee;--fixedDarkColor: #333;--translucidColor: transparent;--menuBackground: url(/assets/img/fwc-fondo-menu.jpg);--mainBackground: url(/assets/img/fwc-fondo-home.jpg);--fwcBlue: #0069a7;--fwcBlueDarkened: #005e96;--fwcDarkBlue: #003351;--fwcDarkBlue2: #014071;--fwcLightBlue: #1779ba;--fwcPaleBlue: #689fe1;--fwcPaleBlue2: #cce2f8;--fwcPaleBlue3: #e6f1fd;--fwcBlueGradient1: #386ea0;--fwcBlueGradient2: #21517e;--fwcLightGreyGradient1: #f6f7f9;--fwcLightGreyGradient2: #ebedf0;--fwcOrange: #eb6400;--fwcPaleOrange: #e67e22;--fwcPaleOrange2: #ffcfa4;--fwcPaleOrange3: #fe7815;--fwcOrangeRed: #e74c3c;--fwcRed: #f00;--fwcRed2: #b40b00;--fwcPaleRed: #f77676;--fwcPaleRed2: #ffe1e1;--fwcTranslucidRed: rgba(255, 0, 0, .15);--fwcDarkGreen: #023008;--fwcGreen: #009900;--fwcLightGreen: #28ff28;--fwcPaleGreen: #c7e6c8;--fwcLime: #baf649;--fwcWhite: #eee;--fwcPaleWhite: #f5f5f5;--fwcPaleWhite2: #f4f4f4;--fwcDark: #222;--fwcLightDark: #1e1e1e;--fwcMidDark: #555;--fwcMidDark2: #333;--fwcPaleDark: #888;--fwcPaleDark2: #383838;--fwcGrey: #cacaca;--fwcGrey2: #cecece;--fwcGrey3: #eee;--fwcGrey4: #e5e5e5;--fwcGrey5: #c8c8c8;--fwcGrey6: #efefef;--fwcGrey7: #dedede;--fwcAccent: #ff4081;--fwcShadow: #bbb;--fwcSelected: #ddd;--fwcSelectedB: #0069a7;--fwcRulePink: #ef9a9a;--fwcRulePurple: #ce93d8;--fwcRuleBlue: #90caf9;--fwcRuleTeal: #80cbc4;--fwcRuleGreen: #a5d6a7;--fwcRuleYellow: #fff59d;--fwcRuleOrange: #ffcc80}.fwcMainContainer{background:var(--surfaceBackgroundColor)!important;width:100%;height:100%;max-height:100vh}.fwcDivSidebar{padding:.5rem 1.5rem 0 .5rem!important}.fwcDivRuleClipboardNotify{position:fixed;bottom:2em;right:2em;width:3rem;height:3rem;border-radius:50%;box-shadow:2px 2px 10px var(--fwcPaleDark);color:var(--fwcDark)}.fwcDivRuleClipboardNotify.copyRules{background-color:var(--fwcPaleGreen)}.fwcDivRuleClipboardNotify.cutRules{background-color:var(--fwcPaleRed)}.fwcDivRuleClipboardNotify i{text-align:center;display:inherit;line-height:3rem}.divClipContainer{position:fixed;right:2em;bottom:2em;transition:all .25s ease-out}.divClipContainer.divClipContainer--above{bottom:7em}.divClipContainer .divClipButton{height:4em;width:4em;border-radius:2em;overflow:hidden;vertical-align:middle;box-shadow:2px 2px 12px var(--fwcPaleDark);transition:width .25s ease-out}.divClipContainer .divClipButton.copyRules{background-color:var(--fwcPaleGreen)}.divClipContainer .divClipButton.cutRules{background-color:var(--fwcPaleRed)}.divClipContainer .divClipButton.copyObjects{background-color:#b5deb7}.divClipContainer .divClipButton.copyObjects .truncated-text{display:inline-block;max-width:7.5rem;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;text-align:center;vertical-align:middle;margin-right:-7px;font-size:14.5px}.divClipContainer .divClipButton.cutObjects{background-color:#f65e5e}.divClipContainer .divClipButton:hover{width:32em}.divClipContainer .divClipButton i{display:inline-block;height:4em;width:4em;vertical-align:top;text-align:center;line-height:4em}.divClipContainer .divClipButton-msg{font-family:Montserrat,sans-serif;padding:.6em;display:inline-block;margin-right:.5em}.divClipContainer .divClipButton-msg span{font-size:1.1em;font-weight:700}.divClipContainer .divClipButton-msg p{color:var(--fwcPaleDark2)}.divClipContainer .divClipButton-close{display:inline-block;float:right;margin-right:1em;line-height:4em;vertical-align:middle;visibility:visible;text-align:center;border-radius:10px}.divClipContainer .divClipButton-close button{display:inline-block;vertical-align:middle;width:2rem;max-width:2.5rem;max-height:2rem!important}.divClipContainer .divClipButton-close span{margin-left:.1rem;margin-top:.3rem}.fwcInputGroup{position:relative;height:2.4375em}.fwcInputGroup input{width:100%;float:left;padding-right:2rem}.fwcInputGroup button{width:2rem;height:100%!important;border-radius:0!important;position:absolute;right:2rem}.fwcInputGroup button:last-child{right:0}textarea.textCompiledString{height:12rem;font-family:monospace,sans-serif,Courier!important}.ovpSearchFilters{max-width:20rem}.ttLeft{text-align:left}@media screen and (max-height: 767px){.responsive-accordion{height:calc(100% - 3em)}}@media screen and (min-height: 768px){.responsive-accordion{height:calc(100% - 2.8em)}}@media screen and (min-height: 1024px){.responsive-accordion{height:calc(100% - 2.5em)}}@media screen and (min-height: 1150px){.responsive-accordion{height:calc(100% - 2.3em)}}@media screen and (min-height: 1250px){.responsive-accordion{height:calc(100% - 2.1em)}}
`],encapsulation:2,data:{animation:[vn]}})}}return r})();var $_=[{path:"",component:ll},{path:"**",pathMatch:"full",redirectTo:""}],al=(()=>{class r{static{this.\u0275fac=function(i){return new(i||r)}}static{this.\u0275mod=At({type:r})}static{this.\u0275inj=Ft({imports:[Li.forChild($_),Li]})}}return r})();var sl=(()=>{class r{static \u0275fac=function(i){return new(i||r)};static \u0275mod=At({type:r});static \u0275inj=Ft({imports:[Ii]})}return r})();var cl=(()=>{class r{static \u0275fac=function(i){return new(i||r)};static \u0275mod=At({type:r});static \u0275inj=Ft({imports:[Ii,Li,Bi,yn,io,tr,er,Li,Bi,io]})}return r})();var eu=["*"],tu=(r,u,e,i,t,n)=>({"p-sidebar":!0,"p-sidebar-active":r,"p-sidebar-left":u,"p-sidebar-right":e,"p-sidebar-top":i,"p-sidebar-bottom":t,"p-sidebar-full":n}),iu=(r,u)=>({transform:r,transition:u}),nu=r=>({value:"visible",params:r});function ou(r,u){r&1&&mt(0)}function ru(r,u){if(r&1&&(ut(0),F(1,ou,1,0,"ng-container",5),ft()),r&2){let e=d(2);a(),m("ngTemplateOutlet",e.headlessTemplate)}}function lu(r,u){r&1&&mt(0)}function au(r,u){r&1&&T(0,"TimesIcon",13),r&2&&(m("styleClass","p-sidebar-close-icon"),ze("data-pc-section","closeicon"))}function su(r,u){}function cu(r,u){r&1&&F(0,su,0,0,"ng-template")}function pu(r,u){if(r&1&&(c(0,"span",14),F(1,cu,1,0,null,5),_()),r&2){let e=d(4);ze("data-pc-section","closeicon"),a(),m("ngTemplateOutlet",e.closeIconTemplate)}}function du(r,u){if(r&1){let e=L();c(0,"button",10),P("click",function(t){h(e);let n=d(3);return w(n.close(t))})("keydown.enter",function(t){h(e);let n=d(3);return w(n.close(t))}),F(1,au,1,2,"TimesIcon",11)(2,pu,2,2,"span",12),_()}if(r&2){let e=d(3);ze("aria-label",e.ariaCloseLabel)("data-pc-section","closebutton")("data-pc-group-section","iconcontainer"),a(),m("ngIf",!e.closeIconTemplate),a(),m("ngIf",e.closeIconTemplate)}}function _u(r,u){r&1&&mt(0)}function uu(r,u){r&1&&mt(0)}function fu(r,u){if(r&1&&(ut(0),c(1,"div",15),F(2,uu,1,0,"ng-container",5),_(),ft()),r&2){let e=d(3);a(),ze("data-pc-section","footer"),a(),m("ngTemplateOutlet",e.footerTemplate)}}function mu(r,u){if(r&1&&(c(0,"div",6),F(1,lu,1,0,"ng-container",5)(2,du,3,5,"button",7),_(),c(3,"div",8),en(4),F(5,_u,1,0,"ng-container",5),_(),F(6,fu,3,2,"ng-container",9)),r&2){let e=d(2);ze("data-pc-section","header"),a(),m("ngTemplateOutlet",e.headerTemplate),a(),m("ngIf",e.showCloseIcon),a(),ze("data-pc-section","content"),a(2),m("ngTemplateOutlet",e.contentTemplate),a(),m("ngIf",e.footerTemplate)}}function hu(r,u){if(r&1){let e=L();c(0,"div",3,0),P("@panelState.start",function(t){h(e);let n=d();return w(n.onAnimationStart(t))})("@panelState.done",function(t){h(e);let n=d();return w(n.onAnimationEnd(t))})("keydown",function(t){h(e);let n=d();return w(n.onKeyDown(t))}),F(2,ru,2,1,"ng-container",4)(3,mu,7,6,"ng-template",null,1,He),_()}if(r&2){let e=we(4),i=d();We(i.styleClass),m("ngClass",Po(9,tu,i.visible,i.position==="left"&&!i.fullScreen,i.position==="right"&&!i.fullScreen,i.position==="top"&&!i.fullScreen,i.position==="bottom"&&!i.fullScreen,i.fullScreen))("@panelState",Ie(19,nu,et(16,iu,i.transformOptions,i.transitionOptions)))("ngStyle",i.style),ze("data-pc-name","sidebar")("data-pc-section","root"),a(2),m("ngIf",i.headlessTemplate)("ngIfElse",e)}}var wu=Zn([Qn({transform:"{{transform}}",opacity:0}),qn("{{transition}}")]),Su=Zn([qn("{{transition}}",Qn({transform:"{{transform}}",opacity:0}))]),pl=(()=>{class r{document;el;renderer;cd;config;appendTo;blockScroll=!1;style;styleClass;ariaCloseLabel;autoZIndex=!0;baseZIndex=0;modal=!0;dismissible=!0;showCloseIcon=!0;closeOnEscape=!0;transitionOptions="150ms cubic-bezier(0, 0, 0.2, 1)";get visible(){return this._visible}set visible(e){this._visible=e}get position(){return this._position}set position(e){switch(this._position=e,e){case"left":this.transformOptions="translate3d(-100%, 0px, 0px)";break;case"right":this.transformOptions="translate3d(100%, 0px, 0px)";break;case"bottom":this.transformOptions="translate3d(0px, 100%, 0px)";break;case"top":this.transformOptions="translate3d(0px, -100%, 0px)";break}}get fullScreen(){return this._fullScreen}set fullScreen(e){this._fullScreen=e,e&&(this.transformOptions="none")}templates;onShow=new Kt;onHide=new Kt;visibleChange=new Kt;initialized;_visible;_position="left";_fullScreen=!1;container;transformOptions="translate3d(-100%, 0px, 0px)";mask;maskClickListener;documentEscapeListener;animationEndListener;contentTemplate;headerTemplate;footerTemplate;closeIconTemplate;headlessTemplate;constructor(e,i,t,n,o){this.document=e,this.el=i,this.renderer=t,this.cd=n,this.config=o}ngAfterViewInit(){this.initialized=!0}ngAfterContentInit(){this.templates?.forEach(e=>{switch(e.getType()){case"content":this.contentTemplate=e.template;break;case"header":this.headerTemplate=e.template;break;case"footer":this.footerTemplate=e.template;break;case"closeicon":this.closeIconTemplate=e.template;break;case"headless":this.headlessTemplate=e.template;break;default:this.contentTemplate=e.template;break}})}onKeyDown(e){e.code==="Escape"&&this.hide(!1)}show(){this.autoZIndex&&tn.set("modal",this.container,this.baseZIndex||this.config.zIndex.modal),this.modal&&this.enableModality(),this.onShow.emit({}),this.visibleChange.emit(!0)}hide(e=!0){e&&this.onHide.emit({}),this.modal&&this.disableModality()}close(e){this.hide(!1),this.visibleChange.emit(!1),e.preventDefault()}enableModality(){let e=this.document.querySelectorAll(".p-sidebar-active"),t=e.length==1?String(parseInt(this.container.style.zIndex)-1):String(parseInt(e[0].style.zIndex)-1);this.mask||(this.mask=this.renderer.createElement("div"),this.renderer.setStyle(this.mask,"zIndex",t),ki.addMultipleClasses(this.mask,"p-component-overlay p-sidebar-mask p-component-overlay p-component-overlay-enter"),this.dismissible&&(this.maskClickListener=this.renderer.listen(this.mask,"click",n=>{this.dismissible&&this.close(n)})),this.renderer.appendChild(this.document.body,this.mask),this.blockScroll&&ki.blockBodyScroll())}disableModality(){this.mask&&(ki.addClass(this.mask,"p-component-overlay-leave"),this.animationEndListener=this.renderer.listen(this.mask,"animationend",this.destroyModal.bind(this)))}destroyModal(){this.unbindMaskClickListener(),this.mask&&this.renderer.removeChild(this.document.body,this.mask),this.blockScroll&&ki.unblockBodyScroll(),this.unbindAnimationEndListener(),this.mask=null}onAnimationStart(e){switch(e.toState){case"visible":this.container=e.element,this.appendContainer(),this.show(),this.closeOnEscape&&this.bindDocumentEscapeListener();break}}onAnimationEnd(e){switch(e.toState){case"void":this.hide(!0),tn.clear(this.container),this.unbindGlobalListeners();break}}appendContainer(){this.appendTo&&(this.appendTo==="body"?this.renderer.appendChild(this.document.body,this.container):ki.appendChild(this.container,this.appendTo))}bindDocumentEscapeListener(){let e=this.el?this.el.nativeElement.ownerDocument:this.document;this.documentEscapeListener=this.renderer.listen(e,"keydown",i=>{i.which==27&&parseInt(this.container.style.zIndex)===tn.get(this.container)&&this.close(i)})}unbindDocumentEscapeListener(){this.documentEscapeListener&&(this.documentEscapeListener(),this.documentEscapeListener=null)}unbindMaskClickListener(){this.maskClickListener&&(this.maskClickListener(),this.maskClickListener=null)}unbindGlobalListeners(){this.unbindMaskClickListener(),this.unbindDocumentEscapeListener()}unbindAnimationEndListener(){this.animationEndListener&&this.mask&&(this.animationEndListener(),this.animationEndListener=null)}ngOnDestroy(){this.initialized=!1,this.visible&&this.modal&&this.destroyModal(),this.appendTo&&this.container&&this.renderer.appendChild(this.el.nativeElement,this.container),this.container&&this.autoZIndex&&tn.clear(this.container),this.container=null,this.unbindGlobalListeners(),this.unbindAnimationEndListener()}static \u0275fac=function(i){return new(i||r)(A(zn),A($i),A(Wt),A(le),A(zo))};static \u0275cmp=De({type:r,selectors:[["p-sidebar"]],contentQueries:function(i,t,n){if(i&1&&Ei(n,Be,4),i&2){let o;se(o=ce())&&(t.templates=o)}},hostAttrs:[1,"p-element"],inputs:{appendTo:"appendTo",blockScroll:[2,"blockScroll","blockScroll",fi],style:"style",styleClass:"styleClass",ariaCloseLabel:"ariaCloseLabel",autoZIndex:[2,"autoZIndex","autoZIndex",fi],baseZIndex:[2,"baseZIndex","baseZIndex",Oo],modal:[2,"modal","modal",fi],dismissible:[2,"dismissible","dismissible",fi],showCloseIcon:[2,"showCloseIcon","showCloseIcon",fi],closeOnEscape:[2,"closeOnEscape","closeOnEscape",fi],transitionOptions:"transitionOptions",visible:"visible",position:"position",fullScreen:"fullScreen"},outputs:{onShow:"onShow",onHide:"onHide",visibleChange:"visibleChange"},features:[pn],ngContentSelectors:eu,decls:1,vars:1,consts:[["container",""],["notHeadless",""],["role","complementary",3,"ngClass","ngStyle","class","keydown",4,"ngIf"],["role","complementary",3,"keydown","ngClass","ngStyle"],[4,"ngIf","ngIfElse"],[4,"ngTemplateOutlet"],[1,"p-sidebar-header"],["type","button","class","p-sidebar-close p-sidebar-icon p-link","pRipple","",3,"click","keydown.enter",4,"ngIf"],[1,"p-sidebar-content"],[4,"ngIf"],["type","button","pRipple","",1,"p-sidebar-close","p-sidebar-icon","p-link",3,"click","keydown.enter"],[3,"styleClass",4,"ngIf"],["class","p-sidebar-close-icon",4,"ngIf"],[3,"styleClass"],[1,"p-sidebar-close-icon"],[1,"p-sidebar-footer"]],template:function(i,t){i&1&&(Zi(),F(0,hu,5,21,"div",2)),i&2&&m("ngIf",t.visible)},dependencies:()=>[tt,_n,un,qt,qo,to],styles:[`@layer primeng{.p-sidebar{position:fixed;transition:transform .3s;display:flex;flex-direction:column}.p-sidebar-content{position:relative;overflow-y:auto;flex-grow:1}.p-sidebar-header{display:flex;align-items:center}.p-sidebar-footer{margin-top:auto}.p-sidebar-icon{display:flex;align-items:center;justify-content:center;margin-left:auto}.p-sidebar-left{top:0;left:0;width:20rem;height:100%}.p-sidebar-right{top:0;right:0;width:20rem;height:100%}.p-sidebar-top{top:0;left:0;width:100%;height:10rem}.p-sidebar-bottom{bottom:0;left:0;width:100%;height:10rem}.p-sidebar-full{width:100%;height:100%;top:0;left:0;-webkit-transition:none;transition:none}.p-sidebar-left.p-sidebar-sm,.p-sidebar-right.p-sidebar-sm{width:20rem}.p-sidebar-left.p-sidebar-md,.p-sidebar-right.p-sidebar-md{width:40rem}.p-sidebar-left.p-sidebar-lg,.p-sidebar-right.p-sidebar-lg{width:60rem}.p-sidebar-top.p-sidebar-sm,.p-sidebar-bottom.p-sidebar-sm{height:10rem}.p-sidebar-top.p-sidebar-md,.p-sidebar-bottom.p-sidebar-md{height:20rem}.p-sidebar-top.p-sidebar-lg,.p-sidebar-bottom.p-sidebar-lg{height:30rem}@media screen and (max-width: 64em){.p-sidebar-left.p-sidebar-lg,.p-sidebar-left.p-sidebar-md,.p-sidebar-right.p-sidebar-lg,.p-sidebar-right.p-sidebar-md{width:20rem}}}
`],encapsulation:2,data:{animation:[Ao("panelState",[$n("void => visible",[eo(wu)]),$n("visible => void",[eo(Su)])])]},changeDetection:0})}return r})(),dl=(()=>{class r{static \u0275fac=function(i){return new(i||r)};static \u0275mod=At({type:r});static \u0275inj=Ft({imports:[Ii,yn,Bi,to,Bi]})}return r})();var _l=(()=>{class r{transform(e,i,t){let n=[];if(t){let o=0,l=i+t;l>=e.length&&(l=e.length);for(let p=i;p<l;p++)n[o++]=e[p]}else n=e;return n}static{this.\u0275fac=function(i){return new(i||r)}}static{this.\u0275pipe=Co({name:"fwcGridPagination",type:r,pure:!0})}}return r})();var Cu,ny=(()=>{class r{constructor(e){this.injector=e,Cu=this.injector}static{this.\u0275fac=function(i){return new(i||r)(N(yo))}}static{this.\u0275mod=At({type:r})}static{this.\u0275inj=Ft({providers:[fn],imports:[Pr,al,Rr,Fr,cr,pr,Zo,Tr,sl,rr,cl,dl,Ho.forChild(),Ar.forFeature([Lr])]})}}return r})();bo(kn,function(){return[tt,Ro,_n,un,$t,Zt,gt,ei,Ct,kt,Be,lt,Qo,Gt,ri,lr,ar,nr,It,sr,or,pl]},function(){return[xo,In,ot,_l]});export{ny as FwcPolicyModule,Cu as PolicyInjector};
