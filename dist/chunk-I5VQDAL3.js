import{a as ht}from"./chunk-AATWQVNL.js";import{a as Ct,b as _t}from"./chunk-WASUNZOU.js";import{$a as Ne,$g as dt,Ac as We,Af as at,Ba as ve,Bc as Ue,Be as Qe,Ca as N,Cf as rt,Da as ye,Db as Me,De as fe,Df as lt,Ea as Se,Ed as k,Fa as xe,Ga as l,Gd as He,Ha as s,Hd as G,I as Q,Ia as V,Ib as Ie,Id as Je,Kc as me,Ke as Ye,Le as qe,M as ge,Ma as T,Na as y,Ne as ne,O as Y,Oa as c,Pc as w,Pe as Ze,Qe as Xe,Ra as I,S as W,T as q,Ua as O,Va as P,Ve as Ke,Wa as A,X as C,Xa as de,Y as _,Ya as m,Yg as ae,Za as g,Ze as oe,_a as L,_g as ct,ab as E,ad as ke,ah as mt,bb as b,bh as ut,cb as F,db as Ve,dc as Oe,dg as st,ec as X,eg as pt,eh as ft,fb as Te,gb as R,gc as U,hb as D,hc as K,hf as $e,ic as Pe,id as B,if as et,jc as Ae,jd as Ge,ka as we,lc as M,ld as ue,ma as a,mb as u,mc as Le,na as S,nb as f,nc as Re,nf as tt,oc as De,pb as Ee,pc as Be,pf as it,rb as Z,sc as je,sd as ze,tc as $,ua as x,uc as ee,uf as nt,vc as te,wa as d,wb as be,xa as ce,xf as ot,yc as ie,za as H,zb as Fe}from"./chunk-YJDF2OBW.js";import"./chunk-GAL4ENT6.js";var Ft=["inputControl"],Mt=["inputOrg"];function It(n,v){if(n&1){let e=T();l(0,"div",7)(1,"div",8)(2,"span",9)(3,"input",10,0),y("input",function(t){C(e);let o=c();return _(o.handleInput(t.target.value))}),s(),l(5,"label",11),m(6),s()()()()}if(n&2){let e=c();a(3),d("maxLength",e.maxLength)("value",e.value)("disabled",e.isDisabled),a(3),g(e.label)}}function Ot(n,v){if(n&1&&(l(0,"option",18),m(1),s()),n&2){let e=v.$implicit;d("ngValue",e.alpha2),a(),Ne("",e.alpha2," - ",e.name,"")}}function Pt(n,v){if(n&1&&(l(0,"strong"),m(1),s()),n&2){let e=c(2);a(),g(e.value)}}function At(n,v){n&1&&(l(0,"span",31),m(1),u(2,"translate"),s()),n&2&&(a(),g(f(2,1,"VPN.PANEL.CLIENT_CONFIG_NAME_WIZARD.NO_VALUE")))}function Lt(n,v){if(n&1){let e=T();l(0,"div",12)(1,"div",8)(2,"span",9)(3,"input",13,1),F("ngModelChange",function(t){C(e);let o=c();return b(o.clientCertName.organization,t)||(o.clientCertName.organization=t),_(t)}),y("input",function(){C(e);let t=c();return _(t.handleClientCertNameInput())}),s(),l(5,"label",14),m(6),u(7,"translate"),s()()()(),l(8,"div",15)(9,"div",8)(10,"span",16),m(11,"-"),s(),l(12,"span",9)(13,"select",17),F("ngModelChange",function(t){C(e);let o=c();return b(o.clientCertName.country,t)||(o.clientCertName.country=t),_(t)}),y("change",function(){C(e);let t=c();return _(t.handleClientCertNameInput())}),l(14,"option",18),m(15),u(16,"translate"),s(),Se(17,Ot,2,3,"option",18,ye),s(),l(19,"label",19),m(20),u(21,"translate"),s()()()(),l(22,"div",15)(23,"div",8)(24,"span",16),m(25,"-"),s(),l(26,"span",9)(27,"input",20,2),F("ngModelChange",function(t){C(e);let o=c();return b(o.clientCertName.department,t)||(o.clientCertName.department=t),_(t)}),y("input",function(){C(e);let t=c();return _(t.handleClientCertNameInput())}),s(),l(29,"label",21),m(30),u(31,"translate"),s()()()(),l(32,"div",15)(33,"div",8)(34,"span",16),m(35,"-"),s(),l(36,"span",9)(37,"input",22,3),F("ngModelChange",function(t){C(e);let o=c();return b(o.clientCertName.username,t)||(o.clientCertName.username=t),_(t)}),y("input",function(){C(e);let t=c();return _(t.handleClientCertNameInput())}),s(),l(39,"label",23),m(40),u(41,"translate"),s()()()(),l(42,"div",15)(43,"div",8)(44,"span",16),m(45,"."),s(),l(46,"span",9)(47,"input",24,4),F("ngModelChange",function(t){C(e);let o=c();return b(o.clientCertName.surname,t)||(o.clientCertName.surname=t),_(t)}),y("input",function(){C(e);let t=c();return _(t.handleClientCertNameInput())}),s(),l(49,"label",25),m(50),u(51,"translate"),s()()()(),l(52,"div",26)(53,"div",8)(54,"span",16),m(55,"-"),s(),l(56,"span",9)(57,"input",27,5),F("ngModelChange",function(t){C(e);let o=c();return b(o.clientCertName.counter,t)||(o.clientCertName.counter=t),_(t)}),y("input",function(){C(e);let t=c();return _(t.handleClientCertNameInput())}),s(),l(59,"label",28),m(60,"#"),s()()()(),l(61,"div",7)(62,"span",29),m(63),u(64,"translate"),s(),V(65,"span",30),x(66,Pt,2,1,"strong")(67,At,3,3,"span",31),s()}if(n&2){let e=c();a(3),E("ngModel",e.clientCertName.organization),d("disabled",e.disableOrganizationEdit||e.isDisabled),a(3),g(f(7,22,"VPN.PANEL.CLIENT_CONFIG_NAME_WIZARD.ORG")),a(7),d("disabled",e.disableCountryEdit||e.isDisabled),E("ngModel",e.clientCertName.country),a(),d("ngValue",""),a(),g(f(16,24,"VPN.PANEL.CLIENT_CONFIG_NAME_WIZARD.SEL_COUNTRY")),a(2),xe(e.countries),a(3),g(f(21,26,"VPN.PANEL.CLIENT_CONFIG_NAME_WIZARD.COUNTRY")),a(7),d("disabled",e.disableDepartmentEdit||e.isDisabled),E("ngModel",e.clientCertName.department),a(3),g(f(31,28,"VPN.PANEL.CLIENT_CONFIG_NAME_WIZARD.DEP")),a(7),d("disabled",e.disableUsernameEdit||e.isDisabled),E("ngModel",e.clientCertName.username),a(3),g(f(41,30,"VPN.PANEL.CLIENT_CONFIG_NAME_WIZARD.USERNAME")),a(7),d("disabled",e.disableSurnameEdit||e.isDisabled),E("ngModel",e.clientCertName.surname),a(3),g(f(51,32,"VPN.PANEL.CLIENT_CONFIG_NAME_WIZARD.SURNAME")),a(7),d("disabled",e.isDisabled),E("ngModel",e.clientCertName.counter),a(6),L("",f(64,34,"VPN.PANEL.FIELDS.CN"),":"),a(3),N(e.value?66:-1),a(),N(e.value?-1:67)}}var Rt=/^(\w+)(-\w{2})?(-\w{3,})?(-\w{3,})?(.\w{3,})?(-\d{2})?$/;var gt=(()=>{class n{set showClientCertWizard(e){this._showClientCertWizard=e,e?(this.parseValueToClientCertName(),setTimeout(()=>{this.inputOrg&&this.inputOrg.nativeElement.focus()},10)):(this.cd.detectChanges(),setTimeout(()=>{this.inputControl&&this.inputControl.nativeElement.focus()},10))}constructor(e,i){this.fwcUserService=e,this.cd=i,this.label="",this.maxLength=64,this.prefixValue="",this.onChange=t=>{},this.onTouch=()=>{},this.resetProperties()}parseValueToClientCertName(){let e="",i="",t="",o="",r="",h="00";if(this.prefixValue){let p=this.prefixValue.split("-");if(this.disableOrganizationEdit=!!p[0],this.disableCountryEdit=!!p[1],this.disableDepartmentEdit=!!p[2],p[3]){let[z,se]=p[3].split(".");this.disableUsernameEdit=!!z,this.disableSurnameEdit=!!se}}if(this.value){let p=this.value.split("-");p[0]&&(e=p[0]),p[1]&&(i=p[1].toUpperCase()),p[2]&&(t=p[2]),p[3]&&([o,r]=p[3].split(".")),p[4]&&(h=p[4])}this.clientCertName={organization:e,country:i,department:t,username:o,surname:r,counter:h},this.cd.markForCheck()}parseValueToClientCertNameWithRegexp(){let e="",i="",t="",o="",r="",h="00";if(this.value){let p=Rt.exec(this.value);p&&(e=p[1],this.disableOrganizationEdit=!!this.prefixValue,p[2]&&(i=p[2].slice(1).toUpperCase(),this.disableCountryEdit=!!this.prefixValue),p[3]&&(t=p[3].slice(1),this.disableDepartmentEdit=!!this.prefixValue),p[4]&&(o=p[4].slice(1)),p[5]&&(r=p[5].slice(1)),p[6]&&(h=p[6].slice(1)))}this.clientCertName={organization:e,country:i,department:t,username:o,surname:r,counter:h},this.cd.markForCheck()}parseClientCertNameToValue(){let e="";this.clientCertName&&(e=`${this.clientCertName.organization}-${this.clientCertName.country}-${this.clientCertName.department}-${this.clientCertName.username}.${this.clientCertName.surname}-${this.clientCertName.counter}`),this.handleInput(e)}handleInput(e){this.prefixValue&&e.indexOf(this.prefixValue)!==0?(this.value=this.prefixValue,this.inputControl&&(this.inputControl.nativeElement.value=this.value)):this.value=e,this.onTouch(),this.onChange(this.value),this.cd.markForCheck()}handleClientCertNameInput(){this.parseClientCertNameToValue()}isValidClientCertName(){let e=!1;if(!this.value)e=!0;else{let[i,t]=this.value.split("-");t?Array.isArray(this.countries)&&this.countries.find(r=>r.alpha2.toUpperCase()===t.toUpperCase())&&(e=!0):e=!0}return e}focusMainInput(){this.inputOrg?this.inputOrg.nativeElement.focus():this.inputControl&&this.inputControl.nativeElement.focus()}resetProperties(){this.prefixValue="",this.disableOrganizationEdit=this.disableCountryEdit=this.disableDepartmentEdit=this.disableUsernameEdit=this.disableSurnameEdit=!1,this.clientCertName={organization:"",country:"",department:"",username:"",surname:"",counter:"00"}}writeValue(e){e?(this.prefixValue=this.value=e,this._showClientCertWizard&&this.parseValueToClientCertName()):this.prefixValue=this.value="",this.cd.markForCheck()}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouch=e}setDisabledState(e){this.isDisabled=e}static{this.\u0275fac=function(i){return new(i||n)(S(k),S(Z))}}static{this.\u0275cmp=W({type:n,selectors:[["sts-fwc-vpn-config-name-control"]],viewQuery:function(i,t){if(i&1&&(O(Ft,5),O(Mt,5)),i&2){let o;P(o=A())&&(t.inputControl=o.first),P(o=A())&&(t.inputOrg=o.first)}},inputs:{label:"label",maxLength:"maxLength",showClientCertWizard:"showClientCertWizard",countries:"countries"},features:[Ve([{provide:Oe,useExisting:ge(()=>n),multi:!0}])],decls:3,vars:1,consts:[["inputControl",""],["inputOrg",""],["inputDpt",""],["inputName",""],["inputSurname",""],["inputCnt",""],[1,"grid","grid","grid-nogutter"],[1,"col-12","grid","grid-nogutter"],[1,"p-inputgroup"],[1,"p-float-label"],["pInputText","","type","text","name","inputControl","ondrop","return false",3,"input","maxLength","value","disabled"],["for","inputControl",2,"left","0px"],[1,"col-3","grid","grid-nogutter"],["pInputText","","type","text","name","inputOrg","ondrop","return false",3,"ngModelChange","input","ngModel","disabled"],["for","inputOrg",2,"left","0px"],[1,"col-2","grid","grid-nogutter"],[1,"spanFieldsSep"],["name","country",1,"fwcSelect",3,"ngModelChange","change","disabled","ngModel"],[3,"ngValue"],["for","country",2,"left","0px"],["pInputText","","type","text","name","inputDpt","ondrop","return false",3,"ngModelChange","input","disabled","ngModel"],["for","inputDpt",2,"left","0px"],["pInputText","","type","text","name","inputName","ondrop","return false",3,"ngModelChange","input","disabled","ngModel"],["for","inputName",2,"left","0px"],["pInputText","","type","text","name","inputSurname","ondrop","return false",3,"ngModelChange","input","disabled","ngModel"],["for","inputSurname",2,"left","0px"],[1,"col-1","grid","grid-nogutter"],["pInputText","","type","text","name","inputCnt","maxlength","2","ondrop","return false",3,"ngModelChange","input","disabled","ngModel"],["for","inputCnt",2,"color","var(--fwcBlue)","left","0px"],[1,"fwcBlue"],[1,"fwcSepShort"],[1,"fwcPaleDark"]],template:function(i,t){i&1&&(l(0,"div",6),x(1,It,7,4,"div",7)(2,Lt,68,36),s()),i&2&&(a(),N(t._showClientCertWizard?2:1))},dependencies:[ee,te,X,$,K,ie,Le,oe,G],styles:[`span.spanFieldsSep{font-weight:700;line-height:2.45rem;padding:0 .3rem}.p-float-label>label{top:40%}.p-float-label input.p-filled~label,.p-float-label input:focus~label{top:0;margin-top:-1rem}
`],encapsulation:2})}}return n})();var Bt=["fwcConfigNameControl"],jt=()=>({width:"80vw"}),_e=n=>({visibility:n}),Wt=()=>({width:"1.7rem",height:"1.7rem"});function Ut(n,v){if(n&1&&(l(0,"div",27)(1,"h6",28),V(2,"i"),u(3,"fwcIcon"),m(4),s()()),n&2){let e=c(2);a(2),ve("",Ee(3,4,e.object.obj_type,null,"fwcOrange")," fwcOrange"),a(2),L(" ",e.headerTitle," ")}}function kt(n,v){if(n&1&&(l(0,"div",11)(1,"div",13)(2,"span",14)(3,"select",29)(4,"option",19),m(5),u(6,"translate"),s(),l(7,"option",19),m(8),u(9,"translate"),s()(),l(10,"label",30),m(11),u(12,"translate"),s()()()()),n&2){let e=c(2);a(4),d("ngValue",e.CACertTypes.client),a(),g(f(6,5,"VPN.PANEL.CERT_TYPE_OPTS.0")),a(2),d("ngValue",e.CACertTypes.server),a(),g(f(9,7,"VPN.PANEL.CERT_TYPE_OPTS.1")),a(3),g(f(12,9,"VPN.PANEL.FIELDS.TYPE"))}}function Gt(n,v){if(n&1){let e=T();l(0,"div",22)(1,"div",13)(2,"div",14)(3,"button",31),u(4,"translate"),u(5,"translate"),y("click",function(){C(e);let t=c(2);return _(t.handleToggleClientConfigName())}),s()()()()}if(n&2){c();let e=de(30),i=c();a(3),I("label",f(4,5,"VPN.PANEL.CLIENT_CONFIG_NAME_WIZARD.BUTTON")),I("pTooltip",f(5,7,"VPN.PANEL.CLIENT_CONFIG_NAME_WIZARD.TOOLTIP")),d("disabled",!e.isValidClientCertName()||i.loadingData)("ngClass",i.showClientCertWizard?"p-button-primary ":"p-button-secondary")("icon",i.showClientCertWizard?"fa fa-magic":"fa fa-pencil")}}function zt(n,v){if(n&1){let e=T();l(0,"button",36),u(1,"translate"),y("click",function(){C(e);let t=c(3);return _(t.onCancel())}),s()}if(n&2){let e=c(3);I("label",f(1,2,"GLOBALS.MSG_BUTTONS.CANCEL")),d("disabled",!e.object||e.loadingData)}}function Ht(n,v){if(n&1){let e=T();l(0,"button",37),u(1,"translate"),y("click",function(){C(e);let t=c(3);return _(t.onSave())}),s()}if(n&2){let e=c(3);I("label",f(1,2,"GLOBALS.MSG_BUTTONS.SAVE")),d("disabled",!e.formModel.valid||e.formModel.pristine||e.loadingData)}}function Jt(n,v){if(n&1){let e=T();l(0,"button",38),u(1,"translate"),y("click",function(){C(e);let t=c(3);return _(t.onCancel())}),s()}n&2&&I("label",f(1,1,"GLOBALS.MSG_BUTTONS.CLOSE"))}function Qt(n,v){if(n&1&&(l(0,"div",32),V(1,"p-progressSpinner"),s(),x(2,zt,2,4,"button",33)(3,Ht,2,4,"button",34)(4,Jt,2,3,"button",35)),n&2){let e=c(2);d("ngStyle",D(6,_e,e.loadingData?"visible":"hidden")),a(),H(R(8,Wt)),a(),N(e.formModel.pristine?-1:2),a(),N(e.formModel.pristine?-1:3),a(),N(e.formModel.pristine?4:-1)}}function Yt(n,v){if(n&1){let e=T();l(0,"p-dialog",3,0),F("visibleChange",function(t){C(e);let o=c();return b(o.displayDialog,t)||(o.displayDialog=t),_(t)}),y("onShow",function(){C(e);let t=c();return _(t.onDialogShow())})("onHide",function(){C(e);let t=c();return _(t.onDialogHide())}),x(2,Ut,5,8,"ng-template",4),l(3,"p-tabView",5)(4,"p-tabPanel",6),u(5,"translate"),l(6,"div",7)(7,"form",8)(8,"fieldset",9),y("keyup.enter",function(t){C(e);let o=c();return _(o.checkForm(t))})("keyup.esc",function(){C(e);let t=c();return _(t.onCancel())}),l(9,"div",10),x(10,kt,13,11,"div",11),l(11,"div",12)(12,"div",13)(13,"span",14),V(14,"input",15),l(15,"label",16),m(16),u(17,"translate"),s()(),l(18,"select",17),y("change",function(){C(e);let t=c();return _(t.revalidateForm())}),l(19,"option",18),m(20),u(21,"translate"),s(),l(22,"option",19),m(23),u(24,"translate"),s()()(),l(25,"p",20),m(26),u(27,"translate"),s()(),l(28,"div",12),V(29,"sts-fwc-vpn-config-name-control",21,1),u(31,"translate"),l(32,"p",20),m(33),u(34,"translate"),s()(),x(35,Gt,6,9,"div",22),l(36,"div",23)(37,"span",14),V(38,"textarea",24),l(39,"label",25),m(40),u(41,"translate"),s()()()()()()()()(),x(42,Qt,5,9,"ng-template",26),s()}if(n&2){let e,i,t,o=de(30),r=c();H(R(41,jt)),E("visible",r.displayDialog),d("modal",!0)("closable",!1)("resizable",!0),a(4),I("header",f(5,25,"VPN.PANEL.DATA")),a(3),d("formGroup",r.formModel),a(3),N(r.object.obj_type==r.ObjectTypes.OBJ_CERT_CLI||r.object.obj_type==r.ObjectTypes.OBJ_CERT_SER?10:-1),a(),d("ngClass",r.object.obj_type==r.ObjectTypes.OBJ_CA?"col-6":"col-3"),a(5),g(f(17,27,"VPN.PANEL.FIELDS.DAYS")),a(3),d("ngValue",r.CADaysOptions.days),a(),g(f(21,29,"VPN.PANEL.DAY_OPTS.0")),a(2),d("ngValue",r.CADaysOptions.years),a(),g(f(24,31,"VPN.PANEL.DAY_OPTS.1")),a(2),d("ngStyle",D(42,_e,r.formModel.get("days").valid||r.formModel.get("days").pristine?"hidden":"visible")),a(),g(f(27,33,"VPN.PANEL.ERRORS.DAYS")),a(2),d("ngClass",((e=r.formModel.get("type"))==null?null:e.value)===r.CACertTypes.client&&!r.object.id&&!r.showClientCertWizard?"col-5":((e=r.formModel.get("type"))==null?null:e.value)===r.CACertTypes.client&&!r.object.id&&r.showClientCertWizard?"col-11":"col-6"),a(),I("label",f(31,35,"VPN.PANEL.FIELDS.CN")),d("showClientCertWizard",r.showClientCertWizard&&((i=r.formModel.get("type"))==null?null:i.value)===r.CACertTypes.client&&!r.object.id&&o.isValidClientCertName())("countries",r.countries),a(3),d("ngStyle",D(44,_e,r.formModel.get("cn").valid||r.formModel.get("cn").pristine?"hidden":"visible")),a(),g(f(34,37,"VPN.PANEL.ERRORS.CN_FORMAT")),a(2),N(((t=r.formModel.get("type"))==null?null:t.value)===r.CACertTypes.client&&!r.object.id?35:-1),a(5),g(f(41,39,"ITEM_PANEL.FIELDS.COMMENTS"))}}var le=(()=>{class n{daysValidator(e){let i=e.value,t,o=1,r=36500;return this.formModel&&this.formModel.controls.days_select.value==B.years&&(r=r/365|0),t=i>=o&&i<=r,t?null:{daysOutOfRange:!0}}constructor(e,i,t,o,r,h,p,z,se,Nt){this.itemSelectedService=e,this.fwcUserService=i,this.fwcVpnService=t,this.translate=o,this.fwcErrorPipe=r,this.messageService=h,this.confirmationService=p,this.utilService=z,this.http=se,this.cd=Nt,this.displayDialog=!1,this.ObjectTypes=w,this.CADaysOptions=B,this.CACertTypes=Ge,this.showClientCertWizard=!1,this.alive=!0,this.certNamePrefixValidator=j=>J=>{let he,pe=J.value;return he=pe&&pe.indexOf(j)===0&&pe.length>j.length,he?null:{wrongCNNameWithPrefix:!0}};let Vt=`assets/data/${i.getActualFwcUser()?i.getActualFwcUser().selectedLanguage:"es"}/countries.json`;this.http.get(Vt).subscribe(j=>{j.map(J=>J.alpha2=J.alpha2.toUpperCase()),this.countries=j},j=>{})}ngOnInit(){this.itemSelectedService.getItem().pipe(Q(()=>this.alive)).subscribe(e=>{this.insert=e.containerReadOnly===void 0,this.edit=e.containerReadOnly===!1,!(e.obj_type!=w.OBJ_CA&&e.obj_type!=w.OBJ_CERT_CLI&&e.obj_type!=w.OBJ_CERT_SER)&&(this.resetProperties(),this.onItemSelect(e),this.displayDialog=!0,this.cd.detectChanges())})}ngOnDestroy(){this.alive=!1}resetProperties(){this.object=null}onItemSelect(e){if(!e)return;let i=e._fwcObjId,t=e.obj_type;if(i===void 0&&t!==void 0){let o={id:i,obj_type:t,node_id:e.node_id,container:e.container};t==w.OBJ_CA?this.headerTitle=this.translate.instant("VPN.PANEL.NEW.CA"):(this.headerTitle=this.translate.instant("VPN.PANEL.NEW.CERT",{ca_name:e.ca_name}),o.ca=e.ca,o.type=e.type,e.folder_prefix&&(o.folder_prefix=e.folder_prefix,this.headerTitle+=` / '${e.folder_prefix}'`)),this.createForm(o)}else{let o,r={fwcloud:this.fwcUserService.getActualFwSelectedCloud()};switch(t){case w.OBJ_CA:o=this.fwcVpnService.getCA.bind(this.fwcVpnService),r.ca=i,this.headerTitle=`${this.translate.instant("VPN.CA")}: '${e._fwcObjName}'`;break;case w.OBJ_CERT_CLI:case w.OBJ_CERT_SER:o=this.fwcVpnService.getCertificate.bind(this.fwcVpnService),r.crt=i,this.headerTitle=`${this.translate.instant("VPN.CERT")}: '${e._fwcObjName}'`;break}o&&o(r).subscribe(h=>{let p=h.data;p.obj_type=t,this.createForm(p)},h=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(h)})})}}createForm(e){e&&(e.days?e.days%365?e.days_select=B.days:(e.days=e.days/365,e.days_select=B.years):(e.days=50,e.days_select=B.years),this.formModel=new Ae({id:new M(e.id),cn:new M({value:e.cn,disabled:!this.insert},[U.required,U.pattern(ue.cnRegExp)]),days:new M({value:e.days,disabled:!this.insert},[U.required,this.daysValidator.bind(this)]),node_id:new M(e.node_id),comment:new M({value:e.comment,disabled:!this.insert&&!this.edit}),days_select:new M({value:e.days_select,disabled:!this.insert})}),(e.obj_type==w.OBJ_CERT_CLI||e.obj_type==w.OBJ_CERT_SER)&&(this.formModel.addControl("type",new M({value:e.type,disabled:!this.insert})),this.formModel.addControl("ca",new M({value:e.ca,disabled:!this.insert})),this.showClientCertWizard=e.obj_type==w.OBJ_CERT_CLI&&!e.id,e.folder_prefix&&(this.formModel.get("cn").setValue(e.folder_prefix),this.formModel.get("cn").setValidators([U.required,U.pattern(ue.cnRegExp),this.certNamePrefixValidator(e.folder_prefix)]))),this.object=e,this.cd.detectChanges())}revalidateForm(){for(let e in this.formModel.controls)this.formModel.controls[e].updateValueAndValidity(),this.formModel.controls[e].markAsTouched()}onCancel(e){!e&&!this.formModel.pristine&&this.formModel.valid?this.confirmationService.confirm({header:this.translate.instant("GLOBALS.MSG_CONFIRM"),icon:"fa fa-question-circle fwcBlue iconBig",message:this.translate.instant("VPN.PANEL.MSG_EXIT"),accept:()=>{this.onCancel(!0)},rejectVisible:!0,rejectLabel:"No",acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.YES")}):(this.resetProperties(),this.displayDialog=!1,this.cd.detectChanges())}checkForm(e){e&&e.target&&e.target.type!="textarea"&&this.formModel.valid&&(e.target.blur(),this.onSave())}onSave(){if(this.object)if(this.object.id==null){let e={};for(let r in this.formModel.controls)e[r]=this.formModel.controls[r].value!==null&&this.formModel.controls[r].value!==void 0?this.formModel.controls[r].value:void 0;e.fwcloud=this.fwcUserService.getActualFwSelectedCloud(),e.days_select==B.years&&(e.days*=365),delete e.days_select;let i,t,o;switch(this.object.obj_type){case w.OBJ_CA:i=this.fwcVpnService.newCA.bind(this.fwcVpnService),t=this.translate.instant("VPN.CA"),o="VPN.PANEL.NEW.CA_CREATING";break;case w.OBJ_CERT_CLI:case w.OBJ_CERT_SER:i=this.fwcVpnService.newCertificate.bind(this.fwcVpnService),t=this.translate.instant("VPN.CERT"),o="VPN.PANEL.NEW.OK";break}i&&(this.loadingData=!0,this.utilService.fwcAPICall(i,e).then(r=>{let h=r.data.insertId,p=r.data.TreeinsertId,z={container:this.object.container,_fwcObjId:h,_fwcObjType:this.object.obj_type,_fwcObjTreeId:p,_fwcTreeAction:ke.NEW_ITEM};this.itemSelectedService.setModifiedItem(z),this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant(o,{objtype:t})}),this.displayDialog=!1,this.loadingData=!1,this.cd.detectChanges()}).catch(r=>{r.error.fwcErr==1005?this.confirmationService.confirm({header:this.translate.instant("VPN.PANEL.NEW.ERRORS.DUP_CN.SUMMARY"),icon:"fa fa-question-circle fwcBlue iconBig",message:this.translate.instant("VPN.PANEL.NEW.ERRORS.DUP_CN.TEXT"),rejectVisible:!1,acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.OK"),accept:()=>{}}):(this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(r)}),this.loadingData=!1),this.cd.detectChanges()}))}else{let e={};for(let t in this.formModel.controls)e[t]=this.formModel.controls[t].value!==null&&this.formModel.controls[t].value!==void 0?this.formModel.controls[t].value:void 0;e.fwcloud=this.fwcUserService.getActualFwSelectedCloud();let i;switch(this.object.obj_type){case w.OBJ_CA:i=this.fwcVpnService.updateCA.bind(this.fwcVpnService);break;case w.OBJ_CERT_CLI:case w.OBJ_CERT_SER:i=this.fwcVpnService.updateCRT.bind(this.fwcVpnService);break}this.loadingData=!0,this.utilService.fwcAPICall(i,e).then(()=>{w.OBJ_CA==this.object.obj_type?this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("CONTEXT.FCA.EDIT_SUCCESS")}):this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("CONTEXT.CA.EDIT_CERT_SUCCESS")}),this.loadingData=!1,this.displayDialog=!1,this.cd.detectChanges()})}}handleToggleClientConfigName(){this.showClientCertWizard=!this.showClientCertWizard,this.cd.detectChanges()}onDialogShow(){setTimeout(()=>{this.fwcConfigNameControl&&this.fwcConfigNameControl.focusMainInput()},100)}onDialogHide(){}static{this.\u0275fac=function(i){return new(i||n)(S(fe),S(k),S(Qe),S(He),S(Xe),S(qe),S(Ye),S(Ze),S(Ie),S(Z))}}static{this.\u0275cmp=W({type:n,selectors:[["sts-fwc-vpn-panel"]],viewQuery:function(i,t){if(i&1&&O(Bt,5),i&2){let o;P(o=A())&&(t.fwcConfigNameControl=o.first)}},decls:1,vars:1,consts:[["dlgItemPanel",""],["fwcConfigNameControl",""],["styleClass","dlgFwcDialog fwcObjectDialog",3,"visible","modal","closable","resizable","style"],["styleClass","dlgFwcDialog fwcObjectDialog",3,"visibleChange","onShow","onHide","visible","modal","closable","resizable"],["pTemplate","header"],["styleClass","objectInfoTab"],["leftIcon","fa fa-pencil",3,"header"],[1,"fwcObjectPanel"],[3,"formGroup"],[3,"keyup.enter","keyup.esc"],[1,"grid"],[1,"col-3"],[3,"ngClass"],[1,"p-inputgroup"],[1,"p-float-label"],["pInputText","","type","number","formControlName","days","name","days","ondrop","return false"],["for","days",2,"color","var(--fwcBlue)","left","0px"],["formControlName","days_select","name","days_select",1,"fwcSelect",3,"change"],["selected","",3,"ngValue"],[3,"ngValue"],[1,"fwc-error",3,"ngStyle"],["formControlName","cn","maxLength","64",3,"label","showClientCertWizard","countries"],[1,"col-1"],[1,"col-12"],["pInputTextarea","","formControlName","comment","name","comment","maxlength","255","ondrop","return false"],["for","comment",2,"left","0px"],["pTemplate","footer"],[1,"divFormHeader"],[1,"fwcWhite","fwcIconLeft"],["formControlName","type","name","type",1,"fwcSelect"],["for","ip_version",2,"left","0px"],["pButton","","type","button","showDelay","500","tooltipPosition","top",1,"fwcButtonHeight",2,"width","100%","padding","0.625em","font-family","'Montserrat', sans-serif",3,"click","disabled","ngClass","icon","label","pTooltip"],[1,"divLoadTemp",3,"ngStyle"],["pButton","","icon","pi pi-times",1,"p-button-danger",3,"label","disabled"],["pButton","","icon","fa fa-save",1,"p-button-success",3,"label","disabled"],["pButton","","icon","pi pi-times",1,"p-button-primary",3,"label"],["pButton","","icon","pi pi-times",1,"p-button-danger",3,"click","label","disabled"],["pButton","","icon","fa fa-save",1,"p-button-success",3,"click","label","disabled"],["pButton","","icon","pi pi-times",1,"p-button-primary",3,"click","label"]],template:function(i,t){i&1&&x(0,Yt,43,46,"p-dialog",2),i&2&&N(t.object&&t.formModel?0:-1)},styles:["@-moz-document url-prefix(){.p-float-label textarea.p-filled~label{top:0;margin-top:-1.7rem}.p-float-label textarea:focus~label{margin-top:-.5rem}}"],changeDetection:0})}}return n})();var Zt=()=>({height:"92vh",width:"100%"}),vt=()=>({normal:"itvOpenvpnTree"}),yt=n=>({general:n});function Xt(n,v){n&1&&(m(0),u(1,"translate")),n&2&&L(" ",f(1,1,"VPN.TREE_CA")," ")}function Kt(n,v){if(n&1&&(l(0,"div",5)(1,"p-panel"),x(2,Xt,2,3,"ng-template",6),s(),l(3,"div"),V(4,"sts-fwc-tree",7),s()()),n&2){let e=c(2);a(3),ce("height",e.treeContainerHeight),a(),d("treeOptions",e.optionsTreeCa)("treeStyle",D(5,yt,R(4,vt)))}}function $t(n,v){n&1&&(m(0),u(1,"translate")),n&2&&L(" ",f(1,1,"VPN.TREE_FW")," ")}function ei(n,v){if(n&1&&(l(0,"div",5)(1,"p-panel"),x(2,$t,2,3,"ng-template",6),s(),l(3,"div"),V(4,"sts-fwc-tree",7),s()()),n&2){let e=c(2);a(3),ce("height",e.treeContainerHeight),a(),d("treeOptions",e.optionsTreeFw)("treeStyle",D(5,yt,R(4,vt)))}}function ti(n,v){n&1&&(l(0,"div",2)(1,"p-splitter",null,0),x(3,Kt,5,7,"ng-template",4)(4,ei,5,7,"ng-template",4),s()()),n&2&&(a(),H(R(2,Zt)))}var St=(()=>{class n{constructor(e,i){this.fwcUserService=e,this.appOptionsService=i,this.alive=!0,this.treeContainerHeight="100%",this.optionsTreeFw=i.optionsTreeFwCon,this.optionsTreeCa=i.optionsTreeCa}onResize(e){this.adjustTreeHeight(),this.onSplitterResize(e)}ngOnInit(){this.fwcUserService.getFwcUser().pipe(Q(()=>this.alive)).subscribe(e=>{(!this.fwcUser||this.fwcUser&&(e.user_id!=this.fwcUser.user_id||e.selectedFwCloud!=this.fwcUser.selectedFwCloud))&&this.loadFwcObjectTree(e.user_id,e.selectedLanguage,e.selectedFwCloud,1,1),this.fwcUser=Object.assign({},e)}),this.adjustTreeHeight()}adjustTreeHeight(){let e=window.innerHeight;this.treeContainerHeight=`${e-150}px`}onSplitterResize(e){this.fwcTreeComponents.forEach(i=>{i.treeview.nativeElement.updateLayout()})}ngOnDestroy(){this.alive=!1}loadFwcObjectTree(e,i,t,o,r){let h,p;h=Object.assign({},this.optionsTreeFw),p=Object.assign({},this.optionsTreeCa),h.user_id=p.user_id=e,h.fwcloud=p.fwcloud=t,h.objStandard=p.objStandard=o,h.objCloud=p.objCloud=r,this.optionsTreeFw=Object.assign({},h),this.optionsTreeCa=Object.assign({},p)}onShowStatusSection(e){this.displayStatusSection=e}static{this.\u0275fac=function(i){return new(i||n)(S(k),S(ze))}}static{this.\u0275cmp=W({type:n,selectors:[["sts-fwc-vpn-main"]],viewQuery:function(i,t){if(i&1&&O(ae,5),i&2){let o;P(o=A())&&(t.fwcTreeComponents=o)}},hostBindings:function(i,t){i&1&&y("resize",function(r){return t.onResize(r)},!1,we)},decls:8,vars:4,consts:[["splitter",""],[1,"fwcDivBoxed","fwcMainContainer"],[1,"grid-nogutter","fwcDivBoxed"],[3,"restrictionsReadOnly"],["pTemplate",""],[2,"height","auto","width","100%"],["pTemplate","header"],[3,"treeOptions","treeStyle"]],template:function(i,t){i&1&&(l(0,"div",1),x(1,ti,5,3,"div",2),s(),V(2,"sts-fwc-vpn-panel")(3,"sts-fwc-ovconfig-panel",3)(4,"sts-fwc-wireguard-config-panel",3)(5,"sts-fwc-ipsec-config-panel",3)(6,"sts-fwc-info-tooltip")(7,"sts-fwc-vpn-status-panel")),i&2&&(a(),N(t.fwcUser!=null&&t.fwcUser!=null?1:-1),a(2),d("restrictionsReadOnly",!0),a(),d("restrictionsReadOnly",!0),a(),d("restrictionsReadOnly",!0))},dependencies:[pt,ae,ut,ct,dt,mt,ne,it,Ct,le,G],styles:[`.fwcMainContainer{background:var(--surfaceBackgroundColor)!important;width:100%;height:100%}.p-panel .p-panel-header{display:flex!important;flex-direction:column;justify-content:center!important;align-items:center!important;background-color:var(--fwcLightBlue)!important;color:var(--fixedWhiteColor)!important;font-family:arial,Montserrat,sans-serif;text-transform:uppercase;font-size:.9rem;width:100%}
`],encapsulation:2})}}return n})();var ii=[{path:"",component:St},{path:"**",pathMatch:"full",redirectTo:""}],xt=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275mod=q({type:n})}static{this.\u0275inj=Y({imports:[me.forChild(ii),me]})}}return n})();var In=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275mod=q({type:n})}static{this.\u0275inj=Y({imports:[Me,We,Ue,xt,Je.forChild(),ft,ht,et,_t,ot]})}}return n})();Te(le,function(){return[be,Fe,Re,ee,te,X,De,$,K,Pe,ie,Be,je,tt,ne,Ke,$e,nt,oe,at,lt,rt,gt]},function(){return[G,st]});export{In as FwcVpnModule};
