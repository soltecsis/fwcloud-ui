import{a as fl,b as wl,c as gl,e as Cl}from"./chunk-DU7IJYDF.js";import{a as Sl}from"./chunk-U5CZMBB5.js";import{a as ml,b as hl}from"./chunk-AH4AFCIH.js";import{$ as uo,$a as H,$c as it,$f as wn,Aa as xt,Ab as Eo,Ad as se,Ae as Fe,Ba as O,Bb as vo,Bf as Jo,Bg as Ui,Ca as Te,Cb as hi,Cd as ce,Cf as Ko,Cg as yn,Da as Oe,Dd as nt,Ea as Re,Ed as Mo,Fa as c,Fd as ot,Fe as Ki,Ga as u,Gc as Ft,Gd as Oi,Ge as Ie,Ha as T,Hd as Ri,He as _e,Hf as Xo,Hg as ol,I as $,Ia as dt,Id as Xt,Ie as Bo,If as zo,Ig as Gi,Ja as _t,Jc as bi,Jd as oe,Je as Ue,Jf as qo,Jg as ll,Ka as ut,Kc as At,Kd as We,Ke as Fi,Kf as Qo,Kg as Bi,La as L,Ld as sn,Le as ue,Lg as rl,Ma as P,Md as cn,Me as we,Mf as yt,Mg as Qn,N as Be,Na as d,Nc as v,Nd as pn,Ne as Ai,Nf as $o,Ng as al,O as Tt,Oa as Yi,Ob as Wt,Oc as X,Od as dn,Of as Zo,Og as sl,Pa as Ji,Pc as Ee,Pe as ko,Pg as cl,Q as N,Qa as M,Qc as tt,Qe as fn,Ra as _i,Rb as Io,Rc as ai,Re as lt,Rg as En,S as Le,Sa as ui,Sb as Wn,Sc as Pi,Se as jo,T as Ot,Ta as Se,Tc as xe,Tg as vn,Ua as le,Ub as Hn,Uc as Me,Ue as Xn,Ug as zi,V as _o,Va as re,Vc as ve,Ve as qt,Vf as el,Vg as In,Wa as fe,Wb as Yn,Wc as q,Wg as pl,X as w,Xa as g,Xb as Jn,Xc as U,Xe as mn,Xg as dl,Y as S,Ya as j,Yc as xo,Yg as _l,Za as x,Zb as Kn,Zc as ne,Zd as pe,Zg as bn,_a as fi,_c as Ne,_d as zt,_f as $t,_g as ul,aa as kt,ab as Y,ad as ge,ag as tl,b as pi,bb as J,bd as St,cb as $e,cd as Fo,da as Hi,dc as Ht,dd as Kt,df as Lt,eb as wo,ed as z,eg as il,fb as W,fc as Q,fe as Do,fg as Ni,g as so,ga as tn,gb as ae,gc as ht,gg as Dt,ha as oi,hb as Ze,hc as wi,hg as Nt,i as kn,ib as on,ic as ri,if as hn,ig as Sn,ja as fo,jb as jn,jc as bo,jd as ye,je as Xe,jf as Mt,ka as mo,kb as So,kc as k,kg as Zt,la as a,lb as C,lc as wt,ld as Ti,ma as F,mb as y,mc as Si,md as ee,me as ze,mg as Et,nb as mi,nc as Yt,ne as me,ng as Xi,oa as Bt,ob as go,oc as gi,of as Vo,pb as Ve,pc as Po,pf as Wo,pg as gn,q as Wi,qb as ie,qc as To,qd as gt,qe as No,qf as Qt,qg as ei,ra as Rt,rb as li,rc as Ci,rd as Ao,rf as zn,rg as Cn,sa as nn,sb as Co,sc as yi,sd as Lo,se as xi,sg as ti,ta as A,tc as Ei,td as an,te as de,tg as nl,u as di,ua as Ke,ub as Vn,uc as vi,ue as _n,ug as qn,v as co,va as m,vb as et,vc as Oo,ve as Uo,vf as Ho,wa as jt,wb as yo,wc as Ii,we as un,wf as Li,xa as ho,xb as ln,xc as Jt,xe as Go,xf as Yo,ya as ke,yb as Vt,yc as Ro,ye as Ct,yf as Mi,z as po,za as je,zb as rn,ze as De,zf as Di}from"./chunk-JV7R45IV.js";import"./chunk-GFT3X7VS.js";import{a as ci,b as ao,g as Z}from"./chunk-GAL4ENT6.js";var rt=class{constructor(_,e,i,t,n){this.utilService=_,this.firewallId=e,this.clusterId=i,this.fwcloudId=t,this.policyType=n,this.rules=[]}getFirewallId(){return this.firewallId}getFwcloudId(){return this.fwcloudId}getClusterId(){return this.clusterId}getPolicyType(){return this.policyType}getPolicyRules(){return this.rules}getPolicyRule(_){let e=null;if(Array.isArray(this.rules))for(let i=0;i<this.rules.length&&!e;i++){let t=this.rules[i];t.id===_?e=t:t.rule_group&&Array.isArray(t.rules)&&(e=t.rules.find(n=>n.id===_))}return e}getShowAction(){return this.showAction}setShowAction(_){this.showAction=_}setPolicyRules(_){this.rules=_}getPolicyRulesLength(){return this.rules?this.rules.length:0}};var si=class extends rt{constructor(_,e,i,t,n,o,r,p,s,f){super(_,t,n,o,r),this.utilService=_,this.fwcRoutingTableService=e,this.fwcPolicyGridRoutingTableFunctionalityService=i,this.translationKeys={ENTITY_NAME:"ROUTING.NEW_TABLE_PANEL.ROUTE",ENTITY_DELETE:"ROUTING.ROUTE.DELETE_TEXT",DELETE_SUCCESS:"ROUTING.ROUTE.DELETE_SUCCESS",ENTITY_COLOR:"ROUTING.ROUTE.COLOR_TEXT"},this.routingTableId=s,this.routingTableName=f,this.buildPolicyRules(p)}getRoutingTableId(){return this.routingTableId}getRoutingTableName(){return this.routingTableName}buildPolicyRules(_){let e=[];Array.isArray(_)&&(e=this.fwcPolicyGridRoutingTableFunctionalityService.parseRoutingTableRoutes(this.firewallId,this.fwcloudId,_)),this.rules=e}newPolicyRule(_,e){_&&e!==void 0?this.fwcPolicyGridRoutingTableFunctionalityService.showNewRouteDialog(this.clusterId,this.firewallId,this.routingTableId,this.routingTableName,_.id,e):this.fwcPolicyGridRoutingTableFunctionalityService.showNewRouteDialog(this.clusterId,this.firewallId,this.routingTableId,this.routingTableName)}deletePolicyRuleApiCall(_){return this.utilService.fwcAPICall(this.fwcRoutingTableService.deleteRoutingTableRoutes.bind(this.fwcRoutingTableService),this.firewallId,this.fwcloudId,this.routingTableId,_)}convertPolicyRulesToRoutes(){let _=[];if(Array.isArray(this.rules))for(let e of this.rules){let i=this.convertPolicyRuleToRoute(e);_.push(i)}return _}convertPolicyRuleToRoute(_){let e,i,t=[];if(Array.isArray(_.positions)&&_.positions.length){let o=_.positions.find(s=>s.id===ai.GATEWAY_POSITION);if(o){let s=o.ipobjs.find(f=>f.type===v.OBJ_ADDRESS);s&&(e=s.id)}let r=_.positions.find(s=>s.id===ai.INTERFACE_POSITION);if(r){let s=r.ipobjs.find(f=>f.type===v.OBJ_INTERFACE_FIREWALL||f.type===v.OBJ_INTERFACE_HOST);s&&(i=s.id)}let p=_.positions.find(s=>s.id===ai.TO_POSITION);if(p&&Array.isArray(p.ipobjs))for(let s of p.ipobjs)s._fwcObjType!==v.OBJ_ANY&&t.push({id:s.id,name:s.name,type:s.type,firewall_id:s.firewall_id,cluster_id:s.cluster_id,cluster_name:s.cluster_name,position_order:s.position_order})}return{id:_.id,routingTableId:this.routingTableId,routeGroupId:_.idgroup,comment:_.comment,style:_.style,route_order:_.rule_order,active:!!_.active,firewallApplyToId:null,gatewayId:e,interfaceId:i,items:t}}manageObject(_,e,i,t){this.fwcPolicyGridRoutingTableFunctionalityService.updateRoutePosition(this,this.firewallId,this.fwcloudId,this.routingTableId,_,e,i,t)}deleteObject(_,e){this.fwcPolicyGridRoutingTableFunctionalityService.deleteObjectFromPosition(this.firewallId,this.clusterId,this.fwcloudId,this.routingTableId,_.rule,_,e)}compileSelectedRoutes(){this.fwcPolicyGridRoutingTableFunctionalityService.compileRoutes(this.routingTableId)}moveSelectedRules(_,e){this.fwcPolicyGridRoutingTableFunctionalityService.moveSelectedRoutes(this.clusterId,this.firewallId,this.fwcloudId,this.routingTableId,e.pasteOnRuleId,e.rulesIds,e.pasteOffset)}manageSelectedRules(_,e){return this.utilService.fwcAPICall(this.fwcRoutingTableService.manageTableRoutes.bind(this.fwcRoutingTableService),this.firewallId,this.fwcloudId,this.routingTableId,_.pasteOnRuleId,_.pasteOffset,_.rulesIds,e)}setRuleActive(_,e){let i={active:!!e};this.fwcPolicyGridRoutingTableFunctionalityService.updateSelectedRoutes(this.clusterId,this.firewallId,this.fwcloudId,this.routingTableId,i)}setRuleComment(_){this.fwcPolicyGridRoutingTableFunctionalityService.updateRouteComment(this.routingTableId,_)}setRuleApplyTo(_){this.fwcPolicyGridRoutingTableFunctionalityService.updateRuleApplyTo(this.routingTableId,_)}setRuleScript(_){}setRuleStyleApiCall(){return this.fwcPolicyGridRoutingTableFunctionalityService.setRouteStyle.bind(this.fwcPolicyGridRoutingTableFunctionalityService)}newRuleGroupApiCall(){return this.fwcPolicyGridRoutingTableFunctionalityService.newRouteGroup.bind(this.fwcPolicyGridRoutingTableFunctionalityService)}setRuleGroupStyleApiCall(){return this.fwcPolicyGridRoutingTableFunctionalityService.setGroupValues.bind(this.fwcPolicyGridRoutingTableFunctionalityService)}setRuleGroupNameApiCall(){return this.fwcPolicyGridRoutingTableFunctionalityService.setGroupValues.bind(this.fwcPolicyGridRoutingTableFunctionalityService)}removeRulesFromGroupApiCall(_){let e={routeGroupId:null},i=_.rulesIds;return this.utilService.fwcAPICall(this.fwcRoutingTableService.updateRoutingTableRoutes.bind(this.fwcRoutingTableService),this.firewallId,this.fwcloudId,this.routingTableId,i,e)}deleteRuleGroupApiCall(_){return this.utilService.fwcAPICall(this.fwcRoutingTableService.deleteRoutingTableRouteGroup.bind(this.fwcRoutingTableService),this.firewallId,this.fwcloudId,_)}};var Ut=class extends rt{constructor(_,e,i,t,n,o,r,p,s,f,h){super(_,t,n,o,r),this.utilService=_,this.fwcDhcpPolicyService=e,this.fwcPolicyGridDhcpRulesFunctionalityService=i,this.messageService=f,this.translate=h,this.translationKeys={ENTITY_NAME:"RULE.RULE",ENTITY_DELETE:"RULE.DELETE_TEXT",DELETE_SUCCESS:"RULE.DELETE_SUCCESS",ENTITY_COLOR:"RULE.COLOR_TEXT"},this.dhcpGroupId=s,this.buildPolicyRules(p)}compileSelectedRoutes(_){throw new Error("Method not implemented.")}getDhcpGroupId(){return this.dhcpGroupId}buildPolicyRules(_){let e=[];Array.isArray(_)&&(e=this.fwcPolicyGridDhcpRulesFunctionalityService.parseDhcpPolicyRules(this.firewallId,this.fwcloudId,_)),this.rules=e}newPolicyRule(_,e){_&&e!==void 0?this.fwcPolicyGridDhcpRulesFunctionalityService.showNewRuleDialog(this.clusterId,this.firewallId,_.id,e):this.fwcPolicyGridDhcpRulesFunctionalityService.showNewRuleDialog(this.clusterId,this.firewallId)}deletePolicyRuleApiCall(_){return this.utilService.fwcAPICall(this.fwcDhcpPolicyService.deleteDhcpPolicyRules.bind(this.fwcDhcpPolicyService),this.firewallId,this.fwcloudId,_)}manageObject(_,e,i,t){this.fwcPolicyGridDhcpRulesFunctionalityService.updateRulePosition(this,this.firewallId,this.fwcloudId,_,e,i,t).catch(()=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.translate.instant("DHCP.POLICY.ERROR_MANAGING_OBJECT")})})}deleteObject(_,e){this.fwcPolicyGridDhcpRulesFunctionalityService.deleteObjectFromPosition(this.firewallId,this.clusterId,this.fwcloudId,_.rule,_,e)}compileSelectedRules(){this.fwcPolicyGridDhcpRulesFunctionalityService.compileSelectedRules()}moveSelectedRules(_,e){this.fwcPolicyGridDhcpRulesFunctionalityService.moveSelectedRules(e.firewall,e.fwcloud,e.pasteOnRuleId,e.rulesIds,e.pasteOffset)}manageSelectedRules(_,e){return this.utilService.fwcAPICall(this.fwcDhcpPolicyService.manageDhcpPolicyRules.bind(this.fwcDhcpPolicyService),this.firewallId,this.fwcloudId,_.pasteOnRuleId,_.pasteOffset,_.rulesIds,e)}setRuleActive(_,e){let i={active:!!e};this.fwcPolicyGridDhcpRulesFunctionalityService.updateSelectedRules(this.clusterId,this.firewallId,this.fwcloudId,i)}setRuleComment(_){this.fwcPolicyGridDhcpRulesFunctionalityService.updateRuleComment(_)}setRuleLeaseTime(_){this.fwcPolicyGridDhcpRulesFunctionalityService.updateRuleLeaseTime(_)}setRuleScript(_){this.fwcPolicyGridDhcpRulesFunctionalityService.updateRuleCfgText(_)}setRuleStyleApiCall(){return this.fwcPolicyGridDhcpRulesFunctionalityService.setRuleStyle.bind(this.fwcPolicyGridDhcpRulesFunctionalityService)}newRuleGroupApiCall(){return this.fwcPolicyGridDhcpRulesFunctionalityService.newDhcpRuleGroup.bind(this.fwcPolicyGridDhcpRulesFunctionalityService)}setRuleGroupStyleApiCall(){return this.fwcPolicyGridDhcpRulesFunctionalityService.setGroupValues.bind(this.fwcPolicyGridDhcpRulesFunctionalityService)}setRuleGroupNameApiCall(){return this.fwcPolicyGridDhcpRulesFunctionalityService.setGroupValues.bind(this.fwcPolicyGridDhcpRulesFunctionalityService)}removeRulesFromGroupApiCall(_){let e={group:null},i=_.rulesIds;return this.utilService.fwcAPICall(this.fwcDhcpPolicyService.updateDhcpPolicyRules.bind(this.fwcDhcpPolicyService),this.firewallId,this.fwcloudId,i,e)}deleteRuleGroupApiCall(_){return this.utilService.fwcAPICall(this.fwcDhcpPolicyService.deleteDhcpPolicyRulesGroup.bind(this.fwcDhcpPolicyService),this.firewallId,this.fwcloudId,_)}};var ii=class extends rt{constructor(_,e,i,t,n,o,r,p,s){super(_,t,n,o,r),this.utilService=_,this.fwcKeepalivedPolicyService=e,this.fwcPolicyGridKeepalivedRulesFunctionalityService=i,this.translationKeys={ENTITY_NAME:"RULE.RULE",ENTITY_DELETE:"RULE.DELETE_TEXT",DELETE_SUCCESS:"RULE.DELETE_SUCCESS",ENTITY_COLOR:"RULE.COLOR_TEXT"},this.keepalivedGroupId=s,this.buildPolicyRules(p)}compileSelectedRoutes(_){throw new Error("Method not implemented.")}getKeepalivedGroupId(){return this.keepalivedGroupId}buildPolicyRules(_){let e=[];Array.isArray(_)&&(e=this.fwcPolicyGridKeepalivedRulesFunctionalityService.parseKeepalivedPolicyRules(this.firewallId,this.fwcloudId,_)),this.rules=e}newPolicyRule(_,e){_&&e!==void 0?this.fwcPolicyGridKeepalivedRulesFunctionalityService.showNewRuleDialog(this.clusterId,this.firewallId,_.id,e):this.fwcPolicyGridKeepalivedRulesFunctionalityService.showNewRuleDialog(this.clusterId,this.firewallId)}deletePolicyRuleApiCall(_){return this.utilService.fwcAPICall(this.fwcKeepalivedPolicyService.deleteKeepalivedPolicyRules.bind(this.fwcKeepalivedPolicyService),this.firewallId,this.fwcloudId,_)}manageObject(_,e,i,t){this.fwcPolicyGridKeepalivedRulesFunctionalityService.updateRulePosition(this,this.firewallId,this.fwcloudId,_,e,i,t)}deleteObject(_,e){this.fwcPolicyGridKeepalivedRulesFunctionalityService.deleteObjectFromPosition(this.firewallId,this.clusterId,this.fwcloudId,_.rule,_,e)}compileSelectedRules(){this.fwcPolicyGridKeepalivedRulesFunctionalityService.compileSelectedRules()}moveSelectedRules(_,e){this.fwcPolicyGridKeepalivedRulesFunctionalityService.moveSelectedRules(e.firewall,e.fwcloud,e.pasteOnRuleId,e.rulesIds,e.pasteOffset)}manageSelectedRules(_,e){return this.utilService.fwcAPICall(this.fwcKeepalivedPolicyService.manageKeepalivedPolicyRules.bind(this.fwcKeepalivedPolicyService),this.firewallId,this.fwcloudId,_.pasteOnRuleId,_.pasteOffset,_.rulesIds,e)}setRuleActive(_,e){let i={active:!!e};this.fwcPolicyGridKeepalivedRulesFunctionalityService.updateSelectedRules(this.clusterId,this.firewallId,this.fwcloudId,i)}setRuleScript(_){this.fwcPolicyGridKeepalivedRulesFunctionalityService.updateRuleCfgText(_)}setRuleComment(_){this.fwcPolicyGridKeepalivedRulesFunctionalityService.updateRuleComment(_)}setRuleStyleApiCall(){return this.fwcPolicyGridKeepalivedRulesFunctionalityService.setRuleStyle.bind(this.fwcPolicyGridKeepalivedRulesFunctionalityService)}newRuleGroupApiCall(){return this.fwcPolicyGridKeepalivedRulesFunctionalityService.newKeepalivedRuleGroup.bind(this.fwcPolicyGridKeepalivedRulesFunctionalityService)}setRuleGroupStyleApiCall(){return this.fwcPolicyGridKeepalivedRulesFunctionalityService.setGroupValues.bind(this.fwcPolicyGridKeepalivedRulesFunctionalityService)}setRuleGroupNameApiCall(){return this.fwcPolicyGridKeepalivedRulesFunctionalityService.setGroupValues.bind(this.fwcPolicyGridKeepalivedRulesFunctionalityService)}removeRulesFromGroupApiCall(_){let e={group:null},i=_.rulesIds;return this.utilService.fwcAPICall(this.fwcKeepalivedPolicyService.updateKeepalivedPolicyRule.bind(this.fwcKeepalivedPolicyService),this.firewallId,this.fwcloudId,i,e)}deleteRuleGroupApiCall(_){return this.utilService.fwcAPICall(this.fwcKeepalivedPolicyService.deleteKeepalivedPolicyRulesGroup.bind(this.fwcKeepalivedPolicyService),this.firewallId,this.fwcloudId,_)}};var ni=class extends rt{constructor(_,e,i,t,n,o,r,p,s){super(_,t,n,o,r),this.utilService=_,this.fwcHAProxyPolicyService=e,this.fwcPolicyGridHAProxyRulesFunctionalityService=i,this.translationKeys={ENTITY_NAME:"RULE.RULE",ENTITY_DELETE:"RULE.DELETE_TEXT",DELETE_SUCCESS:"RULE.DELETE_SUCCESS",ENTITY_COLOR:"RULE.COLOR_TEXT"},this.HAProxyGroupId=s,this.buildPolicyRules(p)}compileSelectedRoutes(_){throw new Error("Method not implemented.")}getHAProxyGroupId(){return this.HAProxyGroupId}buildPolicyRules(_){let e=[];Array.isArray(_)&&(e=this.fwcPolicyGridHAProxyRulesFunctionalityService.parseHAProxyPolicyRules(this.firewallId,this.fwcloudId,_)),this.rules=e}newPolicyRule(_,e){_&&e!==void 0?this.fwcPolicyGridHAProxyRulesFunctionalityService.showNewRuleDialog(this.clusterId,this.firewallId,_.id,e):this.fwcPolicyGridHAProxyRulesFunctionalityService.showNewRuleDialog(this.clusterId,this.firewallId)}deletePolicyRuleApiCall(_){return this.utilService.fwcAPICall(this.fwcHAProxyPolicyService.deleteHAProxyPolicyRules.bind(this.fwcHAProxyPolicyService),this.firewallId,this.fwcloudId,_)}manageObject(_,e,i,t){this.fwcPolicyGridHAProxyRulesFunctionalityService.updateRulePosition(this,this.firewallId,this.fwcloudId,_,e,i,t)}deleteObject(_,e){this.fwcPolicyGridHAProxyRulesFunctionalityService.deleteObjectFromPosition(this.firewallId,this.clusterId,this.fwcloudId,_.rule,_,e)}compileSelectedRules(){this.fwcPolicyGridHAProxyRulesFunctionalityService.compileSelectedRules()}moveSelectedRules(_,e){this.fwcPolicyGridHAProxyRulesFunctionalityService.moveSelectedRules(e.firewall,e.fwcloud,e.pasteOnRuleId,e.rulesIds,e.pasteOffset)}manageSelectedRules(_,e){return this.utilService.fwcAPICall(this.fwcHAProxyPolicyService.manageHAProxyPolicyRules.bind(this.fwcHAProxyPolicyService),this.firewallId,this.fwcloudId,_.pasteOnRuleId,_.pasteOffset,_.rulesIds,e)}setRuleActive(_,e){let i={active:!!e};this.fwcPolicyGridHAProxyRulesFunctionalityService.updateSelectedRules(this.clusterId,this.firewallId,this.fwcloudId,i)}setRuleComment(_){this.fwcPolicyGridHAProxyRulesFunctionalityService.updateRuleComment(_)}setRuleScript(_){this.fwcPolicyGridHAProxyRulesFunctionalityService.updateRuleCfgText(_)}setRuleStyleApiCall(){return this.fwcPolicyGridHAProxyRulesFunctionalityService.setRuleStyle.bind(this.fwcPolicyGridHAProxyRulesFunctionalityService)}newRuleGroupApiCall(){return this.fwcPolicyGridHAProxyRulesFunctionalityService.newHAProxyRuleGroup.bind(this.fwcPolicyGridHAProxyRulesFunctionalityService)}setRuleGroupStyleApiCall(){return this.fwcPolicyGridHAProxyRulesFunctionalityService.setGroupValues.bind(this.fwcPolicyGridHAProxyRulesFunctionalityService)}setRuleGroupNameApiCall(){return this.fwcPolicyGridHAProxyRulesFunctionalityService.setGroupValues.bind(this.fwcPolicyGridHAProxyRulesFunctionalityService)}removeRulesFromGroupApiCall(_){let e={group:null},i=_.rulesIds;return this.utilService.fwcAPICall(this.fwcHAProxyPolicyService.updateHAProxyPolicyRules.bind(this.fwcHAProxyPolicyService),this.firewallId,this.fwcloudId,i,e)}deleteRuleGroupApiCall(_){return this.utilService.fwcAPICall(this.fwcHAProxyPolicyService.deleteHAProxyPolicyRulesGroup.bind(this.fwcHAProxyPolicyService),this.firewallId,this.fwcloudId,_)}};var Pn=(()=>{class l{constructor(e,i,t,n,o,r,p,s,f,h,E,b,I,R,V,G){this.fwcContextMenuService=e,this.fwcErrorPipe=i,this.fwcPolicyService=t,this.fwcFirewallService=n,this.fwcUserService=o,this.itemSelectedService=r,this.ruleSelectedService=p,this.inputDataService=s,this.utilService=f,this.fwcPolicyGridRoutingTableFunctionalityService=h,this.renderer=E,this.cd=b,this.messageService=I,this.confirmationService=R,this.translate=V,this.store=G,this.infoTooltipShown=!1,this.ruleContextMenu=e.getRuleMenus()}setRuleTooltip(e){let i="RULE.RULE_ID";e.type===Ee.ROUTING_TABLE&&(i="ROUTING.ROUTE.ROUTE_ID");let t="<h6>"+this.translate.instant(i)+" <strong>"+e.id+"</strong></h6><ul>";return e.special&&e.special!=tt.HOOKSCRIPT&&(t+='<li><i class="fa fa-fw fa-exclamation-circle fwcOrange"></i> '+this.translate.instant("RULE.RULE_IS_SPECIAL")+"</li>"),e.options&&(t+='<li><i class="fa fa-fw fa-cog fwcBlue"></i> '+this.translate.instant("RULE.RULE_HAS_OPTIONS")+"</li>"),(e.run_before||e.run_after)&&(t+='<li><i class="fa fa-fw fa-file-code fwcOrange"></i> '+this.translate.instant("RULE.RULE_HAS_HOOKS")+"</li>"),e.active||(t+='<li><i class="fa fa-fw fa-times fwcRed"></i> '+this.translate.instant("RULE.RULE_IS_DISABLED")+"</li>"),t+="</ul>",t}selectRule(e,i){if(i&&i.shiftKey){let t,n,o;this.ruleSelectedService.addSelectedRule(e),o=this.ruleSelectedService.getActualSelectedRules();for(let r=0;r<o.length;r++)(o[r].rule_order<t||t==null)&&(t=o[r].rule_order),(o[r].rule_order>t||n==null)&&(n=o[r].rule_order);t&&n&&t!=n&&this.ruleSelectedService.setSelectedRuleRange(t,n)}else i&&i.ctrlKey?(this.ruleSelectedService.isRuleSelected(e.id)?this.ruleSelectedService.removeSelectedRule(e):this.ruleSelectedService.addSelectedRule(e),i.preventDefault()):(this.ruleSelectedService.clearSelectedRules(),this.ruleSelectedService.addSelectedRule(e))}editRule(e){e.type!==Ee.POLICY_ROUTING&&e.type!==Ee.ROUTING_TABLE&&e.special!==tt.HOOKSCRIPT&&e.special!==tt.FAIL2BAN&&this.ruleSelectedService.setRule(e)}getRulePolicyType(e){let i;return Array.isArray(e.positions)&&e.positions.length&&(i=e.positions[0].policy_type),i}onContextMenuLoad(e,i){let t,n,o,r,p,s,f,h=!1,E,b,I=!1,R,V=!1,G,D;switch(e.type){case Ee.ROUTING_TABLE:D=this.ruleContextMenu.ROUTE;break;case Ee.POLICY_ROUTING:D=this.ruleContextMenu.ROUTING_RULE;break;case q[X.DHCP]:case q[X.DHCP_FIXED_IP]:D=this.ruleContextMenu.DHCP_RULE;break;case q[X.KEEPALIVED]:D=this.ruleContextMenu.KEEPALIVED_RULE;break;case q[X.HAPROXY]:D=this.ruleContextMenu.HAPROXY_RULE;break;default:D=this.ruleContextMenu.RULE}this.ruleSelectedService.isRuleSelected(e.id)||(this.ruleSelectedService.clearSelectedRules(),this.ruleSelectedService.addSelectedRule(e)),t=this.ruleSelectedService.getActualSelectedRules(),b=t.some(B=>!!B.special),b&&(I=!t.some(B=>B.special&&B.special!=tt.HOOKSCRIPT)),R=t.some(B=>B.special==tt.CATCHALL),V=t.some(B=>B.special==tt.FAIL2BAN),n=this.ruleSelectedService.getSelectedRulesLength(),o=this.ruleSelectedService.getActualClipboardRulesLength(),s=this.ruleSelectedService.getSelectedRulesGroups(),r=s.length,p=s.indexOf(-1)!=-1,f=this.checkSequentialSelectedRules(),E=this.ruleSelectedService.getActualClipboardRules(),E&&E.action==ne.CUT&&E.rules&&E.rules.length&&(h=E.rules.some(B=>B.id==e.id)),n>1?this.fwcContextMenuService.swapMenuOptions(D,"text","textMulti"):this.fwcContextMenuService.swapMenuOptions(D,"text","textSingle"),this.fwcContextMenuService.setMenuOption(D,U.RULE_COMPILE,"visible",r==1),this.fwcContextMenuService.setMenuOption(D,U.RULE_COLOR_CHANGE,"visible",!b||I),this.fwcContextMenuService.setMenuOption(D,U.RULE_EDIT,"visible",n==1&&!I&&!V),G=r==1&&p&&n>=1,G=G&&f,this.fwcContextMenuService.setMenuOption(D,U.RULE_CREATE_GROUP,"visible",G),G=r==1&&!p,this.fwcContextMenuService.setMenuOption(D,U.RULE_REMOVE_GROUP,"visible",G);let K=this.getSelectedRuleIndex();G=r==1&&!p,G=G&&f,G=G&&(K.groupAbove!=K.firstGroup||K.groupBelow!=K.lastGroup),this.fwcContextMenuService.setMenuOption(D,U.RULE_REMOVE_FROM_GROUP,"visible",G),n==1?(this.fwcContextMenuService.setMenuOption(D,U.RULE_ENABLE,"visible",!e.active&&(!b||I)),this.fwcContextMenuService.setMenuOption(D,U.RULE_DISABLE,"visible",!!e.active&&(!b||I))):(this.fwcContextMenuService.setMenuOption(D,U.RULE_ENABLE,"visible",!0),this.fwcContextMenuService.setMenuOption(D,U.RULE_DISABLE,"visible",!b||I)),this.fwcContextMenuService.setMenuOption(D,U.RULE_DELETE,"visible",r==1&&n>1||n==1&&(!b||I)),G=K.ruleAbove!=-1&&!R,this.fwcContextMenuService.setMenuOption(D,U.RULE_MOVE_ABOVE,"visible",r==1&&G),G&&f&&r==1&&K.firstGroup!=K.groupAbove&&K.groupAbove!=-1&&K.groupAbove!=null?this.fwcContextMenuService.swapMenuOptionText(D,U.RULE_MOVE_ABOVE,"text","textGroup"):this.fwcContextMenuService.swapMenuOptionText(D,U.RULE_MOVE_ABOVE,"text","textNormal"),G=K.ruleBelow!=-1&&!K.ruleBelowCatchAll,this.fwcContextMenuService.setMenuOption(D,U.RULE_MOVE_BELOW,"visible",r==1&&G),G&&f&&r==1&&K.lastGroup!=K.groupBelow&&K.groupBelow!=-1&&K.groupBelow!=null?this.fwcContextMenuService.swapMenuOptionText(D,U.RULE_MOVE_BELOW,"text","textGroup"):this.fwcContextMenuService.swapMenuOptionText(D,U.RULE_MOVE_BELOW,"text","textNormal"),this.fwcContextMenuService.setMenuOption(D,U.COPY,"visible",r==1&&(!b||I)),this.fwcContextMenuService.setMenuOption(D,U.CUT,"visible",r==1&&(!b||I)),this.fwcContextMenuService.setMenuOption(D,U.PASTE_ABOVE,"visible",o>=1&&!h),this.fwcContextMenuService.setMenuOption(D,U.PASTE_BELOW,"visible",o>=1&&!h&&!R),this.fwcContextMenuService.setMenuOption(D,U.RULE_NEW_BELOW,"visible",!R),this.fwcContextMenuService.setMenuOption(D,U.RULE_NEW_HS_BELOW,"visible",!R)}onContextMenuHandler(e,i,t){let n=ot(i);if(t.detail.item){let o=this.ruleSelectedService.getActualSelectedRules(),r=this.ruleSelectedService.getActualClipboardRules();switch(t.detail.item.id){case U.RULE_COMPILE:case U.COMPILE_IPTABLES:case U.COMPILE_NFTABLES:{let p;t.detail.item.id===U.COMPILE_IPTABLES?p=Kt[0].id:t.detail.item.id===U.COMPILE_NFTABLES&&(p=Kt[1].id),e instanceof Ut||e instanceof ni||e instanceof ii?e.compileSelectedRules():e.compileSelectedRoutes(p);break}case U.SYSTEM_COMPILE:e instanceof Ut&&e.compileSelectedRules();case U.RULE_SELECT:case U.RULE_UNSELECT:this.selectRule(i);break;case U.RULE_EDIT:this.editRule(i);break;case U.RULE_ENABLE:case U.RULE_DISABLE:{let p=t.detail.item.id==U.RULE_ENABLE?1:0;e.setRuleActive(i,p);break}case U.RULE_NEW_HS_ABOVE:case U.RULE_NEW_HS_BELOW:case U.RULE_NEW_ABOVE:case U.RULE_NEW_BELOW:{let p=i.type===Ee.POLICY_ROUTING||i.type===Ee.ROUTING_TABLE||i.type===q[X.DHCP]||i.type===q[X.DHCP_FIXED_IP]||i.type===q[X.KEEPALIVED]||i.type===q[X.HAPROXY]?-1:0,s=t.detail.item.id==U.RULE_NEW_ABOVE||t.detail.item.id==U.RULE_NEW_HS_ABOVE?p:1;[q[X.DHCP],q[X.KEEPALIVED],q[X.HAPROXY]].includes(i.type)&&i.special?n.special=[U.RULE_NEW_ABOVE,U.RULE_NEW_BELOW].includes(t.detail.item.id)?tt.HOOKSCRIPT:0:n.special=t.detail.item.id==U.RULE_NEW_HS_ABOVE||t.detail.item.id==U.RULE_NEW_HS_BELOW?tt.HOOKSCRIPT:0,e.newPolicyRule(n,s);break}case U.RULE_DELETE:{this.deleteSelectedRules(e,i,o,t.detail.item.id);break}case U.COPY:this.ruleSelectedService.copyRulesToClipboard();break;case U.CUT:this.ruleSelectedService.cutRulesToClipboard();break;case U.PASTE_ABOVE:case U.PASTE_BELOW:{this.pasteSelectedRules(e,i,r,t.detail.item.id);break}case U.RULE_MOVE_ABOVE:case U.RULE_MOVE_BELOW:{let p;p=this.newRulesData(i,o,t.detail.item.id,ne.CUT),e.moveSelectedRules(i,p);break}case U.RULE_CREATE_GROUP:{let p=e.newRuleGroupApiCall(),s={header:this.translate.instant("RULE.GROUP_TEXT_HEADER"),helpText:this.translate.instant("RULE.GROUP_TEXT"),formControls:[{name:"groupName",label:this.translate.instant("POLICY_GRID.GR_NAME.NAME"),type:"text",required:!0}],onAccept:f=>p(i.firewall,this.fwcUserService.getActualFwSelectedCloud(),f)};e instanceof si&&(s.formControls.push({name:"separator",type:"separator"}),s.formControls.push({name:"groupComment",label:this.translate.instant("ITEM_PANEL.FIELDS.COMMENTS"),type:"text"})),e instanceof Ut&&(s.formControls.push({name:"separator",type:"separator"}),s.formControls.push({name:"groupComment",label:this.translate.instant("ITEM_PANEL.FIELDS.COMMENTS"),type:"text"})),e instanceof ii&&(s.formControls.push({name:"separator",type:"separator"}),s.formControls.push({name:"groupComment",label:this.translate.instant("ITEM_PANEL.FIELDS.COMMENTS"),type:"text"})),e instanceof ni&&(s.formControls.push({name:"separator",type:"separator"}),s.formControls.push({name:"groupComment",label:this.translate.instant("ITEM_PANEL.FIELDS.COMMENTS"),type:"text"})),this.inputDataService.setInputData(s);break}case U.RULE_REMOVE_GROUP:i.idgroup&&this.confirmationService.confirm({header:this.translate.instant("GLOBALS.MSG_CONFIRM"),icon:"fa fa-question-circle fwcBlue iconBig",message:this.translate.instant("POLICY_GRID.GR_DELETE",{name:i.group_name}),rejectVisible:!0,rejectLabel:"No",acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.YES"),accept:()=>{e.deleteRuleGroupApiCall(i.idgroup).then(p=>{this.store.dispatch(me.reloadDialog({dialogUuids:[ee.ITEM_PANEL]}));let s=[];s.push(i),this.policyReload(s)}).catch(p=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(p)})})}});break;case U.RULE_REMOVE_FROM_GROUP:{let p;p=this.newRulesData(i,o,t.detail.item.id,ne.DELETE),e.removeRulesFromGroupApiCall(p).then(s=>{this.store.dispatch(me.reloadDialog({dialogUuids:[ee.ITEM_PANEL]}));let f=[];f.push(i),this.policyReload(f)}).catch(s=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(s)})});break}case U.RULE_COLOR_CHANGE:{let p=this.translate.instant(e.translationKeys.ENTITY_COLOR),s=e.setRuleStyleApiCall(),f={header:this.translate.instant("RULE.COLOR_HEADER"),helpText:p,formControls:[{name:"ruleColor",placeholder:this.translate.instant("RULE.COLOR_PLACEHOLDER"),type:"colorpicker",value:i.style}],onAccept:h=>s(i,h)};e instanceof si&&f.formControls.push({name:"routingTableId",type:"hidden",value:e.getRoutingTableId()}),e instanceof Ut&&f.formControls.push({name:"dhcpGroupId",type:"hidden",value:e.getDhcpGroupId()}),e instanceof ii&&f.formControls.push({name:"keepalivedGroupId",type:"hidden",value:e.getKeepalivedGroupId()}),e instanceof ni&&f.formControls.push({name:"haproxyGroupId",type:"hidden",value:e.getHAProxyGroupId()}),this.inputDataService.setInputData(f);break}case U.NO_MENU:break}}}checkSequentialSelectedRules(){let e=!1,i,t;if(i=this.fwcPolicyService.getActualPolicySequential(),t=this.ruleSelectedService.getActualSelectedRules(),t.length){t.sort(function(n,o){return n.rule_order>o.rule_order?1:n.rule_order<o.rule_order?-1:0});for(let n=0;n<i.length;n++)if(i[n].id==t[0].id){e=!0;for(let o=1;o<t.length&&n+o<i.length;o++)if(i[n+o].id!=t[o].id){e=!1;break}break}}return e}getSelectedRuleIndex(){let e,i,t,n,o,r,p,s;if(i=this.fwcPolicyService.getActualPolicySequential(),t=this.ruleSelectedService.getActualSelectedRules(),t.length){t.sort(function(E,b){return E.rule_order>b.rule_order?1:E.rule_order<b.rule_order?-1:0});let f=t[0],h=t[t.length-1];n=o=r=p=-1;for(let E=0;E<i.length;E++){let b=i[E];if(b.id==f.id)break;n=b.id,r=b.idgroup}for(let E=i.length-1;E>=0;E--){let b=i[E];if(b.id==h.id)break;s=b.special==tt.CATCHALL,o=b.id,p=b.idgroup}e={firstRule:f.id,firstGroup:f.idgroup,lastRule:h.id,lastGroup:h.idgroup,ruleBelow:o,ruleBelowCatchAll:s,groupBelow:p,ruleAbove:n,groupAbove:r}}return e}detectChanges(){this.cd.destroyed||(this.cd.markForCheck(),this.cd.detectChanges())}createNewRule(e,i){this.utilService.fwcAPICall(this.fwcPolicyService.newPolicyRule.bind(this.fwcPolicyService),e).then(t=>{i&&this.updateFirewallStatus(i),this.policyReload(),this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("RULE.CREATED")})}).catch(t=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(t)})})}moveSelectedRules(e,i){let t=this.ruleSelectedService.getActualSelectedRules();this.store.dispatch(Xe.requestBlockUI()),this.utilService.fwcAPICall(this.fwcPolicyService.managePolicyRules.bind(this.fwcPolicyService),i,ne.CUT).then(()=>{this.updateFirewallStatus(e),this.policyReload(t)}).catch(n=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(n)})}).finally(()=>{this.store.dispatch(Xe.requestUnblockUI())})}deleteSelectedRules(e,i,t,n){let o;o=this.newRulesData(i,t,n,ne.DELETE,!0);let r=o&&o.rulesIds.length;if(r){let p=r+" "+this.translate.instant(e.translationKeys.ENTITY_NAME)+(r>1?"s ":""),s=this.translate.instant(e.translationKeys.ENTITY_DELETE,{text:p}),f=this.translate.instant(e.translationKeys.DELETE_SUCCESS);this.confirmationService.confirm({header:this.translate.instant("GLOBALS.MSG_CONFIRM"),icon:"fa fa-question-circle fwcBlue iconBig",message:s,rejectVisible:!0,rejectLabel:"No",acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.YES"),accept:()=>{e.deletePolicyRuleApiCall(o.rulesIds).then(h=>{this.store.dispatch(me.reloadDialog({dialogUuids:[ee.ITEM_PANEL,ee.CLUSTER_PANEL,ee.FIREWALL_PANEL,ee.OVCONFIG_PANEL]})),this.updateFirewallStatus(i),this.policyReload(),this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:f})}).catch(h=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(h)}),this.detectChanges()})}})}}pasteSelectedRules(e,i,t,n){let o=!1;if(t&&t.action==ne.CUT&&t.rules&&t.rules.length&&(o=t.rules.some(r=>{if(r.id==i.id)return!0})),t&&t.rules&&t.rules.length&&!o){let r;r=this.newRulesData(i,t.rules,n,t.action),this.store.dispatch(Xe.requestBlockUI()),e.manageSelectedRules(r,t.action).then(p=>{this.store.dispatch(Xe.requestUnblockUI()),this.store.dispatch(me.reloadDialog({dialogUuids:[ee.ITEM_PANEL]})),this.updateFirewallStatus(i),this.policyReload(t.rules),this.ruleSelectedService.clearClipboardRules()}).catch(p=>{this.store.dispatch(Xe.requestUnblockUI()),this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(p)})})}}newRulesData(e,i,t,n,o){let r={};r.action=n,r.fwcloud=this.fwcUserService.getActualFwcUser().selectedFwCloud,r.firewall=e.firewall,t==U.PASTE_ABOVE||t==U.RULE_MOVE_ABOVE?r.pasteOffset=-1:r.pasteOffset=1,r.pasteOnRuleOrder=e.rule_order+r.pasteOffset;let p=this.ruleSelectedService.getRulesOrderedIds(i,o),s=p.rulesIds,f=p.orderedRules;if(r.idgroup=e.idgroup,t==U.PASTE_ABOVE||t==U.PASTE_BELOW)r.pasteOnRuleId=e.id;else{let h,E,b,I,R;if(t==U.RULE_MOVE_ABOVE?h=0:h=f.length-1,E=f[h].id,I=this.fwcPolicyService.getActualPolicySequential(),Array.isArray(I)||(I=[]),R=I.findIndex(V=>V.id==E),R!=-1){let V=R+r.pasteOffset;(V<0||V>=I.length)&&(V=R),b=I[V].id,I[V].idgroup!==I[R].idgroup&&(r.pasteOffset=0)}else b=E;r.pasteOnRuleId=b}if(r.rulesIds=s,r.rulesIds){let h=this.fwcPolicyService.getActualPolicy();h&&(r.rulesOrder=[],r.rulesIds.forEach(E=>{let b=h.findIndex(I=>I.id==E);r.rulesOrder.push(b+1)}))}return r}getFirewallCompiler(e){return new Promise((i,t)=>{this.utilService.fwcAPICall(this.fwcFirewallService.getFirewall.bind(this.fwcFirewallService),e,this.fwcUserService.getActualFwSelectedCloud()).then(n=>{let p=(n.data.options&61440)>>12;i(p)}).catch(n=>{t(n)})})}compileSelectedRules(e){return Z(this,null,function*(){let i,t,n,o,r,p=this.ruleSelectedService.getActualSelectedRules(),s=this.ruleSelectedService.getRulesOrderedIds(p),f;if(Array.isArray(s.orderedRules)&&s.orderedRules[0]){if(f=s.orderedRules[0],i=this.fwcUserService.getActualFwcUser().customer_id,t=this.fwcUserService.getActualFwcUser().selectedFwCloud,n=f.firewall,o=f.type,r=s.rulesIds,e===void 0)try{e=yield this.getFirewallCompiler(n)}catch(b){this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(b)}),this.ruleSelectedService.setRuleStatus(null);return}let h=Kt.find(b=>b.id===e),E;if(h&&(E=h.name),!i||!t||!n||!o||!Array.isArray(r)||!r.length||!E)return;this.ruleSelectedService.setRuleStatus(""),this.detectChanges(),this.utilService.fwcAPICall(this.fwcPolicyService.getPolicyRulesCompilation.bind(this.fwcPolicyService),n,o,r,this.fwcUserService.getActualFwSelectedCloud(),E).then(b=>{if(Array.isArray(b.data)){let I=this.utilService.createDynamicComponentRef(ei),R=I.instance;R.setDynamicComponentRef(I),R.showCompilationData(b.data,p,this.translate.instant("RULE.RULE"),void 0,E)}}).catch(b=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(b)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}})}setRulesProperty(e,i,t){let n,o=!1,r;if(r={fwcloud:this.fwcUserService.getActualFwSelectedCloud(),firewall:e.firewall,type:e.type},i=="active")n=this.fwcPolicyService.updatePolicyRulesActive.bind(this.fwcPolicyService),o=!0,r.active=t;else if(i=="style")n=this.fwcPolicyService.updatePolicyRulesStyle.bind(this.fwcPolicyService),r.style=t;else return;let p=this.ruleSelectedService.getActualSelectedRules();if(!p)return;let s=this.ruleSelectedService.getRulesOrderedIds(p,!0);s&&(r.rulesIds=s.rulesIds,this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(n,r).then(f=>{o&&this.updateFirewallStatus(e);for(let h=0;h<p.length;h++){let E=p[h];(!E.special||E.special===tt.HOOKSCRIPT)&&(E[i]=t,E=ot(E))}this.ruleSelectedService.setRuleStatus(null),this.cd.detectChanges()}).catch(f=>{this.ruleSelectedService.setRuleStatus(null),this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(f)}),this.cd.detectChanges()}))}newRuleGroup(e,i,t){let n=this.ruleSelectedService.getActualSelectedRules(),o=t?t.groupName:null;if(!(o==null||o=="")){let r={fwcloud:i,firewall:e,name:o,comment:"",rulesIds:[]},p=[],s=n.slice(0);s.sort(function(f,h){return f.rule_order>h.rule_order?1:f.rule_order<h.rule_order?-1:0});for(let f=0;f<s.length;f++)p.push(s[f].id);r.rulesIds=p,this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcPolicyService.newPolicyRulesGroup.bind(this.fwcPolicyService),r).then(f=>{this.store.dispatch(me.reloadDialog({dialogUuids:[ee.ITEM_PANEL]})),this.policyReload(s)}).catch(f=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(f)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null)})}}onSetRuleCustomColor(e,i){i&&this.setRulesProperty(e,"style",i.ruleColor)}updateFirewallStatus(e){this.store.dispatch(ze.updateFwStatus({item:{cluster:e._fwcClusterId,id:e.firewall,status:3}}))}policyReload(e){let i=this.fwcPolicyService.getActualSelectedPolicy(),t=Object.assign({},i);t._forcePolicyReload=!0,e&&(t._selectedRules=e.slice()),this.fwcPolicyService.setSelectedPolicy(t),this.detectChanges()}updateRule(e){let i=!1,t=!1,n=!1,o=!1,r=!1,p=!1,s=!1,f;return new Promise((E,b)=>{e.formModel||b(!1);let I=e.formModel.action,R=e.action,V=e.formModel.comment,G=e.comment,D=e.formModel.fw_apply_to,K=e.fw_apply_to,B=e.formModel.mark,te=e.mark,he=e.formModel.run_before,Ce=e.run_before;f={rule:e.id,idgroup:e.idgroup,firewall:e.firewall,rule_order:e.rule_order,options:e.options,action:e.action,fw_apply_to:e.fw_apply_to,time_start:e.time_start,time_end:e.time_end,comment:e.comment,active:e.active,style:e.style,type:e.type,fwcloud:this.fwcUserService.getActualFwSelectedCloud(),mark:e.mark,run_before:e.run_before},I!=R&&(f.action=I,i=!0),V!=G&&(f.comment=V,n=!0),D!=K&&(f.fw_apply_to=D,t=!0),B!=te&&(f.mark=B,p=!0),he!=Ce&&(f.run_before=he,s=!0),i||n||t||o||r||p||s?(this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcPolicyService.updatePolicyRule.bind(this.fwcPolicyService),f).then(Ge=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("RULE.UPDATED")}),i&&(e.action=I),t&&(e.fw_apply_to=D),p&&(e.mark=B),s&&(e.run_before=he),n&&(e.comment=V),(i||n||t||o||p||s)&&this.updateFirewallStatus(e),E(Ge),this.ruleSelectedService.setRuleStatus(null),this.detectChanges()}).catch(Ge=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(Ge)}),i&&(e.formModel.action=e.action),t&&(e.formModel.fw_apply_to=e.fw_apply_to),n&&(e.formModel.comment=G),s&&(e.formModel.run_before=Ce),E(!1),this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})):E(!0)})}onActionDragEnter(e,i,t){let n=this.itemSelectedService.getDragItem();n&&n._fwcObjType==v.OBJ_MARK&&(this.renderer.addClass(t,"tdActionCell-hovered"),e.labelDraggedOverAction=!0)}onActionDragLeave(e,i,t){i.target==t&&(this.renderer.removeClass(t,"tdActionCell-hovered"),e.labelDraggedOverAction=!1)}onActionDragOver(e){e.preventDefault()}onActionDragDrop(e,i,t){let n=this.itemSelectedService.getDragItem();this.itemSelectedService.clearDragItem(),i.preventDefault();let o=()=>{this.renderer.removeClass(t,"tdActionCell-hovered"),e.labelDraggedOverAction=!1,this.ruleSelectedService.setRuleStatus(null),this.detectChanges()};new Promise((p,s)=>{let f=n&&n._fwcObjType==v.OBJ_MARK&&n.id_obj?n.id_obj:void 0;f&&(f!==e.mark||!e.mark)?(this.ruleSelectedService.setRuleStatus(""),e.formModel.mark=f,this.updateRule(e).then(h=>{e.mark_name=n.text,e.mark=f,p(h)}).catch(h=>s(h))):s(!1)}).then(p=>{o()}).catch(p=>{o()})}onDeleteRuleMark(e){e.mark&&(this.ruleSelectedService.setRuleStatus(""),e.formModel.mark=0,this.updateRule(e).then(i=>{this.ruleSelectedService.setRuleStatus(null),this.store.dispatch(me.reloadDialog({dialogUuids:[ee.ITEM_PANEL]})),this.detectChanges()}).catch(i=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()}))}showMarkInfo(e,i){if(i&&i.preventDefault(),this.itemSelectedService.setObjectInfo(void 0,i),!this.infoTooltipTimer&&!this.infoTooltipShown){let t={objId:e.mark,objType:v.OBJ_MARK,fwId:e.firewall};this.infoTooltipTimer=setTimeout(()=>{this.infoTooltipShown=!0,this.itemSelectedService.setObjectInfo(t,i)},1e3)}}clearMarkInfo(e){e&&e.preventDefault(),this.infoTooltipTimer&&(clearTimeout(this.infoTooltipTimer),this.infoTooltipTimer=void 0),this.infoTooltipShown&&(this.itemSelectedService.setObjectInfo(void 0,e),this.infoTooltipShown=!1)}onCommentFocus(e){e.commentEdit=!0}onCommentBlur(e,i){i.commentEdit=!1,e.setRuleComment(i)}onLeaseTimeFocus(e){e.leaseTimeEdit=!0}onLeaseTimeBlur(e,i){i.leaseTimeEdit=!1,e.setRuleLeaseTime(i)}onScriptFocus(e,i){let t=this.utilService.createDynamicComponentRef(nl),n=t.instance;n.setDynamicComponentRef(t),n.show(e,i)}onSetGroupCustomColor(e){if(e){let i=e.groupData,t=e.group;i.style=e.groupColor,i.groupIds=[i.id],this.updateGroup(t,i,!0)}}onSetGroupName(e){if(e){let i=e.group,t=e.groupData,n=""+e.groupName;i&&t&&n.length&&(t.name=n,this.updateGroup(i,t,!1))}}updateGroup(e,i,t){this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcPolicyService.updatePolicyRulesGroupStyleOrName.bind(this.fwcPolicyService),i,t).then(()=>{if(t){e.group_style=i.style;let n=e.rules;for(let o=0;o<n.length;o++)n[o].group_style=e.group_style}else{e.group_name=i.name;let n=e.rules;for(let o=0;o<n.length;o++)n[o].group_name=e.group_name}e=ot(e)}).catch(n=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(n)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}handleChangeApplyTo(e,i){"setRuleApplyTo"in e&&typeof e.setRuleApplyTo=="function"&&e.setRuleApplyTo(i)}static{this.\u0275fac=function(i){return new(i||l)(N(Oi),N(we),N(de),N(oe),N(se),N(De),N(Fe),N(Ct),N(ue),N(ti),N(Bt),N(ie),N(_e),N(Ie),N(ce),N(pe))}}static{this.\u0275prov=Be({token:l,factory:l.\u0275fac})}}return l})();var El=new Map([["OpenVPN",1],["GeoIP",2],["CrowdSec",4],["NtopNG",8],["Suricata",16],["Keepalived",32],["Zeek",64],["Elasticsearch",128],["Filebeat",256],["WebSafety",512],["Kibana",1024],["Logstash",2048],["DnsSafety",4096],["iscbind9",8192],["iscdhcp",16384]]),Tn=(()=>{class l{constructor(e,i,t,n,o,r,p,s,f,h,E,b,I,R,V){this.fwcContextMenuService=e,this.fwcErrorPipe=i,this.changeDetectorRef=t,this.fwcUserService=n,this.fwcPolicyService=o,this.itemSelectedService=r,this.confirmationService=p,this.utilService=s,this.ruleSelectedService=f,this.fwcPolicyGridRoutingTableFunctionalityService=h,this.store=E,this.renderer=b,this.messageService=I,this.fwcFirewallService=R,this.translate=V,this.subjectDragEnter=new pi,this.alive=!0,this.onDragEnd=()=>{this.resetVisibleRulePositions()},this.positionContextMenu=this.fwcContextMenuService.getPositionMenus(),this.subjectDragEnter.asObservable().pipe(di(20),$(()=>this.alive)).subscribe(G=>{this.doListDragEnter(G)}),typeof navigator<"u"&&/firefox/i.test(navigator.userAgent)&&window.addEventListener("dragend",this.onDragEnd)}ngOnDestroy(){this.alive=!1,typeof this.onDragEnd=="function"&&window.removeEventListener("dragend",this.onDragEnd)}onContextMenuHandler(e,i,t,n,o,r,p,s){this.onItemRightClickEvent(r,i);let f=r.selectedItem;if(f&&(f.rightclicked=!1,this.detectChanges()),s.detail.item){switch(s.detail.item.id){case U.POSITION_NEGATE:case U.POSITION_ALLOW:if(r.ipobjs.length>1){let E=s.detail.item.id==U.POSITION_NEGATE,b={fwcloud:this.fwcUserService.getActualFwSelectedCloud(),firewall:t,rule:o,position:r.id};this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcPolicyService.negatePolicyObject.bind(this.fwcPolicyService),b,E).then(I=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("POSITION.POS_UPDATED")}),this.updateFirewallStatus(t,n),r.negate=E}).catch(I=>{this.ruleSelectedService.setRuleStatus(null),this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(I)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.removeRightClickedClass(),this.detectChanges()})}break;case U.PASTE:let h=this.itemSelectedService.getActualClipboardItem();if(h&&p.indexOf(+h._fwcObjType)!=-1){let E=h._fwcRuleId,b=h._fwcPositionId,I=h.action;if(E!=o||b!=r.id){let R;R=this.checkOperation(t,r,p,h),R?this.confirmationService.confirm({header:"Error",icon:"fa fa-exclamation-circle fwcRed iconBig",message:R,rejectVisible:!1,acceptLabel:"Ok",accept:()=>{}}):e.manageObject(o,r,h,I),f&&(f.id===h.id&&this.removeRightClickedClass(),h&&this.removeRightClickedClass()),this.detectChanges()}}break}if(f)switch(s.detail.item.id){case U.OBJECT_EDIT:f._fwcObjId!=v.OBJ_ANY&&this.itemSelectedService.setItem(f);break;case U.COPY:if(f._fwcObjId!=v.OBJ_ANY){let E=Object.assign({},f);this.itemSelectedService.setClipboardItem(E,ne.COPY)}this.detectChanges();break;case U.CUT:f._fwcObjId!=v.OBJ_ANY&&this.itemSelectedService.setClipboardItem(f,ne.CUT),this.detectChanges();break;case U.DELETE:this.confirmationService.confirm({header:this.translate.instant("GLOBALS.MSG_CONFIRM"),icon:"fa fa-question-circle fwcBlue iconBig",message:this.translate.instant("POSITION.DEL_OBJ",{name:f._fwcObjName}),rejectVisible:!0,rejectLabel:"No",acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.YES"),accept:()=>{e.deleteObject(r,f)}});break;case U.WHERE_USED:let h=Object.assign({},f);h._fwcUserId=this.fwcUserService.getActualFwcUser().user_id,h._fwcCloud=this.fwcUserService.getActualFwcUser().selectedFwCloud,h.whereUsedAction=!0,this.itemSelectedService.setItem(h);break}}this.onContextMenuClose(r),this.detectChanges()}deleteObjectFromPosition(e,i,t,n,o){let r,p={fwcloud:this.fwcUserService.getActualFwSelectedCloud(),firewall:e,rule:t,ipobj:-1,ipobj_g:-1,interface:-1,position:n.id,position_order:void 0},s=0;for(let f=0;f<n.ipobjs.length&&!(n.ipobjs[f]._fwcObjId==o._fwcObjId&&n.ipobjs[f]._fwcObjType==o._fwcObjType);f++)n.ipobjs[f]._fwcObjId!=v.OBJ_ANY&&s++;switch(p.position_order=s+1,n.content){case"I":p.interface=o._fwcObjId,r=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_INTERFACE_FIREWALL"),delete p.ipobj,delete p.ipobj_g;break;case"O":default:o._fwcObjType==v.OBJ_VPN_CONFIG_CLI?(p.openvpn=o._fwcObjId,r=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_OPENVPN_CONFIG")):o._fwcObjType==v.OBJ_OPENVPN_PREFIX&&(p.prefix=o._fwcObjId,r=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_PREFIX")),o._fwcObjType==v.OBJ_INTERFACE_FIREWALL||o._fwcObjType==v.OBJ_INTERFACE_HOST?(p.interface=o._fwcObjId,r=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_INTERFACE_FIREWALL")):o._fwcObjType==v.OBJ_GROUP||o._fwcObjType==v.OBJ_SERVICE_GROUP||o._fwcObjType==v.OBJ_CONTINENT?(p.ipobj_g=o._fwcObjId,r=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_GROUP")):(p.ipobj=o._fwcObjId,r=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_GEN_IP_OBJECT")),(o._fwcObjType==v.OBJ_VPN_CONFIG_CLI||o._fwcObjType==v.OBJ_OPENVPN_PREFIX)&&(delete p.ipobj,delete p.ipobj_g,delete p.interface);break}this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcPolicyService.deletePolicyObject.bind(this.fwcPolicyService),p,n.content).then(f=>{this.removeItem(n,o),this.updateFirewallStatus(e,i);let h=this.itemSelectedService.getActualClipboardItem();h&&h._fwcObjId===o.id&&h._fwcPositionId===o._fwcPositionId&&this.itemSelectedService.clearClipboardItem(),this.store.dispatch(me.reloadDialog({dialogUuids:[ee.ITEM_PANEL,ee.CLUSTER_PANEL,ee.FIREWALL_PANEL,ee.OVCONFIG_PANEL]})),this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:r+this.translate.instant("POSITION.OBJ_DELETED")})}).catch(f=>{let h=this.fwcErrorPipe.transform(f);this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(f)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}onContextMenuLoad(e,i,t,n,o){let r=!1,p=!1,s,f,h,E=!1,b,I;this.clearObjectInfo(void 0);let R=this.positionContextMenu.POSITION,V=this.itemSelectedService.getActualClipboardItem();o.detail.event&&o.detail.event.target&&!o.detail.event.target.getAttribute("data-obj_id")&&(r=!0,t.selectedItem=void 0);let G=document.querySelectorAll(".divFwcPosition-item");G&&G.forEach(K=>{K.classList.remove("item-rightclicked")});let D=o.detail.event.target;if(D&&D.getAttribute("data-obj_id")&&D.classList.add("item-rightclicked"),this.listenForOutsideClicks(t),h=t.id==14||t.id==16||t.id==34||t.id==35,(t.selectedItem&&t.selectedItem._fwcObjType==v.OBJ_ANY||t.ipobjs.length<=1||r)&&(p=!0),f=V&&V._fwcRuleId==i&&V._fwcPositionId==t.id,s=V&&n.indexOf(+V._fwcObjType)!=-1,b=e===Ee.POLICY_ROUTING||e===Ee.ROUTING_TABLE,I=[q[X.DHCP_FIXED_IP],q[X.DHCP],q[X.KEEPALIVED],q[X.HAPROXY]].includes(e),R&&R.items){for(let K=0;K<R.items.length;K++){let B=R.items[K];B.id==U.POSITION_NEGATE&&(B.visible=!h&&!I&&!b&&!t.negate&&t.ipobjs.length>1),B.id==U.POSITION_ALLOW&&(B.visible=!!(!h&&t.negate&&t.ipobjs.length>1)),(B.id==U.OBJECT_EDIT||B.id==U.COPY||B.id==U.CUT||B.id==U.DELETE||B.id==U.WHERE_USED||B.id==U.SEPARATOR)&&(B.visible=t.id===Me.MASTER_NODE&&B.id===U.WHERE_USED?!1:!p),B.id==U.PASTE&&(B.visible=!!(V&&s&&!f)),(B.id==U.DELETE||B.id==U.CUT)&&(B.visible=t.id!==ai.GATEWAY_POSITION&&(t.id!==Pi.FROM_POSITION||t.ipobjs.length>2)?!p:!1),B.visible&&(E=!0)}!V&&p&&t.ipobjs.length<=1||!E?o.detail.cancel=!0:t.selectedItem&&(t.selectedItem.rightclicked=!0)}t.selectedItem&&t.selectedItem.rightclicked&&(t.selectedItem.rightclicked=!1),this.detectChanges()}onContextMenuClose(e){e.selectedItem&&(e.selectedItem.rightclicked=!1),this.detectChanges()}listenForOutsideClicks(e){let i=t=>{let n=document.querySelector(".iui-contextmenu"),o=n&&n.contains(t.target),r=t.target.closest(".divFwcPosition-item");!o&&!r&&(this.removeRightClickedClass(),document.removeEventListener("click",i))};document.addEventListener("click",i)}removeRightClickedClass(){document.querySelectorAll(".divFwcPosition-item").forEach(i=>{i.classList.remove("item-rightclicked")})}onListDragOver(e){e.preventDefault()}onListDragEnter(e,i,t,n,o){let r;if(i.draggedOver=!0,n.target==o&&(r=this.itemSelectedService.getDragItem(),r.srcPositionUID!=i.positionUID&&r)){let p={draggedItem:r,firewallId:e,fwcPosition:i,fwcPositionEl:o,typesPositions:t};this.doListDragEnter(p)}}doListDragEnter(e){let{firewallId:i,draggedItem:t,typesPositions:n,fwcPosition:o,fwcPositionEl:r}=e,p=+t._fwcObjType;if(!n){o.objectAllowed=!1;return}n.indexOf(p)==-1||o.ipobjs&&o.ipobjs.some(function(s){return t._fwcObjId==s._fwcObjId&&t._fwcObjType==s._fwcObjType})||o.content=="I"&&p==v.OBJ_INTERFACE_FIREWALL&&t._fwcFwId!=i?o.objectAllowed=!1:o.objectAllowed=!0,this.detectChanges()}onListDragLeave(e,i,t){e.target==t&&(i.draggedOver=!1,i.objectAllowed=void 0,this.resetVisibleRulePositions(),this.detectChanges())}onListDragDrop(e,i,t,n,o,r){let p,s,f=e.getFirewallId(),h=e.getClusterId();if(o.preventDefault(),t.draggedOver=!1,t.objectAllowed=void 0,s=this.itemSelectedService.getDragItem(),s&&(s._fwcPositionId!=t.id||s._fwcRuleId!=i))if(p=this.checkOperation(f,t,n,s),p)this.confirmationService.confirm({header:this.translate.instant("POSITION.ERROR_HEADER"),icon:"fa fa-exclamation-circle fwcRed iconBig",message:p,rejectVisible:!1,acceptLabel:"Ok",accept:()=>{}});else if(h&&(s.obj_type==24||s.obj_type==23))this.fwcFirewallService.getCluster.bind(this.fwcFirewallService)(h,this.fwcUserService.getActualFwSelectedCloud()).subscribe(b=>{let I=b.data;if(I.nodes.find(R=>R.install_communication=="agent")&&!(I.plugins&El.get("GeoIP")))this.confirmationService.confirm({header:this.translate.instant("FW.PLUGINS.GEOIP_NOT_ACTIVATED_HEADER"),icon:"fa fa-exclamation-triangle fwcOrange iconBig",message:this.translate.instant("FW.PLUGINS.GEOIP_NOT_ACTIVATED_CLUSTER",{cluster:I.name}),rejectVisible:!0,acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.YES"),rejectLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.NO"),reject:()=>{},accept:()=>{if(s.container&&(s.container=void 0,s.containerReadOnly=!1,s._fwcObjType===v.OBJ_ADDRESS)){let R=/^(.+)\s+\((.+)\)$/.exec(s.text);R&&(s._fwcObjName=R[1])}e.manageObject(i,t,s)}});else{if(s.container&&(s.container=void 0,s.containerReadOnly=!1,s._fwcObjType===v.OBJ_ADDRESS)){let R=/^(.+)\s+\((.+)\)$/.exec(s.text);R&&(s._fwcObjName=R[1])}e.manageObject(i,t,s)}});else if(f&&(s.obj_type==24||s.obj_type==23))this.fwcFirewallService.getFirewall.bind(this.fwcFirewallService)(f,this.fwcUserService.getActualFwSelectedCloud()).subscribe(b=>{let I=b.data;if(!(I.plugins&El.get("GeoIP"))&&I.install_communication=="agent")this.confirmationService.confirm({header:this.translate.instant("FW.PLUGINS.GEOIP_NOT_ACTIVATED_HEADER"),icon:"fa fa-exclamation-triangle fwcOrange iconBig",message:this.translate.instant("FW.PLUGINS.GEOIP_NOT_ACTIVATED_FIREWALL",{firewall:I.name}),rejectVisible:!0,acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.YES"),rejectLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.NO"),reject:()=>{},accept:()=>{if(s.container&&(s.container=void 0,s.containerReadOnly=!1,s._fwcObjType===v.OBJ_ADDRESS)){let R=/^(.+)\s+\((.+)\)$/.exec(s.text);R&&(s._fwcObjName=R[1])}e.manageObject(i,t,s)}});else{if(s.container&&(s.container=void 0,s.containerReadOnly=!1,s._fwcObjType===v.OBJ_ADDRESS)){let R=/^(.+)\s+\((.+)\)$/.exec(s.text);R&&(s._fwcObjName=R[1])}e.manageObject(i,t,s)}});else{if(s.container&&(s.container=void 0,s.containerReadOnly=!1,s._fwcObjType===v.OBJ_ADDRESS)){let E=/^(.+)\s+\((.+)\)$/.exec(s.text);E&&(s._fwcObjName=E[1])}e.manageObject(i,t,s)}this.itemSelectedService.clearDragItem(),this.resetVisibleRulePositions()}resetVisibleRulePositions(){typeof navigator<"u"&&/firefox/i.test(navigator.userAgent)&&this.fwcPolicyService.getActualPolicy().filter(e=>e.visible===!0).forEach(e=>{e.positions.forEach(i=>{i.draggedOver=!1,i.objectAllowed=void 0;let t=document.getElementById(`position-${i.id}`);t&&(this.renderer.removeClass(t,"fwcObjectAllowed"),this.renderer.removeClass(t,"fwcObjectForbidden"),this.renderer.removeClass(t,"draggedOver"))})})}onItemRightClickEvent(e,i){e.selectedItem=i}onItemClickEvent(e,i){if(e.selectedItem=i,this.clearObjectInfo(void 0),i._fwcObjId!=v.OBJ_ANY){let t={_fwcObjId:i._fwcObjId,_fwcObjType:i._fwcObjType,highlighted:!i.highlighted};this.itemSelectedService.setModifiedItem(t,!1,!1,!1,!0)}}onItemDblClickEvent(e,i){e.selectedItem=i;let t=Object.assign({},i);t&&t._fwcObjId!=v.OBJ_ANY&&(t.editPrefixAction=t._fwcObjType==v.OBJ_OPENVPN_PREFIX,this.itemSelectedService.setItem(t))}onMarkDblClickEvent(e){let i={id:e,fwcloud:this.fwcUserService.getActualFwSelectedCloud(),_fwcObjId:e,_fwcObjType:v.OBJ_MARK};this.itemSelectedService.setItem(i)}itemDragStart(e,i,t){let n;t.stopPropagation(),e.selectedItem=i,n=Object.assign({},i),n.srcPositionUID=e.positionUID,this.itemSelectedService.setDragItem(n),t.dataTransfer.setData("dragItemId",n.id.toString()),t.dataTransfer.dropEffect="move",t.dataTransfer.effectAllowed="copyMove",this.clearObjectInfo(void 0)}showObjectInfo(e,i){if(e&&(i&&i.preventDefault(),e&&!this.infoTooltipTimer&&!this.infoTooltipShown)){let t={objId:e._fwcObjId,objType:e._fwcObjType,fwId:e._fwcFwId,clusterId:e._fwcClusterId,objParentId:e.parent_id};t.objId!==null&&t.objType!==null&&t.objType!=v.OBJ_ANY&&(this.infoTooltipTimer=setTimeout(()=>{this.infoTooltipShown=!0,this.itemSelectedService.setObjectInfo(t,i)},1e3))}}clearObjectInfo(e){e&&e.preventDefault(),this.infoTooltipTimer&&(clearTimeout(this.infoTooltipTimer),this.infoTooltipTimer=void 0),this.infoTooltipShown&&(setTimeout(()=>{this.itemSelectedService.setObjectInfo(void 0,e)},500),this.infoTooltipShown=!1)}manageObject(e,i,t,n,o,r){let p=Object.assign({},o),s,f,h=o._fwcObjId,E=o._fwcObjType,b=o._fwcPositionId,I=o._fwcRuleId,R=n.id,V=t,G=o.position_order,D=this.fwcPolicyService.getActualSelectedPolicy()._fwcPolicyIPVersion;if(f=this.translate.instant("POSITION.ERROR_EMPTY_CONTAINER",{name:o._fwcObjName,ipVersion:D}),r)o.position_order=n.ipobjs.length;else{let B=0;for(let te=0;te<n.ipobjs.length&&!(n.ipobjs[te]._fwcObjId==h&&n.ipobjs[te]._fwcObjType==E);te++)n.ipobjs[te]._fwcObjId!=v.OBJ_ANY&&B++;o.position_order=B+1}o._fwcPositionId=o.position=n.id,o._fwcRuleId=o.rule=t,o.ipobj=void 0,o.ipobj_g=void 0,o.interface=void 0,o.container=void 0,o.ipobj=o.ipobj_g=o.interface=-1;let K={fwcloud:this.fwcUserService.getActualFwSelectedCloud(),firewall:e,rule:o.rule,position:o.position,position_order:o.position_order};if(o._fwcObjType==v.OBJ_VPN_CONFIG_CLI)K.openvpn=o._fwcObjId,s=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_OPENVPN_CONFIG");else if(o._fwcObjType==v.OBJ_OPENVPN_PREFIX)K.prefix=o._fwcObjId,s=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_PREFIX"),f=this.translate.instant("POSITION.ERROR_EMPTY_PREFIX",{name:o._fwcObjName});else switch(K.ipobj=o.ipobj,K.ipobj_g=o.ipobj_g,K.interface=o.interface,n.content){case"I":K.interface=o.interface=o._fwcObjId,s="Interface",delete K.ipobj,delete K.ipobj_g;break;case"O":default:o._fwcObjType==v.OBJ_INTERFACE_FIREWALL||o._fwcObjType==v.OBJ_INTERFACE_HOST?(K.interface=o.interface=o._fwcObjId,s=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_INTERFACE_FIREWALL")):o._fwcObjType==v.OBJ_GROUP||o._fwcObjType==v.OBJ_SERVICE_GROUP||o._fwcObjType==v.OBJ_CONTINENT?(K.ipobj_g=o.ipobj_g=o._fwcObjId,s=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_GROUP")):(K.ipobj=o.ipobj=o._fwcObjId,s=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_GEN_IP_OBJECT"));break}if(b==null||I==null||r==ne.COPY)this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcPolicyService.newPolicyObject.bind(this.fwcPolicyService),K,n.content).then(B=>{this.updateFirewallStatus(e,i),this.store.dispatch(me.reloadDialog({dialogUuids:[ee.ITEM_PANEL]})),n.ipobjs.push(o),this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:s+this.translate.instant("POSITION.OBJ_ADDED")}),this.ruleSelectedService.setRuleStatus(null),this.ruleSelectedService.setRuleHeightRecalculate(t),this.detectChanges()}).catch(B=>{let te;B.error&&B.error.fwcErr==1003?te=this.translate.instant("POSITION.ERROR_DUP"):B.error&&B.error.fwcErr==5001?te=f:this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(B)}),te&&this.confirmationService.confirm({header:this.translate.instant("POSITION.ERROR_HEADER"),icon:"fa fa-exclamation-circle fwcRed iconBig",message:te,rejectVisible:!1,acceptLabel:"Ok",accept:()=>{}}),this.ruleSelectedService.setRuleStatus(null),this.detectChanges()});else{let B={fwcloud:this.fwcUserService.getActualFwSelectedCloud(),firewall:e,rule:I,position:b,position_order:G,new_rule:V,new_position:R,new_order:o.position_order};n.content=="O"?o._fwcObjType==v.OBJ_VPN_CONFIG_CLI?B.openvpn=o._fwcObjId:o._fwcObjType==v.OBJ_OPENVPN_PREFIX?B.prefix=o._fwcObjId:(B.ipobj=o.ipobj,B.ipobj_g=o.ipobj_g,B.interface=o.interface):B.interface=o.interface,this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcPolicyService.updatePolicyObject.bind(this.fwcPolicyService),B,n.content).then(te=>{n.ipobjs.push(o),o.srcRuleId=I,o.srcPositionId=b,this.itemSelectedService.setModifiedItem(o,!0),r&&this.itemSelectedService.clearClipboardItem(),this.updateFirewallStatus(e,i),this.store.dispatch(me.reloadDialog({dialogUuids:[ee.ITEM_PANEL]})),this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:s+this.translate.instant("POSITION.OBJ_ADDED")}),this.ruleSelectedService.setRuleHeightRecalculate(I),this.ruleSelectedService.setRuleHeightRecalculate(V)}).catch(te=>{te.error&&te.error.respCode=="ACR_ALREADY_EXISTS"?this.confirmationService.confirm({header:this.translate.instant("POSITION.ERROR_HEADER"),icon:"fa fa-exclamation-circle fwcRed iconBig",message:this.translate.instant("POSITION.ERROR_DUP"),rejectVisible:!1,acceptLabel:"Ok",accept:()=>{}}):this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(te)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}}removeItem(e,i){let t=-1;if(!e.ipobjs)return-1;for(let n=0;n<e.ipobjs.length;n++)if(e.ipobjs[n]._fwcObjId!=v.OBJ_ANY&&e.ipobjs[n]._fwcObjId==i._fwcObjId){t=n;break}return t>=0&&e.ipobjs.splice(t,1),e.ipobjs.length<=1&&(e.negate=!1),t}updateFirewallStatus(e,i){this.store.dispatch(ze.updateFwStatus({item:{cluster:i,id:e,status:3}}))}checkOperation(e,i,t,n){let o,r=+n._fwcObjType,p=this.translate.instant("GLOBALS.DB_OBJECT_NAMES."+r),s=n.items&&n.items.length,h=(E=>{let b=!1,I=[];for(I.push(E);I.length&&!b;){let R=I.pop();b=R._fwcObjType==v.OBJ_ADDRESS,!b&&R.items&&R.items.length&&I.push(...R.items)}return b})(n);return t.indexOf(r)==-1?o=this.translate.instant("POSITION.ERROR_NOTALLOWED"):i.ipobjs&&i.ipobjs.some(function(E){return n._fwcObjId==E._fwcObjId&&n._fwcObjType==E._fwcObjType})?o=this.translate.instant("POSITION.ERROR_EXISTS",{name:n._fwcObjName}):i.content=="I"&&r==v.OBJ_INTERFACE_FIREWALL&&n._fwcFwId!=e?o=this.translate.instant("POSITION.ERROR_IF"):i.policy_type!==Ee.ROUTING_TABLE&&i.single_object&&i.ipobjs&&i.ipobjs.length>=2?o=this.translate.instant("POSITION.ERROR_ONLY1"):i.policy_type===Ee.ROUTING_TABLE&&i.id===ai.INTERFACE_POSITION&&n._fwcObjType===v.OBJ_INTERFACE_HOST&&(o=this.translate.instant("POSITION.ERROR_HOST_IF_IN_ROUTE")),o}removeItemAt(e,i){return e.ipobjs?(i>=0&&i<e.ipobjs.length&&e.ipobjs.splice(i,1),e.ipobjs.length<=1&&(e.negate=!1),i):-1}detectChanges(){this.changeDetectorRef.destroyed||this.changeDetectorRef.detectChanges()}static{this.\u0275fac=function(i){return new(i||l)(N(Oi),N(we),N(ie),N(se),N(de),N(De),N(Ie),N(ue),N(Fe),N(ti),N(pe),N(Bt),N(_e),N(oe),N(ce))}}static{this.\u0275prov=Be({token:l,factory:l.\u0275fac})}}return l})();var On=class extends rt{constructor(_,e,i,t,n,o,r,p){super(_,t,n,o,r),this.utilService=_,this.fwcRoutingPolicyService=e,this.fwcPolicyGridRoutingRulesFunctionalityService=i,this.translationKeys={ENTITY_NAME:"RULE.RULE",ENTITY_DELETE:"RULE.DELETE_TEXT",DELETE_SUCCESS:"RULE.DELETE_SUCCESS",ENTITY_COLOR:"RULE.COLOR_TEXT"},this.buildPolicyRules(p)}buildPolicyRules(_){let e=[];Array.isArray(_)&&(e=this.fwcPolicyGridRoutingRulesFunctionalityService.parseRoutingPolicyRules(this.firewallId,this.fwcloudId,_)),this.rules=e}convertPolicyRuleToRoutingRule(_){let e=[];if(Array.isArray(_.positions)&&_.positions.length){let t=_.positions.find(n=>n.id===Pi.FROM_POSITION);if(t&&Array.isArray(t.ipobjs))for(let n of t.ipobjs)n._fwcObjType!==v.OBJ_ANY&&e.push({id:n.id,name:n.name,type:n.type,firewall_id:n.firewall_id,cluster_id:n.cluster_id,cluster_name:n.cluster_name,position_order:n.position_order})}return{id:_.id,routingTableId:_.routingTableId,routingGroupId:_.idgroup,comment:_.comment,style:_.style,rule_order:_.rule_order,active:!!_.active,items:e}}newPolicyRule(_,e){_&&e!==void 0?this.fwcPolicyGridRoutingRulesFunctionalityService.showNewRuleDialog(this.clusterId,this.firewallId,_.id,e):this.fwcPolicyGridRoutingRulesFunctionalityService.showNewRuleDialog(this.clusterId,this.firewallId)}updateRule(_){let e=_.formModel.comment,i=_.formModel.style,t=_.formModel.active,n=this.convertPolicyRuleToRoutingRule(_);this.fwcPolicyGridRoutingRulesFunctionalityService.updateRule(this.clusterId,this.firewallId,this.fwcloudId,n,e,i,!!t)}deletePolicyRuleApiCall(_){return this.utilService.fwcAPICall(this.fwcRoutingPolicyService.deleteRoutingPolicyRules.bind(this.fwcRoutingPolicyService),this.firewallId,this.fwcloudId,_)}manageObject(_,e,i,t){this.fwcPolicyGridRoutingRulesFunctionalityService.updateRulePosition(this,this.firewallId,this.fwcloudId,_,e,i,t)}deleteObject(_,e){this.fwcPolicyGridRoutingRulesFunctionalityService.deleteObjectFromPosition(this.firewallId,this.clusterId,this.fwcloudId,_.rule,_,e)}compileSelectedRoutes(){this.fwcPolicyGridRoutingRulesFunctionalityService.compileSelectedRules()}moveSelectedRules(_,e){this.fwcPolicyGridRoutingRulesFunctionalityService.moveSelectedRules(e.firewall,e.fwcloud,e.pasteOnRuleId,e.rulesIds,e.pasteOffset)}manageSelectedRules(_,e){return this.utilService.fwcAPICall(this.fwcRoutingPolicyService.manageRoutingPolicyRules.bind(this.fwcRoutingPolicyService),this.firewallId,this.fwcloudId,_.pasteOnRuleId,_.pasteOffset,_.rulesIds,e)}setRuleActive(_,e){let i={active:!!e};this.fwcPolicyGridRoutingRulesFunctionalityService.updateSelectedRules(this.clusterId,this.firewallId,this.fwcloudId,i)}setRuleComment(_){this.fwcPolicyGridRoutingRulesFunctionalityService.updateRuleComment(_)}setRuleApplyTo(_){this.fwcPolicyGridRoutingRulesFunctionalityService.handleChangeApplyToTable(_)}setRuleScript(_){}setRuleStyleApiCall(){return this.fwcPolicyGridRoutingRulesFunctionalityService.setRuleStyle.bind(this.fwcPolicyGridRoutingRulesFunctionalityService)}newRuleGroupApiCall(){return this.fwcPolicyGridRoutingRulesFunctionalityService.newRoutingRuleGroup.bind(this.fwcPolicyGridRoutingRulesFunctionalityService)}setRuleGroupStyleApiCall(){return this.fwcPolicyGridRoutingRulesFunctionalityService.setGroupValues.bind(this.fwcPolicyGridRoutingRulesFunctionalityService)}setRuleGroupNameApiCall(){return this.fwcPolicyGridRoutingRulesFunctionalityService.setGroupValues.bind(this.fwcPolicyGridRoutingRulesFunctionalityService)}removeRulesFromGroupApiCall(_){let e={routingGroupId:null},i=_.rulesIds;return this.utilService.fwcAPICall(this.fwcRoutingPolicyService.updateRoutingPolicyRules.bind(this.fwcRoutingPolicyService),this.firewallId,this.fwcloudId,i,e)}deleteRuleGroupApiCall(_){return this.utilService.fwcAPICall(this.fwcRoutingPolicyService.deleteRoutingPolicyRulesGroup.bind(this.fwcRoutingPolicyService),this.firewallId,this.fwcloudId,_)}};var Rn=class extends rt{constructor(_,e,i,t,n,o,r,p,s){super(_,n,o,r,p),this.utilService=_,this.fwcPolicyService=e,this.fwcPositionFunctionalityService=i,this.fwcRuleFunctionalityService=t,this.translationKeys={ENTITY_NAME:"RULE.RULE",ENTITY_DELETE:"RULE.DELETE_TEXT",DELETE_SUCCESS:"RULE.DELETE_SUCCESS",ENTITY_COLOR:"RULE.COLOR_TEXT"},this.buildPolicyRules(s)}buildPolicyRules(_){this.rules=_||[]}newPolicyRule(_,e){let i;_&&e!==void 0?i={id:void 0,idgroup:_.idgroup,firewall:_.firewall,rule_order:_.rule_order+e,action:_.action,time_start:void 0,time_end:void 0,active:1,options:0,comment:"",type:_.type,style:_.group_style,fwcloud:this.fwcloudId,special:_.special?_.special:0}:i={id:void 0,idgroup:null,firewall:this.firewallId,rule_order:1,action:Lo.FWACTION_ACCEPT,time_start:void 0,time_end:void 0,active:1,options:0,comment:"",type:this.policyType,fwcloud:this.fwcloudId},this.fwcRuleFunctionalityService.createNewRule(i,_)}deletePolicyRuleApiCall(_){return this.utilService.fwcAPICall(this.fwcPolicyService.deletePolicyRules.bind(this.fwcPolicyService),this.firewallId,_,this.fwcloudId)}manageObject(_,e,i,t){this.fwcPositionFunctionalityService.manageObject(this.firewallId,this.clusterId,_,e,i,t)}deleteObject(_,e){this.fwcPositionFunctionalityService.deleteObjectFromPosition(this.firewallId,this.clusterId,_.rule,_,e)}compileSelectedRoutes(_){this.fwcRuleFunctionalityService.compileSelectedRules(_)}moveSelectedRules(_,e){this.fwcRuleFunctionalityService.moveSelectedRules(_,e)}manageSelectedRules(_,e){return this.utilService.fwcAPICall(this.fwcPolicyService.managePolicyRules.bind(this.fwcPolicyService),_,e)}setRuleActive(_,e){this.fwcRuleFunctionalityService.setRulesProperty(_,"active",e)}setRuleComment(_){this.fwcRuleFunctionalityService.updateRule(_)}setRuleScript(_){this.fwcRuleFunctionalityService.updateRule(_)}setRuleStyleApiCall(){return this.fwcRuleFunctionalityService.onSetRuleCustomColor.bind(this.fwcRuleFunctionalityService)}newRuleGroupApiCall(){return this.fwcRuleFunctionalityService.newRuleGroup.bind(this.fwcRuleFunctionalityService)}setRuleGroupStyleApiCall(){return this.fwcRuleFunctionalityService.onSetGroupCustomColor.bind(this.fwcRuleFunctionalityService)}setRuleGroupNameApiCall(){return this.fwcRuleFunctionalityService.onSetGroupName.bind(this.fwcRuleFunctionalityService)}removeRulesFromGroupApiCall(_){return this.utilService.fwcAPICall(this.fwcPolicyService.deletePolicyRulesGroupRuleFromGroup.bind(this.fwcPolicyService),_)}deleteRuleGroupApiCall(_){return this.utilService.fwcAPICall(this.fwcPolicyService.deletePolicyRulesGroup.bind(this.fwcPolicyService),this.firewallId,_,this.fwcloudId)}setRuleApplyTo(_){this.fwcRuleFunctionalityService.updateRule(_)}};var vl=(()=>{class l{constructor(e,i,t,n,o,r,p,s,f,h,E,b){this.translate=e,this.fwcErrorPipe=i,this.utilService=t,this.fwcUserService=n,this.fwcFirewallService=o,this.fwcPolicyService=r,this.fwcDhcpPolicyService=p,this.ruleSelectedService=s,this.messageService=f,this.confirmationService=h,this.cd=E,this.store=b}setGroupValues(e){if(e){let i=e.groupData,t=e.group,n=e.policyType,o={style:e.groupColor,name:e.groupName};this.updateGroup(n,i.firewall,i.fwcloud,t,o)}}updateGroup(e,i,t,n,o){let r;(e===q[X.DHCP]||e===q[X.DHCP_FIXED_IP])&&(r=this.fwcDhcpPolicyService.updateDhcpPolicyRuleGroup.bind(this.fwcDhcpPolicyService)),r&&(this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(r,i,t,n.idgroup,o).then(()=>{if(o.name){n.group_name=o.name;let p=n.rules;for(let s=0;s<p.length;s++)p[s].group_name=n.group_name}if(o.style){n.group_style=o.style;let p=n.rules;for(let s=0;s<p.length;s++)p[s].group_style=n.group_style}n=ot(n)}).catch(p=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(p)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()}))}compileRules(e){let i,t,n,o=this.ruleSelectedService.getActualSelectedRules(),r=this.ruleSelectedService.getRulesOrderedIds(o),p;if(Array.isArray(r.orderedRules)&&r.orderedRules[0]){p=r.orderedRules[0],i=this.fwcUserService.getActualFwcUser().selectedFwCloud,t=p.firewall,n=r.rulesIds;let s=this.fwcDhcpPolicyService.compileDhcpPolicyRules.bind(this.fwcDhcpPolicyService),f=[t,i,n],h=this.translate.instant("DHCP.NEW_RULE_PANEL.RULE"),E=this.translate.instant("DHCP.POLICY.COMPILE_DIALOG_TITLE");e&&(s=this.fwcDhcpPolicyService.compileDhcpPolicyRules.bind(this.fwcDhcpPolicyService),f=[t,i,e,n],h=this.translate.instant("DHCP.NEW_RULE_PANEL.RULE"),E=this.translate.instant("DHCP.RULE.COMPILE_DIALOG_TITLE")),this.ruleSelectedService.setRuleStatus(""),this.detectChanges(),this.utilService.fwcAPICall(s,...f).then(b=>{if(Array.isArray(b.data)){let I=this.utilService.createDynamicComponentRef(ei),R=I.instance;R.setDynamicComponentRef(I),R.showCompilationData(b.data,o,h,E,void 0,void 0)}}).catch(b=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(b)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}}filterIpObjects(e,i){let t=[];return Array.isArray(e)&&(t=e.filter(i).map(n=>({id:n.id,order:n.position_order}))),t}buildCopyApiData(e,i){let t={},n,o,r=e._fwcObjId,p=e._fwcObjType,s=i.ipobjs;switch(p){case v.OBJ_NETWORK:n=this.filterIpObjects(s,f=>f._fwcObjType===v.OBJ_NETWORK)[0],o="networkId";break;case v.OBJ_ADDRESS_RANGE:n=this.filterIpObjects(s,f=>f._fwcObjType===v.OBJ_ADDRESS_RANGE)[0],o="rangeId";break;case v.OBJ_ADDRESS:if(i.id===xe.DNS){n=this.filterIpObjects(s,f=>f._fwcObjType===v.OBJ_ADDRESS),o="ipObjIds";break}else{n=this.filterIpObjects(s,f=>f._fwcObjType===v.OBJ_ADDRESS)[0],o="routerId";break}case v.OBJ_INTERFACE_HOST:case v.OBJ_INTERFACE_FIREWALL:n=this.filterIpObjects(s,f=>f._fwcObjType===v.OBJ_INTERFACE_FIREWALL||f._fwcObjType===v.OBJ_INTERFACE_HOST)[0],o="interfaceId";break}return t[o]=Array.isArray(n)?[...n,{id:r,order:s?s.length:1}]:r,n&&!Array.isArray(n)&&this.buildRemoveApiData(n,i),t}buildRemoveApiData(e,i){let t={},n,o,r=e._fwcObjId,p=i.ipobjs;switch(e._fwcObjType){case v.OBJ_NETWORK:return this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.ERROR"),detail:this.translate.instant("GLOBALS.MSG_OBJ_DELETE.NETWORK")}),e;case v.OBJ_ADDRESS_RANGE:return this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.ERROR"),detail:this.translate.instant("GLOBALS.MSG_OBJ_DELETE.RANGE")}),e;case v.OBJ_ADDRESS:if(i.id===xe.DNS){n=this.filterIpObjects(p,f=>f._fwcObjType===v.OBJ_ADDRESS&&f._fwcObjId!==r),o="ipObjIds";break}else return this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.ERROR"),detail:this.translate.instant("GLOBALS.MSG_OBJ_DELETE.ROUTER")}),e;case v.OBJ_INTERFACE_HOST:case v.OBJ_INTERFACE_FIREWALL:return this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.ERROR"),detail:this.translate.instant("GLOBALS.MSG_OBJ_DELETE.INTERFACE")}),e}return t[o]=Array.isArray(n)?[...n]:n,t}removeObjectFromPosition(e,i){if(Array.isArray(e.ipobjs)){e.ipobjs=e.ipobjs.filter(t=>t._fwcObjId!==i._fwcObjId||t._fwcObjType!==i._fwcObjType);for(let t of e.ipobjs)t.position_order!=null&&t.position_order>i.position_order&&t.position_order--}}dispatchFwStatusUpdateAction(e,i){this.store.dispatch(ze.updateFwStatus({item:{cluster:e,id:i,status:3}}))}dispatchReloadItemPanelAction(){this.store.dispatch(me.reloadDialog({dialogUuids:[ee.ITEM_PANEL]}))}dispatchReloadItemEditingPanels(){this.store.dispatch(me.reloadDialog({dialogUuids:[ee.ITEM_PANEL,ee.CLUSTER_PANEL,ee.FIREWALL_PANEL,ee.OVCONFIG_PANEL]}))}detectChanges(){this.cd.destroyed||(this.cd.markForCheck(),this.cd.detectChanges())}static{this.\u0275fac=function(i){return new(i||l)(N(ce),N(we),N(ue),N(se),N(oe),N(de),N($t),N(Fe),N(_e),N(Ie),N(ie),N(pe))}}static{this.\u0275prov=Be({token:l,factory:l.\u0275fac,providedIn:"root"})}}return l})();var xn=(()=>{class l extends vl{constructor(e,i,t,n,o,r,p,s,f,h,E,b,I){super(e,i,t,n,o,r,s,f,h,E,b,I),this.translate=e,this.fwcErrorPipe=i,this.utilService=t,this.fwcUserService=n,this.fwcFirewallService=o,this.fwcPolicyService=r,this.fwcInterfaceService=p,this.fwcDhcpPolicyService=s,this.ruleSelectedService=f,this.messageService=h,this.confirmationService=E,this.cd=b,this.store=I}parseDhcpPolicyRules(e,i,t){let n=[];for(let o of t){o.group&&(o.dhcpGroup=o.group);let r=o.rule_type;o.rule_type=o.rule_type==2?q[X.DHCP_FIXED_IP]:q[X.DHCP];let p={id:o.id,idgroup:o.group&&o.dhcpGroup.id,group_name:o.group&&o.dhcpGroup.name,group_style:o.group&&o.dhcpGroup.style,comment:o.comment,style:o.style,type:o.rule_type,max_lease:r===1?o.max_lease:null,cfg_text:r===3?o.cfg_text:null,special:r===3?6:null,rule_order:o.rule_order,active:o.active?1:0,firewall:e,fwcloud:i,positions:[]},s=1;if(p.type===q[X.DHCP]){let f={id:xe.NETWORK,rule:o.id,ipobjs:[],content:"O",name:this.translate.instant("POLICY_GRID.RULES.DHCP_NETWORK"),policy_type:o.rule_type,position_order:s++,single_object:0,fwcloud:i,firewall:e};if(o.network){let I={rule:o.id,position:xe.NETWORK,id:o.network.id,name:o.network.name,type:o.network.ipObjTypeId,position_order:1,firewall_id:e,cluster_id:o._fwcClusterId};f.ipobjs.push(I)}let h={id:xe.RANGE,rule:o.id,ipobjs:[],content:"O",name:this.translate.instant("POLICY_GRID.RULES.RANGE"),policy_type:o.rule_type,position_order:s++,single_object:0,fwcloud:i,firewall:e};if(o.range){let I={rule:o.id,position:xe.RANGE,id:o.range.id,name:o.range.name,type:o.range.ipObjTypeId,position_order:1,firewall_id:e,cluster_id:o._fwcClusterId};h.ipobjs.push(I)}let E={id:xe.ROUTER,rule:o.id,ipobjs:[],content:"O",name:this.translate.instant("POLICY_GRID.RULES.ROUTER"),policy_type:o.rule_type,position_order:s++,single_object:0,fwcloud:i,firewall:e};if(o.router){let I={rule:o.id,position:xe.ROUTER,id:o.router.id,name:o.router.name,type:o.router.ipObjTypeId,position_order:1,firewall_id:o.router.interface&&o.router.interface.firewall?o.router.interface.firewall.id:null,firewall_name:o.router.interface&&o.router.interface.firewall?o.router.interface.firewall.name:null,cluster_id:o.router.interface&&o.router.interface.firewall&&o.router.interface.firewall.cluster?o.router.interface.firewall.cluster.id:null,cluster_name:o.router.interface&&o.router.interface.firewall&&o.router.interface.firewall.cluster?o.router.interface.firewall.cluster.name:null,host_id:o.router.interface&&o.router.interface.hosts&&o.router.interface.hosts.length>0&&o.router.interface.hosts[0].hostIPObj?o.router.interface.hosts[0].hostIPObj.id:null,host_name:o.router.interface&&o.router.interface.hosts&&o.router.interface.hosts.length>0&&o.router.interface.hosts[0].hostIPObj?o.router.interface.hosts[0].hostIPObj.name:null};E.ipobjs.push(I)}let b={id:xe.DNS,rule:o.id,ipobjs:[],content:"O",name:this.translate.instant("POLICY_GRID.RULES.SERVERS"),policy_type:o.rule_type,position_order:s++,single_object:0,fwcloud:i,firewall:e};if(Array.isArray(o.items)){let I=1;for(let R of o.items){let V={rule:o.id,position:xe.DNS,id:R.id,name:R.name,type:R.type,position_order:I++,firewall_id:R.firewall_id?R.firewall_id:null,firewall_name:R.firewall_name?R.firewall_name:null,cluster_id:R.cluster_id?R.cluster_id:null,cluster_name:R.cluster_name?R.cluster_name:null,host_id:R.host_id?R.host_id:null,host_name:R.host_name?R.host_name:null};b.ipobjs.push(V)}}p.positions.push(f,h,E,b)}if(p.type===q[X.DHCP_FIXED_IP]){let f={id:xe.INTERFACE,rule:o.id,ipobjs:[],content:"O",name:this.translate.instant("POLICY_GRID.RULES.INTERFACE"),policy_type:o.rule_type,position_order:s++,single_object:0,fwcloud:i,firewall:e};if(o.interface){let E={rule:o.id,position:xe.INTERFACE,id:o.interface.id,name:o.interface.name,type:o.interface.type,mac:o.interface.mac,position_order:1,firewall_id:o.interface.firewall?o.interface.firewall.id:null,firewall_name:o.interface.firewall?o.interface.firewall.name:null,cluster_id:o.interface.firewall&&o.interface.firewall.cluster?o.interface.firewall.cluster.id:null,cluster_name:o.interface.firewall&&o.interface.firewall.cluster?o.interface.firewall.cluster.name:null,fwcloud:i,host_id:o.interface.hosts&&o.interface.hosts.length>0&&o.interface.hosts[0].hostIPObj?o.interface.hosts[0].hostIPObj.id:null,host_name:o.interface.hosts&&o.interface.hosts.length>0&&o.interface.hosts[0].hostIPObj?o.interface.hosts[0].hostIPObj.name:null};E.mac&&f.ipobjs.push(E)}let h={id:xe.IP,rule:o.id,ipobjs:[],content:"O",name:this.translate.instant("POLICY_GRID.RULES.IP"),policy_type:o.rule_type,position_order:s++,single_object:0,fwcloud:i,firewall:e};if(o.router){let E={rule:o.id,position:xe.IP,id:o.router.id,name:o.router.name,type:o.router.ipObjTypeId,position_order:1,firewall_id:o.router.interface&&o.router.interface.firewall?o.router.interface.firewall.id:null,firewall_name:o.router.interface&&o.router.interface.firewall?o.router.interface.firewall.name:null,cluster_id:o.router.interface&&o.router.interface.firewall&&o.router.interface.firewall.cluster?o.router.interface.firewall.cluster.id:null,cluster_name:o.router.interface&&o.router.interface.firewall&&o.router.interface.firewall.cluster?o.router.interface.firewall.cluster.name:null,host_id:o.router.interface&&o.router.interface.hosts&&o.router.interface.hosts.length>0&&o.router.interface.hosts[0].hostIPObj?o.router.interface.hosts[0].hostIPObj.id:null,host_name:o.router.interface&&o.router.interface.hosts&&o.router.interface.hosts.length>0&&o.router.interface.hosts[0].hostIPObj?o.router.interface.hosts[0].hostIPObj.name:null};h.ipobjs.push(E)}p.positions.push(f,h)}n.push(p)}return n}updateSelectedRules(e,i,t,n){let o=this.ruleSelectedService.getActualSelectedRules(),r=!!Object.keys(n).filter(p=>p!=="style").length;if(Array.isArray(o)&&o.length){let p=o.map(s=>s.id);this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcDhcpPolicyService.updateDhcpPolicyRules.bind(this.fwcDhcpPolicyService),i,t,p,n).then(()=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("DHCP.SUCCESS.UPDATE_RULE")}),this.fwcPolicyService.reloadPolicy(),r&&this.dispatchFwStatusUpdateAction(e,i)}).catch(s=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(s)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null)})}}updateRuleComment(e){if(e&&e.formModel){let i=e.formModel.comment;if(e.comment!==i){let t=e.firewall,n=e.fwcloud,o={comment:i};this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcDhcpPolicyService.updateDhcpPolicyRule.bind(this.fwcDhcpPolicyService),t,n,e.id,o).then(()=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("ROUTING.SUCCESS.UPDATE_RULE")}),e.comment=i,this.dispatchFwStatusUpdateAction(e._fwcClusterId,t)}).catch(r=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(r)}),e.formModel.comment=e.comment}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}}}updateRuleCfgText(e){if(e&&e.formModel){let i=e.formModel.cfg_text;if(e.cfg_text!==i){let t=e.firewall,n=e.fwcloud,o={cfg_text:i};this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcDhcpPolicyService.updateDhcpPolicyRule.bind(this.fwcDhcpPolicyService),t,n,e.id,o).then(()=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("ROUTING.SUCCESS.UPDATE_RULE")}),e.cfg_text=i,this.dispatchFwStatusUpdateAction(e._fwcClusterId,t)}).catch(r=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(r)}),e.formModel.cfg_text=e.cfg_text}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}}}updateRuleLeaseTime(e){if(e&&e.formModel){let i=e.formModel.max_lease;if(e.max_lease!==i){let t=e.firewall,n=e.fwcloud,o={max_lease:i};this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcDhcpPolicyService.updateDhcpPolicyRule.bind(this.fwcDhcpPolicyService),t,n,e.id,o).then(()=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("ROUTING.SUCCESS.UPDATE_RULE")}),e.max_lease=i,this.dispatchFwStatusUpdateAction(e._fwcClusterId,t)}).catch(r=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(r)}),e.formModel.max_lease=e.max_lease}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}}}setRuleStyle(e,i){if(i){let t={style:i.ruleColor};this.updateSelectedRules(e._fwcClusterId,e.firewall,this.fwcUserService.getActualFwSelectedCloud(),t)}}updateRulePosition(e,i,t,n,o,r,p){return Z(this,null,function*(){let s={},f=r._fwcPositionId,h=r._fwcRuleId,E=this.checkOperation(e,r,p);if(E)this.confirmationService.confirm({header:this.translate.instant("POSITION.ERROR_HEADER"),icon:"fa fa-exclamation-circle fwcRed iconBig",message:E,rejectVisible:!1,acceptLabel:"Ok",accept:()=>{}});else{let b=e.getClusterId();if(r&&(r.obj_type===v.OBJ_INTERFACE_FIREWALL||r.obj_type===v.OBJ_INTERFACE_HOST)){let I=yield this.fwcInterfaceService.getInterface.bind(this.fwcInterfaceService)(i,r.id_obj,r.fwcloud).toPromise();try{if(I.data&&(I.data.mac===null||I.data.mac===void 0||I.data.mac==="")){this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.translate.instant("DHCP.POLICY.ERROR_EMPTY_MAC")});return}}catch{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.translate.instant("DHCP.POLICY.ERROR_GET_INTERFACE")})}}f==null||h==null||p==ne.COPY?(s=this.buildCopyApiData(r,o),this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcDhcpPolicyService.updateDhcpPolicyRule.bind(this.fwcDhcpPolicyService),i,t,n,s).then(()=>{this.addObjectToPosition(o,r),this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("DHCP.SUCCESS.UPDATE_RULE")}),this.dispatchFwStatusUpdateAction(b,i),this.dispatchReloadItemEditingPanels(),this.ruleSelectedService.setRuleHeightRecalculate(n)}).catch(I=>{I&&typeof I.error=="string"&&I.status===500&&(I.error==="IP version mismatch"?this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.translate.instant("ITEM_PANEL.ERRORS.INVALID_IP_VERSION.TEXT")}):I.error==="Interface mac is not defined"?this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.translate.instant("DHCP.POLICY.ERROR_EMPTY_MAC")}):this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(I)}))}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})):(this.ruleSelectedService.setRuleStatus(""),this.moveObject(e,i,t,n,o,r).then(()=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("DHCP.SUCCESS.UPDATE_RULE")})}).catch(I=>{I&&typeof I.error=="string"&&I.status===500&&(I.error==="IP version mismatch"?this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.translate.instant("ITEM_PANEL.ERRORS.INVALID_IP_VERSION.TEXT")}):I.error==="Interface mac is not defined"?this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.translate.instant("DHCP.POLICY.ERROR_EMPTY_MAC")}):this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(I)}))}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()}))}})}checkOperation(e,i,t){let n;return i._fwcRuleId&&i._fwcPositionId&&(t===ne.CUT||t===ne.DELETE)&&e.getPolicyRule(i._fwcRuleId).positions.find(s=>s.id===i._fwcPositionId).ipobjs.filter(s=>s._fwcObjType!==v.OBJ_ANY).length<2&&(n=this.translate.instant("DHCP.POLICY.ERROR_LAST_IPOBJECT")),n}moveObject(e,i,t,n,o,r){return Z(this,null,function*(){try{let p,s;switch(r._fwcObjType){case v.OBJ_GROUP:{p="ipObjGroupId";break}case v.OBJ_MARK:{p="markId";break}default:{p="ipObjId";break}}let f=e.getPolicyRule(r._fwcRuleId),h=f.positions.find(b=>b.id===r._fwcPositionId);if(r._fwcPositionId!==xe.DNS)return Promise.reject(this.translate.instant("DHCP.POLICY.ERROR_MOVING_POSITION"));s={fromId:f.id,toId:n},s[p]=r._fwcObjId,yield this.utilService.fwcAPICall(this.fwcDhcpPolicyService.moveObjectBetweenPositions.bind(this.fwcDhcpPolicyService),i,t,s),this.addObjectToPosition(o,r),this.removeObjectFromPosition(h,r),this.dispatchReloadItemEditingPanels(),this.ruleSelectedService.setRuleHeightRecalculate(f.id),this.ruleSelectedService.setRuleHeightRecalculate(n);let E=e.getClusterId();this.dispatchFwStatusUpdateAction(E,i),Promise.resolve()}catch{Promise.reject()}})}deleteObjectFromPosition(e,i,t,n,o,r){let p={};p=this.buildRemoveApiData(r,o),p!==r&&(this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcDhcpPolicyService.updateDhcpPolicyRule.bind(this.fwcDhcpPolicyService),e,t,n,p).then(()=>{this.removeObjectFromPosition(o,r),this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("DHCP.SUCCESS.UPDATE_RULE")}),this.dispatchFwStatusUpdateAction(i,e),this.dispatchReloadItemEditingPanels(),this.ruleSelectedService.setRuleHeightRecalculate(n)}).catch(s=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(s)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()}))}addObjectToPosition(e,i){let t={cluster_id:i._fwcClusterId,cluster_name:i._fwcClusterName,firewall_id:i._fwcFwId,firewall_name:i._fwcFwName,host_id:i._fwcHostId,host_name:i._fwcHostName,id:i._fwcObjId,id_obj:i._fwcObjId,name:i._fwcObjName,obj_type:i._fwcObjType,parent_id:i.parent_id,position:e.id,position_order:e.ipobjs?e.ipobjs.length:1,rule:e.rule,type:i._fwcObjType,_fwcFwId:i._fwcFwId,_fwcFwName:i._fwcFwName,_fwcObjId:i._fwcObjId,_fwcObjName:i._fwcObjName,_fwcObjType:i._fwcObjType,_fwcPositionId:e.id,_fwcRuleId:e.rule,_fwcUserId:this.fwcUserService.getActualFwcUser().user_id,highlighted:i.highlighted};e.id!==xe.DNS&&e.id!==xe.INTERFACE?e.ipobjs=[...e.ipobjs.filter(n=>n.obj_type!==t.obj_type),t]:e.id!==xe.DNS&&e.id===xe.INTERFACE?e.ipobjs=[...e.ipobjs.filter(n=>n.obj_type!==v.OBJ_INTERFACE_FIREWALL&&n.obj_type!==v.OBJ_INTERFACE_HOST),t]:e.ipobjs=[...e.ipobjs,t]}showNewRuleDialog(e,i,t,n,o,r,p){let s=this.utilService.createDynamicComponentRef(ol),f=s.instance;f.setDynamicComponentRef(s),f.showNewRuleDialog(e,i,t,n)}moveSelectedRules(e,i,t,n,o){this.store.dispatch(Xe.requestBlockUI()),this.utilService.fwcAPICall(this.fwcDhcpPolicyService.manageDhcpPolicyRules.bind(this.fwcDhcpPolicyService),e,i,t,o,n,ne.CUT).then(()=>{this.fwcPolicyService.reloadPolicy()}).catch(()=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.translate.instant("GLOBALS.MSG_OP_RESULT.PROCESS_ERROR")})}).finally(()=>{this.store.dispatch(Xe.requestUnblockUI())})}newDhcpRuleGroup(e,i,t){let n=t&&t.groupName,o=t&&t.groupComment;if(n){let p=this.ruleSelectedService.getActualSelectedRules().map(s=>s.id);this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcDhcpPolicyService.newDhcpPolicyRuleGroup.bind(this.fwcDhcpPolicyService),e,i,n,o,p).then(()=>{this.dispatchReloadItemPanelAction(),this.fwcPolicyService.reloadPolicy()}).catch(s=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(s)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}else return}compileSelectedRules(){this.compileRules()}static{this.\u0275fac=function(i){return new(i||l)(N(ce),N(we),N(ue),N(se),N(oe),N(de),N(We),N($t),N(Fe),N(_e),N(Ie),N(ie),N(pe))}}static{this.\u0275prov=Be({token:l,factory:l.\u0275fac,providedIn:"root"})}}return l})();var bl=(()=>{class l{constructor(e,i,t,n,o,r,p,s,f,h){this.translate=e,this.fwcErrorPipe=i,this.utilService=t,this.fwcUserService=n,this.fwcPolicyService=o,this.fwcKeepalivedPolicyService=r,this.ruleSelectedService=p,this.messageService=s,this.cd=f,this.store=h}setGroupValues(e){if(e){let i=e.groupData,t=e.group,n=e.policyType,o={style:e.groupColor,name:e.groupName};this.updateGroup(n,i.firewall,i.fwcloud,t,o)}}updateGroup(e,i,t,n,o){let r;e===q[X.KEEPALIVED]&&(r=this.fwcKeepalivedPolicyService.updateKeepalivedPolicyRuleGroup.bind(this.fwcKeepalivedPolicyService)),r&&(this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(r,i,t,n.idgroup,o).then(()=>{if(o.name){n.group_name=o.name;let p=n.rules;for(let s=0;s<p.length;s++)p[s].group_name=n.group_name}if(o.style){n.group_style=o.style;let p=n.rules;for(let s=0;s<p.length;s++)p[s].group_style=n.group_style}n=ot(n)}).catch(p=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(p)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()}))}compileRules(e){let i,t,n,o=this.ruleSelectedService.getActualSelectedRules(),r=this.ruleSelectedService.getRulesOrderedIds(o),p;if(Array.isArray(r.orderedRules)&&r.orderedRules[0]){p=r.orderedRules[0],i=this.fwcUserService.getActualFwcUser().selectedFwCloud,t=p.firewall,n=r.rulesIds;let s=this.fwcKeepalivedPolicyService.compileKeepalivedPolicyRules.bind(this.fwcKeepalivedPolicyService),f=[t,i,n],h=this.translate.instant("KEEPALIVED.POLICY.RULE"),E=this.translate.instant("KEEPALIVED.POLICY.COMPILE_DIALOG_TITLE");e&&(s=this.fwcKeepalivedPolicyService.compileKeepalivedPolicyRules.bind(this.fwcKeepalivedPolicyService),f=[t,i,e,n],h=this.translate.instant("KEEPALIVED.NEW_RULE_PANEL.RULE"),E=this.translate.instant("KEEPALIVED.RULE.COMPILE_DIALOG_TITLE")),this.ruleSelectedService.setRuleStatus(""),this.detectChanges(),this.utilService.fwcAPICall(s,...f).then(b=>{if(Array.isArray(b.data)){let I=this.utilService.createDynamicComponentRef(ei),R=I.instance;R.setDynamicComponentRef(I),R.showCompilationData(b.data,o,h,E,void 0,void 0)}}).catch(b=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(b)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}}filterIpObjects(e,i){let t=[];return Array.isArray(e)&&(t=e.filter(i).map(n=>({id:n.id,order:n.position_order}))),t}buildCopyApiData(e,i){let t={},n,o,r=e._fwcObjId,p=e._fwcObjType,s=i.ipobjs;switch(p){case v.OBJ_INTERFACE_FIREWALL:n=this.filterIpObjects(s,f=>f._fwcObjType===v.OBJ_INTERFACE_FIREWALL)[0],o="interfaceId";break;case v.OBJ_ADDRESS:n=this.filterIpObjects(s,f=>f._fwcObjType===v.OBJ_ADDRESS),o="virtualIpsIds";break;case v.OBJ_FIREWALL:n=this.filterIpObjects(s,f=>f._fwcObjType===v.OBJ_FIREWALL)[0],o="masterNodeId";break}return t[o]=p===v.OBJ_ADDRESS?[...(Array.isArray(n)?n:[n]).filter(f=>f.id!==r),{id:r,order:s?s.length:1}]:r,n&&this.buildRemoveApiData(Array.isArray(n)?n[0]:n,i),t}buildRemoveApiData(e,i){let t={},n,o,r=i.ipobjs,p=e._fwcObjId,s=e._fwcObjType;switch(s===void 0&&i.ipobjs[0]._fwcObjType===v.OBJ_INTERFACE_FIREWALL&&(s=i.ipobjs[0]._fwcObjType,p=i.ipobjs[0]._fwcObjId),s){case v.OBJ_INTERFACE_FIREWALL:return this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.translate.instant("KEEPALIVED.POLICY.ERROR_INTERFACE_DELETE")}),e;case v.OBJ_ADDRESS:n=this.filterIpObjects(r,f=>f._fwcObjType===v.OBJ_ADDRESS&&f._fwcObjId!==p)[0],o="virtualIpsIds";break;case v.OBJ_FIREWALL:return this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.translate.instant("KEEPALIVED.POLICY.ERROR_MASTERNODE_DELETE")}),e}return t[o]=Array.isArray(n)?[...n]:n,t}removeObjectFromPosition(e,i){if(Array.isArray(e.ipobjs)){e.ipobjs=e.ipobjs.filter(t=>t._fwcObjId!==i._fwcObjId||t._fwcObjType!==i._fwcObjType);for(let t of e.ipobjs)t.position_order!=null&&t.position_order>i.position_order&&t.position_order--}}dispatchFwStatusUpdateAction(e,i){this.store.dispatch(ze.updateFwStatus({item:{cluster:e,id:i,status:3}}))}dispatchReloadItemPanelAction(){this.store.dispatch(me.reloadDialog({dialogUuids:[ee.ITEM_PANEL]}))}dispatchReloadItemEditingPanels(){this.store.dispatch(me.reloadDialog({dialogUuids:[ee.ITEM_PANEL,ee.CLUSTER_PANEL,ee.FIREWALL_PANEL,ee.OVCONFIG_PANEL]}))}detectChanges(){this.cd.destroyed||(this.cd.markForCheck(),this.cd.detectChanges())}static{this.\u0275fac=function(i){return new(i||l)(N(ce),N(we),N(ue),N(se),N(de),N(Gi),N(Fe),N(_e),N(ie),N(pe))}}static{this.\u0275prov=Be({token:l,factory:l.\u0275fac,providedIn:"root"})}}return l})();var Fn=(()=>{class l extends bl{constructor(e,i,t,n,o,r,p,s,f,h,E,b){super(e,i,t,n,o,r,s,f,E,b),this.translate=e,this.fwcErrorPipe=i,this.utilService=t,this.fwcUserService=n,this.fwcPolicyService=o,this.fwcKeepalivedPolicyService=r,this.fwcInterfaceService=p,this.ruleSelectedService=s,this.messageService=f,this.confirmationService=h,this.cd=E,this.store=b}parseKeepalivedPolicyRules(e,i,t){let n=[];for(let o of t){o.group&&(o.keepalivedGroup=o.group);let r=o.rule_type,p={id:o.id,idgroup:o.group&&o.keepalivedGroup.id,group_name:o.group&&o.keepalivedGroup.name,group_style:o.group&&o.keepalivedGroup.style,comment:o.comment,style:o.style,type:q[X.KEEPALIVED],cfg_text:r===2?o.cfg_text:null,special:r===2?6:null,rule_order:o.rule_order,active:o.active?1:0,firewall:e,fwcloud:i,positions:[]},s=1,f={id:Me.INTERFACE,rule:o.id,ipobjs:[],content:"O",name:this.translate.instant("POLICY_GRID.RULES.INTERFACE"),policy_type:p.type,position_order:s++,single_object:0,fwcloud:i,firewall:e};if(o.interface){let b={rule:o.id,position:Me.INTERFACE,id:o.interface.id,name:o.interface.name,type:o.interface.type,position_order:1,firewall_id:o.interface.firewall?o.interface.firewall.id:null,firewall_name:o.interface.firewall?o.interface.firewall.name:null,cluster_id:o.interface.firewall&&o.interface.firewall.cluster?o.interface.firewall.cluster.id:null,cluster_name:o.interface.firewall&&o.interface.firewall.cluster?o.interface.firewall.cluster.name:null,fwcloud:i};f.ipobjs.push(b)}let h={id:Me.VIRTUAL_IPS,rule:o.id,ipobjs:[],content:"O",name:this.translate.instant("POLICY_GRID.RULES.VIRTUAL_IPS"),policy_type:p.type,position_order:s++,single_object:0,fwcloud:i,firewall:e};if(Array.isArray(o.items))for(let I of o.items){let R={rule:o.id,position:Me.VIRTUAL_IPS,id:I.id,name:I.name,type:I.type,position_order:1,firewall_id:I.firewall_id?I.firewall_id:null,firewall_name:I.firewall_name?I.firewall_name:null,cluster_id:I.cluster_id?I.cluster_id:null,cluster_name:I.cluster_name?I.cluster_name:null,host_id:I.host_id?I.host_id:null,host_name:I.host_name?I.host_name:null};h.ipobjs.push(R)}let E={id:Me.MASTER_NODE,rule:o.id,ipobjs:[],content:"O",name:this.translate.instant("POLICY_GRID.RULES.MASTER_NODE"),policy_type:p.type,position_order:s++,single_object:0,fwcloud:i,firewall:e};if(o.masterNode){let b={rule:o.id,position:Me.MASTER_NODE,id:o.masterNode.id,name:o.masterNode.name,type:v.OBJ_FIREWALL,position_order:1};E.ipobjs.push(b)}p.positions.push(f,h,E),n.push(p)}return n}updateSelectedRules(e,i,t,n){let o=this.ruleSelectedService.getActualSelectedRules(),r=!!Object.keys(n).filter(p=>p!=="style").length;if(Array.isArray(o)&&o.length){let p=o.map(s=>s.id);this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcKeepalivedPolicyService.updateKeepalivedPolicyRules.bind(this.fwcKeepalivedPolicyService),i,t,p,n).then(()=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("KEEPALIVED.SUCCESS.UPDATE_RULE")}),this.fwcPolicyService.reloadPolicy(),r&&this.dispatchFwStatusUpdateAction(e,i)}).catch(s=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(s)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null)})}}updateRuleCfgText(e){if(e&&e.formModel){let i=e.formModel.cfg_text;if(e.cfg_text!==i){let t=e.firewall,n=e.fwcloud,o={cfg_text:i};this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcKeepalivedPolicyService.updateKeepalivedPolicyRule.bind(this.fwcKeepalivedPolicyService),t,n,e.id,o).then(()=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("ROUTING.SUCCESS.UPDATE_RULE")}),e.cfg_text=i,this.dispatchFwStatusUpdateAction(e._fwcClusterId,t)}).catch(r=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(r)}),e.formModel.cfg_text=e.cfg_text}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}}}updateRuleComment(e){if(e&&e.formModel){let i=e.formModel.comment;if(e.comment!==i){let t=e.firewall,n=e.fwcloud,o={comment:i};this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcKeepalivedPolicyService.updateKeepalivedPolicyRule.bind(this.fwcKeepalivedPolicyService),t,n,e.id,o).then(()=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("ROUTING.SUCCESS.UPDATE_RULE")}),e.comment=i,this.dispatchFwStatusUpdateAction(e._fwcClusterId,t)}).catch(r=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(r)}),e.formModel.comment=e.comment}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}}}setRuleStyle(e,i){if(i){let t={style:i.ruleColor};this.updateSelectedRules(e._fwcClusterId,e.firewall,this.fwcUserService.getActualFwSelectedCloud(),t)}}updateRulePosition(e,i,t,n,o,r,p){return Z(this,null,function*(){let s={},f=r._fwcPositionId,h=r._fwcRuleId,E=this.checkOperation(e,r,p);if(E)this.confirmationService.confirm({header:this.translate.instant("POSITION.ERROR_HEADER"),icon:"fa fa-exclamation-circle fwcRed iconBig",message:E,rejectVisible:!1,acceptLabel:"Ok",accept:()=>{}});else{let b=e.getClusterId();if(r&&r.obj_type===v.OBJ_FIREWALL){if(r.position===Me.MASTER_NODE){this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.translate.instant("KEEPALIVED.POLICY.ERROR_MASTER_NODE")});return}if(r.cluster_id!==b){this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.translate.instant("KEEPALIVED.POLICY.ERROR_CLUSTER_NODES")});return}}f==null||h==null||p==ne.COPY?(s=this.buildCopyApiData(r,o),this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcKeepalivedPolicyService.updateKeepalivedPolicyRule.bind(this.fwcKeepalivedPolicyService),i,t,n,s).then(()=>{this.addObjectToPosition(o,r),this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("KEEPALIVED.SUCCESS.UPDATE_RULE")}),this.dispatchFwStatusUpdateAction(b,i),this.dispatchReloadItemEditingPanels(),this.ruleSelectedService.setRuleHeightRecalculate(n)}).catch(I=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(I)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})):(this.ruleSelectedService.setRuleStatus(""),this.moveObject(e,i,t,n,o,r).then(()=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("KEEPALIVED.SUCCESS.UPDATE_RULE")})}).catch(I=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(I)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()}))}})}checkOperation(e,i,t){let n;return i._fwcRuleId&&i._fwcPositionId&&(t===ne.CUT||t===ne.DELETE)&&e.getPolicyRule(i._fwcRuleId).positions.find(s=>s.id===i._fwcPositionId).ipobjs.filter(s=>s._fwcObjType!==v.OBJ_ANY).length<2&&(n=this.translate.instant("KEEPALIVED.POLICY.ERROR_LAST_IPOBJECT")),n}moveObject(e,i,t,n,o,r){return Z(this,null,function*(){try{let p,s;switch(r._fwcObjType){case v.OBJ_GROUP:{p="ipObjGroupId";break}case v.OBJ_MARK:{p="markId";break}default:{p="ipObjId";break}}let f=e.getPolicyRule(r._fwcRuleId),h=f.positions.find(b=>b.id===r._fwcPositionId);if(r._fwcPositionId!==Me.VIRTUAL_IPS)return Promise.reject(this.translate.instant("KEEPALIVED.POLICY.ERROR_MOVING_POSITION"));s={fromId:f.id,toId:n},s[p]=r._fwcObjId,yield this.utilService.fwcAPICall(this.fwcKeepalivedPolicyService.moveObjectBetweenPositions.bind(this.fwcKeepalivedPolicyService),i,t,s),this.addObjectToPosition(o,r),this.removeObjectFromPosition(h,r),this.dispatchReloadItemEditingPanels(),this.ruleSelectedService.setRuleHeightRecalculate(f.id),this.ruleSelectedService.setRuleHeightRecalculate(n);let E=e.getClusterId();this.dispatchFwStatusUpdateAction(E,i),Promise.resolve()}catch{Promise.reject()}})}deleteObjectFromPosition(e,i,t,n,o,r){let p={};p=this.buildRemoveApiData(r,o),p!==r&&(this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcKeepalivedPolicyService.updateKeepalivedPolicyRule.bind(this.fwcKeepalivedPolicyService),e,t,n,p).then(()=>{this.removeObjectFromPosition(o,r),this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("KEEPALIVED.SUCCESS.UPDATE_RULE")}),this.dispatchFwStatusUpdateAction(i,e),this.dispatchReloadItemEditingPanels(),this.ruleSelectedService.setRuleHeightRecalculate(n)}).catch(s=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(s)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()}))}addObjectToPosition(e,i){let t={cluster_id:i._fwcClusterId,cluster_name:i._fwcClusterName,firewall_id:i._fwcFwId,firewall_name:i._fwcFwName,host_id:i._fwcHostId,host_name:i._fwcHostName,id:i._fwcObjId,id_obj:i._fwcObjId,name:i._fwcObjName,obj_type:i._fwcObjType,parent_id:i.parent_id,position:e.id,position_order:e.ipobjs?e.ipobjs.length:1,rule:e.rule,type:i._fwcObjType,_fwcFwId:i._fwcFwId,_fwcFwName:i._fwcFwName,_fwcObjId:i._fwcObjId,_fwcObjName:i._fwcObjName,_fwcObjType:i._fwcObjType,_fwcPositionId:e.id,_fwcRuleId:e.rule,_fwcUserId:this.fwcUserService.getActualFwcUser().user_id,highlighted:i.highlighted};e.id!==Me.VIRTUAL_IPS&&e.id!==Me.INTERFACE?e.ipobjs=[...e.ipobjs.filter(n=>n.obj_type!==t.obj_type),t]:e.id!==Me.INTERFACE&&e.id===Me.VIRTUAL_IPS?e.ipobjs=[...e.ipobjs.filter(n=>n.obj_type!==v.OBJ_INTERFACE_FIREWALL),t]:e.id===Me.INTERFACE?e.ipobjs=[...e.ipobjs.filter(n=>n.obj_type!==v.OBJ_INTERFACE_FIREWALL),t]:e.ipobjs=[...e.ipobjs,t]}showNewRuleDialog(e,i,t,n,o,r,p){let s=this.utilService.createDynamicComponentRef(ll),f=s.instance;f.setDynamicComponentRef(s),f.showNewRuleDialog(e,i,t,n)}moveSelectedRules(e,i,t,n,o){this.store.dispatch(Xe.requestBlockUI()),this.utilService.fwcAPICall(this.fwcKeepalivedPolicyService.manageKeepalivedPolicyRules.bind(this.fwcKeepalivedPolicyService),e,i,t,o,n,ne.CUT).then(()=>{this.fwcPolicyService.reloadPolicy()}).catch(()=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.translate.instant("GLOBALS.MSG_OP_RESULT.PROCESS_ERROR")})}).finally(()=>{this.store.dispatch(Xe.requestUnblockUI())})}newKeepalivedRuleGroup(e,i,t){let n=t&&t.groupName,o=t&&t.groupComment;if(n){let p=this.ruleSelectedService.getActualSelectedRules().map(s=>s.id);this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcKeepalivedPolicyService.newKeepalivedPolicyRuleGroup.bind(this.fwcKeepalivedPolicyService),e,i,n,o,p).then(()=>{this.dispatchReloadItemPanelAction(),this.fwcPolicyService.reloadPolicy()}).catch(s=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(s)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}else return}compileSelectedRules(){this.compileRules()}static{this.\u0275fac=function(i){return new(i||l)(N(ce),N(we),N(ue),N(se),N(de),N(Gi),N(We),N(Fe),N(_e),N(Ie),N(ie),N(pe))}}static{this.\u0275prov=Be({token:l,factory:l.\u0275fac,providedIn:"root"})}}return l})();var Tl=(()=>{class l{constructor(e,i,t,n,o,r,p,s,f,h){this.translate=e,this.fwcErrorPipe=i,this.utilService=t,this.fwcUserService=n,this.fwcPolicyService=o,this.fwcHAProxyPolicyService=r,this.ruleSelectedService=p,this.messageService=s,this.cd=f,this.store=h}setGroupValues(e){if(e){let i=e.groupData,t=e.group,n=e.policyType,o={style:e.groupColor,name:e.groupName};this.updateGroup(n,i.firewall,i.fwcloud,t,o)}}updateGroup(e,i,t,n,o){let r;e===q[X.HAPROXY]&&(r=this.fwcHAProxyPolicyService.updateHAProxyPolicyRuleGroup.bind(this.fwcHAProxyPolicyService)),r&&(this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(r,i,t,n.idgroup,o).then(()=>{if(o.name){n.group_name=o.name;let p=n.rules;for(let s=0;s<p.length;s++)p[s].group_name=n.group_name}if(o.style){n.group_style=o.style;let p=n.rules;for(let s=0;s<p.length;s++)p[s].group_style=n.group_style}n=ot(n)}).catch(p=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(p)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()}))}compileRules(e){let i,t,n,o=this.ruleSelectedService.getActualSelectedRules(),r=this.ruleSelectedService.getRulesOrderedIds(o),p;if(Array.isArray(r.orderedRules)&&r.orderedRules[0]){p=r.orderedRules[0],i=this.fwcUserService.getActualFwcUser().selectedFwCloud,t=p.firewall,n=r.rulesIds;let s=this.fwcHAProxyPolicyService.compileHAProxyPolicyRules.bind(this.fwcHAProxyPolicyService),f=[t,i,n],h=this.translate.instant("HAPROXY.POLICY.RULE"),E=this.translate.instant("HAPROXY.POLICY.COMPILE_DIALOG_TITLE");e&&(s=this.fwcHAProxyPolicyService.compileHAProxyPolicyRules.bind(this.fwcHAProxyPolicyService),f=[t,i,e,n],h=this.translate.instant("HAPROXY.NEW_RULE_PANEL.RULE"),E=this.translate.instant("HAPROXY.RULE.COMPILE_DIALOG_TITLE")),this.ruleSelectedService.setRuleStatus(""),this.detectChanges(),this.utilService.fwcAPICall(s,...f).then(b=>{if(Array.isArray(b.data)){let I=this.utilService.createDynamicComponentRef(ei),R=I.instance;R.setDynamicComponentRef(I),R.showCompilationData(b.data,o,h,E,void 0,void 0)}}).catch(b=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(b)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}}filterIpObjects(e,i){let t=[];return Array.isArray(e)&&(t=e.filter(i).map(n=>({id:n.id,order:n.position_order}))),t}buildCopyApiData(e,i){let t={},n,o,r=e._fwcObjId,p=e._fwcObjType,s=i.ipobjs;switch(p){case v.OBJ_ADDRESS:i.id===ve.FRONTEND_IP?(n=this.filterIpObjects(s,f=>f._fwcObjType===v.OBJ_ADDRESS)[0],o="frontendIpId"):i.id===ve.BACKEND_IPS&&(n=this.filterIpObjects(s,f=>f._fwcObjType===v.OBJ_ADDRESS),o="backendIpsIds");break;case v.OBJ_SERVICE_TCP:case v.OBJ_SERVICE_UDP:i.id===ve.FRONTEND_PORT?(n=this.filterIpObjects(s,f=>f._fwcObjType===v.OBJ_SERVICE_UDP||f._fwcObjType===v.OBJ_SERVICE_TCP)[0],o="frontendPortId"):i.id===ve.BACKEND_PORT&&(n=this.filterIpObjects(s,f=>f._fwcObjType===v.OBJ_SERVICE_UDP||f._fwcObjType===v.OBJ_SERVICE_TCP)[0],o="backendPortId");break}return t[o]=Array.isArray(n)?[...n,{id:r,order:s?s.length:1}]:r,n&&!Array.isArray(n)&&this.buildRemoveApiData(n,i),t}buildRemoveApiData(e,i){let t={},n,o,r=e._fwcObjId,p=i.ipobjs;switch(e._fwcObjType){case v.OBJ_ADDRESS:if(i.id===ve.BACKEND_IPS){if(n=this.filterIpObjects(p,f=>f._fwcObjType===v.OBJ_ADDRESS&&f._fwcObjId!==r),!n||n.length===0)return this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.ERROR"),detail:this.translate.instant("GLOBALS.MSG_OBJ_DELETE.BACKEND_IP")}),e;o="backendIpsIds";break}else return this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.ERROR"),detail:this.translate.instant("GLOBALS.MSG_OBJ_DELETE.FRONTEND_IP")}),e;case v.OBJ_SERVICE_TCP:case v.OBJ_SERVICE_UDP:return i.id===ve.FRONTEND_PORT?this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.ERROR"),detail:this.translate.instant("GLOBALS.MSG_OBJ_DELETE.FRONTEND_PORT")}):i.id===ve.BACKEND_PORT&&this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.ERROR"),detail:this.translate.instant("GLOBALS.MSG_OBJ_DELETE.BACKEND_PORT")}),e}return t[o]=Array.isArray(n)?[...n]:n,t}removeObjectFromPosition(e,i){if(Array.isArray(e.ipobjs)){e.ipobjs=e.ipobjs.filter(t=>t._fwcObjId!==i._fwcObjId||t._fwcObjType!==i._fwcObjType);for(let t of e.ipobjs)t.position_order!=null&&t.position_order>i.position_order&&t.position_order--}}dispatchFwStatusUpdateAction(e,i){this.store.dispatch(ze.updateFwStatus({item:{cluster:e,id:i,status:3}}))}dispatchReloadItemPanelAction(){this.store.dispatch(me.reloadDialog({dialogUuids:[ee.ITEM_PANEL]}))}dispatchReloadItemEditingPanels(){this.store.dispatch(me.reloadDialog({dialogUuids:[ee.ITEM_PANEL,ee.CLUSTER_PANEL,ee.FIREWALL_PANEL,ee.OVCONFIG_PANEL]}))}detectChanges(){this.cd.destroyed||(this.cd.markForCheck(),this.cd.detectChanges())}static{this.\u0275fac=function(i){return new(i||l)(N(ce),N(we),N(ue),N(se),N(de),N(Bi),N(Fe),N(_e),N(ie),N(pe))}}static{this.\u0275prov=Be({token:l,factory:l.\u0275fac,providedIn:"root"})}}return l})();var An=(()=>{class l extends Tl{constructor(e,i,t,n,o,r,p,s,f,h,E){super(e,i,t,n,o,r,p,s,h,E),this.translate=e,this.fwcErrorPipe=i,this.utilService=t,this.fwcUserService=n,this.fwcPolicyService=o,this.fwcHAProxyPolicyService=r,this.ruleSelectedService=p,this.messageService=s,this.confirmationService=f,this.cd=h,this.store=E}parseHAProxyPolicyRules(e,i,t){let n=[];for(let o of t){o.group&&(o.HAProxyGroup=o.group);let r=o.rule_type,p={id:o.id,idgroup:o.group&&o.HAProxyGroup.id,group_name:o.group&&o.HAProxyGroup.name,group_style:o.group&&o.HAProxyGroup.style,comment:o.comment,style:o.style,type:q[X.HAPROXY],cfg_text:r===2?o.cfg_text:null,special:r===2?6:null,rule_order:o.rule_order,active:o.active?1:0,firewall:e,fwcloud:i,positions:[]},s=1,f={id:ve.FRONTEND_IP,rule:o.id,ipobjs:[],content:"O",name:this.translate.instant("POLICY_GRID.RULES.HAPROXY_FRONTEND_IP"),policy_type:p.type,position_order:s++,single_object:0,fwcloud:i,firewall:e};if(o.frontendIp){let I={rule:o.id,position:ve.FRONTEND_IP,id:o.frontendIp.id,name:o.frontendIp.name,type:o.frontendIp.ipObjTypeId,position_order:1,if_id:o.frontendIp.interface?o.frontendIp.interface.id:null,if_name:o.frontendIp.interface?o.frontendIp.interface.name:null,firewall_id:o.frontendIp.interface&&o.frontendIp.interface.firewall?o.frontendIp.interface.firewall.id:null,firewall_name:o.frontendIp.interface&&o.frontendIp.interface.firewall?o.frontendIp.interface.firewall.name:null,cluster_id:o.frontendIp.interface&&o.frontendIp.interface.firewall&&o.frontendIp.interface.firewall.cluster?o.frontendIp.interface.firewall.cluster.id:null,cluster_name:o.frontendIp.interface&&o.frontendIp.interface.firewall&&o.frontendIp.interface.firewall.cluster?o.frontendIp.interface.firewall.cluster.name:null,host_id:o.frontendIp.interface&&o.frontendIp.interface.hosts&&o.frontendIp.interface.hosts.length>0&&o.frontendIp.interface.hosts[0].hostIPObj?o.frontendIp.interface.hosts[0].hostIPObj.id:null,host_name:o.frontendIp.interface&&o.frontendIp.interface.hosts&&o.frontendIp.interface.hosts.length>0&&o.frontendIp.interface.hosts[0].hostIPObj?o.frontendIp.interface.hosts[0].hostIPObj.name:null};f.ipobjs.push(I)}let h={id:ve.FRONTEND_PORT,rule:o.id,ipobjs:[],content:"O",name:this.translate.instant("POLICY_GRID.RULES.HAPROXY_FRONTEND_PORT"),policy_type:p.type,position_order:s++,single_object:0,fwcloud:i,firewall:e};if(o.frontendPort){let I={rule:o.id,position:ve.FRONTEND_PORT,id:o.frontendPort.id,name:o.frontendPort.name,type:o.frontendPort.ipObjTypeId,position_order:1};h.ipobjs.push(I)}let E={id:ve.BACKEND_IPS,rule:o.id,ipobjs:[],content:"O",name:this.translate.instant("POLICY_GRID.RULES.HAPROXY_BACKEND_IPS"),policy_type:p.type,position_order:s++,single_object:0,fwcloud:i,firewall:e};if(Array.isArray(o.items))for(let R of o.items){let V={rule:o.id,position:ve.BACKEND_IPS,id:R.id,name:R.name,type:R.type,position_order:1,if_id:R.interface?R.interface.id:null,if_name:R.interface?R.interface.name:null,firewall_id:R.firewall_id?R.firewall_id:null,firewall_name:R.firewall_name?R.firewall_name:null,cluster_id:R.cluster_id?R.cluster_id:null,cluster_name:R.cluster_name?R.cluster_name:null,host_id:R.host_id?R.host_id:null,host_name:R.host_name?R.host_name:null};E.ipobjs.push(V)}let b={id:ve.BACKEND_PORT,rule:o.id,ipobjs:[],content:"O",name:this.translate.instant("POLICY_GRID.RULES.HAPROXY_BACKEND_PORT"),policy_type:p.type,position_order:s++,single_object:0,fwcloud:i,firewall:e};if(o.backendPort){let I={rule:o.id,position:ve.BACKEND_PORT,id:o.backendPort.id,name:o.backendPort.name,type:o.backendPort.ipObjTypeId,position_order:1};b.ipobjs.push(I)}p.positions.push(f,h,E,b),n.push(p)}return n}updateRule(e,i,t,n,o,r,p){this.ruleSelectedService.setRuleStatus("");let s={},f=!1;o&&(s.comment=o,f=!0),r&&(s.style=r,f=!0),p!==void 0&&(s.active=p,f=!0),this.utilService.fwcAPICall(this.fwcHAProxyPolicyService.updateHAProxyPolicyRule.bind(this.fwcHAProxyPolicyService),i,t,n.id,s).then(h=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("HAPROXY.SUCCESS.UPDATE_RULE")}),this.fwcPolicyService.reloadPolicy(),f&&this.dispatchFwStatusUpdateAction(e,i)}).catch(h=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(h)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null)})}updateSelectedRules(e,i,t,n){let o=this.ruleSelectedService.getActualSelectedRules(),r=!!Object.keys(n).filter(p=>p!=="style").length;if(Array.isArray(o)&&o.length){let p=o.map(s=>s.id);this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcHAProxyPolicyService.updateHAProxyPolicyRules.bind(this.fwcHAProxyPolicyService),i,t,p,n).then(s=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("HAPROXY.SUCCESS.UPDATE_RULE")}),this.fwcPolicyService.reloadPolicy(),r&&this.dispatchFwStatusUpdateAction(e,i)}).catch(s=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(s)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null)})}}updateRuleComment(e){if(e&&e.formModel){let i=e.formModel.comment;if(e.comment!==i){let t=e.firewall,n=e.fwcloud,o={comment:i};this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcHAProxyPolicyService.updateHAProxyPolicyRule.bind(this.fwcHAProxyPolicyService),t,n,e.id,o).then(r=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("ROUTING.SUCCESS.UPDATE_RULE")}),e.comment=i,this.dispatchFwStatusUpdateAction(e._fwcClusterId,t)}).catch(r=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(r)}),e.formModel.comment=e.comment}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}}}updateRuleCfgText(e){if(e&&e.formModel){let i=e.formModel.cfg_text;if(e.cfg_text!==i){let t=e.firewall,n=e.fwcloud,o={cfg_text:i};this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcHAProxyPolicyService.updateHAProxyPolicyRule.bind(this.fwcHAProxyPolicyService),t,n,e.id,o).then(()=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("ROUTING.SUCCESS.UPDATE_RULE")}),e.cfg_text=i,this.dispatchFwStatusUpdateAction(e._fwcClusterId,t)}).catch(r=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(r)}),e.formModel.cfg_text=e.cfg_text}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}}}setRuleStyle(e,i){if(i){let t={style:i.ruleColor};this.updateSelectedRules(e._fwcClusterId,e.firewall,this.fwcUserService.getActualFwSelectedCloud(),t)}}updateRulePosition(e,i,t,n,o,r,p){let s={},f=r._fwcPositionId,h=r._fwcRuleId,E=this.checkOperation(e,r,p);if(E)this.confirmationService.confirm({header:this.translate.instant("POSITION.ERROR_HEADER"),icon:"fa fa-exclamation-circle fwcRed iconBig",message:E,rejectVisible:!1,acceptLabel:"Ok",accept:()=>{}});else{let b=e.getClusterId();if(f==null||h==null||p==ne.COPY)s=this.buildCopyApiData(r,o),this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcHAProxyPolicyService.updateHAProxyPolicyRule.bind(this.fwcHAProxyPolicyService),i,t,n,s).then(I=>{this.addObjectToPosition(o,r),this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("HAPROXY.SUCCESS.UPDATE_RULE")}),this.dispatchFwStatusUpdateAction(b,i),this.dispatchReloadItemEditingPanels(),this.ruleSelectedService.setRuleHeightRecalculate(n)}).catch(I=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(I)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()});else{if(r&&(r.obj_type===v.OBJ_ADDRESS&&r.position!=ve.BACKEND_IPS||r.obj_type!==v.OBJ_ADDRESS)){this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.translate.instant("HAPROXY.POLICY.ERROR_MOVING_POSITION")});return}this.ruleSelectedService.setRuleStatus(""),this.moveObject(e,i,t,n,o,r).then(()=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("HAPROXY.SUCCESS.UPDATE_RULE")})}).catch(I=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(I)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}}}checkOperation(e,i,t){let n;return i._fwcRuleId&&i._fwcPositionId&&(t===ne.CUT||t===ne.DELETE)&&e.getPolicyRule(i._fwcRuleId).positions.find(s=>s.id===i._fwcPositionId).ipobjs.filter(s=>s._fwcObjType!==v.OBJ_ANY).length<2&&(n=this.translate.instant("HAPROXY.POLICY.ERROR_LAST_IPOBJECT")),n}moveObjectAlt(e,i,t,n,o,r){return Z(this,null,function*(){try{let p=this.buildCopyApiData(r,o);yield this.utilService.fwcAPICall(this.fwcHAProxyPolicyService.updateHAProxyPolicyRule.bind(this.fwcHAProxyPolicyService),i,t,n,p);let s=e.getPolicyRule(r._fwcRuleId),f=s.positions.find(b=>b.id===r._fwcPositionId),h=this.buildRemoveApiData(r,f);yield this.utilService.fwcAPICall(this.fwcHAProxyPolicyService.updateHAProxyPolicyRule.bind(this.fwcHAProxyPolicyService),i,t,s.id,h),this.addObjectToPosition(o,r),this.removeObjectFromPosition(f,r),this.ruleSelectedService.setRuleHeightRecalculate(s.id),this.ruleSelectedService.setRuleHeightRecalculate(n),this.dispatchReloadItemEditingPanels();let E=e.getClusterId();this.dispatchFwStatusUpdateAction(E,i),Promise.resolve()}catch{Promise.reject()}})}moveObject(e,i,t,n,o,r){return Z(this,null,function*(){try{let p,s;switch(r._fwcObjType){case v.OBJ_GROUP:{p="ipObjGroupId";break}case v.OBJ_MARK:{p="markId";break}default:{p="ipObjId";break}}let f=e.getPolicyRule(r._fwcRuleId),h=f.positions.find(b=>b.id===r._fwcPositionId);if(r._fwcPositionId!==ve.BACKEND_IPS)return Promise.reject(this.translate.instant("HAPROXY.POLICY.ERROR_MOVING_POSITION"));s={fromId:f.id,toId:n},s[p]=r._fwcObjId,yield this.utilService.fwcAPICall(this.fwcHAProxyPolicyService.moveObjectBetweenPositions.bind(this.fwcHAProxyPolicyService),i,t,s),this.addObjectToPosition(o,r),this.removeObjectFromPosition(h,r),this.dispatchReloadItemEditingPanels(),this.ruleSelectedService.setRuleHeightRecalculate(f.id),this.ruleSelectedService.setRuleHeightRecalculate(n);let E=e.getClusterId();this.dispatchFwStatusUpdateAction(E,i),Promise.resolve()}catch{Promise.reject()}})}deleteObjectFromPosition(e,i,t,n,o,r){let p={};p=this.buildRemoveApiData(r,o),p!==r&&(this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcHAProxyPolicyService.updateHAProxyPolicyRule.bind(this.fwcHAProxyPolicyService),e,t,n,p).then(s=>{this.removeObjectFromPosition(o,r),this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("HAPROXY.SUCCESS.UPDATE_RULE")}),this.dispatchFwStatusUpdateAction(i,e),this.dispatchReloadItemEditingPanels(),this.ruleSelectedService.setRuleHeightRecalculate(n)}).catch(s=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(s)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()}))}addObjectToPosition(e,i){let t={cluster_id:i._fwcClusterId,cluster_name:i._fwcClusterName,firewall_id:i._fwcFwId,firewall_name:i._fwcFwName,host_id:i._fwcHostId,host_name:i._fwcHostName,id:i._fwcObjId,id_obj:i._fwcObjId,name:i._fwcObjName,obj_type:i._fwcObjType,parent_id:i.parent_id,position:e.id,position_order:e.ipobjs?e.ipobjs.length:1,rule:e.rule,type:i._fwcObjType,_fwcFwId:i._fwcFwId,_fwcFwName:i._fwcFwName,_fwcObjId:i._fwcObjId,_fwcObjName:i._fwcObjName,_fwcObjType:i._fwcObjType,_fwcPositionId:e.id,_fwcRuleId:e.rule,_fwcUserId:this.fwcUserService.getActualFwcUser().user_id,highlighted:i.highlighted};e.id===ve.FRONTEND_PORT||e.id===ve.BACKEND_PORT?e.ipobjs=[...e.ipobjs.filter(n=>n.obj_type!==v.OBJ_SERVICE_TCP&&n.obj_type!==v.OBJ_SERVICE_UDP),t]:e.id!==ve.BACKEND_IPS?e.ipobjs=[...e.ipobjs.filter(n=>n.obj_type!==t.obj_type),t]:e.ipobjs=[...e.ipobjs,t]}showNewRuleDialog(e,i,t,n,o,r,p){let s=this.utilService.createDynamicComponentRef(rl),f=s.instance;f.setDynamicComponentRef(s),f.showNewRuleDialog(e,i,t,n)}moveSelectedRules(e,i,t,n,o){this.store.dispatch(Xe.requestBlockUI()),this.utilService.fwcAPICall(this.fwcHAProxyPolicyService.manageHAProxyPolicyRules.bind(this.fwcHAProxyPolicyService),e,i,t,o,n,ne.CUT).then(()=>{this.fwcPolicyService.reloadPolicy()}).catch(r=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.translate.instant("GLOBALS.MSG_OP_RESULT.PROCESS_ERROR")})}).finally(()=>{this.store.dispatch(Xe.requestUnblockUI())})}newHAProxyRuleGroup(e,i,t){let n=t&&t.groupName,o=t&&t.groupComment;if(n){let p=this.ruleSelectedService.getActualSelectedRules().map(s=>s.id);this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcHAProxyPolicyService.newHAProxyPolicyRuleGroup.bind(this.fwcHAProxyPolicyService),e,i,n,o,p).then(s=>{this.dispatchReloadItemPanelAction(),this.fwcPolicyService.reloadPolicy()}).catch(s=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(s)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}else return}compileSelectedRules(){this.compileRules()}handleChangeApplyToGroup(e){if(e&&e.formModel){let i=e.firewall,t=e.fwcloud,n={firewallApplyToId:e.formModel.fw_apply_to};this.ruleSelectedService.setRuleStatus(""),this.utilService.fwcAPICall(this.fwcHAProxyPolicyService.updateHAProxyPolicyRule.bind(this.fwcHAProxyPolicyService),i,t,e.id,n).then(o=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("ROUTING.SUCCESS.UPDATE_RULE")}),this.dispatchFwStatusUpdateAction(e._fwcClusterId,e.firewall),this.dispatchReloadItemEditingPanels(),this.detectChanges()}).catch(o=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(o)})}).finally(()=>{this.ruleSelectedService.setRuleStatus(null),this.detectChanges()})}}static{this.\u0275fac=function(i){return new(i||l)(N(ce),N(we),N(ue),N(se),N(de),N(Bi),N(Fe),N(_e),N(Ie),N(ie),N(pe))}}static{this.\u0275prov=Be({token:l,factory:l.\u0275fac,providedIn:"root"})}}return l})();var cr=["gridPaginator"],pr=["policyTable"],dr=()=>({width:"100%"}),_r=(l,_,e)=>({$implicit:l,groupHide:_,rowIndex:e}),ur=(l,_)=>({$implicit:l,groupHide:!1,rowIndex:_}),fr=(l,_,e)=>({first:l,last:_,totalRecords:e}),mr=()=>({width:"2rem",height:"2rem"}),hr=(l,_,e,i)=>({fwcRuleSelected:l,fwcRuleDisabled:_,fwcRuleHighlighted:e,fwcRuleSpecial:i}),wr=(l,_,e,i)=>({fwcPositionHighlighted:l,draggedOver:_,fwcObjectForbidden:e,fwcObjectAllowed:i}),Sr=l=>({divCommentPopup:l});function gr(l,_){l&1&&(c(0,"h1",22),T(1,"i",23),g(2),C(3,"translate"),u()),l&2&&(a(2),x(" ",y(3,1,"POLICY_GRID.POL_PANEL"),`
`))}function Cr(l,_){l&1&&(dt(0),T(1,"i",34),g(2,"\xA0 "),c(3,"span",28),g(4,"Cluster: "),u(),_t())}function yr(l,_){l&1&&(T(0,"i",35),g(1,"\xA0 "),c(2,"span",28),g(3,"Firewall: "),u())}function Er(l,_){if(l&1){let e=L();c(0,"p-button",36),P("click",function(){w(e);let t=d(2);return S(t.settingsSidebar=!0)}),u()}}function vr(l,_){l&1&&ut(0)}function Ir(l,_){l&1&&T(0,"div",39)}function br(l,_){l&1&&T(0,"col")}function Pr(l,_){l&1&&T(0,"col")}function Tr(l,_){l&1&&T(0,"col")}function Or(l,_){l&1&&T(0,"col")}function Rr(l,_){l&1&&T(0,"col")}function xr(l,_){if(l&1&&(c(0,"colgroup"),T(1,"col"),A(2,br,1,0,"col",50)(3,Pr,1,0,"col",49)(4,Tr,1,0,"col",49)(5,Or,1,0,"col",49)(6,Rr,1,0,"col",49),u()),l&2){let e=d(3);a(),jt("width","3rem"),a(),m("ngForOf",e.fwcPolicyPositions),a(),m("ngIf",(e.fwcSelectedPolicy==null?null:e.fwcSelectedPolicy._fwcPolicyType)===e.SpecialPolicyTypes.POLICY_ROUTING),a(),m("ngIf",e.fwcSelectedPolicy==null?null:e.fwcSelectedPolicy.show_action),a(),m("ngIf",e.columnVisibility.applyTo&&(e.fwcSelectedPolicy==null?null:e.fwcSelectedPolicy._fwcClusterId)!==null&&(e.fwcSelectedPolicy==null?null:e.fwcSelectedPolicy._fwcClusterId)!==void 0&&e.fwcSelectedPolicy._fwcPolicyType!==e.SpecialPolicyTypes.ROUTING_TABLE&&e.fwcSelectedPolicy._fwcPolicyType!==e.SpecialPolicyTypes.POLICY_ROUTING&&e.fwcSelectedPolicy._fwcPolicyType!==e.POLICY_TYPES_FROM_NODES[e.NodeTypes.DHCP]&&e.fwcSelectedPolicy._fwcPolicyType!==e.POLICY_TYPES_FROM_NODES[e.NodeTypes.DHCP_FIXED_IP]&&e.fwcSelectedPolicy._fwcPolicyType!==e.POLICY_TYPES_FROM_NODES[e.NodeTypes.KEEPALIVED]&&e.fwcSelectedPolicy._fwcPolicyType!==e.POLICY_TYPES_FROM_NODES[e.NodeTypes.HAPROXY]),a(),m("ngIf",e.columnVisibility.comments)}}function Fr(l,_){if(l&1&&(c(0,"th",55),g(1),u()),l&2){let e=_.$implicit;jt("width",e.name==="Source"||e.name==="Destination"?"20%":""),a(),x(" ",e.name," ")}}function Ar(l,_){l&1&&(c(0,"th"),g(1),C(2,"translate"),u()),l&2&&(a(),x(" ",y(2,1,"ROUTING.NEW_TABLE_PANEL.TABLE")," "))}function Lr(l,_){l&1&&(c(0,"th",55),g(1),C(2,"translate"),u()),l&2&&(a(),x(" ",y(2,1,"POLICY_GRID.RULES.ACTION")," "))}function Mr(l,_){l&1&&(c(0,"th",55),g(1),C(2,"translate"),u()),l&2&&(a(),x(" ",y(2,1,"POLICY_GRID.RULES.APPLY_TO")," "))}function Dr(l,_){l&1&&(c(0,"th",56),g(1),C(2,"translate"),u()),l&2&&(a(),x(" ",y(2,1,"POLICY_GRID.RULES.LEASE_TIME")," "))}function Nr(l,_){l&1&&(c(0,"th",55),g(1),C(2,"translate"),u()),l&2&&(a(),x(" ",y(2,1,"POLICY_GRID.RULES.COMMENT")," "))}function Ur(l,_){if(l&1&&(c(0,"tr")(1,"th",51),g(2,"#"),u(),A(3,Fr,2,3,"th",52)(4,Ar,3,3,"th",49)(5,Lr,3,3,"th",53)(6,Mr,3,3,"th",53)(7,Dr,3,3,"th",54)(8,Nr,3,3,"th",53),u()),l&2){let e=d(4);a(3),m("ngForOf",e.fwcPolicyPositions),a(),m("ngIf",(e.fwcSelectedPolicy==null?null:e.fwcSelectedPolicy._fwcPolicyType)===e.SpecialPolicyTypes.POLICY_ROUTING),a(),m("ngIf",e.fwcSelectedPolicy==null?null:e.fwcSelectedPolicy.show_action),a(),m("ngIf",(e.fwcSelectedPolicy==null?null:e.fwcSelectedPolicy._fwcClusterId)!==null&&(e.fwcSelectedPolicy==null?null:e.fwcSelectedPolicy._fwcClusterId)!==void 0&&e.fwcSelectedPolicy._fwcPolicyType!==e.POLICY_TYPES_FROM_NODES[e.NodeTypes.DHCP]&&e.fwcSelectedPolicy._fwcPolicyType!==e.POLICY_TYPES_FROM_NODES[e.NodeTypes.DHCP_FIXED_IP]&&e.fwcSelectedPolicy._fwcPolicyType!==e.POLICY_TYPES_FROM_NODES[e.NodeTypes.KEEPALIVED]&&e.fwcSelectedPolicy._fwcPolicyType!==e.POLICY_TYPES_FROM_NODES[e.NodeTypes.HAPROXY]),a(),m("ngIf",e.fwcSelectedPolicy._fwcPolicyType===e.POLICY_TYPES_FROM_NODES[e.NodeTypes.DHCP]),a(),m("ngIf",e.columnVisibility.comments)}}function Gr(l,_){if(l&1&&A(0,Ur,9,6,"tr",49),l&2){let e=d(3);m("ngIf",(e.fwcPolicyPositions==null?null:e.fwcPolicyPositions.length)||e.fwcSelectedPolicy._fwcPolicyType==e.POLICY_TYPES_FROM_NODES[e.NodeTypes.DHCP]||e.fwcSelectedPolicy._fwcPolicyType==e.POLICY_TYPES_FROM_NODES[e.NodeTypes.DHCP_FIXED_IP]||e.fwcSelectedPolicy._fwcPolicyType==e.POLICY_TYPES_FROM_NODES[e.NodeTypes.KEEPALIVED]||e.fwcSelectedPolicy._fwcPolicyType==e.POLICY_TYPES_FROM_NODES[e.NodeTypes.HAPROXY])}}function Br(l,_){l&1&&ut(0)}function kr(l,_){l&1&&T(0,"i",67)}function jr(l,_){l&1&&T(0,"i",68)}function Vr(l,_){if(l&1&&(dt(0),c(1,"span"),g(2," ("),c(3,"strong"),g(4),u(),g(5),C(6,"translate"),u(),_t()),l&2){let e=d(2).$implicit;a(4),j(e.rules.length),a(),x(" ",y(6,2,"POLICY_GRID.RULES.RULES"),") ")}}function Wr(l,_){l&1&&(c(0,"span"),g(1),C(2,"translate"),u()),l&2&&(a(),x("(",y(2,1,"POLICY_GRID.RULES.NO_RULES"),")"))}function Hr(l,_){l&1&&ut(0)}function Yr(l,_){if(l&1&&(dt(0),A(1,Hr,1,0,"ng-container",70),_t()),l&2){let e=_.$implicit,i=d(3).$implicit;d(3);let t=fe(7);a(),m("ngTemplateOutlet",t)("ngTemplateOutletContext",on(2,_r,e,i.groupHide,i.idgroup))}}function Jr(l,_){if(l&1&&(dt(0),A(1,Yr,2,6,"ng-container",69),_t()),l&2){let e=d(2).$implicit,i=d(3);a(),m("ngForOf",e.rules)("ngForTrackBy",i.policyRowTrackBy)}}function Kr(l,_){if(l&1){let e=L();c(0,"tr",57)(1,"td")(2,"div",58)(3,"iui-contextmenu",59),P("menuOpening",function(t){w(e);let n=d().$implicit,o=d(3);return S(o.contextMenuLoad(n,t))})("menuClick",function(t){w(e);let n=d().$implicit,o=d(3);return S(o.contextMenuHandler(o.fwcPolicyObject,n,t))})("menuOpening",function(t){w(e);let n=d(4);return S(n.adjustMenuPosition(t))}),c(4,"div",60)(5,"span",61),P("click",function(){w(e);let t=d().$implicit,n=d(3);return S(n.toggleGroupVisible(t))}),A(6,kr,1,0,"i",62)(7,jr,1,0,"i",63),u(),g(8," \xA0 "),c(9,"span",64),T(10,"i",65),g(11,"\xA0\xA0"),c(12,"strong"),g(13),u(),T(14,"span",66),A(15,Vr,7,4,"ng-container",27)(16,Wr,3,3,"ng-template",null,7,Ve),u()()()()()(),A(18,Jr,2,2,"ng-container",49)}if(l&2){let e=fe(17),i=d().$implicit,t=d(3);jt("background-color",i.group_style?t.RulesStylesBg[i.group_style]!=null&&t.RulesStylesBg[i.group_style].length?t.RulesStylesBg[i.group_style]:i.group_style:t.RulesStylesBg[1e3]),a(),Ke("colspan",t.fwcSelectedPolicy._fwcPolicyType===t.POLICY_TYPES_FROM_NODES[t.NodeTypes.HAPROXY]?t.fwcSelectedPolicy._fwcClusterId!==null&&t.fwcSelectedPolicy._fwcClusterId!==void 0?t.getColumnsCount():t.getColumnsCount()-1:t.fwcSelectedPolicy._fwcPolicyType===t.POLICY_TYPES_FROM_NODES[t.NodeTypes.DHCP]||t.fwcSelectedPolicy._fwcPolicyType===t.POLICY_TYPES_FROM_NODES[t.NodeTypes.DHCP_FIXED_IP]?t.getColumnsCount():t.fwcSelectedPolicy._fwcPolicyType===t.POLICY_TYPES_FROM_NODES[t.NodeTypes.KEEPALIVED]?t.getColumnsCount()-2:t.getColumnsCount()),a(2),m("allowAnimation",!1)("customStyle",t.contextMenuStyle)("colorScheme",t.currentColorScheme)("settings",t.ruleGroupContextMenu.RULE_GROUP),a(3),m("ngIf",!i.groupHide),a(),m("ngIf",i.groupHide),a(2),M("pTooltip","ID: <strong>"+i.idgroup+"</strong>"),m("escape",!1),a(4),j(i.group_name),a(2),m("ngIf",i.rules==null?null:i.rules.length)("ngIfElse",e),a(3),m("ngIf",!i.groupHide)}}function Xr(l,_){l&1&&ut(0)}function zr(l,_){if(l&1&&A(0,Xr,1,0,"ng-container",70),l&2){let e=d().$implicit;d(3);let i=fe(7);m("ngTemplateOutlet",i)("ngTemplateOutletContext",Ze(2,ur,e,e.id))}}function qr(l,_){if(l&1&&A(0,Br,1,0,"ng-container",33)(1,Kr,19,15,"ng-template",null,5,Ve)(3,zr,1,5,"ng-template",null,6,Ve),l&2){let e=_.$implicit,i=fe(2),t=fe(4);m("ngIf",e.rule_group)("ngIfThen",i)("ngIfElse",t)}}function Qr(l,_){if(l&1&&(c(0,"span",72),g(1),C(2,"translate"),u()),l&2){d();let e=fe(2),i=d(3);a(),x(" ",mi(2,1,"POLICY_GRID.PAGINATOR_REPORT",on(4,fr,e.first+1,e.first+i.MAX_ROWS_PER_PAGE>e.totalRecords?e.totalRecords:e.first+i.MAX_ROWS_PER_PAGE,e.totalRecords))," ")}}function $r(l,_){if(l&1){let e=L();dt(0),c(1,"p-paginator",71,8),P("onPageChange",function(t){w(e);let n=d(3);return S(n.onPageChange(t))}),u(),A(3,Qr,3,8,"ng-template",null,9,Ve),_t()}if(l&2){let e=fe(4),i=d(3);a(),m("rows",i.MAX_ROWS_PER_PAGE)("totalRecords",i.getPolicyRulesLength())("alwaysShow",!1)("templateLeft",e)}}function Zr(l,_){if(l&1){let e=L();c(0,"p-sidebar",37),J("visibleChange",function(t){w(e);let n=d(2);return Y(n.settingsSidebar,t)||(n.settingsSidebar=t),S(t)}),c(1,"div",38)(2,"div",39)(3,"h5",40),g(4),C(5,"translate"),u()(),c(6,"div",39)(7,"b"),g(8),C(9,"translate"),u(),c(10,"div",38),A(11,Ir,1,0,"div",41),c(12,"div",39)(13,"p-checkbox",42),C(14,"translate"),J("ngModelChange",function(t){w(e);let n=d(2);return Y(n.columnVisibility.comments,t)||(n.columnVisibility.comments=t),S(t)}),u()()()()(),c(15,"button",43),C(16,"translate"),P("click",function(){w(e);let t=d(2);return S(t.settingsSidebar=!1)}),u()(),c(17,"div",44)(18,"p-table",45,4),C(20,"fwcGridPagination"),A(21,xr,7,7,"ng-template",46)(22,Gr,1,1,"ng-template",47)(23,qr,5,3,"ng-template",48),u()(),A(24,$r,5,4,"ng-container",49)}if(l&2){let e=d(2);H("visible",e.settingsSidebar),m("baseZIndex",1e4),a(4),x(" ",y(5,18,"POLICY_GRID.GRID_SETTINGS")," "),a(4),j(y(9,20,"POLICY_GRID.COLUMN_VISIBILITY")),a(3),m("ngIf",(e.fwcSelectedPolicy==null?null:e.fwcSelectedPolicy._fwcClusterId)!==null&&(e.fwcSelectedPolicy==null?null:e.fwcSelectedPolicy._fwcClusterId)!==void 0&&e.fwcSelectedPolicy._fwcPolicyType!==e.SpecialPolicyTypes.ROUTING_TABLE&&e.fwcSelectedPolicy._fwcPolicyType!==e.SpecialPolicyTypes.POLICY_ROUTING&&e.fwcSelectedPolicy._fwcPolicyType!==e.POLICY_TYPES_FROM_NODES[e.NodeTypes.DHCP]&&e.fwcSelectedPolicy._fwcPolicyType!==e.POLICY_TYPES_FROM_NODES[e.NodeTypes.DHCP_FIXED_IP]),a(2),M("label",y(14,22,"POLICY_GRID.RULES.COMMENT")),H("ngModel",e.columnVisibility.comments),a(2),M("label",y(16,24,"GLOBALS.MSG_BUTTONS.CLOSE")),a(3),ke(W(30,dr)),m("value",go(20,26,e.fwcPolicyObject.getPolicyRules(),(e.gridPaginator==null?null:e.gridPaginator.first)||0,(e.gridPaginator==null?null:e.gridPaginator.rows)||0))("rowTrackBy",e.policyRowTrackBy)("resizableColumns",!0)("scrollable",!0)("virtualScrollOptions",e.scrollerOptions)("virtualScroll",!0)("virtualScrollItemSize",37),a(6),m("ngIf",e.showPaginator)}}function ea(l,_){if(l&1){let e=L();c(0,"div"),T(1,"sts-fwc-message",73),c(2,"div",74)(3,"button",75),C(4,"translate"),P("click",function(){w(e);let t=d(2);return S(t.createNewRule(t.fwcPolicyObject))}),u()()()}if(l&2){let e=d(2);a(),m("message",e.msgNoRules),a(2),m("label",y(4,2,(e.fwcSelectedPolicy==null?null:e.fwcSelectedPolicy._fwcPolicyType)!==e.SpecialPolicyTypes.ROUTING_TABLE?"POLICY_GRID.RULES.CREATE":"CONTEXT.ROUTING.NEW_TABLE_ROUTE"))}}function ta(l,_){if(l&1){let e=L();c(0,"div",24)(1,"div",25)(2,"h6",26),A(3,Cr,5,0,"ng-container",27)(4,yr,4,0,"ng-template",null,1,Ve),c(6,"span",28)(7,"strong"),g(8),u(),T(9,"span",29),g(10),C(11,"translate"),c(12,"strong"),g(13),u()(),c(14,"span",30),A(15,Er,1,0,"p-button",31),g(16," \xA0 "),c(17,"button",32),C(18,"translate"),P("click",function(){w(e);let t=d();return S(t.onPolicySelect(t.fwcSelectedPolicy,!0))}),u()()()(),A(19,vr,1,0,"ng-container",33)(20,Zr,25,31,"ng-template",null,2,Ve)(22,ea,5,4,"ng-template",null,3,Ve),u()}if(l&2){let e=fe(5),i=fe(21),t=fe(23),n=d();a(3),m("ngIf",n.fwcSelectedPolicy==null?null:n.fwcSelectedPolicy._fwcClusterId)("ngIfElse",e),a(5),j(n.fwcSelectedPolicy._fwcFwName),a(2),x(" ",y(11,10,n.fwcSelectedPolicy._fwcPolicyType!==n.SpecialPolicyTypes.ROUTING_TABLE?"POLICY_GRID.POL_TYPE":"ROUTING.NEW_TABLE_PANEL.TABLE"),": "),a(3),j(n.fwcSelectedPolicy._fwcPolicyName),a(2),m("ngIf",n.fwcSelectedPolicy._fwcPolicyType!==n.POLICY_TYPES_FROM_NODES[n.NodeTypes.DHCP]&&n.fwcSelectedPolicy._fwcPolicyType!==n.POLICY_TYPES_FROM_NODES[n.NodeTypes.DHCP_FIXED_IP]&&n.fwcSelectedPolicy._fwcPolicyType!==n.POLICY_TYPES_FROM_NODES[n.NodeTypes.HAPROXY]),a(2),m("label",y(18,12,"POLICY_GRID.RELOAD")),a(2),m("ngIf",n.fwcPolicyObject==null?null:n.fwcPolicyObject.getPolicyRulesLength())("ngIfThen",i)("ngIfElse",t)}}function ia(l,_){if(l&1&&(c(0,"div",76),T(1,"p-progressSpinner"),c(2,"span",28),g(3),u()()),l&2){let e=d();a(),ke(W(3,mr)),a(2),x(" ",e.ruleStatus," ")}}function na(l,_){l&1&&T(0,"div",90)}function oa(l,_){l&1&&(c(0,"div",91)(1,"span"),T(2,"i",92),u()())}function la(l,_){l&1&&(c(0,"span",93),T(1,"i",94),u())}function ra(l,_){l&1&&(c(0,"span"),T(1,"i",95),u())}function aa(l,_){l&1&&T(0,"i",109)}function sa(l,_){l&1&&(c(0,"span"),g(1,"6"),u())}function ca(l,_){if(l&1&&(c(0,"span",110),T(1,"i",111),g(2," crowdsec"),A(3,sa,2,0,"span",49),g(4,"-blacklists "),u()),l&2){let e=d(6).$implicit;a(3),m("ngIf",e.type>60)}}function pa(l,_){if(l&1&&(c(0,"span",112),g(1," ("),T(2,"i",108),C(3,"fwcIcon"),c(4,"span"),g(5),u(),g(6,")\xA0 "),u()),l&2){let e=d(2).$implicit,i=d(5);a(2),xt("fwcIcon ",y(3,4,i.ObjectTypes.OBJ_CLUSTER),""),a(3),j(e.cluster_name)}}function da(l,_){if(l&1&&(c(0,"span",112),g(1," ("),T(2,"i",108),C(3,"fwcIcon"),c(4,"span"),g(5),u(),g(6,")\xA0 "),u()),l&2){let e=d(2).$implicit,i=d(5);a(2),xt("fwcIcon ",y(3,4,i.ObjectTypes.OBJ_FIREWALL),""),a(3),j(e.firewall_name)}}function _a(l,_){if(l&1&&(c(0,"span",112),g(1," ("),T(2,"i",108),C(3,"fwcIcon"),c(4,"span"),g(5),u(),g(6,")\xA0 "),u()),l&2){let e=d(2).$implicit,i=d(5);a(2),xt("fwcIcon ",y(3,4,i.ObjectTypes.OBJ_HOST),""),a(3),j(e.host_name)}}function ua(l,_){if(l&1&&(T(0,"img",113),C(1,"lowercase"),C(2,"lowercase")),l&2){let e=d(2).$implicit;xt("flag-icon flag-icon-",y(1,4,e.name),""),m("src","assets/flags/4x3/"+y(2,6,e.name)+".svg",oi)}}function fa(l,_){if(l&1&&(T(0,"i",108),C(1,"fwcIcon")),l&2){let e=d(2).$implicit;xt("fwcIcon ",mi(1,3,e.name,e.name),"")}}function ma(l,_){l&1&&ut(0)}function ha(l,_){if(l&1&&g(0),l&2){let e=d(2).$implicit;j(e._fwcObjName)}}function wa(l,_){if(l&1&&g(0),l&2){let e=d(2).$implicit;x("[",e.labelName,"]")}}function Sa(l,_){if(l&1&&(dt(0),A(1,aa,1,0,"i",101)(2,ca,5,1,"span",102),c(3,"span",103),A(4,pa,7,6,"span",104)(5,da,7,6,"span",104)(6,_a,7,6,"span",104),c(7,"span",105),A(8,ua,3,8,"img",106)(9,fa,2,6,"i",107),T(10,"i",108),C(11,"fwcIcon"),A(12,ma,1,0,"ng-container",33)(13,ha,1,1,"ng-template",null,13,Ve)(15,wa,1,1,"ng-template",null,14,Ve),u()(),_t()),l&2){let e=fe(14),i=fe(16),t=d().$implicit,n=d().$implicit,o=d(3).$implicit,r=d();a(),m("ngIf",n.negate),a(),m("ngIf",o.special==r.SpecialPolicyRules.CROWDSEC&&n.name==="Source"),a(2),m("ngIf",n.ipobjs.length>1&&t.cluster_id!=null&&t.cluster_id!==o._fwcClusterId&&t.host_id==null&&!(t.firewall_id!=null&&t.cluster_id==null)),a(),m("ngIf",t.firewall_id!=null&&t.cluster_id==null&&t.firewall_id!=o.firewall&&r.isObjectTypesValid(t._fwcObjType)&&!(t.firewall_id===o.firewall&&t.cluster_id===o._fwcClusterId)&&!t.host_id&&(r.isPolicyNotInSelected(r.fwcSelectedPolicy)&&t.firewall_id&&!t.cluster_id&&t.firewall_id!=o.firewall||t.firewall_id!=o.firewall&&t._fwcObjType==r.ObjectTypes.OBJ_ADDRESS&&r.fwcSelectedPolicy!==r.POLICY_TYPES_FROM_NODES[r.NodeTypes.HAPROXY]||r.fwcSelectedPolicy===r.POLICY_TYPES_FROM_NODES[r.NodeTypes.HAPROXY]&&t.firewall_id!=o.firewall&&!o._fwcClusterId||r.fwcSelectedPolicy===r.POLICY_TYPES_FROM_NODES[r.NodeTypes.DHCP]&&t.firewall_id!=o.firewall&&!o._fwcClusterId&&t.firewall_id||t.firewall_id==o.firewall&&t._fwcObjType==r.ObjectTypes.OBJ_ADDRESS&&r.fwcSelectedPolicy!==r.POLICY_TYPES_FROM_NODES[r.NodeTypes.KEEPALIVED])),a(),m("ngIf",(t._fwcObjType==r.ObjectTypes.OBJ_INTERFACE_HOST||t._fwcObjType==r.ObjectTypes.OBJ_ADDRESS||t._fwcObjType==r.ObjectTypes.OBJ_ADDRESS&&r.fwcSelectedPolicy!==r.POLICY_TYPES_FROM_NODES[r.NodeTypes.KEEPALIVED]||t._fwcObjType==r.ObjectTypes.OBJ_OPENVPN_PREFIX)&&t.host_id),a(2),m("ngIf",t._fwcObjType===r.ObjectTypes.OBJ_COUNTRIE),a(),m("ngIf",t._fwcObjType===r.ObjectTypes.OBJ_CONTINENT),a(),xt("fwcIcon ",y(11,13,t._fwcObjType),""),a(2),m("ngIf",(t._fwcObjType==r.ObjectTypes.OBJ_INTERFACE_FIREWALL||t._fwcObjType==r.ObjectTypes.OBJ_INTERFACE_HOST)&&t.labelName&&t.labelName.length)("ngIfThen",i)("ngIfElse",e)}}function ga(l,_){if(l&1){let e=L();c(0,"div")(1,"iui-contextmenu",81),P("menuOpening",function(t){w(e);let n=d().$implicit,o=d(3).$implicit,r=d();return S(r.fwcPositionFunctionalityService.onContextMenuLoad(o.type,o.id,n,r.fwcTypesPositions[n.id],t))})("menuClick",function(t){let n=w(e).$implicit,o=d().$implicit,r=d(3).$implicit,p=d();return S(p.fwcPositionFunctionalityService.onContextMenuHandler(p.fwcPolicyObject,n,r.firewall,r._fwcClusterId,r.id,o,p.fwcTypesPositions[o.id],t))})("menuOpening",function(t){w(e);let n=d(5);return S(n.adjustMenuPosition(t))}),c(2,"div",100),P("click",function(){let t=w(e).$implicit,n=d().$implicit,o=d(4);return S(o.fwcPositionFunctionalityService.onItemClickEvent(n,t))})("dblclick",function(){let t=w(e).$implicit,n=d().$implicit,o=d(4);return S(o.fwcPositionFunctionalityService.onItemDblClickEvent(n,t))})("mouseenter",function(t){let n=w(e).$implicit,o=d(5);return S(o.fwcPositionFunctionalityService.showObjectInfo(n,t))})("mouseleave",function(t){w(e);let n=d(5);return S(n.fwcPositionFunctionalityService.clearObjectInfo(t))})("dragstart",function(t){let n=w(e).$implicit,o=d().$implicit,r=d(4);return S(r.fwcPositionFunctionalityService.itemDragStart(o,n,t))}),A(3,Sa,17,15,"ng-container",49),u()()()}if(l&2){let e=_.$implicit,i=d().$implicit,t=d(4);a(),m("allowAnimation",!1)("customStyle",t.contextMenuStyle)("colorScheme",t.currentColorScheme)("settings",t.fwcPositionFunctionalityService.positionContextMenu.POSITION),a(),ho("item-highlighted",e.highlighted==!0)("item-rightclicked",e.rightclicked==!0),m("ngClass",e.hidden&&(i.ipobjs==null?null:i.ipobjs.length)>1?"item-general-hidden":"item-general-default")("draggable",e.allowDrag!==!1&&!(i.id===t.RoutingPolicyPositions.FROM_POSITION&&(i.ipobjs==null?null:i.ipobjs.length)<=2||i.id===t.DhcpPolicyPositions.NETWORK||i.id===t.DhcpPolicyPositions.INTERFACE||i.id===t.DhcpPolicyPositions.ROUTER||i.id===t.DhcpPolicyPositions.RANGE||i.id===t.DhcpPolicyPositions.IP)),Ke("data-obj_id",e.id),a(),m("ngIf",e.hidden&&(i.ipobjs==null?null:i.ipobjs.length)==1||!e.hidden&&(i.ipobjs==null?null:i.ipobjs.length)>1)}}function Ca(l,_){if(l&1){let e=L();c(0,"td",97)(1,"div",98,12),P("dragenter",function(t){let n=w(e).$implicit,o=fe(2),r=d(3).$implicit,p=d();return S(p.fwcPositionFunctionalityService.onListDragEnter(r.firewall,n,p.fwcTypesPositions[n.id],t,o))})("dragleave",function(t){let n=w(e).$implicit,o=fe(2),r=d(4);return S(r.fwcPositionFunctionalityService.onListDragLeave(t,n,o))})("dragover",function(t){w(e);let n=d(4);return S(n.fwcPositionFunctionalityService.onListDragOver(t))})("drop",function(t){let n=w(e).$implicit,o=fe(2),r=d(3).$implicit,p=d();return S(p.fwcPositionFunctionalityService.onListDragDrop(p.fwcPolicyObject,r.id,n,p.fwcTypesPositions[n.id],t,o))}),A(3,ga,4,12,"div",69),c(4,"iui-contextmenu",81),P("menuOpening",function(t){let n=w(e).$implicit,o=d(3).$implicit,r=d();return S(r.fwcPositionFunctionalityService.onContextMenuLoad(o.type,o.id,n,r.fwcTypesPositions[n.id],t))})("menuClick",function(t){let n=w(e).$implicit,o=d(3).$implicit,r=d();return S(r.fwcPositionFunctionalityService.onContextMenuHandler(r.fwcPolicyObject,void 0,o.firewall,o._fwcClusterId,o.id,n,r.fwcTypesPositions[n.id],t))})("menuOpening",function(t){w(e);let n=d(4);return S(n.adjustMenuPosition(t))}),T(5,"div",99),u()()()}if(l&2){let e=_.$implicit,i=d(4);a(),m("ngClass",jn(7,wr,e.highlighted,e.draggedOver,e.objectAllowed===!1,e.objectAllowed===!0)),a(2),m("ngForOf",e.ipobjs)("ngForTrackBy",i.positionObjectsTrackBy),a(),m("allowAnimation",!1)("customStyle",i.contextMenuStyle)("colorScheme",i.currentColorScheme)("settings",i.fwcPositionFunctionalityService.positionContextMenu.POSITION)}}function ya(l,_){if(l&1&&(dt(0),A(1,Ca,6,12,"td",96),_t()),l&2){let e=d(2).$implicit;a(),m("ngForOf",e.positions)}}function Ea(l,_){if(l&1){let e=L();c(0,"td")(1,"div",114)(2,"textarea",115),P("ngModelChange",function(t){w(e);let n=d(2).$implicit;return S(n.formModel.run_before||(n.formModel.cfg_text=t))})("focus",function(){w(e);let t=d(2).$implicit,n=d();return S(n.fwcRuleFunctionalityService.onScriptFocus(n.fwcPolicyObject,t))}),g(3,"            "),u()()()}if(l&2){let e=d(2).$implicit,i=d();Ke("colspan",(i.fwcSelectedPolicy==null?null:i.fwcSelectedPolicy._fwcClusterId)!==null&&(i.fwcSelectedPolicy==null?null:i.fwcSelectedPolicy._fwcClusterId)!==void 0?i.fwcSelectedPolicy._fwcPolicyType===i.POLICY_TYPES_FROM_NODES[i.NodeTypes.DHCP]||i.fwcSelectedPolicy._fwcPolicyType===i.POLICY_TYPES_FROM_NODES[i.NodeTypes.HAPROXY]?i.getColumnsCount()-1:i.getColumnsCount()-3:i.fwcSelectedPolicy._fwcPolicyType===i.POLICY_TYPES_FROM_NODES[i.NodeTypes.HAPROXY]?i.getColumnsCount()-2:i.getColumnsCount()-1),a(2),m("ngModel",e.formModel.run_before||e.formModel.cfg_text)}}function va(l,_){if(l&1){let e=L();c(0,"td")(1,"p-dropdown",116),J("ngModelChange",function(t){w(e);let n=d(2).$implicit;return Y(n.formModel.routingTableId,t)||(n.formModel.routingTableId=t),S(t)}),P("onChange",function(t){w(e);let n=d(2).$implicit,o=d();return S(o.fwcPolicyGridRoutingRulesFunctionalityService.handleChangeRoutingTable(n,t.value))}),u()()}if(l&2){let e=d(2).$implicit,i=d();a(),m("options",i.routingTablesItems),H("ngModel",e.formModel.routingTableId)}}function Ia(l,_){if(l&1&&(T(0,"i"),g(1)),l&2){let e=_.$implicit;je(e.icon),a(),x(" ",e.label," ")}}function ba(l,_){if(l&1&&(T(0,"i"),g(1)),l&2){let e=_.$implicit;je(e.icon),a(),x(" ",e.label," ")}}function Pa(l,_){if(l&1){let e=L();c(0,"p-dropdown",121),J("ngModelChange",function(t){w(e);let n=d(3).$implicit;return Y(n.formModel.action,t)||(n.formModel.action=t),S(t)}),P("onChange",function(){w(e);let t=d(3).$implicit,n=d();return S(n.fwcRuleFunctionalityService.updateRule(t))}),A(1,Ia,2,4,"ng-template",122)(2,ba,2,4,"ng-template",123),u()}if(l&2){let e=d(3).$implicit,i=d();m("options",i.fwActionsService.getActionsItems(e.special)),H("ngModel",e.formModel.action)}}function Ta(l,_){l&1&&(c(0,"span",110),T(1,"i",124),g(2," Accept established, related "),u())}function Oa(l,_){l&1&&(c(0,"div",128),T(1,"i",129),g(2),C(3,"translate"),T(4,"i",129),u()),l&2&&(a(2),x(" ",y(3,1,"RULE.DROP_MARK")," "))}function Ra(l,_){if(l&1){let e=L();c(0,"div",130),P("mouseenter",function(t){w(e);let n=d(4).$implicit,o=d();return S(o.fwcRuleFunctionalityService.showMarkInfo(n,t))})("mouseleave",function(t){w(e);let n=d(5);return S(n.fwcRuleFunctionalityService.clearMarkInfo(t))})("wheel",function(t){w(e);let n=d(5);return S(n.fwcRuleFunctionalityService.clearMarkInfo(t))})("dblclick",function(){w(e);let t=d(4).$implicit,n=d();return S(n.fwcPositionFunctionalityService.onMarkDblClickEvent(t.mark))}),c(1,"span",131),T(2,"i",132),g(3),u(),c(4,"div",133)(5,"i",134),P("click",function(){w(e);let t=d(4).$implicit,n=d();return S(n.fwcRuleFunctionalityService.onDeleteRuleMark(t))}),u()()()}if(l&2){let e=d(4).$implicit;a(3),x(" ",e.mark_name," ")}}function xa(l,_){if(l&1&&(c(0,"div",125,16),A(2,Oa,5,3,"div",126)(3,Ra,6,1,"div",127),u()),l&2){let e=d(3).$implicit;a(2),m("ngIf",!e.mark&&e.labelDraggedOverAction),a(),m("ngIf",e.mark)}}function Fa(l,_){if(l&1){let e=L();c(0,"td",117,15),P("dragenter",function(t){w(e);let n=fe(1),o=d(2).$implicit,r=d();return S(r.fwcRuleFunctionalityService.onActionDragEnter(o,t,n))})("dragleave",function(t){w(e);let n=fe(1),o=d(2).$implicit,r=d();return S(r.fwcRuleFunctionalityService.onActionDragLeave(o,t,n))})("dragover",function(t){w(e);let n=d(3);return S(n.fwcRuleFunctionalityService.onActionDragOver(t))})("drop",function(t){w(e);let n=fe(1),o=d(2).$implicit,r=d();return S(r.fwcRuleFunctionalityService.onActionDragDrop(o,t,n))}),c(2,"div",118),A(3,Pa,3,2,"p-dropdown",119)(4,Ta,3,0,"span",102)(5,xa,4,2,"div",120),u()()}if(l&2){let e=d(2).$implicit,i=d();a(3),m("ngIf",e.special!=i.SpecialPolicyRules.STATEFUL),a(),m("ngIf",e.special==i.SpecialPolicyRules.STATEFUL),a(),m("ngIf",e.special!=i.SpecialPolicyRules.STATEFUL)}}function Aa(l,_){if(l&1&&(c(0,"span"),T(1,"i"),C(2,"fwcIcon"),g(3,"\xA0 "),u()),l&2){let e=d(6);a(),je(y(2,3,e.ObjectTypes.OBJ_FIREWALL))}}function La(l,_){if(l&1&&(A(0,Aa,4,5,"span",49),g(1)),l&2){let e=_.$implicit;m("ngIf",e.value),a(),x(" ",e.label," ")}}function Ma(l,_){if(l&1&&(c(0,"span"),T(1,"i"),C(2,"fwcIcon"),g(3,"\xA0 "),u()),l&2){let e=d(6);a(),je(y(2,3,e.ObjectTypes.OBJ_FIREWALL))}}function Da(l,_){if(l&1&&(A(0,Ma,4,5,"span",49),g(1)),l&2){let e=_.$implicit;m("ngIf",e.value),a(),x(" ",e.label," ")}}function Na(l,_){if(l&1){let e=L();c(0,"p-dropdown",121),J("ngModelChange",function(t){w(e);let n=d(3).$implicit;return Y(n.formModel.fw_apply_to,t)||(n.formModel.fw_apply_to=t),S(t)}),P("onChange",function(){w(e);let t=d(3).$implicit,n=d();return S(n.fwcRuleFunctionalityService.handleChangeApplyTo(n.fwcPolicyObject,t))}),A(1,La,2,2,"ng-template",122)(2,Da,2,2,"ng-template",123),u()}if(l&2){let e=d(3).$implicit,i=d();m("options",i.clusterNodesItems),H("ngModel",e.formModel.fw_apply_to)}}function Ua(l,_){l&1&&(c(0,"span"),g(1),C(2,"translate"),u()),l&2&&(a(),x(" ",y(2,1,"RULE.ALL_NODES")," "))}function Ga(l,_){if(l&1&&(c(0,"td",135)(1,"div",118),A(2,Na,3,2,"p-dropdown",119)(3,Ua,3,3,"span",49),u()()),l&2){let e=d(2).$implicit,i=d();a(2),m("ngIf",!e.special||e.special==i.SpecialPolicyRules.HOOKSCRIPT||e.special==i.SpecialPolicyRules.FAIL2BAN),a(),m("ngIf",e.special&&e.special!=i.SpecialPolicyRules.HOOKSCRIPT&&e.special!=i.SpecialPolicyRules.FAIL2BAN)}}function Ba(l,_){if(l&1){let e=L();c(0,"td",97)(1,"div",118)(2,"input",136),J("ngModelChange",function(t){w(e);let n=d(2).$implicit;return Y(n.formModel.max_lease,t)||(n.formModel.max_lease=t),S(t)}),P("focus",function(){w(e);let t=d(2).$implicit,n=d();return S(n.fwcRuleFunctionalityService.onLeaseTimeFocus(t))})("blur",function(){w(e);let t=d(2).$implicit,n=d();return S(n.fwcRuleFunctionalityService.onLeaseTimeBlur(n.fwcPolicyObject,t))}),u()()()}if(l&2){let e=d(2).$implicit,i=d();a(2),m("id",i.max_lease_time),H("ngModel",e.formModel.max_lease)}}function ka(l,_){if(l&1){let e=L();c(0,"td",137)(1,"div",138)(2,"textarea",139),C(3,"translate"),J("ngModelChange",function(t){w(e);let n=d(2).$implicit;return Y(n.formModel.comment,t)||(n.formModel.comment=t),S(t)}),P("focus",function(){w(e);let t=d(2).$implicit,n=d();return S(n.fwcRuleFunctionalityService.onCommentFocus(t))})("blur",function(){w(e);let t=d(2).$implicit,n=d();return S(n.fwcRuleFunctionalityService.onCommentBlur(n.fwcPolicyObject,t))}),g(4,"            "),u()()()}if(l&2){let e=d(2).$implicit;a(),jt("max-height",e.heightPx+"px"),m("ngClass",ae(7,Sr,e.commentEdit)),a(),M("placeholder",y(3,5,"GLOBALS.DB_FIELDS.comment")),H("ngModel",e.formModel.comment)}}function ja(l,_){if(l&1){let e=L();dt(0),c(1,"tr",77),P("mouseenter",function(t){w(e);let n=d().$implicit,o=d();return S(o.onRuleEnter(n,t))}),c(2,"td",78),P("click",function(t){w(e);let n=d().$implicit,o=d();return S(o.fwcRuleFunctionalityService.selectRule(n,t))})("dblclick",function(){w(e);let t=d().$implicit,n=d();return S(n.fwcRuleFunctionalityService.editRule(t))}),c(3,"div",58),A(4,na,1,0,"div",79),c(5,"div",80)(6,"iui-contextmenu",81),P("menuOpening",function(t){w(e);let n=d().$implicit,o=d();return S(o.fwcRuleFunctionalityService.onContextMenuLoad(n,t))})("menuOpening",function(t){w(e);let n=d(2);return S(n.adjustMenuPosition(t))})("menuClick",function(t){w(e);let n=d().$implicit,o=d();return S(o.fwcRuleFunctionalityService.onContextMenuHandler(o.fwcPolicyObject,n,t))}),c(7,"div",82)(8,"div"),A(9,oa,3,0,"div",83),u(),c(10,"div")(11,"span",84),g(12),u(),T(13,"br"),A(14,la,2,0,"span",85)(15,ra,2,0,"span",49),u()()()()()(),A(16,ya,2,1,"ng-container",27)(17,Ea,4,2,"ng-template",null,11,Ve)(19,va,2,2,"td",49)(20,Fa,6,3,"td",86)(21,Ga,4,2,"td",87)(22,Ba,3,2,"td",88)(23,ka,5,9,"td",89),u(),_t()}if(l&2){let e=fe(18),i=d().$implicit,t=d();a(),jt("background-color",i.style&&t.RulesStylesBg[i.style]?t.RulesStylesBg[i.style]:i.style),_i("id","rule_",i.id,""),m("ngClass",jn(26,hr,t.isRuleSelected(i),!i.active,i.highlighted,i.special&&i.special!=t.SpecialPolicyRules.HOOKSCRIPT)),a(),m("pTooltip",t.fwcRuleFunctionalityService.setRuleTooltip(i))("escape",!1),a(2),m("ngIf",i.idgroup),a(2),m("allowAnimation",!1)("customStyle",t.contextMenuStyle)("colorScheme",t.currentColorScheme)("settings",i.type===t.SpecialPolicyTypes.ROUTING_TABLE?t.fwcRuleFunctionalityService.ruleContextMenu.ROUTE:i.type===t.SpecialPolicyTypes.POLICY_ROUTING?t.fwcRuleFunctionalityService.ruleContextMenu.ROUTING_RULE:i.type===t.POLICY_TYPES_FROM_NODES[t.NodeTypes.DHCP]||i.type===t.POLICY_TYPES_FROM_NODES[t.NodeTypes.DHCP_FIXED_IP]?t.fwcRuleFunctionalityService.ruleContextMenu.DHCP_RULE:i.type===t.POLICY_TYPES_FROM_NODES[t.NodeTypes.KEEPALIVED]?t.fwcRuleFunctionalityService.ruleContextMenu.KEEPALIVED_RULE:i.type===t.POLICY_TYPES_FROM_NODES[t.NodeTypes.HAPROXY]?t.fwcRuleFunctionalityService.ruleContextMenu.HAPROXY_RULE:t.fwcRuleFunctionalityService.ruleContextMenu.RULE),a(),jt("min-height",t.fwcPolicyGridFunctionalityService.calcRuleHeight(i),"px"),m("ngClass",i.idgroup?"fwcGroupCell":"fwcGridCell"),a(2),m("ngIf",!i.active),a(3),j(i._fwcRuleOrder),a(2),m("ngIf",i.options),a(),m("ngIf",i.run_before||i.run_after||i.special==t.SpecialPolicyRules.HOOKSCRIPT),a(),m("ngIf",i.special!=t.SpecialPolicyRules.HOOKSCRIPT&&i.special!=t.SpecialPolicyRules.FAIL2BAN)("ngIfElse",e),a(3),m("ngIf",(t.fwcSelectedPolicy==null?null:t.fwcSelectedPolicy._fwcPolicyType)===t.SpecialPolicyTypes.POLICY_ROUTING),a(),m("ngIf",(t.fwcSelectedPolicy==null?null:t.fwcSelectedPolicy.show_action)&&i.special!=t.SpecialPolicyRules.HOOKSCRIPT&&i.special!=t.SpecialPolicyRules.FAIL2BAN),a(),m("ngIf",(i==null?null:i._fwcClusterId)!==null&&(i==null?null:i._fwcClusterId)!==void 0&&t.fwcSelectedPolicy._fwcPolicyType!==t.POLICY_TYPES_FROM_NODES[t.NodeTypes.DHCP]&&t.fwcSelectedPolicy._fwcPolicyType!==t.POLICY_TYPES_FROM_NODES[t.NodeTypes.DHCP_FIXED_IP]&&t.fwcSelectedPolicy._fwcPolicyType!==t.POLICY_TYPES_FROM_NODES[t.NodeTypes.KEEPALIVED]&&t.fwcSelectedPolicy._fwcPolicyType!==t.POLICY_TYPES_FROM_NODES[t.NodeTypes.HAPROXY]),a(),m("ngIf",t.fwcSelectedPolicy._fwcPolicyType===t.POLICY_TYPES_FROM_NODES[t.NodeTypes.DHCP]&&i.special!==6),a(),m("ngIf",t.columnVisibility.comments&&i.special!=t.SpecialPolicyRules.HOOKSCRIPT)}}function Va(l,_){l&1&&T(0,"div",90)}function Wa(l,_){l&1&&(c(0,"div",91)(1,"span"),T(2,"i",92),u()())}function Ha(l,_){l&1&&(c(0,"span"),T(1,"i",142),u())}function Ya(l,_){l&1&&(c(0,"span"),T(1,"i",143),u())}function Ja(l,_){if(l&1&&(c(0,"tr",140)(1,"td",141),A(2,Va,1,0,"div",79),c(3,"div",82)(4,"div"),A(5,Wa,3,0,"div",83),c(6,"span",84),g(7),u(),T(8,"br"),A(9,Ha,2,0,"span",49)(10,Ya,2,0,"span",49),u()()(),T(11,"td"),u()),l&2){let e=d().$implicit,i=d();jt("height",e.heightPx+"px"),M("id","rule_"+e.id),a(2),m("ngIf",e.idgroup),a(),m("ngClass",e.idgroup?"fwcGroupCell":"fwcGridCell"),a(2),m("ngIf",!e.active),a(2),j(e._fwcRuleOrder),a(2),m("ngIf",e.options),a(),m("ngIf",e.run_before||e.run_after),a(),Ke("colSpan",i.getColumnsCount()-1)}}function Ka(l,_){if(l&1&&A(0,ja,24,31,"ng-container",27)(1,Ja,12,10,"ng-template",null,10,Ve),l&2){let e=_.$implicit,i=fe(2);m("ngIf",e.visible)("ngIfElse",i)}}var Ln=(()=>{class l{constructor(e,i,t,n,o,r,p,s,f,h,E,b,I,R,V,G,D,K,B,te,he,Ce,Ge,Pt,vt,Gt,Bn,$i,Zi,en){this.refService=e,this.fwcFirewallService=i,this.fwcPolicyService=t,this.fwcRoutingPolicyService=n,this.fwcRoutingTableService=o,this.fwcPositionService=r,this.itemSelectedService=p,this.ruleSelectedService=s,this.fwcContextMenuService=f,this.fwcRuleFunctionalityService=h,this.fwcPositionFunctionalityService=E,this.fwcPolicyGridFunctionalityService=b,this.fwcPolicyGridRoutingRulesFunctionalityService=I,this.fwcPolicyGridRoutingTableFunctionalityService=R,this.fwcDhcpPolicyService=V,this.fwcPolicyGridDhcpRulesFunctionalityService=G,this.fwcKeepalivedPolicyService=D,this.fwcPolicyGridKeepalivedRulesFunctionalityService=K,this.fwcHAProxyPolicyService=B,this.fwcPolicyGridHAProxyRulesFunctionalityService=te,this.fwcUserService=he,this.fwActionsService=Ce,this.fwcErrorPipe=Ge,this.confirmationService=Pt,this.messageService=vt,this.inputDataService=Gt,this.utilService=Bn,this.store=$i,this.cd=Zi,this.translate=en,this.contextMenuStyle=[al,cl,sl],this.applicationRef=null,this.contextMenuReference=null,this.ruleGroupsExpanded=[],this.fwcSelectedPolicy={},this.RulesStylesBg=xo,this.POLICY_TYPES_FROM_NODES=q,this.NodeTypes=X,this.gridColumns=[],this.selectedGridColumns=[],this.alive=!0,this.loadingData=!1,this.ObjectTypes=v,this.showPaginator=!1,this.MAX_ROWS_PER_PAGE=100,this.SpecialPolicyTypes=Ee,this.SpecialPolicyRules=tt,this.RoutingPolicyPositions=Pi,this.DhcpPolicyPositions=xe,this.KeepalivedPolicyPositions=Me,this.HAProxyPolicyPositions=ve,this.scrollerOptions={delay:100,appendOnly:!0,scrollHeight:"calc(99vh - 8.8rem)",autoSize:!1,onScroll:er=>{let Vi=er.originalEvent.target,ro=document.querySelector(".divTableScroll.fwcDivPadded.fwcDivPaddedTB");Vi.scrollTop>0?ro.classList.add("fwcSticky"):ro.classList.remove("fwcSticky");let tr={scrollTop:Vi.scrollTop,scrollHeight:Vi.scrollHeight,offsetTop:Vi.offsetTop,offsetHeight:Vi.offsetHeight};this.utilService.setGridScroll(tr)}},this.selectedRules=[],this.columnVisibility={applyTo:!0,comments:!0},this.fwcSelectedPolicy&&this.fwcSelectedPolicy._fwcPolicyType!==Ee.ROUTING_TABLE?this.msgNoRules={type:"warning",title:this.translate.instant("POLICY_GRID.ERR_EMPTY.SUMMARY"),text:this.translate.instant("POLICY_GRID.ERR_EMPTY.TEXT")}:this.msgNoRules={type:"warning",title:this.translate.instant("POLICY_GRID.ERR_EMPTY_ROUTING_TABLE.SUMMARY"),text:this.translate.instant("POLICY_GRID.ERR_EMPTY_ROUTING_TABLE.TEXT")}}ngAfterViewInit(){let e=this;setTimeout(function(){let i=e.refService.getAppRef();e.contextMenuReference=i,e.applicationRef=i},1),this.wheelListener=this.onWheelEvent.bind(this),window.addEventListener("wheel",this.wheelListener)}onWheelEvent(e){window.innerHeight>450&&this.closeContextMenu()}ngOnInit(){this.fwcPolicyService.reloadPolicy().pipe($(()=>this.alive)).subscribe(()=>{this.onPolicySelect(this.fwcSelectedPolicy,!0)}),this.store.pipe($(()=>this.alive),zt(Do)).subscribe(e=>{e==="dark"?this.currentColorScheme=Qn.Dark:this.currentColorScheme=Qn.Light}),this.fwcPolicyService.getSelectedPolicy().pipe($(()=>this.alive)).subscribe(e=>{this.onPolicySelect(e,e&&e._forcePolicyReload)}),this.ruleSelectedService.getSelectedRules().pipe($(()=>this.alive)).subscribe(e=>{this.selectedRules=e}),this.ruleSelectedService.getRuleStatus().pipe($(()=>this.alive)).subscribe(e=>{e||e===""?this.ruleStatus=e||this.translate.instant("GLOBALS.MSG_OP_RESULT.LOADING"):this.ruleStatus=null}),this.ruleSelectedService.getRuleHeightRecalculate().pipe($(()=>this.alive)).subscribe(e=>{let i=this.fwcPolicyObject.getPolicyRule(e);i&&this.fwcPolicyGridFunctionalityService.calcRuleHeight(i)}),this.ruleSelectedService.getModifiedRule().pipe($(()=>this.alive)).subscribe(e=>{if(e){let i;for(let t of this.fwcPolicyGridFunctionalityService.policyIterator(this.fwcPolicyObject.getPolicyRules()))if(t.id===e.id){i=t;break}i&&(i.options=e.options,i.run_before=e.run_before,i.run_after=e.run_after,this.fwcRuleFunctionalityService.setRuleTooltip(i),this.refreshComponent())}}),this.ruleSelectedService.getSelectedRuleRange().pipe($(()=>this.alive)).subscribe(e=>{let i=[];if(e){let t=this.fwcPolicyObject.getPolicyRules();for(let n=0;n<t.length;n++){let o=t[n];if(o.rule_group)for(let r=0;r<o.rules.length;r++){let p=o.rules[r];p.rule_order>=e.minRuleOrder&&p.rule_order<=e.maxRuleOrder&&i.push(p)}else o.rule_order>=e.minRuleOrder&&o.rule_order<=e.maxRuleOrder&&i.push(o)}}this.ruleSelectedService.setSelectedRules(i)}),this.ruleGroupContextMenu=this.fwcContextMenuService.getRuleGroupMenus(),this.fwcUserService.getFwcUser().pipe($(()=>this.alive)).subscribe(e=>{e&&(this.fwcUserObject=e,this.fwcUser=e.user_id,this.fwCloud=e.selectedFwCloud)}),this.itemSelectedService.getModifiedItem().pipe($(()=>this.alive)).subscribe(e=>{if(this.fwcPolicyObject){let i=this.fwcPolicyObject.getPolicyRules();if(i){if(e.deleteFromList){let t=null;for(let n of this.fwcPolicyGridFunctionalityService.policyIterator(i))if(e.srcRuleId==n.id){t=n;break}if(t&&t.positions){let n=null;for(let o=0;o<t.positions.length;o++){let r=t.positions[o];if(e.srcPositionId==r.id){n=r;break}}if(n&&n.ipobjs)for(let o=0;o<n.ipobjs.length;o++){let r=n.ipobjs[o];r._fwcObjId==e._fwcObjId&&r._fwcObjType==e._fwcObjType&&this.fwcPositionFunctionalityService.removeItemAt(n,o)}}}else if(e.highlightItem){for(let t of this.fwcPolicyGridFunctionalityService.policyIterator(this.fwcPolicyObject.getPolicyRules()))if(Array.isArray(t.positions))for(let n=0;n<t.positions.length;n++){let o=t.positions[n];if(Array.isArray(o.ipobjs))for(let r=0;r<o.ipobjs.length;r++){let p=o.ipobjs[r];p._fwcObjId==e._fwcObjId&&p._fwcObjType==e._fwcObjType?p.highlighted=e.highlighted:p.highlighted=!1}}}else if(e._fwcObjType!=v.OBJ_FIREWALL&&e._fwcObjType!=v.OBJ_CLUSTER){for(let t of this.fwcPolicyGridFunctionalityService.policyIterator(this.fwcPolicyObject.getPolicyRules()))if(Array.isArray(t.positions))for(let n=0;n<t.positions.length;n++){let o=t.positions[n];if(Array.isArray(o.ipobjs))for(let r=0;r<o.ipobjs.length;r++){let p=o.ipobjs[r];if(p._fwcObjId==e._fwcObjId&&p._fwcObjType==e._fwcObjType)for(let s of Object.keys(p))e[s]!==void 0&&(p[s]=e[s])}}if(e._fwcObjType===v.OBJ_MARK)for(let t of this.fwcPolicyGridFunctionalityService.policyIterator(this.fwcPolicyObject.getPolicyRules()))t.mark&&e._fwcObjId===t.mark&&(t.mark_name=e._fwcObjName,e.code&&(t.mark_code=e.code))}this.refreshComponent()}}}),this.utilService.getGridScroll().pipe($(()=>this.alive)).subscribe(e=>{this.fwcPolicyGridFunctionalityService.showRulesInViewport(this.fwcPolicyObject.getPolicyRules(),e)}),this.utilService.getGridScrollToTop().pipe($(()=>this.alive)).subscribe(()=>{setTimeout(()=>{this.policyTable.scrollTo({top:0})},100)}),this.cd.detectChanges()}ngOnDestroy(){this.alive=!1,this.wheelListener&&window.removeEventListener("wheel",this.wheelListener)}refreshComponent(){this.cd.destroyed||this.cd.detectChanges()}onPolicySelect(e,i){if(!e){Wt.log(">> Undefined selected policy");return}if(e._fwcFwId===null||e._fwcFwId===void 0){this.fwcTypesPositions=[],this.fwcPolicyPositions=[],this.fwcSelectedPolicy=e,this.fwcPolicyObject&&this.fwcPolicyObject.setPolicyRules(null),this.fwcPolicyService.setActualPolicy(null),this.refreshComponent();return}if(this.fwcSelectedPolicy&&e._fwcPolicyName!==this.fwcSelectedPolicy._fwcPolicyName&&(this.fwcSelectedPolicy._fwcPolicyName=e._fwcPolicyName),e.fwcloud!==null&&e.fwcloud!==void 0&&e.fwcloud!=this.fwCloud){this.confirmationService.confirm({header:"ERROR",icon:"fa fa-exclamation-circle fwcRed iconBig",message:this.translate.instant("POLICY_GRID.MSG_POL_LOAD_ERROR"),rejectVisible:!1,acceptLabel:"Ok"});return}e._fwcFwId!==null&&e._fwcFwId!==void 0&&this.fwcSelectedPolicy&&e._fwcFwId!=this.fwcSelectedPolicy._fwcFwId&&Wt.log(this.translate.instant("POLICY_GRID.MSG_POL_LOAD_FW"));let t={};i||(t._fwcSelectRuleId=e._fwcSelectRuleId,t._fwcSelectRulePositionIds=e._fwcSelectRulePositionIds,t._fwcSelectObjId=e._fwcSelectObjId,t._fwcSelectObjType=e._fwcSelectObjType),t._selectedRules=e._selectedRules;let n=this.fwcSelectedPolicy&&this.fwcSelectedPolicy._fwcFwId==e._fwcFwId&&this.fwcSelectedPolicy._fwcPolicyType==e._fwcPolicyType&&this.fwcSelectedPolicy._fwcObjId===e._fwcObjId;n&&!i?(this.clearHighlightedRules(),t._fwcSelectRuleId!==null&&t._fwcSelectRuleId!==void 0&&(this.highlightRule(t._fwcSelectRuleId,t._fwcSelectRulePositionIds),this.itemSelectedService.setSearchItem(t)),this.refreshComponent()):(this.loadingData=!0,this.refreshComponent(),this.fwcSelectedPolicy&&(this.fwcSelectedPolicy._fwcFwId!=e._fwcFwId||this.fwcSelectedPolicy._fwcPolicyType!=e._fwcPolicyType)&&(this.ruleGroupsExpanded=[],this.ruleSelectedService.clearClipboardRules(),this.ruleSelectedService.clearSelectedRules(),this.itemSelectedService.clearClipboardItem()),Promise.all([this.getPolicy(e._fwcFwId,e._fwcClusterId,e._fwcPolicyType,e._fwcObjId),this.getTypesPositions(),this.getClusterNodes(e._fwcClusterId),this.getRoutingTables(e._fwcFwId,e._fwcPolicyType)]).then(([o,r,p,s])=>{this.fwcPolicyObject=o;let f=o.getPolicyRules(),h=r.data,E=p.data,b=s.data;if(t._selectedRules&&this.ruleSelectedService.updateSelectedRules(t._selectedRules,f),this.clusterNodesItems=[{label:this.translate.instant("RULE.ALL_NODES"),value:null}],E&&Array.isArray(E)&&E.forEach(I=>{this.clusterNodesItems.push({label:I.name,value:I.id,icon:"&#x1F6E1;"})}),b){this.routingTablesItems=[];for(let I of b)this.routingTablesItems.push({label:I.name,value:I.id})}n||(this.fwcPolicyGridFunctionalityService.clearActualViewportInfo(),this.fwcPolicyGridFunctionalityService.resetMaximumRuleHeight(),this.utilService.setGridScrollToTop()),this.parsePolicy(f,h,e),this.ruleSelectedService.clearSelectedRules(),t._fwcSelectRuleId!==null&&t._fwcSelectRuleId!==void 0&&(this.highlightRule(t._fwcSelectRuleId,t._fwcSelectRulePositionIds),this.itemSelectedService.setSearchItem(t))}).catch(o=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(o)})}).finally(()=>{this.loadingData=!1,this.refreshComponent()}))}getPolicy(e,i,t,n){return new Promise((r,p)=>{switch(t){case Ee.POLICY_ROUTING:this.fwcRoutingPolicyService.getRoutingPolicyGrid(e,this.fwCloud).pipe($(()=>this.alive)).subscribe(s=>{let f=new On(this.utilService,this.fwcRoutingPolicyService,this.fwcPolicyGridRoutingRulesFunctionalityService,e,i,this.fwCloud,t,s.data);r(f)},s=>{p(s)});break;case Ee.ROUTING_TABLE:this.fwcRoutingTableService.getRoutingTableRoutesGrid(e,this.fwCloud,n).pipe($(()=>this.alive)).subscribe(s=>{let f=new si(this.utilService,this.fwcRoutingTableService,this.fwcPolicyGridRoutingTableFunctionalityService,e,i,this.fwCloud,t,s.data,n,this.fwcPolicyService.getActualSelectedPolicy()._fwcPolicyName);r(f)},s=>{p(s)});break;case q[X.DHCP]:this.fwcDhcpPolicyService.getDhcpPolicyGrid(e,this.fwCloud,1).pipe($(()=>this.alive)).subscribe(s=>{let f=new Ut(this.utilService,this.fwcDhcpPolicyService,this.fwcPolicyGridDhcpRulesFunctionalityService,e,i,this.fwCloud,t,s.data);r(f)},s=>{p(s)});break;case q[X.DHCP_FIXED_IP]:this.fwcDhcpPolicyService.getDhcpPolicyGrid(e,this.fwCloud,2).pipe($(()=>this.alive)).subscribe(s=>{let f=new Ut(this.utilService,this.fwcDhcpPolicyService,this.fwcPolicyGridDhcpRulesFunctionalityService,e,i,this.fwCloud,t,s.data);r(f)},s=>{p(s)});break;case q[X.KEEPALIVED]:this.fwcKeepalivedPolicyService.getKeepalivedPolicyGrid(e,this.fwCloud).pipe($(()=>this.alive)).subscribe(s=>{let f=new ii(this.utilService,this.fwcKeepalivedPolicyService,this.fwcPolicyGridKeepalivedRulesFunctionalityService,e,i,this.fwCloud,t,s.data);r(f)},s=>{p(s)});break;case q[X.HAPROXY]:this.fwcHAProxyPolicyService.getHAProxyPolicyGrid(e,this.fwCloud).pipe($(()=>this.alive)).subscribe(s=>{let f=new ni(this.utilService,this.fwcHAProxyPolicyService,this.fwcPolicyGridHAProxyRulesFunctionalityService,e,i,this.fwCloud,t,s.data);r(f)},s=>{p(s)});break;default:this.fwcPolicyService.getPolicy(e,t,this.fwCloud).pipe($(()=>this.alive)).subscribe(s=>{let f=new Rn(this.utilService,this.fwcPolicyService,this.fwcPositionFunctionalityService,this.fwcRuleFunctionalityService,e,i,this.fwCloud,t,s.data);r(f)},s=>{p(s)})}})}getTypesPositions(){return new Promise((i,t)=>{this.fwcPositionService.getTypesPositions().pipe($(()=>this.alive)).subscribe(n=>{i(n)},n=>{t(n)})})}getClusterNodes(e){return new Promise((t,n)=>{e!=null?this.fwcFirewallService.getClusterNodes(e,this.fwCloud).pipe($(()=>this.alive)).subscribe(o=>{t(o)},o=>{n(o)}):t({data:[]})})}getRoutingTables(e,i){return new Promise((n,o)=>{i===Ee.POLICY_ROUTING?this.utilService.fwcAPICall(this.fwcRoutingTableService.getRoutingTables.bind(this.fwcRoutingTableService),e,this.fwcUserService.getActualFwSelectedCloud()).then(r=>{n(r)}).catch(r=>{o(r)}):n({data:null})})}policyRowTrackBy(e,i){return i.id||null}positionObjectsTrackBy(e,i){return i.id||null}parsePolicy(e,i,t){return Z(this,null,function*(){let n=!1,o=[],r,p=0;if(!t||!e||!i){Wt.log("Wrong data in policy parsing");return}t._fwcUserId=this.fwcUser,t.show_action=!(t._fwcPolicyType===q[X.POLICY_SNAT]||t._fwcPolicyType===q[X.POLICY_DNAT]||t._fwcPolicyType===q[X.POLICY_ROUTING]||t._fwcPolicyType===q[X.ROUTING_TABLE]||t._fwcPolicyType===q[X.DHCP]||t._fwcPolicyType===q[X.DHCP_FIXED_IP]||t._fwcPolicyType===q[X.KEEPALIVED]||t._fwcPolicyType===q[X.HAPROXY]),Object.keys(e).length===0&&e.constructor===Object&&(e=[]);for(let s of e){p++,s._fwcRuleOrder=p,s._fwcUserId=this.fwcUser,s._fwcClusterId=t._fwcClusterId,s.formModel={action:s.action,comment:s.comment,fw_apply_to:s.fw_apply_to,mark:s.mark,style:s.style,active:s.active,run_before:s.run_before,routingTableId:s.routingTableId,max_lease:s.max_lease,cfg_text:s.cfg_text},s.idgroup&&(n=!0);let f=s.negate,h=[];if(f&&(h=f.split(" ").map(E=>Number(E))),Array.isArray(s.positions)){let E=0;for(let b=0;b<s.positions.length;b++){let I=s.positions[b],R=`${s.firewall}-${s.id}-${I.id}`;I.positionUID=R.split("").reduce(function(G,D){return G=(G<<5)-G+D.charCodeAt(0),G&G},0),I.rule=s.id;let V=+I.id;if(h&&h.findIndex(G=>G==V)!=-1&&(I.negate=!0),Array.isArray(I.ipobjs)){I.ipobjs.length>E&&(E=I.ipobjs.length);for(let G=0;G<I.ipobjs.length;G++){let D=I.ipobjs[G];D.position_order!=G+1&&(D.position_order=G+1),D.type=+D.type,D.type==v.OBJ_CONTINENT?D._fwcObjName=this.translate.instant("NODE_TYPES."+D.name):D.type==v.OBJ_COUNTRIE?D._fwcObjName=this.translate.instant("COUNTRIES."+D.name):D._fwcObjName=D.name,D._fwcObjType=D.obj_type=D.type,D._fwcObjId=D.id_obj=D.id,D._fwcFwId=D.parent_id=D.firewall_id,D._fwcFwName=D.firewall_name,D._fwcRuleId=s.id,D._fwcPositionId=I.id,D._fwcUserId=this.fwcUser,D._fwcOpenVPNId=D.openvpn,D.cluster_id!==void 0&&D.cluster_id!==null&&(D.parent_id=D._fwcClusterId=D.cluster_id),D.host_id!==void 0&&D.host_id!==null&&(D.parent_id=D._fwcHostId=D.host_id)}}else I.ipobjs=[];I.ipobjs.push({_fwcObjId:v.OBJ_ANY,_fwcObjName:`${s.special==tt.CROWDSEC&&I.name=="Source"?"":"(Any)"}`,_fwcObjType:v.OBJ_ANY,allowDrag:!1,hidden:!0})}this.fwcPolicyGridFunctionalityService.calcRuleHeight(s,E)}}e[0]&&e[0].positions&&(r=e[0].positions);for(let s of i){let f=s.type,h=s.position;o[h]||(o[h]=[]),o[h].push(f)}n&&(e=this.parsePolicyWithGroups(e)),this.fwcPolicyGridFunctionalityService.showRulesInViewport(e),this.fwcTypesPositions=o,this.fwcPolicyObject.setPolicyRules(e),this.fwcPolicyPositions=r,this.fwcSelectedPolicy=t,this.numberOfGridColumns=r?r.length+2:0,this.fwcSelectedPolicy._fwcClusterId!==null&&this.fwcSelectedPolicy._fwcClusterId!==void 0&&this.numberOfGridColumns++,this.fwcSelectedPolicy.show_action&&this.numberOfGridColumns++,this.fwcSelectedPolicy._fwcPolicyType===Ee.POLICY_ROUTING&&this.numberOfGridColumns++,this.fwcSelectedPolicy._fwcPolicyType===q[X.DHCP]&&this.numberOfGridColumns++,this.fwcSelectedPolicy._fwcPolicyType===q[X.DHCP_FIXED_IP]&&this.numberOfGridColumns++,this.fwcSelectedPolicy._fwcPolicyType===q[X.KEEPALIVED]&&this.numberOfGridColumns++,this.fwcSelectedPolicy._fwcPolicyType===q[X.HAPROXY]&&this.numberOfGridColumns++,this.fwcPolicyService.setActualPolicy(e)})}parsePolicyWithGroups(e){let i=[];for(let t=0;t<e.length;t++){let n=e[t];if(!n.idgroup)i.push(n);else{let o=n.idgroup,r={rule_group:!0,idgroup:o,group_name:n.group_name,group_style:n.group_style,rules:[],groupHide:!0};this.fwcPolicyGridFunctionalityService.calcRuleHeight(r),this.ruleGroupsExpanded.findIndex(s=>s==r.idgroup)!=-1&&(r.groupHide=!1);let p;for(p=t;p<e.length&&e[p].idgroup==o;p++)r.rules.push(e[p]);i.push(r),t=p-1}}return i}isRuleSelected(e){for(let i=0;i<this.selectedRules.length;i++)if(this.selectedRules[i].id==e.id)return!0;return!1}clearHighlightedRules(){let e=this.fwcPolicyObject.getPolicyRules();if(e){let i=[],t=e;if(t&&t.length)for(i.push(...t);i.length;){let n=i.pop();if(n.highlighted&&delete n.highlighted,n.positions)for(let o=0;o<n.positions.length;o++)n.positions[o].highlighted&&delete n.positions[o].highlighted;n.rule_group&&n.rules&&n.rules.length&&i.push(...n.rules)}}}highlightRule(e,i){this.expandGroup(e);let t=this.fwcPolicyObject.getPolicyRules();if(t){let n=t;if(n&&n.length)for(let s=0;s<n.length;s++){let f=n[s];if(f.rule_group&&f.rules&&f.rules.length)for(let h=0;h<f.rules.length;h++){let E=f.rules[h];if(E.id===e){this.highlightRulePosition(E,i);break}}else if(f.id===e){this.highlightRulePosition(f,i);break}}this.refreshComponent();let o=document.querySelector("#rule_"+e),r=0,p=Array.from(document.querySelectorAll("tr"));for(let s of p)r+=s.clientHeight;if(o){let s=o.clientHeight,f=r;r=0;for(let h of p){if(h===o)break;r+=h.clientHeight}r<f&&(r-=s),this.policyTable.scrollTo({top:r,behavior:"smooth"})}}}highlightRulePosition(e,i){let t=!1;if(Array.isArray(i)||(i=[]),e&&e.positions){for(let n=0;n<e.positions.length;n++){let o=e.positions[n];i.find(r=>r===o.id)&&(o.highlighted=!0,t=!0,setTimeout(()=>{o.highlighted=!1,this.refreshComponent()},4e3))}t||(e.highlighted=!0,setTimeout(()=>{e.highlighted=!1,this.refreshComponent()},4e3))}}expandGroup(e){let i=this.fwcPolicyObject.getPolicyRules();if(i){let t=i;if(t&&t.length){for(let n=0;n<t.length;n++)if(t[n].rule_group){let o=t[n],r=o.rules;r&&r.length&&r.find(s=>s.id===e)&&this.toggleGroupVisible(o,!1)}}}}toggleGroupVisible(e,i){i===!0||i===!1?e.groupHide=i:e.groupHide=!e.groupHide,!e.groupHide&&this.ruleGroupsExpanded.findIndex(t=>t===e.idgroup)==-1&&this.ruleGroupsExpanded.push(e.idgroup),e.groupHide&&(this.ruleGroupsExpanded=this.ruleGroupsExpanded.filter(t=>t!==e.idgroup)),this.fwcPolicyGridFunctionalityService.showRulesInViewport(this.fwcPolicyObject.getPolicyRules())}createNewRule(e){e.newPolicyRule()}policyReload(e){let i={};i=Object.assign(this.fwcSelectedPolicy),i._forcePolicyReload=!0,e&&(i._selectedRules=e.slice(0)),this.fwcPolicyService.setSelectedPolicy(i)}onRuleEnter(e,i){e.highlighted&&delete e.highlighted,this.itemSelectedService.setObjectInfo(void 0,i)}contextMenuLoad(e,i){let t=this.ruleGroupContextMenu.RULE_GROUP.items;if(t)for(let n=0;n<t.length;n++){let o=t[n];o.id==U.FOLDER_EXPAND?o.visible=!!e.groupHide:o.id==U.FOLDER_COLLAPSE&&(o.visible=!e.groupHide)}}contextMenuHandler(e,i,t){let n=i.rules[0];if(t.detail.item)switch(t.detail.item.id){case U.FOLDER_EXPAND:case U.FOLDER_COLLAPSE:this.toggleGroupVisible(i);break;case U.RULE_GROUP_EDIT:case U.RULE_GROUP_COLOR_CHANGE:{let o={id:n.idgroup,fwcloud:this.fwcUserService.getActualFwSelectedCloud(),firewall:n.firewall,style:i.group_style,name:i.group_name,comment:void 0,groupIds:[]},r={header:this.translate.instant("POLICY_GRID.GR_NAME.HEADER"),helpText:this.translate.instant("POLICY_GRID.GR_NAME.TEXT"),formControls:[{name:"groupData",type:"hidden",value:o},{name:"group",type:"hidden",value:i},{name:"policyType",type:"hidden",value:e.getPolicyType()}],onAccept:e.setRuleGroupNameApiCall()};t.detail.item.id==U.RULE_GROUP_EDIT?(r.formControls.push({name:"groupName",label:this.translate.instant("POLICY_GRID.GR_NAME.NAME"),type:"text",required:!0,value:i.group_name}),this.inputDataService.setInputData(r)):(r.formControls.push({name:"groupColor",placeholder:this.translate.instant("RULE.COLOR_PLACEHOLDER"),type:"colorpicker",value:i.group_style}),r.header=this.translate.instant("RULE.COLOR_HEADER"),r.helpText=this.translate.instant("RULE.GROUP_COLOR_TEXT"),r.onAccept=e.setRuleGroupStyleApiCall(),this.inputDataService.setInputData(r));break}case U.RULE_REMOVE_GROUP:n.idgroup&&this.confirmationService.confirm({header:this.translate.instant("GLOBALS.MSG_CONFIRM"),icon:"fa fa-question-circle fwcBlue iconBig",message:this.translate.instant("POLICY_GRID.GR_DELETE",{name:n.group_name}),rejectVisible:!0,rejectLabel:"No",acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.YES"),accept:()=>{e.deleteRuleGroupApiCall(n.idgroup).then(o=>{this.store.dispatch(me.reloadDialog({dialogUuids:[ee.ITEM_PANEL]}));let r=[];r.push(n),this.policyReload(r)}).catch(o=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(o)})})}});break}}onKeyup(e){if(e&&e.key&&e.target.nodeName==="BODY"){let i=e.key.toUpperCase(),t=e.ctrlKey,n=e.shiftKey;if(t){let o=this.ruleSelectedService.getActualSelectedRules(),r=this.ruleSelectedService.getActualClipboardRules();if(i=="C"&&o&&(e.preventDefault(),this.ruleSelectedService.copyRulesToClipboard()),i=="X"&&o&&(e.preventDefault(),this.ruleSelectedService.cutRulesToClipboard()),i=="V"&&o&&r){e.preventDefault();let p=U.PASTE_BELOW,s=o[o.length-1];n&&(p=U.PASTE_ABOVE,s=o[0]),this.fwcRuleFunctionalityService.pasteSelectedRules(this.fwcPolicyObject,s,r,p)}if((i==="ARROWUP"||i==="ARROWDOWN")&&o){e.preventDefault();let p=o[o.length-1],s=U.RULE_MOVE_BELOW;i==="ARROWUP"&&(p=o[0],s=U.RULE_MOVE_ABOVE);let f;f=this.fwcRuleFunctionalityService.newRulesData(p,o,s,ne.CUT),this.fwcRuleFunctionalityService.moveSelectedRules(p,f)}}if(i=="DELETE"){let o=this.ruleSelectedService.getActualSelectedRules();if(e.preventDefault(),o){let r=o[0];this.fwcRuleFunctionalityService.deleteSelectedRules(this.fwcPolicyObject,r,o,U.RULE_DELETE)}}}}getPolicyRulesLength(){let e=0,i=this.fwcPolicyObject.getPolicyRules();if(i)for(let t=0;t<i.length;t++){let n=i[t];n.rules?e+=n.rules.length:e++}return e}onPageChange(e){this.refreshComponent()}getColumnsCount(){let e=this.numberOfGridColumns;return this.columnVisibility.comments===!1&&(e-=1),this.fwcSelectedPolicy&&this.fwcSelectedPolicy._fwcClusterId!==null&&this.fwcSelectedPolicy._fwcClusterId!==void 0&&this.fwcSelectedPolicy._fwcPolicyType!==Ee.ROUTING_TABLE&&this.fwcSelectedPolicy._fwcPolicyType!==Ee.POLICY_ROUTING&&this.fwcSelectedPolicy._fwcPolicyType!==q[X.DHCP]&&this.fwcSelectedPolicy._fwcPolicyType!==q[X.DHCP_FIXED_IP]&&this.fwcSelectedPolicy._fwcPolicyType!==q[X.KEEPALIVED]&&this.fwcSelectedPolicy._fwcPolicyType!==q[X.HAPROXY]&&this.columnVisibility.applyTo===!1&&(e-=1),this.fwcSelectedPolicy&&this.fwcSelectedPolicy._fwcPolicyType===q[X.DHCP_FIXED_IP]?(e-=1,this.fwcSelectedPolicy._fwcClusterId!==null&&this.fwcSelectedPolicy._fwcClusterId!==void 0&&(e-=1)):this.fwcSelectedPolicy&&this.fwcSelectedPolicy._fwcPolicyType===q[X.DHCP]&&this.fwcSelectedPolicy._fwcClusterId!==null&&this.fwcSelectedPolicy._fwcClusterId!==void 0?e-=1:this.fwcSelectedPolicy&&this.fwcSelectedPolicy._fwcPolicyType===q[X.HAPROXY]&&this.fwcSelectedPolicy._fwcClusterId!==null&&this.fwcSelectedPolicy._fwcClusterId!==void 0&&(e-=2),e}isObjectTypesValid(e){return[v.OBJ_INTERFACE_FIREWALL,v.OBJ_ADDRESS,v.OBJ_OPENVPN_PREFIX,v.OBJ_DHCP_RULE_INTERFACE,v.OBJ_VPN_CONFIG_CLI].includes(e)}isPolicyNotInSelected(e){return![q[X.HAPROXY],q[X.DHCP]].includes(e)}adjustMenuPosition(e){requestAnimationFrame(()=>{let i=document.querySelector("iui-contextmenu-win");i&&(i.classList.add("context-menu-hidden"),setTimeout(()=>{if(i&&i.shadowRoot){let n=i.shadowRoot.querySelector('[data-ctrl="contextmenu-win"]');if(n){let o=n.getBoundingClientRect(),r=window.innerHeight,p=window.innerWidth,s=e.detail.event.pageX,f=e.detail.event.pageY,h=f,E=s;f+o.height>r&&(h=f-o.height,h<0&&(h=0)),s+o.width>p&&(E=s-o.width,E<0&&(E=0)),n.style.top=`${h}px`,n.style.left=`${E}px`,i.classList.remove("context-menu-hidden"),i.classList.add("context-menu-visible")}}},30))})}closeContextMenu(){setTimeout(()=>{let e=document.querySelector("iui-contextmenu-win");if(e&&e.shadowRoot){let t=e.shadowRoot.querySelector('[data-ctrl="contextmenu-win"]');t&&(t.style.display="none")}},50)}static{this.\u0275fac=function(i){return new(i||l)(F(Ao),F(oe),F(de),F(Uo),F(un),F(_n),F(De),F(Fe),F(Oi),F(Pn),F(Tn),F(gn),F(Cn),F(ti),F($t),F(xn),F(Gi),F(Fn),F(Bi),F(An),F(se),F(an),F(we),F(Ie),F(_e),F(Ct),F(ue),F(pe),F(ie),F(ce))}}static{this.\u0275cmp=Le({type:l,selectors:[["sts-fwc-policy-grid"]],viewQuery:function(i,t){if(i&1&&(Se(cr,5),Se(pr,5)),i&2){let n;le(n=re())&&(t.gridPaginator=n.first),le(n=re())&&(t.policyTable=n.first)}},hostBindings:function(i,t){i&1&&P("keyup",function(o){return t.onKeyup(o)},!1,mo)},features:[$e([oe,_n,Pn,Tn,gn,Cn,ti,xn,Fn,An])],decls:8,vars:4,consts:[["fwcGridRule",""],["showFwHeader",""],["showTable",""],["noData",""],["policyTable",""],["ruleGroup",""],["ruleNormal",""],["noRulesInGroup",""],["gridPaginator",""],["paginatorInfo",""],["showRulePlaceholder",""],["specialHookScriptRulePlaceholder",""],["fwcPositionEl",""],["objectName",""],["labelName",""],["tdActionPosition",""],["divMarkContainer",""],["class","fwc-centerHV fwcIconHeader",4,"ngIf"],["class","divTableScroll fwcDivPadded fwcDivPaddedTB",4,"ngIf"],[3,"blocked"],[1,"divCenterHV"],["class","divGridLoader",4,"ngIf"],[1,"fwc-centerHV","fwcIconHeader"],[1,"fa","fa-eye"],[1,"divTableScroll","fwcDivPadded","fwcDivPaddedTB"],[1,"divFormHeader","fwcHead"],[1,"fwcLeftIcon"],[4,"ngIf","ngIfElse"],[1,"fwcBlue"],[1,"fwcSep"],[1,"fwc-right-float"],["type","button","class","mr-2 ml-2","icon","pi pi-cog",3,"click",4,"ngIf"],["pButton","","icon","fwcMenuIcon fwci-loadpolicy",1,"p-button-primary",3,"click","label"],[4,"ngIf","ngIfThen","ngIfElse"],["aria-hidden","true",1,"fwcMenuIcon","fwci-cluster","fwcOrange"],["aria-hidden","true",1,"fwcMenuIcon","fwci-firewall","fwcOrange"],["type","button","icon","pi pi-cog",1,"mr-2","ml-2",3,"click"],["position","right",3,"visibleChange","visible","baseZIndex"],[1,"grid"],[1,"col-12"],[1,"fwcBlue","botBorder"],["class","col-12",4,"ngIf"],["name","comments","binary","true",3,"ngModelChange","label","ngModel"],["pButton","","type","button",1,"p-button-secondary",3,"click","label"],[1,"p-table-wrapper"],["styleClass","fwcGridTable",3,"value","rowTrackBy","resizableColumns","scrollable","virtualScrollOptions","virtualScroll","virtualScrollItemSize"],["pTemplate","colgroup"],["pTemplate","header"],["pTemplate","body"],[4,"ngIf"],[4,"ngFor","ngForOf"],[2,"text-align","center"],["pResizableColumn","",3,"width",4,"ngFor","ngForOf"],["pResizableColumn","",4,"ngIf"],["pResizableColumn","","style","width:6rem",4,"ngIf"],["pResizableColumn",""],["pResizableColumn","",2,"width","6rem"],[1,"fwcGridGroup"],[1,"context-menu-wrapper"],["contextMenuRef","contextMenuReference",3,"menuOpening","menuClick","allowAnimation","customStyle","colorScheme","settings"],[1,"clickable-area",2,"padding","0.5rem"],[3,"click"],["class","fa fa-fw fa-chevron-down","aria-hidden","true",4,"ngIf"],["class","fa fa-fw fa-chevron-right","aria-hidden","true",4,"ngIf"],["showDelay","700","tooltipPosition","bottom",1,"spanGroupName",3,"pTooltip","escape"],["aria-hidden","true",1,"fwcMenuIcon","fwci-objectgroup","fwcOrange"],[1,"fwcSepShort"],["aria-hidden","true",1,"fa","fa-fw","fa-chevron-down"],["aria-hidden","true",1,"fa","fa-fw","fa-chevron-right"],[4,"ngFor","ngForOf","ngForTrackBy"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"onPageChange","rows","totalRecords","alwaysShow","templateLeft"],[1,"p-paginator-current"],[3,"message"],[1,"divCentered"],["type","button","pButton","","icon","fa fa-plus",3,"click","label"],[1,"divGridLoader"],[3,"mouseenter","id","ngClass"],["showDelay","700","tooltipPosition","bottom",1,"fwc-centered",2,"filter","none !important",3,"click","dblclick","pTooltip","escape"],["class","fwcGroupSpacerDiv",4,"ngIf"],[1,"clickable-area"],[3,"menuOpening","menuClick","allowAnimation","customStyle","colorScheme","settings"],[1,"fwcCont",3,"ngClass"],["class","leftRibbon",4,"ngIf"],[1,"fwcRuleOrder"],["class","fwcRuleOptions",4,"ngIf"],["class","fwcActionPosition tdActionCell p-resizable-column",3,"dragenter","dragleave","dragover","drop",4,"ngIf"],["class","fwcActionPosition p-resizable-column",4,"ngIf"],["class","fwcPositionTd p-resizable-column",4,"ngIf"],["class","fwcCommentPosition p-resizable-column",4,"ngIf"],[1,"fwcGroupSpacerDiv"],[1,"leftRibbon"],[1,"fa","fa-times","fwcWhite"],[1,"fwcRuleOptions"],[1,"fa","fa-fw","fa-cog","fwcBlue"],[1,"fa","fa-file-code","fwcOrange"],["class","fwcPositionTd p-resizable-column",4,"ngFor","ngForOf"],[1,"fwcPositionTd","p-resizable-column"],[1,"divFwcPosition",3,"dragenter","dragleave","dragover","drop","ngClass"],[2,"height","100%","width","100%"],[1,"divFwcPosition-item",3,"click","dblclick","mouseenter","mouseleave","dragstart","ngClass","draggable"],["class","fwcIcon fwci-negateposition fwcRed","aria-hidden","true",4,"ngIf"],["class","spanActionSpecial",4,"ngIf"],[1,"fwc-label-grid"],["class","fwcPaleDark",4,"ngIf"],[1,"fwc-label-grid-name"],["aria-hidden","true","width","18","height","18",3,"class","src",4,"ngIf"],["aria-hidden","true",3,"class",4,"ngIf"],["aria-hidden","true"],["aria-hidden","true",1,"fwcIcon","fwci-negateposition","fwcRed"],[1,"spanActionSpecial"],[1,"fwcIcon","fwci-address","fwcBlue"],[1,"fwcPaleDark"],["aria-hidden","true","width","18","height","18",3,"src"],[1,"fwcTextArea"],["ondragstart","() => {return false}","ondrop","() => {return false}",2,"border","0",3,"ngModelChange","focus","ngModel"],["appendTo","body",3,"ngModelChange","onChange","options","ngModel"],[1,"fwcActionPosition","tdActionCell","p-resizable-column",3,"dragenter","dragleave","dragover","drop"],[1,"divFwcPosition"],["styleClass","dropDownAction",3,"options","ngModel","ngModelChange","onChange",4,"ngIf"],["class","divMarkContainer",4,"ngIf"],["styleClass","dropDownAction",3,"ngModelChange","onChange","options","ngModel"],["pTemplate","selectedItem"],["pTemplate","item"],[1,"fa","fa-fw","fa-check","fwcOrange"],[1,"divMarkContainer"],["class","divMarkPlaceholder",4,"ngIf"],["class","divMark",3,"mouseenter","mouseleave","wheel","dblclick",4,"ngIf"],[1,"divMarkPlaceholder"],["aria-hidden","true",1,"fa","fa-arrow-circle-down","fwcGreen"],[1,"divMark",3,"mouseenter","mouseleave","wheel","dblclick"],[1,"divMark--label"],[1,"fwci2-label"],[1,"divMark--button"],[1,"fa","fa-times",3,"click"],[1,"fwcActionPosition","p-resizable-column"],["name","max_lease_time","type","number",2,"text-align","right",3,"ngModelChange","focus","blur","id","ngModel"],[1,"fwcCommentPosition","p-resizable-column"],[3,"ngClass"],["maxlength","255","ondragstart","() => {return false}","ondrop","() => {return false}",3,"ngModelChange","focus","blur","ngModel","placeholder"],[1,"fwcRulePlaceholder",3,"id"],[1,"fwc-centered",2,"filter","none !important"],[1,"fa","fa-cog","fwcBlue"],[1,"fa","fa-terminal","fwcOrange"]],template:function(i,t){i&1&&(A(0,gr,4,3,"h1",17)(1,ta,24,14,"div",18),c(2,"p-blockUI",19)(3,"div",20),T(4,"p-progressSpinner"),u()(),A(5,ia,4,4,"div",21)(6,Ka,3,2,"ng-template",null,0,Ve)),i&2&&(m("ngIf",!(t.fwcPolicyObject!=null&&t.fwcPolicyObject.getPolicyRules())),a(),m("ngIf",!!(t.fwcPolicyObject!=null&&t.fwcPolicyObject.getPolicyRules())),a(),m("blocked",t.loadingData),a(3),m("ngIf",t.ruleStatus))},styles:[".fwcTableContainer[_ngcontent-%COMP%]{overflow-x:auto;overflow-y:hidden;box-sizing:border-box;padding-right:1.5rem}.fwcSticky[_ngcontent-%COMP%]{padding-top:0!important}div.fwcDivRPad[_ngcontent-%COMP%]{padding-right:1.5rem!important}.divGridLoader[_ngcontent-%COMP%]{display:flex;align-items:center;position:fixed;bottom:1rem;left:50%;transform:translate(-50%);padding:.2rem 1rem;background:#ffffffb3;border-radius:1rem}.divGridLoader[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-left:.3rem}.id-column[_ngcontent-%COMP%]{min-width:100%;min-height:44px;height:100%}.max-lease[_ngcontent-%COMP%]{min-height:44px}.context-menu-wrapper[_ngcontent-%COMP%]{width:100%;height:100%}.clickable-area[_ngcontent-%COMP%]{display:block;width:100%;height:100%}[_nghost-%COMP%]     p-button .p-button{width:2.357rem;padding:8px}tr[_ngcontent-%COMP%]{height:100%}  .fwc-right-float button{margin-bottom:2px}  .context-menu-hidden{opacity:0;transform:scale(.95)}  .context-menu-visible{transition:opacity .4s ease,transform .4s ease;opacity:1;transform:scale(1)}"],changeDetection:0})}}return l})();var za=["fwcTreeAccordion"],qa=["sts-fwc-tree-accordion",""],Qa=["*"],xl=(()=>{class l{hostWindowResize(){this.subjectWindowResized.next(void 0)}constructor(){this.subjectWindowResized=new pi,this.alive=!0}ngOnInit(){}ngAfterViewInit(){this.containerHeight=this.fwcTreeAccordion.nativeElement.offsetHeight,this.calcPanels(),this.treePanels.forEach(e=>{e.onChange().pipe($(()=>this.alive)).subscribe(()=>{this.calcPanels()})}),this.onWindowResize().pipe(di(300),$(()=>this.alive)).subscribe(()=>{this.containerHeight=this.fwcTreeAccordion.nativeElement.offsetHeight,this.calcPanels()})}ngOnDestroy(){this.alive=!1}calcPanels(){let e=0,i=[],t,n=0;if(this.treePanels){if(this.treePanels.forEach(o=>{e+=o.expanded?0:1,n||(n=o.getMinHeight()),i.push(o)}),e<i.length){t=(this.containerHeight-e*n)/(i.length-e);for(let o=0;o<i.length;o++){let r=i[o];r.expanded?r.setHeight(t):r.setHeight(n)}}for(let o=0;o<i.length;o++){let r=i[o];setTimeout(()=>{r.divContent.nativeElement.querySelector("iui-treeview").updateLayout()},300)}}}onWindowResize(){return this.subjectWindowResized.asObservable()}static{this.\u0275fac=function(i){return new(i||l)}}static{this.\u0275cmp=Le({type:l,selectors:[["","sts-fwc-tree-accordion",""]],contentQueries:function(i,t,n){if(i&1&&ui(n,vn,4),i&2){let o;le(o=re())&&(t.treePanels=o)}},viewQuery:function(i,t){if(i&1&&Se(za,5),i&2){let n;le(n=re())&&(t.fwcTreeAccordion=n.first)}},hostBindings:function(i,t){i&1&&P("resize",function(){return t.hostWindowResize()},!1,fo)},attrs:qa,ngContentSelectors:Qa,decls:3,vars:0,consts:[["fwcTreeAccordion",""],[1,"fwcTreeAccordion"]],template:function(i,t){i&1&&(Yi(),c(0,"div",1,0),Ji(2),u())},styles:[".fwcTreeAccordion[_ngcontent-%COMP%]{box-sizing:border-box;width:100%;height:100%;padding-left:.5rem;padding-right:.5rem}"]})}}return l})();function es(l,_){l&1&&(c(0,"div",7)(1,"h6",8),T(2,"i",9),g(3),C(4,"translate"),u()()),l&2&&(a(3),x(" ",y(4,1,"COMPILE.FORM.SELECT")," "))}function ts(l,_){l&1&&(c(0,"div",7)(1,"h6",8),T(2,"i",10),g(3),C(4,"translate"),u()()),l&2&&(a(3),x(" ",y(4,1,"COMPILE.FORM.COMP_INST")," "))}function is(l,_){if(l&1&&A(0,es,5,3,"div",7)(1,ts,5,3,"div",7),l&2){let e=d();O(e.displaySelectOptions?0:-1),a(),O(e.displayCompileOptions?1:-1)}}function ns(l,_){if(l&1&&(c(0,"span"),T(1,"i",17),g(2),u()),l&2){let e=d().$implicit;a(2),x("\xA0",e.name," ")}}function os(l,_){if(l&1&&(c(0,"span"),T(1,"i",18),g(2,"\xA0"),c(3,"strong"),g(4),u(),g(5," ("),c(6,"strong"),g(7),u(),g(8),u()),l&2){let e=d().$implicit;a(4),j(e.name),a(3),j(e.fwnodes==null?null:e.fwnodes.length),a(),x(" node",(e.fwnodes==null?null:e.fwnodes.length)>1?"s":"",") ")}}function ls(l,_){if(l&1&&(c(0,"span"),g(1),C(2,"date"),u()),l&2){let e=d().$implicit;a(),j(mi(2,1,e.compiled_at,"yyyy-MM-dd HH:mm:ss"))}}function rs(l,_){l&1&&(c(0,"span"),g(1,"-"),u())}function as(l,_){if(l&1&&(c(0,"span"),g(1),C(2,"date"),u()),l&2){let e=d().$implicit;a(),j(mi(2,1,e.installed_at,"yyyy-MM-dd HH:mm:ss"))}}function ss(l,_){l&1&&(c(0,"span"),g(1,"-"),u())}function cs(l,_){if(l&1){let e=L();c(0,"tr")(1,"td"),A(2,ns,3,1,"span")(3,os,9,3,"span"),u(),c(4,"td")(5,"p-checkbox",16),J("ngModelChange",function(t){let n=w(e).$index,o=d(3);return Y(o.compileChecks[n],t)||(o.compileChecks[n]=t),S(t)}),P("onChange",function(t){w(e);let n=d(3);return S(n.checkCompileInstallCheckboxes(t))}),u()(),c(6,"td")(7,"p-checkbox",16),J("ngModelChange",function(t){let n=w(e).$index,o=d(3);return Y(o.installChecks[n],t)||(o.installChecks[n]=t),S(t)}),P("onChange",function(t){w(e);let n=d(3);return S(n.checkCompileInstallCheckboxes(t))}),u()(),c(8,"td"),A(9,ls,3,4,"span")(10,rs,2,0,"span"),u(),c(11,"td"),A(12,as,3,4,"span")(13,ss,2,0,"span"),u()()}if(l&2){let e=_.$implicit,i=_.$index,t=d(3);a(2),O(e.cluster===null?2:-1),a(),O(e.cluster!==null?3:-1),a(2),m("name","compile_"+e.id),H("ngModel",t.compileChecks[i]),m("binary",!0),a(2),m("name","install_"+e.id),H("ngModel",t.installChecks[i]),m("binary",!0),a(2),O(e!=null&&e.compiled_at?9:-1),a(),O(e!=null&&e.compiled_at?-1:10),a(2),O(e!=null&&e.installed_at?12:-1),a(),O(e!=null&&e.installed_at?-1:13)}}function ps(l,_){if(l&1){let e=L();c(0,"div",11)(1,"table",13)(2,"thead")(3,"tr")(4,"th"),g(5),C(6,"translate"),u(),c(7,"th")(8,"p-checkbox",14),J("ngModelChange",function(t){w(e);let n=d(2);return Y(n.compileAllCheck,t)||(n.compileAllCheck=t),S(t)}),P("onChange",function(){w(e);let t=d(2);return S(t.compileOrInstallAll(!1))}),u(),g(9),C(10,"translate"),u(),c(11,"th")(12,"p-checkbox",15),J("ngModelChange",function(t){w(e);let n=d(2);return Y(n.installAllCheck,t)||(n.installAllCheck=t),S(t)}),P("onChange",function(){w(e);let t=d(2);return S(t.compileOrInstallAll(!0))}),u(),g(13),C(14,"translate"),u(),c(15,"th"),g(16),C(17,"translate"),u(),c(18,"th"),g(19),C(20,"translate"),u()()(),c(21,"tbody"),Oe(22,cs,14,12,"tr",null,Te),u()()()}if(l&2){let e=d(2);a(5),j(y(6,9,"GLOBALS.MSG_OBJ_TYPES.FIREWALL")),a(3),H("ngModel",e.compileAllCheck),m("binary",!0),a(),x(" ",y(10,11,"CONTEXT.FW.COMPILE")," "),a(3),H("ngModel",e.installAllCheck),m("binary",!0),a(),x(" ",y(14,13,"CONTEXT.FW.INSTALL")," "),a(3),j(y(17,15,"COMPILE.FORM.LAST_COMP")),a(3),j(y(20,17,"COMPILE.FORM.LAST_INST")),a(3),Re(e.firewalls)}}function ds(l,_){if(l&1&&(c(0,"div",11),T(1,"sts-fwc-message",19),u()),l&2){let e=d(2);a(),m("message",e.errorMessage)}}function _s(l,_){l&1&&(c(0,"div",12),T(1,"p-progressSpinner"),u())}function us(l,_){if(l&1&&(c(0,"div",4),A(1,ps,24,19,"div",11)(2,ds,2,1,"div",11)(3,_s,2,0,"div",12),u()),l&2){let e=d();a(),O(e.firewalls&&e.firewalls.length?1:-1),a(),O(e.errorMessage?2:-1),a(),O(e.loadingData?3:-1)}}function fs(l,_){if(l&1&&(c(0,"span"),T(1,"i",18),g(2,"\xA0"),c(3,"strong"),g(4),u()()),l&2){let e=d(2).$implicit;a(4),j(e.firewallName)}}function ms(l,_){if(l&1&&(c(0,"span"),T(1,"span",26)(2,"i",17),g(3),u()),l&2){let e=d(2).$implicit;a(3),x("\xA0",e.firewallName,"")}}function hs(l,_){if(l&1&&(c(0,"td"),A(1,fs,5,1,"span")(2,ms,4,1,"span"),u()),l&2){let e=d().$implicit;a(),O(e.isNode?-1:1),a(),O(e.isNode?2:-1)}}function ws(l,_){if(l&1&&(c(0,"td"),T(1,"i",17),g(2),u()),l&2){let e=d().$implicit;a(2),x("\xA0",e.firewallName," ")}}function Ss(l,_){if(l&1){let e=L();c(0,"a",29),P("click",function(){w(e);let t=d(3).$implicit,n=d(2);return S(n.showPolicyDialog(t.firewallId))}),u()}}function gs(l,_){if(l&1&&T(0,"i"),l&2){let e=d(3).$implicit,i=d(2);je(i.FirewallOpsIcons[e.compileState])}}function Cs(l,_){if(l&1&&(c(0,"span"),A(1,Ss,1,0,"a",27)(2,gs,1,3,"i",28),u()),l&2){let e=d(2).$implicit,i=d(2);a(),O(e.compileState===3||e.compileState!==1&&e.compileState!==2&&i.getFirewallStatusCompiled(e.firewallId)===0?1:-1),a(),O(e.compileState===4?2:-1)}}function ys(l,_){if(l&1&&(c(0,"td",23),A(1,Cs,3,2,"span"),u()),l&2){let e=d().$implicit;a(),O(e.isNode?-1:1)}}function Es(l,_){if(l&1){let e=L();c(0,"a",29),P("click",function(){w(e);let t=d(2).$implicit,n=d(2);return S(n.showPolicyDialog(t.firewallId))}),u()}}function vs(l,_){if(l&1&&T(0,"i"),l&2){let e=d(2).$implicit,i=d(2);je(i.FirewallOpsIcons[e.compileState])}}function Is(l,_){if(l&1&&(c(0,"td",23),A(1,Es,1,0,"a",27)(2,vs,1,3,"i",28),u()),l&2){let e=d().$implicit,i=d(2);a(),O(e.compileState===3||e.compileState!==1&&e.compileState!==2&&i.getFirewallStatusCompiled(e.firewallId)===0?1:-1),a(),O(e.compileState===4?2:-1)}}function bs(l,_){if(l&1){let e=L();c(0,"a",31),P("click",function(){w(e);let t=d(3).$implicit,n=d(2);return S(n.downloadPolicyScript(t.firewallId))}),u()}}function Ps(l,_){if(l&1&&T(0,"i"),l&2){let e=d(3).$implicit,i=d(2);je(i.FirewallOpsIcons[e.compileState])}}function Ts(l,_){if(l&1&&(c(0,"span"),A(1,bs,1,0,"a",30)(2,Ps,1,3,"i",28),u()),l&2){let e=d(2).$implicit,i=d(2);a(),O(e.compileState===3||e.compileState!==1&&e.compileState!==2&&i.getFirewallStatusCompiled(e.firewallId)===0?1:-1),a(),O(e.compileState===4?2:-1)}}function Os(l,_){if(l&1&&(c(0,"td",23),A(1,Ts,3,2,"span"),u()),l&2){let e=d().$implicit;a(),O(e.isNode?-1:1)}}function Rs(l,_){if(l&1){let e=L();c(0,"a",31),P("click",function(){w(e);let t=d(2).$implicit,n=d(2);return S(n.downloadPolicyScript(t.firewallId))}),u()}}function xs(l,_){if(l&1&&T(0,"i"),l&2){let e=d(2).$implicit,i=d(2);je(i.FirewallOpsIcons[e.compileState])}}function Fs(l,_){if(l&1&&(c(0,"td",23),A(1,Rs,1,0,"a",30)(2,xs,1,3,"i",28),u()),l&2){let e=d().$implicit,i=d(2);a(),O(e.compileState===3||e.compileState!==1&&e.compileState!==2&&i.getFirewallStatusCompiled(e.firewallId)===0?1:-1),a(),O(e.compileState===4?2:-1)}}function As(l,_){if(l&1&&(c(0,"tr",24),A(1,hs,3,2,"td")(2,ws,3,1,"td"),c(3,"td",23),T(4,"i"),u(),c(5,"td",23),T(6,"i"),u(),A(7,ys,2,1,"td",23)(8,Is,3,2,"td",23)(9,Os,2,1,"td",23)(10,Fs,3,2,"td",23),u()),l&2){let e=_.$implicit,i=d(2);m("ngClass",e.coloredBg?"bgColored":"bgNormal"),a(),O(e.clusterId!==null&&e.clusterId!==void 0?1:-1),a(),O(e.clusterId===null||e.clusterId===void 0?2:-1),a(2),je(i.FirewallOpsIcons[e.compileState]),a(2),je(i.FirewallOpsIcons[e.installState]),a(),O(e.clusterId!==null&&e.clusterId!==void 0?7:-1),a(),O(e.clusterId===null||e.clusterId===void 0?8:-1),a(),O(e.clusterId!==null&&e.clusterId!==void 0?9:-1),a(),O(e.clusterId===null||e.clusterId===void 0?10:-1)}}function Ls(l,_){if(l&1&&(c(0,"div",5)(1,"div",20)(2,"div",21)(3,"table",22)(4,"caption"),g(5),C(6,"translate"),u(),c(7,"thead")(8,"tr")(9,"th"),g(10),C(11,"translate"),u(),c(12,"th",23),g(13,"C"),u(),c(14,"th",23),g(15,"I"),u(),c(16,"th",23),g(17,"V"),u(),c(18,"th",23),g(19,"D"),u()()(),c(20,"tbody"),Oe(21,As,11,13,"tr",24,Te),u()()()(),c(23,"div",25),T(24,"sts-fwc-log",null,1),u()()),l&2){let e=d();a(5),x(" ",y(6,2,"COMPILE.FORM.SEL_FW")," "),a(5),j(y(11,4,"COMPILE.FORM.NAME")),a(11),Re(e.operationQueue)}}function Ms(l,_){if(l&1){let e=L();c(0,"button",34),C(1,"translate"),P("click",function(){w(e);let t=d(3);return S(t.showCompileDialog())}),u()}if(l&2){let e=d(3);M("label",y(1,2,"GLOBALS.MSG_BUTTONS.NEXT")),m("disabled",!e.firewalls||!(e.firewalls!=null&&e.firewalls.length))}}function Ds(l,_){if(l&1){let e=L();c(0,"div"),A(1,Ms,2,4,"button",32),c(2,"button",33),C(3,"translate"),P("click",function(){w(e);let t=d(2);return S(t.hideDialog())}),u()()}if(l&2){let e=d(2);a(),O(e.enableProcess?1:-1),a(),M("label",y(3,2,"GLOBALS.MSG_BUTTONS.CLOSE"))}}function Ns(l,_){if(l&1){let e=L();c(0,"button",42),C(1,"translate"),P("click",function(){w(e);let t=d(3);return S(t.doPauseProcess(!0))}),u()}if(l&2){let e=d(3);M("label",y(1,2,"COMPILE.PAUSE")),m("disabled",e.disableButtons)}}function Us(l,_){if(l&1){let e=L();c(0,"button",43),P("click",function(){w(e);let t=d(3);return S(t.doContinueProcess())}),u()}if(l&2){let e=d(3);m("disabled",e.disableButtons)("label",e.continueButtonText)}}function Gs(l,_){if(l&1){let e=L();c(0,"button",44),C(1,"translate"),P("click",function(){w(e);let t=d(3);return S(t.downloadPolicyScript(t.operationQueue[0].firewallId))}),u()}l&2&&M("label",y(1,1,"CONTEXT.FW.DOWNLOAD"))}function Bs(l,_){if(l&1){let e=L();c(0,"button",45),C(1,"translate"),P("click",function(){w(e);let t=d(3);return S(t.showPolicyDialog(t.operationQueue[0].firewallId))}),u()}l&2&&M("label",y(1,1,"CONTEXT.FW.SHOW"))}function ks(l,_){if(l&1){let e=L();c(0,"button",46),C(1,"translate"),P("click",function(){w(e);let t=d(3);return S(t.doDownloadCompileLog())}),u()}if(l&2){let e=d(3);M("label",y(1,2,"LOG_PANEL.BTN_DOWNLOAD")),m("disabled",e.loadingData||e.disableButtons)}}function js(l,_){if(l&1){let e=L();c(0,"div"),A(1,Ns,2,4,"button",35)(2,Us,1,2,"button",36),T(3,"span",37),A(4,Gs,2,3,"button",38)(5,Bs,2,3,"button",39)(6,ks,2,4,"button",40),c(7,"button",41),C(8,"translate"),P("click",function(){w(e);let t=d(2);return S(t.hideDialog())}),u()()}if(l&2){let e=d(2);a(),O(!e.pauseProcess&&e.operationInProcessId<e.operationQueue.length-1?1:-1),a(),O(e.pauseProcess&&e.operationInProcessId<e.operationQueue.length?2:-1),a(2),O(!e.pauseProcess&&!(e.operationInProcessId<e.operationQueue.length)&&e.getDifferentCompiled()?4:-1),a(),O(!e.pauseProcess&&!(e.operationInProcessId<e.operationQueue.length)&&e.getDifferentCompiled()?5:-1),a(),O(e.pauseProcess===!1&&!(e.operationInProcessId<e.operationQueue.length)?6:-1),a(),M("label",y(8,7,"GLOBALS.MSG_BUTTONS.CLOSE")),m("disabled",e.loadingData||e.disableButtons)}}function Vs(l,_){if(l&1&&A(0,Ds,4,4,"div")(1,js,9,9,"div"),l&2){let e=d();O(e.displaySelectOptions?0:-1),a(),O(e.displayCompileOptions?1:-1)}}var Ws=6e4,Fl=(()=>{class l extends Dt{constructor(e,i,t,n,o,r,p,s,f,h,E,b,I,R,V,G){super(p,i,e,R,V,G),this.itemSelectedService=e,this.appOptionsService=i,this.fwcUserService=t,this.fwcFirewallService=n,this.fwcPolicyService=o,this.fwcErrorPipe=r,this.appDialogPanelsService=p,this.confirmationService=s,this.messageService=f,this.inputDataService=h,this.fwcEventService=E,this.utilService=b,this.translate=I,this.cd=R,this.store=V,this.router=G,this.displaySelectOptions=!1,this.displayCompileOptions=!1,this.firewalls=[],this.compileChecks=[],this.installChecks=[],this.operationQueue=[],this.operationStatus={},this.loadingData=!1,this.FirewallOpsIcons=Fo,this.disableButtons=!1,this.pauseProcess=!1,this.alive=!0,this.createDialog(this.translate.instant("COMPILE.PANEL_TITLE"),"fwci-compileallfirewalls")}ngOnInit(){let e,i;this.continueButtonText=this.translate.instant("COMPILE.CONTINUE");let t=[];this.itemSelectedService.getCloudToCompile().pipe($(()=>this.alive)).subscribe(n=>{switch(this.loadingData=!0,n.compileWhat){case St.COMP_CLOUD:e=this.fwcFirewallService.getFirewallsByCloud.bind(this.fwcFirewallService),i=this.translate.instant("COMPILE.NO_DATA");break;case St.COMP_CLUSTER:e=this.fwcFirewallService.getClusterNodes.bind(this.fwcFirewallService);break;case St.COMP_FIREWALL:e=this.fwcFirewallService.getFirewall.bind(this.fwcFirewallService);break;case St.COMP_CLUSTERS_ALL:e=this.fwcFirewallService.getFirewallsByCloud.bind(this.fwcFirewallService),i=this.translate.instant("COMPILE.NO_DATA_CL");break;case St.COMP_FIREWALLS_ALL:e=this.fwcFirewallService.getFirewallsByCloud.bind(this.fwcFirewallService),i=this.translate.instant("COMPILE.NO_DATA_FW");break}this.fwcFirewallService.getClustersByCloud(this.fwcUserService.getActualFwSelectedCloud()).subscribe(o=>{o.data&&Array.isArray(o.data)?t=o.data:t=[],e(n.compileId,this.fwcUserService.getActualFwSelectedCloud()).subscribe(r=>{let p=[],s,f;Array.isArray(r.data)&&r.data.length?p.push(...r.data):r.data&&r.data.id&&p.push(r.data),this.firewalls=[];for(let h=0;h<p.length;h++)if(p[h].status_compiled=p[h].status&1,p[h].status_installed=p[h].status&2,s=p[h].cluster,s==null)(n.compileWhat===St.COMP_CLOUD||n.compileWhat===St.COMP_FIREWALLS_ALL||n.compileWhat===St.COMP_FIREWALL)&&this.firewalls.push(p[h]);else if(n.compileWhat===St.COMP_CLOUD||n.compileWhat===St.COMP_CLUSTERS_ALL||n.compileWhat===St.COMP_CLUSTER){f=!1;for(let I=0;I<this.firewalls.length&&!f;I++)this.firewalls[I].cluster==s&&(this.firewalls[I].fwnodes.push(p[h]),f=!0);let E="",b=t.filter(I=>I.id==s);if(b&&b.length&&(E=b[0].name),!f){let I=Object.assign({},p[h]);p[h].name=E,p[h].fwnodes=[],p[h].fwnodes.push(I),this.firewalls.push(p[h])}}if(this.loadingData=!1,this.firewalls.length){for(let h=0;h<this.firewalls.length;h++)this.compileChecks[h]=!!this.firewalls[h].status_compiled,this.installChecks[h]=!!n.compileAction&&!!this.firewalls[h].status_installed;this.checkCompileInstallCheckboxes()}else this.errorMessage={type:"warning",title:this.translate.instant("COMPILE.NO_DATA_HEAD"),text:i};this.recenterDialog()},r=>{r.error&&r.error.fwcErr==1002?this.errorMessage={type:"warning",title:this.translate.instant("COMPILE.NO_DATA_HEAD"),text:i}:r.error&&this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(r)}),this.loadingData=!1})},o=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(o)}),this.loadingData=!1}),this.displaySelectOptions=!0,this.showDialog()})}checkCompileInstallCheckboxes(e){this.compileChecks.every(i=>i)?this.compileAllCheck=!0:this.compileAllCheck=!1,this.installChecks.every(i=>i)?this.installAllCheck=!0:this.installAllCheck=!1,this.enableProcess=this.compileChecks.some(i=>i)||this.installChecks.some(i=>i)}ngOnDestroy(){clearTimeout(this.opTimeout),super.ngOnDestroy()}onDialogHide(e){this.displaySelectOptions=!1,this.displayCompileOptions=!1,this.firewalls=[],this.compileChecks=[],this.errorMessage=null,this.installChecks=[],this.log&&this.log.clearMessages(),this.channel_id&&this.utilService.ioReleaseLogEvent(this.channel_id),this.operationQueue=[],this.pauseProcess=!1,this.eventsSubscription&&this.eventsSubscription.unsubscribe(),this.operationInProcessId!==void 0&&this.itemSelectedService.setModifiedItem({_fwcTreeAction:Ne.RELOAD_TREE,containerToReload:it.C_FIREWALLS}),this.actualFirewallCompileSSHInputData=null,this.operationInProcessId=void 0,this.opTimeout&&clearTimeout(this.opTimeout)}compileAll(){this.displaySelectOptions=!0}compileOrInstallAll(e){let i,t;e?(i=this.installAllCheck,t=this.installChecks):(i=this.compileAllCheck,t=this.compileChecks),i?t.fill(!0):t.fill(!1),this.checkCompileInstallCheckboxes()}showCompileDialog(){this.displaySelectOptions=!1,this.displayCompileOptions=!0,this.recenterDialog(),this.startCompileProcess()}resetTimer(){this.opTimeout&&clearTimeout(this.opTimeout),this.opTimeout=setTimeout(()=>{this.doTimeoutOp()},Ws)}startCompileProcess(){let e,i=!1;if(!this.firewalls)return;this.operationQueue=[];for(let o=0;o<this.firewalls.length;o++)if(this.compileChecks[o]||this.installChecks[o]){let r=this.firewalls[o];if(r.cluster===null||r.cluster===void 0)e={clusterId:r.cluster,firewallId:r.id,firewallName:r.name,compileState:this.compileChecks[o]?ge.FW_PENDING:ge.FW_DISABLED,installState:this.installChecks[o]?ge.FW_PENDING:ge.FW_DISABLED,coloredBg:i,opCompiled:!1,opInstalled:!1},this.operationQueue.push(Object.assign({},e));else{e={clusterId:r.cluster,clusterName:r.name,firewallId:r.id,firewallName:r.name,compileState:this.compileChecks[o]?ge.FW_PENDING:ge.FW_DISABLED,installState:ge.FW_DISABLED,coloredBg:i,opCompiled:!1,opInstalled:!1},this.operationQueue.push(Object.assign({},e));for(let p=0;r.fwnodes&&p<r.fwnodes.length;p++){let s=r.fwnodes[p];e={clusterId:r.cluster,clusterName:r.name,isNode:!0,firewallId:s.id,firewallName:s.name,compileState:ge.FW_DISABLED,installState:this.installChecks[o]?ge.FW_PENDING:ge.FW_DISABLED,coloredBg:i,opCompiled:!1,opInstalled:!1},this.operationQueue.push(Object.assign({},e))}}i=!i}let t=this.utilService.createDynamicComponentRef(Xi),n=t.instance;n.setDynamicComponentRef(t),this.communicationSubscription=n.socketEventEmitter.subscribe(o=>{o=="connected"&&(this.channel_id=Et(),this.utilService.ioListenOnLogEvent(this.channel_id),this.eventsSubscription=this.fwcEventService.getEvent().pipe($(()=>this.displayCompileOptions)).subscribe(r=>{let p=new Sn(r),s;p.payload.type===z.MSG_ERROR&&(this.pauseProcess=!0,s=this.utilService.isCommunicationErrorStr(p.payload.message),this.operationStatus.opMsg=this.translate.instant("COMPILE.GEN_ERROR"),this.operationStatus.opMsgType=z.MSG_ERROR,s?this.continueButtonText=this.translate.instant("COMPILE.RETRY"):this.continueButtonText=this.translate.instant("COMPILE.CONTINUE")),s||this.log.addNewMessage(p),this.resetTimer()}),this.operationInProcessId=0,this.actualFirewallCompileSSHInputData=null,this.processFirewallOperation()),this.communicationSubscription.unsubscribe()}),n.checkConnection()}processFirewallOperation(e){let i;if(!this.pauseProcess&&(clearTimeout(this.opTimeout),this.operationQueue&&this.operationInProcessId<this.operationQueue.length)){let t=this.operationQueue[this.operationInProcessId];if(!t)return;if(t.clusterId!==null&&t.clusterId!==void 0?t.firewallName?i=this.translate.instant("COMPILE.INST_CLUSTER_NODE",{clusterName:t.clusterName,firewallName:t.firewallName}):i=this.translate.instant("COMPILE.INST_CLUSTER",{clusterName:t.clusterName}):i=this.translate.instant("COMPILE.INST_FW",{firewallName:t.firewallName}),t.compileState==ge.FW_PENDING)t.compileState=ge.FW_PROCESSING,this.addMessageToLog(this.translate.instant("COMPILE.COMP_START",{name:i}),z.MSG_INFO),this.operationStatus.opMsg=this.translate.instant("COMPILE.COMP_SUCCESS",{name:i}),this.operationStatus.opMsgType=z.MSG_OK,this.resetTimer(),this.loadingData=!0,this.log.startDataLoad(),this.utilService.fwcAPICall(this.fwcPolicyService.compileFirewall.bind(this.fwcPolicyService),t.firewallId,this.fwcUserService.getActualFwSelectedCloud(),this.channel_id).then(n=>{t.compileState=ge.FW_OK,this.loadingData=!1,this.log.stopDataLoad(),clearTimeout(this.opTimeout),setTimeout(()=>{this.addMessageToLog(this.operationStatus.opMsg,this.operationStatus.opMsgType),this.addMessageToLog("",z.MSG_SEPARATOR),this.processFirewallOperation()})}).catch(n=>{this.addMessageToLog(this.translate.instant("COMPILE.COMP_ERROR",{name:i,error:this.fwcErrorPipe.transform(n)}),z.MSG_ERROR),t.compileState=ge.FW_ERROR,this.doPauseProcess(),this.log.stopDataLoad()});else if(t.installState==ge.FW_PENDING){t.installState=ge.FW_PROCESSING,(this.operationInProcessId||!this.operationInProcessId&&t.compileState!=ge.FW_DISABLED)&&this.addMessageToLog("",z.MSG_SEPARATOR),this.addMessageToLog(this.translate.instant("COMPILE.INST_START",{name:i}),z.MSG_INFO);let n={header:this.translate.instant("COMPILE.INST_SSH",{name:i}),helpText:this.translate.instant("COMPILE.INST_SSH_TEXT"),modal:!1,formControls:[{name:"firewall_id",type:"hidden",value:t.firewallId}],onAccept:this.installFirewall.bind(this)};this.fwcFirewallService.getFirewall(t.firewallId,this.fwcUserService.getActualFwSelectedCloud()).subscribe(o=>Z(this,null,function*(){let r=o.data;if(r){let p=this.fwcUserService.getActualFwcUser().privateKey,s=r.install_user,f=r.install_pass,h=r.install_apikey;try{s&&(s=yield this.utilService.openPGPDecrypt(s,p)),f&&(f=yield this.utilService.openPGPDecrypt(f,p)),h&&(h=yield this.utilService.openPGPDecrypt(h,p))}catch{}if(r.install_interface&&r.install_ipobj){n.formControls.push({name:"install_communication",type:"hidden",value:r.install_communication}),r.install_communication==="ssh"&&(n.formControls.push({name:"install_user",label:this.translate.instant("CLUSTER.MSG_CLUSTER_EDITION.SSH_USER"),type:"text",required:!0,value:this.actualFirewallCompileSSHInputData?this.actualFirewallCompileSSHInputData.install_user:s,setFocus:!0}),n.formControls.push({name:"",label:"",type:"separator"}),n.formControls.push({name:"install_pass",label:this.translate.instant("CLUSTER.MSG_CLUSTER_EDITION.SSH_PASS"),type:"password",required:!0,value:this.actualFirewallCompileSSHInputData?this.actualFirewallCompileSSHInputData.install_pass:f}));let E={name:"btnPauseProcess",label:this.translate.instant("COMPILE.PAUSE"),type:"button",icon:"fa fa-pause",class:"p-button-warning",value:0};if(n.formControls.push(E),n.formControls.unshift({name:"",label:"",type:"separator"}),n.formControls.unshift({name:"ip_name",label:this.translate.instant("COMPILE.FIELDS.INST_IP"),icon:"fwci-address fwcBlue",type:"text",value:r.ip_name?r.ip_name+" ("+r.ip+")":"-",readonly:!0,halfSized:!0}),n.formControls.unshift({name:"interface_name",label:this.translate.instant("COMPILE.FIELDS.INST_IF"),icon:"fwci-interface fwcGreen",type:"text",value:r.interface_name||"-",readonly:!0,halfSized:!0}),r.install_communication==="agent"&&r.install_protocol&&r.install_apikey){let b=this.inputDataService.getInputDataValue(n);this.installFirewall(b)}else this.disableButtons=!0,this.inputDataService.setInputData(n)}else t.installState=ge.FW_ERROR,setTimeout(()=>{this.confirmationService.confirm({key:"cdErrorFw",header:this.translate.instant("COMPILE.INST_SSH_ERROR"),message:this.translate.instant("COMPILE.INST_SSH_ERROR_TEXT",{name:r.name}),reject:()=>{this.doPauseProcess()},accept:()=>{let E=this.translate.instant("COMPILE.INST_SSH_ERROR_TEXT",{name:r.name});this.addMessageToLog(this.translate.instant("COMPILE.INST_ERROR",{name:i,error:E}),z.MSG_ERROR),this.operationInProcessId++,this.actualFirewallCompileSSHInputData=null,this.processFirewallOperation()}})},100)}else t.installState=ge.FW_ERROR,this.doPauseProcess(),this.log.stopDataLoad(),this.addMessageToLog(this.translate.instant("COMPILE.INST_FW_ERROR",{name:i}),z.MSG_ERROR)}),o=>{t.installState=ge.FW_ERROR,this.doPauseProcess(),this.log.stopDataLoad(),this.addMessageToLog(this.translate.instant("COMPILE.INST_DATA_ERROR",{name:i,error:this.fwcErrorPipe.transform(o)}),z.MSG_ERROR)})}else this.operationInProcessId++,this.actualFirewallCompileSSHInputData=null,this.processFirewallOperation()}}installFirewall(e){return Z(this,null,function*(){let i,t;if(this.operationQueue&&this.operationInProcessId<this.operationQueue.length&&(t=this.operationQueue[this.operationInProcessId]),!!t)if(t.clusterId!==null&&t.clusterId!==void 0?i=`cluster ${t.clusterId} - firewall ${t.firewallId} (${t.firewallName})`:i=`firewall ${t.firewallId} (${t.firewallName})`,this.disableButtons=!1,e){if(this.actualFirewallCompileSSHInputData=e,e.btnPauseProcess){t.installState=ge.FW_PENDING,this.doPauseProcess(!0);return}let n=this.fwcUserService.getActualFwcUser().publicKey,o=e.install_user,r=e.install_pass,p=e.install_apikey;o&&(o=yield this.utilService.openPGPEncrypt(o,n)),r&&(r=yield this.utilService.openPGPEncrypt(r,n)),this.resetTimer(),this.loadingData=!0,this.log.startDataLoad(),this.utilService.fwcAPICall(this.fwcPolicyService.installFirewall.bind(this.fwcPolicyService),e.firewall_id,this.fwcUserService.getActualFwSelectedCloud(),o,r,this.channel_id).then(s=>{t.installState=ge.FW_OK,this.operationStatus.opMsg=this.translate.instant("COMPILE.INST_SUCCESS",{name:i}),this.operationStatus.opMsgType=z.MSG_OK,this.loadingData=!1,this.log.stopDataLoad(),this.actualFirewallCompileSSHInputData=null,setTimeout(()=>{this.addMessageToLog(this.operationStatus.opMsg,this.operationStatus.opMsgType),this.addMessageToLog("",z.MSG_SEPARATOR),this.processFirewallOperation()})}).catch(s=>{let f=this.utilService.isCommunicationError(s.error);f?(t.installState=ge.FW_PENDING,this.addMessageToLog(this.translate.instant("COMPILE.INST_ERROR",{name:i,error:f}),z.MSG_ERROR),this.continueButtonText=this.translate.instant("COMPILE.RETRY")):(s.error.fwcErr==9e3?this.confirmationService.confirm({header:this.translate.instant("GLOBALS.MSG_OP_RESULT.ERROR"),icon:"fa fa-exclamation-circle fwcRed iconBig",message:this.translate.instant("API_ERROR.SSH_FORBIDDEN"),rejectVisible:!1,acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.OK")}):(t.installState=ge.FW_ERROR,this.addMessageToLog(this.translate.instant("COMPILE.INST_ERROR",{name:i,error:this.fwcErrorPipe.transform(s)}),z.MSG_ERROR)),this.continueButtonText=this.translate.instant("COMPILE.CONTINUE"),this.actualFirewallCompileSSHInputData=null),this.loadingData=!1,this.log.stopDataLoad(),this.operationInProcessId<this.operationQueue.length-1?this.doPauseProcess():clearTimeout(this.opTimeout)})}else t.installState=ge.FW_WARNING,this.addMessageToLog(this.translate.instant("COMPILE.INST_WARNING",{name:i}),z.MSG_ERROR),this.operationInProcessId++,this.actualFirewallCompileSSHInputData=null,this.processFirewallOperation()})}doTimeoutOp(){this.pauseProcess=!0,this.loadingData=!1,this.log&&(this.log.stopDataLoad(),this.addMessageToLog(this.translate.instant("COMPILE.WARN_TIMEOUT"),z.MSG_WARNING))}doPauseProcess(e){this.pauseProcess=!0,this.loadingData=!1,this.log&&this.log.stopDataLoad(),clearTimeout(this.opTimeout),e&&this.addMessageToLog(this.translate.instant("COMPILE.WARN_PAUSE"),z.MSG_WARNING)}doContinueProcess(){this.pauseProcess=!1,this.processFirewallOperation()}doDownloadCompileLog(){this.log&&this.log.downloadLog()}showPolicyDialog(e){let i=this.utilService.createDynamicComponentRef(qn),t=i.instance;t.setDynamicComponentRef(i),t.show(e)}downloadPolicyScript(e){let i=this.utilService.createDynamicComponentRef(qn),t=i.instance;t.setDynamicComponentRef(i),t.downloadPolicyScript(e)}getDifferentCompiled(){let e=[...new Set(this.operationQueue.map(i=>i.clusterId))];return e.length===1&&e[0]===null&&[...new Set(this.operationQueue.map(i=>i.firewallId))].length===1?this.getFirewallStatusCompiled(this.operationQueue[0].firewallId)===3:e.length===1?this.operationQueue.find(i=>i.firewallId===this.firewalls[0].id).compileState===3:!1}getFirewallStatusCompiled(e){return this.operationQueue.find(i=>i.firewallId===e).compileState}static{this.\u0275fac=function(i){return new(i||l)(F(De),F(gt),F(se),F(oe),F(de),F(we),F(At),F(Ie),F(_e),F(Ct),F(Xt),F(ue),F(ce),F(ie),F(pe),F(Ft))}}static{this.\u0275cmp=Le({type:l,selectors:[["sts-fwc-firewall-compile-panel"]],viewQuery:function(i,t){if(i&1&&Se(Zt,5),i&2){let n;le(n=re())&&(t.log=n.first)}},features:[$e([oe]),Rt],decls:6,vars:6,consts:[["fwCompileDialog",""],["compileLog",""],["styleClass","dlgFwcDialog dlgFwcDialog--medium",3,"visibleChange","onHide","visible","modal","resizable","closable"],["pTemplate","header"],[1,"grid","divTableScroll"],[1,"grid","divFw"],["pTemplate","footer"],[1,"divFormHeader"],[1,"fwcWhite","fwcIconLeft"],[1,"fwcMenuIcon","fwci-firewalls","fwcOrange"],[1,"fwcMenuIcon","fwci-compileallfirewalls","fwcOrange"],[1,"col-12"],[1,"col-12","divLoader"],[1,"tableFw"],["name","compile_all","styleClass","compileCheckbox",3,"ngModelChange","onChange","ngModel","binary"],["name","install_all","styleClass","compileCheckbox",3,"ngModelChange","onChange","ngModel","binary"],["styleClass","compileCheckbox",3,"ngModelChange","onChange","name","ngModel","binary"],[1,"fwcMenuIcon","fwci-firewall","fwcBlue"],[1,"fwcMenuIcon","fwci-cluster","fwcOrange"],[3,"message"],[1,"col-4"],[1,"divFwBar","divTableScroll"],[1,"tableFw","unstriped"],[1,"fwc-centered"],[3,"ngClass"],[1,"col-8"],[1,"fwcSepShort"],[1,"fa","fa-eye","fwcBlue"],[3,"class"],[1,"fa","fa-eye","fwcBlue",3,"click"],[1,"fa","fa-download"],[1,"fa","fa-download",3,"click"],["type","button","pButton","","icon","fa fa-arrow-right",1,"p-button-success",3,"disabled","label"],["type","button","pButton","","icon","pi pi-check",1,"p-button-primary",3,"click","label"],["type","button","pButton","","icon","fa fa-arrow-right",1,"p-button-success",3,"click","disabled","label"],["type","button","pButton","","icon","fa fa-pause",1,"p-button-warning",3,"disabled","label"],["type","button","pButton","","icon","fa fa-play",1,"p-button-success",3,"disabled","label"],[1,"spanSep"],["type","button","pButton","","icon","fa fa-download",1,"p-button-secondary",3,"label"],["type","button","pButton","","icon","fa fa-eye",1,"p-button-secondary",3,"label"],["type","button","pButton","","icon","fa fa-download",1,"p-button-secondary",3,"disabled","label"],["type","button","pButton","","icon","pi pi-check",1,"p-button-primary",3,"click","disabled","label"],["type","button","pButton","","icon","fa fa-pause",1,"p-button-warning",3,"click","disabled","label"],["type","button","pButton","","icon","fa fa-play",1,"p-button-success",3,"click","disabled","label"],["type","button","pButton","","icon","fa fa-download",1,"p-button-secondary",3,"click","label"],["type","button","pButton","","icon","fa fa-eye",1,"p-button-secondary",3,"click","label"],["type","button","pButton","","icon","fa fa-download",1,"p-button-secondary",3,"click","disabled","label"]],template:function(i,t){if(i&1){let n=L();c(0,"p-dialog",2,0),J("visibleChange",function(r){return w(n),Y(t.displayDialog,r)||(t.displayDialog=r),S(r)}),P("onHide",function(r){return w(n),S(t.onDialogHide(r))}),A(2,is,2,2,"ng-template",3)(3,us,4,3,"div",4)(4,Ls,26,6,"div",5)(5,Vs,2,2,"ng-template",6),u()}i&2&&(H("visible",t.displayDialog),m("modal",!0)("resizable",!0)("closable",!1),a(3),O(t.displaySelectOptions?3:-1),a(),O(t.displayCompileOptions?4:-1))},dependencies:[et,ht,wt,Zt,Nt,Mt,Ue,lt,Lt,yt,vo,nt],styles:[`.divFw{height:33rem}.divFwBar{height:32rem}
`],encapsulation:2})}}return l})();var zs=["inputFirewallName"],qs=["fwcInterfacesEditor"],Qs=()=>({width:"80vw"}),Nl=l=>({visibility:l}),be=()=>({standalone:!0}),Ul=(l,_)=>({type:"error",title:l,text:_}),$s=()=>({width:"1.7rem",height:"1.7rem"});function Zs(l,_){if(l&1&&(c(0,"div",9)(1,"h6",13),T(2,"i",14),g(3),C(4,"translate"),c(5,"strong"),g(6),u()()()),l&2){let e=d(4);a(3),x(" ",y(4,2,"FW.MSG_FW_EDITION.EDIT")," "),a(3),j(e.firewall==null?null:e.firewall.name)}}function ec(l,_){l&1&&(c(0,"span")(1,"i"),g(2,"(Master)"),u()())}function tc(l,_){if(l&1&&(c(0,"div",9)(1,"h6",13),T(2,"i",14),g(3," Cluster "),c(4,"strong"),g(5),u(),g(6),C(7,"translate"),A(8,ec,3,0,"span"),u()()),l&2){let e=d(4);a(5),j(e.firewall==null?null:e.firewall._fwcClusterId),a(),x(" - ",y(7,3,"FW.MSG_FW_EDITION.EDIT_NODE")," "),a(2),O(e.firewall!=null&&e.firewall.fwmaster?8:-1)}}function ic(l,_){if(l&1&&A(0,Zs,7,4,"div",9)(1,tc,9,5,"div",9),l&2){let e=d(3);O(e.firewall!=null&&e.firewall._fwcClusterId?-1:0),a(),O(e.firewall!=null&&e.firewall._fwcClusterId?1:-1)}}function nc(l,_){l&1&&(c(0,"div",9)(1,"h6",13),T(2,"i",14),g(3),C(4,"translate"),u()()),l&2&&(a(3),x(" ",y(4,1,"FW.MSG_FW_EDITION.EDIT")," "))}function oc(l,_){if(l&1&&A(0,ic,2,2)(1,nc,5,3,"div",9),l&2){let e=d(2);O(e.firewall!=null&&e.firewall.id?0:1)}}function lc(l,_){if(l&1&&(c(0,"div",9)(1,"h6",13),T(2,"i",15),g(3),C(4,"translate"),c(5,"strong"),g(6),u()()()),l&2){let e=d(2);a(3),x(" ",y(4,2,"FW.MSG_FW_EDITION.DELETE")," "),a(3),j(e.firewallToDelete._fwcObjName)}}function rc(l,_){if(l&1){let e=L();c(0,"button",16),P("click",function(){w(e);let t=d(2);return S(t.showHelp())}),u()}if(l&2){let e=d(2);m("disabled",e.loadingData)}}function ac(l,_){if(l&1){let e=L();A(0,oc,2,1)(1,lc,7,4,"div",9),c(2,"div",10),A(3,rc,1,1,"button",11),c(4,"button",12),P("click",function(){w(e);let t=d();return S(t.minimizeDialog())}),u()()}if(l&2){let e=d();O(e.firewall?0:-1),a(),O(e.firewallToDelete?1:-1),a(2),O(e.helpSection?3:-1),a(),m("disabled",e.loadingData)}}function sc(l,_){if(l&1&&(c(0,"option",32),g(1),u()),l&2){let e=_.$implicit;m("ngValue",e.id),a(),x(" ",e.name," ")}}function cc(l,_){if(l&1){let e=L();c(0,"div",63)(1,"div",25)(2,"label",64),g(3),C(4,"translate"),u(),c(5,"select",65),P("change",function(){return w(e),S(!0)}),c(6,"option",35),g(7),C(8,"translate"),u(),c(9,"option",66),g(10,"HTTPS"),u(),c(11,"option",67),g(12,"HTTP"),u()()()(),c(13,"div",68)(14,"div",25)(15,"label",69),g(16),C(17,"translate"),u(),T(18,"input",70),C(19,"translate"),c(20,"button",71),P("mousedown",function(){w(e);let t=d(2);return S(t.displayApiKey=!0)})("mouseup",function(){w(e);let t=d(2);return S(t.displayApiKey=!1)})("mouseout",function(){w(e);let t=d(2);return S(t.displayApiKey=!1)}),u()()()}if(l&2){let e=d(2);a(3),j(y(4,7,"FW.MSG_FW_EDITION.AGENT_PROTOCOL")),a(3),m("value",null),a(),x(" ",y(8,9,"FW.MSG_FW_EDITION.AGENT_PROTOCOL")," "),a(9),j(y(17,11,"FW.MSG_FW_EDITION.AGENT_APIKEY")),a(2),M("placeholder",y(19,13,"FW.MSG_FW_EDITION.AGENT_APIKEY")),m("showPassword",e.displayApiKey)("feedback",!1)}}function pc(l,_){l&1&&(c(0,"p",74),g(1),C(2,"translate"),u()),l&2&&(a(),x(" ",y(2,1,"ITEM_PANEL.ERRORS.FIELD_USERNAME")," "))}function dc(l,_){if(l&1){let e=L();c(0,"div",68)(1,"div",25)(2,"label",72),g(3),C(4,"translate"),u(),T(5,"input",73),C(6,"translate"),u(),A(7,pc,3,3,"p",74),u(),c(8,"div",63)(9,"div",25,4)(11,"label",75),g(12),C(13,"translate"),u(),T(14,"input",76),C(15,"translate"),C(16,"translate"),C(17,"translate"),C(18,"translate"),C(19,"translate"),c(20,"button",77),P("mousedown",function(){w(e);let t=d(2);return S(t.displaySSH=!0)})("mouseup",function(){w(e);let t=d(2);return S(t.displaySSH=!1)})("mouseout",function(){w(e);let t=d(2);return S(t.displaySSH=!1)}),u()()()}if(l&2){let e=d(2);a(3),j(y(4,10,"FW.MSG_FW_EDITION.SSH_USER")),a(2),M("placeholder",y(6,12,"FW.MSG_FW_EDITION.SSH_USER")),a(2),O(!e.formModel.get("install_user").valid&&!e.formModel.get("install_user").pristine?7:-1),a(5),j(y(13,14,"FW.MSG_FW_EDITION.SSH_PASS")),a(2),M("placeholder",y(15,16,"FW.MSG_FW_EDITION.SSH_PASS")),m("showPassword",e.displaySSH)("promptLabel",y(16,18,"GLOBALS.MSG_PASSWORD.PASS"))("weakLabel",y(17,20,"GLOBALS.MSG_PASSWORD.WEAK"))("mediumLabel",y(18,22,"GLOBALS.MSG_PASSWORD.NORMAL"))("strongLabel",y(19,24,"GLOBALS.MSG_PASSWORD.SAFE"))}}function _c(l,_){if(l&1){let e=L();c(0,"div",38)(1,"div")(2,"button",82),C(3,"translate"),C(4,"translate"),P("click",function(){w(e);let t=d(3);return S(t.onTestFwcAgentCommunicationDiscoverInterfaces())}),u(),c(5,"button",83),C(6,"translate"),C(7,"translate"),P("click",function(){w(e);let t=d(3);return S(t.showFirewallInfo())}),u()(),T(8,"div"),u()}if(l&2){let e=d(3);a(2),M("pTooltip",y(3,6,"FW.MSG_FW_EDITION.AGENT_TOOLTIP")),M("label",y(4,8,"FW.MSG_FW_EDITION.AGENT_TEST")),m("disabled",e.loadingData),a(3),M("pTooltip",y(6,10,"FW.FW_MORE_INFO.AGENT_TOOLTIP")),M("label",y(7,12,"FW.FW_MORE_INFO.MORE_INFO")),m("disabled",e.loadingData)}}function uc(l,_){if(l&1&&(c(0,"div",63)(1,"div",25)(2,"label"),T(3,"i",78),C(4,"translate"),g(5),C(6,"translate"),u(),T(7,"input",79),u()(),c(8,"div",63)(9,"div",25)(10,"label"),g(11),C(12,"translate"),u(),T(13,"input",79),u()(),c(14,"div",38)(15,"div",25)(16,"label",80),g(17),C(18,"translate"),u(),T(19,"input",81),C(20,"translate"),u()(),A(21,_c,9,14,"div",38)),l&2){let e,i=d(2);a(3),M("pTooltip",y(4,9,"FW.MSG_FW_EDITION.TOOLTIP_NEW_INSTALL")),a(2),x(" \xA0 ",y(6,11,"FW.MSG_FW_EDITION.NEW_IF")," "),a(2),M("value",i.discoveredInstallOptions.interface==null?null:i.discoveredInstallOptions.interface.name),a(4),j(y(12,13,"FW.MSG_FW_EDITION.NEW_IP")),a(2),M("value",(i.discoveredInstallOptions.ipobj==null?null:i.discoveredInstallOptions.ipobj.address)+" ("+(i.discoveredInstallOptions.ipobj==null?null:i.discoveredInstallOptions.ipobj.name)+")"),a(4),j(y(18,15,"FW.MSG_FW_EDITION.PORT")),a(2),M("placeholder",y(20,17,"FW.MSG_FW_EDITION.PORT")),M("value",i.install_port_agent),a(2),O(((e=i.formModel.get("install_communication"))==null?null:e.value)==="agent"?21:-1)}}function fc(l,_){if(l&1&&(c(0,"option",32),g(1),u()),l&2){let e=_.$implicit;m("ngValue",e.id),a(),fi(" ",e.id," - ",e.name," ")}}function mc(l,_){if(l&1&&(c(0,"span"),g(1),u()),l&2){let e=d().$implicit;a(),x("(",e.address,")")}}function hc(l,_){l&1&&(c(0,"span"),g(1),C(2,"translate"),u()),l&2&&(a(),x("(",y(2,1,"FW.MSG_FW_EDITION.NO_IP"),")"))}function wc(l,_){if(l&1&&(c(0,"option",32),g(1),A(2,mc,2,1,"span")(3,hc,3,3,"span"),u()),l&2){let e=_.$implicit;m("ngValue",e.id),a(),x(" ",e.name,"\xA0 "),a(),O(e.address?2:-1),a(),O(e.address?-1:3)}}function Sc(l,_){if(l&1){let e=L();c(0,"div",89)(1,"div",90)(2,"label",91),g(3,"\xA0"),u(),c(4,"div",24)(5,"button",92),C(6,"translate"),C(7,"translate"),P("click",function(){w(e);let t=d(4);return S(t.onTestFwcAgentCommunication())}),u()(),c(8,"div",24)(9,"button",93),C(10,"translate"),C(11,"translate"),P("click",function(){w(e);let t=d(4);return S(t.showFirewallInfo())}),u()()()()}if(l&2){let e=d(4);a(5),M("pTooltip",y(6,6,"FW.MSG_FW_EDITION.AGENT_TOOLTIP")),M("label",y(7,8,"FW.MSG_FW_EDITION.AGENT_TEST")),m("disabled",e.loadingData||e.formModel.get("install_protocol").invalid||e.formModel.get("install_apikey").invalid||!e.formModel.get("install_interface").value||!e.formModel.get("install_ipobj").value||e.formModel.get("install_port").invalid),a(4),M("pTooltip",y(10,10,"FW.FW_MORE_INFO.AGENT_TOOLTIP")),M("label",y(11,12,"FW.FW_MORE_INFO.MORE_INFO")),m("disabled",e.loadingData||!e.formModel.get("install_ipobj").value)}}function gc(l,_){if(l&1){let e=L();c(0,"div",63)(1,"div")(2,"label",84),g(3),C(4,"translate"),u(),c(5,"select",85,2),P("change",function(t){w(e);let n=d(3);return S(n.onChangeInstallData(t))}),c(7,"option",35),g(8),C(9,"translate"),u(),Oe(10,fc,2,3,"option",32,Te),u()()(),c(12,"div",63)(13,"div")(14,"label",86),g(15),C(16,"translate"),u(),c(17,"select",87),P("change",function(t){w(e);let n=d(3);return S(n.onChangeInstallData(t))}),c(18,"option",35),g(19),C(20,"translate"),u(),Oe(21,wc,4,4,"option",32,Te),u()()(),c(23,"div",38)(24,"div")(25,"label",80),g(26),C(27,"translate"),u(),T(28,"input",88),u()(),A(29,Sc,12,14,"div",89)}if(l&2){let e,i=d(3);a(3),j(y(4,8,"GLOBALS.MSG_OBJ_TYPES.OBJ_INTERFACE_FIREWALL")),a(4),m("value",null),a(),x(" ",y(9,10,"GLOBALS.MSG_OBJ_TYPES.OBJ_INTERFACE_FIREWALL")," "),a(2),Re(i.interfaces),a(5),j(y(16,12,"GLOBALS.MSG_OBJ_TYPES.OBJ_ADDRESS")),a(3),m("value",null),a(),x(" ",y(20,14,"GLOBALS.MSG_OBJ_TYPES.OBJ_ADDRESS")," "),a(2),Re(i.interfacesIpObjs),a(5),j(y(27,16,"FW.MSG_FW_EDITION.PORT")),a(3),O(((e=i.formModel.get("install_communication"))==null?null:e.value)==="agent"?29:-1)}}function Cc(l,_){l&1&&(c(0,"p"),g(1),C(2,"translate"),u()),l&2&&(a(),j(y(2,1,"FW.MSG_FW_EDITION.NO_IF")))}function yc(l,_){if(l&1&&A(0,gc,30,18)(1,Cc,3,3,"p"),l&2){let e=d(2);O(e.interfaces!=null&&e.interfaces.length?0:1)}}function Ec(l,_){if(l&1&&(c(0,"div",21)(1,"div",50),T(2,"sts-fwc-message",94),u()()),l&2){let e=d(2);a(2),m("message",Ze(1,Ul,e.translate.instant("PLUGINS.TITLE"),e.translate.instant("PLUGINS.ERRORS.COMMUNICATION.TEXT")))}}function vc(l,_){if(l&1){let e=L();c(0,"div",21)(1,"div",22)(2,"h5",23),g(3),C(4,"translate"),u()(),c(5,"div",24)(6,"div",50)(7,"div",25)(8,"p-checkbox",52),J("ngModelChange",function(t){w(e);let n=d(2);return Y(n.optionsPlugins.openvpn,t)||(n.optionsPlugins.openvpn=t),S(t)}),P("onChange",function(){w(e);let t=d(2);return S(t.onChangePlugins())}),u(),g(9," \xA0\xA0 "),c(10,"a",95),T(11,"img",96),u(),c(12,"p",45),g(13),C(14,"translate"),u()()(),c(15,"div",50)(16,"div",25)(17,"p-checkbox",52),J("ngModelChange",function(t){w(e);let n=d(2);return Y(n.optionsPlugins.keepalived,t)||(n.optionsPlugins.keepalived=t),S(t)}),P("onChange",function(){w(e);let t=d(2);return S(t.onChangePlugins())}),u(),g(18," \xA0\xA0 "),c(19,"a",97),T(20,"img",98),u(),c(21,"p",45),g(22),C(23,"translate"),u()()(),c(24,"div",50)(25,"div",25)(26,"p-checkbox",52),J("ngModelChange",function(t){w(e);let n=d(2);return Y(n.optionsPlugins.geoip,t)||(n.optionsPlugins.geoip=t),S(t)}),P("onChange",function(){w(e);let t=d(2);return S(t.onChangePlugins())}),u(),g(27," \xA0\xA0 "),c(28,"a",99),T(29,"img",100),u(),c(30,"p",45),g(31),C(32,"translate"),u()()(),c(33,"div",50)(34,"div",25)(35,"p-checkbox",52),J("ngModelChange",function(t){w(e);let n=d(2);return Y(n.optionsPlugins.crowdsec,t)||(n.optionsPlugins.crowdsec=t),S(t)}),P("onChange",function(){w(e);let t=d(2);return S(t.onChangePlugins())}),u(),g(36," \xA0\xA0 "),c(37,"a",56),T(38,"img",57),u(),c(39,"p",45),g(40),C(41,"translate"),u()()(),c(42,"div",50)(43,"div",25)(44,"p-checkbox",52),J("ngModelChange",function(t){w(e);let n=d(2);return Y(n.optionsPlugins.ntopng,t)||(n.optionsPlugins.ntopng=t),S(t)}),P("onChange",function(){w(e);let t=d(2);return S(t.onChangePlugins())}),u(),g(45," \xA0\xA0 "),c(46,"a",101),T(47,"img",102),u(),c(48,"p",45),g(49),C(50,"translate"),u()()(),c(51,"div",50)(52,"div",25)(53,"p-checkbox",52),J("ngModelChange",function(t){w(e);let n=d(2);return Y(n.optionsPlugins.websafety,t)||(n.optionsPlugins.websafety=t),S(t)}),P("onChange",function(){w(e);let t=d(2);return S(t.onChangePlugins())}),u(),g(54," \xA0\xA0 "),c(55,"a",103),T(56,"img",104),u(),c(57,"p",45),g(58),C(59,"translate"),u()()(),c(60,"div",50)(61,"div",25)(62,"p-checkbox",52),J("ngModelChange",function(t){w(e);let n=d(2);return Y(n.optionsPlugins.dnssafety,t)||(n.optionsPlugins.dnssafety=t),S(t)}),P("onChange",function(){w(e);let t=d(2);return S(t.onChangePlugins())}),u(),g(63," \xA0\xA0 "),c(64,"a",105),T(65,"img",106),u(),c(66,"p",45),g(67),C(68,"translate"),u()()(),c(69,"div",50)(70,"div",25)(71,"p-checkbox",52),J("ngModelChange",function(t){w(e);let n=d(2);return Y(n.optionsPlugins.iscbind9,t)||(n.optionsPlugins.iscbind9=t),S(t)}),P("onChange",function(){w(e);let t=d(2);return S(t.onChangePlugins())}),u(),g(72," \xA0\xA0 "),c(73,"a",107),T(74,"img",108),u(),c(75,"p",45),g(76),C(77,"translate"),u()()()(),c(78,"div",24)(79,"div",50)(80,"div",25)(81,"p-checkbox",52),J("ngModelChange",function(t){w(e);let n=d(2);return Y(n.optionsPlugins.suricata,t)||(n.optionsPlugins.suricata=t),S(t)}),P("onChange",function(){w(e);let t=d(2);return S(t.onChangePlugins())}),u(),g(82," \xA0\xA0 "),c(83,"a",109),T(84,"img",110),u(),c(85,"p",45),g(86),C(87,"translate"),u()()(),c(88,"div",50)(89,"div",25)(90,"p-checkbox",52),J("ngModelChange",function(t){w(e);let n=d(2);return Y(n.optionsPlugins.zeek,t)||(n.optionsPlugins.zeek=t),S(t)}),P("onChange",function(){w(e);let t=d(2);return S(t.onChangePlugins())}),u(),g(91," \xA0\xA0 "),c(92,"a",111),T(93,"img",112),u(),c(94,"p",45),g(95),C(96,"translate"),u()()(),c(97,"div",50)(98,"div",25)(99,"p-checkbox",52),J("ngModelChange",function(t){w(e);let n=d(2);return Y(n.optionsPlugins.elasticsearch,t)||(n.optionsPlugins.elasticsearch=t),S(t)}),P("onChange",function(){w(e);let t=d(2);return S(t.onChangePlugins())}),u(),g(100," \xA0\xA0 "),c(101,"a",113),T(102,"img",114),u(),c(103,"p",45),g(104),C(105,"translate"),u()()(),c(106,"div",50)(107,"div",25)(108,"p-checkbox",52),J("ngModelChange",function(t){w(e);let n=d(2);return Y(n.optionsPlugins.kibana,t)||(n.optionsPlugins.kibana=t),S(t)}),P("onChange",function(){w(e);let t=d(2);return S(t.onChangePlugins())}),u(),g(109," \xA0\xA0 "),c(110,"a",115),T(111,"img",116),u(),c(112,"p",45),g(113),C(114,"translate"),u()()(),c(115,"div",50)(116,"div",25)(117,"p-checkbox",52),J("ngModelChange",function(t){w(e);let n=d(2);return Y(n.optionsPlugins.logstash,t)||(n.optionsPlugins.logstash=t),S(t)}),P("onChange",function(){w(e);let t=d(2);return S(t.onChangePlugins())}),u(),g(118," \xA0\xA0 "),c(119,"a",117),T(120,"img",118),u(),c(121,"p",45),g(122),C(123,"translate"),u()()(),c(124,"div",50)(125,"div",25)(126,"p-checkbox",52),J("ngModelChange",function(t){w(e);let n=d(2);return Y(n.optionsPlugins.filebeat,t)||(n.optionsPlugins.filebeat=t),S(t)}),P("onChange",function(){w(e);let t=d(2);return S(t.onChangePlugins())}),u(),g(127," \xA0\xA0 "),c(128,"a",119),T(129,"img",120),u(),c(130,"p",45),g(131),C(132,"translate"),u()()(),c(133,"div",50)(134,"div",25)(135,"p-checkbox",52),J("ngModelChange",function(t){w(e);let n=d(2);return Y(n.optionsPlugins.iscdhcp,t)||(n.optionsPlugins.iscdhcp=t),S(t)}),P("onChange",function(){w(e);let t=d(2);return S(t.onChangePlugins())}),u(),g(136," \xA0\xA0 "),c(137,"a",121),T(138,"img",122),u(),c(139,"p",45),g(140),C(141,"translate"),u()()(),c(142,"div",50)(143,"div",25)(144,"p-checkbox",52),J("ngModelChange",function(t){w(e);let n=d(2);return Y(n.optionsPlugins.haproxy,t)||(n.optionsPlugins.haproxy=t),S(t)}),P("onChange",function(){w(e);let t=d(2);return S(t.onChangePlugins())}),u(),g(145," \xA0\xA0 "),c(146,"a",123),T(147,"img",124),u(),c(148,"p",45),g(149),C(150,"translate"),u()()()()()}if(l&2){let e=d(2);a(3),x(" ",y(4,65,"FW.MSG_FW_EDITION.PLUGINS")," "),a(5),m("binary",!0),H("ngModel",e.optionsPlugins.openvpn),m("ngModelOptions",W(99,be)),a(5),x("\xA0\xA0",y(14,67,"FW.PLUGINS.OPENVPN"),""),a(4),m("binary",!0),H("ngModel",e.optionsPlugins.keepalived),m("ngModelOptions",W(100,be)),a(5),x("\xA0\xA0",y(23,69,"FW.PLUGINS.KEEPALIVED"),""),a(4),m("binary",!0),H("ngModel",e.optionsPlugins.geoip),m("ngModelOptions",W(101,be)),a(5),x("\xA0\xA0",y(32,71,"FW.PLUGINS.GEOIP"),""),a(4),m("binary",!0),H("ngModel",e.optionsPlugins.crowdsec),m("ngModelOptions",W(102,be)),a(5),x("\xA0\xA0",y(41,73,"FW.PLUGINS.CROWDSEC"),""),a(4),m("binary",!0),H("ngModel",e.optionsPlugins.ntopng),m("ngModelOptions",W(103,be)),a(5),x("\xA0\xA0",y(50,75,"FW.PLUGINS.NTOPNG"),""),a(4),m("binary",!0),H("ngModel",e.optionsPlugins.websafety),m("ngModelOptions",W(104,be)),a(5),x("\xA0\xA0",y(59,77,"FW.PLUGINS.WEBSAFETY"),""),a(4),m("binary",!0),H("ngModel",e.optionsPlugins.dnssafety),m("ngModelOptions",W(105,be)),a(5),x("\xA0\xA0",y(68,79,"CLUSTER.PLUGINS.DNSSAFETY"),""),a(4),m("binary",!0),H("ngModel",e.optionsPlugins.iscbind9),m("ngModelOptions",W(106,be)),a(5),x("\xA0\xA0",y(77,81,"FW.PLUGINS.ISCBIND9"),""),a(5),m("binary",!0),H("ngModel",e.optionsPlugins.suricata),m("ngModelOptions",W(107,be)),a(5),x("\xA0\xA0",y(87,83,"FW.PLUGINS.SURICATA"),""),a(4),m("binary",!0),H("ngModel",e.optionsPlugins.zeek),m("ngModelOptions",W(108,be)),a(5),x("\xA0\xA0",y(96,85,"FW.PLUGINS.ZEEK"),""),a(4),m("binary",!0),H("ngModel",e.optionsPlugins.elasticsearch),m("ngModelOptions",W(109,be)),a(5),x("\xA0\xA0",y(105,87,"CLUSTER.PLUGINS.ELASTICSEARCH"),""),a(4),m("binary",!0),H("ngModel",e.optionsPlugins.kibana),m("ngModelOptions",W(110,be)),a(5),x("\xA0\xA0",y(114,89,"CLUSTER.PLUGINS.KIBANA"),""),a(4),m("binary",!0),H("ngModel",e.optionsPlugins.logstash),m("ngModelOptions",W(111,be)),a(5),x("\xA0\xA0",y(123,91,"CLUSTER.PLUGINS.LOGSTASH"),""),a(4),m("binary",!0),H("ngModel",e.optionsPlugins.filebeat),m("ngModelOptions",W(112,be)),a(5),x("\xA0\xA0",y(132,93,"FW.PLUGINS.FILEBEAT"),""),a(4),m("binary",!0),H("ngModel",e.optionsPlugins.iscdhcp),m("ngModelOptions",W(113,be)),a(5),x("\xA0\xA0",y(141,95,"FW.PLUGINS.ISCDHCP"),""),a(4),m("binary",!0),H("ngModel",e.optionsPlugins.haproxy),m("ngModelOptions",W(114,be)),a(5),x("\xA0\xA0",y(150,97,"FW.PLUGINS.HAPROXY"),"")}}function Ic(l,_){if(l&1&&(c(0,"div",21)(1,"div",50),T(2,"sts-fwc-message",94),u()()),l&2){let e=d(2);a(2),m("message",Ze(1,Ul,e.translate.instant("NGFW.TITLE"),e.translate.instant("NGFW.ERRORS.COMMUNICATION.TEXT")))}}function bc(l,_){if(l&1){let e=L();c(0,"div",21)(1,"div",29)(2,"label",125)(3,"a",101),T(4,"img",126),u(),g(5),C(6,"translate"),u(),c(7,"button",127),C(8,"translate"),C(9,"translate"),P("click",function(){w(e);let t=d(3);return S(t.onClickButtonNGFW("NTOPNG"))}),u()(),c(10,"div",29)(11,"label",128)(12,"a",103),T(13,"img",129),u(),g(14),C(15,"translate"),u(),c(16,"button",127),C(17,"translate"),C(18,"translate"),P("click",function(){w(e);let t=d(3);return S(t.onClickButtonNGFW("WEBSAFETYPROXY"))}),u()(),c(19,"div",29)(20,"label",130)(21,"a",105),T(22,"img",131),u(),g(23),C(24,"translate"),u(),c(25,"button",127),C(26,"translate"),C(27,"translate"),P("click",function(){w(e);let t=d(3);return S(t.onClickButtonNGFW("DNSSAFETY"))}),u()(),c(28,"div",29)(29,"label",132)(30,"a",113),T(31,"img",133),u(),g(32),C(33,"translate"),u(),c(34,"button",127),C(35,"translate"),C(36,"translate"),P("click",function(){w(e);let t=d(3);return S(t.onClickButtonNGFW("ELASTICSEARCH"))}),u()()()}if(l&2){let e=d(3);a(5),x(" ",y(6,16,"CONTEXT.FW.NTOPNG"),""),a(2),M("pTooltip",y(8,18,"CONTEXT.FW.NTOPNG")),M("label",y(9,20,"CONTEXT.FW.NTOPNG")),m("disabled",!e.checksNtopNGConfig()),a(7),x(" ",y(15,22,"CONTEXT.FW.WEBSAFETYPROXY"),""),a(2),M("pTooltip",y(17,24,"CONTEXT.FW.WEBSAFETYPROXY")),M("label",y(18,26,"CONTEXT.FW.WEBSAFETYPROXY")),m("disabled",!e.checksWebSafetyProxyActie()),a(7),x(" ",y(24,28,"CONTEXT.FW.DNSSAFETY"),""),a(2),M("pTooltip",y(26,30,"CONTEXT.FW.DNSSAFETY")),M("label",y(27,32,"CONTEXT.FW.DNSSAFETY")),m("disabled",!e.checksDNSSafetyActive()),a(7),x(" ",y(33,34,"CLUSTER.PLUGINS.ELASTICSEARCH"),""),a(2),M("pTooltip",y(35,36,"CLUSTER.PLUGINS.ELASTICSEARCH")),M("label",y(36,38,"CLUSTER.PLUGINS.ELASTICSEARCH")),m("disabled",!e.checksElasticSearchActive())}}function Pc(l,_){if(l&1&&(c(0,"div",21)(1,"div",22)(2,"h5",23),g(3),C(4,"translate"),u()(),g(5," \xA0 "),A(6,bc,37,40,"div",21),u()),l&2){let e,i=d(2);a(3),x(" ",y(4,2,"NGFW.DESCRIPTION")," "),a(3),O(((e=i.formModel.get("install_communication"))==null?null:e.value)==="agent"?6:-1)}}function Tc(l,_){if(l&1){let e=L();c(0,"form",17),P("keyup.enter",function(t){w(e);let n=d();return S(n.checkForm(t))})("keyup.esc",function(){w(e);let t=d();return S(t.onCancel())}),c(1,"fieldset",18)(2,"p-tabView",19),P("onChange",function(t){w(e);let n=d();return S(n.onChangeTab(t))}),c(3,"p-tabPanel",20),C(4,"translate"),c(5,"div",21)(6,"div",22)(7,"h5",23),g(8),C(9,"translate"),u()(),c(10,"div",24)(11,"div",25)(12,"label",26),g(13),C(14,"translate"),u(),T(15,"input",27,1),C(17,"translate"),u(),c(18,"p",28),g(19),C(20,"translate"),u()(),c(21,"div",29)(22,"div",25)(23,"label",30),g(24),C(25,"translate"),u(),c(26,"select",31,2),P("change",function(){w(e);let t=d();return S(t.changeCompilerOptions())}),Oe(28,sc,2,2,"option",32,Te),u()()(),c(30,"div",29)(31,"div",25)(32,"label",33),g(33),C(34,"translate"),u(),c(35,"select",34),P("change",function(t){w(e);let n=d();return S(n.handleFirewallManagementChange(t))}),c(36,"option",35),g(37),C(38,"translate"),u(),c(39,"option",36),g(40,"SSH"),u(),c(41,"option",37),g(42,"FWCloud-Agent"),u()()()(),c(43,"div",38)(44,"div",25)(45,"label",39),g(46),C(47,"translate"),u()()(),c(48,"div",40),T(49,"textarea",41),u()(),c(50,"div",21)(51,"div",22)(52,"h5",42),g(53),C(54,"translate"),C(55,"translate"),u()(),A(56,cc,21,15)(57,dc,21,26),c(58,"div",43)(59,"button",44),C(60,"translate"),P("click",function(){w(e);let t=d();return S(t.onDiscoverInterfaces())}),u()()(),c(61,"div",21)(62,"div",22)(63,"h5",45),g(64),C(65,"translate"),u()(),A(66,uc,22,19)(67,yc,2,1),u()(),c(68,"p-tabPanel",46),C(69,"translate"),c(70,"sts-fwc-interfaces-tree-editor",47,3),P("onInstallModified",function(t){w(e);let n=d();return S(n.onEditorInstallModified(t))})("onIpObjectModified",function(t){w(e);let n=d();return S(n.onEditorInterfaceOrIpModified(t))})("onStartAutodiscover",function(){w(e);let t=d();return S(t.onDiscoverInterfaces(!0))}),u()(),c(72,"p-tabPanel",48),C(73,"translate"),T(74,"input",49),c(75,"div",21)(76,"div",22)(77,"h5",23),g(78),C(79,"translate"),u()(),c(80,"div",24)(81,"div",50)(82,"div",25)(83,"p-checkbox",51),J("ngModelChange",function(t){w(e);let n=d();return Y(n.optionsFlags.stateful,t)||(n.optionsFlags.stateful=t),S(t)}),P("onChange",function(){w(e);let t=d();return S(t.onChangeOptionsFlags())}),u()()(),c(84,"div",50)(85,"div",25)(86,"p-checkbox",51),J("ngModelChange",function(t){w(e);let n=d();return Y(n.optionsFlags.ipv4,t)||(n.optionsFlags.ipv4=t),S(t)}),P("onChange",function(){w(e);let t=d();return S(t.onChangeOptionsFlags())}),u()()(),c(87,"div",50)(88,"div",25)(89,"p-checkbox",51),J("ngModelChange",function(t){w(e);let n=d();return Y(n.optionsFlags.ipv6,t)||(n.optionsFlags.ipv6=t),S(t)}),P("onChange",function(){w(e);let t=d();return S(t.onChangeOptionsFlags())}),u()()(),c(90,"div",50)(91,"div",25)(92,"p-checkbox",51),J("ngModelChange",function(t){w(e);let n=d();return Y(n.optionsFlags.debug,t)||(n.optionsFlags.debug=t),S(t)}),P("onChange",function(){w(e);let t=d();return S(t.onChangeOptionsFlags())}),u()()(),c(93,"div",50)(94,"div",25)(95,"p-checkbox",51),J("ngModelChange",function(t){w(e);let n=d();return Y(n.optionsFlags.report,t)||(n.optionsFlags.report=t),S(t)}),P("onChange",function(){w(e);let t=d();return S(t.onChangeOptionsFlags())}),u()()()(),c(96,"div",24)(97,"div",50)(98,"div",25)(99,"p-checkbox",52),J("ngModelChange",function(t){w(e);let n=d();return Y(n.optionsFlags.docker,t)||(n.optionsFlags.docker=t),S(t)}),P("onChange",function(){w(e);let t=d();return S(t.onChangeOptionsFlags())}),u(),g(100," \xA0\xA0 "),c(101,"a",53),T(102,"img",54),u(),c(103,"p",45),g(104),C(105,"translate"),u(),c(106,"a",55),g(107,"(+ info)"),u()()(),c(108,"div",50)(109,"div",25)(110,"p-checkbox",52),J("ngModelChange",function(t){w(e);let n=d();return Y(n.optionsFlags.crowdsec,t)||(n.optionsFlags.crowdsec=t),S(t)}),P("onChange",function(){w(e);let t=d();return S(t.onChangeOptionsFlags())}),u(),g(111," \xA0\xA0 "),c(112,"a",56),T(113,"img",57),u(),c(114,"p",45),g(115),C(116,"translate"),u()()(),c(117,"div",50)(118,"div",25)(119,"p-checkbox",52),J("ngModelChange",function(t){w(e);let n=d();return Y(n.optionsFlags.fail2ban,t)||(n.optionsFlags.fail2ban=t),S(t)}),P("onChange",function(){w(e);let t=d();return S(t.onChangeOptionsFlags())}),u(),g(120," \xA0\xA0 "),c(121,"a",58),T(122,"img",59),u(),c(123,"p",45),g(124),C(125,"translate"),u()()()()()(),c(126,"p-tabPanel",60),C(127,"translate"),T(128,"input",61),A(129,Ec,3,4,"div",21)(130,vc,151,115,"div",21),u(),c(131,"p-tabPanel",62),C(132,"translate"),A(133,Ic,3,4,"div",21)(134,Pc,7,4,"div",21),u()()()()}if(l&2){let e,i,t,n,o,r,p,s,f=d();m("formGroup",f.formModel),a(),m("disabled",f.loadingData),a(),m("activeIndex",f.shownPanel),a(),M("header",y(4,71,"FW.MSG_FW_TAB.FT_0")),m("disabled",f.loadingData),a(5),x(" ",y(9,73,"FW.MSG_FW_EDITION.BASIC_DATA")," "),a(5),j(y(14,75,"FW.MSG_FW_EDITION.NAME")),a(2),M("placeholder",y(17,77,"FW.MSG_FW_EDITION.NAME")),a(3),m("ngStyle",ae(113,Nl,f.formModel.get("name").valid||f.formModel.get("name").pristine?"hidden":"visible")),a(),x(" ",y(20,79,"ITEM_PANEL.ERRORS.FIELD_INVALID_NAME")," "),a(5),j(y(25,81,"FW.MSG_FW_EDITION.COMPILER")),a(4),Re(f.FirewallCompilerOptions),a(5),j(y(34,83,"FW.MSG_FW_EDITION.COMM_TYPE")),a(3),m("value",null),a(),x(" ",y(38,85,"FW.MSG_FW_EDITION.COMM_TYPE")," "),a(2),m("disabled",f.isSSHCommunicationDisabled),a(7),j(y(47,87,"FW.MSG_FW_EDITION.DESC")),a(3),m("rows",3)("cols",30),a(4),x(" ",((e=f.formModel.get("install_communication"))==null?null:e.value)==="agent"?y(54,89,"FW.MSG_FW_EDITION.AGENT_DATA"):y(55,91,"FW.MSG_FW_EDITION.SSH")," "),a(3),O(((i=f.formModel.get("install_communication"))==null?null:i.value)==="agent"?56:57),a(3),M("label",y(60,93,"FW.MSG_FW_EDITION.DISCOVER_IF")),m("disabled",f.loadingData),a(5),x(" ",y(65,95,"FW.MSG_FW_EDITION.INSTALL")," "),a(2),O(f.discoveredInstallOptions?66:67),a(2),M("header",y(69,97,"FW.MSG_FW_TAB.FT_1")),m("disabled",f.loadingData),a(2),m("options",f.interfacesEditorOptions),a(2),M("header",y(73,99,"FW.MSG_FW_TAB.FT_2")),m("disabled",f.loadingData),a(6),x(" ",y(79,101,"FW.MSG_FW_EDITION.OPTIONS_DATA")," "),a(5),m("binary",!0),H("ngModel",f.optionsFlags.stateful),m("ngModelOptions",W(115,be))("label",f.translate.instant("FW.OPTION_NAMES.stateful")),a(3),m("binary",!0),H("ngModel",f.optionsFlags.ipv4),m("ngModelOptions",W(116,be))("label",f.translate.instant("FW.OPTION_NAMES.ipv4")),a(3),m("binary",!0),H("ngModel",f.optionsFlags.ipv6),m("ngModelOptions",W(117,be))("label",f.translate.instant("FW.OPTION_NAMES.ipv6")),a(3),m("binary",!0),H("ngModel",f.optionsFlags.debug),m("ngModelOptions",W(118,be))("label",f.translate.instant("FW.OPTION_NAMES.debug")),a(3),m("binary",!0),H("ngModel",f.optionsFlags.report),m("ngModelOptions",W(119,be))("label",f.translate.instant("FW.OPTION_NAMES.report")),a(4),m("binary",!0),H("ngModel",f.optionsFlags.docker),m("ngModelOptions",W(120,be)),a(5),x("\xA0\xA0",y(105,103,"FW.OPTION_NAMES.docker"),""),a(2),M("href",f.dockerDocURL,oi),a(4),m("binary",!0),H("ngModel",f.optionsFlags.crowdsec),m("ngModelOptions",W(121,be)),a(5),x("\xA0\xA0",y(116,105,"FW.OPTION_NAMES.crowdsec"),""),a(4),m("binary",!0),H("ngModel",f.optionsFlags.fail2ban),m("ngModelOptions",W(122,be)),a(5),x("\xA0\xA0",y(125,107,"FW.OPTION_NAMES.fail2ban"),""),a(2),M("header",y(127,109,"FW.MSG_FW_EDITION.PLUGINS")),m("disabled",f.loadingData||((t=f.formModel.get("install_communication"))==null?null:t.value)!=="agent"),a(3),O(((n=f.formModel.get("install_communication"))==null?null:n.value)!=="agent"?129:-1),a(),O(((o=f.formModel.get("install_communication"))==null?null:o.value)==="agent"?130:-1),a(),M("header",y(132,111,"NGFW.TITLE")),m("disabled",f.loadingData||((r=f.formModel.get("install_communication"))==null?null:r.value)!=="agent"),a(2),O(((p=f.formModel.get("install_communication"))==null?null:p.value)!=="agent"?133:-1),a(),O(((s=f.formModel.get("install_communication"))==null?null:s.value)==="agent"?134:-1)}}function Oc(l,_){if(l&1&&(c(0,"div",134),T(1,"sts-fwc-message",94),u()),l&2){let e=d(2);a(),m("message",e.delMessage)}}function Rc(l,_){if(l&1){let e=L();c(0,"div",135),T(1,"sts-fwc-message",94),c(2,"sts-fwc-object-restrictions",136),P("onHideParent",function(){w(e);let t=d(3);return S(t.minimizeDialog(!0))})("onRefreshRestrictions",function(){w(e);let t=d(3);return S(t.reloadPanel())}),u()()}if(l&2){let e=d(3);a(),m("message",e.deleteMsgError),a(),m("dependencies",e.dependencies)}}function xc(l,_){if(l&1&&A(0,Rc,3,2,"div",135),l&2){let e=d(2);O(e.dependencies.restrictionsError?-1:0)}}function Fc(l,_){if(l&1){let e=L();c(0,"div",134)(1,"p-checkbox",137),C(2,"translate"),J("ngModelChange",function(t){w(e);let n=d(3);return Y(n.okToDelete,t)||(n.okToDelete=t),S(t)}),u()()}if(l&2){let e=d(3);a(),M("label",y(2,2,"FW.MSG_FW_DELETE.DEL_5")),H("ngModel",e.okToDelete)}}function Ac(l,_){if(l&1&&(T(0,"sts-fwc-message",94),A(1,Fc,3,4,"div",134)),l&2){let e=d(2);m("message",e.deleteMsgError),a(),O(e.loadingData?-1:1)}}function Lc(l,_){if(l&1&&A(0,Oc,2,1,"div",134)(1,xc,1,1)(2,Ac,2,2),l&2){let e=d();O(e.loadingData&&!e.deleteMsgError?0:-1),a(),O(e.dependencies?1:2)}}function Mc(l,_){if(l&1&&(c(0,"div",138),T(1,"p-progressSpinner"),u()),l&2){let e=d(3);m("ngStyle",ae(3,Nl,e.loadingData?"visible":"hidden")),a(),ke(W(5,$s))}}function Dc(l,_){if(l&1){let e=L();c(0,"button",143),C(1,"translate"),P("click",function(){w(e);let t=d(3);return S(t.onCloseDialog())}),u()}l&2&&M("label",y(1,1,"GLOBALS.MSG_BUTTONS.STOP"))}function Nc(l,_){if(l&1){let e=L();c(0,"button",144),C(1,"translate"),P("click",function(){w(e);let t=d(3);return S(t.onCancel())}),u()}if(l&2){let e=d(3);M("label",y(1,2,"GLOBALS.MSG_BUTTONS.CANCEL")),m("disabled",e.loadingData)}}function Uc(l,_){if(l&1){let e=L();c(0,"button",145),C(1,"translate"),P("click",function(){w(e);let t=d(3);return S(t.onSave())}),u()}if(l&2){let e=d(3);M("label",y(1,2,"GLOBALS.MSG_BUTTONS.SAVE")),m("disabled",!e.formModel.valid||e.loadingData)}}function Gc(l,_){if(l&1){let e=L();c(0,"button",146),C(1,"translate"),P("click",function(){w(e);let t=d(3);return S(t.onCancel())}),u()}if(l&2){let e=d(3);M("label",y(1,2,"GLOBALS.MSG_BUTTONS.CLOSE")),m("disabled",e.loadingData)}}function Bc(l,_){if(l&1&&A(0,Mc,2,6,"div",138)(1,Dc,2,3,"button",139)(2,Nc,2,4,"button",140)(3,Uc,2,4,"button",141)(4,Gc,2,4,"button",142),l&2){let e=d(2);O(e.loadingCommunication?0:-1),a(),O(e.loadingCommunication?1:-1),a(),O(!e.formModel.pristine&&!e.loadingCommunication?2:-1),a(),O(e.formModel.pristine?-1:3),a(),O(e.formModel.pristine?4:-1)}}function kc(l,_){if(l&1){let e=L();c(0,"button",149),C(1,"translate"),P("click",function(){w(e);let t=d(3);return S(t.reloadPanel())}),u()}if(l&2){let e=d(3);M("label",y(1,2,"POLICY_GRID.RELOAD")),m("disabled",e.loadingData)}}function jc(l,_){if(l&1){let e=L();A(0,kc,2,4,"button",147),c(1,"button",148),C(2,"translate"),P("click",function(){w(e);let t=d(2);return S(t.onDeleteFirewall())}),u(),c(3,"button",146),C(4,"translate"),P("click",function(){w(e);let t=d(2);return S(t.onCancel())}),u()}if(l&2){let e=d(2);O(e.dependencies?0:-1),a(),M("label",y(2,5,"FW.MSG_FW_EDITION.DELETE")),m("disabled",!e.okToDelete||e.loadingData),a(2),M("label",y(4,7,"GLOBALS.MSG_BUTTONS.CANCEL")),m("disabled",e.loadingData)}}function Vc(l,_){if(l&1&&A(0,Bc,5,5)(1,jc,5,9),l&2){let e=d();O(e.firewall?0:-1),a(),O(e.firewallToDelete?1:-1)}}var It=function(l){return l.stateful="stateful",l.ipv4="ipv4",l.ipv6="ipv6",l.debug="debug",l.report="report",l.docker="docker",l.crowdsec="crowdsec",l.fail2ban="fail2ban",l}(It||{}),Je=function(l){return l.openvpn="openvpn",l.geoip="geoip",l.crowdsec="crowdsec",l.ntopng="ntopng",l.suricata="suricata",l.keepalived="keepalived",l.zeek="zeek",l.elasticsearch="elasticsearch",l.filebeat="filebeat",l.websafety="websafety",l.kibana="kibana",l.logstash="logstash",l.dnssafety="dnssafety",l.iscbind9="iscbind9",l.iscdhcp="iscdhcp",l.haproxy="haproxy",l}(Je||{}),Al=new Map([[It.stateful,0],[It.ipv4,1],[It.ipv6,2],[It.debug,3],[It.report,4],[It.docker,5],[It.crowdsec,6],[It.fail2ban,7]]),Ye=new Map([["openvpn",1],["geoip",2],["crowdsec",4],["ntopng",8],["suricata",16],["keepalived",32],["zeek",64],["elasticsearch",128],["filebeat",256],["websafety",512],["kibana",1024],["logstash",2048],["dnssafety",4096],["iscbind9",8192],["iscdhcp",16384],["haproxy",32768]]),Gl=(()=>{class l extends Dt{userAndPassValidator(e){let i=this,t=i.controls.install_user.value,n=i.controls.install_pass.value;return(!t||!t.length)&&n&&n.length?{userandpass:!0}:null}constructor(e,i,t,n,o,r,p,s,f,h,E,b,I,R,V,G,D){super(h,r,i,V,G,D),this.fwcUserService=e,this.itemSelectedService=i,this.fwcFirewallService=t,this.fwcInterfaceService=n,this.confirmationService=o,this.appOptionsService=r,this.fwcPolicyService=p,this.fwcEventService=s,this.fwcErrorPipe=f,this.appDialogPanelsService=h,this.messageService=E,this.translate=b,this.utilService=I,this.inputDataService=R,this.cd=V,this.store=G,this.router=D,this.firewall=null,this.firewallToDelete=null,this.interfaces=[],this.interfacesIpObjs=[],this.displaySSH=!1,this.loadingData=!1,this.loadingCommunication=!1,this.dependencies=null,this.okToDelete=!1,this.alive=!0,this.displayApiKey=!1,this.isSSHCommunicationDisabled=!1,this.FirewallCompilerOptions=Kt,this.optionsFlags={stateful:!1,ipv4:!1,ipv6:!1,debug:!1,report:!1,docker:!1,crowdsec:!1,fail2ban:!1},this.optionsPlugins={openvpn:!1,geoip:!1,crowdsec:!1,ntopng:!1,suricata:!1,keepalived:!1,zeek:!1,elasticsearch:!1,filebeat:!1,websafety:!1,kibana:!1,logstash:!1,dnssafety:!1,iscbind9:!1,iscdhcp:!1,haproxy:!1},this.createDialog(this.translate.instant("FW.PANEL_TITLE"),"fwci-firewalls",ee.FIREWALL_PANEL),this.helpSection="/firewalls",this.resetForm()}ngOnInit(){this.dockerDocURL=`https://fwcloud.net/${this.translate.currentLang!=="es"?this.translate.currentLang+"/":""}documentation/fwcloud-docker`,this.deleteMsgError=null,this.store.pipe($(()=>this.alive),zt(xi.selectDialogUuidsToReload)).subscribe(e=>{e&&e.find(i=>i===this.dialogUUID)&&this.reloadPanel()}),this.checkSSHCommunicationConfig(),this.itemSelectedService.getItem().pipe($(()=>this.alive)).subscribe(e=>{e._fwcObjType==v.OBJ_FIREWALL&&(this.itemSelectedService.hideObjectPanel(),e.deleteAction?(this.showDialog(),this.checkFirewallRestrictions(e)):(this.resetForm(),e.id_obj!==null&&e.id_obj!=null?Promise.all([this.getClusterNodes(e._fwcClusterId,e.id_obj)]).then(([i])=>{let t=this.getMasterFirewall(i);t||(t=e.id_obj),Promise.all([this.getFirewall(e.id_obj),this.getFirewallInterfaces(t)]).then(r=>Z(this,[r],function*([n,o]){this.firewall=n.data;let p=this.fwcUserService.getActualFwcUser().privateKey;try{this.firewall.install_user&&(this.firewall.install_user=yield this.utilService.openPGPDecrypt(this.firewall.install_user,p)),this.firewall.install_pass&&(this.firewall.install_pass=yield this.utilService.openPGPDecrypt(this.firewall.install_pass,p)),this.firewall.install_apikey&&(this.firewall.install_apikey=yield this.utilService.openPGPDecrypt(this.firewall.install_apikey,p))}catch{}this.firewall._fwcClusterId=e._fwcClusterId,this.firewall.firewallUUID=Et(),this.interfaces=o.data;let s,f;Array.isArray(this.interfaces)&&this.interfaces.forEach(h=>{h.interfaceUUID=Ui(),this.firewall.install_interface&&this.firewall.install_interface===h.id&&(this.firewall.installInterfaceUUID=h.interfaceUUID,s=h),Array.isArray(h.ipobjs)&&h.ipobjs.forEach(E=>{E.ipObjUUID=h.interfaceUUID+Ui(),this.firewall.install_ipobj&&this.firewall.install_ipobj===E.id&&(this.firewall.installIpObjUUID=E.ipObjUUID,f=E)})}),Array.isArray(this.interfaces)&&(this.interfacesEditorOptions={isCluster:!1,firewalls:[{firewallUUID:this.firewall.firewallUUID,firewall_name:this.firewall.name,firewall:this.firewall.id,cluster:null,installOptions:{firewallUUID:this.firewall.firewallUUID,interface:s,ipobj:f}}],discoveredFirewallUUID:this.firewall.firewallUUID,discoveredIfs:[],existingIfs:this.interfaces}),this.fillForm(),this.showDialog()})).catch(n=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(n)})})}).catch(i=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(i)})}):(this.firewall={firewallUUID:Et(),id:void 0,fwmaster:1,node_id:e.node_id,options:3,plugins:0},this.fillForm(),this.showDialog())))})}ngOnDestroy(){super.ngOnDestroy()}reloadPanel(){if(this.firewallToDelete&&this.firewallToDelete&&(this.displayDialog||this.dialogMinified)){let e=Object.assign({},this.firewallToDelete),i=this.itemSelectedService.getActualLastMinifiedDialogId();this.checkFirewallRestrictions(e),this.dialogId==i&&(this.showDialog(),this.itemSelectedService.setLastMinifiedDialogId(void 0)),this.store.dispatch(me.reloadDialogFinished({dialogUuid:this.dialogUUID}))}}resetProperties(){this.firewall=null,this.firewallToDelete=null,this.interfaces=[],this.interfacesIpObjs=[],this.dependencies=null,this.deleteMsgError=null,this.delMessage=null,this.fwcUserService.setConfirmationToken(void 0),this.interfacesEditorOptions=null,this.fwcInterfacesEditor&&this.fwcInterfacesEditor.resetProperties(),this.discoveredInstallOptions=null,this.formModel&&this.formModel.reset()}resetForm(){this.formModel=new ri({cluster:new k(null),name:new k("",Q.required),comment:new k(""),fwcloud:new k(this.fwcUserService.getActualFwSelectedCloud()),install_user:new k(""),install_pass:new k(""),save_user_pass:new k(1),install_interface:new k(null),install_ipobj:new k(null),fwmaster:new k(1),install_port:new k(33033),options:new k(3),node_id:new k(null),firewall:new k(null),plugins:new k(0),compiler:new k(0),install_communication:new k("agent",[Q.required]),install_protocol:new k("https"),install_apikey:new k("")}),this.formModel.get("install_interface").valueChanges.subscribe(e=>{this.onInterfaceChange(+e)})}fillForm(){if(this.firewall){this.formModel.controls.cluster.setValue(this.firewall.cluster),this.formModel.controls.name.setValue(this.firewall.name,[Q.pattern(ye.nameRegExp)]),this.formModel.controls.comment.setValue(this.firewall.comment),this.formModel.controls.install_user.setValue(this.firewall.install_user,[Q.pattern(ye.linuxUsername)]),this.formModel.controls.install_pass.setValue(this.firewall.install_pass,[Q.pattern(ye.linuxPassword)]),this.formModel.controls.save_user_pass.setValue(1),this.formModel.controls.install_interface.setValue(this.firewall.install_interface),this.formModel.controls.install_ipobj.setValue(this.firewall.install_ipobj),this.formModel.controls.fwmaster.setValue(this.firewall.fwmaster),this.firewall.install_port&&this.formModel.controls.install_port.setValue(this.firewall.install_port),this.formModel.controls.options.setValue(this.firewall.options),this.setOptionsFlags(),this.formModel.controls.plugins.setValue(this.firewall.plugins),this.setOptionsPlugins(),this.formModel.controls.node_id.setValue(this.firewall.node_id),this.formModel.controls.firewall.setValue(this.firewall.id),this.firewall.install_communication&&this.formModel.controls.install_communication.setValue(this.firewall.install_communication),this.firewall.install_protocol&&this.formModel.controls.install_protocol.setValue(this.firewall.install_protocol),this.firewall.install_apikey&&this.formModel.controls.install_apikey.setValue(this.firewall.install_apikey),this.firewall.type=v.OBJ_FIREWALL,this.firewall.container=it.C_FIREWALLS;let e=this.firewall.options&61440;this.formModel.controls.compiler.setValue(e>>12)}}onInterfaceChange(e){if(this.interfaces){for(let i=0;i<this.interfaces.length;i++)this.interfaces[i]&&this.interfaces[i].id==e&&(this.interfacesIpObjs=this.interfaces[i].ipobjs);this.formModel.get("install_ipobj").setValue(null)}}setOptionsFlags(){this.firewall&&Object.values(It).forEach(e=>{this.optionsFlags[e]=!!(this.firewall.options&2**Al.get(e))})}onChangeOptionsFlags(){let e=[];for(let i of Object.values(It)){let t=Al.get(i);e[t]=this.optionsFlags[i]?"1":"0"}this.formModel.controls.options.setValue(parseInt(e.reduce((i,t)=>t+i,""),2)),this.formModel.markAsDirty()}changeCompilerOptions(){let e=this.formModel.get("compiler").value,i=this.formModel.get("options").value,t=e<<12,n=i&4095;this.formModel.get("options").setValue(t|n)}getMasterFirewall(e){let i=null;if(e.data)for(let t=0;t<e.data.length;t++){let n=e.data[t];if(n.fwmaster){i=n.id;break}}return i}getClusterNodes(e,i){let t={};return new Promise((o,r)=>{e?this.fwcFirewallService.getClusterNodes(e,this.fwcUserService.getActualFwSelectedCloud()).subscribe(p=>{o(p)},p=>{r(p)}):o(t)})}getFirewalls(){return new Promise((i,t)=>{this.fwcFirewallService.getFirewallsByCloud(this.fwcUserService.getActualFwSelectedCloud()).subscribe(n=>{i(n)},n=>{t(n)})})}getClusters(){return new Promise((i,t)=>{this.fwcFirewallService.getClustersByCloud(this.fwcUserService.getActualFwSelectedCloud()).subscribe(n=>{i(n)},n=>{t(n)})})}getFirewall(e){return new Promise((t,n)=>{this.fwcFirewallService.getFirewall(e,this.fwcUserService.getActualFwSelectedCloud()).subscribe(o=>{t(o)},o=>{n(o)})})}getFirewallInterfaces(e){return new Promise((t,n)=>{this.fwcInterfaceService.getInterfacesInFwFull(e,this.fwcUserService.getActualFwSelectedCloud()).subscribe(o=>{t(o)},o=>{n(o)})})}onCancel(e){!e&&this.formModel&&!this.formModel.pristine&&this.formModel.valid?this.confirmationService.confirm({header:this.translate.instant("GLOBALS.MSG_CONFIRM"),icon:"fa fa-question-circle fwcBlue iconBig",message:this.translate.instant("FW.MSG_FW_EXIT"),accept:()=>{this.onCancel(!0)},rejectVisible:!0,rejectLabel:"No",acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.YES")}):(this.hideDialog(),this.resetProperties()),this.shownPanel=0}checkFirewallRestrictions(e){e&&(this.loadingData=!0,this.firewallToDelete=e,this.dependencies=null,this.deleteMsgError=null,this.delMessage={type:"loading",title:this.translate.instant("FW.MSG_FW_DELETE.CHECKING_HEAD"),text:this.translate.instant("FW.MSG_FW_DELETE.CHECKING_TEXT")},this.okToDelete=!1,Promise.all([this.getClusterNodes(e._fwcClusterId,e.id_obj),this.getFirewalls(),this.getClusters()]).then(([i,t,n])=>{let o=t.data,r=n.data;for(let s=0;s<o.length;s++){let f=o[s];if(f.cluster!==null&&f.cluster!==void 0)for(let h=0;h<r.length;h++){let E=r[h];if(f.cluster==E.id){f.cluster_name=E.name;break}}}let p=this.getMasterFirewall(i);if(p||(p=e.id_obj),e._fwcClusterId){this.loadingData=!1;return}this.fwcFirewallService.checkFwRestrictions(e.id_obj,this.fwcUserService.getActualFwSelectedCloud()).subscribe(s=>{let f=s.data.fwc_confirm_token;this.fwcUserService.setConfirmationToken(f),this.deleteMsgError={type:"warning",title:this.translate.instant("FW.MSG_FW_DELETE.DEL_2"),text:this.translate.instant("FW.MSG_FW_DELETE.DEL_3",{name:e._fwcObjName})},this.dependencies=null,this.loadingData=!1,this.recenterDialog()},s=>{if(s.error){if(s.error.restrictions)try{this.dependencies=s.error.restrictions,this.dependencies._fwcRestrictedObject={_fwcObjId:e.id_obj,_fwcObjType:v.OBJ_CLUSTER},this.deleteMsgError={type:"error",title:this.translate.instant("FW.MSG_FW_DELETE.DEL_0"),text:this.translate.instant("FW.MSG_FW_DELETE.DEL_1",{name:e._fwcObjName})},this.recenterDialog()}catch(f){this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:f})}else this.deleteMsgError={type:"error",title:this.translate.instant("FW.MSG_FW_DELETE.DEL_0"),text:this.translate.instant("FW.MSG_FW_DELETE.ERROR_RES_TEXT",{error:this.fwcErrorPipe.transform(s)})},this.dependencies={restrictionsError:!0};this.loadingData=!1}})}).catch(i=>{this.loadingData=!1,this.deleteMsgError={type:"error",title:this.translate.instant("FW.MSG_FW_DELETE.DEL_0"),text:this.translate.instant("FW.MSG_FW_DELETE.ERROR_RES_TEXT",{error:this.fwcErrorPipe.transform(i)})},this.dependencies={restrictionsError:!0}}))}checkForm(e){e&&e.target&&e.target.type!="textarea"&&this.formModel.valid&&(e.target.blur(),this.onSave())}onSave(e=!1){return Z(this,null,function*(){if(!this.firewall)return;if(!e&&this.fwcInterfacesEditor&&!this.fwcInterfacesEditor.isThereAnySelectedNode()){this.confirmationService.confirm({header:this.translate.instant("IF_EDITOR.TREE.MSG_NO_SELECTED.TITLE"),icon:"fa fa-question-circle fwcBlue iconBig",message:this.translate.instant("IF_EDITOR.TREE.MSG_NO_SELECTED.TEXT",{obj_name:this.translate.instant("GLOBALS.MSG_OBJ_TYPES.FIREWALL").toLowerCase()}),accept:()=>{this.onSave(!0)},rejectVisible:!0,rejectLabel:"No",acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.YES")});return}this.loadingData=!0;let i,t,n=Object.assign({},this.firewall),o={};for(let p in this.formModel.controls)o[p]=n[p]=this.formModel.controls[p].value!==null&&this.formModel.controls[p].value!==void 0?this.formModel.controls[p].value:void 0;let r=this.fwcUserService.getActualFwcUser().publicKey;o.install_user&&(o.install_user=yield this.utilService.openPGPEncrypt(o.install_user,r)),o.install_pass&&(o.install_pass=yield this.utilService.openPGPEncrypt(o.install_pass,r)),this.firewall.id===null||this.firewall.id===void 0?(i=this.fwcFirewallService.newFirewall.bind(this.fwcFirewallService),t=this.translate.instant("FW.MSG_FW_CREATE")):(i=this.fwcFirewallService.updateFirewall.bind(this.fwcFirewallService),t=this.translate.instant("FW.MSG_FW_UPDATE",{name:n.name})),o.install_apikey?o.install_apikey=yield this.utilService.openPGPEncrypt(o.install_apikey,r):o.install_apikey=null,delete o.compiler,o.install_communication=="ssh"&&(o.install_apikey=""),o.install_communication=="agent"&&(o.install_user="",o.install_pass=""),this.utilService.fwcAPICall(i,o).then(p=>Z(this,null,function*(){let s;p.data&&p.data.insertId?s=p.data.insertId:s=this.firewall.id,o.firewall=s,n.container=it.C_FIREWALLS,n._fwcObjId=s,n._fwcObjType=v.OBJ_FIREWALL,n._fwcTreeAction=Ne.NEW_ITEM,this.itemSelectedService.setModifiedItem(n),this.loadingData=!1,this.itemSelectedService.getSelectedTreeNode().pipe(co(1)).subscribe(f=>{let h=()=>{if(this.itemSelectedService.setModifiedItem(n),n.id!==null&&n.id!==void 0||this.fwcInterfacesEditor&&this.fwcInterfacesEditor.operationsModified()){let E=this.fwcPolicyService.getActualSelectedPolicy();E._fwcFwId!==null&&E._fwcFwId!==void 0&&(E._fwcFwId==n.id&&(E._fwcFwName=n.name,E._dontLocateInTree=!0),this.fwcPolicyService.setSelectedPolicy(E),this.fwcPolicyService.reloadPolicy())}this.loadingData=!1,this.hideDialog(),this.resetProperties(),this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:t})};if(this.fwcInterfacesEditor&&this.fwcInterfacesEditor.areTherePendingOperations()){let E=this.fwcInterfacesEditor.getSelectedTreeNodes();if(p.data&&p.data.loData&&this.fwcInterfacesEditor.setNewLoIds(p.data),Array.isArray(f.items)){let b=f.items.find(I=>I.node_type===X.FOLDER_INTERFACES);if(b){let I={parentObject:{fwcloud:this.fwcUserService.getActualFwSelectedCloud(),name:f._fwcFwName,type:v.OBJ_FIREWALL,id:s,id_node:b.id},objectTreeNodes:E,onClose:V=>Z(this,null,function*(){let G,D,K=!1;if(V.forEach(B=>{B.operationStatus===Ti.SUCCESS&&B.operationResult&&B.object.installFirewallUUIDs&&B.object.installFirewallUUIDs.has(this.firewall.firewallUUID)&&(B.object.type===v.OBJ_INTERFACE_FIREWALL?G=B.operationResult.insertId:B.object.type===v.OBJ_ADDRESS&&(D=B.operationResult.insertId)),B.operationStatus===Ti.ERROR&&(K=!0)}),!K&&G&&D){o.install_interface=G,o.install_ipobj=D;try{let B=new En(o).getValue(),te=yield this.utilService.fwcAPICall(this.fwcFirewallService.updateFirewall.bind(this.fwcFirewallService),B)}catch(B){Wt.log("ERROR UPDATING: ",B)}}h()})},R={uuid:ee.ITEM_BATCH_MANAGER,data:I};this.appDialogPanelsService.searchAndShowDialog(R)}else h()}}else h()})})).catch(p=>{p.status==400&&p.error.fwcErr==8001?(this.confirmationService.confirm({header:this.translate.instant("GLOBALS.MSG_OP_RESULT.ERROR"),icon:"fa fa-exclamation-circle fwcRed iconBig",message:this.translate.instant("API_ERROR."+p.error.fwcErr),rejectVisible:!1,acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.OK"),accept:()=>{}}),this.loadingData=!1):(this.loadingData=!1,this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(p)}))})})}manageInterfacesAndIps(e){let i=this.itemSelectedService.getActualFwcTreeComponents();Array.isArray(i)&&i.forEach(t=>{})}onDeleteFirewall(){this.okToDelete&&this.firewallToDelete&&(this.loadingData=!0,this.deleteMsgError=null,this.delMessage={type:"loading",title:this.translate.instant("FW.MSG_FW_DELETE.DELETING_HEAD"),text:this.translate.instant("FW.MSG_FW_DELETE.DELETING_TEXT")},this.utilService.fwcAPICall(this.fwcFirewallService.deleteFirewall.bind(this.fwcFirewallService),this.firewallToDelete.id_obj,this.fwcUserService.getActualFwSelectedCloud()).then(e=>{let i=this.firewallToDelete,t={_fwcFwId:null,fwId:null},n=this.fwcPolicyService.getActualSelectedPolicy();this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("FW.MSG_FW_DELETE.DEL_4")}),i._fwcTreeAction=Ne.DELETE_ITEM,this.itemSelectedService.setModifiedItem(i),this.itemSelectedService.setModifiedItem({_fwcTreeAction:Ne.RELOAD_TREE,containerToReload:it.C_OBJECTS}),n&&n._fwcFwId==this.firewallToDelete.id_obj&&this.fwcPolicyService.setSelectedPolicy(t),this.loadingData=!1,this.hideDialog(),this.resetProperties()}).catch(e=>{this.deleteMsgError={type:"error",title:this.translate.instant("FW.MSG_FW_DELETE.ERROR_RES_HEAD"),text:this.translate.instant("FW.MSG_FW_DELETE.ERROR_RES_TEXT",{error:this.fwcErrorPipe.transform(e)})},this.fwcUserService.setConfirmationToken(void 0),this.loadingData=!1}))}onDiscoverInterfaces(e=!0){Array.isArray(this.interfacesIpObjs)&&(!e&&this.interfacesEditorOptions&&this.fwcInterfacesEditor.operationsModified()?this.confirmationService.confirm({header:this.translate.instant("FW.MSG_FW_EDITION.CONFIRM_DISCOVER_HEADER"),icon:"fa fa-question-circle fwcBlue iconBig",message:this.translate.instant("FW.MSG_FW_EDITION.CONFIRM_DISCOVER_TEXT"),accept:()=>{this.doShowDiscoverDialog()},rejectVisible:!0,rejectLabel:"No",acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.YES")}):this.doShowDiscoverDialog())}onTestFwcAgentCommunication(){return Z(this,null,function*(){let e=this.formModel.get("install_ipobj").value;if(e){this.loadingData=!0,this.loadingCommunication=!0;let i=this.formModel.value,t=this.interfacesIpObjs.find(n=>n.id===e);if(t){let n="Error",o="fa fa-exclamation-circle fwcRed iconBig",r=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:this.translate.instant("GLOBALS.ERRORS.COMMUNICATION")}),p=this.fwcUserService.getActualFwcUser().publicKey,s={communication:i.install_communication,host:t.address,port:i.install_port};if(i.install_communication==="ssh"){let f=i.install_user,h=i.install_pass;f&&(f=yield this.utilService.openPGPEncrypt(f,p)),h&&(h=yield this.utilService.openPGPEncrypt(h,p)),s.username=f,s.password=h}else{let f=i.install_apikey;f&&(f=yield this.utilService.openPGPEncrypt(f,p)),s.protocol=i.install_protocol,s.apikey=f}this.communicationSubscription=this.utilService.fwcAPICallObservable(this.fwcFirewallService.checkFwCommunication.bind(this.fwcFirewallService),this.fwcUserService.getActualFwSelectedCloud(),s).subscribe({next:()=>{n=this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),o="fa fa-check-circle fwcGreen iconBig",r=this.translate.instant("FW.MSG_FW_EDITION.PING_AGENT_OK"),this.confirmationService.confirm({header:n,icon:o,acceptLabel:"Ok",rejectVisible:!1,message:r}),this.loadingData=!1,this.loadingCommunication=!1},error:f=>Z(this,null,function*(){let h;h=this.utilService.isCommunicationError(f.error),h&&(r=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:h})),this.confirmationService.confirm({header:n,icon:o,acceptLabel:"Ok",rejectVisible:!1,message:r}),this.loadingData=!1,this.loadingCommunication=!1})})}}})}onTestFwcAgentCommunicationDiscoverInterfaces(){return Z(this,null,function*(){if(this.discoveredInstallOptions.ipobj){this.loadingData=!0;let e="Error",i="fa fa-exclamation-circle fwcRed iconBig",t=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:this.translate.instant("GLOBALS.ERRORS.COMMUNICATION")}),n=this.fwcUserService.getActualFwcUser().publicKey,o={communication:this.formModel.value.install_communication,host:this.discoveredInstallOptions.ipobj.address,port:this.install_port_agent},r=this.formModel.value.install_apikey;r&&(r=yield this.utilService.openPGPEncrypt(r,n)),o.protocol=this.formModel.value.install_protocol,o.apikey=r,this.utilService.fwcAPICall(this.fwcFirewallService.checkFwCommunication.bind(this.fwcFirewallService),this.fwcUserService.getActualFwSelectedCloud(),o).then(p=>{e=this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),i="fa fa-check-circle fwcGreen iconBig",t=this.translate.instant("FW.MSG_FW_EDITION.PING_AGENT_OK")}).catch(p=>{if(p.error){let s;s=this.utilService.isCommunicationError(p.error),s&&(t=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:s}))}}).finally(()=>{this.confirmationService.confirm({header:e,icon:i,acceptLabel:"Ok",rejectVisible:!1,message:t}),this.loadingData=!1})}})}doShowDiscoverDialog(e){let i=this.formModel.get("install_ipobj").value,t="",n=this.formModel.get("install_communication").value||"ssh";if(i){let r=this.interfacesIpObjs.find(p=>p.id===i);r&&(t=r.address)}else this.discoveredInstallOptions&&(t=this.discoveredInstallOptions.ipobj.address);let o={header:this.firewall.name?this.translate.instant("COMPILE.INST_SSH",{name:this.firewall.name}):this.translate.instant("COMPILE.INST_SSH_GEN"),helpText:this.translate.instant("IF_EDITOR.TREE.INST_SSH_TEXT"),modal:!0,formControls:[{name:"install_communication",type:"hidden",value:n},{name:"address",label:this.translate.instant("ITEM_PANEL.FIELDS.ADDRESS"),regexp:ye.ipV4Regexp,type:"text",required:!0,value:e?e.address:t,setFocus:!0},{name:"",label:"",type:"separator"},{name:"install_port",label:this.translate.instant("CLUSTER.MSG_CLUSTER_EDITION.PORT"),regexp:ye.portRegexp,type:"number",required:!0,value:e?e.install_port:this.formModel.get("install_port").value},{name:"",label:"",type:"separator"}],onAccept:this.doDiscoverInterfaces.bind(this)};n==="ssh"?o.formControls.push({name:"install_user",label:this.translate.instant("CLUSTER.MSG_CLUSTER_EDITION.SSH_USER"),type:"text",required:!0,value:e?e.install_user:this.formModel.get("install_user").value},{name:"",label:"",type:"separator"},{name:"install_pass",label:this.translate.instant("CLUSTER.MSG_CLUSTER_EDITION.SSH_PASS"),type:"password",required:!0,value:e?e.install_pass:this.formModel.get("install_pass").value}):o.formControls.push({name:"install_protocol",label:this.translate.instant("FW.MSG_FW_EDITION.AGENT_PROTOCOL"),type:"select",required:!0,value:e?e.install_protocol:this.formModel.get("install_protocol").value,options:[{id:"https",text:"HTTPS"},{id:"http",text:"HTTP"}]},{name:"",label:"",type:"separator"},{name:"install_apikey",label:this.translate.instant("FW.MSG_FW_EDITION.AGENT_APIKEY"),type:"password",required:!0,value:e?e.install_apikey:this.formModel.get("install_apikey").value}),this.inputDataService.setInputData(o)}doDiscoverInterfaces(e){return Z(this,null,function*(){if(e){let i=this.fwcUserService.getActualFwcUser().publicKey,t={fwcloud:this.fwcUserService.getActualFwSelectedCloud(),ip:e.address,port:+e.install_port,communication:e.install_communication};if(e.install_communication==="ssh"){let n=e.install_user,o=e.install_pass;n&&(n=yield this.utilService.openPGPEncrypt(n,i)),o&&(o=yield this.utilService.openPGPEncrypt(o,i)),t.sshuser=n,t.sshpass=o,this.formModel.get("install_user").value!==e.install_user&&(this.formModel.get("install_user").setValue(e.install_user),this.formModel.markAsDirty())}else{let n=e.install_apikey;n&&(n=yield this.utilService.openPGPEncrypt(n,i)),t.apikey=n,t.protocol=e.install_protocol,this.formModel.get("install_protocol").value!==e.install_protocol&&(this.formModel.get("install_protocol").setValue(e.install_protocol),this.formModel.markAsDirty()),this.formModel.get("install_apikey").value!==e.install_apikey&&(this.formModel.get("install_apikey").setValue(e.install_apikey),this.formModel.markAsDirty())}this.loadingData=!0,this.loadingCommunication=!0,this.communicationSubscription=this.utilService.fwcAPICallObservable(this.fwcFirewallService.autoDiscoverInterfaces.bind(this.fwcFirewallService),t).subscribe({next:n=>{if(Array.isArray(n.data)){let o=n.data,r=this.getInterfaceAndAddressByUUID(this.firewall.installInterfaceUUID,this.firewall.installIpObjUUID);this.interfacesEditorOptions={isCluster:!1,firewalls:[{firewallUUID:this.firewall.firewallUUID,firewall_name:this.firewall.name,firewall:this.firewall.id,cluster:null,installOptions:{firewallUUID:this.firewall.firewallUUID,interface:r.interfaceInfo,ipobj:r.ipObjInfo}}],discoveredFirewallUUID:this.firewall.firewallUUID,discoveredAddress:e.address,discoveredIfs:o,existingIfs:this.interfaces},this.install_port_agent=e.install_port,this.formModel.markAsDirty(),this.shownPanel=1,this.recenterDialog()}this.loadingData=!1,this.loadingCommunication=!1},error:n=>Z(this,null,function*(){if(n.error.fwcErr==9e3)this.confirmationService.confirm({header:this.translate.instant("GLOBALS.MSG_OP_RESULT.ERROR"),icon:"fa fa-exclamation-circle fwcRed iconBig",message:this.translate.instant("API_ERROR.SSH_FORBIDDEN"),rejectVisible:!1,acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.OK")});else{let o;n&&(o=this.utilService.isCommunicationError(n.error)),this.confirmationService.confirm({header:"Error",icon:"fa fa-exclamation-circle fwcRed iconBig",acceptLabel:"Ok",rejectVisible:!1,message:this.translate.instant("FW.MSG_FW_EDITION.ERROR_DISCOVER")+(o?":<br/>"+o:""),accept:()=>{if(o)return this.doShowDiscoverDialog(e)}})}this.loadingData=!1,this.loadingCommunication=!1})})}})}showFirewallInfo(){return Z(this,null,function*(){this.loadingData=!0,this.loadingCommunication=!0;let e=this.formModel.get("install_ipobj").value;if(e){let i=this.formModel.value,t=this.interfacesIpObjs.find(n=>n.id===e);if(t){let n=this.fwcUserService.getActualFwcUser().publicKey,o={communication:i.install_communication,host:t.address,port:i.install_port};if(i.install_communication!=="ssh"){let r=i.install_apikey;r&&(r=yield this.utilService.openPGPEncrypt(r,n)),o.protocol=i.install_protocol,o.apikey=r}this.communicationSubscription=this.utilService.fwcAPICallObservable(this.fwcFirewallService.getFirewallInformation.bind(this.fwcFirewallService),this.fwcUserService.getActualFwSelectedCloud(),o).subscribe({next:r=>{let p=this.utilService.createDynamicComponentRef(bn),s=p.instance;s.setDynamicComponentRef(p),s.showFirewallPanel(r.data.data.fwc_agent_version,r.data.data.host_name,r.data.data.system_name,r.data.data.os_version,r.data.data.os_version,r.data.data.kernel_version),this.loadingData=!1,this.loadingCommunication=!1},error:r=>Z(this,null,function*(){let p=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:this.translate.instant("GLOBALS.ERRORS.COMMUNICATION")}),s;s=this.utilService.isCommunicationError(r.error),s&&(p=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:s})),this.confirmationService.confirm({header:"Error",icon:"fa fa-exclamation-circle fwcRed iconBig",acceptLabel:"Ok",rejectVisible:!1,message:p}),this.loadingData=!1,this.loadingCommunication=!1})})}}})}getInterfaceAndAddressByUUID(e,i){let t,n;return Array.isArray(this.interfaces)&&this.interfaces.forEach(o=>{o.interfaceUUID&&o.interfaceUUID===e&&(t=o),Array.isArray(o.ipobjs)&&o.ipobjs.forEach(r=>{r.ipObjUUID&&r.ipObjUUID===i&&(n=r)})}),!t&&this.discoveredInstallOptions&&this.discoveredInstallOptions.interface.interfaceUUID===e&&(t=this.discoveredInstallOptions.interface),!n&&this.discoveredInstallOptions&&this.discoveredInstallOptions.ipobj.ipObjUUID===i&&(n=this.discoveredInstallOptions.ipobj),{interfaceInfo:t,ipObjInfo:n}}onChangeInstallData(e){let i=this.formModel.get("install_interface").value,t=this.formModel.get("install_ipobj").value,n=null;i&&Array.isArray(this.interfaces)&&(n=this.interfaces.find(p=>p.id===i),this.firewall.installInterfaceUUID=n?n.interfaceUUID:void 0);let o=null;t&&n&&Array.isArray(n.ipobjs)&&(o=n.ipobjs.find(p=>p.id===t),this.firewall.installIpObjUUID=o?o.ipObjUUID:void 0);let r={firewallUUID:this.firewall.firewallUUID,interface:n,ipobj:o};this.refreshDialog(),this.fwcInterfacesEditor.updateInstallOptions(r)}onEditorInstallModified(e){if(e)if(!e.interface&&!e.ipobj)this.formModel.get("install_interface").setValue(null),this.formModel.get("install_ipobj").setValue(null),this.firewall.installInterfaceUUID=null,this.firewall.installIpObjUUID=null,this.discoveredInstallOptions=null;else{let i=e.interface.id,t=e.ipobj.id;this.formModel.get("install_interface").setValue(i),this.formModel.get("install_ipobj").setValue(t),this.firewall.installInterfaceUUID=e.interface.interfaceUUID,this.firewall.installIpObjUUID=e.ipobj.ipObjUUID,i&&t?this.discoveredInstallOptions=null:this.discoveredInstallOptions={interface:e.interface,ipobj:e.ipobj}}this.formModel.markAsDirty()}onEditorInterfaceOrIpModified(e){if(e&&Object.keys(e).length){if(e.id&&Array.isArray(this.interfaces)){let i=!1;for(let t=0;t<this.interfaces.length&&!i;t++){let n=this.interfaces[t];if(e.id===n.id&&e.type===n.type&&(n.name=e.name,i=!0),Array.isArray(n.ipobjs))for(let o=0;o<n.ipobjs.length&&!i;o++){let r=n.ipobjs[o];e.id===r.id&&e.type===r.type&&(r.name=e.name,r.address=e.address,i=!0)}}}else this.discoveredInstallOptions&&(e.type===v.OBJ_INTERFACE_FIREWALL?this.discoveredInstallOptions.interface&&(this.discoveredInstallOptions.interface.name=e.name):this.discoveredInstallOptions.ipobj&&(this.discoveredInstallOptions.ipobj.name=e.name,this.discoveredInstallOptions.ipobj.address=e.address));this.formModel.markAsDirty()}}handleFirewallManagementChange(e){e&&e.target&&(e.target.value==="agent"?(this.formModel.get("install_protocol").setValidators([Q.required]),this.formModel.get("install_apikey").setValidators([Q.required]),this.formModel.get("install_port").setValue(33033)):(this.formModel.get("install_protocol").clearValidators(),this.formModel.get("install_apikey").clearValidators(),this.formModel.get("install_port").setValue(22)),this.formModel.get("install_protocol").updateValueAndValidity(),this.formModel.get("install_apikey").updateValueAndValidity())}setOptionsPlugins(){this.firewall&&Object.values(Je).forEach(e=>{this.optionsPlugins[e]=!!(this.firewall.plugins&Ye.get(e))})}onChangePluginsDevelop(){let e=[];for(let t of Object.values(Je)){let n=Ye.get(t);e[n]=this.optionsPlugins[t]?"1":"0"}this.formModel.controls.plugins.setValue(parseInt(e.reduce((t,n)=>n+t,""),2));let i;Object.values(Je).forEach(t=>{(this.formModel.controls.plugins.value&2**Ye.get(t))!==(this.firewall.plugins&2**Ye.get(t))&&(i=t)}),this.confirmationService.confirm({header:this.translate.instant("FW.PLUGINS.HEADER"),icon:"fa fa-exclamation-circle fwcRed iconBig",acceptLabel:"Ok",rejectVisible:!1,message:this.translate.instant("FW.PLUGINS.NOT_IMPLEMENTED"),reject:()=>{this.setOptionsPlugins()},accept:()=>{this.setOptionsPlugins()}})}onChangePlugins(){let e=[],i="",t;if(this.firewall.id?(t=this.firewall.plugins,!this.firewall.install_communication&&!this.formModel.value.install_communication?i=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:this.translate.instant("API_ERROR.client-tiemeout")}):!this.firewall.install_apikey&&!this.formModel.value.install_apikey?i=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:this.translate.instant("API_ERROR.ApiKeyNotFound")}):!this.firewall.ip&&!this.formModel.value.install_ipobj?i=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:this.translate.instant("API_ERROR.ETIMEDOUT")}):!this.firewall.install_port&&!this.formModel.value.install_ipobj?i=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:this.translate.instant("API_ERROR.ECONNRESET")}):!this.firewall.install_protocol&&!this.formModel.value.install_protocol&&(i=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:this.translate.instant("API_ERROR.EPROTO")}))):(t=this.formModel.controls.plugins.value,this.formModel.value.install_communication?this.formModel.value.install_apikey?this.discoveredInstallOptions?this.formModel.value.install_protocol||(i=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:this.translate.instant("API_ERROR.EPROTO")})):i=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT_IP_PORT"):i=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:this.translate.instant("API_ERROR.ApiKeyNotFound")}):i=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:this.translate.instant("API_ERROR.client-tiemeout")})),i!=""){this.confirmationService.confirm({header:"Error",icon:"fa fa-exclamation-circle fwcRed iconBig",acceptLabel:"Ok",rejectVisible:!1,message:i,reject:()=>{this.setOptionsPlugins()},accept:()=>{this.setOptionsPlugins()}});return}for(let r of Object.values(Je)){let p=Ye.get(r);e[p]=this.optionsPlugins[r]?"1":"0"}this.formModel.controls.plugins.setValue(parseInt(e.reduce((r,p)=>p+r,""),2));let n,o;Object.values(Je).forEach(r=>Z(this,null,function*(){if((this.formModel.controls.plugins.value&Ye.get(r))!==(this.firewall.plugins&Ye.get(r))){r==Je.iscbind9?n="isc-bind9":r==Je.iscdhcp?n="isc-dhcp":n=r,o=this.optionsPlugins[r];let p;this.formModel.controls.plugins.value&Ye.get(r)?p=this.translate.instant("FW.PLUGINS.ENABLE",{plugin:this.translate.instant("FW.PLUGINS."+r.toUpperCase())}):p=this.translate.instant("FW.PLUGINS.DISABLE",{plugin:this.translate.instant("FW.PLUGINS."+r.toUpperCase())}),this.confirmationService.confirm({header:this.translate.instant("FW.PLUGINS.HEADER"),message:p,reject:()=>{this.setOptionsPlugins()},accept:()=>Z(this,null,function*(){this.loadingData=!0;let s=this.firewall.install_user,f=this.firewall.install_pass,h=this.firewall.install_apikey;s&&(s.startsWith("-")||(s=yield this.utilService.openPGPEncrypt(s,this.fwcUserService.getActualFwcUser().publicKey))),f&&(f.startsWith("-")||(f=yield this.utilService.openPGPEncrypt(f,this.fwcUserService.getActualFwcUser().publicKey))),h?h.startsWith("-")||(h=yield this.utilService.openPGPEncrypt(h,this.fwcUserService.getActualFwcUser().publicKey)):h=null;let E,b,I,R,V,G;this.discoveredInstallOptions?(V=this.formModel.value.install_communication,b=this.discoveredInstallOptions.ipobj.address,I=this.install_port_agent,R=yield this.utilService.openPGPEncrypt(this.formModel.value.install_apikey,this.fwcUserService.getActualFwcUser().publicKey),E=this.formModel.value.install_protocol,G=!0):this.formModel.value.install_ipobj&&(V=this.formModel.value.install_communication,b=this.interfacesIpObjs.find(he=>he.id==this.formModel.value.install_ipobj).address,I=this.formModel.value.install_port,R=yield this.utilService.openPGPEncrypt(this.formModel.value.install_apikey,this.fwcUserService.getActualFwcUser().publicKey),E=this.formModel.value.install_protocol,G=!1);let D=Object.assign({},this.firewall),K={};for(let he in this.formModel.controls)K[he]=D[he]=this.formModel.controls[he].value!==null&&this.formModel.controls[he].value!==void 0?this.formModel.controls[he].value:void 0;let B=this.fwcUserService.getActualFwcUser().publicKey;s&&(K.install_user=s),f&&(K.install_pass=f),h?K.install_apikey=h:K.install_apikey&&(K.install_apikey.startsWith("-")||(K.install_apikey=yield this.utilService.openPGPEncrypt(K.install_apikey,this.fwcUserService.getActualFwcUser().publicKey))),delete K.compiler,K.plugins=this.formModel.controls.plugins.value,this.eventsSubscription=this.fwcEventService.getEvent().pipe($(()=>this.alive)).subscribe(he=>{he.type==Ri.EVENT_PLUGIN_PANEL_CLOSED&&(this.eventsSubscription.unsubscribe(),he.data?(this.setOptionsPlugins(),this.formModel.controls.plugins.setValue(t)):this.firewall.plugins=this.formModel.controls.plugins.value)});let te={firewall:K,plugin:n,enable:o,address:b,persisted:G};this.itemSelectedService.setFirewallToPluginOperation(te),this.loadingData=!1}),icon:"fa fa-question-circle fwcBlue iconBig",rejectVisible:!0,rejectLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.NO"),acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.YES")})}}))}checkSSHCommunicationConfig(){return Z(this,null,function*(){this.isSSHCommunicationDisabled=!(yield this.utilService.fwcAPICall(this.fwcFirewallService.loadBackEndConfig.bind(this.fwcFirewallService))).data.availablecommunications.includes("ssh")})}checksNtopNGConfig(){return this.interfacesIpObjs.find(e=>e.id==this.formModel.value.install_ipobj)?!!(this.firewall.plugins&Ye.get(Je.ntopng)):this.discoveredInstallOptions&&Array.from(this.discoveredInstallOptions.interface.installFirewallUUIDs).find(e=>e===this.firewall.firewallUUID)?!!(this.firewall.plugins&Ye.get(Je.ntopng)):!1}checksWebSafetyProxyActie(){return this.interfacesIpObjs.find(e=>e.id==this.formModel.value.install_ipobj)?!!(this.firewall.plugins&Ye.get(Je.websafety)):this.discoveredInstallOptions&&Array.from(this.discoveredInstallOptions.interface.installFirewallUUIDs).find(e=>e===this.firewall.firewallUUID)?!!(this.firewall.plugins&Ye.get(Je.websafety)):!1}checksDNSSafetyActive(){return this.interfacesIpObjs.find(e=>e.id==this.formModel.value.install_ipobj)?!!(this.firewall.plugins&Ye.get(Je.dnssafety)):this.discoveredInstallOptions&&Array.from(this.discoveredInstallOptions.interface.installFirewallUUIDs).find(e=>e===this.firewall.firewallUUID)?!!(this.firewall.plugins&Ye.get(Je.dnssafety)):!1}checksElasticSearchActive(){return this.interfacesIpObjs.find(e=>e.id==this.formModel.value.install_ipobj)?!!(this.firewall.plugins&Ye.get(Je.elasticsearch)):this.discoveredInstallOptions&&Array.from(this.discoveredInstallOptions.interface.installFirewallUUIDs).find(e=>e===this.firewall.firewallUUID)?!!(this.firewall.plugins&Ye.get(Je.elasticsearch)):!1}onClickButtonNGFW(e){let i,t=this.interfacesIpObjs.length!==0?this.interfacesIpObjs.find(n=>n.id==this.formModel.value.install_ipobj).address:this.discoveredInstallOptions.ipobj.address;switch(e){case"NTOPNG":i="http://"+t+":3000";break;case"WEBSAFETYPROXY":i="https://"+t+":8095";break;case"DNSSAFETY":i="https://"+t+":8096";break;case"ELASTICSEARCH":i="http://"+t+":5601";break}try{window.open(i)}catch(n){this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(n)})}}onShowDialog(e){this.itemSelectedService.getActualItem().ngfw==!0?this.shownPanel=4:this.itemSelectedService.getActualItem().plugins===!0?this.shownPanel=3:this.shownPanel=0,this.recenterDialog();let i=this.itemSelectedService.getActualItem();delete i.ngfw,delete i.plugins,this.itemSelectedService.setItem(i),setTimeout(()=>{this.inputFirewallName&&this.inputFirewallName.nativeElement.focus()},150)}onChangeTab(e){this.shownPanel=e.index}onHideDialog(e){}onCloseDialog(){this.communicationSubscription&&(this.communicationSubscription.unsubscribe(),this.communicationSubscription=null,this.loadingData=!1,this.loadingCommunication=!1)}static{this.\u0275fac=function(i){return new(i||l)(F(se),F(De),F(oe),F(We),F(Ie),F(gt),F(de),F(Xt),F(we),F(At),F(_e),F(ce),F(ue),F(Ct),F(ie),F(pe),F(Ft))}}static{this.\u0275cmp=Le({type:l,selectors:[["sts-fwc-firewall-panel"]],viewQuery:function(i,t){if(i&1&&(Se(zs,5),Se(qs,5)),i&2){let n;le(n=re())&&(t.inputFirewallName=n.first),le(n=re())&&(t.fwcInterfacesEditor=n.first)}},features:[$e([oe,We]),Rt],decls:6,vars:8,consts:[["firewallDialog",""],["inputFirewallName",""],["ifSelect",""],["fwcInterfacesEditor",""],["divPass",""],["styleClass","dlgFwcDialog",3,"visibleChange","onShow","onHide","visible","modal","closable"],["pTemplate","header"],[1,"fwcFirewallPanel",3,"formGroup"],["pTemplate","footer"],[1,"divFormHeader"],[1,"divHeaderButtons"],["pButton","","type","button","icon","fa fa-question",1,"p-button-primary",3,"disabled"],["pButton","","type","button","icon","fa fa-window-minimize",1,"p-button-secondary",3,"click","disabled"],[1,"fwcWhite","fwcIconLeft"],[1,"fwcMenuIcon","fwci-firewall","fwcOrange"],[1,"fwcMenuIcon","fwci-delete","fwcOrange"],["pButton","","type","button","icon","fa fa-question",1,"p-button-primary",3,"click","disabled"],[1,"fwcFirewallPanel",3,"keyup.enter","keyup.esc","formGroup"],[3,"disabled"],[3,"onChange","activeIndex"],["leftIcon","fwci-editfirewall",3,"header","disabled"],[1,"grid"],[1,"col-12","noVertPad"],[1,"noVertPad","fwcBlue","botBorder"],[1,"col-6"],[1,"p-inputgroup"],["for","name"],["type","text","maxlength","64","pInputText","","formControlName","name","name","name",3,"placeholder"],[1,"fwc-error",3,"ngStyle"],[1,"col-3"],["for","compiler"],["formControlName","compiler","name","compiler",3,"change"],[3,"ngValue"],["for","install_communication"],["formControlName","install_communication","name","install_communication",3,"change"],["disabled","",3,"value"],["value","ssh",3,"disabled"],["value","agent"],[1,"col-2"],["for","comment"],[1,"col-10"],["maxlength","255","pInputTextarea","","formControlName","comment","name","comment",3,"rows","cols"],[1,"noVertPad","fwcBlue"],["ngClass","col-3"],["type","button","pButton","","icon","fa fa-search-plus",1,"p-button-primary",2,"height","2.44rem","width","100%",3,"click","disabled","label"],[1,"fwcBlue"],["leftIcon","fwci-interfaces",3,"header","disabled"],[3,"onInstallModified","onIpObjectModified","onStartAutodiscover","options"],["leftIcon","fwci-config",3,"header","disabled"],["type","hidden","formControlName","options","name","options"],[1,"col-12"],[3,"ngModelChange","onChange","binary","ngModel","ngModelOptions","label"],[3,"ngModelChange","onChange","binary","ngModel","ngModelOptions"],["href","https://www.docker.com","target","_blank"],["height","20","width","20","src","assets/img/docker.png"],["target","_blank",2,"margin-left","8px","margin-top","2px",3,"href"],["href","https://crowdsec.net/","target","_blank"],["width","20","height","20","src","assets/img/crowdsec.png"],["href","https://www.fail2ban.org","target","_blank"],["width","20","height","20","src","assets/img/fail2ban.png"],["leftIcon","fa fa-puzzle-piece fwcOrange",3,"header","disabled"],["type","hidden","formControlName","plugins","name","plugins"],["leftIcon","fa fa-n fwcOrange",3,"header","disabled"],[1,"col-4"],["for","install_protocol"],["formControlName","install_protocol","name","install_protocol",1,"selNoMargin",3,"change"],["value","https"],["value","http"],[1,"col-5"],["for","install_apikey"],["pPassword","","formControlName","install_apikey","name","install_apikey","maxlength","64",3,"showPassword","placeholder","feedback"],["pButton","","type","button","icon","fa fa-eye",1,"p-button-secondary","fwcButtonHeight",3,"mousedown","mouseup","mouseout"],["for","install_user"],["type","text","pInputText","","maxlength","32","formControlName","install_user","name","install_user",3,"placeholder"],[1,"fwc-error"],["for","install_pass"],["pPassword","","formControlName","install_pass","name","install_pass","maxlength","64",3,"showPassword","placeholder","promptLabel","weakLabel","mediumLabel","strongLabel"],["pButton","","type","button","icon","fa fa-eye",1,"p-button-secondary",3,"mousedown","mouseup","mouseout"],[1,"fa","fa-lg","fa-info-circle","fwcBlue",3,"pTooltip"],["type","text","pInputText","","readonly","",3,"value"],["for","install_port"],["type","text","pInputText","","readonly","",3,"placeholder","value"],["type","button","pButton","","tooltipPosition","top","showDelay","500","icon","fa fa-plug",1,"p-button-primary",2,"display","inline-flex","height","2.44rem","width","50%",3,"click","disabled","pTooltip","label"],["type","button","pButton","","tooltipPosition","top","showDelay","500","icon","fa fa-info-circle",1,"p-button-primary",2,"display","inline-flex","height","2.44rem","width","50%",3,"click","disabled","pTooltip","label"],["for","install_interface"],["formControlName","install_interface","name","install_interface",3,"change"],["for","install_ipobj"],["formControlName","install_ipobj","name","install_ipobj",3,"change"],["type","number","pInputText","","min","1","placeholder","Port","formControlName","install_port","name","install_port"],[1,"col-2",2,"align-content","center","padding","0"],[2,"display","flex"],[2,"display","block","margin-top","-7px"],["type","button","pButton","","tooltipPosition","top","showDelay","500","icon","fa fa-plug",1,"p-button-primary",2,"display","inline-flex","width","100%","height","2.44rem","text-align","center","align-items","center",3,"click","disabled","pTooltip","label"],["type","button","pButton","","tooltipPosition","top","showDelay","500","icon","fa fa-info-circle",1,"p-button-primary",2,"display","inline-flex","width","100%","height","2.44rem","text-align","center","align-items","center",3,"click","disabled","pTooltip","label"],[3,"message"],["href","https://www.openvpn.net/","target","_blank"],["width","20","height","20","src","assets/img/openvpn.png"],["href","https://github.com/acassen/keepalived","target","_blank"],["width","20","height","20","src","assets/img/keepalived.png"],["href","https://ipgeolocation.io/","target","_blank"],["width","20","height","20","src","assets/img/geoip.png"],["href","https://www.ntop.org/","target","_blank"],["width","20","height","20","src","assets/img/ntopng.png"],["href","https://www.diladele.com/","target","_blank"],["width","20","height","20","src","assets/img/websafety.png"],["href","https://dnssafety.diladele.com/","target","_blank"],["width","20","height","20","src","assets/img/dnssafety.png"],["href","https://www.isc.org/bind/","target","_blank"],["width","20","height","20","src","assets/img/isc-bind9.png"],["href","https://suricata.io/","target","_blank"],["width","20","height","20","src","assets/img/suricata.png"],["href","https://zeek.org/","target","_blank"],["width","20","height","20","src","assets/img/zeek.png"],["href","https://www.elastic.co/what-is/elasticsearch","target","_blank"],["width","20","height","20","src","assets/img/elasticsearch.png"],["href","https://www.elastic.co/what-is/kibana","target","_blank"],["width","20","height","20","src","assets/img/kibana.png"],["href","https://www.elastic.co/logstash/","target","_blank"],["width","20","height","20","src","assets/img/logstash.png"],["href","https://www.elastic.co/beats/filebeat","target","_blank"],["width","20","height","20","src","assets/img/filebeat.png"],["href","https://www.isc.org/dhcp/","target","_blank"],["width","20","height","20","src","assets/img/isc-dhcp.png"],["href","https://www.haproxy.org/","target","_blank"],["width","20","height","20","src","assets/img/ha-proxy.png"],["for","NTOPNG_BUTTON"],["width","40","height","40","src","assets/img/ntopng.png"],["type","button","pButton","","tooltipPosition","top","showDelay","500",1,"p-button-primary",2,"height","2.44rem","width","100%",3,"click","disabled","pTooltip","label"],["for","WEBSAFETYPROXY_BUTTON"],["width","40","height","40","src","assets/img/websafety.png"],["for","DNSSAFETY_BUTTON"],["width","40","height","40","src","assets/img/dnssafety.png"],["for","ELASTICSEARCH_BUTTON"],["width","40","height","40","src","assets/img/elasticsearch.png"],[1,"col-12","divCentered"],[1,"fwcRestrictionsContainer"],[3,"onHideParent","onRefreshRestrictions","dependencies"],["name","chkOkToDelete","binary","true",3,"ngModelChange","ngModel","label"],[1,"divLoadTemp",3,"ngStyle"],["type","button","pButton","","icon","fa fa-xmark",1,"p-button-danger",3,"label"],["type","button","pButton","","icon","pi pi-trash",1,"p-button-danger",3,"disabled","label"],["type","button","pButton","","icon","fa fa-save",1,"p-button-success",3,"disabled","label"],["type","button","pButton","","icon","pi pi-check",1,"p-button-primary",3,"disabled","label"],["type","button","pButton","","icon","fa fa-xmark",1,"p-button-danger",3,"click","label"],["type","button","pButton","","icon","pi pi-trash",1,"p-button-danger",3,"click","disabled","label"],["type","button","pButton","","icon","fa fa-save",1,"p-button-success",3,"click","disabled","label"],["type","button","pButton","","icon","pi pi-check",1,"p-button-primary",3,"click","disabled","label"],["type","button","pButton","","icon","fa fa-refresh",1,"fwc-left-float","p-button-primary",3,"disabled","label"],["type","button","pButton","","icon","fa fa-trash",1,"p-button-danger",3,"click","disabled","label"],["type","button","pButton","","icon","fa fa-refresh",1,"fwc-left-float","p-button-primary",3,"click","disabled","label"]],template:function(i,t){if(i&1){let n=L();c(0,"p-dialog",5,0),J("visibleChange",function(r){return w(n),Y(t.displayDialog,r)||(t.displayDialog=r),S(r)}),P("onShow",function(r){return w(n),S(t.onShowDialog(r))})("onHide",function(r){return w(n),S(t.onHideDialog(r))}),A(2,ac,5,4,"ng-template",6)(3,Tc,135,123,"form",7)(4,Lc,3,2)(5,Vc,2,2,"ng-template",8),u()}i&2&&(ke(W(7,Qs)),H("visible",t.displayDialog),m("modal",!0)("closable",!1),a(3),O(t.firewall?3:-1),a(),O(t.firewallToDelete?4:-1))},dependencies:[et,Vt,Si,Ei,vi,Ht,Yt,yi,ht,wi,Jt,Ii,wt,gi,Ci,Ni,yn,Nt,Mt,Ue,lt,Lt,Qt,qt,Li,mn,Di,Mi,yt,nt],styles:[`p-tabview li a{height:100%;color:var(--fwcDark)!important}p-tabview li.p-highlight .p-tabview-nav-link{color:#dedede!important}.p-tabview-nav-content{font-size:.9rem!important}sts-fwc-firewall-panel>p-dialog>div>div>div.ng-tns-c1623988549-19.p-dialog-content.ng-star-inserted{min-width:100%!important}
`],encapsulation:2})}}return l})();var Hc=["inputClusterName"],Yc=["fwcInterfacesEditor"],Jc=["nodeInput"],Kc=()=>({width:"80vw"}),jl=l=>({visibility:l}),Pe=()=>({standalone:!0}),Xc=l=>({"background-color":l}),zc=()=>["col-12","lg:col-2"],qc=()=>["col-12","lg:col-3"],Qc=()=>["col-4","lg:col-2"],oo=()=>["col-4","lg:col-3"],Bl=()=>["col-6","lg:col-2"],Vl=(l,_)=>({type:"error",title:l,text:_}),$c=()=>({width:"1.7rem",height:"1.7rem"});function Zc(l,_){if(l&1&&(c(0,"div",9)(1,"h6",13),T(2,"i",14),g(3),C(4,"translate"),c(5,"strong"),g(6),u()()()),l&2){let e=d(3);a(3),x(" ",y(4,2,"CLUSTER.MSG_CLUSTER_EDITION.EDIT")," "),a(3),j(e.cluster==null?null:e.cluster.name)}}function ep(l,_){l&1&&(c(0,"div",9)(1,"h6",13),T(2,"i",14),g(3),C(4,"translate"),u()()),l&2&&(a(3),x(" ",y(4,1,"CLUSTER.MSG_CLUSTER_EDITION.NEW")," "))}function tp(l,_){if(l&1&&A(0,Zc,7,4,"div",9)(1,ep,5,3,"div",9),l&2){let e=d(2);O(e.cluster!=null&&e.cluster.id?0:1)}}function ip(l,_){if(l&1&&(c(0,"div",9)(1,"h6",13),T(2,"i",15),g(3),C(4,"translate"),c(5,"strong"),g(6),u()()()),l&2){let e=d(2);a(3),x(" ",y(4,2,"CLUSTER.MSG_CLUSTER_EDITION.DELETE")," "),a(3),j(e.clusterToDelete._fwcObjName)}}function np(l,_){if(l&1){let e=L();c(0,"button",16),P("click",function(){w(e);let t=d(2);return S(t.showHelp())}),u()}if(l&2){let e=d(2);m("disabled",e.loadingData)}}function op(l,_){if(l&1){let e=L();A(0,tp,2,1)(1,ip,7,4,"div",9),c(2,"div",10),A(3,np,1,1,"button",11),c(4,"button",12),P("click",function(){w(e);let t=d();return S(t.minimizeDialog())}),u()()}if(l&2){let e=d();O(e.cluster?0:-1),a(),O(e.clusterToDelete?1:-1),a(2),O(e.helpSection?3:-1),a(),m("disabled",e.loadingData)}}function lp(l,_){if(l&1&&(c(0,"option",30),g(1),u()),l&2){let e=_.$implicit;m("ngValue",e.id),a(),x(" ",e.name," ")}}function rp(l,_){l&1&&(c(0,"p",59),g(1),C(2,"translate"),u()),l&2&&(a(),x(" ",y(2,1,"ITEM_PANEL.ERRORS.FIELD_INVALID_NAME")," "))}function ap(l,_){if(l&1){let e=L();c(0,"div",66)(1,"div",56)(2,"select",67),P("change",function(){return w(e),S(!0)}),c(3,"option",68),g(4),C(5,"translate"),u(),c(6,"option",69),g(7,"HTTPS"),u(),c(8,"option",70),g(9,"HTTP"),u()()()(),c(10,"div",71)(11,"div",56),T(12,"input",72),C(13,"translate"),c(14,"button",73),P("mousedown",function(){w(e);let t=d().$index,n=d(2);return S(n.displayApiKey[t]=!0)})("mouseup",function(){w(e);let t=d().$index,n=d(2);return S(n.displayApiKey[t]=!1)})("mouseout",function(){w(e);let t=d().$index,n=d(2);return S(n.displayApiKey[t]=!1)}),u()()()}if(l&2){let e=d().$index,i=d(2);a(3),m("value",null),a(),x(" ",y(5,5,"FW.MSG_FW_EDITION.AGENT_PROTOCOL")," "),a(8),M("placeholder",y(13,7,"FW.MSG_FW_EDITION.AGENT_APIKEY")),m("showPassword",i.displayApiKey[e])("feedback",!1)}}function sp(l,_){l&1&&(c(0,"p",59),g(1),C(2,"translate"),u()),l&2&&(a(),x(" ",y(2,1,"ITEM_PANEL.ERRORS.FIELD_USERNAME")," "))}function cp(l,_){if(l&1){let e=L();c(0,"div",74),T(1,"input",75),C(2,"translate"),A(3,sp,3,3,"p",59),u(),c(4,"div",55)(5,"div",56),T(6,"input",76),C(7,"translate"),C(8,"translate"),C(9,"translate"),C(10,"translate"),C(11,"translate"),c(12,"button",73),P("mousedown",function(){w(e);let t=d().$index,n=d(2);return S(n.displaySSH[t]=!0)})("mouseup",function(){w(e);let t=d().$index,n=d(2);return S(n.displaySSH[t]=!1)})("mouseout",function(){w(e);let t=d().$index,n=d(2);return S(n.displaySSH[t]=!1)}),u()()()}if(l&2){let e=d(),i=e.$implicit,t=e.$index,n=d(2);m("ngClass",n.interfaces!=null&&n.interfaces.length||n.discoveredInstallOptions.has(i.get("firewallUUID").value)?W(24,Bl):W(25,oo)),a(),_i("id","fwSSHUser",t,""),M("placeholder",y(2,12,"CLUSTER.MSG_CLUSTER_EDITION.SSH_USER")),a(2),O(!i.get("install_user").valid&&!i.get("install_user").pristine?3:-1),a(),m("ngClass",n.interfaces!=null&&n.interfaces.length||n.discoveredInstallOptions.has(i.get("firewallUUID").value)?W(26,Bl):W(27,oo)),a(2),M("placeholder",y(7,14,"CLUSTER.MSG_CLUSTER_EDITION.SSH_PASS")),m("showPassword",n.displaySSH[t])("promptLabel",y(8,16,"GLOBALS.MSG_PASSWORD.PASS"))("weakLabel",y(9,18,"GLOBALS.MSG_PASSWORD.WEAK"))("mediumLabel",y(10,20,"GLOBALS.MSG_PASSWORD.NORMAL"))("strongLabel",y(11,22,"GLOBALS.MSG_PASSWORD.SAFE"))}}function pp(l,_){if(l&1&&(c(0,"div",77)(1,"div",56)(2,"label"),T(3,"i",78),C(4,"translate"),u(),T(5,"input",79),u()(),c(6,"div",77)(7,"div",56),T(8,"input",79),u()()),l&2){let e,i,t=d().$implicit,n=d(2);a(3),M("pTooltip",y(4,3,"FW.MSG_FW_EDITION.TOOLTIP_NEW_INSTALL")),a(2),M("value",(e=n.discoveredInstallOptions.get(t.get("firewallUUID").value).interface)==null?null:e.name),a(3),M("value",((i=n.discoveredInstallOptions.get(t.get("firewallUUID").value).ipobj)==null?null:i.address)+" ("+((i=n.discoveredInstallOptions.get(t.get("firewallUUID").value).ipobj)==null?null:i.name)+")")}}function dp(l,_){if(l&1&&(c(0,"option",82),g(1),u()),l&2){let e=_.$implicit;m("value",e.id),a(),fi(" ",e.id," - ",e.name," ")}}function _p(l,_){if(l&1){let e=L();c(0,"div",80)(1,"select",81),P("change",function(t){w(e);let n=d(2).$index,o=d(2);return S(o.onInterfaceChange(n,t.target.value))}),c(2,"option",68),g(3),C(4,"translate"),u(),Oe(5,dp,2,3,"option",82,Te),u()()}if(l&2){let e=d(4);a(2),m("value",null),a(),x(" ",y(4,2,"GLOBALS.MSG_OBJ_TYPES.OBJ_INTERFACE_FIREWALL")," "),a(2),Re(e.interfaces)}}function up(l,_){if(l&1&&(c(0,"span"),g(1),u()),l&2){let e=d().$implicit;a(),x("(",e.address,")")}}function fp(l,_){l&1&&(c(0,"span"),g(1),C(2,"translate"),u()),l&2&&(a(),x("(",y(2,1,"CLUSTER.MSG_CLUSTER_EDITION.NO_IP"),")"))}function mp(l,_){if(l&1&&(c(0,"option",82),g(1),A(2,up,2,1,"span")(3,fp,3,3,"span"),u()),l&2){let e=_.$implicit;m("value",e.id),a(),x(" ",e.name,"\xA0 "),a(),O(e.address?2:-1),a(),O(e.address?-1:3)}}function hp(l,_){if(l&1){let e=L();c(0,"div",80)(1,"select",83),P("change",function(){w(e);let t=d(2).$index,n=d(2);return S(n.onChangeInstallData(t))}),c(2,"option",68),g(3),C(4,"translate"),u(),Oe(5,mp,4,4,"option",82,Te),u()()}if(l&2){let e=d(2),i=e.$implicit,t=e.$index,n=d(2);a(),_i("name","fwIP",t,""),a(),m("value",null),a(),x(" ",y(4,4,"GLOBALS.MSG_OBJ_TYPES.OBJ_ADDRESS")," "),a(2),Re(n.interfacesIpObjs.get(i.get("firewallUUID").value))}}function wp(l,_){if(l&1&&A(0,_p,7,4,"div",80)(1,hp,7,6,"div",80),l&2){let e=d(3);O(e.interfaces.length?0:-1),a(),O(e.interfaces.length?1:-1)}}function Sp(l,_){l&1&&(T(0,"input",60),C(1,"translate")),l&2&&M("placeholder",y(1,1,"CLUSTER.MSG_CLUSTER_EDITION.PORT"))}function gp(l,_){if(l&1){let e=L();c(0,"button",84),C(1,"translate"),P("click",function(){w(e);let t=d().$implicit,n=d(2);return S(n.onTestFwcAgentCommunication(t))}),u()}if(l&2){let e=d().$implicit,i=d(2);M("pTooltip",y(1,2,"FW.MSG_FW_EDITION.AGENT_TEST_LONG")),m("disabled",i.loadingData||e.get("install_protocol").invalid||e.get("install_apikey").invalid||e.get("install_port").invalid||!i.NodeHaveDiscoveredIp(e))}}function Cp(l,_){if(l&1){let e=L();c(0,"button",85),C(1,"translate"),P("click",function(){w(e);let t=d().$implicit,n=d(2);return S(n.showClusterInfo(t))}),u()}if(l&2){let e=d().$implicit,i=d(2);M("pTooltip",y(1,2,"FW.FW_MORE_INFO.AGENT_TOOLTIP")),m("disabled",i.loadingData||e.get("install_protocol").invalid||e.get("install_apikey").invalid||e.get("install_port").invalid||!i.NodeHaveDiscoveredIp(e))}}function yp(l,_){if(l&1){let e=L();c(0,"button",86),C(1,"translate"),P("click",function(){w(e);let t=d().$index,n=d(2);return S(n.nodeRemove(t))}),u()}if(l&2){let e=d(3);M("pTooltip",y(1,2,"CLUSTER.MSG_CLUSTER_EDITION.TT_NODE_DELETE")),m("disabled",e.loadingData)}}function Ep(l,_){if(l&1){let e=L();c(0,"button",87),C(1,"translate"),P("click",function(){w(e);let t=d().$index,n=d(2);return S(n.nodeAdd(t))}),u()}if(l&2){let e=d(3);M("pTooltip",y(1,2,"CLUSTER.MSG_CLUSTER_EDITION.TT_NODE_ADD")),m("disabled",e.loadingData)}}function vp(l,_){if(l&1){let e=L();c(0,"div",37)(1,"div",55)(2,"div",56)(3,"button",57),C(4,"translate"),C(5,"translate"),P("click",function(){let t=w(e).$implicit,n=d(2);return S(n.onClusterNodeInstallCommChange(t))}),u(),c(6,"input",58,4),C(8,"translate"),P("change",function(){let t=w(e).$implicit,n=d(2);return S(n.onClusterNodeNameChange(t))}),u()(),A(9,rp,3,3,"p",59),u(),A(10,ap,15,9)(11,cp,13,28)(12,pp,9,5)(13,wp,2,2),c(14,"div",55)(15,"div",56),A(16,Sp,2,3,"input",60)(17,gp,2,4,"button",61)(18,Cp,2,4,"button",62)(19,yp,2,4,"button",63)(20,Ep,2,4,"button",64),c(21,"button",65),C(22,"translate"),P("click",function(){let t=w(e).$index,n=d(2);return S(n.nodeAutoDiscoverInterfaces(t))}),u()()()()}if(l&2){let e,i,t,n=_.$implicit,o=_.$index,r=d(2);m("ngStyle",ae(28,Xc,o?"":"aliceblue"))("formGroupName",o),a(),m("ngClass",r.interfaces!=null&&r.interfaces.length||r.discoveredInstallOptions.has(n.get("firewallUUID").value)?W(30,zc):W(31,qc)),a(2),m("icon",n.get("install_communication").value==="agent"?"fa fa-user-secret":"fa fa-terminal")("disabled",r.loadingData)("pTooltip",n.get("install_communication").value==="agent"?y(4,20,"CLUSTER.MSG_CLUSTER_EDITION.COMM_FWCAGENT"):y(5,22,"CLUSTER.MSG_CLUSTER_EDITION.COMM_SSH")),a(3),_i("id","fwName",o,""),M("placeholder",y(8,24,"CLUSTER.MSG_CLUSTER_EDITION.NODE_NAME")),a(3),O(!n.get("name").valid&&!n.get("name").pristine?9:-1),a(),O(n.get("install_communication").value==="agent"?10:11),a(2),O(r.discoveredInstallOptions.has(n.get("firewallUUID").value)?12:13),a(2),m("ngClass",r.interfaces!=null&&r.interfaces.length||r.discoveredInstallOptions.has(n.get("firewallUUID").value)?W(32,Qc):W(33,oo)),a(2),O(r.interfaces.length||n.get("install_port")?16:-1),a(),O(((e=n.get("install_communication"))==null?null:e.value)==="agent"?17:-1),a(),O(((i=n.get("install_communication"))==null?null:i.value)==="agent"?18:-1),a(),O((t=n.get("id"))!=null&&t.value&&r.getNumberOfExistingNodes()>1||!((t=n.get("id"))!=null&&t.value)&&r.getFormNodes().controls.length>1?19:-1),a(),O(o+1==r.getFormNodes().controls.length?20:-1),a(),M("pTooltip",y(22,26,"CLUSTER.MSG_CLUSTER_EDITION.TT_NODE_DISCOVER")),m("disabled",r.loadingData)}}function Ip(l,_){if(l&1&&(c(0,"div",20)(1,"div",21),T(2,"sts-fwc-message",88),u()()),l&2){let e=d(2);a(2),m("message",Ze(1,Vl,e.translate.instant("PLUGINS.TITLE"),e.translate.instant("PLUGINS.ERRORS.COMMUNICATION.TEXT")))}}function bp(l,_){if(l&1){let e=L();c(0,"div",20)(1,"div",42)(2,"h5",22),g(3),C(4,"translate"),u()(),c(5,"div",23)(6,"div",21)(7,"div",24)(8,"p-checkbox",44),J("ngModelChange",function(t){w(e);let n=d(2);return Y(n.optionsPlugins.openvpn,t)||(n.optionsPlugins.openvpn=t),S(t)}),P("onChange",function(){w(e);let t=d(2);return S(t.onChangePlugins())}),u(),g(9," \xA0\xA0 "),c(10,"a",89),T(11,"img",90),u(),c(12,"p",36),g(13),C(14,"translate"),u()()(),c(15,"div",21)(16,"div",24)(17,"p-checkbox",44),J("ngModelChange",function(t){w(e);let n=d(2);return Y(n.optionsPlugins.keepalived,t)||(n.optionsPlugins.keepalived=t),S(t)}),P("onChange",function(){w(e);let t=d(2);return S(t.onChangePlugins())}),u(),g(18," \xA0\xA0 "),c(19,"a",91),T(20,"img",92),u(),c(21,"p",36),g(22),C(23,"translate"),u()()(),c(24,"div",21)(25,"div",24)(26,"p-checkbox",44),J("ngModelChange",function(t){w(e);let n=d(2);return Y(n.optionsPlugins.geoip,t)||(n.optionsPlugins.geoip=t),S(t)}),P("onChange",function(){w(e);let t=d(2);return S(t.onChangePlugins())}),u(),g(27," \xA0\xA0 "),c(28,"a",93),T(29,"img",94),u(),c(30,"p",36),g(31),C(32,"translate"),u()()(),c(33,"div",21)(34,"div",24)(35,"p-checkbox",44),J("ngModelChange",function(t){w(e);let n=d(2);return Y(n.optionsPlugins.crowdsec,t)||(n.optionsPlugins.crowdsec=t),S(t)}),P("onChange",function(){w(e);let t=d(2);return S(t.onChangePlugins())}),u(),g(36," \xA0\xA0 "),c(37,"a",48),T(38,"img",49),u(),c(39,"p",36),g(40),C(41,"translate"),u()()(),c(42,"div",21)(43,"div",24)(44,"p-checkbox",44),J("ngModelChange",function(t){w(e);let n=d(2);return Y(n.optionsPlugins.ntopng,t)||(n.optionsPlugins.ntopng=t),S(t)}),P("onChange",function(){w(e);let t=d(2);return S(t.onChangePlugins())}),u(),g(45," \xA0\xA0 "),c(46,"a",95),T(47,"img",96),u(),c(48,"p",36),g(49),C(50,"translate"),u()()(),c(51,"div",21)(52,"div",24)(53,"p-checkbox",44),J("ngModelChange",function(t){w(e);let n=d(2);return Y(n.optionsPlugins.websafety,t)||(n.optionsPlugins.websafety=t),S(t)}),P("onChange",function(){w(e);let t=d(2);return S(t.onChangePlugins())}),u(),g(54," \xA0\xA0 "),c(55,"a",97),T(56,"img",98),u(),c(57,"p",36),g(58),C(59,"translate"),u()()(),c(60,"div",21)(61,"div",24)(62,"p-checkbox",44),J("ngModelChange",function(t){w(e);let n=d(2);return Y(n.optionsPlugins.dnssafety,t)||(n.optionsPlugins.dnssafety=t),S(t)}),P("onChange",function(){w(e);let t=d(2);return S(t.onChangePlugins())}),u(),g(63," \xA0\xA0 "),c(64,"a",99),T(65,"img",100),u(),c(66,"p",36),g(67),C(68,"translate"),u()()(),c(69,"div",21)(70,"div",24)(71,"p-checkbox",44),J("ngModelChange",function(t){w(e);let n=d(2);return Y(n.optionsPlugins.iscbind9,t)||(n.optionsPlugins.iscbind9=t),S(t)}),P("onChange",function(){w(e);let t=d(2);return S(t.onChangePlugins())}),u(),g(72," \xA0\xA0 "),c(73,"a",101),T(74,"img",102),u(),c(75,"p",36),g(76),C(77,"translate"),u()()()(),c(78,"div",23)(79,"div",21)(80,"div",24)(81,"p-checkbox",44),J("ngModelChange",function(t){w(e);let n=d(2);return Y(n.optionsPlugins.suricata,t)||(n.optionsPlugins.suricata=t),S(t)}),P("onChange",function(){w(e);let t=d(2);return S(t.onChangePlugins())}),u(),g(82," \xA0\xA0 "),c(83,"a",103),T(84,"img",104),u(),c(85,"p",36),g(86),C(87,"translate"),u()()(),c(88,"div",21)(89,"div",24)(90,"p-checkbox",44),J("ngModelChange",function(t){w(e);let n=d(2);return Y(n.optionsPlugins.zeek,t)||(n.optionsPlugins.zeek=t),S(t)}),P("onChange",function(){w(e);let t=d(2);return S(t.onChangePlugins())}),u(),g(91," \xA0\xA0 "),c(92,"a",105),T(93,"img",106),u(),c(94,"p",36),g(95),C(96,"translate"),u()()(),c(97,"div",21)(98,"div",24)(99,"p-checkbox",44),J("ngModelChange",function(t){w(e);let n=d(2);return Y(n.optionsPlugins.elasticsearch,t)||(n.optionsPlugins.elasticsearch=t),S(t)}),P("onChange",function(){w(e);let t=d(2);return S(t.onChangePlugins())}),u(),g(100," \xA0\xA0 "),c(101,"a",107),T(102,"img",108),u(),c(103,"p",36),g(104),C(105,"translate"),u()()(),c(106,"div",21)(107,"div",24)(108,"p-checkbox",44),J("ngModelChange",function(t){w(e);let n=d(2);return Y(n.optionsPlugins.kibana,t)||(n.optionsPlugins.kibana=t),S(t)}),P("onChange",function(){w(e);let t=d(2);return S(t.onChangePlugins())}),u(),g(109," \xA0\xA0 "),c(110,"a",109),T(111,"img",110),u(),c(112,"p",36),g(113),C(114,"translate"),u()()(),c(115,"div",21)(116,"div",24)(117,"p-checkbox",44),J("ngModelChange",function(t){w(e);let n=d(2);return Y(n.optionsPlugins.logstash,t)||(n.optionsPlugins.logstash=t),S(t)}),P("onChange",function(){w(e);let t=d(2);return S(t.onChangePlugins())}),u(),g(118," \xA0\xA0 "),c(119,"a",111),T(120,"img",112),u(),c(121,"p",36),g(122),C(123,"translate"),u()()(),c(124,"div",21)(125,"div",24)(126,"p-checkbox",44),J("ngModelChange",function(t){w(e);let n=d(2);return Y(n.optionsPlugins.filebeat,t)||(n.optionsPlugins.filebeat=t),S(t)}),P("onChange",function(){w(e);let t=d(2);return S(t.onChangePlugins())}),u(),g(127," \xA0\xA0 "),c(128,"a",113),T(129,"img",114),u(),c(130,"p",36),g(131),C(132,"translate"),u()()(),c(133,"div",21)(134,"div",24)(135,"p-checkbox",44),J("ngModelChange",function(t){w(e);let n=d(2);return Y(n.optionsPlugins.iscdhcp,t)||(n.optionsPlugins.iscdhcp=t),S(t)}),P("onChange",function(){w(e);let t=d(2);return S(t.onChangePlugins())}),u(),g(136," \xA0\xA0 "),c(137,"a",115),T(138,"img",116),u(),c(139,"p",36),g(140),C(141,"translate"),u()()(),c(142,"div",21)(143,"div",24)(144,"p-checkbox",44),J("ngModelChange",function(t){w(e);let n=d(2);return Y(n.optionsPlugins.haproxy,t)||(n.optionsPlugins.haproxy=t),S(t)}),P("onChange",function(){w(e);let t=d(2);return S(t.onChangePlugins())}),u(),g(145," \xA0\xA0 "),c(146,"a",117),T(147,"img",118),u(),c(148,"p",36),g(149),C(150,"translate"),u()()()()()}if(l&2){let e=d(2);a(3),x(" ",y(4,65,"FW.MSG_FW_EDITION.PLUGINS")," "),a(5),m("binary",!0),H("ngModel",e.optionsPlugins.openvpn),m("ngModelOptions",W(99,Pe)),a(5),x("\xA0\xA0",y(14,67,"CLUSTER.PLUGINS.OPENVPN"),""),a(4),m("binary",!0),H("ngModel",e.optionsPlugins.keepalived),m("ngModelOptions",W(100,Pe)),a(5),x("\xA0\xA0",y(23,69,"CLUSTER.PLUGINS.KEEPALIVED"),""),a(4),m("binary",!0),H("ngModel",e.optionsPlugins.geoip),m("ngModelOptions",W(101,Pe)),a(5),x("\xA0\xA0",y(32,71,"CLUSTER.PLUGINS.GEOIP"),""),a(4),m("binary",!0),H("ngModel",e.optionsPlugins.crowdsec),m("ngModelOptions",W(102,Pe)),a(5),x("\xA0\xA0",y(41,73,"CLUSTER.PLUGINS.CROWDSEC"),""),a(4),m("binary",!0),H("ngModel",e.optionsPlugins.ntopng),m("ngModelOptions",W(103,Pe)),a(5),x("\xA0\xA0",y(50,75,"CLUSTER.PLUGINS.NTOPNG"),""),a(4),m("binary",!0),H("ngModel",e.optionsPlugins.websafety),m("ngModelOptions",W(104,Pe)),a(5),x("\xA0\xA0",y(59,77,"CLUSTER.PLUGINS.WEBSAFETY"),""),a(4),m("binary",!0),H("ngModel",e.optionsPlugins.dnssafety),m("ngModelOptions",W(105,Pe)),a(5),x("\xA0\xA0",y(68,79,"CLUSTER.PLUGINS.DNSSAFETY"),""),a(4),m("binary",!0),H("ngModel",e.optionsPlugins.iscbind9),m("ngModelOptions",W(106,Pe)),a(5),x("\xA0\xA0",y(77,81,"FW.PLUGINS.ISCBIND9"),""),a(5),m("binary",!0),H("ngModel",e.optionsPlugins.suricata),m("ngModelOptions",W(107,Pe)),a(5),x("\xA0\xA0",y(87,83,"CLUSTER.PLUGINS.SURICATA"),""),a(4),m("binary",!0),H("ngModel",e.optionsPlugins.zeek),m("ngModelOptions",W(108,Pe)),a(5),x("\xA0\xA0",y(96,85,"CLUSTER.PLUGINS.ZEEK"),""),a(4),m("binary",!0),H("ngModel",e.optionsPlugins.elasticsearch),m("ngModelOptions",W(109,Pe)),a(5),x("\xA0\xA0",y(105,87,"CLUSTER.PLUGINS.ELASTICSEARCH"),""),a(4),m("binary",!0),H("ngModel",e.optionsPlugins.kibana),m("ngModelOptions",W(110,Pe)),a(5),x("\xA0\xA0",y(114,89,"CLUSTER.PLUGINS.KIBANA"),""),a(4),m("binary",!0),H("ngModel",e.optionsPlugins.logstash),m("ngModelOptions",W(111,Pe)),a(5),x("\xA0\xA0",y(123,91,"CLUSTER.PLUGINS.LOGSTASH"),""),a(4),m("binary",!0),H("ngModel",e.optionsPlugins.filebeat),m("ngModelOptions",W(112,Pe)),a(5),x("\xA0\xA0",y(132,93,"CLUSTER.PLUGINS.FILEBEAT"),""),a(4),m("binary",!0),H("ngModel",e.optionsPlugins.iscdhcp),m("ngModelOptions",W(113,Pe)),a(5),x("\xA0\xA0",y(141,95,"FW.PLUGINS.ISCDHCP"),""),a(4),m("binary",!0),H("ngModel",e.optionsPlugins.haproxy),m("ngModelOptions",W(114,Pe)),a(5),x("\xA0\xA0",y(150,97,"FW.PLUGINS.HAPROXY"),"")}}function Pp(l,_){if(l&1&&(c(0,"div",20)(1,"div",21),T(2,"sts-fwc-message",88),u()()),l&2){let e=d(2);a(2),m("message",Ze(1,Vl,e.translate.instant("NGFW.TITLE"),e.translate.instant("NGFW.ERRORS.COMMUNICATION.TEXT")))}}function Tp(l,_){if(l&1){let e=L();c(0,"div",20)(1,"div",42)(2,"h5",22),g(3),C(4,"translate"),u()(),g(5," \xA0 "),c(6,"div",20)(7,"div",71)(8,"label",119)(9,"a",95),T(10,"img",120),u(),g(11),C(12,"translate"),u(),c(13,"button",121),C(14,"translate"),C(15,"translate"),P("click",function(){w(e);let t=d(2);return S(t.onClickButtonNGFW("NTOPNG",t.node))}),u()(),c(16,"div",71)(17,"label",122)(18,"a",97),T(19,"img",123),u(),g(20),C(21,"translate"),u(),c(22,"button",121),C(23,"translate"),C(24,"translate"),P("click",function(){w(e);let t=d(2);return S(t.onClickButtonNGFW("WEBSAFETYPROXY",t.node))}),u()(),c(25,"div",71)(26,"label",124)(27,"a",99),T(28,"img",125),u(),g(29),C(30,"translate"),u(),c(31,"button",121),C(32,"translate"),C(33,"translate"),P("click",function(){w(e);let t=d(2);return S(t.onClickButtonNGFW("DNSSAFETY",t.node))}),u()(),c(34,"div",71)(35,"label",126)(36,"a",107),T(37,"img",127),u(),g(38),C(39,"translate"),u(),c(40,"button",121),C(41,"translate"),C(42,"translate"),P("click",function(){w(e);let t=d(2);return S(t.onClickButtonNGFW("ELASTICSEARCH",t.node))}),u()()()()}if(l&2){let e=d(2);a(3),x(" ",y(4,17,"NGFW.DESCRIPTION")," "),a(8),x(" ",y(12,19,"CONTEXT.FW.NTOPNG"),""),a(2),M("pTooltip",y(14,21,"CONTEXT.FW.NTOPNG")),M("label",y(15,23,"CONTEXT.FW.NTOPNG")),m("disabled",!e.checksNodeNtopNGConfig()),a(7),x(" ",y(21,25,"CONTEXT.FW.WEBSAFETYPROXY"),""),a(2),M("pTooltip",y(23,27,"CONTEXT.FW.WEBSAFETYPROXY")),M("label",y(24,29,"CONTEXT.FW.WEBSAFETYPROXY")),m("disabled",!e.checksNodeWebSafetyProxyActie()),a(7),x(" ",y(30,31,"CONTEXT.FW.DNSSAFETY"),""),a(2),M("pTooltip",y(32,33,"CONTEXT.FW.DNSSAFETY")),M("label",y(33,35,"CONTEXT.FW.DNSSAFETY")),m("disabled",!e.checksNodeDNSSafetyActive()),a(7),x(" ",y(39,37,"CLUSTER.PLUGINS.ELASTICSEARCH"),""),a(2),M("pTooltip",y(41,39,"CLUSTER.PLUGINS.ELASTICSEARCH")),M("label",y(42,41,"CLUSTER.PLUGINS.ELASTICSEARCH")),m("disabled",!e.checksNodeElasticSearchActive())}}function Op(l,_){if(l&1){let e=L();c(0,"form",17),P("keyup.enter",function(t){w(e);let n=d();return S(n.checkForm(t))})("keyup.esc",function(){w(e);let t=d();return S(t.onCancel())}),c(1,"p-tabView",18),P("onChange",function(t){w(e);let n=d();return S(n.onChangeTab(t))}),c(2,"p-tabPanel",19),C(3,"translate"),c(4,"div",20)(5,"div",21)(6,"h5",22),g(7),C(8,"translate"),u()(),c(9,"div",23)(10,"div",24)(11,"label",25),g(12),C(13,"translate"),u(),T(14,"input",26,1),C(16,"translate"),u(),c(17,"p",27),g(18),C(19,"translate"),u()(),c(20,"div",23)(21,"div",24)(22,"label",28),g(23),C(24,"translate"),u(),c(25,"select",29,2),P("change",function(){w(e);let t=d();return S(t.changeCompilerOptions())}),Oe(27,lp,2,2,"option",30,Te),u()()(),c(29,"div",31)(30,"div",24)(31,"label",32),g(32),C(33,"translate"),u()()(),c(34,"div",33),T(35,"textarea",34),u()(),c(36,"div",35)(37,"div",21)(38,"h5",36),g(39),C(40,"translate"),u()(),Oe(41,vp,23,34,"div",37,Te),u()(),c(43,"p-tabPanel",38),C(44,"translate"),c(45,"sts-fwc-interfaces-tree-editor",39,3),P("onInstallModified",function(t){w(e);let n=d();return S(n.onEditorInstallModified(t))})("onIpObjectModified",function(t){w(e);let n=d();return S(n.onEditorInterfaceOrIpModified(t))})("onStartAutodiscover",function(){w(e);let t=d();return S(t.onDiscoverInterfaces(!0))}),u()(),c(47,"p-tabPanel",40),C(48,"translate"),T(49,"input",41),c(50,"div",20)(51,"div",42)(52,"h5",22),g(53),C(54,"translate"),u()(),c(55,"div",23)(56,"div",21)(57,"div",24)(58,"p-checkbox",43),J("ngModelChange",function(t){w(e);let n=d();return Y(n.optionsFlags.stateful,t)||(n.optionsFlags.stateful=t),S(t)}),P("onChange",function(){w(e);let t=d();return S(t.setFormOptionsFlags())}),u()()(),c(59,"div",21)(60,"div",24)(61,"p-checkbox",43),J("ngModelChange",function(t){w(e);let n=d();return Y(n.optionsFlags.ipv4,t)||(n.optionsFlags.ipv4=t),S(t)}),P("onChange",function(){w(e);let t=d();return S(t.setFormOptionsFlags())}),u()()(),c(62,"div",21)(63,"div",24)(64,"p-checkbox",43),J("ngModelChange",function(t){w(e);let n=d();return Y(n.optionsFlags.ipv6,t)||(n.optionsFlags.ipv6=t),S(t)}),P("onChange",function(){w(e);let t=d();return S(t.setFormOptionsFlags())}),u()()(),c(65,"div",21)(66,"div",24)(67,"p-checkbox",43),J("ngModelChange",function(t){w(e);let n=d();return Y(n.optionsFlags.debug,t)||(n.optionsFlags.debug=t),S(t)}),P("onChange",function(){w(e);let t=d();return S(t.setFormOptionsFlags())}),u()()(),c(68,"div",21)(69,"div",24)(70,"p-checkbox",43),J("ngModelChange",function(t){w(e);let n=d();return Y(n.optionsFlags.report,t)||(n.optionsFlags.report=t),S(t)}),P("onChange",function(){w(e);let t=d();return S(t.setFormOptionsFlags())}),u()()()(),c(71,"div",23)(72,"div",21)(73,"div",24)(74,"p-checkbox",44),J("ngModelChange",function(t){w(e);let n=d();return Y(n.optionsFlags.docker,t)||(n.optionsFlags.docker=t),S(t)}),P("onChange",function(){w(e);let t=d();return S(t.setFormOptionsFlags())}),u(),g(75," \xA0\xA0 "),c(76,"a",45),T(77,"img",46),u(),g(78," \xA0\xA0 "),c(79,"p",36),g(80),C(81,"translate"),u(),c(82,"a",47),g(83,"(+ info)"),u()()(),c(84,"div",21)(85,"div",24)(86,"p-checkbox",44),J("ngModelChange",function(t){w(e);let n=d();return Y(n.optionsFlags.crowdsec,t)||(n.optionsFlags.crowdsec=t),S(t)}),P("onChange",function(){w(e);let t=d();return S(t.setFormOptionsFlags())}),u(),g(87," \xA0\xA0 "),c(88,"a",48),T(89,"img",49),u(),g(90," \xA0\xA0 "),c(91,"p",36),g(92),C(93,"translate"),u()()(),c(94,"div",21)(95,"div",24)(96,"p-checkbox",44),J("ngModelChange",function(t){w(e);let n=d();return Y(n.optionsFlags.fail2ban,t)||(n.optionsFlags.fail2ban=t),S(t)}),P("onChange",function(){w(e);let t=d();return S(t.setFormOptionsFlags())}),u(),g(97," \xA0\xA0 "),c(98,"a",50),T(99,"img",51),u(),g(100," \xA0\xA0 "),c(101,"p",36),g(102),C(103,"translate"),u()()()()()(),c(104,"p-tabPanel",52),C(105,"translate"),T(106,"input",53),A(107,Ip,3,4,"div",20)(108,bp,151,115,"div",20),u(),c(109,"p-tabPanel",54),C(110,"translate"),A(111,Pp,3,4,"div",20)(112,Tp,43,43,"div",20),u()()()}if(l&2){let e=d();m("formGroup",e.formModel),a(),m("activeIndex",e.shownPanel),a(),M("header",y(3,61,"CLUSTER.MSG_CLUSTER_TAB.CT_0")),m("selected",!0)("disabled",e.loadingData),a(5),x(" ",y(8,63,"CLUSTER.MSG_CLUSTER_EDITION.BASIC")," "),a(5),j(y(13,65,"CLUSTER.MSG_CLUSTER_EDITION.NAME")),a(2),M("placeholder",y(16,67,"CLUSTER.MSG_CLUSTER_EDITION.NAME")),a(3),m("ngStyle",ae(93,jl,e.formModel.get("name").valid||e.formModel.get("name").pristine?"hidden":"visible")),a(),x(" ",y(19,69,"ITEM_PANEL.ERRORS.FIELD_INVALID_NAME")," "),a(5),j(y(24,71,"FW.MSG_FW_EDITION.COMPILER")),a(4),Re(e.FirewallCompilerOptions),a(5),x("",y(33,73,"CLUSTER.MSG_CLUSTER_EDITION.DESC")," "),a(3),m("rows",3),a(4),x(" ",y(40,75,"CLUSTER.MSG_CLUSTER_EDITION.NODES")," "),a(2),Re(e.getFormNodes().controls),a(2),M("header",y(44,77,"FW.MSG_FW_TAB.FT_1")),m("disabled",e.loadingData),a(2),m("options",e.interfacesEditorOptions),a(2),M("header",y(48,79,"CLUSTER.MSG_CLUSTER_TAB.CT_1")),m("disabled",e.loadingData),a(6),x(" ",y(54,81,"FW.MSG_FW_EDITION.OPTIONS_DATA")," "),a(5),m("binary",!0),H("ngModel",e.optionsFlags.stateful),m("ngModelOptions",W(95,Pe))("label",e.translate.instant("FW.OPTION_NAMES.stateful")),a(3),m("binary",!0),H("ngModel",e.optionsFlags.ipv4),m("ngModelOptions",W(96,Pe))("label",e.translate.instant("FW.OPTION_NAMES.ipv4")),a(3),m("binary",!0),H("ngModel",e.optionsFlags.ipv6),m("ngModelOptions",W(97,Pe))("label",e.translate.instant("FW.OPTION_NAMES.ipv6")),a(3),m("binary",!0),H("ngModel",e.optionsFlags.debug),m("ngModelOptions",W(98,Pe))("label",e.translate.instant("FW.OPTION_NAMES.debug")),a(3),m("binary",!0),H("ngModel",e.optionsFlags.report),m("ngModelOptions",W(99,Pe))("label",e.translate.instant("FW.OPTION_NAMES.report")),a(4),m("binary",!0),H("ngModel",e.optionsFlags.docker),m("ngModelOptions",W(100,Pe)),a(6),x("\xA0\xA0",y(81,83,"FW.OPTION_NAMES.docker"),""),a(2),M("href",e.dockerDocURL,oi),a(4),m("binary",!0),H("ngModel",e.optionsFlags.crowdsec),m("ngModelOptions",W(101,Pe)),a(6),x("\xA0\xA0",y(93,85,"FW.OPTION_NAMES.crowdsec"),""),a(4),m("binary",!0),H("ngModel",e.optionsFlags.fail2ban),m("ngModelOptions",W(102,Pe)),a(6),x("\xA0\xA0",y(103,87,"FW.OPTION_NAMES.fail2ban"),""),a(2),M("header",y(105,89,"FW.MSG_FW_EDITION.PLUGINS")),m("disabled",e.loadingData||e.NodesComunicateViaSsh()),a(3),O(e.NodesComunicateViaSsh()?107:-1),a(),O(e.NodesComunicateViaSsh()?-1:108),a(),M("header",y(110,91,"NGFW.TITLE")),m("disabled",e.loadingData||e.NodesComunicateViaSsh()),a(2),O(e.NodesComunicateViaSsh()?111:-1),a(),O(e.NodesComunicateViaSsh()?-1:112)}}function Rp(l,_){if(l&1&&(c(0,"div",128),T(1,"sts-fwc-message",88),u()),l&2){let e=d(2);a(),m("message",e.delMessage)}}function xp(l,_){if(l&1&&T(0,"sts-fwc-message",88),l&2){let e=d(3);m("message",e.deleteMsgError)}}function Fp(l,_){if(l&1){let e=L();c(0,"sts-fwc-object-restrictions",131),P("onHideParent",function(){w(e);let t=d(3);return S(t.minimizeDialog(!0))})("onRefreshRestrictions",function(){w(e);let t=d(3);return S(t.reloadPanel())}),u()}if(l&2){let e=d(3);m("dependencies",e.dependencies)}}function Ap(l,_){if(l&1&&(c(0,"div",129),A(1,xp,1,1,"sts-fwc-message",88)(2,Fp,1,1,"sts-fwc-object-restrictions",130),u()),l&2){let e=d(2);a(),O(e.deleteMsgError?1:-1),a(),O(e.dependencies.restrictionsError?-1:2)}}function Lp(l,_){if(l&1){let e=L();c(0,"div",128)(1,"p-checkbox",132),C(2,"translate"),J("ngModelChange",function(t){w(e);let n=d(3);return Y(n.okToDelete,t)||(n.okToDelete=t),S(t)}),u()()}if(l&2){let e=d(3);a(),M("label",y(2,2,"CLUSTER.MSG_CLUSTER_DELETE.DEL_5")),H("ngModel",e.okToDelete)}}function Mp(l,_){if(l&1&&(T(0,"sts-fwc-message",88),A(1,Lp,3,4,"div",128)),l&2){let e=d(2);m("message",e.deleteMsgError),a(),O(e.loadingData?-1:1)}}function Dp(l,_){if(l&1&&A(0,Rp,2,1,"div",128)(1,Ap,3,2,"div",129)(2,Mp,2,2),l&2){let e=d();O(e.loadingData&&!e.deleteMsgError?0:-1),a(),O(e.dependencies?1:2)}}function Np(l,_){if(l&1&&(c(0,"div",133),T(1,"p-progressSpinner"),u()),l&2){let e=d(3);m("ngStyle",ae(3,jl,e.loadingData?"visible":"hidden")),a(),ke(W(5,$c))}}function Up(l,_){if(l&1){let e=L();c(0,"button",138),C(1,"translate"),P("click",function(){w(e);let t=d(3);return S(t.onCloseDialog())}),u()}l&2&&M("label",y(1,1,"GLOBALS.MSG_BUTTONS.STOP"))}function Gp(l,_){if(l&1){let e=L();c(0,"button",139),C(1,"translate"),P("click",function(){w(e);let t=d(3);return S(t.onCancel())}),u()}if(l&2){let e=d(3);M("label",y(1,2,"GLOBALS.MSG_BUTTONS.CANCEL")),m("disabled",e.loadingData)}}function Bp(l,_){if(l&1){let e=L();c(0,"button",140),C(1,"translate"),P("click",function(){w(e);let t=d(3);return S(t.onSave())}),u()}if(l&2){let e=d(3);M("label",y(1,2,"GLOBALS.MSG_BUTTONS.SAVE")),m("disabled",!e.formModel.valid||e.loadingData)}}function kp(l,_){if(l&1){let e=L();c(0,"button",141),C(1,"translate"),P("click",function(){w(e);let t=d(3);return S(t.onCancel())}),u()}if(l&2){let e=d(3);M("label",y(1,2,"GLOBALS.MSG_BUTTONS.CLOSE")),m("disabled",e.loadingData)}}function jp(l,_){if(l&1&&A(0,Np,2,6,"div",133)(1,Up,2,3,"button",134)(2,Gp,2,4,"button",135)(3,Bp,2,4,"button",136)(4,kp,2,4,"button",137),l&2){let e=d(2);O(e.loadingCommunication?0:-1),a(),O(e.loadingCommunication?1:-1),a(),O(!e.formModel.pristine&&!e.loadingCommunication?2:-1),a(),O(e.formModel.pristine?-1:3),a(),O(e.formModel.pristine?4:-1)}}function Vp(l,_){if(l&1){let e=L();c(0,"button",145),C(1,"translate"),P("click",function(){w(e);let t=d(3);return S(t.reloadPanel())}),u()}if(l&2){let e=d(3);M("label",y(1,2,"POLICY_GRID.RELOAD")),m("disabled",e.loadingData)}}function Wp(l,_){if(l&1){let e=L();A(0,Vp,2,4,"button",142),c(1,"button",143),C(2,"translate"),P("click",function(){w(e);let t=d(2);return S(t.onDeleteCluster())}),u(),c(3,"button",144),C(4,"translate"),P("click",function(){w(e);let t=d(2);return S(t.onCancel())}),u()}if(l&2){let e=d(2);O(e.dependencies?0:-1),a(),M("label",y(2,4,"CLUSTER.MSG_CLUSTER_EDITION.DELETE")),m("disabled",!e.okToDelete||e.loadingData),a(2),M("label",y(4,6,"GLOBALS.MSG_BUTTONS.CANCEL"))}}function Hp(l,_){if(l&1&&A(0,jp,5,5)(1,Wp,5,8),l&2){let e=d();O(e.cluster?0:-1),a(),O(e.clusterToDelete?1:-1)}}var bt=function(l){return l.stateful="stateful",l.ipv4="ipv4",l.ipv6="ipv6",l.debug="debug",l.report="report",l.docker="docker",l.crowdsec="crowdsec",l.fail2ban="fail2ban",l}(bt||{}),ct=function(l){return l.openvpn="openvpn",l.geoip="geoip",l.crowdsec="crowdsec",l.ntopng="ntopng",l.suricata="suricata",l.keepalived="keepalived",l.zeek="zeek",l.elasticsearch="elasticsearch",l.filebeat="filebeat",l.websafety="websafety",l.kibana="kibana",l.logstash="logstash",l.dnssafety="dnssafety",l.iscbind9="iscbind9",l.iscdhcp="iscdhcp",l.haproxy="haproxy",l}(ct||{}),kl=new Map([[bt.stateful,0],[bt.ipv4,1],[bt.ipv6,2],[bt.debug,3],[bt.report,4],[bt.docker,5],[bt.crowdsec,6],[bt.fail2ban,7]]),mt=new Map([["openvpn",1],["geoip",2],["crowdsec",4],["ntopng",8],["suricata",16],["keepalived",32],["zeek",64],["elasticsearch",128],["filebeat",256],["websafety",512],["kibana",1024],["logstash",2048],["dnssafety",4096],["iscbind9",8192],["iscdhcp",16384],["haproxy",32768]]),Wl=(()=>{class l extends Dt{constructor(e,i,t,n,o,r,p,s,f,h,E,b,I,R,V,G,D,K){super(E,p,i,V,D,K),this.fwcUserService=e,this.itemSelectedService=i,this.fwcFirewallService=t,this.fwcInterfaceService=n,this.confirmationService=o,this.fwcObjectTreeService=r,this.appOptionsService=p,this.fwcPolicyService=s,this.fwcEventService=f,this.fwcErrorPipe=h,this.appDialogPanelsService=E,this.messageService=b,this.utilService=I,this.inputDataService=R,this.cd=V,this.translate=G,this.store=D,this.router=K,this.cluster=null,this.clusterToDelete=null,this.interfaces=[],this.interfacesIpObjs=new Map,this.clusterNodes=[],this.displaySSH=[],this.displayApiKey=[],this.dependencies=null,this.okToDelete=!1,this.loadingData=!1,this.loadingCommunication=!1,this.alive=!0,this.discoveredInstallOptions=new Map,this.FirewallCompilerOptions=Kt,this.optionsFlags={stateful:!1,ipv4:!1,ipv6:!1,debug:!1,report:!1,docker:!1,crowdsec:!1,fail2ban:!1},this.optionsPlugins={openvpn:!1,geoip:!1,crowdsec:!1,ntopng:!1,suricata:!1,keepalived:!1,zeek:!1,elasticsearch:!1,filebeat:!1,websafety:!1,kibana:!1,logstash:!1,dnssafety:!1,iscbind9:!1,iscdhcp:!1,haproxy:!1},this.createDialog(this.translate.instant("CLUSTER.PANEL_TITLE"),"fwci-clusters",ee.CLUSTER_PANEL),this.helpSection="/firewalls",this.resetForm()}ngOnInit(){this.dockerDocURL=`https://fwcloud.net/${this.translate.currentLang!=="es"?this.translate.currentLang+"/":""}documentation/fwcloud-docker`,this.deleteMsgError=null,this.store.pipe($(()=>this.alive),zt(xi.selectDialogUuidsToReload)).subscribe(e=>{e&&e.find(i=>i===this.dialogUUID)&&this.reloadPanel()}),this.itemSelectedService.getItem().pipe($(()=>this.alive)).subscribe(e=>{if(e._fwcObjType==v.OBJ_CLUSTER)if(this.itemSelectedService.hideObjectPanel(),e.deleteAction)this.showDialog(),this.checkClusterRestrictions(e);else if(e.id_obj!==null&&e.id_obj!=null){let i=[],t;for(i.push(e);i.length&&!t;){let n=i.pop();n.node_type==X.FOLDER_CLUSTER_FW?t=n.id:n.items&&n.items.length&&i.push(...n.items)}this.fwcFirewallService.getCluster(e.id_obj,this.fwcUserService.getActualFwSelectedCloud()).subscribe({next:n=>Z(this,null,function*(){let o,r;if(n.data){this.cluster=n.data,this.cluster.interfaces&&Array.isArray(this.cluster.interfaces)&&(this.interfaces=this.cluster.interfaces,this.interfaces.forEach(h=>{let E=Ui();h.interfaceUUID=E,Array.isArray(h.ipobjs)&&h.ipobjs.forEach(b=>{b.ipObjUUID=E+Ui()})}));let p=this.fwcUserService.getActualFwcUser().privateKey,s=this.cluster.nodes,f=[];for(let h=0;s&&h<s.length;h++){let E=s[h];o=E.options,r=E.plugins,E.firewallUUID=Et();try{E.install_user&&(E.install_user=yield this.utilService.openPGPDecrypt(E.install_user,p)),E.install_pass&&(E.install_pass=yield this.utilService.openPGPDecrypt(E.install_pass,p)),E.install_apikey&&(E.install_apikey.startsWith("-")||(E.install_apikey=yield this.utilService.openPGPDecrypt(E.install_apikey,p)))}catch{}let b,I;Array.isArray(this.interfaces)&&this.interfaces.forEach(R=>{E.install_interface&&E.install_interface===R.id&&(E.installInterfaceUUID=R.interfaceUUID,b=R),Array.isArray(R.ipobjs)&&R.ipobjs.forEach(V=>{E.install_ipobj&&E.install_ipobj===V.id&&(E.installIpObjUUID=V.ipObjUUID,I=V)})}),this.setNode(this.cluster.nodes[0].id.toString()+","+this.cluster.nodes[0].name),f.push({firewallUUID:E.firewallUUID,firewall_name:E.name,firewall:E.id,cluster:this.cluster.id,installOptions:{firewallUUID:E.firewallUUID,interface:b,ipobj:I}});for(let R=0;R<this.interfaces.length;R++)if(E.install_interface==this.interfaces[R].id){this.interfacesIpObjs.set(E.firewallUUID,this.interfaces[R].ipobjs);break}}Array.isArray(this.interfaces)&&(this.interfacesEditorOptions={isCluster:!0,firewalls:f,discoveredFirewallUUID:void 0,discoveredIfs:[],existingIfs:this.interfaces}),this.cluster.options=o,this.cluster.nodesParentId=t,this.resetForm(),this.fillForm(),this.showDialog()}}),error:n=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(n)})},complete:()=>{}})}else this.cluster={id:void 0,node_id:e.node_id,options:3,plugins:0},this.resetForm(),this.fillForm(),this.showDialog()})}ngOnDestroy(){super.ngOnDestroy()}reloadPanel(){if(this.clusterToDelete&&this.clusterToDelete&&(this.displayDialog||this.dialogMinified)){let e=Object.assign({},this.clusterToDelete),i=this.itemSelectedService.getActualLastMinifiedDialogId();this.checkClusterRestrictions(e),this.dialogId==i&&(this.showDialog(),this.itemSelectedService.setLastMinifiedDialogId(void 0)),this.store.dispatch(me.reloadDialogFinished({dialogUuid:this.dialogUUID}))}}getInterfaceAndAddressByUUID(e,i,t){let n,o;if(Array.isArray(this.interfaces)&&this.interfaces.forEach(r=>{r.interfaceUUID&&r.interfaceUUID===i&&(n=r),Array.isArray(r.ipobjs)&&r.ipobjs.forEach(p=>{p.ipObjUUID&&p.ipObjUUID===t&&(o=p)})}),(!n||!o)&&this.discoveredInstallOptions){let r=this.discoveredInstallOptions.get(e);r&&(n=n||r.interface,o=o||r.ipobj)}return{interfaceInfo:n,ipObjInfo:o}}resetProperties(){this.fwcUserService.setConfirmationToken(void 0),this.cluster=null,this.clusterNodes=[],this.clusterToDelete=null,this.interfaces=[],this.interfacesIpObjs=new Map,this.dependencies=null,this.interfacesEditorOptions=null,this.fwcInterfacesEditor&&this.fwcInterfacesEditor.resetProperties(),this.discoveredInstallOptions=new Map,this.deleteMsgError=null,this.delMessage=null,this.displaySSH=[],this.displayApiKey=[],this.okToDelete=!1,this.loadingData=!1,this.formModel&&this.formModel.reset()}resetForm(){this.formModel=new ri({cluster:new k(""),name:new k("",[Q.required,Q.pattern(ye.nameRegExp)]),comment:new k(""),options:new k(3),plugins:new k(0),node_id:new k(null),fwnodes:new Ro([this.createNode()],ye.distinctNameValidator.bind(this)),compiler:new k(0)})}createNode(e){let i,t,n,o,r,p,s,f,h,E,b,I,R,V,G,D,K,B;e?(i=e.id,t=e.name,n=e.comment,o=e.fwcloud,r=e.install_user,p=e.install_pass,s=e.save_user_pass,f=e.install_interface,h=e.install_ipobj,E=e.fwmaster,b=e.install_port,I=e.firewallUUID,V=e.installInterfaceUUID,G=e.installIpObjUUID,D=e.install_communication,K=e.install_protocol,B=e.install_apikey):I=Et(),this.cluster&&(R=this.cluster.id),s===void 0&&(s=1),E===void 0&&(E=0),b===void 0&&(b=33033);let te=new ri({name:new k(t,[Q.required,Q.pattern(ye.nameRegExp)]),comment:new k(n),install_user:new k(r,Q.pattern(ye.linuxUsername)),install_pass:new k(p,Q.pattern(ye.linuxPassword)),save_user_pass:new k(s),install_interface:new k(f),install_ipobj:new k(h),fwmaster:new k(E),install_port:new k(b),firewallUUID:new k(I),installInterfaceUUID:new k(V),installIpObjUUID:new k(G),install_communication:new k(D||"agent",Q.required),install_protocol:new k(K||"https"),install_apikey:new k(B)});return i!=null&&te.addControl("id",new k(i)),R!=null&&te.addControl("cluster",new k(R)),te}fillForm(){if(this.cluster){if(this.formModel.controls.cluster.setValue(this.cluster.id),this.formModel.controls.name.setValue(this.cluster.name),this.formModel.controls.comment.setValue(this.cluster.comment),this.formModel.controls.node_id.setValue(this.cluster.node_id),this.formModel.controls.options.setValue(this.cluster.options),this.setOptionsFlags(),this.formModel.controls.plugins.setValue(this.cluster.plugins),this.setOptionsPlugins(),this.cluster.nodes&&this.cluster.nodes.length){let i=this.formModel.controls.fwnodes;for(;i.length!==0;)i.removeAt(0);for(let t=0;t<this.cluster.nodes.length;t++){let n=this.cluster.nodes[t];this.formModel.controls.fwnodes.push(this.createNode(n))}}this.cluster.type=v.OBJ_CLUSTER,this.cluster.container=it.C_FIREWALLS;let e=this.cluster.options&61440;this.formModel.controls.compiler.setValue(e>>12)}}setOptionsFlags(){this.cluster&&Object.values(bt).forEach(e=>{this.optionsFlags[e]=!!(this.cluster.options&2**kl.get(e))})}setFormOptionsFlags(){let e=[];for(let i of Object.values(bt)){let t=kl.get(i);e[t]=this.optionsFlags[i]?"1":"0"}this.formModel.controls.options.setValue(parseInt(e.reduce((i,t)=>t+i,""),2)),this.formModel.markAsDirty()}getFormNodes(){return this.formModel.get("fwnodes")}NodesComunicateViaSsh(){return!this.formModel.value.fwnodes.find(e=>e.install_communication!=="ssh")}setOptionsPlugins(){this.cluster&&Object.values(ct).forEach(e=>{this.optionsPlugins[e]=!!(this.cluster.plugins&mt.get(e))})}onChangePluginsDevelop(){this.confirmationService.confirm({header:this.translate.instant("FW.PLUGINS.HEADER"),icon:"fa fa-exclamation-circle fwcRed iconBig",acceptLabel:"Ok",rejectVisible:!1,message:this.translate.instant("FW.PLUGINS.NOT_IMPLEMENTED"),reject:()=>{this.setOptionsPlugins()},accept:()=>{this.setOptionsPlugins()}})}NodeHaveDiscoveredIp(e){if(this.discoveredInstallOptions.get(e.value.firewallUUID)){if(this.discoveredInstallOptions.get(e.value.firewallUUID).ipobj.address!=null)return!0}else if(this.interfacesIpObjs.get(e.value.firewallUUID))return!0;return!1}onChangePlugins(){let e=[],i,t;this.cluster.id?(i=this.cluster.name,t=this.cluster.plugins):(t=this.formModel.controls.plugins.value,i=this.formModel.controls.name.value);for(let s of Object.values(ct)){let f=mt.get(s);e[f]=this.optionsPlugins[s]?"1":"0"}this.formModel.controls.plugins.setValue(parseInt(e.reduce((s,f)=>f+s,""),2));let n=this.fwcUserService.getActualFwcUser().publicKey,o,r,p=[];Object.values(ct).forEach(s=>{if((this.formModel.controls.plugins.value&mt.get(s))!==(this.cluster.plugins&mt.get(s))){s==ct.iscbind9?o="isc-bind9":s==ct.iscdhcp?o="isc-dhcp":o=s,r=this.optionsPlugins[s];let f,h;this.formModel.controls.plugins.value&mt.get(s)?(f=this.translate.instant("CLUSTER.PLUGINS.ENABLE",{plugin:this.translate.instant("CLUSTER.PLUGINS."+s.toUpperCase())}),h=this.translate.instant("CLUSTER.PLUGINS.ENABLE_OK",{plugin:this.translate.instant("CLUSTER.PLUGINS."+s.toUpperCase())})):(f=this.translate.instant("CLUSTER.PLUGINS.DISABLE",{plugin:this.translate.instant("CLUSTER.PLUGINS."+s.toUpperCase())}),h=this.translate.instant("CLUSTER.PLUGINS.DISABLE_OK",{plugin:this.translate.instant("CLUSTER.PLUGINS."+s.toUpperCase())})),this.confirmationService.confirm({header:this.translate.instant("CLUSTER.PLUGINS.HEADER"),message:f,reject:()=>{this.setOptionsPlugins()},accept:()=>Z(this,null,function*(){this.loadingData=!0;for(let b=0;b<this.formModel.value.fwnodes.length;b++)if(this.discoveredInstallOptions.get(this.getFormNodes().value[b].firewallUUID)){let I=this.getFormNodes().value[b].install_apikey;I&&(I.startsWith("-")||(this.getFormNodes().value[b].install_apikey=yield this.utilService.openPGPEncrypt(this.getFormNodes().value[b].install_apikey,n))),p.push({firewall:this.getFormNodes().value[b],plugin:o,enable:r,address:this.discoveredInstallOptions.get(this.getFormNodes().value[b].firewallUUID).ipobj.address,persisted:!1})}else{let I=this.formModel.value.fwnodes[b].install_apikey;I&&(I.startsWith("-")||(this.formModel.value.fwnodes[b].install_apikey=yield this.utilService.openPGPEncrypt(this.formModel.value.fwnodes[b].install_apikey,n))),p.push({firewall:this.formModel.value.fwnodes[b],plugin:o,enable:r,address:this.interfacesIpObjs.get(this.formModel.value.fwnodes[b].firewallUUID)?this.interfacesIpObjs.get(this.formModel.value.fwnodes[b].firewallUUID).filter(R=>R.id==this.formModel.value.fwnodes[b].install_ipobj)[0].address:null,persisted:!1})}this.eventsSubscription=this.fwcEventService.getEvent().pipe($(()=>this.alive)).subscribe(b=>{if(b.type==Ri.EVENT_PLUGIN_PANEL_CLOSED)if(this.eventsSubscription.unsubscribe(),b.data)this.formModel.controls.plugins.setValue(t),this.setOptionsPlugins();else if(this.formModel.controls.plugins.setValue(this.formModel.controls.plugins.value),this.cluster.id){let R=this.formModel.value;R={cluster:this.cluster.id,name:this.cluster.name,comment:this.cluster.comment,options:this.cluster.options,plugins:this.formModel.controls.plugins.value},delete R.compiler;let V=this.fwcUserService.getActualFwSelectedCloud();R=ot(R),this.utilService.fwcAPICall(this.fwcFirewallService.updateCluster.bind(this.fwcFirewallService),R,V,null).then(G=>{let D=this.formModel.get("fwnodes");for(let K=0;K<D.length;K++){let B=D.at(K);B.value.plugins=this.formModel.controls.plugins.value,B.markAllAsTouched()}this.updateNodesAsync().then(()=>{this.processInterfacesOperations(this.cluster.id).then(()=>{this.cluster.plugins=this.formModel.controls.plugins.value}).catch(K=>{this.setOptionsPlugins()})})}).catch(G=>{this.setOptionsPlugins(),this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(G)})})}else this.cluster.plugins=this.formModel.controls.plugins.value});let E={cluster:this.cluster,nodes:p,plugin:o,enable:r};this.itemSelectedService.setClusterToPluginOperation(E),this.loadingData=!1}),icon:"fa fa-question-circle fwcBlue iconBig",rejectVisible:!0,rejectLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.NO"),acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.YES")})}}),this.loadingData=!1}onClusterNodeNameChange(e){this.fwcInterfacesEditor&&this.fwcInterfacesEditor.updateFirewallName(e.get("firewallUUID").value,e.get("name").value)}onClusterNodeInstallCommChange(e){return Z(this,null,function*(){if(e){let i=e.get("install_communication").value,t,n=!1;n=!(yield this.utilService.fwcAPICall(this.fwcFirewallService.loadBackEndConfig.bind(this.fwcFirewallService))).data.availablecommunications.includes("ssh"),i==="ssh"?t="agent":n&&i==="agent"?(this.confirmationService.confirm({header:this.translate.instant("GLOBALS.MSG_OP_RESULT.ERROR"),icon:"fa fa-exclamation-circle fwcRed iconBig",message:this.translate.instant("API_ERROR.SSH_FORBIDDEN"),rejectVisible:!1,acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.OK")}),t="agent"):t="ssh",e.get("install_communication").setValue(t),t==="agent"?(e.get("install_protocol").setValidators([Q.required]),e.get("install_port").setValue(33033)):(e.get("install_protocol").clearValidators(),e.get("install_apikey").clearValidators(),e.get("install_port").setValue(22)),e.get("install_protocol").updateValueAndValidity(),e.get("install_apikey").updateValueAndValidity()}})}onInterfaceChange(e,i,t=null,n=!0){let o=this.formModel.get("fwnodes");if(o&&e>=0&&e<o.length){let r=o.at(e);if(!i)this.interfacesIpObjs.delete(r.get("firewallUUID").value);else{let p=this.interfaces.find(s=>s.id===+i);if(p&&(this.interfacesIpObjs.set(r.get("firewallUUID").value,p.ipobjs),r.get("installInterfaceUUID").setValue(p.interfaceUUID),Array.isArray(p.ipobjs))){let s=p.ipobjs.find(f=>f.id===+t);r.get("install_ipobj").setValue(t),r.get("installIpObjUUID").setValue(s?s.ipObjUUID:null)}}this.onChangeInstallData(e,n)}}onChangeInstallData(e,i=!0){let t=this.formModel.get("fwnodes"),n=t.at(e);if(n){let o=n.value,r,p;this.interfacesIpObjs.get(o.firewallUUID)&&(p=this.interfacesIpObjs.get(o.firewallUUID).find(h=>h.id===+o.install_ipobj)),p&&(r=p.ipObjUUID,n.get("installIpObjUUID").setValue(r));let s=o.installInterfaceUUID,f=o.firewallUUID;if(i){let h=this.getInterfaceAndAddressByUUID(f,s,r);this.fwcInterfacesEditor.updateInstallOptions({firewallUUID:f,interface:h.interfaceInfo,ipobj:h.ipObjInfo})}for(let h=0;h<t.length;h++){let E=t.at(h),b=E.value;h!==e&&b.installInterfaceUUID===s&&b.installIpObjUUID===r&&(E.get("install_interface").setValue(null),E.get("install_ipobj").setValue(null),E.get("installInterfaceUUID").setValue(null),E.get("installIpObjUUID").setValue(null),E.markAsTouched(),i&&this.fwcInterfacesEditor.updateInstallOptions({firewallUUID:b.firewallUUID,interface:null,ipobj:null}),this.interfacesIpObjs.delete(b.firewallUUID))}this.refreshDialog()}}nodeAdd(e){let i=this.formModel.get("fwnodes");if(i){let t=this.createNode();i.push(t);let n=t.get("firewallUUID").value;this.fwcInterfacesEditor&&this.fwcInterfacesEditor.addFirewall({cluster:this.cluster.id,firewall:void 0,firewallUUID:n,firewall_name:"",installOptions:{firewallUUID:n,interface:null,ipobj:null}})}this.recenterDialog();try{this.nodeInputs.last.nativeElement.focus()}catch{}}getNumberOfExistingNodes(){let e=0,i=this.formModel.get("fwnodes");if(i)for(let t=0;t<i.length;t++){let n=i.at(t);n.get("id")&&n.get("id").value&&e++}return e}nodeRemove(e){let i=this.formModel.get("fwnodes"),t=this.getNumberOfExistingNodes();if(!i||i.length<2||e<0||e>=i.length)return;let n=i.at(e).value;if(!(n.id&&t<2)){if(this.cluster.id!==null&&this.cluster.id!==void 0&&n.id!==null&&n.id!==void 0)this.confirmationService.confirm({header:this.translate.instant("GLOBALS.MSG_CONFIRM"),icon:"fa fa-question-circle fwcBlue iconBig",rejectVisible:!0,rejectLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.NO"),acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.YES"),message:this.translate.instant("CLUSTER.MSG_CLUSTER_NODE_DEL",{name:n.name}),accept:()=>{this.loadingData=!0,this.utilService.fwcAPICall(this.fwcFirewallService.deleteClusterNode.bind(this.fwcFirewallService),n.cluster,n.id,this.fwcUserService.getActualFwSelectedCloud()).then(o=>{let r=n.fwmaster,p=n.id,s=n.cluster,f=n.firewallUUID;if(i.removeAt(e),this.interfacesIpObjs.delete(n.firewallUUID),this.discoveredInstallOptions.delete(f),this.recenterDialog(),r){let E=i.at(0);E.get("fwmaster").setValue(1);let b={_fwcFwId:null,fwId:null},I=Object.assign({},this.fwcPolicyService.getActualSelectedPolicy());I&&I._fwcFwId==p&&(I._fwcFwId=I.fwId=E.get("id").value,this.fwcPolicyService.setSelectedPolicy(I))}this.fwcInterfacesEditor&&this.fwcInterfacesEditor.deleteFirewall(f);let h={_fwcObjId:s,_fwcObjType:v.OBJ_CLUSTER,container:it.C_FIREWALLS,_fwcTreeAction:Ne.NEW_ITEM};this.itemSelectedService.setModifiedItem(h),this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("CLUSTER.MSG_CLUSTER_NODES.CN_5",{name:n.name})}),this.loadingData=!1}).catch(o=>{o.error&&o.error.restrictions?setTimeout(()=>{this.confirmationService.confirm({icon:"fa fa-exclamation-circle fwcRed iconBig",header:this.translate.instant("CLUSTER.MSG_CLUSTER_NODE_RESTR.RESTR_0"),message:this.translate.instant("CLUSTER.MSG_CLUSTER_NODE_RESTR.RESTR_1"),accept:()=>{console.log("Restrictions")},acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.OK"),rejectVisible:!1})},500):this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(o)}),this.loadingData=!1})}});else{let o=n.firewallUUID;i.removeAt(e),this.interfacesIpObjs.delete(o),this.discoveredInstallOptions.delete(o),this.fwcInterfacesEditor&&this.fwcInterfacesEditor.deleteFirewall(o),this.recenterDialog()}this.nodeNGFW=this.formModel.get("fwnodes")[0]}}onTestFwcAgentCommunication(e){return Z(this,null,function*(){let i=+e.get("install_ipobj").value;if(i){let t=e.value,n=this.interfacesIpObjs.get(t.firewallUUID);if(n){let o=n.find(r=>r.id===i);if(o){let r="Error",p="fa fa-exclamation-circle fwcRed iconBig",s=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:this.translate.instant("GLOBALS.ERRORS.COMMUNICATION")});this.loadingData=!0,this.loadingCommunication=!0;let f=this.fwcUserService.getActualFwcUser().publicKey,h={communication:t.install_communication,host:o.address,port:t.install_port};if(t.install_communication==="ssh"){let E=t.install_user,b=t.install_pass;E&&(E=yield this.utilService.openPGPEncrypt(E,f)),b&&(b=yield this.utilService.openPGPEncrypt(b,f)),h.username=E,h.password=b}else{let E=t.install_apikey;E&&(E.startsWith("-")||(E=yield this.utilService.openPGPEncrypt(E,f))),h.protocol=t.install_protocol,h.apikey=E}({msgHeader:r,msgIcon:p,msgMessage:s}=this.pingSubscription(h,r,p,s))}}}else{let t="Error",n="fa fa-exclamation-circle fwcRed iconBig",o=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:this.translate.instant("GLOBALS.ERRORS.COMMUNICATION")});this.loadingData=!0,this.loadingCommunication=!0;let r=this.fwcUserService.getActualFwcUser().publicKey;if(e.value.install_communication=="agent"){let p=e.value.install_apikey;p&&(p.startsWith("-")||(p=yield this.utilService.openPGPEncrypt(p,r)));let s;this.discoveredInstallOptions.get(e.value.firewallUUID)?s=this.discoveredInstallOptions.get(e.value.firewallUUID).ipobj.address:s=null;let f={communication:e.value.install_communication,host:s,port:e.value.install_port,protocol:e.value.install_protocol,apikey:p};({msgHeader:t,msgIcon:n,msgMessage:o}=this.pingSubscription(f,t,n,o))}}})}pingSubscription(e,i,t,n){return this.communicationSubscription=this.utilService.fwcAPICallObservable(this.fwcFirewallService.checkFwCommunication.bind(this.fwcFirewallService),this.fwcUserService.getActualFwSelectedCloud(),e).subscribe({next:()=>{i=this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),t="fa fa-check-circle fwcGreen iconBig",n=this.translate.instant("FW.MSG_FW_EDITION.PING_AGENT_OK"),this.confirmationService.confirm({header:i,icon:t,acceptLabel:"Ok",rejectVisible:!1,message:n}),this.loadingData=!1,this.loadingCommunication=!1},error:o=>Z(this,null,function*(){let r;r=this.utilService.isCommunicationError(o.error),r&&(n=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:r})),this.confirmationService.confirm({header:i,icon:t,acceptLabel:"Ok",rejectVisible:!1,message:n}),this.loadingData=!1,this.loadingCommunication=!1})}),{msgHeader:i,msgIcon:t,msgMessage:n}}showClusterInfo(e){return Z(this,null,function*(){let i=+e.get("install_ipobj").value;if(this.loadingData=!0,this.loadingCommunication=!0,i){let t=e.value;if(i){let n=this.interfacesIpObjs.get(t.firewallUUID),o=n.find(r=>r.id===i);if(n){let r=this.fwcUserService.getActualFwcUser().publicKey,p={communication:t.install_communication,host:o.address,port:t.install_port};if(t.install_communication!=="ssh"){let s=t.install_apikey;s&&(s=yield this.utilService.openPGPEncrypt(s,r)),p.protocol=t.install_protocol,p.apikey=s}this.communicationSubscription=this.utilService.fwcAPICallObservable(this.fwcFirewallService.getFirewallInformation.bind(this.fwcFirewallService),this.fwcUserService.getActualFwSelectedCloud(),p).subscribe({next:s=>{let f=this.utilService.createDynamicComponentRef(bn),h=f.instance;h.setDynamicComponentRef(f),h.showFirewallPanel(s.data.data.fwc_agent_version,s.data.data.host_name,s.data.data.system_name,s.data.data.os_version,s.data.data.os_version,s.data.data.kernel_version),this.loadingData=!1,this.loadingCommunication=!1},error:s=>Z(this,null,function*(){let f=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:this.translate.instant("GLOBALS.ERRORS.COMMUNICATION")}),h;h=this.utilService.isCommunicationError(s.error),h&&(f=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:h})),this.confirmationService.confirm({header:"Error",icon:"fa fa-exclamation-circle fwcRed iconBig",acceptLabel:"Ok",rejectVisible:!1,message:f}),this.loadingData=!1,this.loadingCommunication=!1})})}}}})}onDiscoverInterfaces(){let e=this.formModel.get("fwnodes");if(!e||!e.controls.some(o=>o.get("name").value)){this.confirmationService.confirm({icon:"fa fa-exclamation-circle fwcRed iconBig",header:this.translate.instant("CLUSTER.MSG_CLUSTER_NO_NODES.HEADER"),message:this.translate.instant("CLUSTER.MSG_CLUSTER_NO_NODES.TEXT"),accept:()=>{this.shownPanel=0},rejectVisible:!1,acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.OK")});return}let i=[],t=!1;e.controls.forEach((o,r)=>{o.get("name").value&&(i.push({id:r,text:o.get("name").value,default:!t}),t=!0)});let n={header:this.translate.instant("CLUSTER.MSG_NODE_SELECT.HEADER"),helpText:this.translate.instant("CLUSTER.MSG_NODE_SELECT.TEXT"),modal:!0,formControls:[{name:"nodeId",label:this.translate.instant("CLUSTER.MSG_CLUSTER_EDITION.NODE_NAME"),type:"select",options:i,required:!0}],onAccept:o=>{o&&this.nodeAutoDiscoverInterfaces(o.nodeId)}};this.inputDataService.setInputData(n)}nodeAutoDiscoverInterfaces(e,i){let t=this.formModel.get("fwnodes");if(!t||e<0||e>=t.length||!this.interfacesIpObjs)return;let n=t.at(e).value,o="",r=this.interfacesIpObjs.get(n.firewallUUID),p=n.install_ipobj,s=n.install_communication||"agent";if(p){let h=r.find(E=>E.id===p);h&&(o=h.address)}let f={header:this.translate.instant("COMPILE.INST_SSH_GEN"),helpText:this.translate.instant("IF_EDITOR.TREE.INST_SSH_TEXT"),modal:!0,formControls:[{name:"nodeId",value:e,type:"hidden"},{name:"install_communication",value:s,type:"hidden"},{name:"name",label:this.translate.instant("CLUSTER.MSG_CLUSTER_EDITION.NODE_NAME"),type:"text",readonly:!0,halfSized:!0,value:n.name},{name:"firewallUUID",type:"hidden",value:n.firewallUUID},{name:"role",label:this.translate.instant("CLUSTER.MSG_CLUSTER_EDITION.ROLE"),type:"select",halfSized:!0,options:[{id:null,text:this.translate.instant("CLUSTER.CLUSTER_NODE_ROLES.NO_ROLE"),default:!0},{id:"M",text:this.translate.instant("CLUSTER.CLUSTER_NODE_ROLES.MASTER")},{id:"S",text:this.translate.instant("CLUSTER.CLUSTER_NODE_ROLES.SLAVE")},{id:"N",text:this.translate.instant("CLUSTER.CLUSTER_NODE_ROLES.NODE")}],value:i?i.role:null},{name:"address",label:this.translate.instant("ITEM_PANEL.FIELDS.ADDRESS"),regexp:ye.ipV4Regexp,type:"text",required:!0,value:i?i.address:o,setFocus:!0},{name:"",label:"",type:"separator"},{name:"install_port",label:this.translate.instant("CLUSTER.MSG_CLUSTER_EDITION.PORT"),regexp:ye.portRegexp,type:"number",required:!0,value:i?i.install_port:n.install_port},{name:"",label:"",type:"separator"}],onAccept:this.doDiscoverInterfaces.bind(this)};s==="ssh"?f.formControls.push({name:"install_user",label:this.translate.instant("CLUSTER.MSG_CLUSTER_EDITION.SSH_USER"),type:"text",required:!0,value:i?i.install_user:n.install_user},{name:"",label:"",type:"separator"},{name:"install_pass",label:this.translate.instant("CLUSTER.MSG_CLUSTER_EDITION.SSH_PASS"),type:"password",required:!0,value:i?i.install_pass:n.install_pass}):f.formControls.push({name:"install_protocol",label:this.translate.instant("FW.MSG_FW_EDITION.AGENT_PROTOCOL"),type:"select",required:!0,value:i?i.install_protocol:n.install_protocol,options:[{id:"https",text:"HTTPS"},{id:"http",text:"HTTP"}]},{name:"",label:"",type:"separator"},{name:"install_apikey",label:this.translate.instant("FW.MSG_FW_EDITION.AGENT_APIKEY"),type:"password",required:!0,value:i?i.install_apikey:n.install_apikey}),this.inputDataService.setInputData(f)}doDiscoverInterfaces(e){return Z(this,null,function*(){if(e){let i=this.fwcUserService.getActualFwcUser().publicKey,t={fwcloud:this.fwcUserService.getActualFwSelectedCloud(),ip:e.address,port:+e.install_port,communication:e.install_communication};if(e.install_communication==="ssh"){let s=e.install_user,f=e.install_pass;s&&(s=yield this.utilService.openPGPEncrypt(s,i)),f&&(f=yield this.utilService.openPGPEncrypt(f,i)),t.sshuser=s,t.sshpass=f}else{let s=e.install_apikey;s&&(s.startsWith("-")||(s=yield this.utilService.openPGPEncrypt(s,i))),t.apikey=s,t.protocol=e.install_protocol}let n=[],o=this.formModel.get("fwnodes"),r;for(let s=0;s<o.length;s++){let f=o.at(s),h=f.value,E;if(this.discoveredInstallOptions){let I=this.discoveredInstallOptions.get(h.firewallUUID);I&&I.ipobj&&(E=I.ipobj.address)}h.firewallUUID&&h.firewallUUID===e.firewallUUID&&(r=f,E=e.address);let b=this.getInterfaceAndAddressByUUID(h.firewallUUID,h.installInterfaceUUID,h.installIpObjUUID);n.push({firewallUUID:h.firewallUUID,firewall_name:h.name,firewall:h.id,cluster:h.cluster,installOptions:{firewallUUID:h.firewallUUID,interface:b.interfaceInfo,ipobj:b.ipObjInfo}})}if(!r)return;e.install_communication==="ssh"?r.get("install_user").value!==e.install_user&&(r.get("install_user").setValue(e.install_user),r.markAsDirty()):(r.get("install_protocol").value!==e.install_protocol&&(r.get("install_protocol").setValue(e.install_protocol),r.markAsDirty()),r.get("install_apikey").value!==e.install_apikey&&(r.get("install_apikey").setValue(e.install_apikey),r.markAsDirty()));let p=e.role;p==="N"&&(p=r.get("name").value),this.loadingData=!0,this.loadingCommunication=!0,this.communicationSubscription=this.utilService.fwcAPICallObservable(this.fwcFirewallService.autoDiscoverInterfaces.bind(this.fwcFirewallService),t).subscribe({next:s=>{if(Array.isArray(s.data)){let f=s.data;Array.isArray(f)&&f.length&&(p&&(f=f.map(h=>(h.suffixToAdd=p,h))),this.interfacesEditorOptions={isCluster:!0,firewalls:n,discoveredFirewallUUID:r.get("firewallUUID").value,discoveredAddress:e.address,discoveredIfs:f,existingIfs:this.interfaces},this.formModel.markAsDirty(),this.shownPanel=1,this.recenterDialog())}this.loadingData=!1,this.loadingCommunication=!1},error:s=>Z(this,null,function*(){if(s.error.fwcErr==9e3)this.confirmationService.confirm({header:this.translate.instant("GLOBALS.MSG_OP_RESULT.ERROR"),icon:"fa fa-exclamation-circle fwcRed iconBig",message:this.translate.instant("API_ERROR.SSH_FORBIDDEN"),rejectVisible:!1,acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.OK")});else{let f;s&&(f=this.utilService.isCommunicationError(s.error)),this.confirmationService.confirm({header:"Error",icon:"fa fa-exclamation-circle fwcRed iconBig",acceptLabel:"Ok",rejectVisible:!1,message:this.translate.instant("FW.MSG_FW_EDITION.ERROR_DISCOVER")+(f?":<br/>"+f:""),accept:()=>{if(f)return this.nodeAutoDiscoverInterfaces(e.nodeId,e)}})}this.loadingData=!1,this.loadingCommunication=!1})})}})}onEditorInstallModified(e){if(e){let i=this.formModel.get("fwnodes"),t,n;for(let o=0;o<i.length;o++){let r=i.at(o),p=r.value;e.interface&&p.installInterfaceUUID===e.interface.interfaceUUID&&e.ipobj&&p.installIpObjUUID===e.ipobj.ipObjUUID&&(r.get("install_interface").setValue(null),r.get("install_ipobj").setValue(null),r.get("installInterfaceUUID").setValue(null),r.get("installIpObjUUID").setValue(null),this.discoveredInstallOptions.delete(p.firewallUUID),this.onInterfaceChange(o,null,null,!1),r.markAsTouched(),this.interfacesIpObjs.delete(r.get("firewallUUID").value)),p.firewallUUID&&p.firewallUUID===e.firewallUUID&&(t=r,n=o)}if(t){if(!e.interface&&!e.ipobj)t.get("install_interface").setValue(null),t.get("install_ipobj").setValue(null),t.get("installInterfaceUUID").setValue(null),t.get("installIpObjUUID").setValue(null),this.discoveredInstallOptions.delete(e.firewallUUID);else{let o=e.interface.id,r=e.ipobj.id;if(o&&r)this.discoveredInstallOptions.delete(e.firewallUUID),t.get("install_interface").setValue(o),t.get("install_ipobj").setValue(r),t.get("installInterfaceUUID").setValue(e.interface.interfaceUUID),t.get("installIpObjUUID").setValue(e.ipobj.ipObjUUID),this.onInterfaceChange(n,o,r,!1);else{let p={interface:e.interface,ipobj:e.ipobj};this.discoveredInstallOptions.set(e.firewallUUID,p)}}t.markAsTouched(),this.formModel.markAsDirty()}}}onEditorInterfaceOrIpModified(e){e&&e.installFirewallUUIDs&&e.installFirewallUUIDs.forEach(i=>{if(e.id&&Array.isArray(this.interfaces)){let t=!1;for(let n=0;n<this.interfaces.length&&!t;n++){let o=this.interfaces[n];if(e.id===o.id&&e.type===o.type&&(o.name=e.name,t=!0),Array.isArray(o.ipobjs))for(let r=0;r<o.ipobjs.length&&!t;r++){let p=o.ipobjs[r];e.id===p.id&&e.type===p.type&&(p.name=e.name,p.address=e.address,t=!0)}}}else if(this.discoveredInstallOptions){let t=this.discoveredInstallOptions.get(i);t&&(e.type===v.OBJ_INTERFACE_FIREWALL?t.interface.name=e.name:(t.ipobj.name=e.name,t.ipobj.address=e.address))}this.formModel.markAsDirty()})}changeCompilerOptions(){let e=this.formModel.get("compiler").value,i=this.formModel.get("options").value,t=e<<12,n=i&4095;this.formModel.get("options").setValue(t|n)}checkClusterRestrictions(e){e&&(this.loadingData=!0,this.clusterToDelete=e,this.dependencies=null,this.deleteMsgError=null,this.delMessage={type:"loading",title:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.CHECKING_HEAD"),text:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.CHECKING_TEXT")},this.okToDelete=!1,this.fwcFirewallService.getClusterMasterNode(e.id_obj,this.fwcUserService.getActualFwSelectedCloud()).subscribe(i=>{i.error?(this.deleteMsgError={type:"error",title:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.ERROR_RES_HEAD"),text:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.ERROR_RES_TEXT",{error:this.fwcErrorPipe.transform(i.error)})},this.dependencies={restrictionsError:!0},this.loadingData=!1):(e.masterFwId=i.data.id,this.fwcFirewallService.checkClusterRestrictions(e.masterFwId,this.fwcUserService.getActualFwSelectedCloud()).subscribe(t=>{this.deleteMsgError={type:"warning",title:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.DEL_2"),text:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.DEL_3",{name:e._fwcObjName})},this.dependencies=null,this.loadingData=!1,this.recenterDialog()},t=>{if(t.error&&t.error.restrictions)try{this.dependencies=t.error.restrictions,this.dependencies._fwcRestrictedObject={_fwcObjId:e.masterFwId,_fwcObjType:v.OBJ_CLUSTER},this.deleteMsgError={type:"error",title:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.DEL_0"),text:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.DEL_1",{name:e._fwcObjName})}}catch(n){this.dependencies={restrictionsError:!0},this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:n})}else this.deleteMsgError={type:"error",title:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.ERROR_RES_HEAD"),text:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.ERROR_DEL_TEXT",{error:this.fwcErrorPipe.transform(t)})},this.dependencies={restrictionsError:!0};this.loadingData=!1,this.recenterDialog()}))},i=>{this.loadingData=!1,this.deleteMsgError={type:"error",title:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.ERROR_RES_HEAD"),text:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.ERROR_RES_TEXT",{error:this.fwcErrorPipe.transform(i)})},this.dependencies={restrictionsError:!0},this.recenterDialog()}))}onShowDialog(){this.itemSelectedService.getActualItem().ngfw?this.shownPanel=4:this.itemSelectedService.getActualItem().plugins?this.shownPanel=3:(this.shownPanel=0,setTimeout(()=>{this.inputClusterName&&this.inputClusterName.nativeElement.focus()},150));let e=this.itemSelectedService.getActualItem();delete e.ngfw,delete e.plugins,this.itemSelectedService.setItem(e)}onChangeTab(e){this.fwcInterfacesEditor&&this.fwcInterfacesEditor.hideFirewallSelector(),this.shownPanel=e.index}onHideDialog(){}onCancel(e){!e&&this.formModel&&!this.formModel.pristine&&this.formModel.valid?this.confirmationService.confirm({header:this.translate.instant("GLOBALS.MSG_CONFIRM"),icon:"fa fa-question-circle fwcBlue iconBig",message:this.translate.instant("CLUSTER.MSG_CLUSTER_CONFIRM"),accept:()=>{this.onCancel(!0)},rejectVisible:!0,rejectLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.NO"),acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.YES")}):(this.hideDialog(),this.resetProperties()),this.shownPanel=0}checkForm(e){e&&e.target&&e.target.type!="textarea"&&this.formModel.valid&&(e.target.blur(),this.onSave())}onSave(e=!1){return Z(this,null,function*(){if(!e&&this.fwcInterfacesEditor&&!this.fwcInterfacesEditor.isThereAnySelectedNode()){this.confirmationService.confirm({header:this.translate.instant("IF_EDITOR.TREE.MSG_NO_SELECTED.TITLE"),icon:"fa fa-question-circle fwcBlue iconBig",message:this.translate.instant("IF_EDITOR.TREE.MSG_NO_SELECTED.TEXT",{obj_name:this.translate.instant("GLOBALS.MSG_OBJ_TYPES.CLUSTER").toLowerCase()}),accept:()=>{this.onSave(!0)},rejectVisible:!0,rejectLabel:"No",acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.YES")});return}let i,t;this.formModel.get("fwnodes").at(0).get("fwmaster").setValue(1);let o=ot(this.cluster),r=this.formModel.value;this.cluster.id===null||this.cluster.id===void 0?(i=this.fwcFirewallService.newCluster.bind(this.fwcFirewallService),t=this.translate.instant("CLUSTER.MSG_CLUSTER_NEW")):(i=this.fwcFirewallService.updateCluster.bind(this.fwcFirewallService),t=this.translate.instant("CLUSTER.MSG_CLUSTER_UPDATE_1",{name:this.cluster.name}),r={cluster:o.id,name:r.name,comment:r.comment,options:r.options,plugins:r.plugins}),delete r.compiler;let p=this.fwcUserService.getActualFwSelectedCloud(),s=r.node_id;if(delete r.node_id,r=ot(r),Array.isArray(r.fwnodes)){let f=this.fwcUserService.getActualFwcUser().publicKey;r.fwnodes=r.fwnodes.splice(0);for(let h=0;h<r.fwnodes.length;h++){let E=r.fwnodes[h];delete E.firewallUUID,delete E.installInterfaceUUID,delete E.installIpObjUUID;let b=E.install_user,I=E.install_pass;b&&(b=yield this.utilService.openPGPEncrypt(b,f)),I&&(I=yield this.utilService.openPGPEncrypt(I,f)),E.install_user=b,E.install_pass=I,E.install_apikey?E.install_apikey.startsWith("-")||(E.install_apikey=yield this.utilService.openPGPEncrypt(E.install_apikey,f)):E.install_apikey=null}}this.loadingData=!0,this.utilService.fwcAPICall(i,r,p,s).then(f=>{if(o._fwcObjType=v.OBJ_CLUSTER,o.container=it.C_FIREWALLS,o._fwcTreeAction=Ne.NEW_ITEM,this.cluster.id===null||this.cluster.id===void 0){let h=f.data.insertId;o.id=o.id_obj=o._fwcObjId=h,this.processInterfacesOperations(h,f.data).then(E=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:t})}).catch(E=>{this.confirmationService.confirm({icon:"fa fa-exclamation-circle fwcRed iconBig",header:this.translate.instant("CLUSTER.MSG_CLUSTER_BATCH.ERR_CREATING_IFS"),message:E.message,accept:()=>{},acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.OK"),rejectVisible:!1})}).finally(()=>{this.itemSelectedService.setModifiedItem(o),this.hideDialog(),this.resetProperties(),this.loadingData=!1})}else this.updateNodesAsync().then(h=>{o.id=o.id_obj=o._fwcObjId=this.cluster.id,o._fwcTreeAction=Ne.NEW_ITEM,o.container=it.C_FIREWALLS,this.processInterfacesOperations(o.id).then(E=>{this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:t})}).catch(E=>{this.confirmationService.confirm({icon:"fa fa-exclamation-circle fwcRed iconBig",header:this.translate.instant("CLUSTER.MSG_CLUSTER_BATCH.ERR_CREATING_IFS"),message:E.message,accept:()=>{},acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.OK"),rejectVisible:!1})}).finally(()=>{this.itemSelectedService.setModifiedItem(o);let E=this.fwcPolicyService.getActualSelectedPolicy();E._fwcFwId!==null&&E._fwcFwId!==void 0&&(E._fwcClusterId==o.id&&(E._fwcFwName=o.name,E._dontLocateInTree=!0),this.fwcPolicyService.setSelectedPolicy(E),this.fwcPolicyService.reloadPolicy()),this.hideDialog(),this.resetProperties(),this.loadingData=!1})},h=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:this.translate.instant("CLUSTER.MSG_CLUSTER_UPDATE_ERR"),detail:h}),this.loadingData=!1})}).catch(f=>{f.status==400&&f.error.fwcErr==8002?(this.confirmationService.confirm({header:this.translate.instant("GLOBALS.MSG_OP_RESULT.ERROR"),icon:"fa fa-exclamation-circle fwcRed iconBig",message:this.translate.instant("API_ERROR."+f.error.fwcErr),rejectVisible:!1,acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.OK"),accept:()=>{}}),this.loadingData=!1):f.status==400&&f.error.fwcErr==8003?(this.confirmationService.confirm({header:this.translate.instant("GLOBALS.MSG_OP_RESULT.ERROR"),icon:"fa fa-exclamation-circle fwcRed iconBig",message:this.translate.instant("API_ERROR."+f.error.fwcErr),rejectVisible:!1,acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.OK"),accept:()=>{}}),this.loadingData=!1):(this.loadingData=!1,this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(f)}))})})}processInterfacesOperations(e,i){return new Promise((t,n)=>Z(this,null,function*(){try{if(this.fwcInterfacesEditor&&this.fwcInterfacesEditor.areTherePendingOperations()){let o=this.fwcInterfacesEditor.getSelectedTreeNodes();i&&i.loData&&this.fwcInterfacesEditor.setNewLoIds(i);let[r,p]=yield Promise.all([this.utilService.fwcAPICall(this.fwcFirewallService.getCluster.bind(this.fwcFirewallService),e,this.fwcUserService.getActualFwSelectedCloud()),this.utilService.fwcAPICall(this.fwcObjectTreeService.getTree.bind(this.fwcObjectTreeService),this.appOptionsService.optionsTreeFw,this.fwcUserService.getActualFwSelectedCloud())]),s=r.data,f;if(s&&Array.isArray(s.nodes)&&(f=s.nodes),!f||!f.length)return n(new Error(this.translate.instant("CLUSTER.MSG_CLUSTER_BATCH.ERR_EMPTY_CLUSTER")));let h=this.formModel.get("fwnodes").value,E,b=this.fwcUserService.getActualFwcUser().publicKey;for(let G=0;G<f.length;G++){let D=f[G],K=h.find(B=>B.name===D.name);if(K){D.firewallUUID=K.firewallUUID;let B=K.install_user,te=K.install_pass,he=K.install_apikey;B&&(D.install_user=yield this.utilService.openPGPEncrypt(B,b)),te&&(D.install_pass=yield this.utilService.openPGPEncrypt(te,b)),he&&(he.startsWith("-")?D.install_apikey=he:D.install_apikey=yield this.utilService.openPGPEncrypt(he,b))}else return n(new Error(this.translate.instant("CLUSTER.MSG_CLUSTER_BATCH.ERR_MISSING_NODE")));D.fwmaster&&(E=D.id),D.plugins=this.formModel.controls.plugins.value}let I=p.data,R=[];R.push(I);let V=this.fwcObjectTreeService.getNodesFull(R,X.OBJ_CLUSTER,e);if(V&&Array.isArray(V.items)){let G=V.items.find(D=>D.node_type===X.FOLDER_INTERFACES);if(G){let D={parentObject:{fwcloud:this.fwcUserService.getActualFwSelectedCloud(),name:V.text,type:v.OBJ_FIREWALL,id:E,id_node:G.id},objectTreeNodes:o,onClose:B=>Z(this,null,function*(){let te=!1,he=new Map;if(B.forEach(Ce=>{if(Ce.operationStatus===Ti.SUCCESS&&Ce.operationResult&&Ce.object.installFirewallUUIDs){let Ge;Ce.object.type===v.OBJ_INTERFACE_FIREWALL?Ge={install_interface:Ce.operationResult.insertId}:Ce.object.type===v.OBJ_ADDRESS&&(Ge={install_ipobj:Ce.operationResult.insertId}),Ce.object.installFirewallUUIDs&&Ce.object.installFirewallUUIDs.forEach(Pt=>{let vt=he.get(Pt);Ge=ci(ci({},vt),Ge),he.set(Pt,Ge)})}Ce.operationStatus===Ti.ERROR&&(te=!0)}),te)return n(new Error(this.translate.instant("CLUSTER.MSG_CLUSTER_BATCH.ERR_IFS_OPERATIONS")));{let Ce;if(he.size)for(let[Ge,Pt]of he){let vt=f.find(Gt=>Gt.firewallUUID===Ge);if(vt){Ce=new En(vt),Ce.fwcloud=this.fwcUserService.getActualFwSelectedCloud(),Ce.firewall=vt.id,Ce.install_interface=Pt.install_interface,Ce.install_ipobj=Pt.install_ipobj;try{let Gt=Ce.getValue(),Bn=yield this.utilService.fwcAPICall(this.fwcFirewallService.updateFirewall.bind(this.fwcFirewallService),Gt)}catch{return n(new Error(this.translate.instant("CLUSTER.MSG_CLUSTER_BATCH.ERR_UPDATING_INST",{name:vt.name})))}}else return n(new Error(this.translate.instant("CLUSTER.MSG_CLUSTER_BATCH.ERR_UPDATING_INST_MISSING")))}}t()})},K={uuid:ee.ITEM_BATCH_MANAGER,data:D};this.appDialogPanelsService.searchAndShowDialog(K)}else return n(new Error(this.translate.instant("CLUSTER.MSG_CLUSTER_BATCH.ERR_NO_IFS_NODE")))}else return n(new Error(this.translate.instant("CLUSTER.MSG_CLUSTER_BATCH.ERR_MISSING_CLUSTER_NODE")))}else t()}catch{n(new Error(this.translate.instant("CLUSTER.MSG_CLUSTER_BATCH.ERR_UNKNOWN")))}}))}updateOrSaveNode(e){let i,t="";return new Promise((o,r)=>{let p=Object.assign({},e),s;p.options=this.formModel.controls.options.value,p.plugins=this.formModel.controls.plugins.value,e.id===null||e.id===void 0?(p.node_id=this.cluster.nodesParentId,i=this.translate.instant("CLUSTER.MSG_CLUSTER_NODES.CN_0"),s=this.fwcFirewallService.newFirewall.bind(this.fwcFirewallService)):(p.firewall=p.id,delete p.id,i=this.translate.instant("CLUSTER.MSG_CLUSTER_NODES.CN_1"),s=this.fwcFirewallService.updateFirewall.bind(this.fwcFirewallService)),p.fwcloud=this.fwcUserService.getActualFwSelectedCloud(),p.install_interface=+p.install_interface||p.install_interface,p.install_ipobj=+p.install_ipobj||p.install_ipobj,delete p.firewallUUID,delete p.installInterfaceUUID,delete p.installIpObjUUID,p.install_communication==="ssh"?(p.install_protocol=null,p.install_apikey=null):(delete p.install_user,delete p.install_pass),this.utilService.fwcAPICall(s,p).then(f=>{t=this.translate.instant("CLUSTER.MSG_CLUSTER_NODES.CN_3",{name:e.name}),f.response=t,o(f)}).catch(f=>{if(f.status==400&&f.error.fwcErr==8003)this.confirmationService.confirm({header:this.translate.instant("GLOBALS.MSG_OP_RESULT.ERROR"),icon:"fa fa-exclamation-circle fwcRed iconBig",message:this.translate.instant("API_ERROR."+f.error.fwcErr),rejectVisible:!1,acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.OK"),accept:()=>{}}),this.loadingData=!1;else{let h="";h=this.fwcErrorPipe.transform(f),t=this.translate.instant("CLUSTER.MSG_CLUSTER_NODES.CN_2",{action:i,name:e.name,err_code:"",err_msg:h}),f.error=h,r(f)}})})}updateNodesAsync(){return new Promise((i,t)=>Z(this,null,function*(){let n={opResult:!0,opResults:[]},o=this.formModel.get("fwnodes"),r=this.fwcUserService.getActualFwcUser().publicKey;for(let p=0;p<o.length;p++){let s=o.at(p);if(s.touched){let f=s.value,h=s.get("install_user").value,E=s.get("install_pass").value,b=s.get("install_apikey").value;h&&(f.install_user=yield this.utilService.openPGPEncrypt(h,r)),E&&(f.install_pass=yield this.utilService.openPGPEncrypt(E,r)),b&&(b.startsWith("-")?f.install_apikey=b:f.install_apikey=yield this.utilService.openPGPEncrypt(b,r)),yield this.updateOrSaveNode(f).then(I=>{n.opResults.push(I)},I=>(n.opResult=!1,n.opResults.push(I),t(n)))}}i(n)}))}onDeleteCluster(){this.okToDelete&&this.clusterToDelete&&(this.loadingData=!0,this.deleteMsgError=null,this.delMessage={type:"loading",title:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.DELETING_HEAD"),text:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.DELETING_TEXT")},this.utilService.fwcAPICall(this.fwcFirewallService.deleteCluster.bind(this.fwcFirewallService),this.clusterToDelete.id_obj,this.fwcUserService.getActualFwSelectedCloud()).then(e=>{let i=this.clusterToDelete,t={_fwcFwId:null,fwId:null},n=this.fwcPolicyService.getActualSelectedPolicy();this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.DEL_4")}),i._fwcTreeAction=Ne.DELETE_ITEM,this.itemSelectedService.setModifiedItem(i),this.itemSelectedService.setModifiedItem({_fwcTreeAction:Ne.RELOAD_TREE,containerToReload:it.C_OBJECTS}),n&&n._fwcClusterId==this.clusterToDelete.id_obj&&this.fwcPolicyService.setSelectedPolicy(t),this.loadingData=!1,this.hideDialog(),this.resetProperties()}).catch(e=>{this.deleteMsgError={type:"error",title:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.ERROR_RES_HEAD"),text:this.translate.instant("CLUSTER.MSG_CLUSTER_DELETE.ERROR_RES_TEXT",{error:this.fwcErrorPipe.transform(e)})},this.dependencies={restrictionsError:!0},this.loadingData=!1}))}setNode(e){let i=e.split(",");i[0]!=""?this.fwcFirewallService.getFirewall(+i[0],this.fwcUserService.getActualFwSelectedCloud()).subscribe(t=>{this.nodeNGFW=t.data}):this.nodeNGFW=this.getFormNodes().value.find(t=>t.name===i[1])}checksNtopNGActive(){return!!(this.cluster.plugins&mt.get(ct.ntopng))}checksNodeNtopNGConfig(){let e=this.formModel.controls.fwnodes.value;if(this.nodeNGFW&&e.find(t=>t.name===this.nodeNGFW.name)){let t=e.find(n=>n.name===this.nodeNGFW.name);if(this.nodeNGFW=t,t.install_ipobj)return t.install_ipobj&&!!(this.nodeNGFW.plugins&mt.get(ct.ntopng));if(this.discoveredInstallOptions.get(t.firewallUUID))return this.checksNtopNGActive()}let i=this.nodeNGFW?this.nodeNGFW.firewallUUID:e[0]?e[0].firewallUUID:void 0;return i&&this.discoveredInstallOptions.get(i)?(this.nodeNGFW=e.find(t=>t.firewallUUID===i),this.checksNtopNGActive()):!1}checksWebSafetyProxyActie(){return!!(this.cluster.plugins&mt.get(ct.websafety))}checksNodeWebSafetyProxyActie(){let e=this.formModel.controls.fwnodes.value;if(this.nodeNGFW&&e.find(t=>t.name===this.nodeNGFW.name)){let t=e.find(n=>n.name===this.nodeNGFW.name);if(this.nodeNGFW=t,t.install_ipobj)return t.install_ipobj&&!!(this.nodeNGFW.plugins&mt.get(ct.websafety));if(this.discoveredInstallOptions.get(t.firewallUUID))return this.checksWebSafetyProxyActie()}let i=this.nodeNGFW?this.nodeNGFW.firewallUUID:e[0]?e[0].firewallUUID:void 0;return i&&this.discoveredInstallOptions.get(i)?(this.nodeNGFW=e.find(t=>t.firewallUUID===i),this.checksWebSafetyProxyActie()):!1}checksDNSSafetyActive(){return!!(this.cluster.plugins&mt.get(ct.dnssafety))}checksNodeDNSSafetyActive(){let e=this.formModel.controls.fwnodes.value;if(this.nodeNGFW&&e.find(t=>t.name===this.nodeNGFW.name)){let t=e.find(n=>n.name===this.nodeNGFW.name);if(this.nodeNGFW=t,t.install_ipobj)return t.install_ipobj&&!!(this.nodeNGFW.plugins&mt.get(ct.dnssafety));if(this.discoveredInstallOptions.get(t.firewallUUID))return this.checksDNSSafetyActive()}let i=this.nodeNGFW?this.nodeNGFW.firewallUUID:e[0]?e[0].firewallUUID:void 0;return i&&this.discoveredInstallOptions.get(i)?(this.nodeNGFW=e.find(t=>t.firewallUUID===i),this.checksDNSSafetyActive()):!1}checksElasticSearchActive(){return!!(this.cluster.plugins&mt.get(ct.elasticsearch))}checksNodeElasticSearchActive(){let e=this.formModel.controls.fwnodes.value;if(this.nodeNGFW&&e.find(t=>t.name===this.nodeNGFW.name)){let t=e.find(n=>n.name===this.nodeNGFW.name);if(this.nodeNGFW=t,t.install_ipobj)return t.install_ipobj&&!!(this.nodeNGFW.plugins&mt.get(ct.elasticsearch));if(this.discoveredInstallOptions.get(t.firewallUUID))return this.checksElasticSearchActive()}let i=this.nodeNGFW?this.nodeNGFW.firewallUUID:e[0]?e[0].firewallUUID:void 0;return i&&this.discoveredInstallOptions.get(i)?(this.nodeNGFW=e.find(t=>t.firewallUUID===i),this.checksElasticSearchActive()):!1}onClickButtonNGFW(e,i){let t,n=this.discoveredInstallOptions.get(this.getFormNodes().value.find(o=>o.name===this.nodeNGFW.name).firewallUUID)?this.discoveredInstallOptions.get(this.getFormNodes().value.find(o=>o.name===this.nodeNGFW.name).firewallUUID).ipobj.address:this.interfacesIpObjs.get(this.getFormNodes().value.find(o=>o.name===this.nodeNGFW.name).firewallUUID).filter(o=>o.id==this.getFormNodes().value.find(r=>r.name===this.nodeNGFW.name).install_ipobj)[0].address;switch(e){case"NTOPNG":t="http://"+n+":3000";break;case"WEBSAFETYPROXY":t="https://"+n+":8095";break;case"DNSSAFETY":t="https://"+n+":8096";break;case"ELASTICSEARCH":t="http://"+n+":5601";break}try{window.open(t)}catch(o){this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(o)})}}onCloseDialog(){this.communicationSubscription&&(this.communicationSubscription.unsubscribe(),this.communicationSubscription=null,this.loadingData=!1,this.loadingCommunication=!1)}static{this.\u0275fac=function(i){return new(i||l)(F(se),F(De),F(oe),F(We),F(Ie),F(cn),F(gt),F(de),F(Xt),F(we),F(At),F(_e),F(ue),F(Ct),F(ie),F(ce),F(pe),F(Ft))}}static{this.\u0275cmp=Le({type:l,selectors:[["sts-fwc-cluster-panel"]],viewQuery:function(i,t){if(i&1&&(Se(Hc,5),Se(Yc,5),Se(Jc,5)),i&2){let n;le(n=re())&&(t.inputClusterName=n.first),le(n=re())&&(t.fwcInterfacesEditor=n.first),le(n=re())&&(t.nodeInputs=n)}},features:[$e([oe,cn,We]),Rt],decls:6,vars:9,consts:[["clusterDialog",""],["inputClusterName",""],["ifSelect",""],["fwcInterfacesEditor",""],["nodeInput",""],["styleClass","dlgFwcDialog",3,"visibleChange","onShow","onHide","visible","modal","closable","resizable"],["pTemplate","header"],["id","clusterData",3,"formGroup"],["pTemplate","footer"],[1,"divFormHeader"],[1,"divHeaderButtons"],["pButton","","type","button","icon","fa fa-question",1,"p-button-primary",3,"disabled"],["pButton","","type","button","icon","fa fa-window-minimize",1,"p-button-secondary",3,"click","disabled"],[1,"fwcWhite","fwcIconLeft"],[1,"fwcMenuIcon","fwci-cluster","fwcOrange"],[1,"fwcMenuIcon","fwci-delete","fwcOrange"],["pButton","","type","button","icon","fa fa-question",1,"p-button-primary",3,"click","disabled"],["id","clusterData",3,"keyup.enter","keyup.esc","formGroup"],[3,"onChange","activeIndex"],["leftIcon","fwci-cluster",3,"header","selected","disabled"],[1,"grid"],[1,"col-12"],[1,"noVertPad","fwcBlue","botBorder"],[1,"col-6"],[1,"p-inputgroup"],["for","name"],["type","text","maxlength","64","pInputText","","formControlName","name","name","name",3,"placeholder"],[1,"fwc-error",3,"ngStyle"],["for","compiler"],["formControlName","compiler","name","compiler",3,"change"],[3,"ngValue"],[1,"col-2"],["for","comment"],[1,"col-10"],["maxlength","255","pInputTextarea","","formControlName","comment","name","comment",3,"rows"],["formArrayName","fwnodes",1,"grid"],[1,"fwcBlue"],[1,"col-12","grid","grid-nogutter",3,"ngStyle","formGroupName"],["leftIcon","fwci-interfaces",3,"header","disabled"],[3,"onInstallModified","onIpObjectModified","onStartAutodiscover","options"],["leftIcon","fwci-config",3,"header","disabled"],["type","hidden","formControlName","options","name","options"],[1,"col-12","noVertPad"],[3,"ngModelChange","onChange","binary","ngModel","ngModelOptions","label"],[3,"ngModelChange","onChange","binary","ngModel","ngModelOptions"],["href","https://www.docker.com","target","_blank"],["height","20","width","20","src","assets/img/docker.png"],["target","_blank",2,"margin-left","8px","margin-top","2px",3,"href"],["href","https://crowdsec.net/","target","_blank"],["width","20","height","20","src","assets/img/crowdsec.png"],["href","https://www.fail2ban.org","target","_blank"],["width","20","height","20","src","assets/img/fail2ban.png"],["leftIcon","fa fa-puzzle-piece fwcOrange",3,"header","disabled"],["type","hidden","formControlName","plugins","name","plugins"],["leftIcon","fa fa-n fwcOrange",3,"header","disabled"],[3,"ngClass"],[1,"p-inputgroup",2,"padding-right","13px"],["pButton","","type","button","tooltipPosition","top","showDelay","500",1,"p-button-primary","fwcButtonHeight",3,"click","icon","disabled","pTooltip"],["formControlName","name","maxlength","64","type","text","pInputText","",3,"change","id","placeholder"],[1,"fwc-error"],["formControlName","install_port","type","number","pInputText","","min","1",2,"min-width","1rem !important",3,"placeholder"],["tooltipPosition","bottom","showDelay","500","pButton","","type","button","icon","fa fa-plug",1,"p-button-primary","fwcButtonHeight",3,"disabled","pTooltip"],["tooltipPosition","bottom","showDelay","500","pButton","","type","button","icon","fa fa-info-circle",1,"p-button-primary","fwcButtonHeight",3,"disabled","pTooltip"],["tooltipPosition","bottom","showDelay","500","pButton","","type","button","icon","pi pi-minus",1,"p-button-danger","fwcButtonHeight",3,"disabled","pTooltip"],["pButton","","type","button","icon","fa fa-plus","tooltipPosition","bottom","showDelay","500",1,"p-button-primary","fwcButtonHeight",3,"disabled","pTooltip"],["pButton","","type","button","icon","fa fa-search-plus","tooltipPosition","bottom","showDelay","500",1,"p-button-primary","fwcButtonHeight",3,"click","disabled","pTooltip"],[1,"col-1"],["formControlName","install_protocol","name","install_protocol",1,"selNoMargin",3,"change"],["disabled","",3,"value"],["value","https"],["value","http"],[1,"col-3"],["formControlName","install_apikey","name","install_apikey","pPassword","","maxlength","64",3,"showPassword","placeholder","feedback"],["pButton","","type","button","icon","fa fa-eye",1,"p-button-secondary",3,"mousedown","mouseup","mouseout"],[2,"padding-right","13px",3,"ngClass"],["formControlName","install_user","maxlength","32","type","text","pInputText","",3,"id","placeholder"],["formControlName","install_pass","pPassword","","maxlength","64",3,"showPassword","placeholder","promptLabel","weakLabel","mediumLabel","strongLabel"],[1,"col-4","lg:col-2"],[1,"fa","fa-lg","fa-info-circle","fwcBlue",2,"margin-top","0.9rem",3,"pTooltip"],["type","text","pInputText","","readonly","",3,"value"],[1,"col-4","lg:col-2",2,"padding-right","13px"],["formControlName","install_interface",1,"selNoMargin",3,"change"],[3,"value"],["formControlName","install_ipobj",1,"selNoMargin",3,"change","name"],["tooltipPosition","bottom","showDelay","500","pButton","","type","button","icon","fa fa-plug",1,"p-button-primary","fwcButtonHeight",3,"click","disabled","pTooltip"],["tooltipPosition","bottom","showDelay","500","pButton","","type","button","icon","fa fa-info-circle",1,"p-button-primary","fwcButtonHeight",3,"click","disabled","pTooltip"],["tooltipPosition","bottom","showDelay","500","pButton","","type","button","icon","pi pi-minus",1,"p-button-danger","fwcButtonHeight",3,"click","disabled","pTooltip"],["pButton","","type","button","icon","fa fa-plus","tooltipPosition","bottom","showDelay","500",1,"p-button-primary","fwcButtonHeight",3,"click","disabled","pTooltip"],[3,"message"],["href","https://www.openvpn.net/","target","_blank"],["width","20","height","20","src","assets/img/openvpn.png"],["href","https://github.com/acassen/keepalived","target","_blank"],["width","20","height","20","src","assets/img/keepalived.png"],["href","https://ipgeolocation.io/","target","_blank"],["width","20","height","20","src","assets/img/geoip.png"],["href","https://www.ntop.org/","target","_blank"],["width","20","height","20","src","assets/img/ntopng.png"],["href","https://www.diladele.com/","target","_blank"],["width","20","height","20","src","assets/img/websafety.png"],["href","https://dnssafety.diladele.com/","target","_blank"],["width","20","height","20","src","assets/img/dnssafety.png"],["href","https://www.isc.org/bind/","target","_blank"],["width","20","height","20","src","assets/img/isc-bind9.png"],["href","https://suricata.io/","target","_blank"],["width","20","height","20","src","assets/img/suricata.png"],["href","https://zeek.org/","target","_blank"],["width","20","height","20","src","assets/img/zeek.png"],["href","https://www.elastic.co/what-is/elasticsearch","target","_blank"],["width","20","height","20","src","assets/img/elasticsearch.png"],["href","https://www.elastic.co/what-is/kibana","target","_blank"],["width","20","height","20","src","assets/img/kibana.png"],["href","https://www.elastic.co/logstash/","target","_blank"],["width","20","height","20","src","assets/img/logstash.png"],["href","https://www.elastic.co/beats/filebeat","target","_blank"],["width","20","height","20","src","assets/img/filebeat.png"],["href","https://www.isc.org/dhcp/","target","_blank"],["width","20","height","20","src","assets/img/isc-dhcp.png"],["href","https://www.haproxy.org/","target","_blank"],["width","20","height","20","src","assets/img/ha-proxy.png"],["for","NTOPNG_BUTTON"],["width","40","height","40","src","assets/img/ntopng.png"],["type","button","pButton","","tooltipPosition","top","showDelay","500",1,"p-button-primary",2,"height","2.44rem","width","100%",3,"click","disabled","pTooltip","label"],["for","WEBSAFETYPROXY_BUTTON"],["width","40","height","40","src","assets/img/websafety.png"],["for","DNSSAFETY_BUTTON"],["width","40","height","40","src","assets/img/dnssafety.png"],["for","ELASTICSEARCH_BUTTON"],["width","40","height","40","src","assets/img/elasticsearch.png"],[1,"col-12","divCentered"],[1,"fwcRestrictionsContainer"],[3,"dependencies"],[3,"onHideParent","onRefreshRestrictions","dependencies"],["name","chkOkToDelete","binary","true",3,"ngModelChange","ngModel","label"],[1,"divLoadTemp",3,"ngStyle"],["type","button","pButton","","icon","fa fa-xmark",1,"p-button-danger",3,"label"],["type","button","pButton","","icon","pi pi-trash",1,"p-button-danger",3,"disabled","label"],["type","button","pButton","","icon","fa fa-save",1,"p-button-success",3,"disabled","label"],["type","button","pButton","","icon","pi pi-check",1,"p-button-primary",3,"disabled","label"],["type","button","pButton","","icon","fa fa-xmark",1,"p-button-danger",3,"click","label"],["type","button","pButton","","icon","pi pi-trash",1,"p-button-danger",3,"click","disabled","label"],["type","button","pButton","","icon","fa fa-save",1,"p-button-success",3,"click","disabled","label"],["type","button","pButton","","icon","pi pi-check",1,"p-button-primary",3,"click","disabled","label"],["type","button","pButton","","icon","fa fa-refresh",1,"fwc-left-float","p-button-primary",3,"disabled","label"],["type","button","pButton","","icon","fa fa-trash",1,"p-button-danger",3,"click","disabled","label"],["type","button","pButton","","icon","pi pi-check",1,"p-button-primary",3,"click","label"],["type","button","pButton","","icon","fa fa-refresh",1,"fwc-left-float","p-button-primary",3,"click","disabled","label"]],template:function(i,t){if(i&1){let n=L();c(0,"p-dialog",5,0),J("visibleChange",function(r){return w(n),Y(t.displayDialog,r)||(t.displayDialog=r),S(r)}),P("onShow",function(){return w(n),S(t.onShowDialog())})("onHide",function(){return w(n),S(t.onHideDialog())}),A(2,op,5,4,"ng-template",6)(3,Op,113,103,"form",7)(4,Dp,3,2)(5,Hp,2,2,"ng-template",8),u()}i&2&&(ke(W(8,Kc)),H("visible",t.displayDialog),m("modal",!0)("closable",!1)("resizable",!0),a(3),O(t.cluster?3:-1),a(),O(t.clusterToDelete?4:-1))},dependencies:[et,Vt,Si,Ei,vi,Ht,Yt,yi,ht,wi,Jt,Ii,wt,gi,Ci,Po,To,Ni,yn,Nt,Mt,Ue,lt,Lt,Qt,qt,Li,mn,Di,Mi,yt,nt],styles:[`.fwcGridVertPadding{padding-top:.3em!important;padding-bottom:.3em!important}textarea{resize:none}.btnEye .p-button-text{width:1.6em!important}.divLabelRight{float:right}.selNoMargin{margin:0!important}.p-inputgroup button.fwcButtonHeight{width:auto;padding:5px}sts-fwc-cluster-panel>p-dialog>div>div>div.ng-tns-c1623988549-21.p-dialog-content.ng-star-inserted{min-width:100%!important}
`],encapsulation:2})}}return l})();var Kp=["tbvItemTabview"],Xp=["inputObjName"],Qe=l=>({visibility:l}),zp=()=>({visibility:"hidden"}),lo=()=>({standalone:!0}),Hl=()=>({width:"1.7rem",height:"1.7rem"});function qp(l,_){l&1&&(c(0,"i"),g(1),C(2,"translate"),u()),l&2&&(a(),j(y(2,1,"ITEM_PANEL.HEADER.STD_OBJ")))}function Qp(l,_){if(l&1&&(c(0,"div",7)(1,"h6",11),T(2,"i",12),g(3),C(4,"translate"),c(5,"strong"),g(6),u(),T(7,"span",13),g(8),C(9,"translate"),T(10,"i",14),C(11,"fwcIcon"),g(12,"\xA0 "),c(13,"strong"),g(14),C(15,"translate"),u(),g(16,"\xA0 "),A(17,qp,3,3,"i"),u()()),l&2){let e=d(4);a(3),x(" ",y(4,8,"ITEM_PANEL.HEADER.EDIT_OBJ."+e.tabIndex)," "),a(3),j(e.object.name),a(2),x(" ",y(9,10,"ITEM_PANEL.HEADER.TYPE"),": \xA0 "),a(2),xt("",y(11,12,e.object.type)," fwcOrange"),a(4),j(y(15,14,"GLOBALS.DB_OBJECT_NAMES."+e.object.type)),a(3),O(!e.object.fwcloud&&e.object.type!=e.ObjectTypes.OBJ_INTERFACE_FIREWALL?17:-1)}}function $p(l,_){if(l&1&&(c(0,"div",7)(1,"h6",11),T(2,"i",12),g(3),C(4,"translate"),c(5,"strong"),g(6),u()()()),l&2){let e=d(4);a(3),x(" ",y(4,2,"ITEM_PANEL.HEADER.EDIT_RULE")," "),a(3),j(e.object.id)}}function Zp(l,_){if(l&1&&A(0,Qp,18,16,"div",7)(1,$p,7,4,"div",7),l&2){let e=d(3);O(e.object.type!=e.ObjectTypes.OBJ_GEN_RULE?0:1)}}function ed(l,_){l&1&&(c(0,"span"),g(1),C(2,"translate"),u()),l&2&&(a(),x("",y(2,1,"ITEM_PANEL.HEADER.IN_FW")," "))}function td(l,_){l&1&&(c(0,"span"),g(1),C(2,"translate"),u()),l&2&&(a(),x("",y(2,1,"ITEM_PANEL.HEADER.IN_CL")," "))}function id(l,_){l&1&&(c(0,"span"),g(1),C(2,"translate"),u()),l&2&&(a(),x("",y(2,1,"ITEM_PANEL.HEADER.IN_HOST")," "))}function nd(l,_){if(l&1&&(c(0,"strong"),g(1),u()),l&2){let e=d(4);a(),fi("",e.object.parent_id," (",e.object.parent_name,")")}}function od(l,_){if(l&1&&(c(0,"span"),g(1),C(2,"translate"),c(3,"strong"),g(4),u(),g(5," ("),c(6,"strong"),g(7),u(),g(8,")"),u()),l&2){let e=d(4);a(),x("",y(2,3,"ITEM_PANEL.HEADER.IN_IF")," "),a(3),j(e.object.interface),a(3),j(e.object._fwcParentObjName)}}function ld(l,_){if(l&1&&(c(0,"div",7)(1,"h6",11),T(2,"i",15),g(3),C(4,"translate"),A(5,ed,3,3,"span")(6,td,3,3,"span")(7,id,3,3,"span")(8,nd,2,2,"strong")(9,od,9,5,"span"),T(10,"span",13),g(11),C(12,"translate"),c(13,"strong"),g(14),C(15,"translate"),u()()()),l&2){let e=d(3);a(3),x(" ",y(4,8,"ITEM_PANEL.HEADER.NEW_OBJ")," "),a(2),O(e.object.firewall&&!e.object.cluster?5:-1),a(),O(e.object.cluster?6:-1),a(),O(e.object.host?7:-1),a(),O(e.object.parent_id?8:-1),a(),O(e.object._fwcParentInterfaceType?9:-1),a(2),x(" ",y(12,10,"ITEM_PANEL.HEADER.TYPE"),": "),a(3),j(y(15,12,"GLOBALS.DB_OBJECT_NAMES."+e.object.type))}}function rd(l,_){if(l&1&&(c(0,"div",7)(1,"h6",11),T(2,"i",12),g(3),C(4,"translate"),c(5,"strong"),g(6),u(),T(7,"span",13),g(8),C(9,"translate"),T(10,"i",14),C(11,"fwcIcon"),g(12,"\xA0 "),c(13,"strong"),g(14),C(15,"translate"),u()()()),l&2){let e=d(3);a(3),x(" ",y(4,7,"ITEM_PANEL.HEADER.DUPLICATE_OBJ")," "),a(3),j(e.object.name),a(2),x(" ",y(9,9,"ITEM_PANEL.HEADER.TYPE"),": \xA0 "),a(2),xt("",y(11,11,e.object.type)," fwcOrange"),a(4),j(y(15,13,"GLOBALS.DB_OBJECT_NAMES."+e.object.type))}}function ad(l,_){if(l&1&&A(0,Zp,2,1)(1,ld,16,14,"div",7)(2,rd,16,15,"div",7),l&2){let e=d(2);O(e.object.id&&!e.object.duplicateObjectAction?0:-1),a(),O(!e.object.id&&!e.object.duplicateObjectAction?1:-1),a(),O(e.object.duplicateObjectAction?2:-1)}}function sd(l,_){if(l&1&&(c(0,"div",7)(1,"h6",11),T(2,"i",16),g(3),C(4,"translate"),c(5,"strong"),g(6),u()()()),l&2){let e=d(2);a(3),x(" ",y(4,2,e.deleteDialogTitle)," "),a(3),j(e.objectToDelete==null?null:e.objectToDelete._fwcObjName)}}function cd(l,_){if(l&1){let e=L();c(0,"button",17),P("click",function(){w(e);let t=d(2);return S(t.showHelp())}),u()}if(l&2){let e=d(2);m("disabled",e.loadingData)}}function pd(l,_){if(l&1){let e=L();A(0,ad,3,3)(1,sd,7,4,"div",7),c(2,"div",8),A(3,cd,1,1,"button",9),c(4,"button",10),P("click",function(){w(e);let t=d();return S(t.minimizeDialog())}),u()()}if(l&2){let e=d();O(e.object?0:-1),a(),O(e.objectToDelete?1:-1),a(2),O(e.helpSection?3:-1)}}function dd(l,_){if(l&1){let e=L();c(0,"div",24)(1,"div",32)(2,"span",33)(3,"input",34,2),P("drop",function(){w(e);let t=d(2);return S(t.preventDrop())}),u(),c(5,"label",35),g(6),C(7,"translate"),u()()(),c(8,"p",36),g(9),C(10,"translate"),u()()}if(l&2){let e,i=d(2);m("ngClass",i.object.type==i.ObjectTypes.OBJ_GROUP||i.object.type==i.ObjectTypes.OBJ_SERVICE_GROUP?"col-12":"col-6"),a(6),j(y(7,4,i.object.type!=i.ObjectTypes.OBJ_DNS?"ITEM_PANEL.FIELDS.NAME":"ITEM_PANEL.FIELDS.NAME_DNS")),a(2),m("ngStyle",ae(8,Qe,i.formModel.get("name").valid||i.formModel.get("name").pristine?"hidden":"visible")),a(),x(" ",y(10,6,(e=i.formModel.get("name").errors)!=null&&e.pattern?"ITEM_PANEL.ERRORS.FIELD_INVALID_NAME":"ITEM_PANEL.ERRORS.FIELD_EMPTY")," ")}}function _d(l,_){l&1&&T(0,"div",25)}function ud(l,_){if(l&1){let e=L();c(0,"div",26)(1,"div",32)(2,"span",33)(3,"input",37),P("drop",function(){w(e);let t=d(2);return S(t.preventDrop())}),u(),c(4,"label",38),g(5),C(6,"translate"),u()()(),c(7,"p",36),g(8),C(9,"translate"),u()()}if(l&2){let e=d(2);a(5),j(y(6,3,"ITEM_PANEL.FIELDS.ADDRESS")),a(2),m("ngStyle",ae(7,Qe,e.formModel.get("address").valid||e.formModel.get("address").pristine&&e.formModel.get("address").untouched?"hidden":"visible")),a(),x(" ",y(9,5,"ITEM_PANEL.ERRORS.FIELD_ADDR")," ")}}function fd(l,_){if(l&1){let e=L();c(0,"div",26)(1,"div",32)(2,"span",33)(3,"input",39),P("drop",function(){w(e);let t=d(2);return S(t.preventDrop())}),u(),c(4,"label",40),g(5),C(6,"translate"),u()()(),c(7,"p",36),g(8),C(9,"translate"),u()()}if(l&2){let e=d(2);a(5),j(y(6,3,"ITEM_PANEL.FIELDS.MASK")),a(2),m("ngStyle",ae(7,Qe,e.formModel.get("netmask").valid||e.formModel.get("netmask").pristine?"hidden":"visible")),a(),x(" ",y(9,5,"ITEM_PANEL.ERRORS.FIELD_NETMASK")," ")}}function md(l,_){if(l&1){let e=L();c(0,"div",26)(1,"div",32)(2,"span",33)(3,"input",41),P("drop",function(){w(e);let t=d(2);return S(t.preventDrop())}),u(),c(4,"label",42),g(5),C(6,"translate"),u()()(),c(7,"p",36),g(8),C(9,"translate"),u()()}if(l&2){let e=d(2);a(5),j(y(6,3,"ITEM_PANEL.FIELDS.RANGE_S")),a(2),m("ngStyle",ae(7,Qe,e.formModel.get("range_start").valid||e.formModel.get("range_start").pristine&&e.formModel.get("range_start").untouched?"hidden":"visible")),a(),x(" ",y(9,5,"ITEM_PANEL.ERRORS.FIELD_ADDR")," ")}}function hd(l,_){if(l&1){let e=L();c(0,"div",26)(1,"div",32)(2,"span",33)(3,"input",43),P("drop",function(){w(e);let t=d(2);return S(t.preventDrop())}),u(),c(4,"label",44),g(5),C(6,"translate"),u()()(),c(7,"p",36),g(8),C(9,"translate"),u()()}if(l&2){let e=d(2);a(5),j(y(6,3,"ITEM_PANEL.FIELDS.RANGE_E")),a(2),m("ngStyle",ae(7,Qe,e.formModel.get("range_end").valid||e.formModel.get("range_end").pristine&&e.formModel.get("range_end").untouched?"hidden":"visible")),a(),x(" ",y(9,5,"ITEM_PANEL.ERRORS.FIELD_ADDR")," ")}}function wd(l,_){if(l&1&&(c(0,"option",46),g(1),u()),l&2){let e=_.$implicit;m("ngValue",e.id),a(),x(" ",e.text," ")}}function Sd(l,_){if(l&1){let e=L();c(0,"div",26)(1,"div",32)(2,"span",33)(3,"select",45),P("change",function(){w(e);let t=d(2);return S(t.revalidateForm())}),Oe(4,wd,2,2,"option",46,Te),u(),c(6,"label",47),g(7),C(8,"translate"),u()()()()}if(l&2){let e=d(2);a(4),Re(e.ipVersions),a(3),j(y(8,1,"ITEM_PANEL.FIELDS.IPV"))}}function gd(l,_){if(l&1){let e=L();c(0,"div",26)(1,"div",32)(2,"span",33)(3,"input",37),P("drop",function(){w(e);let t=d(2);return S(t.preventDrop())}),u(),c(4,"label",38),g(5),C(6,"translate"),u()()(),c(7,"p",36),g(8),C(9,"translate"),u()()}if(l&2){let e=d(2);a(5),j(y(6,3,"ITEM_PANEL.FIELDS.ADDRESS")),a(2),m("ngStyle",ae(7,Qe,e.formModel.get("address").valid||e.formModel.get("address").pristine&&e.formModel.get("address").untouched?"hidden":"visible")),a(),x(" ",y(9,5,"ITEM_PANEL.ERRORS.FIELD_ADDR")," ")}}function Cd(l,_){if(l&1){let e=L();c(0,"div",26)(1,"div",32)(2,"span",33)(3,"input",39),P("drop",function(){w(e);let t=d(2);return S(t.preventDrop())}),u(),c(4,"label",40),g(5),C(6,"translate"),u()()(),c(7,"p",36),g(8),C(9,"translate"),u()()}if(l&2){let e=d(2);a(5),j(y(6,3,"ITEM_PANEL.FIELDS.MASK")),a(2),m("ngStyle",ae(7,Qe,e.formModel.get("netmask").valid||e.formModel.get("netmask").pristine?"hidden":"visible")),a(),x(" ",y(9,5,"ITEM_PANEL.ERRORS.FIELD_NETMASK")," ")}}function yd(l,_){if(l&1&&(c(0,"option",46),g(1),u()),l&2){let e=_.$implicit;m("ngValue",e.id),a(),x(" ",e.text," ")}}function Ed(l,_){if(l&1){let e=L();c(0,"div",26)(1,"div",32)(2,"span",33)(3,"select",45),P("change",function(){w(e);let t=d(2);return S(t.revalidateForm())}),Oe(4,yd,2,2,"option",46,Te),u(),c(6,"label",47),g(7),C(8,"translate"),u()()()()}if(l&2){let e=d(2);a(4),Re(e.ipVersions),a(3),j(y(8,1,"ITEM_PANEL.FIELDS.IPV"))}}function vd(l,_){if(l&1&&(c(0,"div",27)(1,"div",32)(2,"span",33),T(3,"sts-fwc-object-group",48),c(4,"label",49),g(5),C(6,"translate"),u()()(),T(7,"p",36),u()),l&2){let e=d(2);a(3),m("groupId",e.object.id)("readOnly",!e.object.fwcloud)("groupType",e.object.type)("groupTreeId",e.object.id_node)("ipobjs",e.object.ipobjs),a(2),j(y(6,7,"ITEM_PANEL.FIELDS.OBJ_GROUP")),a(2),m("ngStyle",W(9,zp))}}function Id(l,_){if(l&1){let e=L();c(0,"div",25)(1,"div",32)(2,"span",33)(3,"input",50),P("drop",function(){w(e);let t=d(2);return S(t.preventDrop())})("click",function(t){return w(e),S(t.target.select())}),u(),c(4,"label",51),g(5),C(6,"translate"),u()()(),c(7,"p",36),g(8),C(9,"translate"),u()()}if(l&2){let e=d(2);a(5),j(y(6,3,"ITEM_PANEL.FIELDS.PROT")),a(2),m("ngStyle",ae(7,Qe,e.formModel.get("protocol").valid||e.formModel.get("protocol").pristine?"hidden":"visible")),a(),x(" ",y(9,5,"ITEM_PANEL.ERRORS.FIELD_PROTOCOL")," ")}}function bd(l,_){l&1&&(c(0,"span"),g(1),C(2,"translate"),T(3,"br"),u()),l&2&&(a(),j(y(2,1,"ITEM_PANEL.ERRORS.FIELD_PORT_VAL")))}function Pd(l,_){l&1&&(c(0,"span"),g(1),C(2,"translate"),u()),l&2&&(a(),j(y(2,1,"ITEM_PANEL.ERRORS.FIELD_PORT_VAL2")))}function Td(l,_){l&1&&(c(0,"span"),g(1),C(2,"translate"),T(3,"br"),u()),l&2&&(a(),j(y(2,1,"ITEM_PANEL.ERRORS.FIELD_PORT_VAL")))}function Od(l,_){l&1&&(c(0,"span"),g(1),C(2,"translate"),u()),l&2&&(a(),j(y(2,1,"ITEM_PANEL.ERRORS.FIELD_PORT_VAL2")))}function Rd(l,_){if(l&1){let e=L();c(0,"div",25)(1,"div",23)(2,"div",25)(3,"p-fieldset",52),C(4,"translate"),c(5,"div",23)(6,"div",25)(7,"div",32)(8,"span",33)(9,"input",53),P("drop",function(){w(e);let t=d(2);return S(t.preventDrop())})("click",function(t){return w(e),S(t.target.select())}),u(),c(10,"label",54),g(11),C(12,"translate"),u()()()(),c(13,"div",25)(14,"div",32)(15,"span",33)(16,"input",55),P("drop",function(){w(e);let t=d(2);return S(t.preventDrop())})("click",function(t){return w(e),S(t.target.select())}),u(),c(17,"label",56),g(18),C(19,"translate"),u()()()()(),c(20,"p",36),A(21,bd,4,3,"span")(22,Pd,3,3,"span"),u()()(),c(23,"div",25)(24,"p-fieldset",52),C(25,"translate"),c(26,"div",23)(27,"div",25)(28,"div",32)(29,"span",33)(30,"input",57),P("drop",function(){w(e);let t=d(2);return S(t.preventDrop())})("click",function(t){return w(e),S(t.target.select())}),u(),c(31,"label",58),g(32),C(33,"translate"),u()()()(),c(34,"div",25)(35,"div",32)(36,"span",33)(37,"input",59),P("drop",function(){w(e);let t=d(2);return S(t.preventDrop())})("click",function(t){return w(e),S(t.target.select())}),u(),c(38,"label",60),g(39),C(40,"translate"),u()()()()(),c(41,"p",36),A(42,Td,4,3,"span")(43,Od,3,3,"span"),u()()()()()}if(l&2){let e,i,t,n,o=d(2);a(3),M("legend",y(4,12,"ITEM_PANEL.FIELDS.SRC_PORT")),a(8),j(y(12,14,"ITEM_PANEL.FIELDS.PORT_S")),a(7),j(y(19,16,"ITEM_PANEL.FIELDS.PORT_E")),a(2),m("ngStyle",ae(24,Qe,(e=o.formModel.get("source_port_start").errors)!=null&&e.min||(e=o.formModel.get("source_port_start").errors)!=null&&e.max||o.formModel.errors!=null&&o.formModel.errors.sourceports?"visible":"hidden")),a(),O((i=o.formModel.get("source_port_start").errors)!=null&&i.min||(i=o.formModel.get("source_port_start").errors)!=null&&i.max?21:-1),a(),O(o.formModel.errors!=null&&o.formModel.errors.sourceports?22:-1),a(2),M("legend",y(25,18,"ITEM_PANEL.FIELDS.DEST_PORT")),a(8),j(y(33,20,"ITEM_PANEL.FIELDS.PORT_S")),a(7),j(y(40,22,"ITEM_PANEL.FIELDS.PORT_E")),a(2),m("ngStyle",ae(26,Qe,(t=o.formModel.get("destination_port_start").errors)!=null&&t.min||(t=o.formModel.get("destination_port_start").errors)!=null&&t.max||o.formModel.errors!=null&&o.formModel.errors.destinationports?"visible":"hidden")),a(),O((n=o.formModel.get("destination_port_start").errors)!=null&&n.min||(n=o.formModel.get("destination_port_start").errors)!=null&&n.max?42:-1),a(),O(o.formModel.errors!=null&&o.formModel.errors.destinationports?43:-1)}}function xd(l,_){if(l&1&&(c(0,"th"),g(1),u()),l&2){let e=_.$implicit;a(),x(" ",e.name," ")}}function Fd(l,_){if(l&1){let e=L();c(0,"td")(1,"p-checkbox",64),J("ngModelChange",function(t){let n=w(e).$implicit;return Y(n.mask,t)||(n.mask=t),S(t)}),P("onChange",function(){let t=w(e).$index,n=d(3);return S(n.setFormTCPFlags(t))}),u()()}if(l&2){let e=_.$implicit,i=d(3);a(),m("binary",!0),H("ngModel",e.mask),m("ngModelOptions",W(4,lo))("disabled",!i.object.fwcloud&&i.object.type!=i.ObjectTypes.OBJ_INTERFACE_FIREWALL&&i.object.type!=i.ObjectTypes.OBJ_GEN_RULE)}}function Ad(l,_){if(l&1){let e=L();c(0,"td")(1,"p-checkbox",65),J("ngModelChange",function(t){let n=w(e).$implicit;return Y(n.status,t)||(n.status=t),S(t)}),P("onChange",function(){let t=w(e).$index,n=d(3);return S(n.setFormTCPFlags(t))}),u()()}if(l&2){let e=_.$implicit,i=d(3);a(),m("binary",!0),H("ngModel",e.status),m("ngModelOptions",W(5,lo))("ngStyle",ae(6,Qe,e.mask?"visible":"hidden"))("disabled",!i.object.fwcloud&&i.object.type!=i.ObjectTypes.OBJ_INTERFACE_FIREWALL&&i.object.type!=i.ObjectTypes.OBJ_GEN_RULE)}}function Ld(l,_){if(l&1&&(c(0,"div",25)(1,"div",23)(2,"div",27)(3,"p-fieldset",52),C(4,"translate"),T(5,"input",61)(6,"input",62),c(7,"table",63)(8,"thead")(9,"tr"),T(10,"th"),Oe(11,xd,2,1,"th",null,Te),u()(),c(13,"tbody")(14,"tr")(15,"td"),g(16),C(17,"translate"),u(),Oe(18,Fd,2,5,"td",null,Te),u(),c(20,"tr")(21,"td"),g(22),C(23,"translate"),u(),Oe(24,Ad,2,8,"td",null,Te),u()()()()()()()),l&2){let e=d(2);a(3),M("legend",y(4,3,"ITEM_PANEL.FIELDS.TCP_FLAGS")),a(8),Re(e.tcpFlagsArray),a(5),x(" ",y(17,5,"ITEM_PANEL.FIELDS.TCP_FLAG_MASK")," "),a(2),Re(e.tcpFlagsArray),a(4),x(" ",y(23,7,"ITEM_PANEL.FIELDS.TCP_FLAG_STATUS")," "),a(2),Re(e.tcpFlagsArray)}}function Md(l,_){if(l&1&&(c(0,"option",46),g(1),u()),l&2){let e=_.$index;m("ngValue",e),a(),x(" ",e," ")}}function Dd(l,_){if(l&1&&(c(0,"div",28)(1,"div",32)(2,"span",33)(3,"select",66)(4,"option",46),g(5,"Any"),u(),Oe(6,Md,2,2,"option",46,Te),u(),c(8,"label",67),g(9),C(10,"translate"),u()()()()),l&2){let e=d(2);a(4),m("ngValue",-1),a(2),Re(e.icmp_values),a(3),j(y(10,2,"ITEM_PANEL.FIELDS.ICMP_TYPE"))}}function Nd(l,_){if(l&1&&(c(0,"option",46),g(1),u()),l&2){let e=_.$index;m("ngValue",e),a(),x(" ",e," ")}}function Ud(l,_){if(l&1&&(c(0,"div",28)(1,"div",32)(2,"span",33)(3,"select",68)(4,"option",46),g(5,"Any"),u(),Oe(6,Nd,2,2,"option",46,Te),u(),c(8,"label",69),g(9),C(10,"translate"),u()()()()),l&2){let e=d(2);a(4),m("ngValue",-1),a(2),Re(e.icmp_values),a(3),j(y(10,2,"ITEM_PANEL.FIELDS.ICMP_CODE"))}}function Gd(l,_){if(l&1){let e=L();c(0,"div",26)(1,"div",32)(2,"span",33)(3,"input",70),P("drop",function(){w(e);let t=d(2);return S(t.preventDrop())}),u(),c(4,"label",71),g(5),C(6,"translate"),u()()()()}l&2&&(a(5),j(y(6,1,"ITEM_PANEL.FIELDS.LABEL")))}function Bd(l,_){if(l&1){let e=L();c(0,"div",26)(1,"div",32)(2,"span",33)(3,"input",72),P("drop",function(){w(e);let t=d(2);return S(t.preventDrop())}),u(),c(4,"label",73),g(5),C(6,"translate"),u()()(),c(7,"p",36),g(8),C(9,"translate"),u()()}if(l&2){let e=d(2);a(5),j(y(6,3,"ITEM_PANEL.FIELDS.MAC")),a(2),m("ngStyle",ae(7,Qe,e.formModel.get("mac").valid||e.formModel.get("mac").pristine?"hidden":"visible")),a(),x(" ",y(9,5,"ITEM_PANEL.ERRORS.FIELD_MAC")," ")}}function kd(l,_){if(l&1){let e=L();c(0,"div",25)(1,"div",32)(2,"span",33)(3,"input",74),P("drop",function(){w(e);let t=d(2);return S(t.preventDrop())}),u(),c(4,"label",75),g(5),C(6,"translate"),u()()(),c(7,"p",36),g(8),C(9,"translate"),u()()}if(l&2){let e=d(2);a(5),j(y(6,3,"ITEM_PANEL.FIELDS.MARK_CODE")),a(2),m("ngStyle",ae(7,Qe,e.formModel.get("code").valid||e.formModel.get("code").pristine?"hidden":"visible")),a(),x(" ",y(9,5,"ITEM_PANEL.ERRORS.FIELD_MARK_CODE")," ")}}function jd(l,_){if(l&1){let e=L();c(0,"div",32)(1,"p-checkbox",86),J("ngModelChange",function(t){let n=w(e).$implicit;return Y(n.status,t)||(n.status=t),S(t)}),P("onChange",function(){let t=w(e).$index,n=d(3);return S(n.onChangeOptionsFlags(t))}),u()()}if(l&2){let e=_.$implicit,i=d(3);a(),m("binary",!0)("disabled",i.object.special&&e.disableOnRuleActive),H("ngModel",e.status),m("ngModelOptions",W(5,lo))("label",e.name)}}function Vd(l,_){if(l&1){let e=L();c(0,"div",76)(1,"h5",77),g(2),C(3,"translate"),u()(),c(4,"div",78)(5,"h5",77),g(6),C(7,"translate"),u()(),c(8,"div",76),Oe(9,jd,2,6,"div",32,Te),u(),c(11,"div",78)(12,"p-tabView",79)(13,"p-tabPanel",80),C(14,"translate"),T(15,"textarea",81),C(16,"translate"),c(17,"div",82)(18,"button",83),C(19,"translate"),P("click",function(){w(e);let t=d(2);return t.formModel.get("run_before").setValue(null),S(t.formModel.markAsDirty())}),u()()(),c(20,"p-tabPanel",84),C(21,"translate"),T(22,"textarea",85),C(23,"translate"),c(24,"div",82)(25,"button",83),C(26,"translate"),P("click",function(){w(e);let t=d(2);return t.formModel.get("run_after").setValue(null),S(t.formModel.markAsDirty())}),u()()()()()}if(l&2){let e=d(2);a(2),x(" ",y(3,10,"RULE.OPTION_TITLE")," "),a(4),x(" ",y(7,12,"RULE.HOOKS.TITLE")," "),a(3),Re(e.optionsFlags),a(4),M("header",y(14,14,"RULE.HOOKS.BEFORE_TITLE")),a(2),M("placeholder",y(16,16,"RULE.HOOKS.PLACEHOLDER")),a(3),M("label",y(19,18,"CONTEXT.OBJECTS.DELETE")),m("disabled",!e.formModel.get("run_before").value),a(2),M("header",y(21,20,"RULE.HOOKS.AFTER_TITLE")),a(2),M("placeholder",y(23,22,"RULE.HOOKS.PLACEHOLDER")),a(3),M("label",y(26,24,"CONTEXT.OBJECTS.DELETE")),m("disabled",!e.formModel.get("run_after").value)}}function Wd(l,_){if(l&1){let e=L();c(0,"div",27)(1,"span",33)(2,"textarea",87),P("drop",function(){w(e);let t=d(2);return S(t.preventDrop())}),u(),c(3,"label",88),g(4),C(5,"translate"),u()()()}l&2&&(a(4),j(y(5,1,"ITEM_PANEL.FIELDS.COMMENTS")))}function Hd(l,_){if(l&1&&(c(0,"div",27),T(1,"sts-fwc-message",89),u()),l&2){let e=d(2);a(),m("message",e.objErrorMessage)}}function Yd(l,_){if(l&1){let e=L();c(0,"div",31)(1,"form",90)(2,"sts-fwc-object-wu",91),P("onHideParent",function(){w(e);let t=d(2);return S(t.minimizeDialog())}),u()()()}if(l&2){let e=d(2);a(2),m("objectInfo",e.object._fwcObjectInfo)}}function Jd(l,_){if(l&1){let e=L();c(0,"p-tabView",18,1),P("onChange",function(t){w(e);let n=d();return S(n.onTabChange(t))}),c(2,"p-tabPanel",19),C(3,"translate"),c(4,"div",20)(5,"form",21)(6,"fieldset",22),P("keyup.enter",function(t){w(e);let n=d();return S(n.checkForm(t))})("keyup.esc",function(){w(e);let t=d();return S(t.onCancel())}),c(7,"div",23),A(8,dd,11,10,"div",24)(9,_d,1,0,"div",25)(10,ud,10,9,"div",26)(11,fd,10,9,"div",26)(12,md,10,9,"div",26)(13,hd,10,9,"div",26)(14,Sd,9,3,"div",26)(15,gd,10,9,"div",26)(16,Cd,10,9,"div",26)(17,Ed,9,3,"div",26)(18,vd,8,10,"div",27)(19,Id,10,9,"div",25)(20,Rd,44,28,"div",25)(21,Ld,26,9,"div",25)(22,Dd,11,4,"div",28)(23,Ud,11,4,"div",28)(24,Gd,7,3,"div",26)(25,Bd,10,9,"div",26)(26,kd,10,9,"div",25)(27,Vd,27,26)(28,Wd,6,3,"div",27)(29,Hd,2,1,"div",27),u()()()()(),c(30,"p-tabPanel",29),C(31,"translate"),c(32,"div",30)(33,"div",23),A(34,Yd,3,1,"div",31),u()()()()}if(l&2){let e=d();m("activeIndex",e.tabIndex),a(2),M("header",y(3,30,"ITEM_PANEL.HEADER.OBJ")),m("disabled",e.loadingData||e.object._fwcObjType==e.ObjectTypes.OBJ_VPN_CONFIG_CLI||e.object._fwcObjType==e.ObjectTypes.OBJ_OPENVPN_PREFIX),a(3),m("formGroup",e.formModel),a(),m("disabled",e.loadingData||!e.object.fwcloud&&e.object.type!=e.ObjectTypes.OBJ_INTERFACE_FIREWALL&&e.object.type!=e.ObjectTypes.OBJ_GEN_RULE),a(2),O(e.object.type!=e.ObjectTypes.OBJ_GEN_RULE?8:-1),a(),O(e.object.type!=e.ObjectTypes.OBJ_GEN_RULE&&e.object.type!=e.ObjectTypes.OBJ_MARK&&e.object.type!=e.ObjectTypes.OBJ_SERVICE_IP&&e.object.type!=e.ObjectTypes.OBJ_SERVICE_ICMP?9:-1),a(),O(e.object.type==e.ObjectTypes.OBJ_ADDRESS?10:-1),a(),O(e.object.type==e.ObjectTypes.OBJ_ADDRESS?11:-1),a(),O(e.object.type==e.ObjectTypes.OBJ_ADDRESS_RANGE?12:-1),a(),O(e.object.type==e.ObjectTypes.OBJ_ADDRESS_RANGE?13:-1),a(),O(e.object.type==e.ObjectTypes.OBJ_ADDRESS||e.object.type==e.ObjectTypes.OBJ_ADDRESS_RANGE?14:-1),a(),O(e.object.type==e.ObjectTypes.OBJ_NETWORK?15:-1),a(),O(e.object.type==e.ObjectTypes.OBJ_NETWORK?16:-1),a(),O(e.object.type==e.ObjectTypes.OBJ_NETWORK?17:-1),a(),O((e.object.type==e.ObjectTypes.OBJ_GROUP||e.object.type==e.ObjectTypes.OBJ_SERVICE_GROUP)&&e.object.id?18:-1),a(),O(e.object.type==e.ObjectTypes.OBJ_SERVICE_IP?19:-1),a(),O(e.object.type==e.ObjectTypes.OBJ_SERVICE_TCP||e.object.type==e.ObjectTypes.OBJ_SERVICE_UDP?20:-1),a(),O(e.object.type==e.ObjectTypes.OBJ_SERVICE_TCP?21:-1),a(),O(e.object.type==e.ObjectTypes.OBJ_SERVICE_ICMP?22:-1),a(),O(e.object.type==e.ObjectTypes.OBJ_SERVICE_ICMP?23:-1),a(),O(e.object.type==e.ObjectTypes.OBJ_INTERFACE_HOST||e.object.type==e.ObjectTypes.OBJ_INTERFACE_FIREWALL?24:-1),a(),O(e.object.type==e.ObjectTypes.OBJ_INTERFACE_HOST||e.object.type==e.ObjectTypes.OBJ_INTERFACE_FIREWALL?25:-1),a(),O(e.object.type==e.ObjectTypes.OBJ_MARK?26:-1),a(),O(e.object.type==e.ObjectTypes.OBJ_GEN_RULE?27:-1),a(),O(e.object.type!=e.ObjectTypes.OBJ_GEN_RULE?28:-1),a(),O(e.objErrorMessage?29:-1),a(),M("header",y(31,32,"ITEM_PANEL.HEADER.INFO")),m("disabled",e.loadingData||!e.object._fwcObjectInfo),a(4),O(e.object._fwcObjectInfo?34:-1)}}function Kd(l,_){l&1&&(c(0,"div",92),T(1,"p-progressSpinner"),u())}function Xd(l,_){if(l&1){let e=L();c(0,"div",93)(1,"sts-fwc-object-restrictions",94),P("onHideParent",function(){w(e);let t=d(3);return S(t.minimizeDialog(!0))})("onRefreshRestrictions",function(){w(e);let t=d(3);return S(t.reloadPanel())}),u()()}if(l&2){let e=d(3);a(),m("dependencies",e.dependencies)}}function zd(l,_){if(l&1&&(T(0,"sts-fwc-message",89),A(1,Xd,2,1,"div",93)),l&2){let e=d(2);m("message",e.deleteMsg),a(),O(e.dependencies.restrictionsError?-1:1)}}function qd(l,_){if(l&1&&T(0,"sts-fwc-message",89),l&2){let e=d(2);m("message",e.deleteMsg)}}function Qd(l,_){if(l&1&&A(0,Kd,2,0,"div",92)(1,zd,2,2)(2,qd,1,1,"sts-fwc-message",89),l&2){let e=d();O(e.loadingData&&!e.deleteMsg?0:-1),a(),O(e.dependencies?1:2)}}function $d(l,_){if(l&1){let e=L();c(0,"button",100),C(1,"translate"),P("click",function(){w(e);let t=d(4);return S(t.onCancel())}),u()}if(l&2){let e=d(4);M("label",y(1,2,"GLOBALS.MSG_BUTTONS.CANCEL")),m("disabled",!e.object||e.loadingData)}}function Zd(l,_){if(l&1){let e=L();c(0,"button",101),C(1,"translate"),P("click",function(){w(e);let t=d(4);return S(t.onSave())}),u()}if(l&2){let e=d(4);M("label",y(1,2,"GLOBALS.MSG_BUTTONS.SAVE")),m("disabled",!e.formModel.valid||e.formModel.pristine||e.loadingData)}}function e_(l,_){if(l&1){let e=L();c(0,"button",102),C(1,"translate"),P("click",function(){w(e);let t=d(4);return S(t.onCancel())}),u()}l&2&&M("label",y(1,1,"GLOBALS.MSG_BUTTONS.CLOSE"))}function t_(l,_){if(l&1&&(c(0,"div",97),T(1,"p-progressSpinner"),u(),A(2,$d,2,4,"button",98)(3,Zd,2,4,"button",99)(4,e_,2,3,"button",96)),l&2){let e=d(3);m("ngStyle",ae(6,Qe,e.loadingData?"visible":"hidden")),a(),ke(W(8,Hl)),a(),O(e.formModel.pristine?-1:2),a(),O(e.formModel.pristine?-1:3),a(),O(e.formModel.pristine?4:-1)}}function i_(l,_){if(l&1){let e=L();c(0,"button",102),C(1,"translate"),P("click",function(){w(e);let t=d(3);return S(t.onCancel())}),u()}l&2&&M("label",y(1,1,"GLOBALS.MSG_BUTTONS.CLOSE"))}function n_(l,_){if(l&1&&A(0,t_,5,9)(1,i_,2,3,"button",96),l&2){let e=d(2);O(e.object.fwcloud||e.object.type==e.ObjectTypes.OBJ_INTERFACE_FIREWALL?0:-1),a(),O(!e.object.fwcloud&&e.object.type!=e.ObjectTypes.OBJ_INTERFACE_FIREWALL?1:-1)}}function o_(l,_){if(l&1){let e=L();c(0,"button",105),C(1,"translate"),P("click",function(){w(e);let t=d(3);return S(t.reloadPanel())}),u()}if(l&2){let e=d(3);M("label",y(1,2,"POLICY_GRID.RELOAD")),m("disabled",e.loadingData)}}function l_(l,_){if(l&1){let e=L();A(0,o_,2,4,"button",103),c(1,"div",97),T(2,"p-progressSpinner"),u(),c(3,"button",83),C(4,"translate"),P("click",function(){w(e);let t=d(2);return S(t.onDeleteObject())}),u(),c(5,"button",104),C(6,"translate"),P("click",function(){w(e);let t=d(2);return S(t.onCancel())}),u()}if(l&2){let e=d(2);O(e.dependencies?0:-1),a(),m("ngStyle",ae(11,Qe,e.loadingData?"visible":"hidden")),a(),ke(W(13,Hl)),a(),M("label",y(4,7,"ITEM_PANEL.HEADER.DEL_OBJ")),m("disabled",!e.okToDelete||e.loadingData),a(2),M("label",y(6,9,"GLOBALS.MSG_BUTTONS.CANCEL"))}}function r_(l,_){if(l&1){let e=L();c(0,"button",106),C(1,"translate"),P("click",function(){w(e);let t=d(2);return S(t.onCancel())}),u()}if(l&2){let e=d(2);M("label",y(1,2,"GLOBALS.MSG_BUTTONS.CLOSE")),m("disabled",e.loadingData)}}function a_(l,_){if(l&1&&A(0,n_,2,2)(1,l_,7,14)(2,r_,2,4,"button",95),l&2){let e=d();O(e.object?0:-1),a(),O(e.objectToDelete?1:-1),a(),O(!e.object&&!e.objectToDelete?2:-1)}}var Yl=(()=>{class l extends Dt{revalidateForm(){for(let e in this.formModel.controls)this.formModel.controls[e].updateValueAndValidity(),this.formModel.controls[e].markAsTouched()}srcPortsValidator(e){let i=e.get("source_port_start").value,t=e.get("source_port_end").value;return i>0&&t>0&&i>t?{sourceports:!0}:null}destPortsValidator(e){let i=e.get("destination_port_start").value,t=e.get("destination_port_end").value;return i>0&&t>0&&i>t?{destinationports:!0}:null}constructor(e,i,t,n,o,r,p,s,f,h,E,b,I,R,V,G,D,K,B,te,he,Ce,Ge,Pt){super(p,h,e,te,Ge,Pt),this.itemSelectedService=e,this.ruleSelectedService=i,this.fwcObjectService=t,this.fwcFirewallService=n,this.fwcInterfaceService=o,this.fwcPolicyService=r,this.appDialogPanelsService=p,this.fwcObjectTypeService=s,this.fwcVpnService=f,this.appOptionsService=h,this.fwcMarkService=E,this.fwcUserService=b,this.fwcRoutingTableService=I,this.fwcDhcpPolicyService=R,this.confirmationService=V,this.messageService=G,this.utilService=D,this.translate=K,this.fwcErrorPipe=B,this.cd=te,this.elementRef=he,this.renderer=Ce,this.store=Ge,this.router=Pt,this.fwcUserObject={},this.ObjectTypes=v,this.ipVersions=[{id:4,text:"IP version 4"},{id:6,text:"IP version 6"}],this.optionsFlags=[{name:this.translate.instant("RULE.OPTION_NAMES.0"),optionGroup:"STATE",status:!1,disableOnRuleActive:!0},{name:this.translate.instant("RULE.OPTION_NAMES.1"),optionGroup:"STATE",status:!1,disableOnRuleActive:!0},{name:this.translate.instant("RULE.OPTION_NAMES.2"),status:!1}],this.tabIndex=0,this.disableTabChange=!1,this.messageObject={},this.minMaxValidator=(vt,Gt)=>Bn=>{let $i=!0,Zi=0,en=0;return this.formModel.controls[vt]&&this.formModel.controls[Gt]&&(Zi=this.formModel.controls[vt].value,en=this.formModel.controls[Gt].value),$i=en>=Zi,$i?null:{minmax:!0}},this.icmp_values=Array(256),this.dependencies=null,this.loadingData=!1,this.okToDelete=!1,this.alive=!0,this.infoTooltipShown=!1,this.createDialog(this.translate.instant("ITEM_PANEL.TITLE"),"fwci-ipobjects",ee.ITEM_PANEL),this.helpSection="/ipobjs"}ngOnInit(){this.store.pipe($(()=>this.alive),zt(xi.selectDialogUuidsToReload)).subscribe(e=>{e&&e.find(i=>i===this.dialogUUID)&&this.reloadPanel()}),this.itemSelectedService.hideObjectPanel().pipe($(()=>this.alive)).subscribe(e=>{this.hideDialog()}),this.itemSelectedService.getItem().pipe($(()=>this.alive)).subscribe(e=>{if([v.OBJ_FIREWALL,v.OBJ_CLUSTER,v.OBJ_VPN_CONFIG_SER,v.OBJ_VPN_CONFIG_CLI,v.OBJ_PREFIX_FOLDER,v.OBJ_OPENVPN_PREFIX].findIndex(t=>e._fwcObjType==t)==-1){if(e.unloadAction||e.fwcloud!==null&&e.fwcloud!=null&&e.fwcloud!=this.fwcUserObject.selectedFwCloud){this.resetProperties(),this.hideDialog();return}if(e.deleteAction)this.resetProperties(),this.recenterDialog(),this.showDialog(),this.checkObjectRestrictions(e);else{let t=e.whereUsedAction;e._onlySelectInTree||(this.disableTabChange=!1,e._fwcObjType!=v.OBJ_GEN_RULE&&(this.resetProperties(),this.onItemSelect(e,t)))}}}),this.ruleSelectedService.getRule().pipe($(()=>this.alive)).subscribe(e=>{this.onRuleSelect(e)}),this.fwcUserService.getFwcUser().pipe($(()=>this.alive)).subscribe(e=>{if(e){if(this.fwcUserObject&&this.fwcUserObject.user_id==e.user_id&&this.fwcUserObject.selectedFwCloud==e.selectedFwCloud||(this.fwcUserObject=Object.assign({},e),this.fwcUserObject.user_id===null||this.fwcUserObject.user_id===void 0||this.fwcUserObject.selectedFwCloud===null||this.fwcUserObject.selectedFwCloud===void 0))return;this.fwcObjectTypeService.getObjectTypes().subscribe(i=>{if(this.OBJECT_TYPES=[],i.data)for(let t of i.data)this.OBJECT_TYPES[t.id]=t.type},i=>{Wt.error("ERROR getting object types",i.error),this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(i)})})}})}ngAfterViewInit(){}ngOnDestroy(){super.ngOnDestroy()}reloadPanel(e){if(this.objectToDelete&&(this.displayDialog||this.dialogMinified)){let i=this.itemSelectedService.getActualLastMinifiedDialogId(),t=Object.assign({},this.objectToDelete);this.resetProperties(),this.recenterDialog(),this.checkObjectRestrictions(t),this.dialogId==i&&(this.showDialog(),this.itemSelectedService.setLastMinifiedDialogId(void 0)),this.store.dispatch(me.reloadDialogFinished({dialogUuid:this.dialogUUID}))}else if(this.object&&(this.displayDialog||this.dialogMinified)){let i=this.object.whereUsedAction;if(this.disableTabChange=!0,!e||e._fwcObjType!=v.OBJ_GEN_RULE){let t=Object.assign({},this.object);this.resetProperties(!0),this.onItemSelect(t,i),this.store.dispatch(me.reloadDialogFinished({dialogUuid:this.dialogUUID}))}}}showHelp(){this.appOptionsService.showHelp(this.helpSection)}resetProperties(e){e||(this.object=null,this.objectToDelete=null),this.dependencies=null,this.deleteMsg=null}onItemSelect(e,i){let t,n,o,r,p;if(t=e._fwcObjId,n=e._fwcObjType,o=e.fwcloud,r=e._fwcObjName,t==null&&n!==void 0){let s=Object.assign({},e);s.id=t,s.type=n,s.fwcloud=o,s.name=r,this.newObject(s)}else if(t!==void 0&&n!==void 0)switch(n){case v.OBJ_FIREWALL:this.fwcFirewallService.getFirewall(t,this.fwcUserObject.selectedFwCloud).subscribe(h=>{let E=h.data;E.type=n,this.parseObject(E,i,e),this.equalizeTabHeight(),this.recenterDialog(),this.objectToDelete=null,this.showDialog()},h=>{this.errorMessage=h,p=this.translate.instant("ITEM_PANEL.ERRORS.FW_LOAD",{name:r,error:h}),this.showErrorMsg(p)});break;case v.OBJ_INTERFACE_FIREWALL:case v.OBJ_INTERFACE_HOST:let s,f;n==v.OBJ_INTERFACE_HOST?(s=this.getInterfaceHost.bind(this),f=e.parent_id):(s=this.getInterface.bind(this),e._fwcFwId!==void 0&&e._fwcFwId!==null?f=e._fwcFwId:f=e.firewall),Promise.all([s(f,t),this.getInterfaceWhereUsed(t,n)]).then(([h,E])=>{let b=h.data,I=E.data;b.type=b.interface_type,this.parseObject(b,i,e),I._fwcObjType=n,this.object&&(this.object._fwcObjectInfo=I),this.equalizeTabHeight(),this.recenterDialog(),this.objectToDelete=null,this.showDialog()}).catch(h=>{p=this.translate.instant("ITEM_PANEL.ERRORS.IF_LOAD",{name:r,error:this.fwcErrorPipe.transform(h)}),this.showErrorMsg(p)});break;case v.OBJ_CONTINENT:case v.OBJ_GROUP:case v.OBJ_SERVICE_GROUP:Promise.all([this.getObjectGroup(t),this.getObjectGroupWhereUsed(t)]).then(([h,E])=>{let b=E.data,I=h.data;this.parseObject(I,i,e),b._fwcObjType=n,this.object&&(this.object._fwcObjectInfo=b),this.equalizeTabHeight(),this.recenterDialog(),this.objectToDelete=null,this.showDialog()}).catch(h=>{let E;E=this.fwcErrorPipe.transform(h),E&&(this.confirmationService.confirm({header:this.translate.instant("ITEM_PANEL.ERRORS.GROUP_READ.SUMMARY"),icon:"fa fa-exclamation-circle fwcRed iconBig",acceptLabel:"Ok",rejectVisible:!1,message:this.translate.instant("ITEM_PANEL.ERRORS.GROUP_READ.TEXT",{name:r,error:E})}),this.errorMessage=E.toString(),p=this.translate.instant("ITEM_PANEL.ERRORS.GRP_LOAD",{name:r,errorGrp:h}),this.showErrorMsg(p))});break;case v.OBJ_MARK:Promise.all([this.getMark(t),this.getMarkWhereUsed(t)]).then(([h,E])=>{let b=h.data,I=E.data;b.type=n,this.parseObject(b,i,e),I._fwcObjType=n,this.object&&(this.object._fwcObjectInfo=I),this.equalizeTabHeight(),this.recenterDialog(),this.objectToDelete=null,this.showDialog()}).catch(h=>{this.errorMessage=this.fwcErrorPipe.transform(h),p=this.translate.instant("ITEM_PANEL.ERRORS.OBJ_LOAD",{name:r,errorObject:this.errorMessage}),this.showErrorMsg(p)});break;case v.OBJ_OPENVPN_PREFIX:case v.OBJ_VPN_CONFIG_CLI:Promise.all([this.getVPNObject(t,n),this.getVPNObjecWhereUsedt(t,n)]).then(([h,E])=>{let b=h.data,I=E.data;b.name=b.cn,b.comment||(b.comment=""),b.fwcloud||(b.fwcloud=this.fwcUserService.getActualFwSelectedCloud()),this.parseObject(b,i,e),I._fwcObjType=n,this.object&&(this.object._fwcObjectInfo=I),this.equalizeTabHeight(),this.recenterDialog(),this.objectToDelete=null,this.showDialog()}).catch(h=>{this.errorMessage=this.fwcErrorPipe.transform(h),p=this.translate.instant("ITEM_PANEL.ERRORS.OBJ_LOAD",{name:r,errorObject:this.errorMessage}),this.showErrorMsg(p)});break;default:Promise.all([this.getObject(t),this.getObjectWhereUsed(t,n)]).then(([h,E])=>{let b=h.data,I=E.data;this.parseObject(b,i,e),I._fwcObjType=n,this.object&&(this.object._fwcObjectInfo=I),this.equalizeTabHeight(),this.recenterDialog(),this.objectToDelete=null,this.showDialog()}).catch(h=>{this.errorMessage=this.fwcErrorPipe.transform(h),p=this.translate.instant("ITEM_PANEL.ERRORS.OBJ_LOAD",{name:r,errorObject:this.errorMessage}),this.showErrorMsg(p)});break}}checkObjectRestrictions(e){let i,t,n,o="ITEM_PANEL.DELETE_WARN.TEXT",r="ITEM_PANEL.ERRORS.RESTR_ERROR.TEXT";if(this.deleteDialogTitle="ITEM_PANEL.HEADER.DEL_OBJ",!e)return;let p=E=>{this.okToDelete=!0,this.deleteMsg={type:"warning",title:this.translate.instant("ITEM_PANEL.DELETE_WARN.SUMMARY"),text:this.translate.instant(E,{name:e._fwcObjName})}};this.objectToDelete=e,this.dependencies=null,this.okToDelete=!1;let s={fwcloud:this.fwcUserObject.selectedFwCloud,id:e._fwcObjId,type:e._fwcObjType};switch(e._fwcObjType){case v.OBJ_INTERFACE_FIREWALL:i=this.fwcInterfaceService.checkInterfaceRestrictions.bind(this.fwcInterfaceService),n=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_INTERFACE_FIREWALL"),delete s.type;break;case v.OBJ_INTERFACE_HOST:i=this.fwcInterfaceService.checkInterfaceRestrictions.bind(this.fwcInterfaceService),n=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_INTERFACE_FIREWALL"),s.host=e._fwcHostId,delete s.type;break;case v.OBJ_GROUP:case v.OBJ_SERVICE_GROUP:i=this.fwcObjectService.checkObjectGroupRestrictions.bind(this.fwcObjectService),n=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_GROUP");break;case v.OBJ_FIREWALL:break;case v.OBJ_MARK:i=this.fwcMarkService.checkMarkRestrictions.bind(this.fwcMarkService),n=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_MARK"),s.mark=s.id,delete s.id,delete s.type;break;case v.OBJ_ROUTING_TABLE:i=this.fwcRoutingTableService.checkTableRestrictions.bind(this.fwcRoutingTableService),n=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_ROUTING_TABLE"),s.firewall=e._fwcFwId,o="ITEM_PANEL.DELETE_WARN.TEXT_ROUTING_TABLE",r="ITEM_PANEL.ERRORS.RESTR_ERROR.TEXT_ROUTING_TABLE",this.deleteDialogTitle="ITEM_PANEL.HEADER.DEL_ROUTING_TABLE";break;case v.OBJ_DHCP_GROUP:i=this.fwcDhcpPolicyService.checkGroupRestrictions.bind(this.fwcDhcpPolicyService),n=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_DHCP_GROUP"),s.firewall=e._fwcFwId,o="ITEM_PANEL.DELETE_WARN.TEXT_DHCP_GROUP",r="ITEM_PANEL.ERRORS.RESTR_ERROR.TEXT_DHCP_GROUP",this.deleteDialogTitle="ITEM_PANEL.HEADER.DEL_DHCP_GROUP";break;case v.OBJ_KEEPALIVED_GROUP:i=this.fwcDhcpPolicyService.checkGroupRestrictions.bind(this.fwcDhcpPolicyService),n=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_KEEPALIVED_GROUP"),s.firewall=e._fwcFwId,o="ITEM_PANEL.DELETE_WARN.TEXT_KEEPALIVED_GROUP",r="ITEM_PANEL.ERRORS.RESTR_ERROR.TEXT_KEEPALIVED_GROUP",this.deleteDialogTitle="ITEM_PANEL.HEADER.DEL_KEEPALIVED_GROUP";break;default:i=this.fwcObjectService.checkObjectRestrictions.bind(this.fwcObjectService),n=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_GEN_IP_OBJECT");break}let f,h;e._fwcObjType===v.OBJ_INTERFACE_FIREWALL||e._fwcObjType===v.OBJ_ADDRESS&&e._fwcFwId?e._fwcClusterId?(t=this.fwcFirewallService.getClusterNodes.bind(this.fwcFirewallService),f=e._fwcClusterId,h=this.translate.instant("CLUSTER.CLUSTER_NODE_ROLES.NODE")):(t=this.fwcFirewallService.getFirewall.bind(this.fwcFirewallService),f=e._fwcFwId,h=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.FIREWALL")):t=(E,b)=>so(null),i&&(this.loadingData=!0,Wi(i(s),t(f,this.fwcUserService.getActualFwSelectedCloud())).subscribe(([E,b])=>{let I;if(!b)I=null;else{let R=[],V=b.data;Array.isArray(V)?R=[...V]:R.push(V),I=R.find(G=>e._fwcObjType===v.OBJ_INTERFACE_FIREWALL&&G.install_interface===e._fwcObjId||e._fwcObjType===v.OBJ_ADDRESS&&G.install_ipobj===e._fwcObjId)}if(!I)p(o);else{let R=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_INTERFACE_FIREWALL");e._fwcObjType===v.OBJ_ADDRESS&&(R=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_ADDRESS")),this.deleteMsg={type:"error",title:this.translate.instant("ITEM_PANEL.ERRORS.INTERFACE_IP_INSTALLATION.SUMMARY",{objType:R}),text:this.translate.instant("ITEM_PANEL.ERRORS.INTERFACE_IP_INSTALLATION.TEXT",{objName:e._fwcObjName,objType:R.toLowerCase(),fwName:I.name,fwType:h.toLowerCase()})}}this.dependencies=null,this.loadingData=!1,this.recenterDialog()},E=>{let b,I=E.error;if(I&&(I.restrictions?b=I.restrictions:I.data&&I.data.restrictions&&(b=I.data.restrictions)),b){this.dependencies=b;let R={};for(let V in this.dependencies)V!=="IpobjInterface"&&Array.isArray(this.dependencies[V])&&this.dependencies[V].length&&(R[V]=this.dependencies[V]);Object.keys(R).length?(R._fwcRestrictedObject={_fwcObjId:e._fwcObjId,_fwcObjType:e._fwcObjType},this.deleteMsg={type:"error",title:this.translate.instant("ITEM_PANEL.ERRORS.RESTR_ERROR.SUMMARY"),text:this.translate.instant(r,{name:e._fwcObjName})}):(this.dependencies=null,p(o))}else this.deleteMsg={type:"error",title:this.translate.instant("ITEM_PANEL.ERRORS.DELETE_ERROR.SUMMARY"),text:this.fwcErrorPipe.transform(E)},this.dependencies={restrictionsError:!0};this.loadingData=!1,this.recenterDialog()}))}onDeleteObject(){let e,i;this.loadingData=!0;let t={fwcloud:this.fwcUserObject.selectedFwCloud,id:this.objectToDelete._fwcObjId,type:this.objectToDelete._fwcObjType};switch(this.objectToDelete._fwcObjType){case v.OBJ_INTERFACE_FIREWALL:e=this.fwcInterfaceService.deleteInterfaceFw.bind(this.fwcInterfaceService),i=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_INTERFACE_FIREWALL"),t.firewall=this.objectToDelete._fwcFwId;break;case v.OBJ_INTERFACE_HOST:e=this.fwcInterfaceService.deleteInterfaceHost.bind(this.fwcInterfaceService),i=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_INTERFACE_FIREWALL"),t.host=this.objectToDelete._fwcHostId;break;case v.OBJ_GROUP:case v.OBJ_SERVICE_GROUP:e=this.fwcObjectService.deleteObjectGroup.bind(this.fwcObjectService),i=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_GROUP");break;case v.OBJ_FIREWALL:break;case v.OBJ_MARK:e=this.fwcMarkService.deleteMark.bind(this.fwcMarkService),i=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_MARK"),t.mark=t.id,delete t.id,delete t.type;break;case v.OBJ_ROUTING_TABLE:e=this.fwcRoutingTableService.deleteRoutingTable.bind(this.fwcRoutingTableService),i=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_ROUTING_TABLE"),t.firewall=this.objectToDelete._fwcFwId,delete t.type;break;case v.OBJ_DHCP_GROUP:e=this.fwcDhcpPolicyService.deleteDhcpPolicyRulesGroup.bind(this.fwcDhcpPolicyService),i=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_DHCP_GROUP"),t.firewall=this.objectToDelete._fwcFwId,delete t.type;break;default:e=this.fwcObjectService.deleteObject.bind(this.fwcObjectService),i=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_GEN_IP_OBJECT");break}this.utilService.fwcAPICall(e,t).then(n=>{let o=Object.assign({},this.objectToDelete),r=this.translate.instant("TREE.MSG_DELETE_OBJ_SUCCESS_1",{objtype:i});if(o._fwcTreeAction=Ne.DELETE_ITEM,n.data&&n.data.fw_status&&(o.fw_status=n.data.fw_status),this.itemSelectedService.setModifiedItem(o),this.objectToDelete._fwcObjType===v.OBJ_ROUTING_TABLE){r=this.translate.instant("ROUTING.DELETE_TABLE.SUCCESS"),this.itemSelectedService.setModifiedItem({_fwcTreeAction:Ne.RELOAD_TREE,containerToReload:it.C_FIREWALLS});let p=this.fwcPolicyService.getActualSelectedPolicy();p&&p._fwcPolicyType===Ee.ROUTING_TABLE&&p._fwcObjId===this.objectToDelete._fwcObjId&&this.fwcPolicyService.setSelectedPolicy({_fwcFwId:null,fwId:null})}Array.isArray(n.data)&&this.store.dispatch(ze.updateFwStatus({item:n.data})),this.hideDialog(),this.loadingData=!1,this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.OK"),detail:r})}).catch(n=>{this.deleteMsg={type:"error",title:this.translate.instant("ITEM_PANEL.ERRORS.DELETE_ERROR.SUMMARY"),text:this.fwcErrorPipe.transform(n)},this.dependencies={restrictionsError:!0},this.loadingData=!1})}showErrorMsg(e){e&&this.confirmationService.confirm({header:"Error",icon:"fa fa-exclamation-circle fwcRed iconBig",acceptLabel:"Ok",rejectVisible:!1,message:e})}getObject(e){return new Promise((t,n)=>{this.fwcObjectService.getObject(e,this.fwcUserObject.selectedFwCloud).subscribe(o=>{t(o)},o=>{n(o)})})}getObjectWhereUsed(e,i){return new Promise((n,o)=>{this.fwcObjectService.getObjectWhereUsed(e,i,this.fwcUserObject.selectedFwCloud).subscribe(r=>{n(r)},r=>{o(r)})})}getInterface(e,i){return new Promise((n,o)=>{this.fwcInterfaceService.getInterface(e,i,this.fwcUserObject.selectedFwCloud).subscribe(r=>{n(r)},r=>{o(r)})})}getInterfaceHost(e,i){return new Promise((n,o)=>{this.fwcInterfaceService.getInterfaceHost(e,i,this.fwcUserObject.selectedFwCloud).subscribe(r=>{n(r)},r=>{o(r)})})}getInterfaceWhereUsed(e,i){return new Promise((n,o)=>{this.fwcInterfaceService.getInterfaceWhereUsed(e,i,this.fwcUserObject.selectedFwCloud).subscribe(r=>{n(r)},r=>{o(r)})})}getObjectGroup(e){return new Promise((t,n)=>{this.fwcObjectService.getObjectGroup(e,this.fwcUserObject.selectedFwCloud).subscribe(o=>{t(o)},o=>{n(o)})})}getObjectGroupWhereUsed(e){return new Promise((t,n)=>{this.fwcObjectService.getObjectGroupWhereUsed(e,this.fwcUserObject.selectedFwCloud).subscribe(o=>{t(o)},o=>{n(o)})})}getVPNObject(e,i){return new Promise((n,o)=>{let r,p={fwcloud:this.fwcUserService.getActualFwSelectedCloud()};i==v.OBJ_OPENVPN_PREFIX?(r=this.fwcVpnService.getOpenVPNPrefixInfo.bind(this.fwcVpnService),p.prefix=e):i==v.OBJ_VPN_CONFIG_CLI&&(r=this.fwcVpnService.getConfigInfo.bind(this.fwcVpnService),p.openvpn=e),r(p).subscribe(s=>{n(s)},s=>{o(s)})})}getVPNObjecWhereUsedt(e,i){return new Promise((n,o)=>{let r,p={fwcloud:this.fwcUserService.getActualFwSelectedCloud()};i==v.OBJ_OPENVPN_PREFIX?(r=this.fwcVpnService.getOpenVPNWhereUsed.bind(this.fwcVpnService),p.prefix=e):i==v.OBJ_VPN_CONFIG_CLI&&(r=this.fwcVpnService.getConfigWhereUsed.bind(this.fwcVpnService),p.openvpn=e),r(p).subscribe(s=>{n(s)},s=>{o(s)})})}getMark(e){return new Promise((t,n)=>{let o={fwcloud:this.fwcUserObject.selectedFwCloud,mark:e};this.fwcMarkService.getMark(o).subscribe(r=>{t(r)},r=>{n(r)})})}getMarkWhereUsed(e){return new Promise((t,n)=>{let o={fwcloud:this.fwcUserObject.selectedFwCloud,mark:e};this.fwcMarkService.getMarkWhereUsed(o).subscribe(r=>{t(r)},r=>{n(r)})})}onRuleSelect(e){let i,t,n,o,r,p;if(i=this.fwcUserObject.customer_id,t=this.fwcUserObject.selectedFwCloud,n=e.firewall,o=e.type,r=e.id,!i||!t||!n||!o||!r){this.showErrorMsg(this.translate.instant("ITEM_PANEL.ERRORS.RULE_LOAD",{id:r}));return}e.type===q[X.DHCP]||e.type===q[X.DHCP_FIXED_IP]||e.type===q[X.KEEPALIVED]||e.type===q[X.HAPROXY]||this.fwcPolicyService.getPolicyRule(n,o,r,this.fwcUserObject.selectedFwCloud).pipe($(()=>this.alive)).subscribe(s=>{let f;s.data&&(f=s.data,p=Object.assign({},e),delete p.positions,p.fwcloud=this.fwcUserObject.selectedFwCloud,p.name=this.translate.instant("ITEM_PANEL.RULE_NAME"),p.type=v.OBJ_GEN_RULE,p.ruleType=o,this.parseObject(p),this.showDialog())},s=>{this.errorMessage=this.fwcErrorPipe.transform(s),this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.errorMessage})})}parseObject(e,i,t){let n=0;!e||e.id===void 0||e.name===void 0||e.comment===void 0||(e._fwcObjId=e.id,e._fwcObjName=e.name,e._fwcObjType=e.type,e.type==v.OBJ_CONTINENT?e.name=this.translate.instant("NODE_TYPES."+e.name):e.type==v.OBJ_COUNTRIE&&(e.name=this.translate.instant("COUNTRIES."+e.name)),e.firewall!==null&&e.firewall!=null&&(e._fwcFwId=e.firewall),e.ipobjs&&e.ipobjs.forEach(function(o){o._fwcObjId=o.id,o._fwcObjName=o.name,o._fwcObjType=o.obj_type=o.type}),t&&t.duplicateObjectAction&&(e.id=e._fwcObjId=void 0,e._fwcObjName=e.name=e.name+"-DUP",e.container=t.container,e.containerReadOnly=t.containerReadonly,e.duplicateObjectAction=!0,e.node_parent=t.node_parent,e.node_order=1,e.node_type=t.node_type,e.fwcloud=this.fwcUserObject.selectedFwCloud),this.createForm(e),i&&(n=1,e.whereUsedAction=i),this.object=e,this.disableTabChange||(this.tabIndex=n))}newObject(e){this.createForm(e),this.object=e,this.showDialog()}createForm(e){if(e){switch(this.formModel=new ri({id:new k(e.id),comment:new k(e.comment),type:new k(e.type)}),e.type!=v.OBJ_GEN_RULE&&this.formModel.addControl("name",new k(e.name,[Q.required,Q.pattern(ye.nameRegExp)])),e.type){case v.OBJ_FIREWALL:break;case v.OBJ_ADDRESS:this.formModel.addControl("address",new k(e.address,ye.ipAddressValidator.bind(this))),this.formModel.addControl("netmask",new k(e.netmask,ye.netmaskValidator.bind(this))),this.formModel.addControl("ip_version",new k(e.ip_version?e.ip_version:this.ipVersions[0].id)),this.formModel.addControl("interface",new k(e.interface));break;case v.OBJ_ADDRESS_RANGE:this.formModel.addControl("range_start",new k(e.range_start,ye.ipAddressValidator.bind(this))),this.formModel.addControl("range_end",new k(e.range_end,ye.ipAddressValidator.bind(this))),this.formModel.addControl("ip_version",new k(e.ip_version?e.ip_version:this.ipVersions[0].id));break;case v.OBJ_NETWORK:this.formModel.addControl("address",new k(e.address,ye.ipAddressValidator.bind(this))),this.formModel.addControl("netmask",new k(e.netmask,ye.netmaskValidator.bind(this))),this.formModel.addControl("ip_version",new k(e.ip_version?e.ip_version:this.ipVersions[0].id));break;case v.OBJ_HOST:break;case v.OBJ_GROUP:break;case v.OBJ_DNS:this.formModel.controls.name.setValidators([Q.required,Q.pattern(ye.fqdnRegexp)]);break;case v.OBJ_INTERFACE_HOST:case v.OBJ_INTERFACE_FIREWALL:this.formModel.addControl("labelName",new k(e.labelName,Q.pattern(ye.nameRegExp))),this.formModel.addControl("mac",new k(e.mac,Q.pattern(ye.macRegexp)));break;case v.OBJ_SERVICE_IP:this.formModel.addControl("protocol",new k(e.protocol,[Q.min(0),Q.max(255)]));break;case v.OBJ_SERVICE_TCP:this.formModel.addControl("tcp_flags_mask",new k(e.tcp_flags_mask)),this.formModel.addControl("tcp_flags_settings",new k(e.tcp_flags_settings)),this.formModel.addControl("source_port_start",new k(e.source_port_start?e.source_port_start:0,[Q.required,Q.min(0),Q.max(65535)])),this.formModel.addControl("source_port_end",new k(e.source_port_end?e.source_port_end:0,[Q.required,Q.min(0),Q.max(65535)])),this.formModel.addControl("destination_port_start",new k(e.destination_port_start?e.destination_port_start:0,[Q.required,Q.min(0),Q.max(65535)])),this.formModel.addControl("destination_port_end",new k(e.destination_port_end?e.destination_port_end:0,[Q.required,Q.min(0),Q.max(65535)])),this.formModel.addControl("protocol",new k(e.protocol,[Q.min(0),Q.max(255)])),this.formModel.setValidators([this.srcPortsValidator,this.destPortsValidator]),this.setTCPFlags(e.tcp_flags_mask,e.tcp_flags_settings);break;case v.OBJ_SERVICE_ICMP:this.formModel.addControl("icmp_type",new k(e.icmp_type?e.icmp_type:-1,[Q.required,Q.min(-1),Q.max(255)])),this.formModel.addControl("icmp_code",new k(e.icmp_code?e.icmp_code:-1,[Q.required,Q.min(-1),Q.max(255)])),this.formModel.addControl("protocol",new k(e.protocol,[Q.min(0),Q.max(255)]));break;case v.OBJ_SERVICE_UDP:this.formModel.addControl("source_port_start",new k(e.source_port_start?e.source_port_start:0,[Q.required,Q.min(0),Q.max(65535)])),this.formModel.addControl("source_port_end",new k(e.source_port_end?e.source_port_end:0,[Q.required,Q.min(0),Q.max(65535)])),this.formModel.addControl("destination_port_start",new k(e.destination_port_start?e.destination_port_start:0,[Q.required,Q.min(0),Q.max(65535)])),this.formModel.addControl("destination_port_end",new k(e.destination_port_end?e.destination_port_end:0,[Q.required,Q.min(0),Q.max(65535)])),this.formModel.addControl("protocol",new k(e.protocol,[Q.min(0),Q.max(255)])),this.formModel.setValidators([this.srcPortsValidator,this.destPortsValidator]);break;case v.OBJ_SERVICE_GROUP:break;case v.OBJ_GEN_RULE:this.formModel.addControl("firewall",new k(e.firewall)),this.formModel.addControl("options",new k(e.options)),this.formModel.addControl("run_before",new k(e.run_before)),this.formModel.addControl("run_after",new k(e.run_after)),this.setOptionsFlags(e);break;case v.OBJ_MARK:this.formModel.addControl("code",new k(e.code,[Q.required,Q.min(1)]));break}e.duplicateObjectAction&&this.formModel.markAsDirty()}}setOptionsFlags(e){if(e){let i;for(let t=0;t<this.optionsFlags.length;t++){let n=this.optionsFlags[t];i=!!(e.options&2**t),n.status=i}}}onChangeOptionsFlags(e){let i,t=0;i=this.optionsFlags[e].optionGroup;for(let n=0;n<this.optionsFlags.length;n++)i==this.optionsFlags[n].optionGroup&&n!=e&&(this.optionsFlags[n].status=!1),this.optionsFlags[n].status&&(t|=2**n);this.formModel.controls.options.setValue(t),this.formModel.markAsDirty()}setTCPFlags(e,i){let t=["URG","ACK","PSH","RST","SYN","FIN"];this.tcpFlagsArray=[];for(let n=0;n<t.length;n++){let o,r=t[n],p=!!(e&2**n),s=!!(i&2**n);o={name:r,mask:p,status:s},this.tcpFlagsArray.push(o)}}setFormTCPFlags(e){let i=0,t=0;this.tcpFlagsArray[e].mask||(this.tcpFlagsArray[e].status=!1);for(let n=0;n<this.tcpFlagsArray.length;n++){let o=this.tcpFlagsArray[n].mask,r=this.tcpFlagsArray[n].status;o&&(i|=2**n),r&&(t|=2**n)}this.formModel.controls.tcp_flags_mask.setValue(i),this.formModel.controls.tcp_flags_settings.setValue(t),this.formModel.markAsDirty()}checkForm(e){e&&e.target&&e.target.type!="textarea"&&this.formModel.valid&&(e.target.blur(),this.onSave())}onSave(e=0){if(this.object)if(this.loadingData=!0,this.objErrorMessage=null,this.object.id==null){let i={fwcloud:this.fwcUserObject.selectedFwCloud},t=this.object;for(let r in this.formModel.controls)i[r]=t[r]=this.formModel.controls[r].value!==null&&this.formModel.controls[r].value!==void 0?this.formModel.controls[r].value:void 0;this.object.type!=v.OBJ_MARK&&(i.node_parent=+this.object.node_parent,i.node_order=+this.object.node_order,i.node_type=this.object.node_type),e&&(i.force=e);let n,o;switch(this.object.type){case v.OBJ_FIREWALL:o=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.FIREWALL");break;case v.OBJ_INTERFACE_FIREWALL:case v.OBJ_INTERFACE_HOST:n=this.fwcInterfaceService.newInterface.bind(this.fwcInterfaceService),o=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_INTERFACE_FIREWALL"),i.firewall=this.object.firewall||this.object.firewall_id||this.object._fwcFwId,i.host=this.object.host||this.object.host_id||this.object._fwcHostId,i.interface_type=this.object.interface_type;break;case v.OBJ_GROUP:case v.OBJ_SERVICE_GROUP:n=this.fwcObjectService.newObjectGroup.bind(this.fwcObjectService),o=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_GROUP");break;case v.OBJ_MARK:n=this.fwcMarkService.newMark.bind(this.fwcMarkService),o=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_MARK"),i.node_id=this.object.node_parent,delete i.type;break;default:n=this.fwcObjectService.newObject.bind(this.fwcObjectService),o=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_GEN_IP_OBJECT");break}this.utilService.fwcAPICall(n,i).then(r=>{let p=r.data.insertId,s=r.data.TreeinsertId;this.object.id=this.object.id_obj=this.object._fwcObjId=p,this.formModel.controls.id.setValue(p),this.object.id_node=this.object._fwcObjTreeId=s,this.object._fwcObjTreeParentId=this.object.node_parent,this.object.text=this.object.name,this.object.obj_type=this.object._fwcObjType,this.object.firewall!==void 0&&this.object.firewall!==null&&(this.object._fwcFwId=this.object.firewall),t._fwcTreeAction=Ne.NEW_ITEM,this.itemSelectedService.setModifiedItem(t),r.data&&r.data.fw_status&&this.store.dispatch(ze.updateFwStatus({item:r.data.fw_status})),this.formModel.markAsPristine(),this.object._fwcObjType==v.OBJ_GROUP||this.object._fwcObjType==v.OBJ_SERVICE_GROUP?(this.displayDialog=!0,this.onItemSelect(this.object)):this.onCancel(),this.loadingData=!1,this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.OK"),detail:this.translate.instant("ITEM_PANEL.OBJ_CREATED",{objType:o})})}).catch(r=>{if(r&&r.status==400&&r.error&&r.error.fwcErr==1003)if(this.object.type!=v.OBJ_MARK){let p=r.data;this.confirmDuplicateOperation(p)}else this.confirmationService.confirm({header:this.translate.instant("ITEM_PANEL.ERRORS.DUP_MARK_ERROR.SUMMARY"),icon:"fa fa-exclamation-circle fwcRed iconBig",acceptLabel:"Ok",rejectVisible:!1,message:this.translate.instant("ITEM_PANEL.ERRORS.DUP_MARK_ERROR.TEXT")});else this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(r)});this.loadingData=!1})}else{if(!this.object.fwcloud&&this.object.type!=v.OBJ_INTERFACE_FIREWALL)return;let i={fwcloud:this.fwcUserObject.selectedFwCloud},t=Object.assign({},this.object);for(let r in this.formModel.controls)i[r]=t[r]=this.formModel.controls[r].value!==null&&this.formModel.controls[r].value!==void 0?this.formModel.controls[r].value:void 0;this.formModel.controls.name&&(t._fwcObjName=this.formModel.controls.name.value),t._fwcUserId=this.fwcUserObject.user_id;let n,o;switch(t.type){case v.OBJ_FIREWALL:n=this.fwcFirewallService.updateFirewall.bind(this.fwcFirewallService),o=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.FIREWALL");break;case v.OBJ_INTERFACE_FIREWALL:case v.OBJ_INTERFACE_HOST:n=this.fwcInterfaceService.updateInterface.bind(this.fwcInterfaceService),o=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_INTERFACE_FIREWALL"),i.interface_type=this.object.interface_type;break;case v.OBJ_GROUP:case v.OBJ_SERVICE_GROUP:n=this.fwcObjectService.updateObjectGroup.bind(this.fwcObjectService),o=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_GROUP");break;case v.OBJ_GEN_RULE:n=this.fwcPolicyService.updatePolicyRuleAsObject.bind(this.fwcPolicyService),o=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_RULE"),i.type=t.type=t.ruleType,i.run_before||(i.run_before=null),i.run_after||(i.run_after=null),i.rule=i.id,delete i.id;break;case v.OBJ_MARK:n=this.fwcMarkService.updateMark.bind(this.fwcMarkService),o=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_MARK"),i.mark=i.id,delete i.id,delete i.type;break;default:n=this.fwcObjectService.updateObject.bind(this.fwcObjectService),o=this.translate.instant("GLOBALS.MSG_OBJ_TYPES.OBJ_GEN_IP_OBJECT");break}e&&(i.force=e),this.utilService.fwcAPICall(n,i).then(r=>{if(r.data&&r.data.fw_status&&(t.fw_status=r.data.fw_status),t.ruleType){let p;p={id:t.id,firewall:t.firewall,type:t.ruleType,options:t.options,run_before:t.run_before,run_after:t.run_after},this.ruleSelectedService.setModifiedRule(p),this.store.dispatch(ze.updateFwStatus({item:{cluster:this.object._fwcClusterId,id:this.object._fwcFwId,status:3}}))}else t._fwcTreeAction=Ne.MODIFY_ITEM,this.itemSelectedService.setModifiedItem(t),this.store.dispatch(ze.updateFwStatus({item:t.fw_status})),this.itemSelectedService.updateClipboardItem(t);this.loadingData=!1,this.formModel.markAsPristine(),this.onCancel(),this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.OK"),detail:this.translate.instant("ITEM_PANEL.OBJ_UPDATED",{objType:o})})}).catch(r=>{if(r&&r.status==400&&r.error&&r.error.fwcErr==1003)if(this.object.type!=v.OBJ_MARK){let p;Array.isArray(r.data)&&(p=r.data.filter(s=>s.id!=this.object.id),p&&p.length&&this.confirmDuplicateOperation(p))}else this.confirmationService.confirm({header:this.translate.instant("ITEM_PANEL.ERRORS.DUP_MARK_ERROR.SUMMARY"),icon:"fa fa-exclamation-circle fwcRed iconBig",acceptLabel:"Ok",rejectVisible:!1,message:this.translate.instant("ITEM_PANEL.ERRORS.DUP_MARK_ERROR.TEXT")});else r&&r.status===400&&r.data==="The interface cannot be updated. There are references in dhcp_r."?this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.translate.instant("ITEM_PANEL.ERRORS.INTERFACE_MAC_ERROR.TEXT")}):this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(r)});this.loadingData=!1})}}onCancel(e){!e&&this.formModel&&!this.formModel.pristine&&this.formModel.valid?this.confirmationService.confirm({header:this.translate.instant("GLOBALS.MSG_CONFIRM"),icon:"fa fa-question-circle fwcBlue iconBig",message:this.translate.instant("ITEM_PANEL.MSG_EXIT"),accept:()=>{this.onCancel(!0)},rejectVisible:!0,rejectLabel:"No",acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.YES")}):(this.hideDialog(),this.objErrorMessage=null,this.object=null,this.objectToDelete=null,this.fwcUserService.setConfirmationToken(void 0),this.deleteMsg=null)}equalizeTabHeight(){}onDialogShow(){setTimeout(()=>{this.inputObjName&&this.inputObjName.nativeElement.focus();let e=0;this.object&&this.object.whereUsedAction&&(e=1),this.tabIndex=e,this.equalizeTabHeight(),this.recenterDialog()},150)}onDialogHide(){}onTabChange(e){e&&(this.tabIndex=e.index,this.recenterDialog())}showRestrictions(e,i){e&&(e._fwcShowRestrictions=!0,this.infoTooltipTimer=setTimeout(()=>{this.infoTooltipShown=!0,this.itemSelectedService.setObjectInfo(e,i)},1e3))}hideRestrictions(e){this.infoTooltipTimer&&(clearTimeout(this.infoTooltipTimer),this.infoTooltipTimer=void 0),this.infoTooltipShown&&(this.itemSelectedService.setObjectInfo(void 0,e),this.infoTooltipShown=!1)}confirmDuplicateOperation(e){let i="";if(this.loadingData=!1,e.length){i="<ul>";for(let t=0;t<e.length;t++)i+="<li><strong>"+e[t].name+"</strong> (Id: "+e[t].id+") </li>";i+="</ul>"}this.confirmationService.confirm({header:this.translate.instant("ITEM_PANEL.ERRORS.DUP_WARNING.SUMMARY"),icon:"fa fa-question-circle fwcBlue iconBig",message:this.translate.instant("ITEM_PANEL.ERRORS.DUP_WARNING.TEXT",{objects:i}),rejectVisible:!0,rejectLabel:"No",acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.YES"),accept:()=>{this.onSave(1)}})}static{this.\u0275fac=function(i){return new(i||l)(F(De),F(Fe),F(dn),F(oe),F(We),F(de),F(At),F(pn),F(Go),F(gt),F(sn),F(se),F(un),F($t),F(Ie),F(_e),F(ue),F(ce),F(we),F(ie),F(Hi),F(Bt),F(pe),F(Ft))}}static{this.\u0275cmp=Le({type:l,selectors:[["sts-fwc-item-panel"]],viewQuery:function(i,t){if(i&1&&(Se(Kp,5),Se(Xp,5)),i&2){let n;le(n=re())&&(t.tbvItemTabview=n.first),le(n=re())&&(t.inputObjName=n.first)}},features:[$e([dn,oe,We,pn,sn]),Rt],decls:6,vars:6,consts:[["dlgItemPanel",""],["tbvItemTabview",""],["inputObjName",""],[3,"visibleChange","onShow","onHide","styleClass","visible","modal","closable"],["pTemplate","header"],["styleClass","objectInfoTab",3,"activeIndex"],["pTemplate","footer"],[1,"divFormHeader"],[1,"divHeaderButtons"],["pButton","","type","button","icon","fa fa-question",1,"p-button-primary",3,"disabled"],["pButton","","type","button","icon","fa fa-window-minimize",1,"p-button-secondary",3,"click"],[1,"fwcWhite","fwcIconLeft"],[1,"fwcMenuIcon","fwci-edit","fwcOrange"],[1,"fwcSep"],["aria-hidden","true"],[1,"fwcMenuIcon","fwci-new","fwcOrange"],[1,"fwcMenuIcon","fwci-delete","fwcOrange"],["pButton","","type","button","icon","fa fa-question",1,"p-button-primary",3,"click","disabled"],["styleClass","objectInfoTab",3,"onChange","activeIndex"],["leftIcon","fa fa-pencil",3,"header","disabled"],[1,"fwcObjectPanel"],[3,"formGroup"],[3,"keyup.enter","keyup.esc","disabled"],[1,"grid"],[3,"ngClass"],[1,"col-6"],[1,"col-4"],[1,"col-12"],[1,"col-3"],["leftIcon","fa fa-info-circle",3,"header","disabled"],["id","infoPanel"],[1,"col-12","grid","grid-nogutter"],[1,"p-inputgroup"],[1,"p-float-label"],["pInputText","","type","text","formControlName","name","name","name","maxlength","64",3,"drop"],["for","name"],[1,"fwc-error",3,"ngStyle"],["pInputText","","type","text","maxlength","45","formControlName","address","name","address",3,"drop"],["for","address"],["pInputText","","type","text","maxlength","15","formControlName","netmask","name","netmask",3,"drop"],["for","netmask"],["pInputText","","type","text","maxlength","45","formControlName","range_start","name","range_start",3,"drop"],["for","range_start"],["pInputText","","type","text","maxlength","45","formControlName","range_end","name","range_end",3,"drop"],["for","range_end"],["formControlName","ip_version","name","ip_version",1,"fwcSelect",3,"change"],[3,"ngValue"],["for","ip_version"],[3,"groupId","readOnly","groupType","groupTreeId","ipobjs"],[1,"fwcFloatLabel"],["pInputText","","type","number","formControlName","protocol","name","protocol","min","0","max","255",3,"drop","click"],["for","protocol"],["styleClass","fieldsetFixed",3,"legend"],["pInputText","","type","number","formControlName","source_port_start","name","source_port_start","min","0","max","65535",3,"drop","click"],["for","source_port_start"],["pInputText","","type","number","formControlName","source_port_end","name","source_port_end","min","0","max","65535",3,"drop","click"],["for","source_port_end"],["pInputText","","type","number","formControlName","destination_port_start","name","destination_port_start","min","0","max","65535",3,"drop","click"],["for","destination_port_start"],["pInputText","","type","number","formControlName","destination_port_end","name","destination_port_end","min","0","max","65535",3,"drop","click"],["for","destination_port_end"],["type","hidden","formControlName","tcp_flags_mask","name","tcp_flags_mask"],["type","hidden","formControlName","tcp_flags_settings","name","tcp_flags_settings"],[1,"unstriped","fwcFlagsTable"],[3,"ngModelChange","onChange","binary","ngModel","ngModelOptions","disabled"],[3,"ngModelChange","onChange","binary","ngModel","ngModelOptions","ngStyle","disabled"],["formControlName","icmp_type","name","icmp_type",1,"fwcSelect"],["for","icmp_type"],["formControlName","icmp_code","name","icmp_code",1,"fwcSelect"],["for","icmp_code"],["pInputText","","type","text","maxlength","64","formControlName","labelName","name","labelName",3,"drop"],["for","labelName"],["pInputText","","type","text","maxlength","17","formControlName","mac","name","mac",3,"drop"],["for","mac"],["pInputText","","type","number","formControlName","code","name","code",3,"drop"],["for","code"],[1,"col-12","md:col-4"],[1,"noVertPad","fwcBlue","botBorder"],[1,"col-12","md:col-8"],["styleClass","tbvRuleHooks"],["leftIcon","fa fa-fw fa-upload",3,"header"],["pInputTextarea","","formControlName","run_before",2,"margin-top","0 !important",3,"placeholder"],[1,"fwc-right"],["type","button","pButton","","icon","fa fa-trash",1,"p-button-danger",3,"click","disabled","label"],["leftIcon","fa fa-fw fa-download",3,"header"],["pInputTextarea","","formControlName","run_after",2,"margin-top","0 !important",3,"placeholder"],[3,"ngModelChange","onChange","binary","disabled","ngModel","ngModelOptions","label"],["pInputTextarea","","formControlName","comment","name","comment","maxlength","255",3,"drop"],["for","comment"],[3,"message"],[2,"width","100%"],[3,"onHideParent","objectInfo"],[1,"col-12","divCentered"],[1,"fwcRestrictionsContainer"],[3,"onHideParent","onRefreshRestrictions","dependencies"],["pButton","","icon","pi pi-times",1,"p-button-primary",3,"disabled","label"],["pButton","","icon","pi pi-times",1,"p-button-primary",3,"label"],[1,"divLoadTemp",3,"ngStyle"],["pButton","","icon","pi pi-times",1,"p-button-danger",3,"label","disabled"],["pButton","","icon","fa fa-save",1,"p-button-success",3,"label","disabled"],["pButton","","icon","pi pi-times",1,"p-button-danger",3,"click","label","disabled"],["pButton","","icon","fa fa-save",1,"p-button-success",3,"click","label","disabled"],["pButton","","icon","pi pi-times",1,"p-button-primary",3,"click","label"],["type","button","pButton","","icon","fa fa-refresh",1,"fwc-left-float","p-button-primary",3,"disabled","label"],["type","button","pButton","","icon","pi pi-check",1,"p-button-primary",3,"click","label"],["type","button","pButton","","icon","fa fa-refresh",1,"fwc-left-float","p-button-primary",3,"click","disabled","label"],["pButton","","icon","pi pi-times",1,"p-button-primary",3,"click","disabled","label"]],template:function(i,t){if(i&1){let n=L();c(0,"p-dialog",3,0),J("visibleChange",function(r){return w(n),Y(t.displayDialog,r)||(t.displayDialog=r),S(r)}),P("onShow",function(){return w(n),S(t.onDialogShow())})("onHide",function(){return w(n),S(t.onDialogHide())}),A(2,pd,5,3,"ng-template",4)(3,Jd,35,34,"p-tabView",5)(4,Qd,3,2)(5,a_,3,3,"ng-template",6),u()}i&2&&(m("styleClass",(t.object==null?null:t.object.type)!=t.ObjectTypes.OBJ_GROUP&&(t.object==null?null:t.object.type)!=t.ObjectTypes.OBJ_SERVICE_GROUP?"dlgFwcDialog fwcObjectDialog":"dlgFwcDialog fwcObjectDialog fwcObjectDialog--small"),H("visible",t.displayDialog),m("modal",!1)("closable",!1),a(3),O(t.object?3:-1),a(),O(t.objectToDelete?4:-1))},dependencies:[et,Vt,Si,Ei,vi,Ht,Yt,yi,ht,wi,Jt,Ii,Oo,wt,bo,gi,Ci,il,Ni,Nt,pl,Mt,Ue,lt,Lt,qt,Li,Di,Mi,Jo,yt,wn,nt],styles:[`:root{--lightColor: #eee;--darkColor: #222;--inputBackgroundColor: #eee;--inputBorderColor: #cacaca;--inputColor: #222;--surfaceBackgroundColor: white;--fixedWhiteColor: #eee;--fixedDarkColor: #333;--translucidColor: transparent;--menuBackground: url(/assets/img/fwc-fondo-menu.jpg);--mainBackground: url(/assets/img/fwc-fondo-home.jpg);--fwcBlue: #0069a7;--fwcBlueDarkened: #005e96;--fwcDarkBlue: #003351;--fwcDarkBlue2: #014071;--fwcLightBlue: #1779ba;--fwcPaleBlue: #689fe1;--fwcPaleBlue2: #cce2f8;--fwcPaleBlue3: #e6f1fd;--fwcBlueGradient1: #386ea0;--fwcBlueGradient2: #21517e;--fwcLightGreyGradient1: #f6f7f9;--fwcLightGreyGradient2: #ebedf0;--fwcOrange: #eb6400;--fwcPaleOrange: #e67e22;--fwcPaleOrange2: #ffcfa4;--fwcPaleOrange3: #fe7815;--fwcOrangeRed: #e74c3c;--fwcRed: #f00;--fwcRed2: #b40b00;--fwcPaleRed: #f77676;--fwcPaleRed2: #ffe1e1;--fwcTranslucidRed: rgba(255, 0, 0, .15);--fwcDarkGreen: #023008;--fwcGreen: #009900;--fwcLightGreen: #28ff28;--fwcPaleGreen: #c7e6c8;--fwcLime: #baf649;--fwcWhite: #eee;--fwcPaleWhite: #f5f5f5;--fwcPaleWhite2: #f4f4f4;--fwcDark: #222;--fwcLightDark: #1e1e1e;--fwcMidDark: #555;--fwcMidDark2: #333;--fwcPaleDark: #888;--fwcPaleDark2: #383838;--fwcGrey: #cacaca;--fwcGrey2: #cecece;--fwcGrey3: #eee;--fwcGrey4: #e5e5e5;--fwcGrey5: #c8c8c8;--fwcGrey6: #efefef;--fwcGrey7: #dedede;--fwcAccent: #ff4081;--fwcShadow: #bbb;--fwcSelected: #ddd;--fwcSelectedB: #0069a7;--fwcRulePink: #ef9a9a;--fwcRulePurple: #ce93d8;--fwcRuleBlue: #90caf9;--fwcRuleTeal: #80cbc4;--fwcRuleGreen: #a5d6a7;--fwcRuleYellow: #fff59d;--fwcRuleOrange: #ffcc80}.modalMsg{text-align:center;border-bottom:1px solid}div.fwcItemData{padding-bottom:2rem}.fwcFlagsTable{font-size:.9em}.fwcFlagsTable th,.fwcFlagsTable td{padding:.2rem}.fieldsetFixed{height:10rem}.fieldsetFixed .p-fieldset-legend-text{font-family:Arial,Montserrat,sans-serif;color:var(--fwcPaleDark)}.tbvRuleHooks.p-tabview{padding:0}.tbvRuleHooks textarea{font-family:monospace!important;height:10rem!important}.p-float-label textarea.p-filled~label{top:0;margin-top:-2rem}.p-float-label textarea:focus~label{margin-top:-.5rem}
`],encapsulation:2,data:{animation:[hn]}})}}return l})();var c_=["fwcMessageComponent"];function p_(l,_){l&1&&(c(0,"div",4)(1,"h6",5),T(2,"i",6),g(3),C(4,"translate"),u()()),l&2&&(a(3),x(" ",y(4,1,"FW.MSG_FW_EDITION.PLUGINS")," "))}function d_(l,_){if(l&1){let e=L();c(0,"button",7),C(1,"translate"),P("click",function(){w(e);let t=d();return S(t.onCloseDialog())}),u()}if(l&2){let e=d();M("label",y(1,2,"GLOBALS.MSG_BUTTONS.CLOSE")),m("disabled",e.loadingData)}}var __=3e5,pt=new Map([["openvpn","OpenVPN"],["geoip","GeoIP"],["crowdsec","Crowdsec"],["ntopng","NtopNG"],["suricata","Suricata"],["keepalived","Keepalived"],["zeek","Zeek"],["elasticsearch","Elasticsearch"],["filebeat","Filebeat"],["websafety","Web Safety"],["kibana","Kibana"],["logstash","Logstash"],["dnssafety","DNS Safety"],["isc-bind9","ISC Bind9"],["isc-dhcp","ISC DHCP"],["haproxy","HAProxy"]]),Jl=(()=>{class l extends Dt{constructor(e,i,t,n,o,r,p,s,f,h,E,b,I,R,V,G){super(p,i,e,R,V,G),this.itemSelectedService=e,this.appOptionsService=i,this.fwcUserService=t,this.fwcFirewallService=n,this.fwcPolicyService=o,this.fwcErrorPipe=r,this.appDialogPanelsService=p,this.confirmationService=s,this.messageService=f,this.inputDataService=h,this.fwcEventService=E,this.utilService=b,this.translate=I,this.cd=R,this.store=V,this.router=G,this.displayDialog=!1,this.loadingData=!1,this.NodesError=[],this.error_plugin=!1,this.isDestroyed=!1,this.pluginEventEmitter=new kt,this.createDialog(this.translate.instant("COMPILE.PANEL_TITLE"),"fwci-compileallfirewalls")}ngOnInit(){this.itemSelectedService.getFirewallToPluginOperation().subscribe(e=>{this.showPanelforFirewall(e)}),this.itemSelectedService.getClusterToPluginOperation().subscribe(e=>{this.showPanelforCluster(e)}),this.channel_id=Et()}startProcess(){this.loadingData=!0,this.log&&this.log.startDataLoad()}stopProcess(){this.loadingData=!1,clearTimeout(this.timeoutTimer),this.log&&this.log.stopDataLoad()}startTimeoutHandler(){this.timeoutTimer=setTimeout(()=>{this.timeout(),this.eventsSubscription.unsubscribe(),this.stopProcess()},__)}refreshTimeoutHandler(){clearTimeout(this.timeoutTimer),this.startTimeoutHandler()}ngOnDestroy(){this.isDestroyed=!0,super.ngOnDestroy()}timeout(){this.addMessageToLog(this.translate.instant("COMPILE.WARN_TIMEOUT"),z.MSG_WARNING)}pingNodes(e){return Z(this,null,function*(){let i=!1;for(let t=0;t<e.length;t++){if(this.isDestroyed)return i;let n=e[t];if(n.firewall.install_communication=="agent"){let o={communication:n.firewall.install_communication,host:n.address,port:n.firewall.install_port,protocol:n.firewall.install_protocol,apikey:n.firewall.install_apikey};n.firewall.name?this.addMessageToLog(this.translate.instant("CLUSTER.PLUGINS.PING",{node:n.firewall.name}),z.MSG_INFO):this.addMessageToLog(this.translate.instant("CLUSTER.PLUGINS.PING_NO_NAME"),z.MSG_INFO),yield this.utilService.fwcAPICall(this.fwcFirewallService.checkFwCommunication.bind(this.fwcFirewallService),this.fwcUserService.getActualFwSelectedCloud(),o).then(r=>{this.log.setDataLoad(!1),this.addMessageToLog(this.translate.instant("GLOBALS.MSG_OP_ASK.OK"),z.MSG_OK),this.addMessageToLog("",z.MSG_SEPARATOR)}).catch(r=>{if(this.log.setDataLoad(!1),r.error){let p;p=this.utilService.isCommunicationError(r.error),p?(this.addMessageToLog(this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:p}),z.MSG_ERROR),this.addMessageToLog("",z.MSG_SEPARATOR)):(this.addMessageToLog(this.translate.instant("CLUSTER.PLUGINS.ERROR_PING"),z.MSG_ERROR),this.addMessageToLog("",z.MSG_SEPARATOR))}i=!0})}else n.firewall.name?(this.addMessageToLog(this.translate.instant("CLUSTER.PLUGINS.PING",{node:n.firewall.name}),z.MSG_INFO),this.addMessageToLog(this.translate.instant("CLUSTER.PLUGINS.SSH_COMMUNICATION",{node:n.firewall.name}),z.MSG_WARNING),this.addMessageToLog("",z.MSG_SEPARATOR)):(this.addMessageToLog(this.translate.instant("CLUSTER.PLUGINS.PING_NO_NAME"),z.MSG_INFO),this.addMessageToLog(this.translate.instant("CLUSTER.PLUGINS.SSH_COMMUNICATION_NO_NAME"),z.MSG_WARNING),this.addMessageToLog("",z.MSG_SEPARATOR));this.log.setDataLoad(!1)}return i})}waitWSMessages(){return new Promise((i,t)=>{this.startTimeoutHandler(),this.options.channelId?(this.eventsSubscription=this.fwcEventService.getEvent().pipe($(()=>this.displayDialog)).subscribe(n=>{this.refreshTimeoutHandler();let o=new Sn(n);if(o&&o.payload)if(o.payload.type)if(o.payload.type===z.MSG_END){i(o);return}else o.payload.type===z.MSG_ERROR?(this.operationResult={error:!0},this.NodesError.push(this.nodeName),this.statusMessage={type:"error",text:this.translate.instant("GLOBALS.MSG_OP_RESULT.PROCESS_ERROR")},o.payload.message.includes("socket")&&(this.log.addNewMessage(o),i(null))):this.options.showStatusMessage?this.fwcMessageComponent&&this.fwcMessageComponent.changeStatus(o.payload.message,this.translate.instant("ITEM_BATCH.TABLE_HEADER.1")+":"):this.log&&(o.payload.message==="ENABLED"?this.stopProcess():o.payload.message==="DISABLED"?this.stopProcess():o.payload.message==="NOT_SUPPORTED"?(this.operationResult={error:!0},this.stopProcess()):o.payload.message.toLowerCase().startsWith("error")?(this.log.addNewMessage(o),this.operationResult={error:!0},this.NodesError.push(this.nodeName)):this.log.addNewMessage(o));else this.addMessageToLog(this.translate.instant("API_ERROR.client-socket"),z.MSG_ERROR),this.operationResult={error:!0},this.NodesError.push(this.nodeName),this.stopProcess();else this.addMessageToLog(this.translate.instant("LOG_PANEL.MALFORMED_MSG"),z.MSG_ERROR),this.operationResult={error:!0},this.NodesError.push(this.nodeName),this.stopProcess()}),this.utilService.ioListenOnLogEvent(this.options.channelId)):i(null)})}doApiCall(){return new Promise((i,t)=>{this.options.apiCall?(Array.isArray(this.options.apiParams)||(this.options.apiParams=[]),this.options.showStatusMessage&&(this.statusMessage={type:"loading",text:this.translate.instant("GLOBALS.MSG_OP_RESULT.OPERATION_IN_PROGRESS")}),this.utilService.fwcAPICall(this.options.apiCall,...this.options.apiParams).then(n=>{i(n)}).catch(n=>{t(n)})):i({})})}showPanelforCluster(e){this.showDialog();let i;return new Promise(t=>Z(this,null,function*(){if(this.isDestroyed)return t(this.error_plugin);let n=this.utilService.createDynamicComponentRef(Xi),o=n.instance;o.setDynamicComponentRef(n),this.mainEventsSubscription=o.socketEventEmitter.subscribe(r=>Z(this,null,function*(){if(r=="connected"){if(this.showDialog(),this.startProcess(),this.error_plugin=yield this.pingNodes(e.nodes),!this.error_plugin){e.enable?i=this.translate.instant("FW.PLUGINS.ENABLE_OK",{plugin:this.translate.instant("FW.PLUGINS."+e.plugin.toUpperCase())}):i=this.translate.instant("FW.PLUGINS.DISABLE_OK",{plugin:this.translate.instant("FW.PLUGINS."+e.plugin.toUpperCase())}),e.nodes=e.nodes.filter(p=>p.firewall.install_communication=="agent");for(let p of e.nodes){this.channel_id=Et(),this.startProcess(),this.nodeName=p.firewall.name,e.enable?p.firewall.name?e.cluster.name?(this.addMessageToLog("",z.MSG_SEPARATOR),this.addMessageToLog(this.translate.instant("CLUSTER.PLUGINS.ENABLE_START_CLUSTER_NAME",{plugin:pt.get(e.plugin),firewall:p.firewall.name,cluster:e.cluster.name}),z.MSG_INFO)):(this.addMessageToLog("",z.MSG_SEPARATOR),this.addMessageToLog(this.translate.instant("CLUSTER.PLUGINS.ENABLE_START",{plugin:pt.get(e.plugin),firewall:p.firewall.name}),z.MSG_INFO)):(this.addMessageToLog("",z.MSG_SEPARATOR),this.addMessageToLog(this.translate.instant("CLUSTER.PLUGINS.ENABLE_START_NO_NAME",{plugin:pt.get(e.plugin)}),z.MSG_INFO)):this.nodeName?e.cluster.name?(this.addMessageToLog("",z.MSG_SEPARATOR),this.addMessageToLog(this.translate.instant("CLUSTER.PLUGINS.DISABLE_START_CLUSTER_NAME",{plugin:pt.get(e.plugin),firewall:p.firewall.name,cluster:e.cluster.name}),z.MSG_INFO)):(this.addMessageToLog("",z.MSG_SEPARATOR),this.addMessageToLog(this.translate.instant("CLUSTER.PLUGINS.DISABLE_START",{plugin:pt.get(e.plugin),firewall:p.firewall.name}),z.MSG_INFO)):(this.addMessageToLog("",z.MSG_SEPARATOR),this.addMessageToLog(this.translate.instant("CLUSTER.PLUGINS.DISABLE_START_NO_NAME",{plugin:pt.get(e.plugin)}),z.MSG_INFO));let s={channelId:this.channel_id,textHeader:"",apiCall:this.fwcFirewallService.installPlugins.bind(this.fwcFirewallService),apiParams:[this.fwcUserService.getActualFwSelectedCloud(),{protocol:p.firewall.install_protocol,plugin:e.plugin,enable:e.enable,host:p.address,port:p.firewall.install_port,apikey:p.firewall.install_apikey,communication:p.firewall.install_communication},this.channel_id],textMessage:"",showStatusMessage:null};this.options=s;let f=Wi(this.waitWSMessages(),this.doApiCall());yield kn(f).then(h=>{this.stopProcess()}).catch(h=>{this.error_plugin=!0,this.NodesError.filter(E=>E==this.nodeName)||this.NodesError.push(this.nodeName),this.stopProcess()}),this.eventsSubscription.unsubscribe()}this.log.setDataLoad(!1)}if(this.error_plugin)this.addMessageToLog(this.translate.instant("CLUSTER.PLUGINS.ERROR"),z.MSG_ERROR),this.addMessageToLog("",z.MSG_SEPARATOR);else if(this.operationResult){e.enable?(this.addMessageToLog("",z.MSG_SEPARATOR),this.addMessageToLog(this.translate.instant("FW.PLUGINS.ENABLE_ERROR"),z.MSG_ERROR)):(this.addMessageToLog("",z.MSG_SEPARATOR),this.addMessageToLog(this.translate.instant("FW.PLUGINS.DISABLE_ERROR"),z.MSG_ERROR)),this.addMessageToLog("",z.MSG_SEPARATOR),this.addMessageToLog(this.translate.instant("FW.PLUGINS.NODES_ERROR"),z.MSG_ERROR),this.NodesError=[...new Set(this.NodesError)];for(let p=0;p<this.NodesError.length;p++)this.addMessageToLog(this.NodesError[p],z.MSG_ERROR);this.error_plugin=!0}else e.enable?(this.addMessageToLog("",z.MSG_SEPARATOR),this.addMessageToLog(this.translate.instant("FW.PLUGINS.ENABLE_OK",{plugin:pt.get(e.plugin)}),z.MSG_OK)):(this.addMessageToLog("",z.MSG_SEPARATOR),this.addMessageToLog(this.translate.instant("FW.PLUGINS.DISABLE_OK",{plugin:pt.get(e.plugin)}),z.MSG_OK)),this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("FW.MSG_FW_EDITION.PLUGINS"),detail:i})}this.mainEventsSubscription.unsubscribe(),t(this.error_plugin)})),o.checkConnection(),this.loadingData=!1,this.stopProcess()}))}showPanelforFirewall(e){this.showDialog();let i;return new Promise(t=>Z(this,null,function*(){if(this.isDestroyed)return t(this.error_plugin);let n=this.utilService.createDynamicComponentRef(Xi),o=n.instance;o.setDynamicComponentRef(n),this.mainEventsSubscription=o.socketEventEmitter.subscribe(r=>Z(this,null,function*(){if(r=="connected"){this.showDialog(),e.enable?i=this.translate.instant("FW.PLUGINS.ENABLE_OK",{plugin:this.translate.instant("FW.PLUGINS."+e.plugin.toUpperCase())}):i=this.translate.instant("FW.PLUGINS.DISABLE_OK",{plugin:this.translate.instant("FW.PLUGINS."+e.plugin.toUpperCase())}),e.enable?e.firewall.name?this.addMessageToLog(this.translate.instant("FW.PLUGINS.ENABLE_START",{plugin:pt.get(e.plugin),firewall:e.firewall.name}),z.MSG_INFO):this.addMessageToLog(this.translate.instant("FW.PLUGINS.ENABLE_START_NO_NAME",{plugin:pt.get(e.plugin)}),z.MSG_INFO):e.firewall.name?this.addMessageToLog(this.translate.instant("FW.PLUGINS.DISABLE_START",{plugin:pt.get(e.plugin),firewall:e.firewall.name}),z.MSG_INFO):this.addMessageToLog(this.translate.instant("FW.PLUGINS.DISABLE_START_NO_NAME",{plugin:pt.get(e.plugin)}),z.MSG_INFO),this.channel_id=Et();let p={channelId:this.channel_id,textHeader:"",apiCall:this.fwcFirewallService.installPlugins.bind(this.fwcFirewallService),apiParams:[this.fwcUserService.getActualFwSelectedCloud(),{protocol:e.firewall.install_protocol,plugin:e.plugin,enable:e.enable,host:e.address,port:e.firewall.install_port,apikey:e.firewall.install_apikey,communication:e.firewall.install_communication},this.channel_id],textMessage:"",showStatusMessage:null};this.startProcess(),this.options=p;let s=Wi(this.waitWSMessages(),this.doApiCall());yield kn(s).then(f=>{!e.persisted&&!this.operationResult&&this.utilService.fwcAPICall(this.fwcFirewallService.updateFirewall.bind(this.fwcFirewallService),e.firewall).catch(h=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(h)}),this.stopProcess(),this.hideDialog(),this.error_plugin=!0}),this.operationResult?(e.enable?this.addMessageToLog(this.translate.instant("FW.PLUGINS.ENABLE_ERROR"),z.MSG_ERROR):this.addMessageToLog(this.translate.instant("FW.PLUGINS.DISABLE_ERROR"),z.MSG_ERROR),this.error_plugin=!0):(e.enable?this.addMessageToLog(this.translate.instant("FW.PLUGINS.ENABLE_OK",{plugin:pt.get(e.plugin)}),z.MSG_OK):this.addMessageToLog(this.translate.instant("FW.PLUGINS.DISABLE_OK",{plugin:pt.get(e.plugin)}),z.MSG_OK),this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("FW.MSG_FW_EDITION.PLUGINS"),detail:i}),this.error_plugin=!1),this.stopProcess()}).catch(f=>{if(f.status===400||f.status===500){let h=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:this.translate.instant("GLOBALS.ERRORS.COMMUNICATION")});if(f.error){let E=this.utilService.isCommunicationError(f.error);E&&(h=this.translate.instant("FW.MSG_FW_EDITION.ERROR_PING_AGENT",{errorMsg:E}))}this.confirmationService.confirm({header:"Error",icon:"fa fa-exclamation-circle fwcRed iconBig",acceptLabel:"Ok",rejectVisible:!1,message:h})}else this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(f)});this.stopProcess(),this.error_plugin=!0}),this.eventsSubscription.unsubscribe()}this.mainEventsSubscription.unsubscribe(),t(this.error_plugin)})),o.checkConnection()}))}onCloseDialog(){this.fwcEventService.emitEvent({type:Ri.EVENT_PLUGIN_PANEL_CLOSED,data:this.error_plugin}),this.eventsSubscription&&this.eventsSubscription.unsubscribe(),this.log&&this.log.clearMessages(),this.operationResult=null,super.hideDialog()}static{this.\u0275fac=function(i){return new(i||l)(F(De),F(gt),F(se),F(oe),F(de),F(we),F(At),F(Ie),F(_e),F(Ct),F(Xt),F(ue),F(ce),F(ie),F(pe),F(Ft))}}static{this.\u0275cmp=Le({type:l,selectors:[["sts-fwc-firewall-plugin-panel"]],viewQuery:function(i,t){if(i&1&&(Se(Zt,5),Se(c_,5)),i&2){let n;le(n=re())&&(t.log=n.first),le(n=re())&&(t.fwcMessageComponent=n.first)}},outputs:{pluginEventEmitter:"pluginEventEmitter"},features:[$e([oe]),Rt],decls:5,vars:4,consts:[["pluginLog",""],["styleClass","dlgFwcDialog dlgDwcDialog--medium",3,"visibleChange","visible","modal","resizable","closable"],["pTemplate","header"],["pTemplate","footer"],[1,"divFormHeader"],[1,"fwcWhite","fwcIconLeft"],[1,"fwcMenuIcon","fwci-firewalls","fwcOrange"],["type","button","pButton","","icon","pi pi-check",1,"p-button-primary",3,"click","disabled","label"]],template:function(i,t){if(i&1){let n=L();c(0,"p-dialog",1),J("visibleChange",function(r){return w(n),Y(t.displayDialog,r)||(t.displayDialog=r),S(r)}),A(1,p_,5,3,"ng-template",2),T(2,"sts-fwc-log",null,0),A(4,d_,2,4,"ng-template",3),u()}i&2&&(H("visible",t.displayDialog),m("modal",!0)("resizable",!0)("closable",!1))},dependencies:[Zt,Mt,Ue,lt,nt],encapsulation:2})}}return l})();var f_=["splitter"],m_=["dlgCompile"],h_=["gridContainerDiv"],w_=()=>({height:"100rvm",width:"100%","padding-bottom":"6.5rem"}),S_=()=>[15,85],g_=()=>[15,15],C_=()=>({height:"98%",width:"100%"}),y_=()=>({width:"100%"}),E_=(l,_)=>({copyRules:l,cutRules:_}),v_=l=>({"divClipContainer--above":l}),I_=(l,_)=>({copyObjects:l,cutObjects:_});function b_(l,_){if(l&1){let e=L();c(0,"div",null,2)(2,"div",18)(3,"div",19)(4,"input",20,3),P("keyup",function(t){w(e);let n=d(2);return S(n.onSearchType(t.target.value))}),u(),c(6,"button",21),P("click",function(){w(e);let t=fe(5);return d(2).onSearchType(""),S(t.value="")}),u(),c(7,"button",22),P("click",function(t){w(e),d(2);let n=fe(5);return S(n.toggle(t))}),u()()(),c(8,"div",23)(9,"div",24),C(10,"translate"),T(11,"sts-fwc-tree",25),u(),c(12,"div",26),C(13,"translate"),T(14,"sts-fwc-tree",25),u(),c(15,"div",26),C(16,"translate"),T(17,"sts-fwc-tree",25),u()()()}if(l&2){let e=fe(5),i=d(2);ke(W(21,C_)),a(4),m("placeholder",i.searchPlaceholderText),a(2),m("disabled",!e.value.length),a(3),M("header",y(10,15,"POLICY.MSG_POLICY_TREES.TREE_FW")),a(2),m("treeOptions",i.optionsTreeFw)("treeSearchOptions",i.treeSearchOptions),a(),M("header",y(13,17,"POLICY.MSG_POLICY_TREES.TREE_OBJ")),m("expanded",!1),a(2),m("treeOptions",i.optionsTreeObj)("treeSearchOptions",i.treeSearchOptions),a(),M("header",y(16,19,"POLICY.MSG_POLICY_TREES.TREE_SER")),m("expanded",!1),a(2),m("treeOptions",i.optionsTreeSrv)("treeSearchOptions",i.treeSearchOptions)}}function P_(l,_){l&1&&(c(0,"div",27,4),T(2,"sts-fwc-policy-grid"),u()),l&2&&ke(W(2,y_))}function T_(l,_){if(l&1){let e=L();c(0,"div",6)(1,"p-splitter",16,1),P("onResizeEnd",function(t){w(e);let n=d();return S(n.onResizeEnd(t))}),A(3,b_,18,22,"ng-template",17)(4,P_,3,3,"ng-template",17),u()()}l&2&&(a(),ke(W(4,w_)),m("panelSizes",W(5,S_))("minSizes",W(6,g_)))}function O_(l,_){if(l&1){let e=L();c(0,"div",7)(1,"div",28),T(2,"i",29),c(3,"div",30)(4,"span"),g(5),C(6,"translate"),u(),T(7,"p",31),u(),c(8,"div",32)(9,"button",33),P("click",function(){w(e);let t=d();return S(t.emptyRuleClipboard())}),u()()()()}if(l&2){let e=d();m("@fundidoInOut",void 0),a(),m("ngClass",Ze(6,E_,(e.clipboardRules==null?null:e.clipboardRules.action)==e.ClipboardAction.COPY,(e.clipboardRules==null?null:e.clipboardRules.action)==e.ClipboardAction.CUT)),a(4),x(" ",y(6,4,"POLICY.RULE_CLIPBOARD"),""),a(2),m("innerHTML",e.clipboardRulesTooltip,tn)}}function R_(l,_){if(l&1){let e=L();c(0,"div",8)(1,"div",28),T(2,"i",34),c(3,"div",30)(4,"span"),g(5),C(6,"translate"),u(),T(7,"p",31),u(),c(8,"div",32)(9,"button",33),P("click",function(){w(e);let t=d();return S(t.emptyObjectClipboard())}),u()()()()}if(l&2){let e=d();m("@fundidoInOut",void 0)("ngClass",ae(7,v_,e.clipboardRules)),a(),m("ngClass",Ze(9,I_,(e.clipboardObjects==null?null:e.clipboardObjects.action)==e.ClipboardAction.COPY,(e.clipboardObjects==null?null:e.clipboardObjects.action)==e.ClipboardAction.CUT)),a(4),x(" ",y(6,5,"POLICY.OBJECT_CLIPBOARD"),""),a(2),m("innerHTML",e.clipboardObjectsTooltip,tn)}}function x_(l,_){if(l&1){let e=L();c(0,"div",11)(1,"p-checkbox",35),C(2,"translate"),C(3,"translate"),J("ngModelChange",function(t){w(e);let n=d();return Y(n.treeSearchOptions.searchFields,t)||(n.treeSearchOptions.searchFields=t),S(t)}),P("onChange",function(t){let n=w(e).$implicit,o=d();return S(o.handleSearchFilterChange(t,n))}),u()()}if(l&2){let e=_.$implicit,i=d();a(),M("label",y(2,3,"POLICY.TREE_SEARCH_OPTIONS.SEARCH_BY")+" "+y(3,5,e)),m("value",e),H("ngModel",i.treeSearchOptions.searchFields)}}var Kl=(()=>{class l{constructor(e,i,t,n,o,r,p,s,f,h,E){this.appOptionsService=e,this.itemSelectedService=i,this.fwcUserService=t,this.ruleSelectedService=n,this.fwcPolicyService=o,this.fwcSseService=r,this.messageService=p,this.utilService=s,this.cd=f,this.store=h,this.translate=E,this.ClipboardAction=ne,this.isSidebarVisible=!0,this.currentPanelSizes=[15,85],this.previousPanelSizes=[15,85],this.draggingSplitter=!1,this.fwcStaticMessages=[],this.showObjectPanel=!1,this.searchUpdated=new pi,this.searchChangeEmitter=new kt,this.alive=!0,this.tabsExpanded=[!0,!0,!0],this.searchOptionsItems=[],this.searchFiltersOptions=[zi.OBJECT_NAME,zi.TCP_UDP_PORT,zi.IP_ADDRESS,zi.IP_OPENVPN],this.optionsTreeFw=e.optionsTreeFw,this.optionsTreeObj=e.optionsTreeObj,this.optionsTreeSrv=e.optionsTreeSrv,this.searchChangeEmitter=this.searchUpdated.asObservable().pipe(di(300),po(),$(()=>this.alive)).subscribe(b=>{this.searchString=b,this.treeSearchOptions=ao(ci({},this.treeSearchOptions),{keyword:b})}),this.treeSearchOptions={keyword:"",searchFields:this.searchFiltersOptions.slice()},this.searchPlaceholderText=this.translate.instant("POLICY.MSG_POLICY_SEARCH.SEARCH")}ngOnDestroy(){this.alive=!1}ngOnInit(){this.menuClipboardItems=[{label:this.translate.instant("POLICY.RULE_CLIPBOARD_EMPTY"),icon:"fa fa-clipboard fwcBlue",command:()=>{}}],this.store.dispatch(No.loadPolicyTypes()),this.ruleSelectedService.getClipboardRules().pipe($(()=>this.alive)).subscribe(e=>{if(this.clipboardRules=e,this.clipboardRulesTooltip="",e&&e.rules){let i=[];if(e.rules.forEach(t=>{i.push(t.id)}),e.action==ne.COPY){let t=i.length===1?"POLICY.RULE_CLIPBOARD_COPY":"POLICY.RULE_CLIPBOARD_COPY_ARRAY";this.clipboardRulesTooltip=this.translate.instant(t,i.length===1?{rule:i[0]}:{n:i.length})}if(e.action==ne.CUT){let t=i.length===1?"POLICY.RULE_CLIPBOARD_CUT":"POLICY.RULE_CLIPBOARD_CUT_ARRAY";this.clipboardRulesTooltip=this.translate.instant(t,i.length===1?{rule:i[0]}:{n:i.length})}}}),this.itemSelectedService.getClipboardItem().pipe($(()=>this.alive)).subscribe(e=>{this.clipboardObjects=e,this.clipboardObjectsTooltip="",e&&(e.action==ne.COPY&&(this.clipboardObjectsTooltip=this.translate.instant("POLICY.OBJECT_CLIPBOARD_COPY",{name:e._fwcObjName})),e.action==ne.CUT&&(this.clipboardObjectsTooltip=this.translate.instant("POLICY.OBJECT_CLIPBOARD_CUT",{name:e._fwcObjName})))}),this.fwcUserService.getFwcUser().pipe($(()=>this.alive)).subscribe(e=>{(!this.fwcUser||this.fwcUser&&(e.user_id!=this.fwcUser.user_id||e.selectedFwCloud!=this.fwcUser.selectedFwCloud))&&this.loadSelectedFWCloud(e),this.fwcUser=Object.assign({},e),this.showObjectPanel=!1}),this.fwcUserService.reloadSelectedFWCloud().pipe($(()=>this.alive)).subscribe(()=>{this.loadSelectedFWCloud(this.fwcUser)}),this.utilService.getGridScrollToTop().pipe($(()=>this.alive)).subscribe(()=>{this.gridContainerDiv&&(this.gridContainerDiv.nativeElement.scrollTop=0)})}ngAfterViewInit(){this.itemSelectedService.setFwcTreeComponents(this.fwcTreeComponents.toArray());let i=this.splitter.containerViewChild.nativeElement.querySelector(".p-splitter-gutter");i&&(i.addEventListener("mousedown",()=>this.onDragStart()),i.addEventListener("mouseup",()=>this.onDragEnd()),i.addEventListener("click",()=>this.onGutterClick()))}onDragStart(){this.draggingSplitter=!0}onDragEnd(){setTimeout(()=>this.draggingSplitter=!1,100)}onGutterClick(){this.draggingSplitter||this.toggleSidebar()}toggleSidebar(){this.isSidebarVisible?(this.previousPanelSizes=this.splitter.panelSizes,this.splitter.panelSizes=[.001,99.999]):this.splitter.panelSizes=this.previousPanelSizes,this.isSidebarVisible=!this.isSidebarVisible}onResizeEnd(e){this.isSidebarVisible&&(this.currentPanelSizes=e.sizes,this.ensurePanelSizesWithinLimits())}ensurePanelSizesWithinLimits(){this.currentPanelSizes[0]<10?(this.currentPanelSizes[0]=15,this.currentPanelSizes[1]=85):this.currentPanelSizes[0]>90&&(this.currentPanelSizes[0]=85,this.currentPanelSizes[1]=15),this.splitter.panelSizes=this.currentPanelSizes}loadSelectedFWCloud(e){this.loadFwcObjectTree(e.user_id,e.selectedLanguage,e.selectedFwCloud,1,1);let i={_fwcFwId:null};this.fwcPolicyService.setSelectedPolicy(i)}onSearchType(e){this.searchUpdated.next(e)}handleSearchFilterChange(e,i){!e&&!this.treeSearchOptions.searchFields.length?this.treeSearchOptions.searchFields=[i]:this.treeSearchOptions=ci({},this.treeSearchOptions)}loadFwcObjectTree(e,i,t,n,o){let r,p,s;r=Object.assign({},this.optionsTreeFw),p=Object.assign({},this.optionsTreeObj),s=Object.assign({},this.optionsTreeSrv),r.user_id=p.user_id=s.user_id=e,r.fwcloud=p.fwcloud=s.fwcloud=t,r.objStandard=p.objStandard=s.objStandard=n,r.objCloud=p.objCloud=s.objCloud=o,this.optionsTreeFw=Object.assign({},r),this.optionsTreeObj=Object.assign({},p),this.optionsTreeSrv=Object.assign({},s)}emptyRuleClipboard(){this.ruleSelectedService.clearClipboardRules()}emptyObjectClipboard(){this.itemSelectedService.clearClipboardItem()}doSearchTCPUDPPorts(){console.log("Search by ports",this.tcpUdpPortSearchString)}static{this.\u0275fac=function(i){return new(i||l)(F(gt),F(De),F(se),F(Fe),F(de),F(wl),F(_e),F(ue),F(ie),F(pe),F(ce))}}static{this.\u0275cmp=Le({type:l,selectors:[["sts-fwc-policy-main"]],viewQuery:function(i,t){if(i&1&&(Se(f_,5),Se(m_,5),Se(h_,5),Se(In,5)),i&2){let n;le(n=re())&&(t.splitter=n.first),le(n=re())&&(t.dlgCompile=n.first),le(n=re())&&(t.gridContainerDiv=n.first),le(n=re())&&(t.fwcTreeComponents=n)}},outputs:{searchChangeEmitter:"searchChangeEmitter"},features:[$e([])],decls:25,vars:10,consts:[["pnlSearchFilters",""],["splitter",""],["fwcDivSidebar",""],["inputSearch",""],["gridContainerDiv",""],[1,"fwcDivBoxed","fwcMainContainer"],[1,"grid-nogutter","fwcDivBoxed"],[1,"divClipContainer"],[1,"divClipContainer",3,"ngClass"],["styleClass","ovpSearchFilters","appendTo","body"],[1,"grid","grid-nogutter"],[1,"col-12"],[1,"fwcBlue"],["tooltipStyleClass","ttLeft",1,"fa","fa-fw","fa-lg","fa-info-circle",3,"pTooltip","escape"],[1,"col-12","fwc-right"],["pButton","","icon","pi pi-check",1,"p-button-primary",3,"click"],[3,"onResizeEnd","panelSizes","minSizes"],["pTemplate",""],[1,"fwcDivPadded","fwcDivBoxed","fwcDivPaddedTB"],[1,"fwcInputGroup"],["type","text","pInputText","","maxlength","255","id","inputSearch","name","inputSearch",3,"keyup","placeholder"],["pButton","","type","button","icon","pi pi-times",1,"p-button-primary",3,"click","disabled"],["pButton","","type","button","icon","pi pi-filter",1,"p-button-primary",3,"click"],["sts-fwc-tree-accordion","",1,"responsive-accordion"],["sts-fwc-tree-panel","",3,"header"],[3,"treeOptions","treeSearchOptions"],["sts-fwc-tree-panel","",3,"header","expanded"],[1,"fwcPolicyMainContainer","fwcDivOverflow"],[1,"divClipButton",3,"ngClass"],[1,"fwci-rule"],[1,"divClipButton-msg"],[3,"innerHTML"],[1,"divClipButton-close"],["type","button","pButton","","icon","fa fa-trash",1,"p-button-warning",3,"click"],[1,"fwci-ipobjects"],["name","chkSearchFilters",3,"ngModelChange","onChange","label","value","ngModel"]],template:function(i,t){if(i&1){let n=L();c(0,"div",5),A(1,T_,5,7,"div",6),u(),A(2,O_,10,9,"div",7)(3,R_,10,12,"div",8),c(4,"p-overlayPanel",9,0)(6,"div",10)(7,"div",11)(8,"h6",12),g(9),C(10,"translate"),T(11,"i",13),C(12,"translate"),u()(),Oe(13,x_,4,7,"div",11,Te),c(15,"div",14)(16,"button",15),P("click",function(){w(n);let r=fe(5);return S(r.hide())}),u()()()(),T(17,"sts-fwc-info-tooltip")(18,"sts-fwc-item-panel")(19,"sts-fwc-firewall-panel")(20,"sts-fwc-firewall-compile-panel")(21,"sts-fwc-cluster-panel")(22,"sts-fwc-ovconfig-panel")(23,"sts-fwc-vpn-status-panel")(24,"sts-fwc-firewall-plugin-panel")}i&2&&(a(),O(t.fwcUser!=null&&t.fwcUser!=null?1:-1),a(),O(t.clipboardRules?2:-1),a(),O(t.clipboardObjects?3:-1),a(6),x(" ",y(10,6,"POLICY.TREE_SEARCH_OPTIONS.HEADER")," "),a(2),M("pTooltip",y(12,8,"POLICY.TREE_SEARCH_OPTIONS.TOOLTIP")),m("escape",!1),a(2),Re(t.searchFiltersOptions))},dependencies:[et,ht,wt,tl,In,_l,dl,Ue,lt,Vo,Qt,qt,yt,ml,Ln,xl,Fl,Gl,Wl,Yl,vn,Jl,nt],styles:[`@charset "UTF-8";:root{--lightColor: #eee;--darkColor: #222;--inputBackgroundColor: #eee;--inputBorderColor: #cacaca;--inputColor: #222;--surfaceBackgroundColor: white;--fixedWhiteColor: #eee;--fixedDarkColor: #333;--translucidColor: transparent;--menuBackground: url(/assets/img/fwc-fondo-menu.jpg);--mainBackground: url(/assets/img/fwc-fondo-home.jpg);--fwcBlue: #0069a7;--fwcBlueDarkened: #005e96;--fwcDarkBlue: #003351;--fwcDarkBlue2: #014071;--fwcLightBlue: #1779ba;--fwcPaleBlue: #689fe1;--fwcPaleBlue2: #cce2f8;--fwcPaleBlue3: #e6f1fd;--fwcBlueGradient1: #386ea0;--fwcBlueGradient2: #21517e;--fwcLightGreyGradient1: #f6f7f9;--fwcLightGreyGradient2: #ebedf0;--fwcOrange: #eb6400;--fwcPaleOrange: #e67e22;--fwcPaleOrange2: #ffcfa4;--fwcPaleOrange3: #fe7815;--fwcOrangeRed: #e74c3c;--fwcRed: #f00;--fwcRed2: #b40b00;--fwcPaleRed: #f77676;--fwcPaleRed2: #ffe1e1;--fwcTranslucidRed: rgba(255, 0, 0, .15);--fwcDarkGreen: #023008;--fwcGreen: #009900;--fwcLightGreen: #28ff28;--fwcPaleGreen: #c7e6c8;--fwcLime: #baf649;--fwcWhite: #eee;--fwcPaleWhite: #f5f5f5;--fwcPaleWhite2: #f4f4f4;--fwcDark: #222;--fwcLightDark: #1e1e1e;--fwcMidDark: #555;--fwcMidDark2: #333;--fwcPaleDark: #888;--fwcPaleDark2: #383838;--fwcGrey: #cacaca;--fwcGrey2: #cecece;--fwcGrey3: #eee;--fwcGrey4: #e5e5e5;--fwcGrey5: #c8c8c8;--fwcGrey6: #efefef;--fwcGrey7: #dedede;--fwcAccent: #ff4081;--fwcShadow: #bbb;--fwcSelected: #ddd;--fwcSelectedB: #0069a7;--fwcRulePink: #ef9a9a;--fwcRulePurple: #ce93d8;--fwcRuleBlue: #90caf9;--fwcRuleTeal: #80cbc4;--fwcRuleGreen: #a5d6a7;--fwcRuleYellow: #fff59d;--fwcRuleOrange: #ffcc80}.fwcMainContainer{background:var(--surfaceBackgroundColor)!important;width:100%;height:100%;max-height:100vh}.fwcDivSidebar{padding:.5rem 1.5rem 0 .5rem!important}.fwcDivRuleClipboardNotify{position:fixed;bottom:2em;right:2em;width:3rem;height:3rem;border-radius:50%;box-shadow:2px 2px 10px var(--fwcPaleDark);color:var(--fwcDark)}.fwcDivRuleClipboardNotify.copyRules{background-color:var(--fwcPaleGreen)}.fwcDivRuleClipboardNotify.cutRules{background-color:var(--fwcPaleRed)}.fwcDivRuleClipboardNotify i{text-align:center;display:inherit;line-height:3rem}.divClipContainer{position:fixed;right:2em;bottom:2em;transition:all .25s ease-out}.divClipContainer.divClipContainer--above{bottom:7em}.divClipContainer .divClipButton{height:4em;width:4em;border-radius:2em;overflow:hidden;vertical-align:middle;box-shadow:2px 2px 12px var(--fwcPaleDark);transition:width .25s ease-out}.divClipContainer .divClipButton.copyRules{background-color:var(--fwcPaleGreen)}.divClipContainer .divClipButton.cutRules{background-color:var(--fwcPaleRed)}.divClipContainer .divClipButton.copyObjects{background-color:#b5deb7}.divClipContainer .divClipButton.copyObjects .truncated-text{display:inline-block;max-width:7.5rem;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;text-align:center;vertical-align:middle;margin-right:-7px;font-size:14.5px}.divClipContainer .divClipButton.cutObjects{background-color:#f65e5e}.divClipContainer .divClipButton:hover{width:32em}.divClipContainer .divClipButton i{display:inline-block;height:4em;width:4em;vertical-align:top;text-align:center;line-height:4em}.divClipContainer .divClipButton-msg{font-family:Montserrat,sans-serif;padding:.6em;display:inline-block;margin-right:.5em}.divClipContainer .divClipButton-msg span{font-size:1.1em;font-weight:700}.divClipContainer .divClipButton-msg p{color:var(--fwcPaleDark2)}.divClipContainer .divClipButton-close{display:inline-block;float:right;margin-right:1em;line-height:4em;vertical-align:middle;visibility:visible;text-align:center;border-radius:10px}.divClipContainer .divClipButton-close button{display:inline-block;vertical-align:middle;width:2rem;max-width:2.5rem;max-height:2rem!important}.divClipContainer .divClipButton-close span{margin-left:.1rem;margin-top:.3rem}.fwcInputGroup{position:relative;height:2.4375em}.fwcInputGroup input{width:100%;float:left;padding-right:2rem}.fwcInputGroup button{width:2rem;height:100%!important;border-radius:0!important;position:absolute;right:2rem}.fwcInputGroup button:last-child{right:0}textarea.textCompiledString{height:12rem;font-family:monospace,sans-serif,Courier!important}.ovpSearchFilters{max-width:20rem}.ttLeft{text-align:left}@media screen and (max-height: 767px){.responsive-accordion{height:calc(100% - 3em)}}@media screen and (min-height: 768px){.responsive-accordion{height:calc(100% - 2.8em)}}@media screen and (min-height: 1024px){.responsive-accordion{height:calc(100% - 2.5em)}}@media screen and (min-height: 1150px){.responsive-accordion{height:calc(100% - 2.3em)}}@media screen and (min-height: 1250px){.responsive-accordion{height:calc(100% - 2.1em)}}
`],encapsulation:2,data:{animation:[hn]}})}}return l})();var F_=[{path:"",component:Kl},{path:"**",pathMatch:"full",redirectTo:""}],Xl=(()=>{class l{static{this.\u0275fac=function(i){return new(i||l)}}static{this.\u0275mod=Ot({type:l})}static{this.\u0275inj=Tt({imports:[bi.forChild(F_),bi]})}}return l})();var zl=(()=>{class l{static \u0275fac=function(i){return new(i||l)};static \u0275mod=Ot({type:l});static \u0275inj=Tt({imports:[hi]})}return l})();var ql=(()=>{class l{static \u0275fac=function(i){return new(i||l)};static \u0275mod=Ot({type:l});static \u0275inj=Tt({imports:[hi,bi,Fi,fn,zn,Yo,Ho,bi,Fi,zn]})}return l})();var L_=["*"],M_=(l,_,e,i,t,n)=>({"p-sidebar":!0,"p-sidebar-active":l,"p-sidebar-left":_,"p-sidebar-right":e,"p-sidebar-top":i,"p-sidebar-bottom":t,"p-sidebar-full":n}),D_=(l,_)=>({transform:l,transition:_}),N_=l=>({value:"visible",params:l});function U_(l,_){l&1&&ut(0)}function G_(l,_){if(l&1&&(dt(0),A(1,U_,1,0,"ng-container",5),_t()),l&2){let e=d(2);a(),m("ngTemplateOutlet",e.headlessTemplate)}}function B_(l,_){l&1&&ut(0)}function k_(l,_){l&1&&T(0,"TimesIcon",13),l&2&&(m("styleClass","p-sidebar-close-icon"),Ke("data-pc-section","closeicon"))}function j_(l,_){}function V_(l,_){l&1&&A(0,j_,0,0,"ng-template")}function W_(l,_){if(l&1&&(c(0,"span",14),A(1,V_,1,0,null,5),u()),l&2){let e=d(4);Ke("data-pc-section","closeicon"),a(),m("ngTemplateOutlet",e.closeIconTemplate)}}function H_(l,_){if(l&1){let e=L();c(0,"button",10),P("click",function(t){w(e);let n=d(3);return S(n.close(t))})("keydown.enter",function(t){w(e);let n=d(3);return S(n.close(t))}),A(1,k_,1,2,"TimesIcon",11)(2,W_,2,2,"span",12),u()}if(l&2){let e=d(3);Ke("aria-label",e.ariaCloseLabel)("data-pc-section","closebutton")("data-pc-group-section","iconcontainer"),a(),m("ngIf",!e.closeIconTemplate),a(),m("ngIf",e.closeIconTemplate)}}function Y_(l,_){l&1&&ut(0)}function J_(l,_){l&1&&ut(0)}function K_(l,_){if(l&1&&(dt(0),c(1,"div",15),A(2,J_,1,0,"ng-container",5),u(),_t()),l&2){let e=d(3);a(),Ke("data-pc-section","footer"),a(),m("ngTemplateOutlet",e.footerTemplate)}}function X_(l,_){if(l&1&&(c(0,"div",6),A(1,B_,1,0,"ng-container",5)(2,H_,3,5,"button",7),u(),c(3,"div",8),Ji(4),A(5,Y_,1,0,"ng-container",5),u(),A(6,K_,3,2,"ng-container",9)),l&2){let e=d(2);Ke("data-pc-section","header"),a(),m("ngTemplateOutlet",e.headerTemplate),a(),m("ngIf",e.showCloseIcon),a(),Ke("data-pc-section","content"),a(2),m("ngTemplateOutlet",e.contentTemplate),a(),m("ngIf",e.footerTemplate)}}function z_(l,_){if(l&1){let e=L();c(0,"div",3,0),P("@panelState.start",function(t){w(e);let n=d();return S(n.onAnimationStart(t))})("@panelState.done",function(t){w(e);let n=d();return S(n.onAnimationEnd(t))})("keydown",function(t){w(e);let n=d();return S(n.onKeyDown(t))}),A(2,G_,2,1,"ng-container",4)(3,X_,7,6,"ng-template",null,1,Ve),u()}if(l&2){let e=fe(4),i=d();je(i.styleClass),m("ngClass",So(9,M_,i.visible,i.position==="left"&&!i.fullScreen,i.position==="right"&&!i.fullScreen,i.position==="top"&&!i.fullScreen,i.position==="bottom"&&!i.fullScreen,i.fullScreen))("@panelState",ae(19,N_,Ze(16,D_,i.transformOptions,i.transitionOptions)))("ngStyle",i.style),Ke("data-pc-name","sidebar")("data-pc-section","root"),a(2),m("ngIf",i.headlessTemplate)("ngIfElse",e)}}var q_=Jn([Hn({transform:"{{transform}}",opacity:0}),Wn("{{transition}}")]),Q_=Jn([Wn("{{transition}}",Hn({transform:"{{transform}}",opacity:0}))]),Ql=(()=>{class l{document;el;renderer;cd;config;appendTo;blockScroll=!1;style;styleClass;ariaCloseLabel;autoZIndex=!0;baseZIndex=0;modal=!0;dismissible=!0;showCloseIcon=!0;closeOnEscape=!0;transitionOptions="150ms cubic-bezier(0, 0, 0.2, 1)";get visible(){return this._visible}set visible(e){this._visible=e}get position(){return this._position}set position(e){switch(this._position=e,e){case"left":this.transformOptions="translate3d(-100%, 0px, 0px)";break;case"right":this.transformOptions="translate3d(100%, 0px, 0px)";break;case"bottom":this.transformOptions="translate3d(0px, 100%, 0px)";break;case"top":this.transformOptions="translate3d(0px, -100%, 0px)";break}}get fullScreen(){return this._fullScreen}set fullScreen(e){this._fullScreen=e,e&&(this.transformOptions="none")}templates;onShow=new kt;onHide=new kt;visibleChange=new kt;initialized;_visible;_position="left";_fullScreen=!1;container;transformOptions="translate3d(-100%, 0px, 0px)";mask;maskClickListener;documentEscapeListener;animationEndListener;contentTemplate;headerTemplate;footerTemplate;closeIconTemplate;headlessTemplate;constructor(e,i,t,n,o){this.document=e,this.el=i,this.renderer=t,this.cd=n,this.config=o}ngAfterViewInit(){this.initialized=!0}ngAfterContentInit(){this.templates?.forEach(e=>{switch(e.getType()){case"content":this.contentTemplate=e.template;break;case"header":this.headerTemplate=e.template;break;case"footer":this.footerTemplate=e.template;break;case"closeicon":this.closeIconTemplate=e.template;break;case"headless":this.headlessTemplate=e.template;break;default:this.contentTemplate=e.template;break}})}onKeyDown(e){e.code==="Escape"&&this.hide(!1)}show(){this.autoZIndex&&Ki.set("modal",this.container,this.baseZIndex||this.config.zIndex.modal),this.modal&&this.enableModality(),this.onShow.emit({}),this.visibleChange.emit(!0)}hide(e=!0){e&&this.onHide.emit({}),this.modal&&this.disableModality()}close(e){this.hide(!1),this.visibleChange.emit(!1),e.preventDefault()}enableModality(){let e=this.document.querySelectorAll(".p-sidebar-active"),t=e.length==1?String(parseInt(this.container.style.zIndex)-1):String(parseInt(e[0].style.zIndex)-1);this.mask||(this.mask=this.renderer.createElement("div"),this.renderer.setStyle(this.mask,"zIndex",t),Ai.addMultipleClasses(this.mask,"p-component-overlay p-sidebar-mask p-component-overlay p-component-overlay-enter"),this.dismissible&&(this.maskClickListener=this.renderer.listen(this.mask,"click",n=>{this.dismissible&&this.close(n)})),this.renderer.appendChild(this.document.body,this.mask),this.blockScroll&&Ai.blockBodyScroll())}disableModality(){this.mask&&(Ai.addClass(this.mask,"p-component-overlay-leave"),this.animationEndListener=this.renderer.listen(this.mask,"animationend",this.destroyModal.bind(this)))}destroyModal(){this.unbindMaskClickListener(),this.mask&&this.renderer.removeChild(this.document.body,this.mask),this.blockScroll&&Ai.unblockBodyScroll(),this.unbindAnimationEndListener(),this.mask=null}onAnimationStart(e){switch(e.toState){case"visible":this.container=e.element,this.appendContainer(),this.show(),this.closeOnEscape&&this.bindDocumentEscapeListener();break}}onAnimationEnd(e){switch(e.toState){case"void":this.hide(!0),Ki.clear(this.container),this.unbindGlobalListeners();break}}appendContainer(){this.appendTo&&(this.appendTo==="body"?this.renderer.appendChild(this.document.body,this.container):Ai.appendChild(this.container,this.appendTo))}bindDocumentEscapeListener(){let e=this.el?this.el.nativeElement.ownerDocument:this.document;this.documentEscapeListener=this.renderer.listen(e,"keydown",i=>{i.which==27&&parseInt(this.container.style.zIndex)===Ki.get(this.container)&&this.close(i)})}unbindDocumentEscapeListener(){this.documentEscapeListener&&(this.documentEscapeListener(),this.documentEscapeListener=null)}unbindMaskClickListener(){this.maskClickListener&&(this.maskClickListener(),this.maskClickListener=null)}unbindGlobalListeners(){this.unbindMaskClickListener(),this.unbindDocumentEscapeListener()}unbindAnimationEndListener(){this.animationEndListener&&this.mask&&(this.animationEndListener(),this.animationEndListener=null)}ngOnDestroy(){this.initialized=!1,this.visible&&this.modal&&this.destroyModal(),this.appendTo&&this.container&&this.renderer.appendChild(this.el.nativeElement,this.container),this.container&&this.autoZIndex&&Ki.clear(this.container),this.container=null,this.unbindGlobalListeners(),this.unbindAnimationEndListener()}static \u0275fac=function(i){return new(i||l)(F(Vn),F(Hi),F(Bt),F(ie),F(Bo))};static \u0275cmp=Le({type:l,selectors:[["p-sidebar"]],contentQueries:function(i,t,n){if(i&1&&ui(n,Ue,4),i&2){let o;le(o=re())&&(t.templates=o)}},hostAttrs:[1,"p-element"],inputs:{appendTo:"appendTo",blockScroll:[2,"blockScroll","blockScroll",li],style:"style",styleClass:"styleClass",ariaCloseLabel:"ariaCloseLabel",autoZIndex:[2,"autoZIndex","autoZIndex",li],baseZIndex:[2,"baseZIndex","baseZIndex",Co],modal:[2,"modal","modal",li],dismissible:[2,"dismissible","dismissible",li],showCloseIcon:[2,"showCloseIcon","showCloseIcon",li],closeOnEscape:[2,"closeOnEscape","closeOnEscape",li],transitionOptions:"transitionOptions",visible:"visible",position:"position",fullScreen:"fullScreen"},outputs:{onShow:"onShow",onHide:"onHide",visibleChange:"visibleChange"},features:[nn],ngContentSelectors:L_,decls:1,vars:1,consts:[["container",""],["notHeadless",""],["role","complementary",3,"ngClass","ngStyle","class","keydown",4,"ngIf"],["role","complementary",3,"keydown","ngClass","ngStyle"],[4,"ngIf","ngIfElse"],[4,"ngTemplateOutlet"],[1,"p-sidebar-header"],["type","button","class","p-sidebar-close p-sidebar-icon p-link","pRipple","",3,"click","keydown.enter",4,"ngIf"],[1,"p-sidebar-content"],[4,"ngIf"],["type","button","pRipple","",1,"p-sidebar-close","p-sidebar-icon","p-link",3,"click","keydown.enter"],[3,"styleClass",4,"ngIf"],["class","p-sidebar-close-icon",4,"ngIf"],[3,"styleClass"],[1,"p-sidebar-close-icon"],[1,"p-sidebar-footer"]],template:function(i,t){i&1&&(Yi(),A(0,z_,5,21,"div",2)),i&2&&m("ngIf",t.visible)},dependencies:()=>[et,ln,rn,Vt,ko,Xn],styles:[`@layer primeng{.p-sidebar{position:fixed;transition:transform .3s;display:flex;flex-direction:column}.p-sidebar-content{position:relative;overflow-y:auto;flex-grow:1}.p-sidebar-header{display:flex;align-items:center}.p-sidebar-footer{margin-top:auto}.p-sidebar-icon{display:flex;align-items:center;justify-content:center;margin-left:auto}.p-sidebar-left{top:0;left:0;width:20rem;height:100%}.p-sidebar-right{top:0;right:0;width:20rem;height:100%}.p-sidebar-top{top:0;left:0;width:100%;height:10rem}.p-sidebar-bottom{bottom:0;left:0;width:100%;height:10rem}.p-sidebar-full{width:100%;height:100%;top:0;left:0;-webkit-transition:none;transition:none}.p-sidebar-left.p-sidebar-sm,.p-sidebar-right.p-sidebar-sm{width:20rem}.p-sidebar-left.p-sidebar-md,.p-sidebar-right.p-sidebar-md{width:40rem}.p-sidebar-left.p-sidebar-lg,.p-sidebar-right.p-sidebar-lg{width:60rem}.p-sidebar-top.p-sidebar-sm,.p-sidebar-bottom.p-sidebar-sm{height:10rem}.p-sidebar-top.p-sidebar-md,.p-sidebar-bottom.p-sidebar-md{height:20rem}.p-sidebar-top.p-sidebar-lg,.p-sidebar-bottom.p-sidebar-lg{height:30rem}@media screen and (max-width: 64em){.p-sidebar-left.p-sidebar-lg,.p-sidebar-left.p-sidebar-md,.p-sidebar-right.p-sidebar-lg,.p-sidebar-right.p-sidebar-md{width:20rem}}}
`],encapsulation:2,data:{animation:[Io("panelState",[Yn("void => visible",[Kn(q_)]),Yn("visible => void",[Kn(Q_)])])]},changeDetection:0})}return l})(),$l=(()=>{class l{static \u0275fac=function(i){return new(i||l)};static \u0275mod=Ot({type:l});static \u0275inj=Tt({imports:[hi,fn,Fi,Xn,Fi]})}return l})();var Zl=(()=>{class l{transform(e,i,t){let n=[];if(t){let o=0,r=i+t;r>=e.length&&(r=e.length);for(let p=i;p<r;p++)n[o++]=e[p]}else n=e;return n}static{this.\u0275fac=function(i){return new(i||l)}}static{this.\u0275pipe=_o({name:"fwcGridPagination",type:l,pure:!0})}}return l})();var Z_,TC=(()=>{class l{constructor(e){this.injector=e,Z_=this.injector}static{this.\u0275fac=function(i){return new(i||l)(N(uo))}}static{this.\u0275mod=Ot({type:l})}static{this.\u0275inj=Tt({providers:[an],imports:[ul,Xl,hl,Sl,Zo,el,Wo,fl,zl,zo,ql,$l,Mo.forChild(),gl.forFeature([Cl])]})}}return l})();wo(Ln,function(){return[et,yo,ln,rn,Ht,Yt,ht,Jt,wt,Nt,Ue,lt,jo,Lt,Qt,qo,Qo,Ko,yt,$o,Xo,Ql]},function(){return[Eo,wn,nt,Zl]});export{TC as FwcPolicyModule,Z_ as PolicyInjector};
