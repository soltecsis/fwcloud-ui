import{a as ut}from"./chunk-IDY3JHCZ.js";import{a as mt,b as ft}from"./chunk-XAHGSGQN.js";import{Ad as ze,Bc as We,Cb as ee,Da as f,Ea as p,Ec as ne,Fa as s,Fb as Me,Ga as T,Gc as Ue,Hc as ke,I as X,Ib as Oe,Jh as pe,Ke as Qe,Kf as Ke,Lh as lt,M as xe,Mb as Pe,Md as Q,Me as ge,Mh as st,Na as V,Nf as $e,Nh as pt,O as K,Of as et,Oh as ct,Pa as b,Pd as He,Pf as tt,Qa as d,Qd as Y,Qf as re,Qg as at,Rc as _e,Rd as Je,Rg as rt,Sh as dt,T as _,Tf as le,U as h,Ua as R,Ub as Fe,Va as B,Wa as j,Wc as x,Za as M,_a as ue,ab as z,ag as it,bb as Se,cb as u,cg as nt,db as N,eb as L,fb as Ce,ga as be,gb as O,hb as P,hg as ot,ia as l,ib as F,id as Ge,jb as W,kb as Ne,kf as Ye,lb as Te,lf as qe,mb as Ee,mc as Ie,mf as ae,nb as D,nc as te,oa as S,ob as U,of as Ze,pc as J,pf as Xe,qa as G,qc as ie,qd as A,ra as $,rc as Ae,rd as oe,sb as C,sc as Le,tb as g,td as he,uc as I,ug as se,vb as Ve,vc as De,wa as E,wb as H,wc as Re,xc as Be,ya as v,yc as je,za as y}from"./chunk-AM2QYKNG.js";import"./chunk-GAL4ENT6.js";var Vt=["inputControl"],Mt=["inputOrg"];function Ot(i,r){if(i&1&&(p(0,"label",11),u(1),s()),i&2){let a=d(2);l(),N(a.label)}}function Pt(i,r){if(i&1){let a=V();p(0,"div",7)(1,"div",8)(2,"p-floatlabel",9)(3,"input",10,0),b("input",function(t){_(a);let o=d();return h(o.handleInput(t.target.value))}),s(),v(5,Ot,2,1,"label",11),s()()()}if(i&2){let a=M(4),e=d();l(3),f("maxLength",e.maxLength)("value",e.value)("disabled",e.isDisabled),l(2),y(a!==void 0?5:-1)}}function Ft(i,r){if(i&1&&(p(0,"span"),u(1),s()),i&2){let a=r.$implicit;l(),Ce("",a==null?null:a.alpha2," - ",a==null?null:a.name)}}function It(i,r){if(i&1&&(p(0,"div"),u(1),s()),i&2){let a=r.$implicit;l(),Ce("",a.alpha2," - ",a.name)}}function At(i,r){i&1&&(p(0,"label",21),u(1),C(2,"translate"),s()),i&2&&(l(),L(" ",g(2,1,"VPN.PANEL.CLIENT_CONFIG_NAME_WIZARD.COUNTRY")," "))}function Lt(i,r){i&1&&(p(0,"label",24),u(1),C(2,"translate"),s()),i&2&&(l(),N(g(2,1,"VPN.PANEL.CLIENT_CONFIG_NAME_WIZARD.DEP")))}function Dt(i,r){i&1&&(p(0,"label",26),u(1),C(2,"translate"),s()),i&2&&(l(),N(g(2,1,"VPN.PANEL.CLIENT_CONFIG_NAME_WIZARD.USERNAME")))}function Rt(i,r){i&1&&(p(0,"label",28),u(1),C(2,"translate"),s()),i&2&&(l(),N(g(2,1,"VPN.PANEL.CLIENT_CONFIG_NAME_WIZARD.SURNAME")))}function Bt(i,r){i&1&&(p(0,"label",31),u(1,"#"),s())}function jt(i,r){if(i&1&&(p(0,"strong"),u(1),s()),i&2){let a=d(2);l(),N(a.value)}}function Wt(i,r){i&1&&(p(0,"span",35),u(1),C(2,"translate"),s()),i&2&&(l(),N(g(2,1,"VPN.PANEL.CLIENT_CONFIG_NAME_WIZARD.NO_VALUE")))}function Ut(i,r){if(i&1){let a=V();p(0,"div",12)(1,"div",13)(2,"p-floatlabel",9)(3,"input",14,1),F("ngModelChange",function(t){_(a);let o=d();return P(o.clientCertName.organization,t)||(o.clientCertName.organization=t),h(t)}),b("input",function(){_(a);let t=d();return h(t.handleClientCertNameInput())}),s(),p(5,"label",15),u(6),C(7,"translate"),s()()()(),p(8,"div",16)(9,"div",8)(10,"span",17),u(11,"-"),s(),p(12,"p-floatlabel",9)(13,"p-select",18),C(14,"translate"),F("ngModelChange",function(t){_(a);let o=d();return P(o.clientCertName.country,t)||(o.clientCertName.country=t),h(t)}),b("onChange",function(){_(a);let t=d();return h(t.handleClientCertNameInput())}),E(15,Ft,2,2,"ng-template",19)(16,It,2,2,"ng-template",20),s(),v(17,At,3,3,"label",21),s()()(),p(18,"div",16)(19,"div",22)(20,"span",17),u(21,"-"),s(),p(22,"p-floatlabel",9)(23,"input",23,2),F("ngModelChange",function(t){_(a);let o=d();return P(o.clientCertName.department,t)||(o.clientCertName.department=t),h(t)}),b("input",function(){_(a);let t=d();return h(t.handleClientCertNameInput())}),s(),v(25,Lt,3,3,"label",24),s()()(),p(26,"div",16)(27,"div",22)(28,"span",17),u(29,"-"),s(),p(30,"p-floatlabel",9)(31,"input",25,3),F("ngModelChange",function(t){_(a);let o=d();return P(o.clientCertName.username,t)||(o.clientCertName.username=t),h(t)}),b("input",function(){_(a);let t=d();return h(t.handleClientCertNameInput())}),s(),v(33,Dt,3,3,"label",26),s()()(),p(34,"div",16)(35,"div",22)(36,"span",17),u(37,"."),s(),p(38,"p-floatlabel",9)(39,"input",27,4),F("ngModelChange",function(t){_(a);let o=d();return P(o.clientCertName.surname,t)||(o.clientCertName.surname=t),h(t)}),b("input",function(){_(a);let t=d();return h(t.handleClientCertNameInput())}),s(),v(41,Rt,3,3,"label",28),s()()(),p(42,"div",29)(43,"div",22)(44,"span",17),u(45,"-"),s(),p(46,"p-floatlabel",9)(47,"input",30,5),F("ngModelChange",function(t){_(a);let o=d();return P(o.clientCertName.counter,t)||(o.clientCertName.counter=t),h(t)}),b("input",function(){_(a);let t=d();return h(t.handleClientCertNameInput())}),s(),v(49,Bt,2,0,"label",31),s()()(),p(50,"div",32)(51,"span",33),u(52),C(53,"translate"),s(),T(54,"span",34),v(55,jt,2,1,"strong"),v(56,Wt,3,3,"span",35),s()}if(i&2){let a=M(24),e=M(32),t=M(40),o=M(48),n=d();l(3),O("ngModel",n.clientCertName.organization),f("disabled",n.disableOrganizationEdit||n.isDisabled),l(3),N(g(7,24,"VPN.PANEL.CLIENT_CONFIG_NAME_WIZARD.ORG")),l(7),f("disabled",n.disableCountryEdit||n.isDisabled),O("ngModel",n.clientCertName.country),f("options",n.countries)("autoDisplayFirst",!1)("placeholder",g(14,26,"VPN.PANEL.CLIENT_CONFIG_NAME_WIZARD.SEL_COUNTRY")),l(4),y(n.clientCertName.country?17:-1),l(6),f("disabled",n.disableDepartmentEdit||n.isDisabled),O("ngModel",n.clientCertName.department),l(2),y(a!==void 0?25:-1),l(6),f("disabled",n.disableUsernameEdit||n.isDisabled),O("ngModel",n.clientCertName.username),l(2),y(e!==void 0?33:-1),l(6),f("disabled",n.disableSurnameEdit||n.isDisabled),O("ngModel",n.clientCertName.surname),l(2),y(t!==void 0?41:-1),l(6),f("disabled",n.isDisabled),O("ngModel",n.clientCertName.counter),l(2),y(o!==void 0?49:-1),l(3),L("",g(53,28,"VPN.PANEL.FIELDS.CN"),":"),l(3),y(n.value?55:-1),l(),y(n.value?-1:56)}}var kt=/^(\w+)(-\w{2})?(-\w{3,})?(-\w{3,})?(.\w{3,})?(-\d{2})?$/;var _t=(()=>{let r=class r{set showClientCertWizard(e){this._showClientCertWizard=e,e?(this.parseValueToClientCertName(),setTimeout(()=>{this.inputOrg&&this.inputOrg.nativeElement.focus()},10)):(this.cd.detectChanges(),setTimeout(()=>{this.inputControl&&this.inputControl.nativeElement.focus()},10))}constructor(e,t){this.fwcUserService=e,this.cd=t,this.label="",this.maxLength=64,this.prefixValue="",this.onChange=o=>{},this.onTouch=()=>{},this.resetProperties()}parseValueToClientCertName(){let e="",t="",o="",n="",m="",w="00";if(this.prefixValue){let c=this.prefixValue.split("-");if(this.disableOrganizationEdit=!!c[0],this.disableCountryEdit=!!c[1],this.disableDepartmentEdit=!!c[2],c[3]){let[q,me]=c[3].split(".");this.disableUsernameEdit=!!q,this.disableSurnameEdit=!!me}}if(this.value){let c=this.value.split("-");c[0]&&(e=c[0]),c[1]&&(t=c[1].toUpperCase()),c[2]&&(o=c[2]),c[3]&&([n,m]=c[3].split(".")),c[4]&&(w=c[4])}this.clientCertName={organization:e,country:t,department:o,username:n,surname:m,counter:w},this.cd.markForCheck()}parseValueToClientCertNameWithRegexp(){let e="",t="",o="",n="",m="",w="00";if(this.value){let c=kt.exec(this.value);c&&(e=c[1],this.disableOrganizationEdit=!!this.prefixValue,c[2]&&(t=c[2].slice(1).toUpperCase(),this.disableCountryEdit=!!this.prefixValue),c[3]&&(o=c[3].slice(1),this.disableDepartmentEdit=!!this.prefixValue),c[4]&&(n=c[4].slice(1)),c[5]&&(m=c[5].slice(1)),c[6]&&(w=c[6].slice(1)))}this.clientCertName={organization:e,country:t,department:o,username:n,surname:m,counter:w},this.cd.markForCheck()}parseClientCertNameToValue(){let e="";this.clientCertName&&(e=`${this.clientCertName.organization}-${this.clientCertName.country}-${this.clientCertName.department}-${this.clientCertName.username}.${this.clientCertName.surname}-${this.clientCertName.counter}`),this.handleInput(e)}handleInput(e){this.prefixValue&&e.indexOf(this.prefixValue)!==0?(this.value=this.prefixValue,this.inputControl&&(this.inputControl.nativeElement.value=this.value)):this.value=e,this.onTouch(),this.onChange(this.value),this.cd.markForCheck()}handleClientCertNameInput(){this.parseClientCertNameToValue()}isValidClientCertName(){let e=!1;if(!this.value)e=!0;else{let[t,o]=this.value.split("-");o?Array.isArray(this.countries)&&this.countries.find(m=>m.alpha2.toUpperCase()===o.toUpperCase())&&(e=!0):e=!0}return e}focusMainInput(){this.inputOrg?this.inputOrg.nativeElement.focus():this.inputControl&&this.inputControl.nativeElement.focus()}resetProperties(){this.prefixValue="",this.disableOrganizationEdit=this.disableCountryEdit=this.disableDepartmentEdit=this.disableUsernameEdit=this.disableSurnameEdit=!1,this.clientCertName={organization:"",country:"",department:"",username:"",surname:"",counter:"00"}}writeValue(e){e?(this.prefixValue=this.value=e,this._showClientCertWizard&&this.parseValueToClientCertName()):this.prefixValue=this.value="",this.cd.markForCheck()}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouch=e}setDisabledState(e){this.isDisabled=e}};r.\u0275fac=function(t){return new(t||r)(S(Q),S(ee))},r.\u0275cmp=G({type:r,selectors:[["sts-fwc-vpn-config-name-control"]],viewQuery:function(t,o){if(t&1&&(R(Vt,5),R(Mt,5)),t&2){let n;B(n=j())&&(o.inputControl=n.first),B(n=j())&&(o.inputOrg=n.first)}},inputs:{label:"label",maxLength:"maxLength",showClientCertWizard:"showClientCertWizard",countries:"countries"},standalone:!1,features:[Te([{provide:Ie,useExisting:xe(()=>r),multi:!0}])],decls:3,vars:1,consts:[["inputControl",""],["inputOrg",""],["inputDpt",""],["inputName",""],["inputSurname",""],["inputCnt",""],[1,"grid","grid-nogutter","fwc-vpn-config-name-control"],[1,"col-12","grid","grid-nogutter"],[1,"p-inputgroup","w-full"],[1,"p-float-label"],["pInputText","","type","text","id","inputControl","name","inputControl","ondrop","return false",3,"input","maxLength","value","disabled"],["for","inputControl"],[1,"col-3","grid","grid-nogutter"],[1,"p-inputgroup","w-full","h-full","items-center"],["pInputText","","type","text","id","inputOrg","name","inputOrg","ondrop","return false",3,"ngModelChange","input","ngModel","disabled"],["for","inputOrg"],[1,"col-2","grid","grid-nogutter"],[1,"font-bold","leading-[2.45rem]","px-[0.3rem]"],["inputId","select_country","name","country","optionLabel","name","optionValue","alpha2","appendTo","body","styleClass","w-full h-full max-h-[2.438rem] align-items-center",3,"ngModelChange","onChange","disabled","ngModel","options","autoDisplayFirst","placeholder"],["pTemplate","selectedItem"],["pTemplate","item"],["for","select_country"],[1,"p-inputgroup"],["pInputText","","type","text","id","inputDpt","name","inputDpt","ondrop","return false",3,"ngModelChange","input","disabled","ngModel"],["for","inputDpt"],["pInputText","","type","text","id","inputName","name","inputName","ondrop","return false",3,"ngModelChange","input","disabled","ngModel"],["for","inputName"],["pInputText","","type","text","id","inputSurname","name","inputSurname","ondrop","return false",3,"ngModelChange","input","disabled","ngModel"],["for","inputSurname"],[1,"col-1","grid","grid-nogutter"],["pInputText","","type","text","id","inputCnt","name","inputCnt","maxlength","2","ondrop","return false",3,"ngModelChange","input","disabled","ngModel"],["for","inputCnt"],[1,"col-12","grid","grid-nogutter","pt-4"],[1,"fwcBlue"],[1,"fwcSepShort"],[1,"fwcPaleDark"]],template:function(t,o){t&1&&(p(0,"div",6),v(1,Pt,6,4,"div",7)(2,Ut,57,30),s()),t&2&&(l(),y(o._showClientCertWizard?2:1))},dependencies:[te,ie,ne,De,ae,re,se,le,Y],styles:[`.fwc-vpn-config-name-control .p-inputgroup{width:100%}.fwc-vpn-config-name-control .p-inputgroup .p-float-label{flex:1 1 0;min-width:0}.p-float-label input.p-filled~label,.p-float-label input:focus~label{top:0;margin-top:-1rem}.p-float-label .p-inputwrapper-filled~label,.p-float-label .p-inputwrapper-focus~label{top:0;margin-top:-1rem}.p-float-label .p-inputwrapper-focus~label{color:var(--fwcBlue)}
`],encapsulation:2});let i=r;return i})();var zt=["fwcConfigNameControl"],Ht=()=>({width:"80vw"}),ve=i=>({visibility:i}),Jt=()=>({width:"100%",padding:"0.625em","font-family":"Montserrat, sans-serif"}),Qt=()=>({width:"1.7rem",height:"1.7rem"});function Yt(i,r){if(i&1&&(p(0,"div",28)(1,"h6",29),T(2,"i"),C(3,"fwcIcon"),u(4),s()()),i&2){let a=d(2);l(2),Se(Ne("",Ve(3,4,a.object.obj_type,null,"fwcOrange")," fwcOrange")),l(2),L(" ",a.headerTitle," ")}}function qt(i,r){if(i&1&&(p(0,"div",15)(1,"div",17)(2,"p-floatlabel",30),T(3,"p-select",31),p(4,"label",32),u(5),C(6,"translate"),s()()()()),i&2){let a=d(2);l(3),f("options",a.certificateTypeOptions)("autoDisplayFirst",!1),l(2),N(g(6,3,"VPN.PANEL.FIELDS.TYPE"))}}function Zt(i,r){if(i&1){let a=V();p(0,"div",24)(1,"div",17)(2,"div",18)(3,"p-button",33),C(4,"translate"),C(5,"translate"),b("onClick",function(){_(a);let t=d(2);return h(t.handleToggleClientConfigName())}),s()()()()}if(i&2){d();let a=M(31),e=d();l(3),z(D(12,Jt)),f("label",W(g(4,8,"VPN.PANEL.CLIENT_CONFIG_NAME_WIZARD.BUTTON")))("pTooltip",W(g(5,10,"VPN.PANEL.CLIENT_CONFIG_NAME_WIZARD.TOOLTIP")))("disabled",!a.isValidClientCertName()||e.loadingData)("icon",e.showClientCertWizard?"fa fa-magic":"fa fa-pencil")}}function Xt(i,r){i&1&&(p(0,"label",27),u(1),C(2,"translate"),s()),i&2&&(l(),N(g(2,1,"ITEM_PANEL.FIELDS.COMMENTS")))}function Kt(i,r){if(i&1){let a=V();p(0,"p-button",38),C(1,"translate"),b("onClick",function(){_(a);let t=d(3);return h(t.onCancel())}),s()}if(i&2){let a=d(3);f("label",W(g(1,3,"GLOBALS.MSG_BUTTONS.CANCEL")))("disabled",!a.object||a.loadingData)}}function $t(i,r){if(i&1){let a=V();p(0,"p-button",39),C(1,"translate"),b("onClick",function(){_(a);let t=d(3);return h(t.onSave())}),s()}if(i&2){let a=d(3);f("label",W(g(1,3,"GLOBALS.MSG_BUTTONS.SAVE")))("disabled",!a.formModel.valid||a.formModel.pristine||a.loadingData)}}function ei(i,r){if(i&1){let a=V();p(0,"p-button",40),C(1,"translate"),b("onClick",function(){_(a);let t=d(3);return h(t.onCancel())}),s()}i&2&&f("label",W(g(1,2,"GLOBALS.MSG_BUTTONS.CLOSE")))}function ti(i,r){if(i&1&&(p(0,"div",34),T(1,"p-progressSpinner"),s(),v(2,Kt,2,5,"p-button",35),v(3,$t,2,5,"p-button",36),v(4,ei,2,4,"p-button",37)),i&2){let a=d(2);f("ngStyle",U(6,ve,a.loadingData?"visible":"hidden")),l(),z(D(8,Qt)),l(),y(a.formModel.pristine?-1:2),l(),y(a.formModel.pristine?-1:3),l(),y(a.formModel.pristine?4:-1)}}function ii(i,r){if(i&1){let a=V();p(0,"p-dialog",5,0),F("visibleChange",function(t){_(a);let o=d();return P(o.displayDialog,t)||(o.displayDialog=t),h(t)}),b("onShow",function(){_(a);let t=d();return h(t.onDialogShow())})("onHide",function(){_(a);let t=d();return h(t.onDialogHide())}),E(2,Yt,5,8,"ng-template",null,1,H),p(4,"div",6)(5,"div",7)(6,"button",8),T(7,"i",9),p(8,"span"),u(9),C(10,"translate"),s()()(),p(11,"section",10)(12,"div",11)(13,"form",12)(14,"fieldset",13),b("keyup.enter",function(t){_(a);let o=d();return h(o.checkForm(t))})("keyup.esc",function(){_(a);let t=d();return h(t.onCancel())}),p(15,"div",14),v(16,qt,7,5,"div",15),p(17,"div",16)(18,"div",17)(19,"p-floatlabel",18),T(20,"input",19),p(21,"label",20),u(22),C(23,"translate"),s()(),p(24,"p-floatlabel",18)(25,"p-select",21),b("onChange",function(){_(a);let t=d();return h(t.revalidateForm())}),s()()(),p(26,"p",22),u(27),C(28,"translate"),s()(),p(29,"div",16),T(30,"sts-fwc-vpn-config-name-control",23,2),C(32,"translate"),p(33,"p",22),u(34),C(35,"translate"),s()(),v(36,Zt,6,13,"div",24),p(37,"div",25)(38,"p-floatlabel",18),T(39,"textarea",26),v(40,Xt,3,3,"label",27),s()()()()()()()(),E(41,ti,5,9,"ng-template",null,3,H),s()}if(i&2){let a,e,t,o=M(31),n=d();z(D(34,Ht)),O("visible",n.displayDialog),f("modal",!0)("closable",!1)("resizable",!0),l(9),N(g(10,24,"VPN.PANEL.DATA")),l(4),f("formGroup",n.formModel),l(3),y(n.object.obj_type==n.ObjectTypes.OBJ_CERT_CLI||n.object.obj_type==n.ObjectTypes.OBJ_CERT_SER?16:-1),l(),f("ngClass",n.object.obj_type==n.ObjectTypes.OBJ_CA?"col-6":"col-3"),l(5),N(g(23,26,"VPN.PANEL.FIELDS.DAYS")),l(3),f("options",n.daysOptions)("autoDisplayFirst",!1),l(),f("ngStyle",U(35,ve,n.formModel.get("days").valid||n.formModel.get("days").pristine?"hidden":"visible")),l(),N(g(28,28,"VPN.PANEL.ERRORS.DAYS")),l(2),f("ngClass",((a=n.formModel.get("type"))==null?null:a.value)===n.CACertTypes.client&&!n.object.id&&!n.showClientCertWizard?"col-5":((a=n.formModel.get("type"))==null?null:a.value)===n.CACertTypes.client&&!n.object.id&&n.showClientCertWizard?"col-11":"col-6"),l(),f("label",W(g(32,30,"VPN.PANEL.FIELDS.CN")))("showClientCertWizard",n.showClientCertWizard&&((e=n.formModel.get("type"))==null?null:e.value)===n.CACertTypes.client&&!n.object.id&&o.isValidClientCertName())("countries",n.countries),l(3),f("ngStyle",U(37,ve,n.formModel.get("cn").valid||n.formModel.get("cn").pristine?"hidden":"visible")),l(),N(g(35,32,"VPN.PANEL.ERRORS.CN_FORMAT")),l(2),y(((t=n.formModel.get("type"))==null?null:t.value)===n.CACertTypes.client&&!n.object.id?36:-1),l(4),y(n.comment!==""?40:-1)}}var de=(()=>{let r=class r{daysValidator(e){let t=e.value,o,n=1,m=36500;return this.formModel&&this.formModel.controls.days_select.value==A.years&&(m=m/365|0),o=t>=n&&t<=m,o?null:{daysOutOfRange:!0}}constructor(e,t,o,n,m,w,c,q,me,yt){this.itemSelectedService=e,this.fwcUserService=t,this.fwcVpnService=o,this.translate=n,this.fwcErrorPipe=m,this.messageService=w,this.confirmationService=c,this.utilService=q,this.http=me,this.cd=yt,this.displayDialog=!1,this.certificateTypeOptions=[],this.daysOptions=[],this.certificateTypeModel=void 0,this.ObjectTypes=x,this.CADaysOptions=A,this.CACertTypes=oe,this.showClientCertWizard=!1,this.alive=!0,this.certNamePrefixValidator=k=>Z=>{let ye,fe=Z.value;return ye=fe&&fe.indexOf(k)===0&&fe.length>k.length,ye?null:{wrongCNNameWithPrefix:!0}};let xt=`assets/data/${t.getActualFwcUser()?t.getActualFwcUser().selectedLanguage:"es"}/countries.json`;this.http.get(xt).subscribe(k=>{k.map(Z=>Z.alpha2=Z.alpha2.toUpperCase()),this.countries=k},k=>{})}ngOnInit(){this.buildDropdownOptions(),this.itemSelectedService.getItem().pipe(X(()=>this.alive)).subscribe(e=>{this.insert=e.containerReadOnly===void 0,this.edit=e.containerReadOnly===!1,!(e.obj_type!=x.OBJ_CA&&e.obj_type!=x.OBJ_CERT_CLI&&e.obj_type!=x.OBJ_CERT_SER)&&(this.resetProperties(),this.onItemSelect(e),this.displayDialog=!0,this.cd.detectChanges())})}ngOnDestroy(){this.alive=!1}buildDropdownOptions(){this.certificateTypeOptions=[{label:this.translate.instant("VPN.PANEL.CERT_TYPE_OPTS.0"),value:oe.client},{label:this.translate.instant("VPN.PANEL.CERT_TYPE_OPTS.1"),value:oe.server}],this.daysOptions=[{label:this.translate.instant("VPN.PANEL.DAY_OPTS.0"),value:A.days},{label:this.translate.instant("VPN.PANEL.DAY_OPTS.1"),value:A.years}]}resetProperties(){this.object=null}onItemSelect(e){if(!e)return;let t=e._fwcObjId,o=e.obj_type;if(t===void 0&&o!==void 0){let n={id:t,obj_type:o,node_id:e.node_id,container:e.container};o==x.OBJ_CA?this.headerTitle=this.translate.instant("VPN.PANEL.NEW.CA"):(this.headerTitle=this.translate.instant("VPN.PANEL.NEW.CERT",{ca_name:e.ca_name}),n.ca=e.ca,n.type=e.type,e.folder_prefix&&(n.folder_prefix=e.folder_prefix,this.headerTitle+=` / '${e.folder_prefix}'`)),this.createForm(n)}else{let n,m={fwcloud:this.fwcUserService.getActualFwSelectedCloud()};switch(o){case x.OBJ_CA:n=this.fwcVpnService.getCA.bind(this.fwcVpnService),m.ca=t,this.headerTitle=`${this.translate.instant("VPN.CA")}: '${e._fwcObjName}'`;break;case x.OBJ_CERT_CLI:case x.OBJ_CERT_SER:n=this.fwcVpnService.getCertificate.bind(this.fwcVpnService),m.crt=t,this.headerTitle=`${this.translate.instant("VPN.CERT")}: '${e._fwcObjName}'`;break}n&&n(m).subscribe(w=>{let c=w.data;c.obj_type=o,this.createForm(c)},w=>{this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(w)})})}}createForm(e){e&&(e.days?e.days%365?e.days_select=A.days:(e.days=e.days/365,e.days_select=A.years):(e.days=50,e.days_select=A.years),this.formModel=new Le({id:new I(e.id),cn:new I({value:e.cn,disabled:!this.insert},[J.required,J.pattern(he.cnRegExp)]),days:new I({value:e.days,disabled:!this.insert},[J.required,this.daysValidator.bind(this)]),node_id:new I(e.node_id),comment:new I({value:e.comment,disabled:!this.insert&&!this.edit}),days_select:new I({value:e.days_select,disabled:!this.insert})}),(e.obj_type==x.OBJ_CERT_CLI||e.obj_type==x.OBJ_CERT_SER)&&(this.formModel.addControl("type",new I({value:e.type,disabled:!this.insert})),this.formModel.addControl("ca",new I({value:e.ca,disabled:!this.insert})),this.certificateTypeModel=e.type,this.showClientCertWizard=e.obj_type==x.OBJ_CERT_CLI&&!e.id,e.folder_prefix&&(this.formModel.get("cn").setValue(e.folder_prefix),this.formModel.get("cn").setValidators([J.required,J.pattern(he.cnRegExp),this.certNamePrefixValidator(e.folder_prefix)]))),this.object=e,this.daysUnitModel=this.formModel.get("days_select")?.value,this.cd.detectChanges())}revalidateForm(){for(let e in this.formModel.controls)this.formModel.controls[e].updateValueAndValidity(),this.formModel.controls[e].markAsTouched()}onCancel(e){!e&&!this.formModel.pristine&&this.formModel.valid?this.confirmationService.confirm({header:this.translate.instant("GLOBALS.MSG_CONFIRM"),icon:"fa fa-question-circle fwcBlue iconBig",message:this.translate.instant("VPN.PANEL.MSG_EXIT"),accept:()=>{this.onCancel(!0)},rejectVisible:!0,rejectLabel:"No",acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.YES")}):(this.resetProperties(),this.displayDialog=!1,this.cd.detectChanges())}checkForm(e){e&&e.target&&e.target.type!="textarea"&&this.formModel.valid&&(e.target.blur(),this.onSave())}onSave(){if(this.object)if(this.object.id==null){let e={};for(let m in this.formModel.controls)e[m]=this.formModel.controls[m].value!==null&&this.formModel.controls[m].value!==void 0?this.formModel.controls[m].value:void 0;e.fwcloud=this.fwcUserService.getActualFwSelectedCloud(),e.days_select==A.years&&(e.days*=365),delete e.days_select;let t,o,n;switch(this.object.obj_type){case x.OBJ_CA:t=this.fwcVpnService.newCA.bind(this.fwcVpnService),o=this.translate.instant("VPN.CA"),n="VPN.PANEL.NEW.CA_CREATING";break;case x.OBJ_CERT_CLI:case x.OBJ_CERT_SER:t=this.fwcVpnService.newCertificate.bind(this.fwcVpnService),o=this.translate.instant("VPN.CERT"),n="VPN.PANEL.NEW.OK";break}t&&(this.loadingData=!0,this.utilService.fwcAPICall(t,e).then(m=>{let w=m.data.insertId,c=m.data.TreeinsertId,q={container:this.object.container,_fwcObjId:w,_fwcObjType:this.object.obj_type,_fwcObjTreeId:c,_fwcTreeAction:Ge.NEW_ITEM};this.itemSelectedService.setModifiedItem(q),this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant(n,{objtype:o})}),this.displayDialog=!1,this.loadingData=!1,this.cd.detectChanges()}).catch(m=>{m.error.fwcErr==1005?this.confirmationService.confirm({header:this.translate.instant("VPN.PANEL.NEW.ERRORS.DUP_CN.SUMMARY"),icon:"fa fa-question-circle fwcBlue iconBig",message:this.translate.instant("VPN.PANEL.NEW.ERRORS.DUP_CN.TEXT"),rejectVisible:!1,acceptLabel:this.translate.instant("GLOBALS.MSG_OP_ASK.OK"),accept:()=>{}}):(this.messageService.add({key:"fwcToastMsgs",severity:"error",summary:"Error",detail:this.fwcErrorPipe.transform(m)}),this.loadingData=!1),this.cd.detectChanges()}))}else{let e={};for(let o in this.formModel.controls)e[o]=this.formModel.controls[o].value!==null&&this.formModel.controls[o].value!==void 0?this.formModel.controls[o].value:void 0;e.fwcloud=this.fwcUserService.getActualFwSelectedCloud();let t;switch(this.object.obj_type){case x.OBJ_CA:t=this.fwcVpnService.updateCA.bind(this.fwcVpnService);break;case x.OBJ_CERT_CLI:case x.OBJ_CERT_SER:t=this.fwcVpnService.updateCRT.bind(this.fwcVpnService);break}this.loadingData=!0,this.utilService.fwcAPICall(t,e).then(()=>{x.OBJ_CA==this.object.obj_type?this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("CONTEXT.FCA.EDIT_SUCCESS")}):this.messageService.add({key:"fwcToastMsgs",severity:"success",summary:this.translate.instant("GLOBALS.MSG_OP_RESULT.SUCCESS"),detail:this.translate.instant("CONTEXT.CA.EDIT_CERT_SUCCESS")}),this.loadingData=!1,this.displayDialog=!1,this.cd.detectChanges()})}}handleToggleClientConfigName(){this.showClientCertWizard=!this.showClientCertWizard,this.cd.detectChanges()}onDialogShow(){setTimeout(()=>{this.fwcConfigNameControl&&this.fwcConfigNameControl.focusMainInput()},100)}onDialogHide(){}onTypeChange(e){this.formModel.get("type")&&(this.formModel.get("type").setValue(e),this.formModel.get("type").markAsDirty())}onDaysUnitChange(e){this.formModel.get("days_select")&&(this.formModel.get("days_select").setValue(e),this.formModel.get("days_select").markAsDirty()),this.revalidateForm()}};r.\u0275fac=function(t){return new(t||r)(S(ge),S(Q),S(Qe),S(He),S(Xe),S(qe),S(Ye),S(Ze),S(Fe),S(ee))},r.\u0275cmp=G({type:r,selectors:[["sts-fwc-vpn-panel"]],viewQuery:function(t,o){if(t&1&&R(zt,5),t&2){let n;B(n=j())&&(o.fwcConfigNameControl=n.first)}},standalone:!1,decls:1,vars:1,consts:[["dlgItemPanel",""],["header",""],["fwcConfigNameControl",""],["footer",""],["styleClass","dlgFwcDialog fwcObjectDialog",3,"visible","modal","closable","resizable","style"],["styleClass","dlgFwcDialog fwcObjectDialog",3,"visibleChange","onShow","onHide","visible","modal","closable","resizable"],[1,"first-tabview","tabTabbedMenu","flex","flex-col","w-full","bg-(--surfaceBackgroundColor)"],[1,"flex","flex-wrap","fwc-tabbar"],["type","button",1,"fwc-tab-button","is-active"],[1,"fa","fa-pencil","fwcOrange"],[1,"fwc-ovconfig-panel-section"],[1,"fwcObjectPanel"],[3,"formGroup"],[3,"keyup.enter","keyup.esc"],[1,"grid","items-start"],[1,"col-3"],[3,"ngClass"],[1,"p-inputgroup"],[1,"p-float-label"],["pInputText","","type","number","formControlName","days","name","days","ondrop","return false"],["for","days",2,"left","0px"],["inputId","daysUnit","formControlName","days_select","name","days_select","optionLabel","label","optionValue","value","appendTo","body","styleClass","fwcSelect max-h-[2.438rem]",3,"onChange","options","autoDisplayFirst"],[1,"fwc-error",3,"ngStyle"],["formControlName","cn","maxLength","64",3,"label","showClientCertWizard","countries"],[1,"col-1"],[1,"col-12","mt-4"],["pInputText","","formControlName","comment","id","comment","name","comment","maxlength","255","ondrop","return false"],["for","comment"],[1,"divFormHeader"],[1,"fwcWhite","fwcIconLeft"],[1,"p-float-label","w-full"],["inputId","certType","formControlName","type","name","type","optionLabel","label","optionValue","value","appendTo","body","styleClass","fwcSelect w-full max-h-[2.438rem]",3,"options","autoDisplayFirst"],["for","certType"],["type","button","styleClass","fwcButtonHeight","showDelay","500","tooltipPosition","top",3,"onClick","disabled","icon","label","pTooltip"],[1,"divLoadTemp",3,"ngStyle"],["styleClass","p-button-danger","icon","pi pi-times",3,"label","disabled"],["styleClass","p-button-success","icon","fa fa-save",3,"label","disabled"],["styleClass","","icon","pi pi-times",3,"label"],["styleClass","p-button-danger","icon","pi pi-times",3,"onClick","label","disabled"],["styleClass","p-button-success","icon","fa fa-save",3,"onClick","label","disabled"],["styleClass","","icon","pi pi-times",3,"onClick","label"]],template:function(t,o){t&1&&v(0,ii,43,39,"p-dialog",4),t&2&&y(o.object&&o.formModel?0:-1)},styles:[".p-float-label[_ngcontent-%COMP%]   input.p-filled[_ngcontent-%COMP%] ~ label[_ngcontent-%COMP%], .p-float-label[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus ~ label[_ngcontent-%COMP%]{top:0;margin-top:-1rem}.p-float-label[_ngcontent-%COMP%]   .p-inputwrapper-filled[_ngcontent-%COMP%] ~ label[_ngcontent-%COMP%], .p-float-label[_ngcontent-%COMP%]   .p-inputwrapper-focus[_ngcontent-%COMP%] ~ label[_ngcontent-%COMP%], .p-float-label[_ngcontent-%COMP%]   .p-inputtext-filled[_ngcontent-%COMP%] ~ label[_ngcontent-%COMP%], .p-float-label[_ngcontent-%COMP%]   .p-inputtext-focus[_ngcontent-%COMP%] ~ label[_ngcontent-%COMP%]{top:0;margin-top:-1rem}.p-floatlabel[_ngcontent-%COMP%]:has(textarea:focus)   label[_ngcontent-%COMP%], .p-floatlabel[_ngcontent-%COMP%]:has(textarea.p-filled)   label[_ngcontent-%COMP%]{top:0;margin-top:-1.4rem}.p-floatlabel[_ngcontent-%COMP%]:has(textarea.p-filled:not(:focus))   label[_ngcontent-%COMP%]{margin-top:-2.4rem}"],changeDetection:0});let i=r;return i})();var oi=()=>({height:"92vh",width:"100%"}),ht=()=>({normal:"itvOpenvpnTree"}),gt=i=>({general:i});function ai(i,r){i&1&&(u(0),C(1,"translate")),i&2&&L(" ",g(1,1,"VPN.TREE_CA")," ")}function ri(i,r){if(i&1&&(p(0,"div",6)(1,"p-panel"),E(2,ai,2,3,"ng-template",null,1,H),s(),p(4,"div"),T(5,"sts-fwc-tree",7),s()()),i&2){let a=d(2);l(4),ue("height",a.treeContainerHeight),l(),f("treeOptions",a.optionsTreeCa)("treeStyle",U(5,gt,D(4,ht)))}}function li(i,r){i&1&&(u(0),C(1,"translate")),i&2&&L(" ",g(1,1,"VPN.TREE_FW")," ")}function si(i,r){if(i&1&&(p(0,"div",6)(1,"p-panel"),E(2,li,2,3,"ng-template",null,1,H),s(),p(4,"div"),T(5,"sts-fwc-tree",7),s()()),i&2){let a=d(2);l(4),ue("height",a.treeContainerHeight),l(),f("treeOptions",a.optionsTreeFw)("treeStyle",U(5,gt,D(4,ht)))}}function pi(i,r){i&1&&(p(0,"div",3)(1,"p-splitter",null,0),E(3,ri,6,7,"ng-template",5)(4,si,6,7,"ng-template",5),s()()),i&2&&(l(),z(D(2,oi)))}var wt=(()=>{let r=class r{constructor(e,t){this.fwcUserService=e,this.appOptionsService=t,this.alive=!0,this.treeContainerHeight="100%",this.optionsTreeFw=t.optionsTreeFwCon,this.optionsTreeCa=t.optionsTreeCa}onResize(e){this.adjustTreeHeight(),this.onSplitterResize(e)}ngOnInit(){this.fwcUserService.getFwcUser().pipe(X(()=>this.alive)).subscribe(e=>{(!this.fwcUser||this.fwcUser&&(e.user_id!=this.fwcUser.user_id||e.selectedFwCloud!=this.fwcUser.selectedFwCloud))&&this.loadFwcObjectTree(e.user_id,e.selectedLanguage,e.selectedFwCloud,1,1),this.fwcUser=Object.assign({},e)}),this.adjustTreeHeight()}adjustTreeHeight(){let e=window.innerHeight;this.treeContainerHeight=`${e-150}px`}onSplitterResize(e){this.fwcTreeComponents.forEach(t=>{t.treeview.nativeElement.updateLayout()})}ngOnDestroy(){this.alive=!1}loadFwcObjectTree(e,t,o,n,m){let w,c;w=Object.assign({},this.optionsTreeFw),c=Object.assign({},this.optionsTreeCa),w.user_id=c.user_id=e,w.fwcloud=c.fwcloud=o,w.objStandard=c.objStandard=n,w.objCloud=c.objCloud=m,this.optionsTreeFw=Object.assign({},w),this.optionsTreeCa=Object.assign({},c)}onShowStatusSection(e){this.displayStatusSection=e}};r.\u0275fac=function(t){return new(t||r)(S(Q),S(ze))},r.\u0275cmp=G({type:r,selectors:[["sts-fwc-vpn-main"]],viewQuery:function(t,o){if(t&1&&R(pe,5),t&2){let n;B(n=j())&&(o.fwcTreeComponents=n)}},hostBindings:function(t,o){t&1&&b("resize",function(m){return o.onResize(m)},be)},standalone:!1,decls:8,vars:4,consts:[["splitter",""],["header",""],[1,"fwcDivBoxed","h-full","w-full","bg-[var(--surfaceBackgroundColor)]"],[1,"grid-nogutter","fwcDivBoxed"],[3,"restrictionsReadOnly"],["pTemplate",""],[2,"height","auto","width","100%"],[3,"treeOptions","treeStyle"]],template:function(t,o){t&1&&(p(0,"div",2),v(1,pi,5,3,"div",3),s(),T(2,"sts-fwc-vpn-panel")(3,"sts-fwc-ovconfig-panel",4)(4,"sts-fwc-wireguard-config-panel",4)(5,"sts-fwc-ipsec-config-panel",4)(6,"sts-fwc-info-tooltip")(7,"sts-fwc-vpn-status-panel")),t&2&&(l(),y(o.fwcUser!=null&&o.fwcUser!=null?1:-1),l(2),f("restrictionsReadOnly",!0),l(),f("restrictionsReadOnly",!0),l(),f("restrictionsReadOnly",!0))},dependencies:[rt,pe,ct,lt,st,pt,ae,nt,mt,de,Y],styles:[`.p-panel .p-panel-header{display:flex!important;flex-direction:column;justify-content:center!important;align-items:center!important;background-color:var(--fwcLightBlue)!important;color:var(--fixedWhiteColor)!important;font-family:arial,Montserrat,sans-serif;text-transform:uppercase;font-size:.9rem;width:100%}
`],encapsulation:2});let i=r;return i})();var ci=[{path:"",component:wt},{path:"**",pathMatch:"full",redirectTo:""}],vt=(()=>{let r=class r{};r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=$({type:r}),r.\u0275inj=K({imports:[_e.forChild(ci),_e]});let i=r;return i})();var Rn=(()=>{let r=class r{};r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=$({type:r}),r.\u0275inj=K({imports:[Pe,Ue,ke,vt,Je.forChild(),dt,ut,tt,ft,$e]});let i=r;return i})();Ee(de,function(){return[Me,Oe,Re,te,Be,ie,Ae,ne,je,We,it,et,ot,Ke,re,se,le,_t]},function(){return[Y,at]});export{Rn as FwcVpnModule};
