import{a as be,b as qi,c as Ut,g as f}from"./chunk-GAL4ENT6.js";var We=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ir=Symbol("doneWritingPromise"),es=Symbol("doneWritingResolve"),ts=Symbol("doneWritingReject"),pr=Symbol("readingIndex"),$e=class i extends Array{constructor(){super(),Object.setPrototypeOf(this,i.prototype),this[ir]=new Promise((e,t)=>{this[es]=e,this[ts]=t}),this[ir].catch(()=>{})}};function ge(i){return i&&i.getReader&&Array.isArray(i)}function kr(i){if(!ge(i)){let e=i.getWriter(),t=e.releaseLock;return e.releaseLock=()=>{e.closed.catch(function(){}),t.call(e)},e}this.stream=i}function He(i){if(ge(i))return"array";if(We.ReadableStream&&We.ReadableStream.prototype.isPrototypeOf(i))return"web";if(i&&!(We.ReadableStream&&i instanceof We.ReadableStream)&&typeof i._read=="function"&&typeof i._readableState=="object")throw Error("Native Node streams are no longer supported: please manually convert the stream to a WebStream, using e.g. `stream.Readable.toWeb`");return!(!i||!i.getReader)&&"web-like"}function Mi(i){return Uint8Array.prototype.isPrototypeOf(i)}function rs(i){if(i.length===1)return i[0];let e=0;for(let n=0;n<i.length;n++){if(!Mi(i[n]))throw Error("concatUint8Array: Data must be in the form of a Uint8Array");e+=i[n].length}let t=new Uint8Array(e),r=0;return i.forEach(function(n){t.set(n,r),r+=n.length}),t}$e.prototype.getReader=function(){return this[pr]===void 0&&(this[pr]=0),{read:()=>f(this,null,function*(){return yield this[ir],this[pr]===this.length?{value:void 0,done:!0}:{value:this[this[pr]++],done:!1}})}},$e.prototype.readToEnd=function(i){return f(this,null,function*(){yield this[ir];let e=i(this.slice(this[pr]));return this.length=0,e})},$e.prototype.clone=function(){let i=new $e;return i[ir]=this[ir].then(()=>{i.push(...this)}),i},kr.prototype.write=function(i){return f(this,null,function*(){this.stream.push(i)})},kr.prototype.close=function(){return f(this,null,function*(){this.stream[es]()})},kr.prototype.abort=function(i){return f(this,null,function*(){return this.stream[ts](i),i})},kr.prototype.releaseLock=function(){},typeof We.process=="object"&&We.process.versions;var ia=new WeakSet,ae=Symbol("externalBuffer");function it(i){if(this.stream=i,i[ae]&&(this[ae]=i[ae].slice()),ge(i)){let t=i.getReader();return this._read=t.read.bind(t),this._releaseLock=()=>{},void(this._cancel=()=>{})}if(He(i)){let t=i.getReader();return this._read=t.read.bind(t),this._releaseLock=()=>{t.closed.catch(function(){}),t.releaseLock()},void(this._cancel=t.cancel.bind(t))}let e=!1;this._read=()=>f(this,null,function*(){return e||ia.has(i)?{value:void 0,done:!0}:(e=!0,{value:i,done:!1})}),this._releaseLock=()=>{if(e)try{ia.add(i)}catch{}}}function qn(i){return He(i)?i:new ReadableStream({start(e){e.enqueue(i),e.close()}})}function is(i){if(He(i))return i;let e=new $e;return f(this,null,function*(){let t=Ge(e);yield t.write(i),yield t.close()}),e}function Fe(i){return i.some(e=>He(e)&&!ge(e))?function(e){e=e.map(qn);let t=as(function(a){return f(this,null,function*(){yield Promise.all(n.map(s=>gn(s,a)))})}),r=Promise.resolve(),n=e.map((a,s)=>Ht(a,(c,u)=>(r=r.then(()=>Xt(c,t.writable,{preventClose:s!==e.length-1})),r)));return t.readable}(i):i.some(e=>ge(e))?function(e){let t=new $e,r=Promise.resolve();return e.forEach((n,a)=>(r=r.then(()=>Xt(n,t,{preventClose:a!==e.length-1})),r)),t}(i):typeof i[0]=="string"?i.join(""):rs(i)}function Xt(a,s){return f(this,arguments,function*(i,e,{preventClose:t=!1,preventAbort:r=!1,preventCancel:n=!1}={}){if(He(i)&&!ge(i)){i=qn(i);try{if(i[ae]){let h=Ge(e);for(let y=0;y<i[ae].length;y++)yield h.ready,yield h.write(i[ae][y]);h.releaseLock()}yield i.pipeTo(e,{preventClose:t,preventAbort:r,preventCancel:n})}catch{}return}let c=Pt(i=is(i)),u=Ge(e);try{for(;;){yield u.ready;let{done:h,value:y}=yield c.read();if(h){t||(yield u.close());break}yield u.write(y)}}catch(h){r||(yield u.abort(h))}finally{c.releaseLock(),u.releaseLock()}})}function ns(i,e){let t=new TransformStream(e);return Xt(i,t.writable),t.readable}function as(i){let e,t,r,n=!1,a=!1;return{readable:new ReadableStream({start(c){r=c},pull(){e?e():n=!0},cancel(c){return f(this,null,function*(){a=!0,i&&(yield i(c)),t&&t(c)})}},{highWaterMark:0}),writable:new WritableStream({write:function(c){return f(this,null,function*(){if(a)throw Error("Stream is cancelled");r.enqueue(c),n?n=!1:(yield new Promise((u,h)=>{e=u,t=h}),e=null,t=null)})},close:r.close.bind(r),abort:r.error.bind(r)})}}function le(i,e=()=>{},t=()=>{}){if(ge(i)){let s=new $e;return f(this,null,function*(){let c=Ge(s);try{let u=yield ke(i),h=e(u),y=t(),p;p=h!==void 0&&y!==void 0?Fe([h,y]):h!==void 0?h:y,yield c.write(p),yield c.close()}catch(u){yield c.abort(u)}}),s}if(He(i))return ns(i,{transform(s,c){return f(this,null,function*(){try{let u=yield e(s);u!==void 0&&c.enqueue(u)}catch(u){c.error(u)}})},flush(s){return f(this,null,function*(){try{let c=yield t();c!==void 0&&s.enqueue(c)}catch(c){s.error(c)}})}});let r=e(i),n=t();return r!==void 0&&n!==void 0?Fe([r,n]):r!==void 0?r:n}function Ht(i,e){if(He(i)&&!ge(i)){let r,n=new TransformStream({start(c){r=c}}),a=Xt(i,n.writable),s=as(function(c){return f(this,null,function*(){r.error(c),yield a,yield new Promise(setTimeout)})});return e(n.readable,s.writable),s.readable}i=is(i);let t=new $e;return e(i,t),t}function Li(i,e){let t,r=Ht(i,(n,a)=>{let s=Pt(n);s.remainder=()=>(s.releaseLock(),Xt(n,a),r),t=e(s)});return t}function Yt(i){if(ge(i))return i.clone();if(He(i)){let e=function(t){if(ge(t))throw Error("ArrayStream cannot be tee()d, use clone() instead");if(He(t)){let r=qn(t).tee();return r[0][ae]=r[1][ae]=t[ae],r}return[Ee(t),Ee(t)]}(i);return ss(i,e[0]),e[1]}return Ee(i)}function Pr(i){return ge(i)?Yt(i):He(i)?new ReadableStream({start(e){let t=Ht(i,(r,n)=>f(this,null,function*(){let a=Pt(r),s=Ge(n);try{for(;;){yield s.ready;let{done:c,value:u}=yield a.read();if(c){try{e.close()}catch{}return void(yield s.close())}try{e.enqueue(u)}catch{}yield s.write(u)}}catch(c){e.error(c),yield s.abort(c)}}));ss(i,t)}}):Ee(i)}function ss(i,e){Object.entries(Object.getOwnPropertyDescriptors(i.constructor.prototype)).forEach(([t,r])=>{t!=="constructor"&&(r.value?r.value=r.value.bind(e):r.get=r.get.bind(e),Object.defineProperty(i,t,r))})}function Ee(i,e=0,t=1/0){if(ge(i))throw Error("Not implemented");if(He(i)){if(e>=0&&t>=0){let r=0;return ns(i,{transform(n,a){r<t?(r+n.length>=e&&a.enqueue(Ee(n,Math.max(e-r,0),t-r)),r+=n.length):a.terminate()}})}if(e<0&&(t<0||t===1/0)){let r=[];return le(i,n=>{n.length>=-e?r=[n]:r.push(n)},()=>Ee(Fe(r),e,t))}if(e===0&&t<0){let r;return le(i,n=>{let a=r?Fe([r,n]):n;if(a.length>=-t)return r=Ee(a,t),Ee(a,e,t);r=a})}return console.warn(`stream.slice(input, ${e}, ${t}) not implemented efficiently.`),jt(()=>f(this,null,function*(){return Ee(yield ke(i),e,t)}))}return i[ae]&&(i=Fe(i[ae].concat([i]))),Mi(i)?i.subarray(e,t===1/0?i.length:t):i.slice(e,t)}function ke(t){return f(this,arguments,function*(i,e=Fe){return ge(i)?i.readToEnd(e):He(i)?Pt(i).readToEnd(e):i})}function gn(i,e){return f(this,null,function*(){if(He(i)){if(i.cancel){let t=yield i.cancel(e);return yield new Promise(setTimeout),t}if(i.destroy)return i.destroy(e),yield new Promise(setTimeout),e}})}function jt(i){let e=new $e;return f(this,null,function*(){let t=Ge(e);try{yield t.write(yield i()),yield t.close()}catch(r){yield t.abort(r)}}),e}function Pt(i){return new it(i)}function Ge(i){return new kr(i)}it.prototype.read=function(){return f(this,null,function*(){return this[ae]&&this[ae].length?{done:!1,value:this[ae].shift()}:this._read()})},it.prototype.releaseLock=function(){this[ae]&&(this.stream[ae]=this[ae]),this._releaseLock()},it.prototype.cancel=function(i){return this._cancel(i)},it.prototype.readLine=function(){return f(this,null,function*(){let i,e=[];for(;!i;){let{done:t,value:r}=yield this.read();if(r+="",t)return e.length?Fe(e):void 0;let n=r.indexOf(`
`)+1;n&&(i=Fe(e.concat(r.substr(0,n))),e=[]),n!==r.length&&e.push(r.substr(n))}return this.unshift(...e),i})},it.prototype.readByte=function(){return f(this,null,function*(){let{done:i,value:e}=yield this.read();if(i)return;let t=e[0];return this.unshift(Ee(e,1)),t})},it.prototype.readBytes=function(i){return f(this,null,function*(){let e=[],t=0;for(;;){let{done:r,value:n}=yield this.read();if(r)return e.length?Fe(e):void 0;if(e.push(n),t+=n.length,t>=i){let a=Fe(e);return this.unshift(Ee(a,i)),Ee(a,0,i)}}})},it.prototype.peekBytes=function(i){return f(this,null,function*(){let e=yield this.readBytes(i);return this.unshift(e),e})},it.prototype.unshift=function(...i){this[ae]||(this[ae]=[]),i.length===1&&Mi(i[0])&&this[ae].length&&i[0].length&&this[ae][0].byteOffset>=i[0].length?this[ae][0]=new Uint8Array(this[ae][0].buffer,this[ae][0].byteOffset-i[0].length,this[ae][0].byteLength+i[0].length):this[ae].unshift(...i.filter(e=>e&&e.length))},it.prototype.readToEnd=function(){return f(this,arguments,function*(i=Fe){let e=[];for(;;){let{done:t,value:r}=yield this.read();if(t)break;e.push(r)}return i(e)})};var gr=Symbol("byValue"),o={curve:{nistP256:"nistP256",p256:"nistP256",nistP384:"nistP384",p384:"nistP384",nistP521:"nistP521",p521:"nistP521",secp256k1:"secp256k1",ed25519Legacy:"ed25519Legacy",ed25519:"ed25519Legacy",curve25519Legacy:"curve25519Legacy",curve25519:"curve25519Legacy",brainpoolP256r1:"brainpoolP256r1",brainpoolP384r1:"brainpoolP384r1",brainpoolP512r1:"brainpoolP512r1"},s2k:{simple:0,salted:1,iterated:3,argon2:4,gnu:101},publicKey:{rsaEncryptSign:1,rsaEncrypt:2,rsaSign:3,elgamal:16,dsa:17,ecdh:18,ecdsa:19,eddsaLegacy:22,aedh:23,aedsa:24,x25519:25,x448:26,ed25519:27,ed448:28},symmetric:{idea:1,tripledes:2,cast5:3,blowfish:4,aes128:7,aes192:8,aes256:9,twofish:10},compression:{uncompressed:0,zip:1,zlib:2,bzip2:3},hash:{md5:1,sha1:2,ripemd:3,sha256:8,sha384:9,sha512:10,sha224:11,sha3_256:12,sha3_512:14},webHash:{"SHA-1":2,"SHA-256":8,"SHA-384":9,"SHA-512":10},aead:{eax:1,ocb:2,gcm:3,experimentalGCM:100},packet:{publicKeyEncryptedSessionKey:1,signature:2,symEncryptedSessionKey:3,onePassSignature:4,secretKey:5,publicKey:6,secretSubkey:7,compressedData:8,symmetricallyEncryptedData:9,marker:10,literalData:11,trust:12,userID:13,publicSubkey:14,userAttribute:17,symEncryptedIntegrityProtectedData:18,modificationDetectionCode:19,aeadEncryptedData:20,padding:21},literal:{binary:98,text:116,utf8:117,mime:109},signature:{binary:0,text:1,standalone:2,certGeneric:16,certPersona:17,certCasual:18,certPositive:19,certRevocation:48,subkeyBinding:24,keyBinding:25,key:31,keyRevocation:32,subkeyRevocation:40,timestamp:64,thirdParty:80},signatureSubpacket:{signatureCreationTime:2,signatureExpirationTime:3,exportableCertification:4,trustSignature:5,regularExpression:6,revocable:7,keyExpirationTime:9,placeholderBackwardsCompatibility:10,preferredSymmetricAlgorithms:11,revocationKey:12,issuerKeyID:16,notationData:20,preferredHashAlgorithms:21,preferredCompressionAlgorithms:22,keyServerPreferences:23,preferredKeyServer:24,primaryUserID:25,policyURI:26,keyFlags:27,signersUserID:28,reasonForRevocation:29,features:30,signatureTarget:31,embeddedSignature:32,issuerFingerprint:33,preferredAEADAlgorithms:34,preferredCipherSuites:39},keyFlags:{certifyKeys:1,signData:2,encryptCommunication:4,encryptStorage:8,splitPrivateKey:16,authentication:32,sharedPrivateKey:128},armor:{multipartSection:0,multipartLast:1,signed:2,message:3,publicKey:4,privateKey:5,signature:6},reasonForRevocation:{noReason:0,keySuperseded:1,keyCompromised:2,keyRetired:3,userIDInvalid:32},features:{modificationDetection:1,aead:2,v5Keys:4,seipdv2:8},write:function(i,e){if(typeof e=="number"&&(e=this.read(i,e)),i[e]!==void 0)return i[e];throw Error("Invalid enum value.")},read:function(i,e){if(i[gr]||(i[gr]=[],Object.entries(i).forEach(([t,r])=>{i[gr][r]=t})),i[gr][e]!==void 0)return i[gr][e];throw Error("Invalid enum value.")}},M={preferredHashAlgorithm:o.hash.sha512,preferredSymmetricAlgorithm:o.symmetric.aes256,preferredCompressionAlgorithm:o.compression.uncompressed,aeadProtect:!1,parseAEADEncryptedV4KeysAsLegacy:!1,preferredAEADAlgorithm:o.aead.gcm,aeadChunkSizeByte:12,v6Keys:!1,enableParsingV5Entities:!1,s2kType:o.s2k.iterated,s2kIterationCountByte:224,s2kArgon2Params:{passes:3,parallelism:4,memoryExponent:16},allowUnauthenticatedMessages:!1,allowUnauthenticatedStream:!1,minRSABits:2047,passwordCollisionCheck:!1,allowInsecureDecryptionWithSigningKeys:!1,allowInsecureVerificationWithReformattedKeys:!1,allowMissingKeyFlags:!1,constantTimePKCS1Decryption:!1,constantTimePKCS1DecryptionSupportedSymmetricAlgorithms:new Set([o.symmetric.aes128,o.symmetric.aes192,o.symmetric.aes256]),ignoreUnsupportedPackets:!0,ignoreMalformedPackets:!1,additionalAllowedPackets:[],showVersion:!1,showComment:!1,versionString:"OpenPGP.js 6.0.1",commentString:"https://openpgpjs.org",maxUserIDLength:5120,knownNotations:[],nonDeterministicSignaturesViaNotation:!0,useEllipticFallback:!0,rejectHashAlgorithms:new Set([o.hash.md5,o.hash.ripemd]),rejectMessageHashAlgorithms:new Set([o.hash.md5,o.hash.ripemd,o.hash.sha1]),rejectPublicKeyAlgorithms:new Set([o.publicKey.elgamal,o.publicKey.dsa]),rejectCurves:new Set([o.curve.secp256k1])},na=(()=>{try{return!1}catch{}return!1})(),l={isString:function(i){return typeof i=="string"||i instanceof String},nodeRequire:()=>{},isArray:function(i){return i instanceof Array},isUint8Array:Mi,isStream:He,getNobleCurve:(i,e)=>f(void 0,null,function*(){if(!M.useEllipticFallback)throw Error("This curve is only supported in the full build of OpenPGP.js");let{nobleCurves:t}=yield import("./chunk-XYMRVQ64.js");switch(i){case o.publicKey.ecdh:case o.publicKey.ecdsa:{let r=t.get(e);if(!r)throw Error("Unsupported curve");return r}case o.publicKey.x448:return t.get("x448");case o.publicKey.ed448:return t.get("ed448");default:throw Error("Unsupported curve")}}),readNumber:function(i){let e=0;for(let t=0;t<i.length;t++)e+=256**t*i[i.length-1-t];return e},writeNumber:function(i,e){let t=new Uint8Array(e);for(let r=0;r<e;r++)t[r]=i>>8*(e-r-1)&255;return t},readDate:function(i){let e=l.readNumber(i);return new Date(1e3*e)},writeDate:function(i){let e=Math.floor(i.getTime()/1e3);return l.writeNumber(e,4)},normalizeDate:function(i=Date.now()){return i===null||i===1/0?i:new Date(1e3*Math.floor(+i/1e3))},readMPI:function(i){let e=(i[0]<<8|i[1])+7>>>3;return l.readExactSubarray(i,2,2+e)},readExactSubarray:function(i,e,t){if(i.length<t-e)throw Error("Input array too short");return i.subarray(e,t)},leftPad(i,e){if(i.length>e)throw Error("Input array too long");let t=new Uint8Array(e),r=e-i.length;return t.set(i,r),t},uint8ArrayToMPI:function(i){let e=l.uint8ArrayBitLength(i);if(e===0)throw Error("Zero MPI");let t=i.subarray(i.length-Math.ceil(e/8)),r=new Uint8Array([(65280&e)>>8,255&e]);return l.concatUint8Array([r,t])},uint8ArrayBitLength:function(i){let e;for(e=0;e<i.length&&i[e]===0;e++);if(e===i.length)return 0;let t=i.subarray(e);return 8*(t.length-1)+l.nbits(t[0])},hexToUint8Array:function(i){let e=new Uint8Array(i.length>>1);for(let t=0;t<i.length>>1;t++)e[t]=parseInt(i.substr(t<<1,2),16);return e},uint8ArrayToHex:function(i){let e="0123456789abcdef",t="";return i.forEach(r=>{t+=e[r>>4]+e[15&r]}),t},stringToUint8Array:function(i){return le(i,e=>{if(!l.isString(e))throw Error("stringToUint8Array: Data must be in the form of a string");let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t})},uint8ArrayToString:function(i){let e=[],r=(i=new Uint8Array(i)).length;for(let n=0;n<r;n+=16384)e.push(String.fromCharCode.apply(String,i.subarray(n,n+16384<r?n+16384:r)));return e.join("")},encodeUTF8:function(i){let e=new TextEncoder("utf-8");function t(r,n=!1){return e.encode(r,{stream:!n})}return le(i,t,()=>t("",!0))},decodeUTF8:function(i){let e=new TextDecoder("utf-8");function t(r,n=!1){return e.decode(r,{stream:!n})}return le(i,t,()=>t(new Uint8Array,!0))},concat:Fe,concatUint8Array:rs,equalsUint8Array:function(i,e){if(!l.isUint8Array(i)||!l.isUint8Array(e))throw Error("Data must be in the form of a Uint8Array");if(i.length!==e.length)return!1;for(let t=0;t<i.length;t++)if(i[t]!==e[t])return!1;return!0},writeChecksum:function(i){let e=0;for(let t=0;t<i.length;t++)e=e+i[t]&65535;return l.writeNumber(e,2)},printDebug:function(i){na&&console.log("[OpenPGP.js debug]",i)},printDebugError:function(i){na&&console.error("[OpenPGP.js debug]",i)},nbits:function(i){let e=1,t=i>>>16;return t!==0&&(i=t,e+=16),t=i>>8,t!==0&&(i=t,e+=8),t=i>>4,t!==0&&(i=t,e+=4),t=i>>2,t!==0&&(i=t,e+=2),t=i>>1,t!==0&&(i=t,e+=1),e},double:function(i){let e=new Uint8Array(i.length),t=i.length-1;for(let r=0;r<t;r++)e[r]=i[r]<<1^i[r+1]>>7;return e[t]=i[t]<<1^135*(i[0]>>7),e},shiftRight:function(i,e){if(e)for(let t=i.length-1;t>=0;t--)i[t]>>=e,t>0&&(i[t]|=i[t-1]<<8-e);return i},getWebCrypto:function(){let i=We!==void 0&&We.crypto&&We.crypto.subtle||this.getNodeCrypto()?.webcrypto.subtle;if(!i)throw Error("The WebCrypto API is not available");return i},getNodeCrypto:function(){return this.nodeRequire("crypto")},getNodeZlib:function(){return this.nodeRequire("zlib")},getNodeBuffer:function(){return(this.nodeRequire("buffer")||{}).Buffer},getHardwareConcurrency:function(){return typeof navigator<"u"?navigator.hardwareConcurrency||1:this.nodeRequire("os").cpus().length},isEmailAddress:function(i){return l.isString(i)?/^[^\p{C}\p{Z}@<>\\]+@[^\p{C}\p{Z}@<>\\]+[^\p{C}\p{Z}\p{P}]$/u.test(i):!1},canonicalizeEOL:function(i){let e=!1;return le(i,t=>{let r;e&&(t=l.concatUint8Array([new Uint8Array([13]),t])),t[t.length-1]===13?(e=!0,t=t.subarray(0,-1)):e=!1;let n=[];for(let c=0;r=t.indexOf(10,c)+1,r;c=r)t[r-2]!==13&&n.push(r);if(!n.length)return t;let a=new Uint8Array(t.length+n.length),s=0;for(let c=0;c<n.length;c++){let u=t.subarray(n[c-1]||0,n[c]);a.set(u,s),s+=u.length,a[s-1]=13,a[s]=10,s++}return a.set(t.subarray(n[n.length-1]||0),s),a},()=>e?new Uint8Array([13]):void 0)},nativeEOL:function(i){let e=!1;return le(i,t=>{let r;(t=e&&t[0]!==10?l.concatUint8Array([new Uint8Array([13]),t]):new Uint8Array(t))[t.length-1]===13?(e=!0,t=t.subarray(0,-1)):e=!1;let n=0;for(let a=0;a!==t.length;a=r){r=t.indexOf(13,a)+1,r||(r=t.length);let s=r-(t[r]===10?1:0);a&&t.copyWithin(n,a,s),n+=s-a}return t.subarray(0,n)},()=>e?new Uint8Array([13]):void 0)},removeTrailingSpaces:function(i){return i.split(`
`).map(e=>{let t=e.length-1;for(;t>=0&&(e[t]===" "||e[t]==="	"||e[t]==="\r");t--);return e.substr(0,t+1)}).join(`
`)},wrapError:function(i,e){if(!e)return Error(i);try{e.message=i+": "+e.message}catch{}return e},constructAllowedPackets:function(i){let e={};return i.forEach(t=>{if(!t.tag)throw Error("Invalid input: expected a packet class");e[t.tag]=t}),e},anyPromise:function(i){return new Promise((e,t)=>f(this,null,function*(){let r;yield Promise.all(i.map(n=>f(this,null,function*(){try{e(yield n)}catch(a){r=a}}))),t(r)}))},selectUint8Array:function(i,e,t){let r=Math.max(e.length,t.length),n=new Uint8Array(r),a=0;for(let s=0;s<n.length;s++)n[s]=e[s]&256-i|t[s]&255+i,a+=i&s<e.length|1-i&s<t.length;return n.subarray(0,a)},selectUint8:function(i,e,t){return e&256-i|t&255+i},isAES:function(i){return i===o.symmetric.aes128||i===o.symmetric.aes192||i===o.symmetric.aes256}},Gi=l.getNodeBuffer(),ii,ni;function wt(i){let e=new Uint8Array;return le(i,t=>{e=l.concatUint8Array([e,t]);let r=[],n=Math.floor(e.length/45),a=45*n,s=ii(e.subarray(0,a));for(let c=0;c<n;c++)r.push(s.substr(60*c,60)),r.push(`
`);return e=e.subarray(a),r.join("")},()=>e.length?ii(e)+`
`:"")}function os(i){let e="";return le(i,t=>{e+=t;let r=0,n=[" ","	","\r",`
`];for(let c=0;c<n.length;c++){let u=n[c];for(let h=e.indexOf(u);h!==-1;h=e.indexOf(u,h+1))r++}let a=e.length;for(;a>0&&(a-r)%4!=0;a--)n.includes(e[a])&&r--;let s=ni(e.substr(0,a));return e=e.substr(a),s},()=>ni(e))}function et(i){return os(i.replace(/-/g,"+").replace(/_/g,"/"))}function Be(i,e){let t=wt(i).replace(/[\r\n]/g,"");return t=t.replace(/[+]/g,"-").replace(/[/]/g,"_").replace(/[=]/g,""),t}function io(i){let e=i.match(/^-----BEGIN PGP (MESSAGE, PART \d+\/\d+|MESSAGE, PART \d+|SIGNED MESSAGE|MESSAGE|PUBLIC KEY BLOCK|PRIVATE KEY BLOCK|SIGNATURE)-----$/m);if(!e)throw Error("Unknown ASCII armor type");return/MESSAGE, PART \d+\/\d+/.test(e[1])?o.armor.multipartSection:/MESSAGE, PART \d+/.test(e[1])?o.armor.multipartLast:/SIGNED MESSAGE/.test(e[1])?o.armor.signed:/MESSAGE/.test(e[1])?o.armor.message:/PUBLIC KEY BLOCK/.test(e[1])?o.armor.publicKey:/PRIVATE KEY BLOCK/.test(e[1])?o.armor.privateKey:/SIGNATURE/.test(e[1])?o.armor.signature:void 0}function Ot(i,e){let t="";return e.showVersion&&(t+="Version: "+e.versionString+`
`),e.showComment&&(t+="Comment: "+e.commentString+`
`),i&&(t+="Comment: "+i+`
`),t+=`
`,t}function _t(i){let e=function(t){let r=13501623;return le(t,n=>{let a=no?Math.floor(n.length/4):0,s=new Uint32Array(n.buffer,n.byteOffset,a);for(let c=0;c<a;c++)r^=s[c],r=Ae[0][r>>24&255]^Ae[1][r>>16&255]^Ae[2][r>>8&255]^Ae[3][255&r];for(let c=4*a;c<n.length;c++)r=r>>8^Ae[0][255&r^n[c]]},()=>new Uint8Array([r,r>>8,r>>16]))}(i);return wt(e)}Gi?(ii=i=>Gi.from(i).toString("base64"),ni=i=>{let e=Gi.from(i,"base64");return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}):(ii=i=>btoa(l.uint8ArrayToString(i)),ni=i=>l.stringToUint8Array(atob(i)));var Ae=[Array(255),Array(255),Array(255),Array(255)];for(let i=0;i<=255;i++){let e=i<<16;for(let t=0;t<8;t++)e=e<<1^(8388608&e?8801531:0);Ae[0][i]=(16711680&e)>>16|65280&e|(255&e)<<16}for(let i=0;i<=255;i++)Ae[1][i]=Ae[0][i]>>8^Ae[0][255&Ae[0][i]];for(let i=0;i<=255;i++)Ae[2][i]=Ae[1][i]>>8^Ae[0][255&Ae[1][i]];for(let i=0;i<=255;i++)Ae[3][i]=Ae[2][i]>>8^Ae[0][255&Ae[2][i]];var no=function(){let i=new ArrayBuffer(2);return new DataView(i).setInt16(0,255,!0),new Int16Array(i)[0]===255}();function aa(i){for(let e=0;e<i.length;e++)/^([^\s:]|[^\s:][^:]*[^\s:]): .+$/.test(i[e])||l.printDebugError(Error("Improperly formatted armor header: "+i[e])),/^(Version|Comment|MessageID|Hash|Charset): .+$/.test(i[e])||l.printDebugError(Error("Unknown header: "+i[e]))}function ao(i){let e=i,t=i.lastIndexOf("=");return t>=0&&t!==i.length-1&&(e=i.slice(0,t)),e}function Hr(i){return new Promise((e,t)=>f(this,null,function*(){try{let r=/^-----[^-]+-----$/m,n=/^[ \f\r\t\u00a0\u2000-\u200a\u202f\u205f\u3000]*$/,a,s=[],c,u,h=s,y=[],p=os(Ht(i,(g,d)=>f(this,null,function*(){let w=Pt(g);try{for(;;){let b=yield w.readLine();if(b===void 0)throw Error("Misformed armored text");if(b=l.removeTrailingSpaces(b.replace(/[\r\n]/g,"")),a)if(c)u||a!==o.armor.signed||(r.test(b)?(y=y.join(`\r
`),u=!0,aa(h),h=[],c=!1):y.push(b.replace(/^- /,"")));else if(r.test(b)&&t(Error("Mandatory blank line missing between armor headers and armor data")),n.test(b)){if(aa(h),c=!0,u||a!==o.armor.signed){e({text:y,data:p,headers:s,type:a});break}}else h.push(b);else r.test(b)&&(a=io(b))}}catch(b){return void t(b)}let m=Ge(d);try{for(;;){yield m.ready;let{done:b,value:v}=yield w.read();if(b)throw Error("Misformed armored text");let A=v+"";if(A.indexOf("=")!==-1||A.indexOf("-")!==-1){let S=yield w.readToEnd();S.length||(S=""),S=A+S,S=l.removeTrailingSpaces(S.replace(/\r/g,""));let K=S.split(r);if(K.length===1)throw Error("Misformed armored text");let D=ao(K[0].slice(0,-1));yield m.write(D);break}yield m.write(A)}yield m.ready,yield m.close()}catch(b){yield m.abort(b)}})))}catch(r){t(r)}})).then(e=>f(this,null,function*(){return ge(e.data)&&(e.data=yield ke(e.data)),e}))}function jr(i,e,t,r,n,a=!1,s=M){let c,u;i===o.armor.signed&&(c=e.text,u=e.hash,e=e.data);let h=a&&Pr(e),y=[];switch(i){case o.armor.multipartSection:y.push("-----BEGIN PGP MESSAGE, PART "+t+"/"+r+`-----
`),y.push(Ot(n,s)),y.push(wt(e)),h&&y.push("=",_t(h)),y.push("-----END PGP MESSAGE, PART "+t+"/"+r+`-----
`);break;case o.armor.multipartLast:y.push("-----BEGIN PGP MESSAGE, PART "+t+`-----
`),y.push(Ot(n,s)),y.push(wt(e)),h&&y.push("=",_t(h)),y.push("-----END PGP MESSAGE, PART "+t+`-----
`);break;case o.armor.signed:y.push(`-----BEGIN PGP SIGNED MESSAGE-----
`),y.push(u?`Hash: ${u}

`:`
`),y.push(c.replace(/^-/gm,"- -")),y.push(`
-----BEGIN PGP SIGNATURE-----
`),y.push(Ot(n,s)),y.push(wt(e)),h&&y.push("=",_t(h)),y.push(`-----END PGP SIGNATURE-----
`);break;case o.armor.message:y.push(`-----BEGIN PGP MESSAGE-----
`),y.push(Ot(n,s)),y.push(wt(e)),h&&y.push("=",_t(h)),y.push(`-----END PGP MESSAGE-----
`);break;case o.armor.publicKey:y.push(`-----BEGIN PGP PUBLIC KEY BLOCK-----
`),y.push(Ot(n,s)),y.push(wt(e)),h&&y.push("=",_t(h)),y.push(`-----END PGP PUBLIC KEY BLOCK-----
`);break;case o.armor.privateKey:y.push(`-----BEGIN PGP PRIVATE KEY BLOCK-----
`),y.push(Ot(n,s)),y.push(wt(e)),h&&y.push("=",_t(h)),y.push(`-----END PGP PRIVATE KEY BLOCK-----
`);break;case o.armor.signature:y.push(`-----BEGIN PGP SIGNATURE-----
`),y.push(Ot(n,s)),y.push(wt(e)),h&&y.push("=",_t(h)),y.push(`-----END PGP SIGNATURE-----
`)}return l.concat(y)}function dn(i){return f(this,null,function*(){switch(i){case o.symmetric.aes128:case o.symmetric.aes192:case o.symmetric.aes256:throw Error("Not a legacy cipher");case o.symmetric.cast5:case o.symmetric.blowfish:case o.symmetric.twofish:case o.symmetric.tripledes:{let{legacyCiphers:e}=yield import("./chunk-C4BQ34MB.js"),t=e.get(i);if(!t)throw Error("Unsupported cipher algorithm");return t}default:throw Error("Unsupported cipher algorithm")}})}function so(i){switch(i){case o.symmetric.aes128:case o.symmetric.aes192:case o.symmetric.aes256:case o.symmetric.twofish:return 16;case o.symmetric.blowfish:case o.symmetric.cast5:case o.symmetric.tripledes:return 8;default:throw Error("Unsupported cipher")}}function oo(i){switch(i){case o.symmetric.aes128:case o.symmetric.blowfish:case o.symmetric.cast5:return 16;case o.symmetric.aes192:case o.symmetric.tripledes:return 24;case o.symmetric.aes256:case o.symmetric.twofish:return 32;default:throw Error("Unsupported cipher")}}function Ie(i){return{keySize:oo(i),blockSize:so(i)}}var co=Object.freeze({__proto__:null,getCipherParams:Ie,getLegacyCipher:dn});function Vi(i,e){let t=i[0],r=i[1],n=i[2],a=i[3];t=Pe(t,r,n,a,e[0],7,-680876936),a=Pe(a,t,r,n,e[1],12,-389564586),n=Pe(n,a,t,r,e[2],17,606105819),r=Pe(r,n,a,t,e[3],22,-1044525330),t=Pe(t,r,n,a,e[4],7,-176418897),a=Pe(a,t,r,n,e[5],12,1200080426),n=Pe(n,a,t,r,e[6],17,-1473231341),r=Pe(r,n,a,t,e[7],22,-45705983),t=Pe(t,r,n,a,e[8],7,1770035416),a=Pe(a,t,r,n,e[9],12,-1958414417),n=Pe(n,a,t,r,e[10],17,-42063),r=Pe(r,n,a,t,e[11],22,-1990404162),t=Pe(t,r,n,a,e[12],7,1804603682),a=Pe(a,t,r,n,e[13],12,-40341101),n=Pe(n,a,t,r,e[14],17,-1502002290),r=Pe(r,n,a,t,e[15],22,1236535329),t=Ue(t,r,n,a,e[1],5,-165796510),a=Ue(a,t,r,n,e[6],9,-1069501632),n=Ue(n,a,t,r,e[11],14,643717713),r=Ue(r,n,a,t,e[0],20,-373897302),t=Ue(t,r,n,a,e[5],5,-701558691),a=Ue(a,t,r,n,e[10],9,38016083),n=Ue(n,a,t,r,e[15],14,-660478335),r=Ue(r,n,a,t,e[4],20,-405537848),t=Ue(t,r,n,a,e[9],5,568446438),a=Ue(a,t,r,n,e[14],9,-1019803690),n=Ue(n,a,t,r,e[3],14,-187363961),r=Ue(r,n,a,t,e[8],20,1163531501),t=Ue(t,r,n,a,e[13],5,-1444681467),a=Ue(a,t,r,n,e[2],9,-51403784),n=Ue(n,a,t,r,e[7],14,1735328473),r=Ue(r,n,a,t,e[12],20,-1926607734),t=De(t,r,n,a,e[5],4,-378558),a=De(a,t,r,n,e[8],11,-2022574463),n=De(n,a,t,r,e[11],16,1839030562),r=De(r,n,a,t,e[14],23,-35309556),t=De(t,r,n,a,e[1],4,-1530992060),a=De(a,t,r,n,e[4],11,1272893353),n=De(n,a,t,r,e[7],16,-155497632),r=De(r,n,a,t,e[10],23,-1094730640),t=De(t,r,n,a,e[13],4,681279174),a=De(a,t,r,n,e[0],11,-358537222),n=De(n,a,t,r,e[3],16,-722521979),r=De(r,n,a,t,e[6],23,76029189),t=De(t,r,n,a,e[9],4,-640364487),a=De(a,t,r,n,e[12],11,-421815835),n=De(n,a,t,r,e[15],16,530742520),r=De(r,n,a,t,e[2],23,-995338651),t=Ce(t,r,n,a,e[0],6,-198630844),a=Ce(a,t,r,n,e[7],10,1126891415),n=Ce(n,a,t,r,e[14],15,-1416354905),r=Ce(r,n,a,t,e[5],21,-57434055),t=Ce(t,r,n,a,e[12],6,1700485571),a=Ce(a,t,r,n,e[3],10,-1894986606),n=Ce(n,a,t,r,e[10],15,-1051523),r=Ce(r,n,a,t,e[1],21,-2054922799),t=Ce(t,r,n,a,e[8],6,1873313359),a=Ce(a,t,r,n,e[15],10,-30611744),n=Ce(n,a,t,r,e[6],15,-1560198380),r=Ce(r,n,a,t,e[13],21,1309151649),t=Ce(t,r,n,a,e[4],6,-145523070),a=Ce(a,t,r,n,e[11],10,-1120210379),n=Ce(n,a,t,r,e[2],15,718787259),r=Ce(r,n,a,t,e[9],21,-343485551),i[0]=Tt(t,i[0]),i[1]=Tt(r,i[1]),i[2]=Tt(n,i[2]),i[3]=Tt(a,i[3])}function Fi(i,e,t,r,n,a){return e=Tt(Tt(e,i),Tt(r,a)),Tt(e<<n|e>>>32-n,t)}function Pe(i,e,t,r,n,a,s){return Fi(e&t|~e&r,i,e,n,a,s)}function Ue(i,e,t,r,n,a,s){return Fi(e&r|t&~r,i,e,n,a,s)}function De(i,e,t,r,n,a,s){return Fi(e^t^r,i,e,n,a,s)}function Ce(i,e,t,r,n,a,s){return Fi(t^(e|~r),i,e,n,a,s)}function uo(i){let e=[],t;for(t=0;t<64;t+=4)e[t>>2]=i.charCodeAt(t)+(i.charCodeAt(t+1)<<8)+(i.charCodeAt(t+2)<<16)+(i.charCodeAt(t+3)<<24);return e}var sa="0123456789abcdef".split("");function ho(i){let e="",t=0;for(;t<4;t++)e+=sa[i>>8*t+4&15]+sa[i>>8*t&15];return e}function Tt(i,e){return i+e&4294967295}var oa=l.getWebCrypto(),ai=l.getNodeCrypto(),yo=ai&&ai.getHashes();function dt(i){if(ai&&yo.includes(i))return function(e){return f(this,null,function*(){let t=ai.createHash(i);return le(e,r=>{t.update(r)},()=>new Uint8Array(t.digest()))})}}function Dt(i,e){let t=()=>f(this,null,function*(){let{nobleHashes:r}=yield import("./chunk-Q3SVVBIH.js"),n=r.get(i);if(!n)throw Error("Unsupported hash");return n});return function(r){return f(this,null,function*(){if(ge(r)&&(r=yield ke(r)),l.isStream(r)){let n=(yield t()).create();return le(r,a=>{n.update(a)},()=>n.digest())}return oa&&e?new Uint8Array(yield oa.digest(e,r)):(yield t())(r)})}}var qe={md5:dt("md5")||function(i){return f(this,null,function*(){let e=function(t){let r=t.length,n=[1732584193,-271733879,-1732584194,271733878],a;for(a=64;a<=t.length;a+=64)Vi(n,uo(t.substring(a-64,a)));t=t.substring(a-64);let s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(a=0;a<t.length;a++)s[a>>2]|=t.charCodeAt(a)<<(a%4<<3);if(s[a>>2]|=128<<(a%4<<3),a>55)for(Vi(n,s),a=0;a<16;a++)s[a]=0;return s[14]=8*r,Vi(n,s),n}(l.uint8ArrayToString(i));return l.hexToUint8Array(function(t){for(let r=0;r<t.length;r++)t[r]=ho(t[r]);return t.join("")}(e))})},sha1:dt("sha1")||Dt("sha1","SHA-1"),sha224:dt("sha224")||Dt("sha224"),sha256:dt("sha256")||Dt("sha256","SHA-256"),sha384:dt("sha384")||Dt("sha384","SHA-384"),sha512:dt("sha512")||Dt("sha512","SHA-512"),ripemd:dt("ripemd160")||Dt("ripemd160"),sha3_256:dt("sha3-256")||Dt("sha3_256"),sha3_512:dt("sha3-512")||Dt("sha3_512"),digest:function(i,e){switch(i){case o.hash.md5:return this.md5(e);case o.hash.sha1:return this.sha1(e);case o.hash.ripemd:return this.ripemd(e);case o.hash.sha256:return this.sha256(e);case o.hash.sha384:return this.sha384(e);case o.hash.sha512:return this.sha512(e);case o.hash.sha224:return this.sha224(e);case o.hash.sha3_256:return this.sha3_256(e);case o.hash.sha3_512:return this.sha3_512(e);default:throw Error("Unsupported hash function")}},getHashByteLength:function(i){switch(i){case o.hash.md5:return 16;case o.hash.sha1:case o.hash.ripemd:return 20;case o.hash.sha256:return 32;case o.hash.sha384:return 48;case o.hash.sha512:return 64;case o.hash.sha224:return 28;case o.hash.sha3_256:return 32;case o.hash.sha3_512:return 64;default:throw Error("Invalid hash algorithm.")}}};function cs(i){return i instanceof Uint8Array||i!=null&&typeof i=="object"&&i.constructor.name==="Uint8Array"}function Z(i,...e){if(!cs(i))throw Error("Uint8Array expected");if(e.length>0&&!e.includes(i.length))throw Error(`Uint8Array expected of length ${e}, not of length=${i.length}`)}function si(i,e=!0){if(i.destroyed)throw Error("Hash instance has been destroyed");if(e&&i.finished)throw Error("Hash#digest() has already been called")}function us(i,e){Z(i);let t=e.outputLen;if(i.length<t)throw Error("digestInto() expects output buffer of length at least "+t)}var Gn=i=>new Uint8Array(i.buffer,i.byteOffset,i.byteLength),se=i=>new Uint32Array(i.buffer,i.byteOffset,Math.floor(i.byteLength/4)),oi=i=>new DataView(i.buffer,i.byteOffset,i.byteLength);if(new Uint8Array(new Uint32Array([287454020]).buffer)[0]!==68)throw Error("Non little-endian hardware is not supported");function Dr(i){if(typeof i=="string")i=function(e){if(typeof e!="string")throw Error("string expected, got "+typeof e);return new Uint8Array(new TextEncoder().encode(e))}(i);else{if(!cs(i))throw Error("Uint8Array expected, got "+typeof i);i=Re(i)}return i}function hs(i,e){if(i.length!==e.length)return!1;let t=0;for(let r=0;r<i.length;r++)t|=i[r]^e[r];return t===0}var Or=(i,e)=>(Object.assign(e,i),e);function Wi(i,e,t,r){if(typeof i.setBigUint64=="function")return i.setBigUint64(e,t,r);let n=BigInt(32),a=BigInt(4294967295),s=Number(t>>n&a),c=Number(t&a);i.setUint32(e+0,s,r),i.setUint32(e+4,c,r)}function Qe(i){return i.byteOffset%4==0}function Re(i){return Uint8Array.from(i)}function xe(...i){for(let e=0;e<i.length;e++)i[e].fill(0)}var bt=16,Vn=new Uint8Array(16),ot=se(Vn),Ve=i=>(i>>>0&255)<<24|(i>>>8&255)<<16|(i>>>16&255)<<8|i>>>24&255,ci=class{constructor(e,t){this.blockLen=bt,this.outputLen=bt,this.s0=0,this.s1=0,this.s2=0,this.s3=0,this.finished=!1,Z(e=Dr(e),16);let r=oi(e),n=r.getUint32(0,!1),a=r.getUint32(4,!1),s=r.getUint32(8,!1),c=r.getUint32(12,!1),u=[];for(let v=0;v<128;v++)u.push({s0:Ve(n),s1:Ve(a),s2:Ve(s),s3:Ve(c)}),{s0:n,s1:a,s2:s,s3:c}={s3:(p=s)<<31|(g=c)>>>1,s2:(y=a)<<31|p>>>1,s1:(h=n)<<31|y>>>1,s0:h>>>1^225<<24&-(1&g)};var h,y,p,g;let d=(v=>v>65536?8:v>1024?4:2)(t||1024);if(![1,2,4,8].includes(d))throw Error(`ghash: wrong window size=${d}, should be 2, 4 or 8`);this.W=d;let w=128/d,m=this.windowSize=2**d,b=[];for(let v=0;v<w;v++)for(let A=0;A<m;A++){let S=0,K=0,D=0,B=0;for(let P=0;P<d;P++){if(!(A>>>d-P-1&1))continue;let{s0:k,s1:U,s2:I,s3:E}=u[d*v+P];S^=k,K^=U,D^=I,B^=E}b.push({s0:S,s1:K,s2:D,s3:B})}this.t=b}_updateBlock(e,t,r,n){e^=this.s0,t^=this.s1,r^=this.s2,n^=this.s3;let{W:a,t:s,windowSize:c}=this,u=0,h=0,y=0,p=0,g=(1<<a)-1,d=0;for(let w of[e,t,r,n])for(let m=0;m<4;m++){let b=w>>>8*m&255;for(let v=8/a-1;v>=0;v--){let A=b>>>a*v&g,{s0:S,s1:K,s2:D,s3:B}=s[d*c+A];u^=S,h^=K,y^=D,p^=B,d+=1}}this.s0=u,this.s1=h,this.s2=y,this.s3=p}update(e){e=Dr(e),si(this);let t=se(e),r=Math.floor(e.length/bt),n=e.length%bt;for(let a=0;a<r;a++)this._updateBlock(t[4*a+0],t[4*a+1],t[4*a+2],t[4*a+3]);return n&&(Vn.set(e.subarray(r*bt)),this._updateBlock(ot[0],ot[1],ot[2],ot[3]),xe(ot)),this}destroy(){let{t:e}=this;for(let t of e)t.s0=0,t.s1=0,t.s2=0,t.s3=0}digestInto(e){si(this),us(e,this),this.finished=!0;let{s0:t,s1:r,s2:n,s3:a}=this,s=se(e);return s[0]=t,s[1]=r,s[2]=n,s[3]=a,e}digest(){let e=new Uint8Array(bt);return this.digestInto(e),this.destroy(),e}},fn=class extends ci{constructor(e,t){let r=function(n){n.reverse();let a=1&n[15],s=0;for(let c=0;c<n.length;c++){let u=n[c];n[c]=u>>>1|s,s=(1&u)<<7}return n[0]^=225&-a,n}(Re(e=Dr(e)));super(r,t),xe(r)}update(e){e=Dr(e),si(this);let t=se(e),r=e.length%bt,n=Math.floor(e.length/bt);for(let a=0;a<n;a++)this._updateBlock(Ve(t[4*a+3]),Ve(t[4*a+2]),Ve(t[4*a+1]),Ve(t[4*a+0]));return r&&(Vn.set(e.subarray(n*bt)),this._updateBlock(Ve(ot[3]),Ve(ot[2]),Ve(ot[1]),Ve(ot[0])),xe(ot)),this}digestInto(e){si(this),us(e,this),this.finished=!0;let{s0:t,s1:r,s2:n,s3:a}=this,s=se(e);return s[0]=t,s[1]=r,s[2]=n,s[3]=a,e.reverse()}};function ys(i){let e=(r,n)=>i(n,r.length).update(Dr(r)).digest(),t=i(new Uint8Array(16),0);return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=(r,n)=>i(r,n),e}var ca=ys((i,e)=>new ci(i,e));ys((i,e)=>new fn(i,e));var Me=16,_r=new Uint8Array(Me),lo=283;function Wn(i){return i<<1^lo&-(i>>7)}function nr(i,e){let t=0;for(;e>0;e>>=1)t^=i&-(1&e),i=Wn(i);return t}var mn=(()=>{let i=new Uint8Array(256);for(let t=0,r=1;t<256;t++,r^=Wn(r))i[t]=r;let e=new Uint8Array(256);e[0]=99;for(let t=0;t<255;t++){let r=i[255-t];r|=r<<8,e[i[t]]=255&(r^r>>4^r>>5^r>>6^r>>7^99)}return xe(i),e})(),po=mn.map((i,e)=>mn.indexOf(e)),go=i=>i<<24|i>>>8,$i=i=>i<<8|i>>>24,ua=i=>i<<24&4278190080|i<<8&16711680|i>>>8&65280|i>>>24&255;function ls(i,e){if(i.length!==256)throw Error("Wrong sbox length");let t=new Uint32Array(256).map((h,y)=>e(i[y])),r=t.map($i),n=r.map($i),a=n.map($i),s=new Uint32Array(65536),c=new Uint32Array(65536),u=new Uint16Array(65536);for(let h=0;h<256;h++)for(let y=0;y<256;y++){let p=256*h+y;s[p]=t[h]^r[y],c[p]=n[h]^a[y],u[p]=i[h]<<8|i[y]}return{sbox:i,sbox2:u,T0:t,T1:r,T2:n,T3:a,T01:s,T23:c}}var $n=ls(mn,i=>nr(i,3)<<24|i<<16|i<<8|nr(i,2)),ps=ls(po,i=>nr(i,11)<<24|nr(i,13)<<16|nr(i,9)<<8|nr(i,14)),fo=(()=>{let i=new Uint8Array(16);for(let e=0,t=1;e<16;e++,t=Wn(t))i[e]=t;return i})();function Jt(i){Z(i);let e=i.length;if(![16,24,32].includes(e))throw Error("aes: wrong key size: should be 16, 24 or 32, got: "+e);let{sbox2:t}=$n,r=[];Qe(i)||r.push(i=Re(i));let n=se(i),a=n.length,s=u=>ut(t,u,u,u,u),c=new Uint32Array(e+28);c.set(n);for(let u=a;u<c.length;u++){let h=c[u-1];u%a==0?h=s(go(h))^fo[u/a-1]:a>6&&u%a==4&&(h=s(h)),c[u]=c[u-a]^h}return xe(...r),c}function Qn(i){let e=Jt(i),t=e.slice(),r=e.length,{sbox2:n}=$n,{T0:a,T1:s,T2:c,T3:u}=ps;for(let h=0;h<r;h+=4)for(let y=0;y<4;y++)t[h+y]=e[r-h-4+y];xe(e);for(let h=4;h<r-4;h++){let y=t[h],p=ut(n,y,y,y,y);t[h]=a[255&p]^s[p>>>8&255]^c[p>>>16&255]^u[p>>>24]}return t}function Mt(i,e,t,r,n,a){return i[t<<8&65280|r>>>8&255]^e[n>>>8&65280|a>>>24&255]}function ut(i,e,t,r,n){return i[255&e|65280&t]|i[r>>>16&255|n>>>16&65280]<<16}function tt(i,e,t,r,n){let{sbox2:a,T01:s,T23:c}=$n,u=0;e^=i[u++],t^=i[u++],r^=i[u++],n^=i[u++];let h=i.length/4-2;for(let y=0;y<h;y++){let p=i[u++]^Mt(s,c,e,t,r,n),g=i[u++]^Mt(s,c,t,r,n,e),d=i[u++]^Mt(s,c,r,n,e,t),w=i[u++]^Mt(s,c,n,e,t,r);e=p,t=g,r=d,n=w}return{s0:i[u++]^ut(a,e,t,r,n),s1:i[u++]^ut(a,t,r,n,e),s2:i[u++]^ut(a,r,n,e,t),s3:i[u++]^ut(a,n,e,t,r)}}function Ri(i,e,t,r,n){let{sbox2:a,T01:s,T23:c}=ps,u=0;e^=i[u++],t^=i[u++],r^=i[u++],n^=i[u++];let h=i.length/4-2;for(let y=0;y<h;y++){let p=i[u++]^Mt(s,c,e,n,r,t),g=i[u++]^Mt(s,c,t,e,n,r),d=i[u++]^Mt(s,c,r,t,e,n),w=i[u++]^Mt(s,c,n,r,t,e);e=p,t=g,r=d,n=w}return{s0:i[u++]^ut(a,e,n,r,t),s1:i[u++]^ut(a,t,e,n,r),s2:i[u++]^ut(a,r,t,e,n),s3:i[u++]^ut(a,n,r,t,e)}}function Cr(i,e){if(e===void 0)return new Uint8Array(i);if(Z(e),e.length<i)throw Error(`aes: wrong destination length, expected at least ${i}, got: ${e.length}`);if(!Qe(e))throw Error("unaligned dst");return e}function gs(i,e,t,r){Z(e,Me),Z(t);let n=t.length;r=Cr(n,r);let a=e,s=se(a),{s0:c,s1:u,s2:h,s3:y}=tt(i,s[0],s[1],s[2],s[3]),p=se(t),g=se(r);for(let w=0;w+4<=p.length;w+=4){g[w+0]=p[w+0]^c,g[w+1]=p[w+1]^u,g[w+2]=p[w+2]^h,g[w+3]=p[w+3]^y;let m=1;for(let b=a.length-1;b>=0;b--)m=m+(255&a[b])|0,a[b]=255&m,m>>>=8;({s0:c,s1:u,s2:h,s3:y}=tt(i,s[0],s[1],s[2],s[3]))}let d=Me*Math.floor(p.length/4);if(d<n){let w=new Uint32Array([c,u,h,y]),m=Gn(w);for(let b=d,v=0;b<n;b++,v++)r[b]=t[b]^m[v];xe(w)}return r}function vr(i,e,t,r,n){Z(t,Me),Z(r),n=Cr(r.length,n);let a=t,s=se(a),c=oi(a),u=se(r),h=se(n),y=e?0:12,p=r.length,g=c.getUint32(y,e),{s0:d,s1:w,s2:m,s3:b}=tt(i,s[0],s[1],s[2],s[3]);for(let A=0;A+4<=u.length;A+=4)h[A+0]=u[A+0]^d,h[A+1]=u[A+1]^w,h[A+2]=u[A+2]^m,h[A+3]=u[A+3]^b,g=g+1>>>0,c.setUint32(y,g,e),{s0:d,s1:w,s2:m,s3:b}=tt(i,s[0],s[1],s[2],s[3]);let v=Me*Math.floor(u.length/4);if(v<p){let A=new Uint32Array([d,w,m,b]),S=Gn(A);for(let K=v,D=0;K<p;K++,D++)n[K]=r[K]^S[D];xe(A)}return n}var mo=Or({blockSize:16,nonceLength:16},function(i,e){function t(r,n){if(Z(r),n!==void 0&&(Z(n),!Qe(n)))throw Error("unaligned destination");let a=Jt(i),s=Re(e),c=[a,s];Qe(r)||c.push(r=Re(r));let u=gs(a,s,r,n);return xe(...c),u}return Z(i),Z(e,Me),{encrypt:(r,n)=>t(r,n),decrypt:(r,n)=>t(r,n)}}),ds=Or({blockSize:16,nonceLength:16},function(i,e,t={}){Z(i),Z(e,16);let r=!t.disablePadding;return{encrypt(n,a){let s=Jt(i),{b:c,o:u,out:h}=function(A,S,K){Z(A);let D=A.length,B=D%Me;if(!S&&B!==0)throw Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");Qe(A)||(A=Re(A));let P=se(A);if(S){let U=Me-B;U||(U=Me),D+=U}let k=Cr(D,K);return{b:P,o:se(k),out:k}}(n,r,a),y=e,p=[s];Qe(y)||p.push(y=Re(y));let g=se(y),d=g[0],w=g[1],m=g[2],b=g[3],v=0;for(;v+4<=c.length;)d^=c[v+0],w^=c[v+1],m^=c[v+2],b^=c[v+3],{s0:d,s1:w,s2:m,s3:b}=tt(s,d,w,m,b),u[v++]=d,u[v++]=w,u[v++]=m,u[v++]=b;if(r){let A=function(S){let K=new Uint8Array(16),D=se(K);K.set(S);let B=Me-S.length;for(let P=Me-B;P<Me;P++)K[P]=B;return D}(n.subarray(4*v));d^=A[0],w^=A[1],m^=A[2],b^=A[3],{s0:d,s1:w,s2:m,s3:b}=tt(s,d,w,m,b),u[v++]=d,u[v++]=w,u[v++]=m,u[v++]=b}return xe(...p),h},decrypt(n,a){(function(v){if(Z(v),v.length%Me!=0)throw Error("aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size 16")})(n);let s=Qn(i),c=e,u=[s];Qe(c)||u.push(c=Re(c));let h=se(c),y=Cr(n.length,a);Qe(n)||u.push(n=Re(n));let p=se(n),g=se(y),d=h[0],w=h[1],m=h[2],b=h[3];for(let v=0;v+4<=p.length;){let A=d,S=w,K=m,D=b;d=p[v+0],w=p[v+1],m=p[v+2],b=p[v+3];let{s0:B,s1:P,s2:k,s3:U}=Ri(s,d,w,m,b);g[v++]=B^A,g[v++]=P^S,g[v++]=k^K,g[v++]=U^D}return xe(...u),function(v,A){if(!A)return v;let S=v.length;if(!S)throw Error("aes/pcks5: empty ciphertext not allowed");let K=v[S-1];if(K<=0||K>16)throw Error("aes/pcks5: wrong padding");let D=v.subarray(0,-K);for(let B=0;B<K;B++)if(v[S-B-1]!==K)throw Error("aes/pcks5: wrong padding");return D}(y,r)}}}),ha=Or({blockSize:16,nonceLength:16},function(i,e){function t(r,n,a){Z(r);let s=r.length;a=Cr(s,a);let c=Jt(i),u=e,h=[c];Qe(u)||h.push(u=Re(u)),Qe(r)||h.push(r=Re(r));let y=se(r),p=se(a),g=n?p:y,d=se(u),w=d[0],m=d[1],b=d[2],v=d[3];for(let S=0;S+4<=y.length;){let{s0:K,s1:D,s2:B,s3:P}=tt(c,w,m,b,v);p[S+0]=y[S+0]^K,p[S+1]=y[S+1]^D,p[S+2]=y[S+2]^B,p[S+3]=y[S+3]^P,w=g[S++],m=g[S++],b=g[S++],v=g[S++]}let A=Me*Math.floor(y.length/4);if(A<s){({s0:w,s1:m,s2:b,s3:v}=tt(c,w,m,b,v));let S=Gn(new Uint32Array([w,m,b,v]));for(let K=A,D=0;K<s;K++,D++)a[K]=r[K]^S[D];xe(S)}return xe(...h),a}return Z(i),Z(e,16),{encrypt:(r,n)=>t(r,!0,n),decrypt:(r,n)=>t(r,!1,n)}}),qr=Or({blockSize:16,nonceLength:12,tagLength:16},function(i,e,t){if(Z(i),Z(e),t!==void 0&&Z(t),e.length<8)throw Error("aes/gcm: invalid nonce length");let r=16;function n(s,c,u){let h=function(y,p,g,d,w){let m=w==null?0:w.length,b=y.create(g,d.length+m);w&&b.update(w),b.update(d);let v=new Uint8Array(16),A=oi(v);w&&Wi(A,0,BigInt(8*m),p),Wi(A,8,BigInt(8*d.length),p),b.update(v);let S=b.digest();return xe(v),S}(ca,!1,s,u,t);for(let y=0;y<c.length;y++)h[y]^=c[y];return h}function a(){let s=Jt(i),c=_r.slice(),u=_r.slice();if(vr(s,!1,u,u,c),e.length===12)u.set(e);else{let h=_r.slice();Wi(oi(h),8,BigInt(8*e.length),!1);let y=ca.create(c).update(e).update(h);y.digestInto(u),y.destroy()}return{xk:s,authKey:c,counter:u,tagMask:vr(s,!1,u,_r)}}return{encrypt(s){Z(s);let{xk:c,authKey:u,counter:h,tagMask:y}=a(),p=new Uint8Array(s.length+r),g=[c,u,h,y];Qe(s)||g.push(s=Re(s)),vr(c,!1,h,s,p);let d=n(u,y,p.subarray(0,p.length-r));return g.push(d),p.set(d,s.length),xe(...g),p},decrypt(s){if(Z(s),s.length<r)throw Error("aes/gcm: ciphertext less than tagLen (16)");let{xk:c,authKey:u,counter:h,tagMask:y}=a(),p=[c,u,y,h];Qe(s)||p.push(s=Re(s));let g=s.subarray(0,-16),d=s.subarray(-16),w=n(u,y,g);if(p.push(w),!hs(w,d))throw Error("aes/gcm: invalid ghash tag");let m=vr(c,!1,h,g);return xe(...p),m}}});function fs(i){return i!=null&&typeof i=="object"&&(i instanceof Uint32Array||i.constructor.name==="Uint32Array")}function ms(i,e){if(Z(e,16),!fs(i))throw Error("_encryptBlock accepts result of expandKeyLE");let t=se(e),{s0:r,s1:n,s2:a,s3:s}=tt(i,t[0],t[1],t[2],t[3]);return t[0]=r,t[1]=n,t[2]=a,t[3]=s,e}function ws(i,e){if(Z(e,16),!fs(i))throw Error("_decryptBlock accepts result of expandKeyLE");let t=se(e),{s0:r,s1:n,s2:a,s3:s}=Ri(i,t[0],t[1],t[2],t[3]);return t[0]=r,t[1]=n,t[2]=a,t[3]=s,e}var ya={encrypt(i,e){if(e.length>=2**32)throw Error("plaintext should be less than 4gb");let t=Jt(i);if(e.length===16)ms(t,e);else{let r=se(e),n=r[0],a=r[1];for(let s=0,c=1;s<6;s++)for(let u=2;u<r.length;u+=2,c++){let{s0:h,s1:y,s2:p,s3:g}=tt(t,n,a,r[u],r[u+1]);n=h,a=y^ua(c),r[u]=p,r[u+1]=g}r[0]=n,r[1]=a}t.fill(0)},decrypt(i,e){if(e.length-8>=2**32)throw Error("ciphertext should be less than 4gb");let t=Qn(i),r=e.length/8-1;if(r===1)ws(t,e);else{let n=se(e),a=n[0],s=n[1];for(let c=0,u=6*r;c<6;c++)for(let h=2*r;h>=1;h-=2,u--){s^=ua(u);let{s0:y,s1:p,s2:g,s3:d}=Ri(t,a,s,n[h],n[h+1]);a=y,s=p,n[h]=g,n[h+1]=d}n[0]=a,n[1]=s}t.fill(0)}},la=new Uint8Array(8).fill(166),bs=Or({blockSize:8},i=>({encrypt(e){if(Z(e),!e.length||e.length%8!=0)throw Error("invalid plaintext length");if(e.length===8)throw Error("8-byte keys not allowed in AESKW, use AESKWP instead");let t=function(...r){let n=0;for(let s=0;s<r.length;s++){let c=r[s];Z(c),n+=c.length}let a=new Uint8Array(n);for(let s=0,c=0;s<r.length;s++){let u=r[s];a.set(u,c),c+=u.length}return a}(la,e);return ya.encrypt(i,t),t},decrypt(e){if(Z(e),e.length%8!=0||e.length<24)throw Error("invalid ciphertext length");let t=Re(e);if(ya.decrypt(i,t),!hs(t.subarray(0,8),la))throw Error("integrity check failed");return t.subarray(0,8).fill(0),t.subarray(8)}})),pa={expandKeyLE:Jt,expandKeyDecLE:Qn,encrypt:tt,decrypt:Ri,encryptBlock:ms,decryptBlock:ws,ctrCounter:gs,ctr32:vr},Zr=l.getWebCrypto(),Ur=l.getNodeCrypto(),qt=Ur?Ur.getCiphers():[],Gr={idea:qt.includes("idea-cfb")?"idea-cfb":void 0,tripledes:qt.includes("des-ede3-cfb")?"des-ede3-cfb":void 0,cast5:qt.includes("cast5-cfb")?"cast5-cfb":void 0,blowfish:qt.includes("bf-cfb")?"bf-cfb":void 0,aes128:qt.includes("aes-128-cfb")?"aes-128-cfb":void 0,aes192:qt.includes("aes-192-cfb")?"aes-192-cfb":void 0,aes256:qt.includes("aes-256-cfb")?"aes-256-cfb":void 0},ui=class{constructor(e,t,r){let{blockSize:n}=Ie(e);this.key=t,this.prevBlock=r,this.nextBlock=new Uint8Array(n),this.i=0,this.blockSize=n,this.zeroBlock=new Uint8Array(this.blockSize)}static isSupported(e){return f(this,null,function*(){let{keySize:t}=Ie(e);return Zr.importKey("raw",new Uint8Array(t),"aes-cbc",!1,["encrypt"]).then(()=>!0,()=>!1)})}_runCBC(e,t){return f(this,null,function*(){let r="AES-CBC";this.keyRef=this.keyRef||(yield Zr.importKey("raw",this.key,r,!1,["encrypt"]));let n=yield Zr.encrypt({name:r,iv:t||this.zeroBlock},this.keyRef,e);return new Uint8Array(n).subarray(0,e.length)})}encryptChunk(e){return f(this,null,function*(){let t=this.nextBlock.length-this.i,r=e.subarray(0,t);if(this.nextBlock.set(r,this.i),this.i+e.length>=2*this.blockSize){let a=(e.length-t)%this.blockSize,s=l.concatUint8Array([this.nextBlock,e.subarray(t,e.length-a)]),c=l.concatUint8Array([this.prevBlock,s.subarray(0,s.length-this.blockSize)]),u=yield this._runCBC(c);return Vr(u,s),this.prevBlock=u.slice(-this.blockSize),a>0&&this.nextBlock.set(e.subarray(-a)),this.i=a,u}let n;if(this.i+=r.length,this.i===this.nextBlock.length){let a=this.nextBlock;n=yield this._runCBC(this.prevBlock),Vr(n,a),this.prevBlock=n.slice(),this.i=0;let s=e.subarray(r.length);this.nextBlock.set(s,this.i),this.i+=s.length}else n=new Uint8Array;return n})}finish(){return f(this,null,function*(){let e;if(this.i===0)e=new Uint8Array;else{this.nextBlock=this.nextBlock.subarray(0,this.i);let t=this.nextBlock,r=yield this._runCBC(this.prevBlock);Vr(r,t),e=r.subarray(0,t.length)}return this.clearSensitiveData(),e})}clearSensitiveData(){this.nextBlock.fill(0),this.prevBlock.fill(0),this.keyRef=null,this.key=null}encrypt(e){return f(this,null,function*(){let t=(yield this._runCBC(l.concatUint8Array([new Uint8Array(this.blockSize),e]),this.iv)).subarray(0,e.length);return Vr(t,e),this.clearSensitiveData(),t})}},hi=class{constructor(e,t,r,n){this.forEncryption=e;let{blockSize:a}=Ie(t);this.key=pa.expandKeyLE(r),n.byteOffset%4!=0&&(n=n.slice()),this.prevBlock=Qi(n),this.nextBlock=new Uint8Array(a),this.i=0,this.blockSize=a}_runCFB(e){let t=Qi(e),r=new Uint8Array(e.length),n=Qi(r);for(let a=0;a+4<=n.length;a+=4){let{s0:s,s1:c,s2:u,s3:h}=pa.encrypt(this.key,this.prevBlock[0],this.prevBlock[1],this.prevBlock[2],this.prevBlock[3]);n[a+0]=t[a+0]^s,n[a+1]=t[a+1]^c,n[a+2]=t[a+2]^u,n[a+3]=t[a+3]^h,this.prevBlock=(this.forEncryption?n:t).slice(a,a+4)}return r}processChunk(e){return f(this,null,function*(){let t=this.nextBlock.length-this.i,r=e.subarray(0,t);if(this.nextBlock.set(r,this.i),this.i+e.length>=2*this.blockSize){let a=(e.length-t)%this.blockSize,s=l.concatUint8Array([this.nextBlock,e.subarray(t,e.length-a)]),c=this._runCFB(s);return a>0&&this.nextBlock.set(e.subarray(-a)),this.i=a,c}let n;if(this.i+=r.length,this.i===this.nextBlock.length){n=this._runCFB(this.nextBlock),this.i=0;let a=e.subarray(r.length);this.nextBlock.set(a,this.i),this.i+=a.length}else n=new Uint8Array;return n})}finish(){return f(this,null,function*(){let e;return this.i===0?e=new Uint8Array:e=this._runCFB(this.nextBlock).subarray(0,this.i),this.clearSensitiveData(),e})}clearSensitiveData(){this.nextBlock.fill(0),this.prevBlock.fill(0),this.key.fill(0)}};function Vr(i,e){let t=Math.min(i.length,e.length);for(let r=0;r<t;r++)i[r]=i[r]^e[r]}var Qi=i=>new Uint32Array(i.buffer,i.byteOffset,Math.floor(i.byteLength/4)),wo=Object.freeze({__proto__:null,decrypt:function(i,e,t,r){return f(this,null,function*(){let n=o.read(o.symmetric,i);if(Ur&&Gr[n])return function(y,p,g,d){let w=o.read(o.symmetric,y),m=new Ur.createDecipheriv(Gr[w],p,d);return le(g,b=>new Uint8Array(m.update(b)))}(i,e,t,r);if(l.isAES(i))return function(y,p,g,d){return f(this,null,function*(){if(l.isStream(g)){let w=new hi(!1,y,p,d);return le(g,m=>w.processChunk(m),()=>w.finish())}return ha(p,d).decrypt(g)})}(i,e,t,r);let a=new(yield dn(i))(e),s=a.blockSize,c=r,u=new Uint8Array,h=y=>{y&&(u=l.concatUint8Array([u,y]));let p=new Uint8Array(u.length),g,d=0;for(;y?u.length>=s:u.length;){let w=a.encrypt(c);for(c=u.subarray(0,s),g=0;g<s;g++)p[d++]=c[g]^w[g];u=u.subarray(s)}return p.subarray(0,d)};return le(t,h,h)})},encrypt:function(i,e,t,r,n){return f(this,null,function*(){let a=o.read(o.symmetric,i);if(l.getNodeCrypto()&&Gr[a])return function(p,g,d,w){let m=o.read(o.symmetric,p),b=new Ur.createCipheriv(Gr[m],g,w);return le(d,v=>new Uint8Array(b.update(v)))}(i,e,t,r);if(l.isAES(i))return function(p,g,d,w){return f(this,null,function*(){if(Zr&&(yield ui.isSupported(p))){let m=new ui(p,g,w);return l.isStream(d)?le(d,b=>m.encryptChunk(b),()=>m.finish()):m.encrypt(d)}if(l.isStream(d)){let m=new hi(!0,p,g,w);return le(d,b=>m.processChunk(b),()=>m.finish())}return ha(g,w).encrypt(d)})}(i,e,t,r);let s=new(yield dn(i))(e),c=s.blockSize,u=r.slice(),h=new Uint8Array,y=p=>{p&&(h=l.concatUint8Array([h,p]));let g=new Uint8Array(h.length),d,w=0;for(;p?h.length>=c:h.length;){let m=s.encrypt(u);for(d=0;d<c;d++)u[d]=h[d]^m[d],g[w++]=u[d];h=h.subarray(c)}return g.subarray(0,w)};return le(t,y,y)})}}),ga=l.getWebCrypto(),bo=l.getNodeCrypto(),vt=16;function da(i,e){let t=i.length-vt;for(let r=0;r<vt;r++)i[r+t]^=e[r];return i}var Jr=new Uint8Array(vt);function ko(i){return f(this,null,function*(){let e=yield vo(i),t=l.double(yield e(Jr)),r=l.double(t);return function(n){return f(this,null,function*(){return(yield e(function(a,s,c){if(a.length&&a.length%vt==0)return da(a,s);let u=new Uint8Array(a.length+(vt-a.length%vt));return u.set(a),u[a.length]=128,da(u,c)}(n,t,r))).subarray(-vt)})}})}function vo(i){return f(this,null,function*(){if(l.getNodeCrypto())return function(e){return f(this,null,function*(){let t=new bo.createCipheriv("aes-"+8*i.length+"-cbc",i,Jr).update(e);return new Uint8Array(t)})};if(l.getWebCrypto())try{return i=yield ga.importKey("raw",i,{name:"AES-CBC",length:8*i.length},!1,["encrypt"]),function(e){return f(this,null,function*(){let t=yield ga.encrypt({name:"AES-CBC",iv:Jr,length:8*vt},i,e);return new Uint8Array(t).subarray(0,t.byteLength-vt)})}}catch(e){if(e.name!=="NotSupportedError"&&(i.length!==24||e.name!=="OperationError"))throw e;l.printDebugError("Browser did not support operation: "+e.message)}return function(e){return f(this,null,function*(){return ds(i,Jr,{disablePadding:!0}).encrypt(e)})}})}var fa=l.getWebCrypto(),Ao=l.getNodeCrypto(),Ko=l.getNodeBuffer(),Kt=16,Eo=Kt,rr=Kt,ma=new Uint8Array(Kt),wn=new Uint8Array(Kt);wn[Kt-1]=1;var bn=new Uint8Array(Kt);function So(i){return f(this,null,function*(){let e=yield ko(i);return function(t,r){return e(l.concatUint8Array([t,r]))}})}function Po(i){return f(this,null,function*(){if(l.getNodeCrypto())return function(e,t){return f(this,null,function*(){let r=new Ao.createCipheriv("aes-"+8*i.length+"-ctr",i,t),n=Ko.concat([r.update(e),r.final()]);return new Uint8Array(n)})};if(l.getWebCrypto())try{let e=yield fa.importKey("raw",i,{name:"AES-CTR",length:8*i.length},!1,["encrypt"]);return function(t,r){return f(this,null,function*(){let n=yield fa.encrypt({name:"AES-CTR",counter:r,length:8*Kt},e,t);return new Uint8Array(n)})}}catch(e){if(e.name!=="NotSupportedError"&&(i.length!==24||e.name!=="OperationError"))throw e;l.printDebugError("Browser did not support operation: "+e.message)}return function(e,t){return f(this,null,function*(){return mo(i,t).encrypt(e)})}})}function Ar(i,e){return f(this,null,function*(){if(i!==o.symmetric.aes128&&i!==o.symmetric.aes192&&i!==o.symmetric.aes256)throw Error("EAX mode supports only AES cipher");let[t,r]=yield Promise.all([So(e),Po(e)]);return{encrypt:function(n,a,s){return f(this,null,function*(){let[c,u]=yield Promise.all([t(ma,a),t(wn,s)]),h=yield r(n,c),y=yield t(bn,h);for(let p=0;p<rr;p++)y[p]^=u[p]^c[p];return l.concatUint8Array([h,y])})},decrypt:function(n,a,s){return f(this,null,function*(){if(n.length<rr)throw Error("Invalid EAX ciphertext");let c=n.subarray(0,-rr),u=n.subarray(-rr),[h,y,p]=yield Promise.all([t(ma,a),t(wn,s),t(bn,c)]),g=p;for(let d=0;d<rr;d++)g[d]^=y[d]^h[d];if(!l.equalsUint8Array(u,g))throw Error("Authentication tag mismatch");return yield r(c,h)})}}})}bn[Kt-1]=2,Ar.getNonce=function(i,e){let t=i.slice();for(let r=0;r<e.length;r++)t[8+r]^=e[r];return t},Ar.blockLength=Kt,Ar.ivLength=Eo,Ar.tagLength=rr;var je=16,kn=16;function wa(i){let e=0;for(let t=1;!(i&t);t<<=1)e++;return e}function Te(i,e){for(let t=0;t<i.length;t++)i[t]^=e[t];return i}function Wr(i,e){return Te(i.slice(),e)}var $r=new Uint8Array(je),Uo=new Uint8Array([1]);function Kr(i,e){return f(this,null,function*(){let{keySize:t}=Ie(i);if(!l.isAES(i)||e.length!==t)throw Error("Unexpected algorithm or key size");let r=0,n=ds(e,$r,{disablePadding:!0}),a=h=>n.encrypt(h),s=h=>n.decrypt(h),c;function u(h,y,p,g){let d=y.length/je|0;(function(k,U){let I=l.nbits(Math.max(k.length,U.length)/je|0)-1;for(let E=r+1;E<=I;E++)c[E]=l.double(c[E-1]);r=I})(y,g);let w=l.concatUint8Array([$r.subarray(0,15-p.length),Uo,p]),m=63&w[15];w[15]&=192;let b=a(w),v=l.concatUint8Array([b,Wr(b.subarray(0,8),b.subarray(1,9))]),A=l.shiftRight(v.subarray(0+(m>>3),17+(m>>3)),8-(7&m)).subarray(1),S=new Uint8Array(je),K=new Uint8Array(y.length+kn),D,B=0;for(D=0;D<d;D++)Te(A,c[wa(D+1)]),K.set(Te(h(Wr(A,y)),A),B),Te(S,h===a?y:K.subarray(B)),y=y.subarray(je),B+=je;if(y.length){Te(A,c.x);let k=a(A);K.set(Wr(y,k),B);let U=new Uint8Array(je);U.set(h===a?y:K.subarray(B,-16),0),U[y.length]=128,Te(S,U),B+=y.length}let P=Te(a(Te(Te(S,A),c.$)),function(k){if(!k.length)return $r;let U=k.length/je|0,I=new Uint8Array(je),E=new Uint8Array(je);for(let C=0;C<U;C++)Te(I,c[wa(C+1)]),Te(E,a(Wr(I,k))),k=k.subarray(je);if(k.length){Te(I,c.x);let C=new Uint8Array(je);C.set(k,0),C[k.length]=128,Te(C,I),Te(E,a(C))}return E}(g));return K.set(P,B),K}return function(){let h=a($r),y=l.double(h);c=[],c[0]=l.double(y),c.x=h,c.$=y}(),{encrypt:function(h,y,p){return f(this,null,function*(){return u(a,h,y,p)})},decrypt:function(h,y,p){return f(this,null,function*(){if(h.length<kn)throw Error("Invalid OCB ciphertext");let g=h.subarray(-16);h=h.subarray(0,-16);let d=u(s,h,y,p);if(l.equalsUint8Array(g,d.subarray(-16)))return d.subarray(0,-16);throw Error("Authentication tag mismatch")})}}})}Kr.getNonce=function(i,e){let t=i.slice();for(let r=0;r<e.length;r++)t[7+r]^=e[r];return t},Kr.blockLength=je,Kr.ivLength=15,Kr.tagLength=kn;var Xi=l.getWebCrypto(),ba=l.getNodeCrypto(),ka=l.getNodeBuffer(),ei=16,Yi="AES-GCM";function ar(i,e){return f(this,null,function*(){if(i!==o.symmetric.aes128&&i!==o.symmetric.aes192&&i!==o.symmetric.aes256)throw Error("GCM mode supports only AES cipher");if(l.getNodeCrypto())return{encrypt:function(a,s){return f(this,arguments,function*(t,r,n=new Uint8Array){let c=new ba.createCipheriv("aes-"+8*e.length+"-gcm",e,r);c.setAAD(n);let u=ka.concat([c.update(t),c.final(),c.getAuthTag()]);return new Uint8Array(u)})},decrypt:function(a,s){return f(this,arguments,function*(t,r,n=new Uint8Array){let c=new ba.createDecipheriv("aes-"+8*e.length+"-gcm",e,r);c.setAAD(n),c.setAuthTag(t.slice(t.length-ei,t.length));let u=ka.concat([c.update(t.slice(0,t.length-ei)),c.final()]);return new Uint8Array(u)})}};if(l.getWebCrypto())try{let t=yield Xi.importKey("raw",e,{name:Yi},!1,["encrypt","decrypt"]),r=navigator.userAgent.match(/Version\/13\.\d(\.\d)* Safari/)||navigator.userAgent.match(/Version\/(13|14)\.\d(\.\d)* Mobile\/\S* Safari/);return{encrypt:function(c,u){return f(this,arguments,function*(n,a,s=new Uint8Array){if(r&&!n.length)return qr(e,a,s).encrypt(n);let h=yield Xi.encrypt({name:Yi,iv:a,additionalData:s,tagLength:128},t,n);return new Uint8Array(h)})},decrypt:function(c,u){return f(this,arguments,function*(n,a,s=new Uint8Array){if(r&&n.length===ei)return qr(e,a,s).decrypt(n);try{let h=yield Xi.decrypt({name:Yi,iv:a,additionalData:s,tagLength:128},t,n);return new Uint8Array(h)}catch(h){if(h.name==="OperationError")throw Error("Authentication tag mismatch")}})}}}catch(t){if(t.name!=="NotSupportedError"&&(e.length!==24||t.name!=="OperationError"))throw t;l.printDebugError("Browser did not support operation: "+t.message)}return{encrypt:function(t,r,n){return f(this,null,function*(){return qr(e,r,n).encrypt(t)})},decrypt:function(t,r,n){return f(this,null,function*(){return qr(e,r,n).decrypt(t)})}}})}ar.getNonce=function(i,e){let t=i.slice();for(let r=0;r<e.length;r++)t[4+r]^=e[r];return t},ar.blockLength=16,ar.ivLength=12,ar.tagLength=ei;var ks={cfb:wo,gcm:ar,experimentalGCM:ar,eax:Ar,ocb:Kr},Ne=BigInt(0),or=BigInt(1);function F(i){let e="0123456789ABCDEF",t="";return i.forEach(r=>{t+=e[r>>4]+e[15&r]}),BigInt("0x0"+t)}function W(i,e){let t=i%e;return t<Ne?t+e:t}function ve(i,e,t){if(t===Ne)throw Error("Modulo cannot be zero");if(t===or)return BigInt(0);if(e<Ne)throw Error("Unsopported negative exponent");let r=e,n=i;n%=t;let a=BigInt(1);for(;r>Ne;){let s=r&or;r>>=or,a=s?a*n%t:a,n=n*n%t}return a}function va(i){return i>=Ne?i:-i}function cr(i,e){let{gcd:t,x:r}=function(n,a){let s=BigInt(0),c=BigInt(1),u=BigInt(1),h=BigInt(0),y=va(n),p=va(a),g=n<Ne,d=a<Ne;for(;p!==Ne;){let w=y/p,m=s;s=u-w*s,u=m,m=c,c=h-w*c,h=m,m=p,p=y%p,y=m}return{x:g?-u:u,y:d?-h:h,gcd:y}}(i,e);if(t!==or)throw Error("Inverse does not exist");return W(r+e,e)}function vn(i){let e=Number(i);if(e>Number.MAX_SAFE_INTEGER)throw Error("Number can only safely store up to 53 bits");return e}function Do(i,e){return(i>>BigInt(e)&or)===Ne?0:1}function hr(i){let e=i<Ne?BigInt(-1):Ne,t=1,r=i;for(;(r>>=or)!==e;)t++;return t}function Le(i){let e=i<Ne?BigInt(-1):Ne,t=BigInt(8),r=1,n=i;for(;(n>>=t)!==e;)r++;return r}function pe(i,e="be",t){let r=i.toString(16);r.length%2==1&&(r="0"+r);let n=r.length/2,a=new Uint8Array(t||n),s=t?t-n:0,c=0;for(;c<n;)a[c+s]=parseInt(r.slice(2*c,2*c+2),16),c++;return e!=="be"&&a.reverse(),a}var Co=l.getNodeCrypto();function Et(i){let e=typeof crypto<"u"?crypto:Co?.webcrypto;if(e?.getRandomValues){let t=new Uint8Array(i);return e.getRandomValues(t)}throw Error("No secure random number generator available.")}function St(i,e){if(e<i)throw Error("Illegal parameter value: max <= min");let t=e-i;return W(F(Et(Le(t)+8)),t)+i}var Io=Object.freeze({__proto__:null,getRandomBigInteger:St,getRandomBytes:Et}),nt=BigInt(1);function Aa(i,e,t){let r=BigInt(30),n=nt<<BigInt(i-1),a=[1,6,5,4,3,2,1,4,3,2,1,2,1,4,3,2,1,2,1,4,3,2,1,6,5,4,3,2,1,2],s=St(n,n<<nt),c=vn(W(s,r));do s+=BigInt(a[c]),c=(c+a[c])%a.length,hr(s)>i&&(s=W(s,n<<nt),s+=n,c=vn(W(s,r)));while(!vs(s,e,t));return s}function vs(i,e,t){return(!e||function(r,n){let a=r,s=n;for(;s!==Ne;){let c=s;s=a%s,a=c}return a}(i-nt,e)===nt)&&!!function(r){let n=BigInt(0);return xo.every(a=>W(r,a)!==n)}(i)&&!!function(r,n=BigInt(2)){return ve(n,r-nt,r)===nt}(i)&&!!function(r,n){let a=hr(r);n||(n=Math.max(1,a/48|0));let s=r-nt,c=0;for(;!Do(s,c);)c++;let u=r>>BigInt(c);for(;n>0;n--){let h,y=ve(St(BigInt(2),s),u,r);if(y!==nt&&y!==s){for(h=1;h<c;h++){if(y=W(y*y,r),y===nt)return!1;if(y===s)break}if(h===c)return!1}}return!0}(i,t)}var xo=[7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997,1009,1013,1019,1021,1031,1033,1039,1049,1051,1061,1063,1069,1087,1091,1093,1097,1103,1109,1117,1123,1129,1151,1153,1163,1171,1181,1187,1193,1201,1213,1217,1223,1229,1231,1237,1249,1259,1277,1279,1283,1289,1291,1297,1301,1303,1307,1319,1321,1327,1361,1367,1373,1381,1399,1409,1423,1427,1429,1433,1439,1447,1451,1453,1459,1471,1481,1483,1487,1489,1493,1499,1511,1523,1531,1543,1549,1553,1559,1567,1571,1579,1583,1597,1601,1607,1609,1613,1619,1621,1627,1637,1657,1663,1667,1669,1693,1697,1699,1709,1721,1723,1733,1741,1747,1753,1759,1777,1783,1787,1789,1801,1811,1823,1831,1847,1861,1867,1871,1873,1877,1879,1889,1901,1907,1913,1931,1933,1949,1951,1973,1979,1987,1993,1997,1999,2003,2011,2017,2027,2029,2039,2053,2063,2069,2081,2083,2087,2089,2099,2111,2113,2129,2131,2137,2141,2143,2153,2161,2179,2203,2207,2213,2221,2237,2239,2243,2251,2267,2269,2273,2281,2287,2293,2297,2309,2311,2333,2339,2341,2347,2351,2357,2371,2377,2381,2383,2389,2393,2399,2411,2417,2423,2437,2441,2447,2459,2467,2473,2477,2503,2521,2531,2539,2543,2549,2551,2557,2579,2591,2593,2609,2617,2621,2633,2647,2657,2659,2663,2671,2677,2683,2687,2689,2693,2699,2707,2711,2713,2719,2729,2731,2741,2749,2753,2767,2777,2789,2791,2797,2801,2803,2819,2833,2837,2843,2851,2857,2861,2879,2887,2897,2903,2909,2917,2927,2939,2953,2957,2963,2969,2971,2999,3001,3011,3019,3023,3037,3041,3049,3061,3067,3079,3083,3089,3109,3119,3121,3137,3163,3167,3169,3181,3187,3191,3203,3209,3217,3221,3229,3251,3253,3257,3259,3271,3299,3301,3307,3313,3319,3323,3329,3331,3343,3347,3359,3361,3371,3373,3389,3391,3407,3413,3433,3449,3457,3461,3463,3467,3469,3491,3499,3511,3517,3527,3529,3533,3539,3541,3547,3557,3559,3571,3581,3583,3593,3607,3613,3617,3623,3631,3637,3643,3659,3671,3673,3677,3691,3697,3701,3709,3719,3727,3733,3739,3761,3767,3769,3779,3793,3797,3803,3821,3823,3833,3847,3851,3853,3863,3877,3881,3889,3907,3911,3917,3919,3923,3929,3931,3943,3947,3967,3989,4001,4003,4007,4013,4019,4021,4027,4049,4051,4057,4073,4079,4091,4093,4099,4111,4127,4129,4133,4139,4153,4157,4159,4177,4201,4211,4217,4219,4229,4231,4241,4243,4253,4259,4261,4271,4273,4283,4289,4297,4327,4337,4339,4349,4357,4363,4373,4391,4397,4409,4421,4423,4441,4447,4451,4457,4463,4481,4483,4493,4507,4513,4517,4519,4523,4547,4549,4561,4567,4583,4591,4597,4603,4621,4637,4639,4643,4649,4651,4657,4663,4673,4679,4691,4703,4721,4723,4729,4733,4751,4759,4783,4787,4789,4793,4799,4801,4813,4817,4831,4861,4871,4877,4889,4903,4909,4919,4931,4933,4937,4943,4951,4957,4967,4969,4973,4987,4993,4999].map(i=>BigInt(i)),at=[];function Xn(i,e){let t=i.length;if(t>e-11)throw Error("Message too long");let r=function(a){let s=new Uint8Array(a),c=0;for(;c<a;){let u=Et(a-c);for(let h=0;h<u.length;h++)u[h]!==0&&(s[c++]=u[h])}return s}(e-t-3),n=new Uint8Array(e);return n[1]=2,n.set(r,2),n.set(i,e-t),n}function Yn(i,e){let t=2,r=1;for(let c=t;c<i.length;c++)r&=i[c]!==0,t+=r;let n=t-2,a=i.subarray(t+1),s=i[0]===0&i[1]===2&n>=8&!r;if(e)return l.selectUint8Array(s,a,e);if(s)return a;throw Error("Decryption error")}function An(i,e,t){let r;if(e.length!==qe.getHashByteLength(i))throw Error("Invalid hash length");let n=new Uint8Array(at[i].length);for(r=0;r<at[i].length;r++)n[r]=at[i][r];let a=n.length+e.length;if(t<a+11)throw Error("Intended encoded message length too short");let s=new Uint8Array(t-a-3).fill(255),c=new Uint8Array(t);return c[1]=1,c.set(s,2),c.set(n,t-a),c.set(e,t-e.length),c}at[1]=[48,32,48,12,6,8,42,134,72,134,247,13,2,5,5,0,4,16],at[2]=[48,33,48,9,6,5,43,14,3,2,26,5,0,4,20],at[3]=[48,33,48,9,6,5,43,36,3,2,1,5,0,4,20],at[8]=[48,49,48,13,6,9,96,134,72,1,101,3,4,2,1,5,0,4,32],at[9]=[48,65,48,13,6,9,96,134,72,1,101,3,4,2,2,5,0,4,48],at[10]=[48,81,48,13,6,9,96,134,72,1,101,3,4,2,3,5,0,4,64],at[11]=[48,45,48,13,6,9,96,134,72,1,101,3,4,2,4,5,0,4,28];var Bo=Object.freeze({__proto__:null,emeDecode:Yn,emeEncode:Xn,emsaEncode:An}),er=l.getWebCrypto(),Gt=l.getNodeCrypto(),xt=BigInt(1);function Zi(i,e,t,r,n,a){return f(this,null,function*(){let s=F(r),c=F(n),u=F(t),h=W(u,c-xt),y=W(u,s-xt);return y=pe(y),h=pe(h),{kty:"RSA",n:Be(i),e:Be(e),d:Be(t),p:Be(n),q:Be(r),dp:Be(h),dq:Be(y),qi:Be(a),ext:!0}})}function Ji(i,e){return{kty:"RSA",n:Be(i),e:Be(e),ext:!0}}function Ka(i,e){return{n:et(i.n),e:pe(e),d:et(i.d),p:et(i.q),q:et(i.p),u:et(i.qi)}}var To=Object.freeze({__proto__:null,decrypt:function(i,e,t,r,n,a,s,c){return f(this,null,function*(){if(l.getNodeCrypto()&&!c)try{return yield function(u,h,y,p,g,d,w){return f(this,null,function*(){let m=yield Zi(h,y,p,g,d,w),b={key:m,format:"jwk",type:"pkcs1",padding:Gt.constants.RSA_PKCS1_PADDING};try{return new Uint8Array(Gt.privateDecrypt(b,u))}catch{throw Error("Decryption error")}})}(i,e,t,r,n,a,s)}catch(u){l.printDebugError(u)}return function(u,h,y,p,g,d,w,m){return f(this,null,function*(){if(u=F(u),h=F(h),y=F(y),p=F(p),g=F(g),d=F(d),w=F(w),u>=h)throw Error("Data too large.");let b=W(p,d-xt),v=W(p,g-xt),A=St(BigInt(2),h),S=ve(cr(A,h),y,h);u=W(u*S,h);let K=ve(u,v,g),D=ve(u,b,d),P=W(w*(D-K),d)*g+K;return P=W(P*A,h),Yn(pe(P,"be",Le(h)),m)})}(i,e,t,r,n,a,s,c)})},encrypt:function(i,e,t){return f(this,null,function*(){return l.getNodeCrypto()?function(r,n,a){return f(this,null,function*(){let s=Ji(n,a),c={key:s,format:"jwk",type:"pkcs1",padding:Gt.constants.RSA_PKCS1_PADDING};return new Uint8Array(Gt.publicEncrypt(c,r))})}(i,e,t):function(r,n,a){return f(this,null,function*(){if(n=F(n),r=F(Xn(r,Le(n))),a=F(a),r>=n)throw Error("Message size cannot exceed modulus size");return pe(ve(r,a,n),"be",Le(n))})}(i,e,t)})},generate:function(i,e){return f(this,null,function*(){if(e=BigInt(e),l.getWebCrypto()){let s={name:"RSASSA-PKCS1-v1_5",modulusLength:i,publicExponent:pe(e),hash:{name:"SHA-1"}},c=yield er.generateKey(s,!0,["sign","verify"]);return Ka(yield er.exportKey("jwk",c.privateKey),e)}if(l.getNodeCrypto()){let s={modulusLength:i,publicExponent:vn(e),publicKeyEncoding:{type:"pkcs1",format:"jwk"},privateKeyEncoding:{type:"pkcs1",format:"jwk"}},c=yield new Promise((u,h)=>{Gt.generateKeyPair("rsa",s,(y,p,g)=>{y?h(y):u(g)})});return Ka(c,e)}let t,r,n;do r=Aa(i-(i>>1),e,40),t=Aa(i>>1,e,40),n=t*r;while(hr(n)!==i);let a=(t-xt)*(r-xt);return r<t&&([t,r]=[r,t]),{n:pe(n),e:pe(e),d:pe(cr(e,a)),p:pe(t),q:pe(r),u:pe(cr(t,r))}})},sign:function(i,e,t,r,n,a,s,c,u){return f(this,null,function*(){if(qe.getHashByteLength(i)>=t.length)throw Error("Digest size cannot exceed key modulus size");if(e&&!l.isStream(e)){if(l.getWebCrypto())try{return yield function(h,y,p,g,d,w,m,b){return f(this,null,function*(){let v=yield Zi(p,g,d,w,m,b),A={name:"RSASSA-PKCS1-v1_5",hash:{name:h}},S=yield er.importKey("jwk",v,A,!1,["sign"]);return new Uint8Array(yield er.sign("RSASSA-PKCS1-v1_5",S,y))})}(o.read(o.webHash,i),e,t,r,n,a,s,c)}catch(h){l.printDebugError(h)}else if(l.getNodeCrypto())return function(h,y,p,g,d,w,m,b){return f(this,null,function*(){let v=Gt.createSign(o.read(o.hash,h));v.write(y),v.end();let A=yield Zi(p,g,d,w,m,b);return new Uint8Array(v.sign({key:A,format:"jwk",type:"pkcs1"}))})}(i,e,t,r,n,a,s,c)}return function(h,y,p,g){return f(this,null,function*(){y=F(y);let d=F(An(h,g,Le(y)));return p=F(p),pe(ve(d,p,y),"be",Le(y))})}(i,t,n,u)})},validateParams:function(i,e,t,r,n,a){return f(this,null,function*(){if(i=F(i),(r=F(r))*(n=F(n))!==i)return!1;let s=BigInt(2);if(W(r*(a=F(a)),n)!==BigInt(1))return!1;e=F(e),t=F(t);let c=St(s,s<<BigInt(Math.floor(hr(i)/3))),u=c*t*e;return!(W(u,r-xt)!==c||W(u,n-xt)!==c)})},verify:function(i,e,t,r,n,a){return f(this,null,function*(){if(e&&!l.isStream(e)){if(l.getWebCrypto())try{return yield function(s,c,u,h,y){return f(this,null,function*(){let p=Ji(h,y),g=yield er.importKey("jwk",p,{name:"RSASSA-PKCS1-v1_5",hash:{name:s}},!1,["verify"]);return er.verify("RSASSA-PKCS1-v1_5",g,u,c)})}(o.read(o.webHash,i),e,t,r,n)}catch(s){l.printDebugError(s)}else if(l.getNodeCrypto())return function(s,c,u,h,y){return f(this,null,function*(){let p=Ji(h,y),g={key:p,format:"jwk",type:"pkcs1"},d=Gt.createVerify(o.read(o.hash,s));d.write(c),d.end();try{return d.verify(g,u)}catch{return!1}})}(i,e,t,r,n)}return function(s,c,u,h,y){return f(this,null,function*(){if(u=F(u),c=F(c),h=F(h),c>=u)throw Error("Signature size cannot exceed modulus size");let p=pe(ve(c,h,u),"be",Le(u)),g=An(s,y,Le(u));return l.equalsUint8Array(p,g)})}(i,t,r,n,a)})}}),Ct=BigInt(1),Mo=Object.freeze({__proto__:null,decrypt:function(i,e,t,r,n){return f(this,null,function*(){return i=F(i),e=F(e),t=F(t),Yn(pe(W(cr(ve(i,r=F(r),t),t)*e,t),"be",Le(t)),n)})},encrypt:function(i,e,t,r){return f(this,null,function*(){e=F(e),t=F(t),r=F(r);let n=F(Xn(i,Le(e))),a=St(Ct,e-Ct);return{c1:pe(ve(t,a,e)),c2:pe(W(ve(r,a,e)*n,e))}})},validateParams:function(i,e,t,r){return f(this,null,function*(){if(i=F(i),e=F(e),t=F(t),e<=Ct||e>=i)return!1;let n=BigInt(hr(i));if(n<BigInt(1023)||ve(e,i-Ct,i)!==Ct)return!1;let a=e,s=BigInt(1),c=BigInt(2),u=c<<BigInt(17);for(;s<u;){if(a=W(a*e,i),a===Ct)return!1;s++}r=F(r);let h=St(c<<n-Ct,c<<n);return t===ve(e,(i-Ct)*h+r,i)})}}),en=typeof We=="object"&&"crypto"in We?We.crypto:void 0,he={},L=function(i){var e,t=new Float64Array(16);if(i)for(e=0;e<i.length;e++)t[e]=i[e];return t},Kn=function(){throw Error("no PRNG")},As=new Uint8Array(32);As[0]=9;var En=L(),yi=L([1]),Lo=L([56129,1]),Fo=L([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),Ro=L([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),Ea=L([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),Sa=L([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),zo=L([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function Pa(i,e,t,r){i[e]=t>>24&255,i[e+1]=t>>16&255,i[e+2]=t>>8&255,i[e+3]=255&t,i[e+4]=r>>24&255,i[e+5]=r>>16&255,i[e+6]=r>>8&255,i[e+7]=255&r}function Ks(i,e,t,r){return function(n,a,s,c,u){var h,y=0;for(h=0;h<u;h++)y|=n[a+h]^s[c+h];return(1&y-1>>>8)-1}(i,e,t,r,32)}function Lt(i,e){var t;for(t=0;t<16;t++)i[t]=0|e[t]}function tn(i){var e,t,r=1;for(e=0;e<16;e++)t=i[e]+r+65535,r=Math.floor(t/65536),i[e]=t-65536*r;i[0]+=r-1+37*(r-1)}function sr(i,e,t){for(var r,n=~(t-1),a=0;a<16;a++)r=n&(i[a]^e[a]),i[a]^=r,e[a]^=r}function Ir(i,e){var t,r,n,a=L(),s=L();for(t=0;t<16;t++)s[t]=e[t];for(tn(s),tn(s),tn(s),r=0;r<2;r++){for(a[0]=s[0]-65517,t=1;t<15;t++)a[t]=s[t]-65535-(a[t-1]>>16&1),a[t-1]&=65535;a[15]=s[15]-32767-(a[14]>>16&1),n=a[15]>>16&1,a[14]&=65535,sr(s,a,1-n)}for(t=0;t<16;t++)i[2*t]=255&s[t],i[2*t+1]=s[t]>>8}function Ua(i,e){var t=new Uint8Array(32),r=new Uint8Array(32);return Ir(t,i),Ir(r,e),Ks(t,0,r,0)}function Es(i){var e=new Uint8Array(32);return Ir(e,i),1&e[0]}function Ss(i,e){var t;for(t=0;t<16;t++)i[t]=e[2*t]+(e[2*t+1]<<8);i[15]&=32767}function ct(i,e,t){for(var r=0;r<16;r++)i[r]=e[r]+t[r]}function ht(i,e,t){for(var r=0;r<16;r++)i[r]=e[r]-t[r]}function Q(i,e,t){var r,n,a=0,s=0,c=0,u=0,h=0,y=0,p=0,g=0,d=0,w=0,m=0,b=0,v=0,A=0,S=0,K=0,D=0,B=0,P=0,k=0,U=0,I=0,E=0,C=0,x=0,H=0,z=0,j=0,ce=0,ye=0,de=0,N=t[0],Y=t[1],O=t[2],q=t[3],R=t[4],X=t[5],G=t[6],J=t[7],V=t[8],ee=t[9],$=t[10],te=t[11],ue=t[12],fe=t[13],me=t[14],we=t[15];a+=(r=e[0])*N,s+=r*Y,c+=r*O,u+=r*q,h+=r*R,y+=r*X,p+=r*G,g+=r*J,d+=r*V,w+=r*ee,m+=r*$,b+=r*te,v+=r*ue,A+=r*fe,S+=r*me,K+=r*we,s+=(r=e[1])*N,c+=r*Y,u+=r*O,h+=r*q,y+=r*R,p+=r*X,g+=r*G,d+=r*J,w+=r*V,m+=r*ee,b+=r*$,v+=r*te,A+=r*ue,S+=r*fe,K+=r*me,D+=r*we,c+=(r=e[2])*N,u+=r*Y,h+=r*O,y+=r*q,p+=r*R,g+=r*X,d+=r*G,w+=r*J,m+=r*V,b+=r*ee,v+=r*$,A+=r*te,S+=r*ue,K+=r*fe,D+=r*me,B+=r*we,u+=(r=e[3])*N,h+=r*Y,y+=r*O,p+=r*q,g+=r*R,d+=r*X,w+=r*G,m+=r*J,b+=r*V,v+=r*ee,A+=r*$,S+=r*te,K+=r*ue,D+=r*fe,B+=r*me,P+=r*we,h+=(r=e[4])*N,y+=r*Y,p+=r*O,g+=r*q,d+=r*R,w+=r*X,m+=r*G,b+=r*J,v+=r*V,A+=r*ee,S+=r*$,K+=r*te,D+=r*ue,B+=r*fe,P+=r*me,k+=r*we,y+=(r=e[5])*N,p+=r*Y,g+=r*O,d+=r*q,w+=r*R,m+=r*X,b+=r*G,v+=r*J,A+=r*V,S+=r*ee,K+=r*$,D+=r*te,B+=r*ue,P+=r*fe,k+=r*me,U+=r*we,p+=(r=e[6])*N,g+=r*Y,d+=r*O,w+=r*q,m+=r*R,b+=r*X,v+=r*G,A+=r*J,S+=r*V,K+=r*ee,D+=r*$,B+=r*te,P+=r*ue,k+=r*fe,U+=r*me,I+=r*we,g+=(r=e[7])*N,d+=r*Y,w+=r*O,m+=r*q,b+=r*R,v+=r*X,A+=r*G,S+=r*J,K+=r*V,D+=r*ee,B+=r*$,P+=r*te,k+=r*ue,U+=r*fe,I+=r*me,E+=r*we,d+=(r=e[8])*N,w+=r*Y,m+=r*O,b+=r*q,v+=r*R,A+=r*X,S+=r*G,K+=r*J,D+=r*V,B+=r*ee,P+=r*$,k+=r*te,U+=r*ue,I+=r*fe,E+=r*me,C+=r*we,w+=(r=e[9])*N,m+=r*Y,b+=r*O,v+=r*q,A+=r*R,S+=r*X,K+=r*G,D+=r*J,B+=r*V,P+=r*ee,k+=r*$,U+=r*te,I+=r*ue,E+=r*fe,C+=r*me,x+=r*we,m+=(r=e[10])*N,b+=r*Y,v+=r*O,A+=r*q,S+=r*R,K+=r*X,D+=r*G,B+=r*J,P+=r*V,k+=r*ee,U+=r*$,I+=r*te,E+=r*ue,C+=r*fe,x+=r*me,H+=r*we,b+=(r=e[11])*N,v+=r*Y,A+=r*O,S+=r*q,K+=r*R,D+=r*X,B+=r*G,P+=r*J,k+=r*V,U+=r*ee,I+=r*$,E+=r*te,C+=r*ue,x+=r*fe,H+=r*me,z+=r*we,v+=(r=e[12])*N,A+=r*Y,S+=r*O,K+=r*q,D+=r*R,B+=r*X,P+=r*G,k+=r*J,U+=r*V,I+=r*ee,E+=r*$,C+=r*te,x+=r*ue,H+=r*fe,z+=r*me,j+=r*we,A+=(r=e[13])*N,S+=r*Y,K+=r*O,D+=r*q,B+=r*R,P+=r*X,k+=r*G,U+=r*J,I+=r*V,E+=r*ee,C+=r*$,x+=r*te,H+=r*ue,z+=r*fe,j+=r*me,ce+=r*we,S+=(r=e[14])*N,K+=r*Y,D+=r*O,B+=r*q,P+=r*R,k+=r*X,U+=r*G,I+=r*J,E+=r*V,C+=r*ee,x+=r*$,H+=r*te,z+=r*ue,j+=r*fe,ce+=r*me,ye+=r*we,K+=(r=e[15])*N,s+=38*(B+=r*O),c+=38*(P+=r*q),u+=38*(k+=r*R),h+=38*(U+=r*X),y+=38*(I+=r*G),p+=38*(E+=r*J),g+=38*(C+=r*V),d+=38*(x+=r*ee),w+=38*(H+=r*$),m+=38*(z+=r*te),b+=38*(j+=r*ue),v+=38*(ce+=r*fe),A+=38*(ye+=r*me),S+=38*(de+=r*we),a=(r=(a+=38*(D+=r*Y))+(n=1)+65535)-65536*(n=Math.floor(r/65536)),s=(r=s+n+65535)-65536*(n=Math.floor(r/65536)),c=(r=c+n+65535)-65536*(n=Math.floor(r/65536)),u=(r=u+n+65535)-65536*(n=Math.floor(r/65536)),h=(r=h+n+65535)-65536*(n=Math.floor(r/65536)),y=(r=y+n+65535)-65536*(n=Math.floor(r/65536)),p=(r=p+n+65535)-65536*(n=Math.floor(r/65536)),g=(r=g+n+65535)-65536*(n=Math.floor(r/65536)),d=(r=d+n+65535)-65536*(n=Math.floor(r/65536)),w=(r=w+n+65535)-65536*(n=Math.floor(r/65536)),m=(r=m+n+65535)-65536*(n=Math.floor(r/65536)),b=(r=b+n+65535)-65536*(n=Math.floor(r/65536)),v=(r=v+n+65535)-65536*(n=Math.floor(r/65536)),A=(r=A+n+65535)-65536*(n=Math.floor(r/65536)),S=(r=S+n+65535)-65536*(n=Math.floor(r/65536)),K=(r=K+n+65535)-65536*(n=Math.floor(r/65536)),a=(r=(a+=n-1+37*(n-1))+(n=1)+65535)-65536*(n=Math.floor(r/65536)),s=(r=s+n+65535)-65536*(n=Math.floor(r/65536)),c=(r=c+n+65535)-65536*(n=Math.floor(r/65536)),u=(r=u+n+65535)-65536*(n=Math.floor(r/65536)),h=(r=h+n+65535)-65536*(n=Math.floor(r/65536)),y=(r=y+n+65535)-65536*(n=Math.floor(r/65536)),p=(r=p+n+65535)-65536*(n=Math.floor(r/65536)),g=(r=g+n+65535)-65536*(n=Math.floor(r/65536)),d=(r=d+n+65535)-65536*(n=Math.floor(r/65536)),w=(r=w+n+65535)-65536*(n=Math.floor(r/65536)),m=(r=m+n+65535)-65536*(n=Math.floor(r/65536)),b=(r=b+n+65535)-65536*(n=Math.floor(r/65536)),v=(r=v+n+65535)-65536*(n=Math.floor(r/65536)),A=(r=A+n+65535)-65536*(n=Math.floor(r/65536)),S=(r=S+n+65535)-65536*(n=Math.floor(r/65536)),K=(r=K+n+65535)-65536*(n=Math.floor(r/65536)),a+=n-1+37*(n-1),i[0]=a,i[1]=s,i[2]=c,i[3]=u,i[4]=h,i[5]=y,i[6]=p,i[7]=g,i[8]=d,i[9]=w,i[10]=m,i[11]=b,i[12]=v,i[13]=A,i[14]=S,i[15]=K}function Je(i,e){Q(i,e,e)}function Ps(i,e){var t,r=L();for(t=0;t<16;t++)r[t]=e[t];for(t=253;t>=0;t--)Je(r,r),t!==2&&t!==4&&Q(r,r,e);for(t=0;t<16;t++)i[t]=r[t]}function Us(i,e,t){var r,n,a=new Uint8Array(32),s=new Float64Array(80),c=L(),u=L(),h=L(),y=L(),p=L(),g=L();for(n=0;n<31;n++)a[n]=e[n];for(a[31]=127&e[31]|64,a[0]&=248,Ss(s,t),n=0;n<16;n++)u[n]=s[n],y[n]=c[n]=h[n]=0;for(c[0]=y[0]=1,n=254;n>=0;--n)sr(c,u,r=a[n>>>3]>>>(7&n)&1),sr(h,y,r),ct(p,c,h),ht(c,c,h),ct(h,u,y),ht(u,u,y),Je(y,p),Je(g,c),Q(c,h,c),Q(h,u,p),ct(p,c,h),ht(c,c,h),Je(u,c),ht(h,y,g),Q(c,h,Lo),ct(c,c,y),Q(h,h,c),Q(c,y,g),Q(y,u,s),Je(u,p),sr(c,u,r),sr(h,y,r);for(n=0;n<16;n++)s[n+16]=c[n],s[n+32]=h[n],s[n+48]=u[n],s[n+64]=y[n];var d=s.subarray(32),w=s.subarray(16);return Ps(d,d),Q(w,w,d),Ir(i,w),0}function Da(i,e){return Us(i,e,As)}var Ca=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function Ia(i,e,t,r){for(var n,a,s,c,u,h,y,p,g,d,w,m,b,v,A,S,K,D,B,P,k,U,I,E,C,x,H=new Int32Array(16),z=new Int32Array(16),j=i[0],ce=i[1],ye=i[2],de=i[3],N=i[4],Y=i[5],O=i[6],q=i[7],R=e[0],X=e[1],G=e[2],J=e[3],V=e[4],ee=e[5],$=e[6],te=e[7],ue=0;r>=128;){for(B=0;B<16;B++)P=8*B+ue,H[B]=t[P+0]<<24|t[P+1]<<16|t[P+2]<<8|t[P+3],z[B]=t[P+4]<<24|t[P+5]<<16|t[P+6]<<8|t[P+7];for(B=0;B<80;B++)if(n=j,a=ce,s=ye,c=de,u=N,h=Y,y=O,g=R,d=X,w=G,m=J,b=V,v=ee,A=$,I=65535&(U=te),E=U>>>16,C=65535&(k=q),x=k>>>16,I+=65535&(U=(V>>>14|N<<18)^(V>>>18|N<<14)^(N>>>9|V<<23)),E+=U>>>16,C+=65535&(k=(N>>>14|V<<18)^(N>>>18|V<<14)^(V>>>9|N<<23)),x+=k>>>16,I+=65535&(U=V&ee^~V&$),E+=U>>>16,C+=65535&(k=N&Y^~N&O),x+=k>>>16,k=Ca[2*B],I+=65535&(U=Ca[2*B+1]),E+=U>>>16,C+=65535&k,x+=k>>>16,k=H[B%16],E+=(U=z[B%16])>>>16,C+=65535&k,x+=k>>>16,C+=(E+=(I+=65535&U)>>>16)>>>16,I=65535&(U=D=65535&I|E<<16),E=U>>>16,C=65535&(k=K=65535&C|(x+=C>>>16)<<16),x=k>>>16,I+=65535&(U=(R>>>28|j<<4)^(j>>>2|R<<30)^(j>>>7|R<<25)),E+=U>>>16,C+=65535&(k=(j>>>28|R<<4)^(R>>>2|j<<30)^(R>>>7|j<<25)),x+=k>>>16,E+=(U=R&X^R&G^X&G)>>>16,C+=65535&(k=j&ce^j&ye^ce&ye),x+=k>>>16,p=65535&(C+=(E+=(I+=65535&U)>>>16)>>>16)|(x+=C>>>16)<<16,S=65535&I|E<<16,I=65535&(U=m),E=U>>>16,C=65535&(k=c),x=k>>>16,E+=(U=D)>>>16,C+=65535&(k=K),x+=k>>>16,ce=n,ye=a,de=s,N=c=65535&(C+=(E+=(I+=65535&U)>>>16)>>>16)|(x+=C>>>16)<<16,Y=u,O=h,q=y,j=p,X=g,G=d,J=w,V=m=65535&I|E<<16,ee=b,$=v,te=A,R=S,B%16==15)for(P=0;P<16;P++)k=H[P],I=65535&(U=z[P]),E=U>>>16,C=65535&k,x=k>>>16,k=H[(P+9)%16],I+=65535&(U=z[(P+9)%16]),E+=U>>>16,C+=65535&k,x+=k>>>16,K=H[(P+1)%16],I+=65535&(U=((D=z[(P+1)%16])>>>1|K<<31)^(D>>>8|K<<24)^(D>>>7|K<<25)),E+=U>>>16,C+=65535&(k=(K>>>1|D<<31)^(K>>>8|D<<24)^K>>>7),x+=k>>>16,K=H[(P+14)%16],E+=(U=((D=z[(P+14)%16])>>>19|K<<13)^(K>>>29|D<<3)^(D>>>6|K<<26))>>>16,C+=65535&(k=(K>>>19|D<<13)^(D>>>29|K<<3)^K>>>6),x+=k>>>16,x+=(C+=(E+=(I+=65535&U)>>>16)>>>16)>>>16,H[P]=65535&C|x<<16,z[P]=65535&I|E<<16;I=65535&(U=R),E=U>>>16,C=65535&(k=j),x=k>>>16,k=i[0],E+=(U=e[0])>>>16,C+=65535&k,x+=k>>>16,x+=(C+=(E+=(I+=65535&U)>>>16)>>>16)>>>16,i[0]=j=65535&C|x<<16,e[0]=R=65535&I|E<<16,I=65535&(U=X),E=U>>>16,C=65535&(k=ce),x=k>>>16,k=i[1],E+=(U=e[1])>>>16,C+=65535&k,x+=k>>>16,x+=(C+=(E+=(I+=65535&U)>>>16)>>>16)>>>16,i[1]=ce=65535&C|x<<16,e[1]=X=65535&I|E<<16,I=65535&(U=G),E=U>>>16,C=65535&(k=ye),x=k>>>16,k=i[2],E+=(U=e[2])>>>16,C+=65535&k,x+=k>>>16,x+=(C+=(E+=(I+=65535&U)>>>16)>>>16)>>>16,i[2]=ye=65535&C|x<<16,e[2]=G=65535&I|E<<16,I=65535&(U=J),E=U>>>16,C=65535&(k=de),x=k>>>16,k=i[3],E+=(U=e[3])>>>16,C+=65535&k,x+=k>>>16,x+=(C+=(E+=(I+=65535&U)>>>16)>>>16)>>>16,i[3]=de=65535&C|x<<16,e[3]=J=65535&I|E<<16,I=65535&(U=V),E=U>>>16,C=65535&(k=N),x=k>>>16,k=i[4],E+=(U=e[4])>>>16,C+=65535&k,x+=k>>>16,x+=(C+=(E+=(I+=65535&U)>>>16)>>>16)>>>16,i[4]=N=65535&C|x<<16,e[4]=V=65535&I|E<<16,I=65535&(U=ee),E=U>>>16,C=65535&(k=Y),x=k>>>16,k=i[5],E+=(U=e[5])>>>16,C+=65535&k,x+=k>>>16,x+=(C+=(E+=(I+=65535&U)>>>16)>>>16)>>>16,i[5]=Y=65535&C|x<<16,e[5]=ee=65535&I|E<<16,I=65535&(U=$),E=U>>>16,C=65535&(k=O),x=k>>>16,k=i[6],E+=(U=e[6])>>>16,C+=65535&k,x+=k>>>16,x+=(C+=(E+=(I+=65535&U)>>>16)>>>16)>>>16,i[6]=O=65535&C|x<<16,e[6]=$=65535&I|E<<16,I=65535&(U=te),E=U>>>16,C=65535&(k=q),x=k>>>16,k=i[7],E+=(U=e[7])>>>16,C+=65535&k,x+=k>>>16,x+=(C+=(E+=(I+=65535&U)>>>16)>>>16)>>>16,i[7]=q=65535&C|x<<16,e[7]=te=65535&I|E<<16,ue+=128,r-=128}return r}function Er(i,e,t){var r,n=new Int32Array(8),a=new Int32Array(8),s=new Uint8Array(256),c=t;for(n[0]=1779033703,n[1]=3144134277,n[2]=1013904242,n[3]=2773480762,n[4]=1359893119,n[5]=2600822924,n[6]=528734635,n[7]=1541459225,a[0]=4089235720,a[1]=2227873595,a[2]=4271175723,a[3]=1595750129,a[4]=2917565137,a[5]=725511199,a[6]=4215389547,a[7]=327033209,Ia(n,a,e,t),t%=128,r=0;r<t;r++)s[r]=e[c-t+r];for(s[t]=128,s[(t=256-128*(t<112?1:0))-9]=0,Pa(s,t-8,c/536870912|0,c<<3),Ia(n,a,s,t),r=0;r<8;r++)Pa(i,8*r,n[r],a[r]);return 0}function Sn(i,e){var t=L(),r=L(),n=L(),a=L(),s=L(),c=L(),u=L(),h=L(),y=L();ht(t,i[1],i[0]),ht(y,e[1],e[0]),Q(t,t,y),ct(r,i[0],i[1]),ct(y,e[0],e[1]),Q(r,r,y),Q(n,i[3],e[3]),Q(n,n,Ro),Q(a,i[2],e[2]),ct(a,a,a),ht(s,r,t),ht(c,a,n),ct(u,a,n),ct(h,r,t),Q(i[0],s,c),Q(i[1],h,u),Q(i[2],u,c),Q(i[3],s,h)}function xa(i,e,t){var r;for(r=0;r<4;r++)sr(i[r],e[r],t)}function Pn(i,e){var t=L(),r=L(),n=L();Ps(n,e[2]),Q(t,e[0],n),Q(r,e[1],n),Ir(i,r),i[31]^=Es(t)<<7}function Ds(i,e,t){var r,n;for(Lt(i[0],En),Lt(i[1],yi),Lt(i[2],yi),Lt(i[3],En),n=255;n>=0;--n)xa(i,e,r=t[n/8|0]>>(7&n)&1),Sn(e,i),Sn(i,i),xa(i,e,r)}function Un(i,e){var t=[L(),L(),L(),L()];Lt(t[0],Ea),Lt(t[1],Sa),Lt(t[2],yi),Q(t[3],Ea,Sa),Ds(i,t,e)}function Ba(i,e,t){var r,n=new Uint8Array(64),a=[L(),L(),L(),L()];for(t||Kn(e,32),Er(n,e,32),n[0]&=248,n[31]&=127,n[31]|=64,Un(a,n),Pn(i,a),r=0;r<32;r++)e[r+32]=i[r];return 0}var rn=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function Cs(i,e){var t,r,n,a;for(r=63;r>=32;--r){for(t=0,n=r-32,a=r-12;n<a;++n)e[n]+=t-16*e[r]*rn[n-(r-32)],t=Math.floor((e[n]+128)/256),e[n]-=256*t;e[n]+=t,e[r]=0}for(t=0,n=0;n<32;n++)e[n]+=t-(e[31]>>4)*rn[n],t=e[n]>>8,e[n]&=255;for(n=0;n<32;n++)e[n]-=t*rn[n];for(r=0;r<32;r++)e[r+1]+=e[r]>>8,i[r]=255&e[r]}function nn(i){var e,t=new Float64Array(64);for(e=0;e<64;e++)t[e]=i[e];for(e=0;e<64;e++)i[e]=0;Cs(i,t)}function No(i,e){var t=L(),r=L(),n=L(),a=L(),s=L(),c=L(),u=L();return Lt(i[2],yi),Ss(i[1],e),Je(n,i[1]),Q(a,n,Fo),ht(n,n,i[2]),ct(a,i[2],a),Je(s,a),Je(c,s),Q(u,c,s),Q(t,u,n),Q(t,t,a),function(h,y){var p,g=L();for(p=0;p<16;p++)g[p]=y[p];for(p=250;p>=0;p--)Je(g,g),p!==1&&Q(g,g,y);for(p=0;p<16;p++)h[p]=g[p]}(t,t),Q(t,t,n),Q(t,t,a),Q(t,t,a),Q(i[0],t,a),Je(r,i[0]),Q(r,r,a),Ua(r,n)&&Q(i[0],i[0],zo),Je(r,i[0]),Q(r,r,a),Ua(r,n)?-1:(Es(i[0])===e[31]>>7&&ht(i[0],En,i[0]),Q(i[3],i[0],i[1]),0)}var Vt=64;function tr(){for(var i=0;i<arguments.length;i++)if(!(arguments[i]instanceof Uint8Array))throw new TypeError("unexpected type, use Uint8Array")}he.scalarMult=function(i,e){if(tr(i,e),i.length!==32)throw Error("bad n size");if(e.length!==32)throw Error("bad p size");var t=new Uint8Array(32);return Us(t,i,e),t},he.box={},he.box.keyPair=function(){var i=new Uint8Array(32),e=new Uint8Array(32);return function(t,r){Kn(r,32),Da(t,r)}(i,e),{publicKey:i,secretKey:e}},he.box.keyPair.fromSecretKey=function(i){if(tr(i),i.length!==32)throw Error("bad secret key size");var e=new Uint8Array(32);return Da(e,i),{publicKey:e,secretKey:new Uint8Array(i)}},he.sign=function(i,e){if(tr(i,e),e.length!==64)throw Error("bad secret key size");var t=new Uint8Array(Vt+i.length);return function(r,n,a,s){var c,u,h=new Uint8Array(64),y=new Uint8Array(64),p=new Uint8Array(64),g=new Float64Array(64),d=[L(),L(),L(),L()];Er(h,s,32),h[0]&=248,h[31]&=127,h[31]|=64;var w=a+64;for(c=0;c<a;c++)r[64+c]=n[c];for(c=0;c<32;c++)r[32+c]=h[32+c];for(Er(p,r.subarray(32),a+32),nn(p),Un(d,p),Pn(r,d),c=32;c<64;c++)r[c]=s[c];for(Er(y,r,a+64),nn(y),c=0;c<64;c++)g[c]=0;for(c=0;c<32;c++)g[c]=p[c];for(c=0;c<32;c++)for(u=0;u<32;u++)g[c+u]+=y[c]*h[u];Cs(r.subarray(32),g)}(t,i,i.length,e),t},he.sign.detached=function(i,e){for(var t=he.sign(i,e),r=new Uint8Array(Vt),n=0;n<r.length;n++)r[n]=t[n];return r},he.sign.detached.verify=function(i,e,t){if(tr(i,e,t),e.length!==Vt)throw Error("bad signature size");if(t.length!==32)throw Error("bad public key size");var r,n=new Uint8Array(Vt+i.length),a=new Uint8Array(Vt+i.length);for(r=0;r<Vt;r++)n[r]=e[r];for(r=0;r<i.length;r++)n[r+Vt]=i[r];return function(s,c,u,h){var y,p=new Uint8Array(32),g=new Uint8Array(64),d=[L(),L(),L(),L()],w=[L(),L(),L(),L()];if(u<64||No(w,h))return-1;for(y=0;y<u;y++)s[y]=c[y];for(y=0;y<32;y++)s[y+32]=h[y];if(Er(g,s,u),nn(g),Ds(d,w,g),Un(w,c.subarray(32)),Sn(d,w),Pn(p,d),u-=64,Ks(c,0,p,0)){for(y=0;y<u;y++)s[y]=0;return-1}for(y=0;y<u;y++)s[y]=c[y+64];return u}(a,n,n.length,t)>=0},he.sign.keyPair=function(){var i=new Uint8Array(32),e=new Uint8Array(64);return Ba(i,e),{publicKey:i,secretKey:e}},he.sign.keyPair.fromSecretKey=function(i){if(tr(i),i.length!==64)throw Error("bad secret key size");for(var e=new Uint8Array(32),t=0;t<e.length;t++)e[t]=i[32+t];return{publicKey:e,secretKey:new Uint8Array(i)}},he.sign.keyPair.fromSeed=function(i){if(tr(i),i.length!==32)throw Error("bad seed size");for(var e=new Uint8Array(32),t=new Uint8Array(64),r=0;r<32;r++)t[r]=i[r];return Ba(e,t,!0),{publicKey:e,secretKey:t}},he.setPRNG=function(i){Kn=i},function(){en&&en.getRandomValues&&he.setPRNG(function(i,e){var t,r=new Uint8Array(e);for(t=0;t<e;t+=65536)en.getRandomValues(r.subarray(t,t+Math.min(e-t,65536)));for(t=0;t<e;t++)i[t]=r[t];(function(n){for(var a=0;a<n.length;a++)n[a]=0})(r)})}();var Ho={"2a8648ce3d030107":o.curve.nistP256,"2b81040022":o.curve.nistP384,"2b81040023":o.curve.nistP521,"2b8104000a":o.curve.secp256k1,"2b06010401da470f01":o.curve.ed25519Legacy,"2b060104019755010501":o.curve.curve25519Legacy,"2b2403030208010107":o.curve.brainpoolP256r1,"2b240303020801010b":o.curve.brainpoolP384r1,"2b240303020801010d":o.curve.brainpoolP512r1},kt=class i{constructor(e){if(e instanceof i)this.oid=e.oid;else if(l.isArray(e)||l.isUint8Array(e)){if((e=new Uint8Array(e))[0]===6){if(e[1]!==e.length-2)throw Error("Length mismatch in DER encoded oid");e=e.subarray(2)}this.oid=e}else this.oid=""}read(e){if(e.length>=1){let t=e[0];if(e.length>=1+t)return this.oid=e.subarray(1,1+t),1+this.oid.length}throw Error("Invalid oid")}write(){return l.concatUint8Array([new Uint8Array([this.oid.length]),this.oid])}toHex(){return l.uint8ArrayToHex(this.oid)}getName(){let e=Ho[this.toHex()];if(!e)throw Error("Unknown curve object identifier.");return e}};function Is(i){let e,t=0,r=i[0];return r<192?([t]=i,e=1):r<255?(t=(i[0]-192<<8)+i[1]+192,e=2):r===255&&(t=l.readNumber(i.subarray(1,5)),e=5),{len:t,offset:e}}function zi(i){return i<192?new Uint8Array([i]):i>191&&i<8384?new Uint8Array([192+(i-192>>8),i-192&255]):l.concatUint8Array([new Uint8Array([255]),l.writeNumber(i,4)])}function jo(i){if(i<0||i>30)throw Error("Partial Length power must be between 1 and 30");return new Uint8Array([224+i])}function li(i){return new Uint8Array([192|i])}function Ta(i,e){return l.concatUint8Array([li(i),zi(e)])}function ti(i){return[o.packet.literalData,o.packet.compressedData,o.packet.symmetricallyEncryptedData,o.packet.symEncryptedIntegrityProtectedData,o.packet.aeadEncryptedData].includes(i)}function Oo(i,e){return f(this,null,function*(){let t=Pt(i),r,n;try{let a=yield t.peekBytes(2);if(!a||a.length<2||!(128&a[0]))throw Error("Error during parsing. This message / key probably does not conform to a valid OpenPGP format.");let s=yield t.readByte(),c,u,h=-1,y=-1;y=0,64&s&&(y=1),y?h=63&s:(h=(63&s)>>2,u=3&s);let p=ti(h),g,d=null;if(p){if(l.isStream(i)==="array"){let m=new $e;r=Ge(m),d=m}else{let m=new TransformStream;r=Ge(m.writable),d=m.readable}n=e({tag:h,packet:d})}else d=[];do{if(y){let m=yield t.readByte();if(g=!1,m<192)c=m;else if(m>=192&&m<224)c=(m-192<<8)+(yield t.readByte())+192;else if(m>223&&m<255){if(c=1<<(31&m),g=!0,!p)throw new TypeError("This packet type does not support partial lengths.")}else c=(yield t.readByte())<<24|(yield t.readByte())<<16|(yield t.readByte())<<8|(yield t.readByte())}else switch(u){case 0:c=yield t.readByte();break;case 1:c=(yield t.readByte())<<8|(yield t.readByte());break;case 2:c=(yield t.readByte())<<24|(yield t.readByte())<<16|(yield t.readByte())<<8|(yield t.readByte());break;default:c=1/0}if(c>0){let m=0;for(;;){r&&(yield r.ready);let{done:b,value:v}=yield t.read();if(b){if(c===1/0)break;throw Error("Unexpected end of packet")}let A=c===1/0?v:v.subarray(0,c-m);if(r?yield r.write(A):d.push(A),m+=v.length,m>=c){t.unshift(v.subarray(c-m+v.length));break}}}}while(g);let w=yield t.peekBytes(p?1/0:2);return r?(yield r.ready,yield r.close()):(d=l.concatUint8Array(d),yield e({tag:h,packet:d})),!w||!w.length}catch(a){if(r)return yield r.abort(a),!0;throw a}finally{r&&(yield n),t.releaseLock()}})}var ne=class i extends Error{constructor(...e){super(...e),Error.captureStackTrace&&Error.captureStackTrace(this,i),this.name="UnsupportedError"}},pi=class extends ne{constructor(...e){super(...e),Error.captureStackTrace&&Error.captureStackTrace(this,ne),this.name="UnknownPacketError"}},xr=class{constructor(e,t){this.tag=e,this.rawContent=t}write(){return this.rawContent}};function xs(i){return f(this,null,function*(){switch(i){case o.publicKey.ed25519:try{let e=l.getWebCrypto(),t=yield e.generateKey("Ed25519",!0,["sign","verify"]),r=yield e.exportKey("jwk",t.privateKey),n=yield e.exportKey("jwk",t.publicKey);return{A:new Uint8Array(et(n.x)),seed:et(r.d)}}catch(e){if(e.name!=="NotSupportedError"&&e.name!=="OperationError")throw e;let t=Et(Ms(i)),{publicKey:r}=he.sign.keyPair.fromSeed(t);return{A:r,seed:t}}case o.publicKey.ed448:{let e=yield l.getNobleCurve(o.publicKey.ed448),t=e.utils.randomPrivateKey();return{A:e.getPublicKey(t),seed:t}}default:throw Error("Unsupported EdDSA algorithm")}})}function Bs(i,e,t,r,n,a){return f(this,null,function*(){if(qe.getHashByteLength(e)<qe.getHashByteLength(Zn(i)))throw Error("Hash algorithm too weak for EdDSA.");switch(i){case o.publicKey.ed25519:try{let s=l.getWebCrypto(),c=_o(i,r,n),u=yield s.importKey("jwk",c,"Ed25519",!1,["sign"]);return{RS:new Uint8Array(yield s.sign("Ed25519",u,a))}}catch(s){if(s.name!=="NotSupportedError")throw s;let c=l.concatUint8Array([n,r]);return{RS:he.sign.detached(a,c)}}case o.publicKey.ed448:return{RS:(yield l.getNobleCurve(o.publicKey.ed448)).sign(a,n)};default:throw Error("Unsupported EdDSA algorithm")}})}function Ts(s,c,u,h,y,p){return f(this,arguments,function*(i,e,{RS:t},r,n,a){if(qe.getHashByteLength(e)<qe.getHashByteLength(Zn(i)))throw Error("Hash algorithm too weak for EdDSA.");switch(i){case o.publicKey.ed25519:try{let g=l.getWebCrypto(),d=Ls(i,n),w=yield g.importKey("jwk",d,"Ed25519",!1,["verify"]);return yield g.verify("Ed25519",w,t,a)}catch(g){if(g.name!=="NotSupportedError")throw g;return he.sign.detached.verify(a,t,n)}case o.publicKey.ed448:return(yield l.getNobleCurve(o.publicKey.ed448)).verify(t,a,n);default:throw Error("Unsupported EdDSA algorithm")}})}function Ms(i){switch(i){case o.publicKey.ed25519:return 32;case o.publicKey.ed448:return 57;default:throw Error("Unsupported EdDSA algorithm")}}function Zn(i){switch(i){case o.publicKey.ed25519:return o.hash.sha256;case o.publicKey.ed448:return o.hash.sha512;default:throw Error("Unknown EdDSA algo")}}var Ls=(i,e)=>{if(i===o.publicKey.ed25519)return{kty:"OKP",crv:"Ed25519",x:Be(e),ext:!0};throw Error("Unsupported EdDSA algorithm")},_o=(i,e,t)=>{if(i===o.publicKey.ed25519){let r=Ls(i,e);return r.d=Be(t),r}throw Error("Unsupported EdDSA algorithm")},qo=Object.freeze({__proto__:null,generate:xs,getPayloadSize:Ms,getPreferredHashAlgo:Zn,sign:Bs,validateParams:function(i,e,t){return f(this,null,function*(){switch(i){case o.publicKey.ed25519:{let{publicKey:r}=he.sign.keyPair.fromSeed(t);return l.equalsUint8Array(e,r)}case o.publicKey.ed448:{let r=(yield l.getNobleCurve(o.publicKey.ed448)).getPublicKey(t);return l.equalsUint8Array(e,r)}default:return!1}})},verify:Ts}),ur=l.getWebCrypto();function gi(i,e,t){return f(this,null,function*(){let{keySize:r}=Ie(i);if(!l.isAES(i)||e.length!==r)throw Error("Unexpected algorithm or key size");try{let n=yield ur.importKey("raw",e,{name:"AES-KW"},!1,["wrapKey"]),a=yield ur.importKey("raw",t,{name:"HMAC",hash:"SHA-256"},!0,["sign"]),s=yield ur.wrapKey("raw",a,n,{name:"AES-KW"});return new Uint8Array(s)}catch(n){if(n.name!=="NotSupportedError"&&(e.length!==24||n.name!=="OperationError"))throw n;l.printDebugError("Browser did not support operation: "+n.message)}return bs(e).encrypt(t)})}function di(i,e,t){return f(this,null,function*(){let{keySize:r}=Ie(i);if(!l.isAES(i)||e.length!==r)throw Error("Unexpected algorithm or key size");let n;try{n=yield ur.importKey("raw",e,{name:"AES-KW"},!1,["unwrapKey"])}catch(a){if(a.name!=="NotSupportedError"&&(e.length!==24||a.name!=="OperationError"))throw a;return l.printDebugError("Browser did not support operation: "+a.message),bs(e).decrypt(t)}try{let a=yield ur.unwrapKey("raw",t,n,{name:"AES-KW"},{name:"HMAC",hash:"SHA-256"},!0,["sign"]);return new Uint8Array(yield ur.exportKey("raw",a))}catch(a){throw a.name==="OperationError"?Error("Key Data Integrity failed"):a}})}var Go=Object.freeze({__proto__:null,unwrap:di,wrap:gi}),Ma=l.getWebCrypto();function Ft(i,e,t,r,n){return f(this,null,function*(){let a=o.read(o.webHash,i);if(!a)throw Error("Hash algo not supported with HKDF");let s=yield Ma.importKey("raw",e,"HKDF",!1,["deriveBits"]),c=yield Ma.deriveBits({name:"HKDF",hash:a,salt:t,info:r},s,8*n);return new Uint8Array(c)})}var Qr={x25519:l.encodeUTF8("OpenPGP X25519"),x448:l.encodeUTF8("OpenPGP X448")};function Fs(i){return f(this,null,function*(){switch(i){case o.publicKey.x25519:{let e=Et(32),{publicKey:t}=he.box.keyPair.fromSecretKey(e);return{A:t,k:e}}case o.publicKey.x448:{let e=yield l.getNobleCurve(o.publicKey.x448),t=e.utils.randomPrivateKey();return{A:e.getPublicKey(t),k:t}}default:throw Error("Unsupported ECDH algorithm")}})}function Rs(i){switch(i){case o.publicKey.x25519:return 32;case o.publicKey.x448:return 56;default:throw Error("Unsupported ECDH algorithm")}}function Dn(i,e){return f(this,null,function*(){switch(i){case o.publicKey.x25519:{let t=Et(Rs(i)),r=he.scalarMult(t,e);fi(r);let{publicKey:n}=he.box.keyPair.fromSecretKey(t);return{ephemeralPublicKey:n,sharedSecret:r}}case o.publicKey.x448:{let t=yield l.getNobleCurve(o.publicKey.x448),r=t.utils.randomPrivateKey(),n=t.getSharedSecret(r,e);return fi(n),{ephemeralPublicKey:t.getPublicKey(r),sharedSecret:n}}default:throw Error("Unsupported ECDH algorithm")}})}function Cn(i,e,t,r){return f(this,null,function*(){switch(i){case o.publicKey.x25519:{let n=he.scalarMult(r,e);return fi(n),n}case o.publicKey.x448:{let n=(yield l.getNobleCurve(o.publicKey.x448)).getSharedSecret(r,e);return fi(n),n}default:throw Error("Unsupported ECDH algorithm")}})}function fi(i){let e=0;for(let t=0;t<i.length;t++)e|=i[t];if(e===0)throw Error("Unexpected low order point")}var Vo=Object.freeze({__proto__:null,decrypt:function(i,e,t,r,n){return f(this,null,function*(){let a=yield Cn(i,e,r,n),s=l.concatUint8Array([e,r,a]);switch(i){case o.publicKey.x25519:{let c=o.symmetric.aes128,{keySize:u}=Ie(c);return di(c,yield Ft(o.hash.sha256,s,new Uint8Array,Qr.x25519,u),t)}case o.publicKey.x448:{let c=o.symmetric.aes256,{keySize:u}=Ie(o.symmetric.aes256);return di(c,yield Ft(o.hash.sha512,s,new Uint8Array,Qr.x448,u),t)}default:throw Error("Unsupported ECDH algorithm")}})},encrypt:function(i,e,t){return f(this,null,function*(){let{ephemeralPublicKey:r,sharedSecret:n}=yield Dn(i,t),a=l.concatUint8Array([r,t,n]);switch(i){case o.publicKey.x25519:{let s=o.symmetric.aes128,{keySize:c}=Ie(s),u=yield Ft(o.hash.sha256,a,new Uint8Array,Qr.x25519,c);return{ephemeralPublicKey:r,wrappedKey:yield gi(s,u,e)}}case o.publicKey.x448:{let s=o.symmetric.aes256,{keySize:c}=Ie(o.symmetric.aes256),u=yield Ft(o.hash.sha512,a,new Uint8Array,Qr.x448,c);return{ephemeralPublicKey:r,wrappedKey:yield gi(s,u,e)}}default:throw Error("Unsupported ECDH algorithm")}})},generate:Fs,generateEphemeralEncryptionMaterial:Dn,getPayloadSize:Rs,recomputeSharedSecret:Cn,validateParams:function(i,e,t){return f(this,null,function*(){switch(i){case o.publicKey.x25519:{let{publicKey:r}=he.box.keyPair.fromSecretKey(t);return l.equalsUint8Array(e,r)}case o.publicKey.x448:{let r=(yield l.getNobleCurve(o.publicKey.x448)).getPublicKey(t);return l.equalsUint8Array(e,r)}default:return!1}})}}),an=l.getWebCrypto(),mi=l.getNodeCrypto(),lt={[o.curve.nistP256]:"P-256",[o.curve.nistP384]:"P-384",[o.curve.nistP521]:"P-521"},ft=mi?mi.getCurves():[],st=mi?{[o.curve.secp256k1]:ft.includes("secp256k1")?"secp256k1":void 0,[o.curve.nistP256]:ft.includes("prime256v1")?"prime256v1":void 0,[o.curve.nistP384]:ft.includes("secp384r1")?"secp384r1":void 0,[o.curve.nistP521]:ft.includes("secp521r1")?"secp521r1":void 0,[o.curve.ed25519Legacy]:ft.includes("ED25519")?"ED25519":void 0,[o.curve.curve25519Legacy]:ft.includes("X25519")?"X25519":void 0,[o.curve.brainpoolP256r1]:ft.includes("brainpoolP256r1")?"brainpoolP256r1":void 0,[o.curve.brainpoolP384r1]:ft.includes("brainpoolP384r1")?"brainpoolP384r1":void 0,[o.curve.brainpoolP512r1]:ft.includes("brainpoolP512r1")?"brainpoolP512r1":void 0}:{},zs={[o.curve.nistP256]:{oid:[6,8,42,134,72,206,61,3,1,7],keyType:o.publicKey.ecdsa,hash:o.hash.sha256,cipher:o.symmetric.aes128,node:st[o.curve.nistP256],web:lt[o.curve.nistP256],payloadSize:32,sharedSize:256,wireFormatLeadingByte:4},[o.curve.nistP384]:{oid:[6,5,43,129,4,0,34],keyType:o.publicKey.ecdsa,hash:o.hash.sha384,cipher:o.symmetric.aes192,node:st[o.curve.nistP384],web:lt[o.curve.nistP384],payloadSize:48,sharedSize:384,wireFormatLeadingByte:4},[o.curve.nistP521]:{oid:[6,5,43,129,4,0,35],keyType:o.publicKey.ecdsa,hash:o.hash.sha512,cipher:o.symmetric.aes256,node:st[o.curve.nistP521],web:lt[o.curve.nistP521],payloadSize:66,sharedSize:528,wireFormatLeadingByte:4},[o.curve.secp256k1]:{oid:[6,5,43,129,4,0,10],keyType:o.publicKey.ecdsa,hash:o.hash.sha256,cipher:o.symmetric.aes128,node:st[o.curve.secp256k1],payloadSize:32,wireFormatLeadingByte:4},[o.curve.ed25519Legacy]:{oid:[6,9,43,6,1,4,1,218,71,15,1],keyType:o.publicKey.eddsaLegacy,hash:o.hash.sha512,node:!1,payloadSize:32,wireFormatLeadingByte:64},[o.curve.curve25519Legacy]:{oid:[6,10,43,6,1,4,1,151,85,1,5,1],keyType:o.publicKey.ecdh,hash:o.hash.sha256,cipher:o.symmetric.aes128,node:!1,payloadSize:32,wireFormatLeadingByte:64},[o.curve.brainpoolP256r1]:{oid:[6,9,43,36,3,3,2,8,1,1,7],keyType:o.publicKey.ecdsa,hash:o.hash.sha256,cipher:o.symmetric.aes128,node:st[o.curve.brainpoolP256r1],payloadSize:32,wireFormatLeadingByte:4},[o.curve.brainpoolP384r1]:{oid:[6,9,43,36,3,3,2,8,1,1,11],keyType:o.publicKey.ecdsa,hash:o.hash.sha384,cipher:o.symmetric.aes192,node:st[o.curve.brainpoolP384r1],payloadSize:48,wireFormatLeadingByte:4},[o.curve.brainpoolP512r1]:{oid:[6,9,43,36,3,3,2,8,1,1,13],keyType:o.publicKey.ecdsa,hash:o.hash.sha512,cipher:o.symmetric.aes256,node:st[o.curve.brainpoolP512r1],payloadSize:64,wireFormatLeadingByte:4}},rt=class{constructor(e){try{this.name=e instanceof kt?e.getName():o.write(o.curve,e)}catch{throw new ne("Unknown curve")}let t=zs[this.name];this.keyType=t.keyType,this.oid=t.oid,this.hash=t.hash,this.cipher=t.cipher,this.node=t.node,this.web=t.web,this.payloadSize=t.payloadSize,this.sharedSize=t.sharedSize,this.wireFormatLeadingByte=t.wireFormatLeadingByte,this.web&&l.getWebCrypto()?this.type="web":this.node&&l.getNodeCrypto()?this.type="node":this.name===o.curve.curve25519Legacy?this.type="curve25519Legacy":this.name===o.curve.ed25519Legacy&&(this.type="ed25519Legacy")}genKeyPair(){return f(this,null,function*(){switch(this.type){case"web":try{return yield function(e,t){return f(this,null,function*(){let r=yield an.generateKey({name:"ECDSA",namedCurve:lt[e]},!0,["sign","verify"]),n=yield an.exportKey("jwk",r.privateKey),a=yield an.exportKey("jwk",r.publicKey);return{publicKey:Hs(a,t),privateKey:et(n.d)}})}(this.name,this.wireFormatLeadingByte)}catch(e){return l.printDebugError("Browser did not support generating ec key "+e.message),La(this.name)}case"node":return function(e){return f(this,null,function*(){let t=mi.createECDH(st[e]);return yield t.generateKeys(),{publicKey:new Uint8Array(t.getPublicKey()),privateKey:new Uint8Array(t.getPrivateKey())}})}(this.name);case"curve25519Legacy":{let{k:e,A:t}=yield Fs(o.publicKey.x25519),r=e.slice().reverse();return r[0]=127&r[0]|64,r[31]&=248,{publicKey:l.concatUint8Array([new Uint8Array([this.wireFormatLeadingByte]),t]),privateKey:r}}case"ed25519Legacy":{let{seed:e,A:t}=yield xs(o.publicKey.ed25519);return{publicKey:l.concatUint8Array([new Uint8Array([this.wireFormatLeadingByte]),t]),privateKey:e}}default:return La(this.name)}})}};function Ns(i,e,t,r){return f(this,null,function*(){let n={[o.curve.nistP256]:!0,[o.curve.nistP384]:!0,[o.curve.nistP521]:!0,[o.curve.secp256k1]:!0,[o.curve.curve25519Legacy]:i===o.publicKey.ecdh,[o.curve.brainpoolP256r1]:!0,[o.curve.brainpoolP384r1]:!0,[o.curve.brainpoolP512r1]:!0},a=e.getName();if(!n[a])return!1;if(a===o.curve.curve25519Legacy){r=r.slice().reverse();let{publicKey:c}=he.box.keyPair.fromSecretKey(r);t=new Uint8Array(t);let u=new Uint8Array([64,...c]);return!!l.equalsUint8Array(u,t)}let s=(yield l.getNobleCurve(o.publicKey.ecdsa,a)).getPublicKey(r,!1);return!!l.equalsUint8Array(s,t)})}function $t(i,e){let{payloadSize:t,wireFormatLeadingByte:r,name:n}=i,a=n===o.curve.curve25519Legacy||n===o.curve.ed25519Legacy?t:2*t;if(e[0]!==r||e.length!==a+1)throw Error("Invalid point encoding")}function La(i){return f(this,null,function*(){let e=yield l.getNobleCurve(o.publicKey.ecdsa,i),t=e.utils.randomPrivateKey();return{publicKey:e.getPublicKey(t,!1),privateKey:t}})}function Hs(i,e){let t=et(i.x),r=et(i.y),n=new Uint8Array(t.length+r.length+1);return n[0]=e,n.set(t,1),n.set(r,t.length+1),n}function Ni(i,e,t){let r=i,n=t.slice(1,r+1),a=t.slice(r+1,2*r+1);return{kty:"EC",crv:e,x:Be(n),y:Be(a),ext:!0}}function js(i,e,t,r){let n=Ni(i,e,t);return n.d=Be(r),n}var wi=l.getWebCrypto(),Os=l.getNodeCrypto();function Fa(i,e,t,r,n,a){return f(this,null,function*(){let s=new rt(i);if($t(s,r),t&&!l.isStream(t)){let u={publicKey:r,privateKey:n};switch(s.type){case"web":try{return yield function(h,y,p,g){return f(this,null,function*(){let d=h.payloadSize,w=js(h.payloadSize,lt[h.name],g.publicKey,g.privateKey),m=yield wi.importKey("jwk",w,{name:"ECDSA",namedCurve:lt[h.name],hash:{name:o.read(o.webHash,h.hash)}},!1,["sign"]),b=new Uint8Array(yield wi.sign({name:"ECDSA",namedCurve:lt[h.name],hash:{name:o.read(o.webHash,y)}},m,p));return{r:b.slice(0,d),s:b.slice(d,d<<1)}})}(s,e,t,u)}catch(h){if(s.name!=="nistP521"&&(h.name==="DataError"||h.name==="OperationError"))throw h;l.printDebugError("Browser did not support signing: "+h.message)}break;case"node":return function(h,y,p,g){return f(this,null,function*(){let d=l.nodeRequire("eckey-utils"),w=l.getNodeBuffer(),{privateKey:m}=d.generateDer({curveName:st[h.name],privateKey:w.from(g)}),b=Os.createSign(o.read(o.hash,y));b.write(p),b.end();let v=new Uint8Array(b.sign({key:m,format:"der",type:"sec1",dsaEncoding:"ieee-p1363"})),A=h.payloadSize;return{r:v.subarray(0,A),s:v.subarray(A,A<<1)}})}(s,e,t,n)}}let c=(yield l.getNobleCurve(o.publicKey.ecdsa,s.name)).sign(a,n,{lowS:!1});return{r:pe(c.r,"be",s.payloadSize),s:pe(c.s,"be",s.payloadSize)}})}function Ra(i,e,t,r,n,a){return f(this,null,function*(){let s=new rt(i);$t(s,n);let c=()=>f(this,null,function*(){return a[0]===0&&za(s,t,a.subarray(1),n)});if(r&&!l.isStream(r))switch(s.type){case"web":try{return(yield function(m,b,v,A,S){return f(this,arguments,function*(h,y,{r:p,s:g},d,w){let K=Ni(h.payloadSize,lt[h.name],w),D=yield wi.importKey("jwk",K,{name:"ECDSA",namedCurve:lt[h.name],hash:{name:o.read(o.webHash,h.hash)}},!1,["verify"]),B=l.concatUint8Array([p,g]).buffer;return wi.verify({name:"ECDSA",namedCurve:lt[h.name],hash:{name:o.read(o.webHash,y)}},D,B,d)})}(s,e,t,r,n))||c()}catch(u){if(s.name!=="nistP521"&&(u.name==="DataError"||u.name==="OperationError"))throw u;l.printDebugError("Browser did not support verifying: "+u.message)}break;case"node":return(yield function(m,b,v,A,S){return f(this,arguments,function*(h,y,{r:p,s:g},d,w){let K=l.nodeRequire("eckey-utils"),D=l.getNodeBuffer(),{publicKey:B}=K.generateDer({curveName:st[h.name],publicKey:D.from(w)}),P=Os.createVerify(o.read(o.hash,y));P.write(d),P.end();let k=l.concatUint8Array([p,g]);try{return P.verify({key:B,format:"der",type:"spki",dsaEncoding:"ieee-p1363"},k)}catch{return!1}})}(s,e,t,r,n))||c()}return(yield za(s,t,a,n))||c()})}function za(i,e,t,r){return f(this,null,function*(){return(yield l.getNobleCurve(o.publicKey.ecdsa,i.name)).verify(l.concatUint8Array([e.r,e.s]),t,r,{lowS:!1})})}var Wo=Object.freeze({__proto__:null,sign:Fa,validateParams:function(i,e,t){return f(this,null,function*(){let r=new rt(i);if(r.keyType!==o.publicKey.ecdsa)return!1;switch(r.type){case"web":case"node":{let n=Et(8),a=o.hash.sha256,s=yield qe.digest(a,n);try{let c=yield Fa(i,a,n,e,t,s);return yield Ra(i,a,c,n,e,s)}catch{return!1}}default:return Ns(o.publicKey.ecdsa,i,e,t)}})},verify:Ra}),$o=Object.freeze({__proto__:null,sign:function(i,e,t,r,n,a){return f(this,null,function*(){if($t(new rt(i),r),qe.getHashByteLength(e)<qe.getHashByteLength(o.hash.sha256))throw Error("Hash algorithm too weak for EdDSA.");let{RS:s}=yield Bs(o.publicKey.ed25519,e,0,r.subarray(1),n,a);return{r:s.subarray(0,32),s:s.subarray(32)}})},validateParams:function(i,e,t){return f(this,null,function*(){if(i.getName()!==o.curve.ed25519Legacy)return!1;let{publicKey:r}=he.sign.keyPair.fromSeed(t),n=new Uint8Array([64,...r]);return l.equalsUint8Array(e,n)})},verify:function(c,u,h,y,p,g){return f(this,arguments,function*(i,e,{r:t,s:r},n,a,s){if($t(new rt(i),a),qe.getHashByteLength(e)<qe.getHashByteLength(o.hash.sha256))throw Error("Hash algorithm too weak for EdDSA.");let d=l.concatUint8Array([t,r]);return Ts(o.publicKey.ed25519,e,{RS:d},0,a.subarray(1),s)})}});function _s(i){let e=8-i.length%8,t=new Uint8Array(i.length+e).fill(e);return t.set(i),t}function qs(i){let e=i.length;if(e>0){let t=i[e-1];if(t>=1){let r=i.subarray(e-t),n=new Uint8Array(t).fill(t);if(l.equalsUint8Array(r,n))return i.subarray(0,e-t)}}throw Error("Invalid padding")}var Qo=Object.freeze({__proto__:null,decode:qs,encode:_s}),Rt=l.getWebCrypto(),Gs=l.getNodeCrypto();function Na(i,e,t,r){return l.concatUint8Array([e.write(),new Uint8Array([i]),t.write(),l.stringToUint8Array("Anonymous Sender    "),r])}function Ha(i,e,t,r,n=!1,a=!1){return f(this,null,function*(){let s;if(n){for(s=0;s<e.length&&e[s]===0;s++);e=e.subarray(s)}if(a){for(s=e.length-1;s>=0&&e[s]===0;s--);e=e.subarray(0,s+1)}return(yield qe.digest(i,l.concatUint8Array([new Uint8Array([0,0,0,1]),e,r]))).subarray(0,t)})}function Xo(i,e){return f(this,null,function*(){switch(i.type){case"curve25519Legacy":{let{sharedSecret:t,ephemeralPublicKey:r}=yield Dn(o.publicKey.x25519,e.subarray(1));return{publicKey:l.concatUint8Array([new Uint8Array([i.wireFormatLeadingByte]),r]),sharedKey:t}}case"web":if(i.web&&l.getWebCrypto())try{return yield function(t,r){return f(this,null,function*(){let n=Ni(t.payloadSize,t.web,r),a=Rt.generateKey({name:"ECDH",namedCurve:t.web},!0,["deriveKey","deriveBits"]),s=Rt.importKey("jwk",n,{name:"ECDH",namedCurve:t.web},!1,[]);[a,s]=yield Promise.all([a,s]);let c=Rt.deriveBits({name:"ECDH",namedCurve:t.web,public:s},a.privateKey,t.sharedSize),u=Rt.exportKey("jwk",a.publicKey);[c,u]=yield Promise.all([c,u]);let h=new Uint8Array(c);return{publicKey:new Uint8Array(Hs(u,t.wireFormatLeadingByte)),sharedKey:h}})}(i,e)}catch(t){return l.printDebugError(t),Oa(i,e)}break;case"node":return function(t,r){return f(this,null,function*(){let n=Gs.createECDH(t.node);n.generateKeys();let a=new Uint8Array(n.computeSecret(r));return{publicKey:new Uint8Array(n.getPublicKey()),sharedKey:a}})}(i,e);default:return Oa(i,e)}})}function Yo(i,e,t,r){return f(this,null,function*(){if(r.length!==i.payloadSize){let n=new Uint8Array(i.payloadSize);n.set(r,i.payloadSize-r.length),r=n}switch(i.type){case"curve25519Legacy":{let n=r.slice().reverse();return{secretKey:n,sharedKey:yield Cn(o.publicKey.x25519,e.subarray(1),t.subarray(1),n)}}case"web":if(i.web&&l.getWebCrypto())try{return yield function(n,a,s,c){return f(this,null,function*(){let u=js(n.payloadSize,n.web,s,c),h=Rt.importKey("jwk",u,{name:"ECDH",namedCurve:n.web},!0,["deriveKey","deriveBits"]),y=Ni(n.payloadSize,n.web,a),p=Rt.importKey("jwk",y,{name:"ECDH",namedCurve:n.web},!0,[]);[h,p]=yield Promise.all([h,p]);let g=Rt.deriveBits({name:"ECDH",namedCurve:n.web,public:p},h,n.sharedSize),d=Rt.exportKey("jwk",h);[g,d]=yield Promise.all([g,d]);let w=new Uint8Array(g);return{secretKey:et(d.d),sharedKey:w}})}(i,e,t,r)}catch(n){return l.printDebugError(n),ja(i,e,r)}break;case"node":return function(n,a,s){return f(this,null,function*(){let c=Gs.createECDH(n.node);c.setPrivateKey(s);let u=new Uint8Array(c.computeSecret(a));return{secretKey:new Uint8Array(c.getPrivateKey()),sharedKey:u}})}(i,e,r);default:return ja(i,e,r)}})}function ja(i,e,t){return f(this,null,function*(){return{secretKey:t,sharedKey:(yield l.getNobleCurve(o.publicKey.ecdh,i.name)).getSharedSecret(t,e).subarray(1)}})}function Oa(i,e){return f(this,null,function*(){let t=yield l.getNobleCurve(o.publicKey.ecdh,i.name),{publicKey:r,privateKey:n}=yield i.genKeyPair();return{publicKey:r,sharedKey:t.getSharedSecret(n,e).subarray(1)}})}var Zo=Object.freeze({__proto__:null,decrypt:function(i,e,t,r,n,a,s){return f(this,null,function*(){let c=new rt(i);$t(c,n),$t(c,t);let{sharedKey:u}=yield Yo(c,t,n,a),h=Na(o.publicKey.ecdh,i,e,s),{keySize:y}=Ie(e.cipher),p;for(let g=0;g<3;g++)try{let d=yield Ha(e.hash,u,y,h,g===1,g===2);return qs(yield di(e.cipher,d,r))}catch(d){p=d}throw p})},encrypt:function(i,e,t,r,n){return f(this,null,function*(){let a=_s(t),s=new rt(i);$t(s,r);let{publicKey:c,sharedKey:u}=yield Xo(s,r),h=Na(o.publicKey.ecdh,i,e,n),{keySize:y}=Ie(e.cipher),p=yield Ha(e.hash,u,y,h);return{publicKey:c,wrappedKey:yield gi(e.cipher,p,a)}})},validateParams:function(i,e,t){return f(this,null,function*(){return Ns(o.publicKey.ecdh,i,e,t)})}}),Jo=Object.freeze({__proto__:null,CurveWithOID:rt,ecdh:Zo,ecdhX:Vo,ecdsa:Wo,eddsa:qo,eddsaLegacy:$o,generate:function(i){return f(this,null,function*(){let e=new rt(i),{oid:t,hash:r,cipher:n}=e,a=yield e.genKeyPair();return{oid:t,Q:a.publicKey,secret:l.leftPad(a.privateKey,e.payloadSize),hash:r,cipher:n}})},getPreferredHashAlgo:function(i){return zs[i.getName()].hash}}),Xr=BigInt(0),dr=BigInt(1),ec=Object.freeze({__proto__:null,sign:function(i,e,t,r,n,a){return f(this,null,function*(){let s=BigInt(0),c,u,h,y;r=F(r),n=F(n),t=F(t),a=F(a),t=W(t,r),a=W(a,n);let p=W(F(e.subarray(0,Le(n))),n);for(;;){if(c=St(dr,n),u=W(ve(t,c,r),n),u===s)continue;let g=W(a*u,n);if(y=W(p+g,n),h=W(cr(c,n)*y,n),h!==s)break}return{r:pe(u,"be",Le(r)),s:pe(h,"be",Le(r))}})},validateParams:function(i,e,t,r,n){return f(this,null,function*(){if(i=F(i),e=F(e),t=F(t),r=F(r),t<=dr||t>=i||W(i-dr,e)!==Xr||ve(t,e,i)!==dr)return!1;let a=BigInt(hr(e));if(a<BigInt(150)||!vs(e,null,32))return!1;n=F(n);let s=BigInt(2);return r===ve(t,e*St(s<<a-dr,s<<a)+n,i)})},verify:function(i,e,t,r,n,a,s,c){return f(this,null,function*(){if(e=F(e),t=F(t),a=F(a),s=F(s),n=F(n),c=F(c),e<=Xr||e>=s||t<=Xr||t>=s)return l.printDebug("invalid DSA Signature"),!1;let u=W(F(r.subarray(0,Le(s))),s),h=cr(t,s);if(h===Xr)return l.printDebug("invalid DSA Signature"),!1;n=W(n,a),c=W(c,a);let y=W(u*h,s),p=W(e*h,s);return W(W(ve(n,y,a)*ve(c,p,a),a),s)===e})}}),_={rsa:To,elgamal:Mo,elliptic:Jo,dsa:ec},tc=Object.freeze({__proto__:null,parseSignatureParams:function(i,e){let t=0;switch(i){case o.publicKey.rsaEncryptSign:case o.publicKey.rsaEncrypt:case o.publicKey.rsaSign:{let r=l.readMPI(e.subarray(t));return t+=r.length+2,{read:t,signatureParams:{s:r}}}case o.publicKey.dsa:case o.publicKey.ecdsa:{let r=l.readMPI(e.subarray(t));t+=r.length+2;let n=l.readMPI(e.subarray(t));return t+=n.length+2,{read:t,signatureParams:{r,s:n}}}case o.publicKey.eddsaLegacy:{let r=l.readMPI(e.subarray(t));t+=r.length+2;let n=l.readMPI(e.subarray(t));return t+=n.length+2,{read:t,signatureParams:{r,s:n}}}case o.publicKey.ed25519:case o.publicKey.ed448:{let r=2*_.elliptic.eddsa.getPayloadSize(i),n=l.readExactSubarray(e,t,t+r);return t+=n.length,{read:t,signatureParams:{RS:n}}}default:throw new ne("Unknown signature algorithm.")}},sign:function(i,e,t,r,n,a){return f(this,null,function*(){if(!t||!r)throw Error("Missing key parameters");switch(i){case o.publicKey.rsaEncryptSign:case o.publicKey.rsaEncrypt:case o.publicKey.rsaSign:{let{n:s,e:c}=t,{d:u,p:h,q:y,u:p}=r;return{s:yield _.rsa.sign(e,n,s,c,u,h,y,p,a)}}case o.publicKey.dsa:{let{g:s,p:c,q:u}=t,{x:h}=r;return _.dsa.sign(e,a,s,c,u,h)}case o.publicKey.elgamal:throw Error("Signing with Elgamal is not defined in the OpenPGP standard.");case o.publicKey.ecdsa:{let{oid:s,Q:c}=t,{d:u}=r;return _.elliptic.ecdsa.sign(s,e,n,c,u,a)}case o.publicKey.eddsaLegacy:{let{oid:s,Q:c}=t,{seed:u}=r;return _.elliptic.eddsaLegacy.sign(s,e,n,c,u,a)}case o.publicKey.ed25519:case o.publicKey.ed448:{let{A:s}=t,{seed:c}=r;return _.elliptic.eddsa.sign(i,e,n,s,c,a)}default:throw Error("Unknown signature algorithm.")}})},verify:function(i,e,t,r,n,a){return f(this,null,function*(){switch(i){case o.publicKey.rsaEncryptSign:case o.publicKey.rsaEncrypt:case o.publicKey.rsaSign:{let{n:s,e:c}=r,u=l.leftPad(t.s,s.length);return _.rsa.verify(e,n,u,s,c,a)}case o.publicKey.dsa:{let{g:s,p:c,q:u,y:h}=r,{r:y,s:p}=t;return _.dsa.verify(e,y,p,a,s,c,u,h)}case o.publicKey.ecdsa:{let{oid:s,Q:c}=r,u=new _.elliptic.CurveWithOID(s).payloadSize,h=l.leftPad(t.r,u),y=l.leftPad(t.s,u);return _.elliptic.ecdsa.verify(s,e,{r:h,s:y},n,c,a)}case o.publicKey.eddsaLegacy:{let{oid:s,Q:c}=r,u=new _.elliptic.CurveWithOID(s).payloadSize,h=l.leftPad(t.r,u),y=l.leftPad(t.s,u);return _.elliptic.eddsaLegacy.verify(s,e,{r:h,s:y},n,c,a)}case o.publicKey.ed25519:case o.publicKey.ed448:{let{A:s}=r;return _.elliptic.eddsa.verify(i,e,t,n,s,a)}default:throw Error("Unknown signature algorithm.")}})}}),bi=class{constructor(e){e&&(this.data=e)}read(e){if(e.length>=1){let t=e[0];if(e.length>=1+t)return this.data=e.subarray(1,1+t),1+this.data.length}throw Error("Invalid symmetric key")}write(){return l.concatUint8Array([new Uint8Array([this.data.length]),this.data])}},ki=class{constructor(e){if(e){let{hash:t,cipher:r}=e;this.hash=t,this.cipher=r}else this.hash=null,this.cipher=null}read(e){if(e.length<4||e[0]!==3||e[1]!==1)throw new ne("Cannot read KDFParams");return this.hash=e[2],this.cipher=e[3],4}write(){return new Uint8Array([3,1,this.hash,this.cipher])}},vi=class i{static fromObject({wrappedKey:e,algorithm:t}){let r=new i;return r.wrappedKey=e,r.algorithm=t,r}read(e){let t=0,r=e[t++];this.algorithm=r%2?e[t++]:null,r-=r%2,this.wrappedKey=l.readExactSubarray(e,t,t+r),t+=r}write(){return l.concatUint8Array([this.algorithm?new Uint8Array([this.wrappedKey.length+1,this.algorithm]):new Uint8Array([this.wrappedKey.length]),this.wrappedKey])}};function sn(i){try{i.getName()}catch{throw new ne("Unknown curve OID")}}function Wt(i,e){switch(i){case o.publicKey.ecdsa:case o.publicKey.ecdh:case o.publicKey.eddsaLegacy:return new _.elliptic.CurveWithOID(e).payloadSize;case o.publicKey.ed25519:case o.publicKey.ed448:return _.elliptic.eddsa.getPayloadSize(i);case o.publicKey.x25519:case o.publicKey.x448:return _.elliptic.ecdhX.getPayloadSize(i);default:throw Error("Unknown elliptic algo")}}var rc=Object.freeze({__proto__:null,generateParams:function(i,e,t){switch(i){case o.publicKey.rsaEncrypt:case o.publicKey.rsaEncryptSign:case o.publicKey.rsaSign:return _.rsa.generate(e,65537).then(({n:r,e:n,d:a,p:s,q:c,u})=>({privateParams:{d:a,p:s,q:c,u},publicParams:{n:r,e:n}}));case o.publicKey.ecdsa:return _.elliptic.generate(t).then(({oid:r,Q:n,secret:a})=>({privateParams:{d:a},publicParams:{oid:new kt(r),Q:n}}));case o.publicKey.eddsaLegacy:return _.elliptic.generate(t).then(({oid:r,Q:n,secret:a})=>({privateParams:{seed:a},publicParams:{oid:new kt(r),Q:n}}));case o.publicKey.ecdh:return _.elliptic.generate(t).then(({oid:r,Q:n,secret:a,hash:s,cipher:c})=>({privateParams:{d:a},publicParams:{oid:new kt(r),Q:n,kdfParams:new ki({hash:s,cipher:c})}}));case o.publicKey.ed25519:case o.publicKey.ed448:return _.elliptic.eddsa.generate(i).then(({A:r,seed:n})=>({privateParams:{seed:n},publicParams:{A:r}}));case o.publicKey.x25519:case o.publicKey.x448:return _.elliptic.ecdhX.generate(i).then(({A:r,k:n})=>({privateParams:{k:n},publicParams:{A:r}}));case o.publicKey.dsa:case o.publicKey.elgamal:throw Error("Unsupported algorithm for key generation.");default:throw Error("Unknown public key algorithm.")}},generateSessionKey:function(i){let{keySize:e}=Ie(i);return Et(e)},getAEADMode:function(i){let e=o.read(o.aead,i);return ks[e]},getCipherParams:Ie,getCurvePayloadSize:Wt,getPreferredCurveHashAlgo:function(i,e){switch(i){case o.publicKey.ecdsa:case o.publicKey.eddsaLegacy:return _.elliptic.getPreferredHashAlgo(e);case o.publicKey.ed25519:case o.publicKey.ed448:return _.elliptic.eddsa.getPreferredHashAlgo(i);default:throw Error("Unknown elliptic signing algo")}},getPrefixRandom:function(i){return f(this,null,function*(){let{blockSize:e}=Ie(i),t=yield Et(e),r=new Uint8Array([t[t.length-2],t[t.length-1]]);return l.concat([t,r])})},parseEncSessionKeyParams:function(i,e){let t=0;switch(i){case o.publicKey.rsaEncrypt:case o.publicKey.rsaEncryptSign:return{c:l.readMPI(e.subarray(t))};case o.publicKey.elgamal:{let r=l.readMPI(e.subarray(t));return t+=r.length+2,{c1:r,c2:l.readMPI(e.subarray(t))}}case o.publicKey.ecdh:{let r=l.readMPI(e.subarray(t));t+=r.length+2;let n=new bi;return n.read(e.subarray(t)),{V:r,C:n}}case o.publicKey.x25519:case o.publicKey.x448:{let r=Wt(i),n=l.readExactSubarray(e,t,t+r);t+=n.length;let a=new vi;return a.read(e.subarray(t)),{ephemeralPublicKey:n,C:a}}default:throw new ne("Unknown public key encryption algorithm.")}},parsePrivateKeyParams:function(i,e,t){let r=0;switch(i){case o.publicKey.rsaEncrypt:case o.publicKey.rsaEncryptSign:case o.publicKey.rsaSign:{let n=l.readMPI(e.subarray(r));r+=n.length+2;let a=l.readMPI(e.subarray(r));r+=a.length+2;let s=l.readMPI(e.subarray(r));r+=s.length+2;let c=l.readMPI(e.subarray(r));return r+=c.length+2,{read:r,privateParams:{d:n,p:a,q:s,u:c}}}case o.publicKey.dsa:case o.publicKey.elgamal:{let n=l.readMPI(e.subarray(r));return r+=n.length+2,{read:r,privateParams:{x:n}}}case o.publicKey.ecdsa:case o.publicKey.ecdh:{let n=Wt(i,t.oid),a=l.readMPI(e.subarray(r));return r+=a.length+2,a=l.leftPad(a,n),{read:r,privateParams:{d:a}}}case o.publicKey.eddsaLegacy:{let n=Wt(i,t.oid);if(t.oid.getName()!==o.curve.ed25519Legacy)throw Error("Unexpected OID for eddsaLegacy");let a=l.readMPI(e.subarray(r));return r+=a.length+2,a=l.leftPad(a,n),{read:r,privateParams:{seed:a}}}case o.publicKey.ed25519:case o.publicKey.ed448:{let n=Wt(i),a=l.readExactSubarray(e,r,r+n);return r+=a.length,{read:r,privateParams:{seed:a}}}case o.publicKey.x25519:case o.publicKey.x448:{let n=Wt(i),a=l.readExactSubarray(e,r,r+n);return r+=a.length,{read:r,privateParams:{k:a}}}default:throw new ne("Unknown public key encryption algorithm.")}},parsePublicKeyParams:function(i,e){let t=0;switch(i){case o.publicKey.rsaEncrypt:case o.publicKey.rsaEncryptSign:case o.publicKey.rsaSign:{let r=l.readMPI(e.subarray(t));t+=r.length+2;let n=l.readMPI(e.subarray(t));return t+=n.length+2,{read:t,publicParams:{n:r,e:n}}}case o.publicKey.dsa:{let r=l.readMPI(e.subarray(t));t+=r.length+2;let n=l.readMPI(e.subarray(t));t+=n.length+2;let a=l.readMPI(e.subarray(t));t+=a.length+2;let s=l.readMPI(e.subarray(t));return t+=s.length+2,{read:t,publicParams:{p:r,q:n,g:a,y:s}}}case o.publicKey.elgamal:{let r=l.readMPI(e.subarray(t));t+=r.length+2;let n=l.readMPI(e.subarray(t));t+=n.length+2;let a=l.readMPI(e.subarray(t));return t+=a.length+2,{read:t,publicParams:{p:r,g:n,y:a}}}case o.publicKey.ecdsa:{let r=new kt;t+=r.read(e),sn(r);let n=l.readMPI(e.subarray(t));return t+=n.length+2,{read:t,publicParams:{oid:r,Q:n}}}case o.publicKey.eddsaLegacy:{let r=new kt;if(t+=r.read(e),sn(r),r.getName()!==o.curve.ed25519Legacy)throw Error("Unexpected OID for eddsaLegacy");let n=l.readMPI(e.subarray(t));return t+=n.length+2,n=l.leftPad(n,33),{read:t,publicParams:{oid:r,Q:n}}}case o.publicKey.ecdh:{let r=new kt;t+=r.read(e),sn(r);let n=l.readMPI(e.subarray(t));t+=n.length+2;let a=new ki;return t+=a.read(e.subarray(t)),{read:t,publicParams:{oid:r,Q:n,kdfParams:a}}}case o.publicKey.ed25519:case o.publicKey.ed448:case o.publicKey.x25519:case o.publicKey.x448:{let r=l.readExactSubarray(e,t,t+Wt(i));return t+=r.length,{read:t,publicParams:{A:r}}}default:throw new ne("Unknown public key encryption algorithm.")}},publicKeyDecrypt:function(i,e,t,r,n,a){return f(this,null,function*(){switch(i){case o.publicKey.rsaEncryptSign:case o.publicKey.rsaEncrypt:{let{c:s}=r,{n:c,e:u}=e,{d:h,p:y,q:p,u:g}=t;return _.rsa.decrypt(s,c,u,h,y,p,g,a)}case o.publicKey.elgamal:{let{c1:s,c2:c}=r,u=e.p,h=t.x;return _.elgamal.decrypt(s,c,u,h,a)}case o.publicKey.ecdh:{let{oid:s,Q:c,kdfParams:u}=e,{d:h}=t,{V:y,C:p}=r;return _.elliptic.ecdh.decrypt(s,u,y,p.data,c,h,n)}case o.publicKey.x25519:case o.publicKey.x448:{let{A:s}=e,{k:c}=t,{ephemeralPublicKey:u,C:h}=r;if(h.algorithm!==null&&!l.isAES(h.algorithm))throw Error("AES session key expected");return _.elliptic.ecdhX.decrypt(i,u,h.wrappedKey,s,c)}default:throw Error("Unknown public key encryption algorithm.")}})},publicKeyEncrypt:function(i,e,t,r,n){return f(this,null,function*(){switch(i){case o.publicKey.rsaEncrypt:case o.publicKey.rsaEncryptSign:{let{n:a,e:s}=t;return{c:yield _.rsa.encrypt(r,a,s)}}case o.publicKey.elgamal:{let{p:a,g:s,y:c}=t;return _.elgamal.encrypt(r,a,s,c)}case o.publicKey.ecdh:{let{oid:a,Q:s,kdfParams:c}=t,{publicKey:u,wrappedKey:h}=yield _.elliptic.ecdh.encrypt(a,c,r,s,n);return{V:u,C:new bi(h)}}case o.publicKey.x25519:case o.publicKey.x448:{if(e&&!l.isAES(e))throw Error("X25519 and X448 keys can only encrypt AES session keys");let{A:a}=t,{ephemeralPublicKey:s,wrappedKey:c}=yield _.elliptic.ecdhX.encrypt(i,r,a);return{ephemeralPublicKey:s,C:vi.fromObject({algorithm:e,wrappedKey:c})}}default:return[]}})},serializeParams:function(i,e){let t=new Set([o.publicKey.ed25519,o.publicKey.x25519,o.publicKey.ed448,o.publicKey.x448]),r=Object.keys(e).map(n=>{let a=e[n];return l.isUint8Array(a)?t.has(i)?a:l.uint8ArrayToMPI(a):a.write()});return l.concatUint8Array(r)},validateParams:function(i,e,t){return f(this,null,function*(){if(!e||!t)throw Error("Missing key parameters");switch(i){case o.publicKey.rsaEncrypt:case o.publicKey.rsaEncryptSign:case o.publicKey.rsaSign:{let{n:r,e:n}=e,{d:a,p:s,q:c,u}=t;return _.rsa.validateParams(r,n,a,s,c,u)}case o.publicKey.dsa:{let{p:r,q:n,g:a,y:s}=e,{x:c}=t;return _.dsa.validateParams(r,n,a,s,c)}case o.publicKey.elgamal:{let{p:r,g:n,y:a}=e,{x:s}=t;return _.elgamal.validateParams(r,n,a,s)}case o.publicKey.ecdsa:case o.publicKey.ecdh:{let r=_.elliptic[o.read(o.publicKey,i)],{oid:n,Q:a}=e,{d:s}=t;return r.validateParams(n,a,s)}case o.publicKey.eddsaLegacy:{let{Q:r,oid:n}=e,{seed:a}=t;return _.elliptic.eddsaLegacy.validateParams(n,r,a)}case o.publicKey.ed25519:case o.publicKey.ed448:{let{A:r}=e,{seed:n}=t;return _.elliptic.eddsa.validateParams(i,r,n)}case o.publicKey.x25519:case o.publicKey.x448:{let{A:r}=e,{k:n}=t;return _.elliptic.ecdhX.validateParams(i,r,n)}default:throw Error("Unknown public key algorithm.")}})}}),T={cipher:co,hash:qe,mode:ks,publicKey:_,signature:tc,random:Io,pkcs1:Bo,pkcs5:Qo,aesKW:Go};Object.assign(T,rc);var Ai=class i extends Error{constructor(...e){super(...e),Error.captureStackTrace&&Error.captureStackTrace(this,i),this.name="Argon2OutOfMemoryError"}},Yr,fr,In=class{constructor(e=M){let{passes:t,parallelism:r,memoryExponent:n}=e.s2kArgon2Params;this.type="argon2",this.salt=null,this.t=t,this.p=r,this.encodedM=n}generateSalt(){this.salt=T.random.getRandomBytes(16)}read(e){let t=0;return this.salt=e.subarray(t,t+16),t+=16,this.t=e[t++],this.p=e[t++],this.encodedM=e[t++],t}write(){let e=[new Uint8Array([o.write(o.s2k,this.type)]),this.salt,new Uint8Array([this.t,this.p,this.encodedM])];return l.concatUint8Array(e)}produceKey(e,t){return f(this,null,function*(){let r=2<<this.encodedM-1;try{Yr=Yr||(yield import("./chunk-P4GJICAQ.js")).default,fr=fr||Yr();let n=yield fr,a=n({version:19,type:2,password:l.encodeUTF8(e),salt:this.salt,tagLength:t,memorySize:r,parallelism:this.p,passes:this.t});return r>1048576&&(fr=Yr(),fr.catch(()=>{})),a}catch(n){throw n.message&&(n.message.includes("Unable to grow instance memory")||n.message.includes("failed to grow memory")||n.message.includes("WebAssembly.Memory.grow")||n.message.includes("Out of memory"))?new Ai("Could not allocate required memory for Argon2"):n}})}},xn=class{constructor(e,t=M){this.algorithm=o.hash.sha256,this.type=o.read(o.s2k,e),this.c=t.s2kIterationCountByte,this.salt=null}generateSalt(){switch(this.type){case"salted":case"iterated":this.salt=T.random.getRandomBytes(8)}}getCount(){return 16+(15&this.c)<<6+(this.c>>4)}read(e){let t=0;switch(this.algorithm=e[t++],this.type){case"simple":break;case"salted":this.salt=e.subarray(t,t+8),t+=8;break;case"iterated":this.salt=e.subarray(t,t+8),t+=8,this.c=e[t++];break;case"gnu":if(l.uint8ArrayToString(e.subarray(t,t+3))!=="GNU")throw new ne("Unknown s2k type.");if(t+=3,1e3+e[t++]!==1001)throw new ne("Unknown s2k gnu protection mode.");this.type="gnu-dummy";break;default:throw new ne("Unknown s2k type.")}return t}write(){if(this.type==="gnu-dummy")return new Uint8Array([101,0,...l.stringToUint8Array("GNU"),1]);let e=[new Uint8Array([o.write(o.s2k,this.type),this.algorithm])];switch(this.type){case"simple":break;case"salted":e.push(this.salt);break;case"iterated":e.push(this.salt),e.push(new Uint8Array([this.c]));break;case"gnu":throw Error("GNU s2k type not supported.");default:throw Error("Unknown s2k type.")}return l.concatUint8Array(e)}produceKey(e,t){return f(this,null,function*(){e=l.encodeUTF8(e);let r=[],n=0,a=0;for(;n<t;){let s;switch(this.type){case"simple":s=l.concatUint8Array([new Uint8Array(a),e]);break;case"salted":s=l.concatUint8Array([new Uint8Array(a),this.salt,e]);break;case"iterated":{let u=l.concatUint8Array([this.salt,e]),h=u.length,y=Math.max(this.getCount(),h);s=new Uint8Array(a+y),s.set(u,a);for(let p=a+h;p<y;p+=h,h*=2)s.copyWithin(p,a,p);break}case"gnu":throw Error("GNU s2k type not supported.");default:throw Error("Unknown s2k type.")}let c=yield T.hash.digest(this.algorithm,s);r.push(c),n+=c.length,a++}return l.concatUint8Array(r).subarray(0,t)})}},ic=new Set([o.s2k.argon2,o.s2k.iterated]);function Ki(i,e=M){switch(i){case o.s2k.argon2:return new In(e);case o.s2k.iterated:case o.s2k.gnu:case o.s2k.salted:case o.s2k.simple:return new xn(i,e);default:throw new ne("Unsupported S2K type")}}function Vs(i){let{s2kType:e}=i;if(!ic.has(e))throw Error("The provided `config.s2kType` value is not allowed");return Ki(e,i)}var Ke=Uint8Array,ze=Uint16Array,Hi=Uint32Array,ji=new Ke([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Oi=new Ke([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Bn=new Ke([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ws=function(i,e){for(var t=new ze(31),r=0;r<31;++r)t[r]=e+=1<<i[r-1];var n=new Hi(t[30]);for(r=1;r<30;++r)for(var a=t[r];a<t[r+1];++a)n[a]=a-t[r]<<5|r;return[t,n]},$s=Ws(ji,2),Qs=$s[0],Tn=$s[1];Qs[28]=258,Tn[258]=28;for(on=Ws(Oi,0),Xs=on[0],Mn=on[1],Ei=new ze(32768),oe=0;oe<32768;++oe)It=(43690&oe)>>>1|(21845&oe)<<1,It=(61680&(It=(52428&It)>>>2|(13107&It)<<2))>>>4|(3855&It)<<4,Ei[oe]=((65280&It)>>>8|(255&It)<<8)>>>1;var It,on,Xs,Mn,Ei,oe,pt=function(i,e,t){for(var r=i.length,n=0,a=new ze(e);n<r;++n)i[n]&&++a[i[n]-1];var s,c=new ze(e);for(n=0;n<e;++n)c[n]=c[n-1]+a[n-1]<<1;if(t){s=new ze(1<<e);var u=15-e;for(n=0;n<r;++n)if(i[n])for(var h=n<<4|i[n],y=e-i[n],p=c[i[n]-1]++<<y,g=p|(1<<y)-1;p<=g;++p)s[Ei[p]>>>u]=h}else for(s=new ze(r),n=0;n<r;++n)i[n]&&(s[n]=Ei[c[i[n]-1]++]>>>15-i[n]);return s},zt=new Ke(288);for(oe=0;oe<144;++oe)zt[oe]=8;for(oe=144;oe<256;++oe)zt[oe]=9;for(oe=256;oe<280;++oe)zt[oe]=7;for(oe=280;oe<288;++oe)zt[oe]=8;var Br=new Ke(32);for(oe=0;oe<32;++oe)Br[oe]=5;var nc=pt(zt,9,0),ac=pt(zt,9,1),sc=pt(Br,5,0),oc=pt(Br,5,1),cn=function(i){for(var e=i[0],t=1;t<i.length;++t)i[t]>e&&(e=i[t]);return e},Ye=function(i,e,t){var r=e/8|0;return(i[r]|i[r+1]<<8)>>(7&e)&t},un=function(i,e){var t=e/8|0;return(i[t]|i[t+1]<<8|i[t+2]<<16)>>(7&e)},Jn=function(i){return(i+7)/8|0},Sr=function(i,e,t){(e==null||e<0)&&(e=0),(t==null||t>i.length)&&(t=i.length);var r=new(i.BYTES_PER_ELEMENT==2?ze:i.BYTES_PER_ELEMENT==4?Hi:Ke)(t-e);return r.set(i.subarray(e,t)),r},cc=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Oe=function(i,e,t){var r=Error(e||cc[i]);if(r.code=i,Error.captureStackTrace&&Error.captureStackTrace(r,Oe),!t)throw r;return r},mt=function(i,e,t){t<<=7&e;var r=e/8|0;i[r]|=t,i[r+1]|=t>>>8},mr=function(i,e,t){t<<=7&e;var r=e/8|0;i[r]|=t,i[r+1]|=t>>>8,i[r+2]|=t>>>16},hn=function(i,e){for(var t=[],r=0;r<i.length;++r)i[r]&&t.push({s:r,f:i[r]});var n=t.length,a=t.slice();if(!n)return[ea,0];if(n==1){var s=new Ke(t[0].s+1);return s[t[0].s]=1,[s,1]}t.sort(function(D,B){return D.f-B.f}),t.push({s:-1,f:25001});var c=t[0],u=t[1],h=0,y=1,p=2;for(t[0]={s:-1,f:c.f+u.f,l:c,r:u};y!=n-1;)c=t[t[h].f<t[p].f?h++:p++],u=t[h!=y&&t[h].f<t[p].f?h++:p++],t[y++]={s:-1,f:c.f+u.f,l:c,r:u};var g=a[0].s;for(r=1;r<n;++r)a[r].s>g&&(g=a[r].s);var d=new ze(g+1),w=Ln(t[y-1],d,0);if(w>e){r=0;var m=0,b=w-e,v=1<<b;for(a.sort(function(D,B){return d[B.s]-d[D.s]||D.f-B.f});r<n;++r){var A=a[r].s;if(!(d[A]>e))break;m+=v-(1<<w-d[A]),d[A]=e}for(m>>>=b;m>0;){var S=a[r].s;d[S]<e?m-=1<<e-d[S]++-1:++r}for(;r>=0&&m;--r){var K=a[r].s;d[K]==e&&(--d[K],++m)}w=e}return[new Ke(d),w]},Ln=function(i,e,t){return i.s==-1?Math.max(Ln(i.l,e,t+1),Ln(i.r,e,t+1)):e[i.s]=t},_a=function(i){for(var e=i.length;e&&!i[--e];);for(var t=new ze(++e),r=0,n=i[0],a=1,s=function(u){t[r++]=u},c=1;c<=e;++c)if(i[c]==n&&c!=e)++a;else{if(!n&&a>2){for(;a>138;a-=138)s(32754);a>2&&(s(a>10?a-11<<5|28690:a-3<<5|12305),a=0)}else if(a>3){for(s(n),--a;a>6;a-=6)s(8304);a>2&&(s(a-3<<5|8208),a=0)}for(;a--;)s(n);a=1,n=i[c]}return[t.subarray(0,r),e]},wr=function(i,e){for(var t=0,r=0;r<e.length;++r)t+=i[r]*e[r];return t},Fn=function(i,e,t){var r=t.length,n=Jn(e+2);i[n]=255&r,i[n+1]=r>>>8,i[n+2]=255^i[n],i[n+3]=255^i[n+1];for(var a=0;a<r;++a)i[n+a+4]=t[a];return 8*(n+4+r)},qa=function(i,e,t,r,n,a,s,c,u,h,y){mt(e,y++,t),++n[256];for(var p=hn(n,15),g=p[0],d=p[1],w=hn(a,15),m=w[0],b=w[1],v=_a(g),A=v[0],S=v[1],K=_a(m),D=K[0],B=K[1],P=new ze(19),k=0;k<A.length;++k)P[31&A[k]]++;for(k=0;k<D.length;++k)P[31&D[k]]++;for(var U=hn(P,7),I=U[0],E=U[1],C=19;C>4&&!I[Bn[C-1]];--C);var x,H,z,j,ce=h+5<<3,ye=wr(n,zt)+wr(a,Br)+s,de=wr(n,g)+wr(a,m)+s+14+3*C+wr(P,I)+(2*P[16]+3*P[17]+7*P[18]);if(ce<=ye&&ce<=de)return Fn(e,y,i.subarray(u,u+h));if(mt(e,y,1+(de<ye)),y+=2,de<ye){x=pt(g,d,0),H=g,z=pt(m,b,0),j=m;var N=pt(I,E,0);for(mt(e,y,S-257),mt(e,y+5,B-1),mt(e,y+10,C-4),y+=14,k=0;k<C;++k)mt(e,y+3*k,I[Bn[k]]);y+=3*C;for(var Y=[A,D],O=0;O<2;++O){var q=Y[O];for(k=0;k<q.length;++k){var R=31&q[k];mt(e,y,N[R]),y+=I[R],R>15&&(mt(e,y,q[k]>>>5&127),y+=q[k]>>>12)}}}else x=nc,H=zt,z=sc,j=Br;for(k=0;k<c;++k)if(r[k]>255){R=r[k]>>>18&31,mr(e,y,x[R+257]),y+=H[R+257],R>7&&(mt(e,y,r[k]>>>23&31),y+=ji[R]);var X=31&r[k];mr(e,y,z[X]),y+=j[X],X>3&&(mr(e,y,r[k]>>>5&8191),y+=Oi[X])}else mr(e,y,x[r[k]]),y+=H[r[k]];return mr(e,y,x[256]),y+H[256]},uc=new Hi([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),ea=new Ke(0),Ys=function(i,e,t,r,n){return function(a,s,c,u,h,y){var p=a.length,g=new Ke(u+p+5*(1+Math.ceil(p/7e3))+h),d=g.subarray(u,g.length-h),w=0;if(!s||p<8)for(var m=0;m<=p;m+=65535){var b=m+65535;b>=p&&(d[w>>3]=y),w=Fn(d,w+1,a.subarray(m,b))}else{for(var v=uc[s-1],A=v>>>13,S=8191&v,K=(1<<c)-1,D=new ze(32768),B=new ze(K+1),P=Math.ceil(c/3),k=2*P,U=function(_i){return(a[_i]^a[_i+1]<<P^a[_i+2]<<k)&K},I=new Hi(25e3),E=new ze(288),C=new ze(32),x=0,H=0,z=(m=0,0),j=0,ce=0;m<p;++m){var ye=U(m),de=32767&m,N=B[ye];if(D[de]=N,B[ye]=de,j<=m){var Y=p-m;if((x>7e3||z>24576)&&Y>423){w=qa(a,d,0,I,E,C,H,z,ce,m-ce,w),z=x=H=0,ce=m;for(var O=0;O<286;++O)E[O]=0;for(O=0;O<30;++O)C[O]=0}var q=2,R=0,X=S,G=de-N&32767;if(Y>2&&ye==U(m-G))for(var J=Math.min(A,Y)-1,V=Math.min(32767,m),ee=Math.min(258,Y);G<=V&&--X&&de!=N;){if(a[m+q]==a[m+q-G]){for(var $=0;$<ee&&a[m+$]==a[m+$-G];++$);if($>q){if(q=$,R=G,$>J)break;var te=Math.min(G,$-2),ue=0;for(O=0;O<te;++O){var fe=m-G+O+32768&32767,me=fe-D[fe]+32768&32767;me>ue&&(ue=me,N=fe)}}}G+=(de=N)-(N=D[de])+32768&32767}if(R){I[z++]=268435456|Tn[q]<<18|Mn[R];var we=31&Tn[q],ra=31&Mn[R];H+=ji[we]+Oi[ra],++E[257+we],++C[ra],j=m+q,++x}else I[z++]=a[m],++E[a[m]]}}w=qa(a,d,y,I,E,C,H,z,ce,m-ce,w),!y&&7&w&&(w=Fn(d,w+1,ea))}return Sr(g,0,u+Jn(w)+h)}(i,e.level==null?6:e.level,e.mem==null?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(i.length)))):12+e.mem,t,r,!n)},Rn=function(){function i(e,t){t||typeof e!="function"||(t=e,e={}),this.ondata=t,this.o=e||{}}return i.prototype.p=function(e,t){this.ondata(Ys(e,this.o,0,0,!t),t)},i.prototype.push=function(e,t){this.ondata||Oe(5),this.d&&Oe(4),this.d=t,this.p(e,t||!1)},i}(),ri=function(){function i(e){this.s={},this.p=new Ke(0),this.ondata=e}return i.prototype.e=function(e){this.ondata||Oe(5),this.d&&Oe(4);var t=this.p.length,r=new Ke(t+e.length);r.set(this.p),r.set(e,t),this.p=r},i.prototype.c=function(e){this.d=this.s.i=e||!1;var t=this.s.b,r=function(n,a,s){var c=n.length;if(!c||s&&s.f&&!s.l)return a||new Ke(0);var u=!a||s,h=!s||s.i;s||(s={}),a||(a=new Ke(3*c));var y=function($){var te=a.length;if($>te){var ue=new Ke(Math.max(2*te,$));ue.set(a),a=ue}},p=s.f||0,g=s.p||0,d=s.b||0,w=s.l,m=s.d,b=s.m,v=s.n,A=8*c;do{if(!w){p=Ye(n,g,1);var S=Ye(n,g+1,3);if(g+=3,!S){var K=n[(z=Jn(g)+4)-4]|n[z-3]<<8,D=z+K;if(D>c){h&&Oe(0);break}u&&y(d+K),a.set(n.subarray(z,D),d),s.b=d+=K,s.p=g=8*D,s.f=p;continue}if(S==1)w=ac,m=oc,b=9,v=5;else if(S==2){var B=Ye(n,g,31)+257,P=Ye(n,g+10,15)+4,k=B+Ye(n,g+5,31)+1;g+=14;for(var U=new Ke(k),I=new Ke(19),E=0;E<P;++E)I[Bn[E]]=Ye(n,g+3*E,7);g+=3*P;var C=cn(I),x=(1<<C)-1,H=pt(I,C,1);for(E=0;E<k;){var z,j=H[Ye(n,g,x)];if(g+=15&j,(z=j>>>4)<16)U[E++]=z;else{var ce=0,ye=0;for(z==16?(ye=3+Ye(n,g,3),g+=2,ce=U[E-1]):z==17?(ye=3+Ye(n,g,7),g+=3):z==18&&(ye=11+Ye(n,g,127),g+=7);ye--;)U[E++]=ce}}var de=U.subarray(0,B),N=U.subarray(B);b=cn(de),v=cn(N),w=pt(de,b,1),m=pt(N,v,1)}else Oe(1);if(g>A){h&&Oe(0);break}}u&&y(d+131072);for(var Y=(1<<b)-1,O=(1<<v)-1,q=g;;q=g){var R=(ce=w[un(n,g)&Y])>>>4;if((g+=15&ce)>A){h&&Oe(0);break}if(ce||Oe(2),R<256)a[d++]=R;else{if(R==256){q=g,w=null;break}var X=R-254;if(R>264){var G=ji[E=R-257];X=Ye(n,g,(1<<G)-1)+Qs[E],g+=G}var J=m[un(n,g)&O],V=J>>>4;if(J||Oe(3),g+=15&J,N=Xs[V],V>3&&(G=Oi[V],N+=un(n,g)&(1<<G)-1,g+=G),g>A){h&&Oe(0);break}u&&y(d+131072);for(var ee=d+X;d<ee;d+=4)a[d]=a[d-N],a[d+1]=a[d+1-N],a[d+2]=a[d+2-N],a[d+3]=a[d+3-N];d=ee}}s.l=w,s.p=q,s.b=d,s.f=p,w&&(p=1,s.m=b,s.d=m,s.n=v)}while(!p);return d==a.length?a:Sr(a,0,d)}(this.p,this.o,this.s);this.ondata(Sr(r,t,this.s.b),this.d),this.o=Sr(r,this.s.b-32768),this.s.b=this.o.length,this.p=Sr(this.p,this.s.p/8|0),this.s.p&=7},i.prototype.push=function(e,t){this.e(e),this.c(t)},i}(),hc=function(){function i(e,t){var r,n;this.c=(r=1,n=0,{p:function(a){for(var s=r,c=n,u=0|a.length,h=0;h!=u;){for(var y=Math.min(h+2655,u);h<y;++h)c+=s+=a[h];s=(65535&s)+15*(s>>16),c=(65535&c)+15*(c>>16)}r=s,n=c},d:function(){return(255&(r%=65521))<<24|r>>>8<<16|(255&(n%=65521))<<8|n>>>8}}),this.v=1,Rn.call(this,e,t)}return i.prototype.push=function(e,t){Rn.prototype.push.call(this,e,t)},i.prototype.p=function(e,t){this.c.p(e);var r=Ys(e,this.o,this.v&&2,t&&4,!t);this.v&&(function(n,a){var s=a.level,c=s==0?0:s<6?1:s==9?3:2;n[0]=120,n[1]=c<<6|(c?32-2*c:1)}(r,this.o),this.v=0),t&&function(n,a,s){for(;s;++a)n[a]=s,s>>>=8}(r,r.length-4,this.c.d()),this.ondata(r,t)},i}(),yc=function(){function i(e){this.v=1,ri.call(this,e)}return i.prototype.push=function(e,t){if(ri.prototype.e.call(this,e),this.v){if(this.p.length<2&&!t)return;this.p=this.p.subarray(2),this.v=0}t&&(this.p.length<4&&Oe(6,"invalid zlib data"),this.p=this.p.subarray(0,-4)),ri.prototype.c.call(this,t)},i}(),lc=typeof TextDecoder<"u"&&new TextDecoder;try{lc.decode(ea,{stream:!0})}catch{}var Nt=class{static get tag(){return o.packet.literalData}constructor(e=new Date){this.format=o.literal.utf8,this.date=l.normalizeDate(e),this.text=null,this.data=null,this.filename=""}setText(e,t=o.literal.utf8){this.format=t,this.text=e,this.data=null}getText(e=!1){return(this.text===null||l.isStream(this.text))&&(this.text=l.decodeUTF8(l.nativeEOL(this.getBytes(e)))),this.text}setBytes(e,t){this.format=t,this.data=e,this.text=null}getBytes(e=!1){return this.data===null&&(this.data=l.canonicalizeEOL(l.encodeUTF8(this.text))),e?Pr(this.data):this.data}setFilename(e){this.filename=e}getFilename(){return this.filename}read(e){return f(this,null,function*(){yield Li(e,t=>f(this,null,function*(){let r=yield t.readByte(),n=yield t.readByte();this.filename=l.decodeUTF8(yield t.readBytes(n)),this.date=l.readDate(yield t.readBytes(4));let a=t.remainder();ge(a)&&(a=yield ke(a)),this.setBytes(a,r)}))})}writeHeader(){let e=l.encodeUTF8(this.filename),t=new Uint8Array([e.length]),r=new Uint8Array([this.format]),n=l.writeDate(this.date);return l.concatUint8Array([r,t,e,n])}write(){let e=this.writeHeader(),t=this.getBytes();return l.concat([e,t])}},At=class i{constructor(){this.bytes=""}read(e){return this.bytes=l.uint8ArrayToString(e.subarray(0,8)),this.bytes.length}write(){return l.stringToUint8Array(this.bytes)}toHex(){return l.uint8ArrayToHex(l.stringToUint8Array(this.bytes))}equals(e,t=!1){return t&&(e.isWildcard()||this.isWildcard())||this.bytes===e.bytes}isNull(){return this.bytes===""}isWildcard(){return/^0+$/.test(this.toHex())}static mapToHex(e){return e.toHex()}static fromID(e){let t=new i;return t.read(l.hexToUint8Array(e)),t}static wildcard(){let e=new i;return e.read(new Uint8Array(8)),e}},br=Symbol("verified"),Ga="salt@notations.openpgpjs.org",pc=new Set([o.signatureSubpacket.issuerKeyID,o.signatureSubpacket.issuerFingerprint,o.signatureSubpacket.embeddedSignature]),Se=class i{static get tag(){return o.packet.signature}constructor(){this.version=null,this.signatureType=null,this.hashAlgorithm=null,this.publicKeyAlgorithm=null,this.signatureData=null,this.unhashedSubpackets=[],this.unknownSubpackets=[],this.signedHashValue=null,this.salt=null,this.created=null,this.signatureExpirationTime=null,this.signatureNeverExpires=!0,this.exportable=null,this.trustLevel=null,this.trustAmount=null,this.regularExpression=null,this.revocable=null,this.keyExpirationTime=null,this.keyNeverExpires=null,this.preferredSymmetricAlgorithms=null,this.revocationKeyClass=null,this.revocationKeyAlgorithm=null,this.revocationKeyFingerprint=null,this.issuerKeyID=new At,this.rawNotations=[],this.notations={},this.preferredHashAlgorithms=null,this.preferredCompressionAlgorithms=null,this.keyServerPreferences=null,this.preferredKeyServer=null,this.isPrimaryUserID=null,this.policyURI=null,this.keyFlags=null,this.signersUserID=null,this.reasonForRevocationFlag=null,this.reasonForRevocationString=null,this.features=null,this.signatureTargetPublicKeyAlgorithm=null,this.signatureTargetHashAlgorithm=null,this.signatureTargetHash=null,this.embeddedSignature=null,this.issuerKeyVersion=null,this.issuerFingerprint=null,this.preferredAEADAlgorithms=null,this.preferredCipherSuites=null,this.revoked=null,this[br]=null}read(e,t=M){let r=0;if(this.version=e[r++],this.version===5&&!t.enableParsingV5Entities)throw new ne("Support for v5 entities is disabled; turn on `config.enableParsingV5Entities` if needed");if(this.version!==4&&this.version!==5&&this.version!==6)throw new ne(`Version ${this.version} of the signature packet is unsupported.`);if(this.signatureType=e[r++],this.publicKeyAlgorithm=e[r++],this.hashAlgorithm=e[r++],r+=this.readSubPackets(e.subarray(r,e.length),!0),!this.created)throw Error("Missing signature creation time subpacket.");if(this.signatureData=e.subarray(0,r),r+=this.readSubPackets(e.subarray(r,e.length),!1),this.signedHashValue=e.subarray(r,r+2),r+=2,this.version===6){let c=e[r++];this.salt=e.subarray(r,r+c),r+=c}let n=e.subarray(r,e.length),{read:a,signatureParams:s}=T.signature.parseSignatureParams(this.publicKeyAlgorithm,n);if(a<n.length)throw Error("Error reading MPIs");this.params=s}writeParams(){return this.params instanceof Promise?jt(()=>f(this,null,function*(){return T.serializeParams(this.publicKeyAlgorithm,yield this.params)})):T.serializeParams(this.publicKeyAlgorithm,this.params)}write(){let e=[];return e.push(this.signatureData),e.push(this.writeUnhashedSubPackets()),e.push(this.signedHashValue),this.version===6&&(e.push(new Uint8Array([this.salt.length])),e.push(this.salt)),e.push(this.writeParams()),l.concat(e)}sign(s,c){return f(this,arguments,function*(e,t,r=new Date,n=!1,a){this.version=e.version,this.created=l.normalizeDate(r),this.issuerKeyVersion=e.version,this.issuerFingerprint=e.getFingerprintBytes(),this.issuerKeyID=e.getKeyID();let u=[new Uint8Array([this.version,this.signatureType,this.publicKeyAlgorithm,this.hashAlgorithm])];if(this.version===6){let g=yn(this.hashAlgorithm);if(this.salt===null)this.salt=T.random.getRandomBytes(g);else if(g!==this.salt.length)throw Error("Provided salt does not have the required length")}else if(a.nonDeterministicSignaturesViaNotation){if(this.rawNotations.filter(({name:g})=>g===Ga).length!==0)throw Error("Unexpected existing salt notation");{let g=T.random.getRandomBytes(yn(this.hashAlgorithm));this.rawNotations.push({name:Ga,value:g,humanReadable:!1,critical:!1})}}u.push(this.writeHashedSubPackets()),this.unhashedSubpackets=[],this.signatureData=l.concat(u);let h=this.toHash(this.signatureType,t,n),y=yield this.hash(this.signatureType,t,h,n);this.signedHashValue=Ee(Yt(y),0,2);let p=()=>f(this,null,function*(){return T.signature.sign(this.publicKeyAlgorithm,this.hashAlgorithm,e.publicParams,e.privateParams,h,yield ke(y))});l.isStream(y)?this.params=p():(this.params=yield p(),this[br]=!0)})}writeHashedSubPackets(){let e=o.signatureSubpacket,t=[],r;if(this.created===null)throw Error("Missing signature creation time");t.push(re(e.signatureCreationTime,!0,l.writeDate(this.created))),this.signatureExpirationTime!==null&&t.push(re(e.signatureExpirationTime,!0,l.writeNumber(this.signatureExpirationTime,4))),this.exportable!==null&&t.push(re(e.exportableCertification,!0,new Uint8Array([this.exportable?1:0]))),this.trustLevel!==null&&(r=new Uint8Array([this.trustLevel,this.trustAmount]),t.push(re(e.trustSignature,!0,r))),this.regularExpression!==null&&t.push(re(e.regularExpression,!0,this.regularExpression)),this.revocable!==null&&t.push(re(e.revocable,!0,new Uint8Array([this.revocable?1:0]))),this.keyExpirationTime!==null&&t.push(re(e.keyExpirationTime,!0,l.writeNumber(this.keyExpirationTime,4))),this.preferredSymmetricAlgorithms!==null&&(r=l.stringToUint8Array(l.uint8ArrayToString(this.preferredSymmetricAlgorithms)),t.push(re(e.preferredSymmetricAlgorithms,!1,r))),this.revocationKeyClass!==null&&(r=new Uint8Array([this.revocationKeyClass,this.revocationKeyAlgorithm]),r=l.concat([r,this.revocationKeyFingerprint]),t.push(re(e.revocationKey,!1,r))),!this.issuerKeyID.isNull()&&this.issuerKeyVersion<5&&t.push(re(e.issuerKeyID,!0,this.issuerKeyID.write())),this.rawNotations.forEach(({name:s,value:c,humanReadable:u,critical:h})=>{r=[new Uint8Array([u?128:0,0,0,0])];let y=l.encodeUTF8(s);r.push(l.writeNumber(y.length,2)),r.push(l.writeNumber(c.length,2)),r.push(y),r.push(c),r=l.concat(r),t.push(re(e.notationData,h,r))}),this.preferredHashAlgorithms!==null&&(r=l.stringToUint8Array(l.uint8ArrayToString(this.preferredHashAlgorithms)),t.push(re(e.preferredHashAlgorithms,!1,r))),this.preferredCompressionAlgorithms!==null&&(r=l.stringToUint8Array(l.uint8ArrayToString(this.preferredCompressionAlgorithms)),t.push(re(e.preferredCompressionAlgorithms,!1,r))),this.keyServerPreferences!==null&&(r=l.stringToUint8Array(l.uint8ArrayToString(this.keyServerPreferences)),t.push(re(e.keyServerPreferences,!1,r))),this.preferredKeyServer!==null&&t.push(re(e.preferredKeyServer,!1,l.encodeUTF8(this.preferredKeyServer))),this.isPrimaryUserID!==null&&t.push(re(e.primaryUserID,!1,new Uint8Array([this.isPrimaryUserID?1:0]))),this.policyURI!==null&&t.push(re(e.policyURI,!1,l.encodeUTF8(this.policyURI))),this.keyFlags!==null&&(r=l.stringToUint8Array(l.uint8ArrayToString(this.keyFlags)),t.push(re(e.keyFlags,!0,r))),this.signersUserID!==null&&t.push(re(e.signersUserID,!1,l.encodeUTF8(this.signersUserID))),this.reasonForRevocationFlag!==null&&(r=l.stringToUint8Array(String.fromCharCode(this.reasonForRevocationFlag)+this.reasonForRevocationString),t.push(re(e.reasonForRevocation,!0,r))),this.features!==null&&(r=l.stringToUint8Array(l.uint8ArrayToString(this.features)),t.push(re(e.features,!1,r))),this.signatureTargetPublicKeyAlgorithm!==null&&(r=[new Uint8Array([this.signatureTargetPublicKeyAlgorithm,this.signatureTargetHashAlgorithm])],r.push(l.stringToUint8Array(this.signatureTargetHash)),r=l.concat(r),t.push(re(e.signatureTarget,!0,r))),this.embeddedSignature!==null&&t.push(re(e.embeddedSignature,!0,this.embeddedSignature.write())),this.issuerFingerprint!==null&&(r=[new Uint8Array([this.issuerKeyVersion]),this.issuerFingerprint],r=l.concat(r),t.push(re(e.issuerFingerprint,this.version>=5,r))),this.preferredAEADAlgorithms!==null&&(r=l.stringToUint8Array(l.uint8ArrayToString(this.preferredAEADAlgorithms)),t.push(re(e.preferredAEADAlgorithms,!1,r))),this.preferredCipherSuites!==null&&(r=new Uint8Array([].concat(...this.preferredCipherSuites)),t.push(re(e.preferredCipherSuites,!1,r)));let n=l.concat(t),a=l.writeNumber(n.length,this.version===6?4:2);return l.concat([a,n])}writeUnhashedSubPackets(){let e=this.unhashedSubpackets.map(({type:n,critical:a,body:s})=>re(n,a,s)),t=l.concat(e),r=l.writeNumber(t.length,this.version===6?4:2);return l.concat([r,t])}readSubPacket(e,t=!0){let r=0,n=!!(128&e[r]),a=127&e[r];if(r++,t||(this.unhashedSubpackets.push({type:a,critical:n,body:e.subarray(r,e.length)}),pc.has(a)))switch(a){case o.signatureSubpacket.signatureCreationTime:this.created=l.readDate(e.subarray(r,e.length));break;case o.signatureSubpacket.signatureExpirationTime:{let s=l.readNumber(e.subarray(r,e.length));this.signatureNeverExpires=s===0,this.signatureExpirationTime=s;break}case o.signatureSubpacket.exportableCertification:this.exportable=e[r++]===1;break;case o.signatureSubpacket.trustSignature:this.trustLevel=e[r++],this.trustAmount=e[r++];break;case o.signatureSubpacket.regularExpression:this.regularExpression=e[r];break;case o.signatureSubpacket.revocable:this.revocable=e[r++]===1;break;case o.signatureSubpacket.keyExpirationTime:{let s=l.readNumber(e.subarray(r,e.length));this.keyExpirationTime=s,this.keyNeverExpires=s===0;break}case o.signatureSubpacket.preferredSymmetricAlgorithms:this.preferredSymmetricAlgorithms=[...e.subarray(r,e.length)];break;case o.signatureSubpacket.revocationKey:this.revocationKeyClass=e[r++],this.revocationKeyAlgorithm=e[r++],this.revocationKeyFingerprint=e.subarray(r,r+20);break;case o.signatureSubpacket.issuerKeyID:if(this.version===4)this.issuerKeyID.read(e.subarray(r,e.length));else if(t)throw Error("Unexpected Issuer Key ID subpacket");break;case o.signatureSubpacket.notationData:{let s=!!(128&e[r]);r+=4;let c=l.readNumber(e.subarray(r,r+2));r+=2;let u=l.readNumber(e.subarray(r,r+2));r+=2;let h=l.decodeUTF8(e.subarray(r,r+c)),y=e.subarray(r+c,r+c+u);this.rawNotations.push({name:h,humanReadable:s,value:y,critical:n}),s&&(this.notations[h]=l.decodeUTF8(y));break}case o.signatureSubpacket.preferredHashAlgorithms:this.preferredHashAlgorithms=[...e.subarray(r,e.length)];break;case o.signatureSubpacket.preferredCompressionAlgorithms:this.preferredCompressionAlgorithms=[...e.subarray(r,e.length)];break;case o.signatureSubpacket.keyServerPreferences:this.keyServerPreferences=[...e.subarray(r,e.length)];break;case o.signatureSubpacket.preferredKeyServer:this.preferredKeyServer=l.decodeUTF8(e.subarray(r,e.length));break;case o.signatureSubpacket.primaryUserID:this.isPrimaryUserID=e[r++]!==0;break;case o.signatureSubpacket.policyURI:this.policyURI=l.decodeUTF8(e.subarray(r,e.length));break;case o.signatureSubpacket.keyFlags:this.keyFlags=[...e.subarray(r,e.length)];break;case o.signatureSubpacket.signersUserID:this.signersUserID=l.decodeUTF8(e.subarray(r,e.length));break;case o.signatureSubpacket.reasonForRevocation:this.reasonForRevocationFlag=e[r++],this.reasonForRevocationString=l.decodeUTF8(e.subarray(r,e.length));break;case o.signatureSubpacket.features:this.features=[...e.subarray(r,e.length)];break;case o.signatureSubpacket.signatureTarget:{this.signatureTargetPublicKeyAlgorithm=e[r++],this.signatureTargetHashAlgorithm=e[r++];let s=T.getHashByteLength(this.signatureTargetHashAlgorithm);this.signatureTargetHash=l.uint8ArrayToString(e.subarray(r,r+s));break}case o.signatureSubpacket.embeddedSignature:this.embeddedSignature=new i,this.embeddedSignature.read(e.subarray(r,e.length));break;case o.signatureSubpacket.issuerFingerprint:this.issuerKeyVersion=e[r++],this.issuerFingerprint=e.subarray(r,e.length),this.issuerKeyVersion>=5?this.issuerKeyID.read(this.issuerFingerprint):this.issuerKeyID.read(this.issuerFingerprint.subarray(-8));break;case o.signatureSubpacket.preferredAEADAlgorithms:this.preferredAEADAlgorithms=[...e.subarray(r,e.length)];break;case o.signatureSubpacket.preferredCipherSuites:this.preferredCipherSuites=[];for(let s=r;s<e.length;s+=2)this.preferredCipherSuites.push([e[s],e[s+1]]);break;default:this.unknownSubpackets.push({type:a,critical:n,body:e.subarray(r,e.length)})}}readSubPackets(e,t=!0,r){let n=this.version===6?4:2,a=l.readNumber(e.subarray(0,n)),s=n;for(;s<2+a;){let c=Is(e.subarray(s,e.length));s+=c.offset,this.readSubPacket(e.subarray(s,s+c.len),t,r),s+=c.len}return s}toSign(e,t){let r=o.signature;switch(e){case r.binary:return t.text!==null?l.encodeUTF8(t.getText(!0)):t.getBytes(!0);case r.text:{let n=t.getBytes(!0);return l.canonicalizeEOL(n)}case r.standalone:return new Uint8Array(0);case r.certGeneric:case r.certPersona:case r.certCasual:case r.certPositive:case r.certRevocation:{let n,a;if(t.userID)a=180,n=t.userID;else{if(!t.userAttribute)throw Error("Either a userID or userAttribute packet needs to be supplied for certification.");a=209,n=t.userAttribute}let s=n.write();return l.concat([this.toSign(r.key,t),new Uint8Array([a]),l.writeNumber(s.length,4),s])}case r.subkeyBinding:case r.subkeyRevocation:case r.keyBinding:return l.concat([this.toSign(r.key,t),this.toSign(r.key,{key:t.bind})]);case r.key:if(t.key===void 0)throw Error("Key packet is required for this signature.");return t.key.writeForHash(this.version);case r.keyRevocation:return this.toSign(r.key,t);case r.timestamp:return new Uint8Array(0);case r.thirdParty:throw Error("Not implemented");default:throw Error("Unknown signature type.")}}calculateTrailer(e,t){let r=0;return le(Yt(this.signatureData),n=>{r+=n.length},()=>{let n=[];return this.version!==5||this.signatureType!==o.signature.binary&&this.signatureType!==o.signature.text||(t?n.push(new Uint8Array(6)):n.push(e.writeHeader())),n.push(new Uint8Array([this.version,255])),this.version===5&&n.push(new Uint8Array(4)),n.push(l.writeNumber(r,4)),l.concat(n)})}toHash(e,t,r=!1){let n=this.toSign(e,t);return l.concat([this.salt||new Uint8Array,n,this.signatureData,this.calculateTrailer(t,r)])}hash(e,t,r,n=!1){return f(this,null,function*(){if(this.version===6&&this.salt.length!==yn(this.hashAlgorithm))throw Error("Signature salt does not have the expected length");return r||(r=this.toHash(e,t,n)),T.hash.digest(this.hashAlgorithm,r)})}verify(c,u,h){return f(this,arguments,function*(e,t,r,n=new Date,a=!1,s=M){if(!this.issuerKeyID.equals(e.getKeyID()))throw Error("Signature was not issued by the given public key");if(this.publicKeyAlgorithm!==e.algorithm)throw Error("Public key algorithm used to sign signature does not match issuer key algorithm.");let y=t===o.signature.binary||t===o.signature.text;if(!(this[br]&&!y)){let g,d;if(this.hashed?d=yield this.hashed:(g=this.toHash(t,r,a),d=yield this.hash(t,r,g)),d=yield ke(d),this.signedHashValue[0]!==d[0]||this.signedHashValue[1]!==d[1])throw Error("Signed digest did not match");if(this.params=yield this.params,this[br]=yield T.signature.verify(this.publicKeyAlgorithm,this.hashAlgorithm,this.params,e.publicParams,g,d),!this[br])throw Error("Signature verification failed")}let p=l.normalizeDate(n);if(p&&this.created>p)throw Error("Signature creation time is in the future");if(p&&p>=this.getExpirationTime())throw Error("Signature is expired");if(s.rejectHashAlgorithms.has(this.hashAlgorithm))throw Error("Insecure hash algorithm: "+o.read(o.hash,this.hashAlgorithm).toUpperCase());if(s.rejectMessageHashAlgorithms.has(this.hashAlgorithm)&&[o.signature.binary,o.signature.text].includes(this.signatureType))throw Error("Insecure message hash algorithm: "+o.read(o.hash,this.hashAlgorithm).toUpperCase());if(this.unknownSubpackets.forEach(({type:g,critical:d})=>{if(d)throw Error("Unknown critical signature subpacket type "+g)}),this.rawNotations.forEach(({name:g,critical:d})=>{if(d&&s.knownNotations.indexOf(g)<0)throw Error("Unknown critical notation: "+g)}),this.revocationKeyClass!==null)throw Error("This key is intended to be revoked with an authorized key, which OpenPGP.js does not support.")})}isExpired(e=new Date){let t=l.normalizeDate(e);return t!==null&&!(this.created<=t&&t<this.getExpirationTime())}getExpirationTime(){return this.signatureNeverExpires?1/0:new Date(this.created.getTime()+1e3*this.signatureExpirationTime)}};function re(i,e,t){let r=[];return r.push(zi(t.length+1)),r.push(new Uint8Array([(e?128:0)|i])),r.push(t),l.concat(r)}function yn(i){switch(i){case o.hash.sha256:return 16;case o.hash.sha384:return 24;case o.hash.sha512:return 32;case o.hash.sha224:case o.hash.sha3_256:return 16;case o.hash.sha3_512:return 32;default:throw Error("Unsupported hash function")}}var Xe=class i{static get tag(){return o.packet.onePassSignature}static fromSignaturePacket(e,t){let r=new i;return r.version=e.version===6?6:3,r.signatureType=e.signatureType,r.hashAlgorithm=e.hashAlgorithm,r.publicKeyAlgorithm=e.publicKeyAlgorithm,r.issuerKeyID=e.issuerKeyID,r.salt=e.salt,r.issuerFingerprint=e.issuerFingerprint,r.flags=t?1:0,r}constructor(){this.version=null,this.signatureType=null,this.hashAlgorithm=null,this.publicKeyAlgorithm=null,this.salt=null,this.issuerKeyID=null,this.issuerFingerprint=null,this.flags=null}read(e){let t=0;if(this.version=e[t++],this.version!==3&&this.version!==6)throw new ne(`Version ${this.version} of the one-pass signature packet is unsupported.`);if(this.signatureType=e[t++],this.hashAlgorithm=e[t++],this.publicKeyAlgorithm=e[t++],this.version===6){let r=e[t++];this.salt=e.subarray(t,t+r),t+=r,this.issuerFingerprint=e.subarray(t,t+32),t+=32,this.issuerKeyID=new At,this.issuerKeyID.read(this.issuerFingerprint)}else this.issuerKeyID=new At,this.issuerKeyID.read(e.subarray(t,t+8)),t+=8;return this.flags=e[t++],this}write(){let e=[new Uint8Array([this.version,this.signatureType,this.hashAlgorithm,this.publicKeyAlgorithm])];return this.version===6?e.push(new Uint8Array([this.salt.length]),this.salt,this.issuerFingerprint):e.push(this.issuerKeyID.write()),e.push(new Uint8Array([this.flags])),l.concatUint8Array(e)}calculateTrailer(...e){return jt(()=>f(this,null,function*(){return Se.prototype.calculateTrailer.apply(yield this.correspondingSig,e)}))}verify(){return f(this,arguments,function*(){let e=yield this.correspondingSig;if(!e||e.constructor.tag!==o.packet.signature)throw Error("Corresponding signature packet missing");if(e.signatureType!==this.signatureType||e.hashAlgorithm!==this.hashAlgorithm||e.publicKeyAlgorithm!==this.publicKeyAlgorithm||!e.issuerKeyID.equals(this.issuerKeyID)||this.version===3&&e.version===6||this.version===6&&e.version!==6||this.version===6&&!l.equalsUint8Array(e.issuerFingerprint,this.issuerFingerprint)||this.version===6&&!l.equalsUint8Array(e.salt,this.salt))throw Error("Corresponding signature packet does not match one-pass signature packet");return e.hashed=this.hashed,e.verify.apply(e,arguments)})}};function gc(i,e){if(!e[i]){let t;try{t=o.read(o.packet,i)}catch{throw new pi("Unknown packet type with tag: "+i)}throw Error("Packet not allowed in this context: "+t)}return new e[i]}Xe.prototype.hash=Se.prototype.hash,Xe.prototype.toHash=Se.prototype.toHash,Xe.prototype.toSign=Se.prototype.toSign;var ie=class i extends Array{static fromBinary(n,a){return f(this,arguments,function*(e,t,r=M){let s=new i;return yield s.read(e,t,r),s})}read(n,a){return f(this,arguments,function*(e,t,r=M){r.additionalAllowedPackets.length&&(t=be(be({},t),l.constructAllowedPackets(r.additionalAllowedPackets))),this.stream=Ht(e,(c,u)=>f(this,null,function*(){let h=Ge(u);try{for(;;)if(yield h.ready,yield Oo(c,y=>f(this,null,function*(){try{if(y.tag===o.packet.marker||y.tag===o.packet.trust||y.tag===o.packet.padding)return;let p=gc(y.tag,t);p.packets=new i,p.fromStream=l.isStream(y.packet),yield p.read(y.packet,r),yield h.write(p)}catch(p){if(p instanceof pi){if(!(y.tag<=39))return;yield h.abort(p)}let g=!r.ignoreUnsupportedPackets&&p instanceof ne,d=!(r.ignoreMalformedPackets||p instanceof ne);if(g||d||ti(y.tag))yield h.abort(p);else{let w=new xr(y.tag,y.packet);yield h.write(w)}l.printDebugError(p)}})))return yield h.ready,void(yield h.close())}catch(y){yield h.abort(y)}}));let s=Pt(this.stream);for(;;){let{done:c,value:u}=yield s.read();if(c?this.stream=null:this.push(u),c||ti(u.constructor.tag))break}s.releaseLock()})}write(){let e=[];for(let t=0;t<this.length;t++){let r=this[t]instanceof xr?this[t].tag:this[t].constructor.tag,n=this[t].write();if(l.isStream(n)&&ti(this[t].constructor.tag)){let a=[],s=0,c=512;e.push(li(r)),e.push(le(n,u=>{if(a.push(u),s+=u.length,s>=c){let h=Math.min(Math.log(s)/Math.LN2|0,30),y=2**h,p=l.concat([jo(h)].concat(a));return a=[p.subarray(1+y)],s=a[0].length,p.subarray(0,1+y)}},()=>l.concat([zi(s)].concat(a))))}else{if(l.isStream(n)){let a=0;e.push(le(Yt(n),s=>{a+=s.length},()=>Ta(r,a)))}else e.push(Ta(r,n.length));e.push(n)}}return l.concat(e)}filterByTag(...e){let t=new i,r=n=>a=>n===a;for(let n=0;n<this.length;n++)e.some(r(this[n].constructor.tag))&&t.push(this[n]);return t}findPacket(e){return this.find(t=>t.constructor.tag===e)}indexOfTag(...e){let t=[],r=this,n=a=>s=>a===s;for(let a=0;a<this.length;a++)e.some(n(r[a].constructor.tag))&&t.push(a);return t}},dc=l.constructAllowedPackets([Nt,Xe,Se]),Zt=class{static get tag(){return o.packet.compressedData}constructor(e=M){this.packets=null,this.algorithm=e.preferredCompressionAlgorithm,this.compressed=null}read(r){return f(this,arguments,function*(e,t=M){yield Li(e,n=>f(this,null,function*(){this.algorithm=yield n.readByte(),this.compressed=n.remainder(),yield this.decompress(t)}))})}write(){return this.compressed===null&&this.compress(),l.concat([new Uint8Array([this.algorithm]),this.compressed])}decompress(){return f(this,arguments,function*(e=M){let t=o.read(o.compression,this.algorithm),r=wc[t];if(!r)throw Error(t+" decompression not supported");this.packets=yield ie.fromBinary(yield r(this.compressed),dc,e)})}compress(){let e=o.read(o.compression,this.algorithm),t=mc[e];if(!t)throw Error(e+" compression not supported");this.compressed=t(this.packets.write())}};function Si(i,e){return t=>{if(!l.isStream(t)||ge(t))return jt(()=>ke(t).then(s=>new Promise((c,u)=>{let h=new e;h.ondata=y=>{c(y)};try{h.push(s,!0)}catch(y){u(y)}})));if(i)try{let s=i();return t.pipeThrough(s)}catch(s){if(s.name!=="TypeError")throw s}let r=t.getReader(),n=new e;return new ReadableStream({start(s){return f(this,null,function*(){for(n.ondata=(c,u)=>f(this,null,function*(){s.enqueue(c),u&&s.close()});;){let{done:c,value:u}=yield r.read();if(c)return void n.push(new Uint8Array,!0);u.length&&n.push(u)}})}})}}function fc(){return function(i){return f(this,null,function*(){let{decode:e}=yield import("./chunk-RWJZYWSC.js").then(function(t){return t.i});return jt(()=>f(this,null,function*(){return e(yield ke(i))}))})}}var Pi=i=>({compressor:typeof CompressionStream<"u"&&(()=>new CompressionStream(i)),decompressor:typeof DecompressionStream<"u"&&(()=>new DecompressionStream(i))}),mc={zip:Si(Pi("deflate-raw").compressor,Rn),zlib:Si(Pi("deflate").compressor,hc)},wc={uncompressed:i=>i,zip:Si(Pi("deflate-raw").decompressor,ri),zlib:Si(Pi("deflate").decompressor,yc),bzip2:fc()},bc=l.constructAllowedPackets([Nt,Zt,Xe,Se]),yr=class i{static get tag(){return o.packet.symEncryptedIntegrityProtectedData}static fromObject({version:e,aeadAlgorithm:t}){if(e!==1&&e!==2)throw Error("Unsupported SEIPD version");let r=new i;return r.version=e,e===2&&(r.aeadAlgorithm=t),r}constructor(){this.version=null,this.cipherAlgorithm=null,this.aeadAlgorithm=null,this.chunkSizeByte=null,this.salt=null,this.encrypted=null,this.packets=null}read(e){return f(this,null,function*(){yield Li(e,t=>f(this,null,function*(){if(this.version=yield t.readByte(),this.version!==1&&this.version!==2)throw new ne(`Version ${this.version} of the SEIP packet is unsupported.`);this.version===2&&(this.cipherAlgorithm=yield t.readByte(),this.aeadAlgorithm=yield t.readByte(),this.chunkSizeByte=yield t.readByte(),this.salt=yield t.readBytes(32)),this.encrypted=t.remainder()}))})}write(){return this.version===2?l.concat([new Uint8Array([this.version,this.cipherAlgorithm,this.aeadAlgorithm,this.chunkSizeByte]),this.salt,this.encrypted]):l.concat([new Uint8Array([this.version]),this.encrypted])}encrypt(n,a){return f(this,arguments,function*(e,t,r=M){let{blockSize:s,keySize:c}=T.getCipherParams(e);if(t.length!==c)throw Error("Unexpected session key size");let u=this.packets.write();if(ge(u)&&(u=yield ke(u)),this.version===2)this.cipherAlgorithm=e,this.salt=T.random.getRandomBytes(32),this.chunkSizeByte=r.aeadChunkSizeByte,this.encrypted=yield Ui(this,"encrypt",t,u);else{let h=yield T.getPrefixRandom(e),y=new Uint8Array([211,20]),p=l.concat([h,u,y]),g=yield T.hash.sha1(Pr(p)),d=l.concat([p,g]);this.encrypted=yield T.mode.cfb.encrypt(e,t,d,new Uint8Array(s),r)}return!0})}decrypt(n,a){return f(this,arguments,function*(e,t,r=M){if(t.length!==T.getCipherParams(e).keySize)throw Error("Unexpected session key size");let s,c=Yt(this.encrypted);if(ge(c)&&(c=yield ke(c)),this.version===2){if(this.cipherAlgorithm!==e)throw Error("Unexpected session key algorithm");s=yield Ui(this,"decrypt",t,c)}else{let{blockSize:u}=T.getCipherParams(e),h=yield T.mode.cfb.decrypt(e,t,c,new Uint8Array(u)),y=Ee(Pr(h),-20),p=Ee(h,0,-20),g=Promise.all([ke(yield T.hash.sha1(Pr(p))),ke(y)]).then(([w,m])=>{if(!l.equalsUint8Array(w,m))throw Error("Modification detected.");return new Uint8Array}),d=Ee(p,u+2);s=Ee(d,0,-2),s=Fe([s,jt(()=>g)]),l.isStream(c)&&r.allowUnauthenticatedStream||(s=yield ke(s))}return this.packets=yield ie.fromBinary(s,bc,r),!0})}};function Ui(i,e,t,r){return f(this,null,function*(){let n=i instanceof yr&&i.version===2,a=!n&&i.constructor.tag===o.packet.aeadEncryptedData;if(!n&&!a)throw Error("Unexpected packet type");let s=T.getAEADMode(i.aeadAlgorithm),c=e==="decrypt"?s.tagLength:0,u=e==="encrypt"?s.tagLength:0,h=2**(i.chunkSizeByte+6)+c,y=a?8:0,p=new ArrayBuffer(13+y),g=new Uint8Array(p,0,5+y),d=new Uint8Array(p),w=new DataView(p),m=new Uint8Array(p,5,8);g.set([192|i.constructor.tag,i.version,i.cipherAlgorithm,i.aeadAlgorithm,i.chunkSizeByte],0);let b,v,A=0,S=Promise.resolve(),K=0,D=0;if(n){let{keySize:P}=T.getCipherParams(i.cipherAlgorithm),{ivLength:k}=s,U=new Uint8Array(p,0,5),I=yield Ft(o.hash.sha256,t,i.salt,U,P+k);t=I.subarray(0,P),b=I.subarray(P),b.fill(0,b.length-8),v=new DataView(b.buffer,b.byteOffset,b.byteLength)}else b=i.iv;let B=yield s(i.cipherAlgorithm,t);return Ht(r,(P,k)=>f(this,null,function*(){if(l.isStream(P)!=="array"){let E=new TransformStream({},{highWaterMark:l.getHardwareConcurrency()*2**(i.chunkSizeByte+6),size:C=>C.length});Xt(E.readable,k),k=E.writable}let U=Pt(P),I=Ge(k);try{for(;;){let E=(yield U.readBytes(h+c))||new Uint8Array,C=E.subarray(E.length-c),x,H,z;if(E=E.subarray(0,E.length-c),n)z=b;else{z=b.slice();for(let j=0;j<8;j++)z[b.length-8+j]^=m[j]}if(!A||E.length?(U.unshift(C),x=B[e](E,z,g),x.catch(()=>{}),D+=E.length-c+u):(w.setInt32(5+y+4,K),x=B[e](C,z,d),x.catch(()=>{}),D+=u,H=!0),K+=E.length-c,S=S.then(()=>x).then(j=>f(this,null,function*(){yield I.ready,yield I.write(j),D-=j.length})).catch(j=>I.abort(j)),(H||D>I.desiredSize)&&(yield S),H){yield I.close();break}n?v.setInt32(b.length-4,++A):w.setInt32(9,++A)}}catch(E){yield I.ready.catch(()=>{}),yield I.abort(E)}}))})}var kc=l.constructAllowedPackets([Nt,Zt,Xe,Se]),zn=class{static get tag(){return o.packet.aeadEncryptedData}constructor(){this.version=1,this.cipherAlgorithm=null,this.aeadAlgorithm=o.aead.eax,this.chunkSizeByte=null,this.iv=null,this.encrypted=null,this.packets=null}read(e){return f(this,null,function*(){yield Li(e,t=>f(this,null,function*(){let r=yield t.readByte();if(r!==1)throw new ne(`Version ${r} of the AEAD-encrypted data packet is not supported.`);this.cipherAlgorithm=yield t.readByte(),this.aeadAlgorithm=yield t.readByte(),this.chunkSizeByte=yield t.readByte();let n=T.getAEADMode(this.aeadAlgorithm);this.iv=yield t.readBytes(n.ivLength),this.encrypted=t.remainder()}))})}write(){return l.concat([new Uint8Array([this.version,this.cipherAlgorithm,this.aeadAlgorithm,this.chunkSizeByte]),this.iv,this.encrypted])}decrypt(n,a){return f(this,arguments,function*(e,t,r=M){this.packets=yield ie.fromBinary(yield Ui(this,"decrypt",t,Yt(this.encrypted)),kc,r)})}encrypt(n,a){return f(this,arguments,function*(e,t,r=M){this.cipherAlgorithm=e;let{ivLength:s}=T.getAEADMode(this.aeadAlgorithm);this.iv=T.random.getRandomBytes(s),this.chunkSizeByte=r.aeadChunkSizeByte;let c=this.packets.write();this.encrypted=yield Ui(this,"encrypt",t,c)})}},Tr=class i{static get tag(){return o.packet.publicKeyEncryptedSessionKey}constructor(){this.version=null,this.publicKeyID=new At,this.publicKeyVersion=null,this.publicKeyFingerprint=null,this.publicKeyAlgorithm=null,this.sessionKey=null,this.sessionKeyAlgorithm=null,this.encrypted={}}static fromObject({version:e,encryptionKeyPacket:t,anonymousRecipient:r,sessionKey:n,sessionKeyAlgorithm:a}){let s=new i;if(e!==3&&e!==6)throw Error("Unsupported PKESK version");return s.version=e,e===6&&(s.publicKeyVersion=r?null:t.version,s.publicKeyFingerprint=r?null:t.getFingerprintBytes()),s.publicKeyID=r?At.wildcard():t.getKeyID(),s.publicKeyAlgorithm=t.algorithm,s.sessionKey=n,s.sessionKeyAlgorithm=a,s}read(e){let t=0;if(this.version=e[t++],this.version!==3&&this.version!==6)throw new ne(`Version ${this.version} of the PKESK packet is unsupported.`);if(this.version===6){let r=e[t++];if(r){this.publicKeyVersion=e[t++];let n=r-1;this.publicKeyFingerprint=e.subarray(t,t+n),t+=n,this.publicKeyVersion>=5?this.publicKeyID.read(this.publicKeyFingerprint):this.publicKeyID.read(this.publicKeyFingerprint.subarray(-8))}else this.publicKeyID=At.wildcard()}else t+=this.publicKeyID.read(e.subarray(t,t+8));if(this.publicKeyAlgorithm=e[t++],this.encrypted=T.parseEncSessionKeyParams(this.publicKeyAlgorithm,e.subarray(t)),this.publicKeyAlgorithm===o.publicKey.x25519||this.publicKeyAlgorithm===o.publicKey.x448){if(this.version===3)this.sessionKeyAlgorithm=o.write(o.symmetric,this.encrypted.C.algorithm);else if(this.encrypted.C.algorithm!==null)throw Error("Unexpected cleartext symmetric algorithm")}}write(){let e=[new Uint8Array([this.version])];return this.version===6?this.publicKeyFingerprint!==null?(e.push(new Uint8Array([this.publicKeyFingerprint.length+1,this.publicKeyVersion])),e.push(this.publicKeyFingerprint)):e.push(new Uint8Array([0])):e.push(this.publicKeyID.write()),e.push(new Uint8Array([this.publicKeyAlgorithm]),T.serializeParams(this.publicKeyAlgorithm,this.encrypted)),l.concatUint8Array(e)}encrypt(e){return f(this,null,function*(){let t=o.write(o.publicKey,this.publicKeyAlgorithm),r=this.version===3?this.sessionKeyAlgorithm:null,n=e.version===5?e.getFingerprintBytes().subarray(0,20):e.getFingerprintBytes(),a=Va(this.version,t,r,this.sessionKey);this.encrypted=yield T.publicKeyEncrypt(t,r,e.publicParams,a,n)})}decrypt(e,t){return f(this,null,function*(){if(this.publicKeyAlgorithm!==e.algorithm)throw Error("Decryption error");let r=t?Va(this.version,this.publicKeyAlgorithm,t.sessionKeyAlgorithm,t.sessionKey):null,n=e.version===5?e.getFingerprintBytes().subarray(0,20):e.getFingerprintBytes(),a=yield T.publicKeyDecrypt(this.publicKeyAlgorithm,e.publicParams,e.privateParams,this.encrypted,n,r),{sessionKey:s,sessionKeyAlgorithm:c}=function(u,h,y,p){switch(h){case o.publicKey.rsaEncrypt:case o.publicKey.rsaEncryptSign:case o.publicKey.elgamal:case o.publicKey.ecdh:{let g=y.subarray(0,y.length-2),d=y.subarray(y.length-2),w=l.writeChecksum(g.subarray(g.length%8)),m=w[0]===d[0]&w[1]===d[1],b=u===6?{sessionKeyAlgorithm:null,sessionKey:g}:{sessionKeyAlgorithm:g[0],sessionKey:g.subarray(1)};if(p){let v=m&b.sessionKeyAlgorithm===p.sessionKeyAlgorithm&b.sessionKey.length===p.sessionKey.length;return{sessionKey:l.selectUint8Array(v,b.sessionKey,p.sessionKey),sessionKeyAlgorithm:u===6?null:l.selectUint8(v,b.sessionKeyAlgorithm,p.sessionKeyAlgorithm)}}if(m&&(u===6||o.read(o.symmetric,b.sessionKeyAlgorithm)))return b;throw Error("Decryption error")}case o.publicKey.x25519:case o.publicKey.x448:return{sessionKeyAlgorithm:null,sessionKey:y};default:throw Error("Unsupported public key algorithm")}}(this.version,this.publicKeyAlgorithm,a,t);if(this.version===3){let u=this.publicKeyAlgorithm!==o.publicKey.x25519&&this.publicKeyAlgorithm!==o.publicKey.x448;if(this.sessionKeyAlgorithm=u?c:this.sessionKeyAlgorithm,s.length!==T.getCipherParams(this.sessionKeyAlgorithm).keySize)throw Error("Unexpected session key size")}this.sessionKey=s})}};function Va(i,e,t,r){switch(e){case o.publicKey.rsaEncrypt:case o.publicKey.rsaEncryptSign:case o.publicKey.elgamal:case o.publicKey.ecdh:return l.concatUint8Array([new Uint8Array(i===6?[]:[t]),r,l.writeChecksum(r.subarray(r.length%8))]);case o.publicKey.x25519:case o.publicKey.x448:return r;default:throw Error("Unsupported public key algorithm")}}var Mr=class i{static get tag(){return o.packet.symEncryptedSessionKey}constructor(e=M){this.version=e.aeadProtect?6:4,this.sessionKey=null,this.sessionKeyEncryptionAlgorithm=null,this.sessionKeyAlgorithm=null,this.aeadAlgorithm=o.write(o.aead,e.preferredAEADAlgorithm),this.encrypted=null,this.s2k=null,this.iv=null}read(e){let t=0;if(this.version=e[t++],this.version!==4&&this.version!==5&&this.version!==6)throw new ne(`Version ${this.version} of the SKESK packet is unsupported.`);this.version===6&&t++;let r=e[t++];this.version>=5&&(this.aeadAlgorithm=e[t++],this.version===6&&t++);let n=e[t++];if(this.s2k=Ki(n),t+=this.s2k.read(e.subarray(t,e.length)),this.version>=5){let a=T.getAEADMode(this.aeadAlgorithm);this.iv=e.subarray(t,t+=a.ivLength)}this.version>=5||t<e.length?(this.encrypted=e.subarray(t,e.length),this.sessionKeyEncryptionAlgorithm=r):this.sessionKeyAlgorithm=r}write(){let e=this.encrypted===null?this.sessionKeyAlgorithm:this.sessionKeyEncryptionAlgorithm,t,r=this.s2k.write();if(this.version===6){let n=r.length,a=3+n+this.iv.length;t=l.concatUint8Array([new Uint8Array([this.version,a,e,this.aeadAlgorithm,n]),r,this.iv,this.encrypted])}else this.version===5?t=l.concatUint8Array([new Uint8Array([this.version,e,this.aeadAlgorithm]),r,this.iv,this.encrypted]):(t=l.concatUint8Array([new Uint8Array([this.version,e]),r]),this.encrypted!==null&&(t=l.concatUint8Array([t,this.encrypted])));return t}decrypt(e){return f(this,null,function*(){let t=this.sessionKeyEncryptionAlgorithm!==null?this.sessionKeyEncryptionAlgorithm:this.sessionKeyAlgorithm,{blockSize:r,keySize:n}=T.getCipherParams(t),a=yield this.s2k.produceKey(e,n);if(this.version>=5){let s=T.getAEADMode(this.aeadAlgorithm),c=new Uint8Array([192|i.tag,this.version,this.sessionKeyEncryptionAlgorithm,this.aeadAlgorithm]),u=this.version===6?yield Ft(o.hash.sha256,a,new Uint8Array,c,n):a,h=yield s(t,u);this.sessionKey=yield h.decrypt(this.encrypted,this.iv,c)}else if(this.encrypted!==null){let s=yield T.mode.cfb.decrypt(t,a,this.encrypted,new Uint8Array(r));if(this.sessionKeyAlgorithm=o.write(o.symmetric,s[0]),this.sessionKey=s.subarray(1,s.length),this.sessionKey.length!==T.getCipherParams(this.sessionKeyAlgorithm).keySize)throw Error("Unexpected session key size")}else this.sessionKey=a})}encrypt(r){return f(this,arguments,function*(e,t=M){let n=this.sessionKeyEncryptionAlgorithm!==null?this.sessionKeyEncryptionAlgorithm:this.sessionKeyAlgorithm;this.sessionKeyEncryptionAlgorithm=n,this.s2k=Vs(t),this.s2k.generateSalt();let{blockSize:a,keySize:s}=T.getCipherParams(n),c=yield this.s2k.produceKey(e,s);if(this.sessionKey===null&&(this.sessionKey=T.generateSessionKey(this.sessionKeyAlgorithm)),this.version>=5){let u=T.getAEADMode(this.aeadAlgorithm);this.iv=T.random.getRandomBytes(u.ivLength);let h=new Uint8Array([192|i.tag,this.version,this.sessionKeyEncryptionAlgorithm,this.aeadAlgorithm]),y=this.version===6?yield Ft(o.hash.sha256,c,new Uint8Array,h,s):c,p=yield u(n,y);this.encrypted=yield p.encrypt(this.sessionKey,this.iv,h)}else{let u=l.concatUint8Array([new Uint8Array([this.sessionKeyAlgorithm]),this.sessionKey]);this.encrypted=yield T.mode.cfb.encrypt(n,c,u,new Uint8Array(a),t)}})}},yt=class i{static get tag(){return o.packet.publicKey}constructor(e=new Date,t=M){this.version=t.v6Keys?6:4,this.created=l.normalizeDate(e),this.algorithm=null,this.publicParams=null,this.expirationTimeV3=0,this.fingerprint=null,this.keyID=null}static fromSecretKeyPacket(e){let t=new i,{version:r,created:n,algorithm:a,publicParams:s,keyID:c,fingerprint:u}=e;return t.version=r,t.created=n,t.algorithm=a,t.publicParams=s,t.keyID=c,t.fingerprint=u,t}read(r){return f(this,arguments,function*(e,t=M){let n=0;if(this.version=e[n++],this.version===5&&!t.enableParsingV5Entities)throw new ne("Support for parsing v5 entities is disabled; turn on `config.enableParsingV5Entities` if needed");if(this.version===4||this.version===5||this.version===6){this.created=l.readDate(e.subarray(n,n+4)),n+=4,this.algorithm=e[n++],this.version>=5&&(n+=4);let{read:a,publicParams:s}=T.parsePublicKeyParams(this.algorithm,e.subarray(n));if(this.version===6&&s.oid&&(s.oid.getName()===o.curve.curve25519Legacy||s.oid.getName()===o.curve.ed25519Legacy))throw Error("Legacy curve25519 cannot be used with v6 keys");return this.publicParams=s,n+=a,yield this.computeFingerprintAndKeyID(),n}throw new ne(`Version ${this.version} of the key packet is unsupported.`)})}write(){let e=[];e.push(new Uint8Array([this.version])),e.push(l.writeDate(this.created)),e.push(new Uint8Array([this.algorithm]));let t=T.serializeParams(this.algorithm,this.publicParams);return this.version>=5&&e.push(l.writeNumber(t.length,4)),e.push(t),l.concatUint8Array(e)}writeForHash(e){let t=this.writePublicKey(),r=149+e,n=e>=5?4:2;return l.concatUint8Array([new Uint8Array([r]),l.writeNumber(t.length,n),t])}isDecrypted(){return null}getCreationTime(){return this.created}getKeyID(){return this.keyID}computeFingerprintAndKeyID(){return f(this,null,function*(){if(yield this.computeFingerprint(),this.keyID=new At,this.version>=5)this.keyID.read(this.fingerprint.subarray(0,8));else{if(this.version!==4)throw Error("Unsupported key version");this.keyID.read(this.fingerprint.subarray(12,20))}})}computeFingerprint(){return f(this,null,function*(){let e=this.writeForHash(this.version);if(this.version>=5)this.fingerprint=yield T.hash.sha256(e);else{if(this.version!==4)throw Error("Unsupported key version");this.fingerprint=yield T.hash.sha1(e)}})}getFingerprintBytes(){return this.fingerprint}getFingerprint(){return l.uint8ArrayToHex(this.getFingerprintBytes())}hasSameFingerprintAs(e){return this.version===e.version&&l.equalsUint8Array(this.writePublicKey(),e.writePublicKey())}getAlgorithmInfo(){let e={};e.algorithm=o.read(o.publicKey,this.algorithm);let t=this.publicParams.n||this.publicParams.p;return t?e.bits=l.uint8ArrayBitLength(t):this.publicParams.oid&&(e.curve=this.publicParams.oid.getName()),e}};yt.prototype.readPublicKey=yt.prototype.read,yt.prototype.writePublicKey=yt.prototype.write;var vc=l.constructAllowedPackets([Nt,Zt,Xe,Se]),Nn=class{static get tag(){return o.packet.symmetricallyEncryptedData}constructor(){this.encrypted=null,this.packets=null}read(e){this.encrypted=e}write(){return this.encrypted}decrypt(n,a){return f(this,arguments,function*(e,t,r=M){if(!r.allowUnauthenticatedMessages)throw Error("Message is not authenticated.");let{blockSize:s}=T.getCipherParams(e),c=yield ke(Yt(this.encrypted)),u=yield T.mode.cfb.decrypt(e,t,c.subarray(s+2),c.subarray(2,s+2));this.packets=yield ie.fromBinary(u,vc,r)})}encrypt(n,a){return f(this,arguments,function*(e,t,r=M){let s=this.packets.write(),{blockSize:c}=T.getCipherParams(e),u=yield T.getPrefixRandom(e),h=yield T.mode.cfb.encrypt(e,t,u,new Uint8Array(c),r),y=yield T.mode.cfb.encrypt(e,t,s,h.subarray(2),r);this.encrypted=l.concat([h,y])})}};var Di=class i extends yt{static get tag(){return o.packet.publicSubkey}constructor(e,t){super(e,t)}static fromSecretSubkeyPacket(e){let t=new i,{version:r,created:n,algorithm:a,publicParams:s,keyID:c,fingerprint:u}=e;return t.version=r,t.created=n,t.algorithm=a,t.publicParams=s,t.keyID=c,t.fingerprint=u,t}},Hn=class i{static get tag(){return o.packet.userAttribute}constructor(){this.attributes=[]}read(e){let t=0;for(;t<e.length;){let r=Is(e.subarray(t,e.length));t+=r.offset,this.attributes.push(l.uint8ArrayToString(e.subarray(t,t+r.len))),t+=r.len}}write(){let e=[];for(let t=0;t<this.attributes.length;t++)e.push(zi(this.attributes[t].length)),e.push(l.stringToUint8Array(this.attributes[t]));return l.concatUint8Array(e)}equals(e){return!!(e&&e instanceof i)&&this.attributes.every(function(t,r){return t===e.attributes[r]})}},Lr=class extends yt{static get tag(){return o.packet.secretKey}constructor(e=new Date,t=M){super(e,t),this.keyMaterial=null,this.isEncrypted=null,this.s2kUsage=0,this.s2k=null,this.symmetric=null,this.aead=null,this.isLegacyAEAD=null,this.privateParams=null,this.usedModernAEAD=null}read(r){return f(this,arguments,function*(e,t=M){let n=yield this.readPublicKey(e,t),a=n;this.s2kUsage=e[n++],this.version===5&&n++,this.version===6&&this.s2kUsage&&n++;try{if(this.s2kUsage===255||this.s2kUsage===254||this.s2kUsage===253){this.symmetric=e[n++],this.s2kUsage===253&&(this.aead=e[n++]),this.version===6&&n++;let s=e[n++];if(this.s2k=Ki(s),n+=this.s2k.read(e.subarray(n,e.length)),this.s2k.type==="gnu-dummy")return}else this.s2kUsage&&(this.symmetric=this.s2kUsage);this.s2kUsage&&(this.isLegacyAEAD=this.s2kUsage===253&&(this.version===5||this.version===4&&t.parseAEADEncryptedV4KeysAsLegacy),this.s2kUsage!==253||this.isLegacyAEAD?(this.iv=e.subarray(n,n+T.getCipherParams(this.symmetric).blockSize),this.usedModernAEAD=!1):(this.iv=e.subarray(n,n+T.getAEADMode(this.aead).ivLength),this.usedModernAEAD=!0),n+=this.iv.length)}catch(s){if(!this.s2kUsage)throw s;this.unparseableKeyMaterial=e.subarray(a),this.isEncrypted=!0}if(this.version===5&&(n+=4),this.keyMaterial=e.subarray(n),this.isEncrypted=!!this.s2kUsage,!this.isEncrypted){let s;if(this.version===6)s=this.keyMaterial;else if(s=this.keyMaterial.subarray(0,-2),!l.equalsUint8Array(l.writeChecksum(s),this.keyMaterial.subarray(-2)))throw Error("Key checksum mismatch");try{let{read:c,privateParams:u}=T.parsePrivateKeyParams(this.algorithm,s,this.publicParams);if(c<s.length)throw Error("Error reading MPIs");this.privateParams=u}catch(c){throw c instanceof ne?c:Error("Error reading MPIs")}}})}write(){let e=this.writePublicKey();if(this.unparseableKeyMaterial)return l.concatUint8Array([e,this.unparseableKeyMaterial]);let t=[e];t.push(new Uint8Array([this.s2kUsage]));let r=[];if(this.s2kUsage===255||this.s2kUsage===254||this.s2kUsage===253){r.push(this.symmetric),this.s2kUsage===253&&r.push(this.aead);let n=this.s2k.write();this.version===6&&r.push(n.length),r.push(...n)}return this.s2kUsage&&this.s2k.type!=="gnu-dummy"&&r.push(...this.iv),(this.version===5||this.version===6&&this.s2kUsage)&&t.push(new Uint8Array([r.length])),t.push(new Uint8Array(r)),this.isDummy()||(this.s2kUsage||(this.keyMaterial=T.serializeParams(this.algorithm,this.privateParams)),this.version===5&&t.push(l.writeNumber(this.keyMaterial.length,4)),t.push(this.keyMaterial),this.s2kUsage||this.version===6||t.push(l.writeChecksum(this.keyMaterial))),l.concatUint8Array(t)}isDecrypted(){return this.isEncrypted===!1}isMissingSecretKeyMaterial(){return this.unparseableKeyMaterial!==void 0||this.isDummy()}isDummy(){return!(!this.s2k||this.s2k.type!=="gnu-dummy")}makeDummy(e=M){this.isDummy()||(this.isDecrypted()&&this.clearPrivateParams(),delete this.unparseableKeyMaterial,this.isEncrypted=null,this.keyMaterial=null,this.s2k=Ki(o.s2k.gnu,e),this.s2k.algorithm=0,this.s2k.c=0,this.s2k.type="gnu-dummy",this.s2kUsage=254,this.symmetric=o.symmetric.aes256,this.isLegacyAEAD=null,this.usedModernAEAD=null)}encrypt(r){return f(this,arguments,function*(e,t=M){if(this.isDummy())return;if(!this.isDecrypted())throw Error("Key packet is already encrypted");if(!e)throw Error("A non-empty passphrase is required for key encryption.");this.s2k=Vs(t),this.s2k.generateSalt();let n=T.serializeParams(this.algorithm,this.privateParams);this.symmetric=o.symmetric.aes256;let{blockSize:a}=T.getCipherParams(this.symmetric);if(t.aeadProtect){this.s2kUsage=253,this.aead=t.preferredAEADAlgorithm;let s=T.getAEADMode(this.aead);this.isLegacyAEAD=this.version===5,this.usedModernAEAD=!this.isLegacyAEAD;let c=li(this.constructor.tag),u=yield ln(this.version,this.s2k,e,this.symmetric,this.aead,c,this.isLegacyAEAD),h=yield s(this.symmetric,u);this.iv=this.isLegacyAEAD?T.random.getRandomBytes(a):T.random.getRandomBytes(s.ivLength);let y=this.isLegacyAEAD?new Uint8Array:l.concatUint8Array([c,this.writePublicKey()]);this.keyMaterial=yield h.encrypt(n,this.iv.subarray(0,s.ivLength),y)}else{this.s2kUsage=254,this.usedModernAEAD=!1;let s=yield ln(this.version,this.s2k,e,this.symmetric);this.iv=T.random.getRandomBytes(a),this.keyMaterial=yield T.mode.cfb.encrypt(this.symmetric,s,l.concatUint8Array([n,yield T.hash.sha1(n,t)]),this.iv,t)}})}decrypt(e){return f(this,null,function*(){if(this.isDummy())return!1;if(this.unparseableKeyMaterial)throw Error("Key packet cannot be decrypted: unsupported S2K or cipher algo");if(this.isDecrypted())throw Error("Key packet is already decrypted.");let t,r=li(this.constructor.tag);if(this.s2kUsage!==254&&this.s2kUsage!==253)throw this.s2kUsage===255?Error("Encrypted private key is authenticated using an insecure two-byte hash"):Error("Private key is encrypted using an insecure S2K function: unsalted MD5");let n;if(t=yield ln(this.version,this.s2k,e,this.symmetric,this.aead,r,this.isLegacyAEAD),this.s2kUsage===253){let a=T.getAEADMode(this.aead),s=yield a(this.symmetric,t);try{let c=this.isLegacyAEAD?new Uint8Array:l.concatUint8Array([r,this.writePublicKey()]);n=yield s.decrypt(this.keyMaterial,this.iv.subarray(0,a.ivLength),c)}catch(c){throw c.message==="Authentication tag mismatch"?Error("Incorrect key passphrase: "+c.message):c}}else{let a=yield T.mode.cfb.decrypt(this.symmetric,t,this.keyMaterial,this.iv);n=a.subarray(0,-20);let s=yield T.hash.sha1(n);if(!l.equalsUint8Array(s,a.subarray(-20)))throw Error("Incorrect key passphrase")}try{let{privateParams:a}=T.parsePrivateKeyParams(this.algorithm,n,this.publicParams);this.privateParams=a}catch{throw Error("Error reading MPIs")}this.isEncrypted=!1,this.keyMaterial=null,this.s2kUsage=0,this.aead=null,this.symmetric=null,this.isLegacyAEAD=null})}validate(){return f(this,null,function*(){if(this.isDummy())return;if(!this.isDecrypted())throw Error("Key is not decrypted");if(this.usedModernAEAD)return;let e;try{e=yield T.validateParams(this.algorithm,this.publicParams,this.privateParams)}catch{e=!1}if(!e)throw Error("Key is invalid")})}generate(e,t){return f(this,null,function*(){if(this.version===6&&(this.algorithm===o.publicKey.ecdh&&t===o.curve.curve25519Legacy||this.algorithm===o.publicKey.eddsaLegacy))throw Error(`Cannot generate v6 keys of type 'ecc' with curve ${t}. Generate a key of type 'curve25519' instead`);let{privateParams:r,publicParams:n}=yield T.generateParams(this.algorithm,e,t);this.privateParams=r,this.publicParams=n,this.isEncrypted=!1})}clearPrivateParams(){this.isMissingSecretKeyMaterial()||(Object.keys(this.privateParams).forEach(e=>{this.privateParams[e].fill(0),delete this.privateParams[e]}),this.privateParams=null,this.isEncrypted=!0)}};function ln(i,e,t,r,n,a,s){return f(this,null,function*(){if(e.type==="argon2"&&!n)throw Error("Using Argon2 S2K without AEAD is not allowed");if(e.type==="simple"&&i===6)throw Error("Using Simple S2K with version 6 keys is not allowed");let{keySize:c}=T.getCipherParams(r),u=yield e.produceKey(t,c);if(!n||i===5||s)return u;let h=l.concatUint8Array([a,new Uint8Array([i,r,n])]);return Ft(o.hash.sha256,u,new Uint8Array,h,c)})}var Ci=class i{static get tag(){return o.packet.userID}constructor(){this.userID="",this.name="",this.email="",this.comment=""}static fromObject(e){if(l.isString(e)||e.name&&!l.isString(e.name)||e.email&&!l.isEmailAddress(e.email)||e.comment&&!l.isString(e.comment))throw Error("Invalid user ID format");let t=new i;Object.assign(t,e);let r=[];return t.name&&r.push(t.name),t.comment&&r.push(`(${t.comment})`),t.email&&r.push(`<${t.email}>`),t.userID=r.join(" "),t}read(e,t=M){let r=l.decodeUTF8(e);if(r.length>t.maxUserIDLength)throw Error("User ID string is too long");let n=/^(?<name>[^()]+\s+)?(?<comment>\([^()]+\)\s+)?(?<email><\S+@\S+>)$/.exec(r);if(n!==null){let{name:a,comment:s,email:c}=n.groups;this.comment=s?.replace(/^\(|\)|\s$/g,"").trim()||"",this.name=a?.trim()||"",this.email=c.substring(1,c.length-1)}else/^[^\s@]+@[^\s@]+$/.test(r)&&(this.email=r);this.userID=r}write(){return l.encodeUTF8(this.userID)}equals(e){return e&&e.userID===this.userID}},Ii=class extends Lr{static get tag(){return o.packet.secretSubkey}constructor(e=new Date,t=M){super(e,t)}};var xi=class{constructor(e){this.packets=e||new ie}write(){return this.packets.write()}armor(e=M){let t=this.packets.some(r=>r.constructor.tag===Se.tag&&r.version!==6);return jr(o.armor.signature,this.write(),void 0,void 0,void 0,t,e)}getSigningKeyIDs(){return this.packets.map(e=>e.issuerKeyID)}};function Zs(i,e){return f(this,null,function*(){let t=new Ii(i.date,e);return t.packets=null,t.algorithm=o.write(o.publicKey,i.algorithm),yield t.generate(i.rsaBits,i.curve),yield t.computeFingerprintAndKeyID(),t})}function Ac(i,e){return f(this,null,function*(){let t=new Lr(i.date,e);return t.packets=null,t.algorithm=o.write(o.publicKey,i.algorithm),yield t.generate(i.rsaBits,i.curve,i.config),yield t.computeFingerprintAndKeyID(),t})}function Ze(s,c,u,h){return f(this,arguments,function*(i,e,t,r,n=new Date,a){let y,p;for(let g=i.length-1;g>=0;g--)try{(!y||i[g].created>=y.created)&&(yield i[g].verify(e,t,r,n,void 0,a),y=i[g])}catch(d){p=d}if(!y)throw l.wrapError(`Could not find valid ${o.read(o.signature,t)} signature in key ${e.getKeyID().toHex()}`.replace("certGeneric ","self-").replace(/([a-z])([A-Z])/g,(g,d,w)=>d+" "+w.toLowerCase()),p);return y})}function jn(i,e,t=new Date){let r=l.normalizeDate(t);if(r!==null){let n=Bi(i,e);return!(i.created<=r&&r<n)}return!1}function Js(i,e,t,r){return f(this,null,function*(){let n={};n.key=e,n.bind=i;let a={signatureType:o.signature.subkeyBinding};return t.sign?(a.keyFlags=[o.keyFlags.signData],a.embeddedSignature=yield gt(n,[],i,{signatureType:o.signature.keyBinding},t.date,void 0,void 0,void 0,r)):a.keyFlags=[o.keyFlags.encryptCommunication|o.keyFlags.encryptStorage],t.keyExpirationTime>0&&(a.keyExpirationTime=t.keyExpirationTime,a.keyNeverExpires=!1),yield gt(n,[],e,a,t.date,void 0,void 0,void 0,r)})}function gt(h,y,p,g,d,w){return f(this,arguments,function*(i,e,t,r,n,a,s=[],c=!1,u){if(t.isDummy())throw Error("Cannot sign with a gnu-dummy key.");if(!t.isDecrypted())throw Error("Signing key is not decrypted.");let m=new Se;return Object.assign(m,r),m.publicKeyAlgorithm=t.algorithm,m.hashAlgorithm=yield function(D,B){return f(this,arguments,function*(b,v,A=new Date,S=[],K){let P=o.hash.sha256,k=K.preferredHashAlgorithm,U=yield Promise.all(b.map((x,H)=>f(this,null,function*(){return(yield x.getPrimarySelfSignature(A,S[H],K)).preferredHashAlgorithms}))),I=new Map;for(let x of U)for(let H of x)try{let z=o.write(o.hash,H);I.set(z,I.has(z)?I.get(z)+1:1)}catch{}let E=x=>b.length===0||I.get(x)===b.length||x===P,C=()=>{if(I.size===0)return P;let x=Array.from(I.keys()).filter(H=>E(H)).sort((H,z)=>T.hash.getHashByteLength(H)-T.hash.getHashByteLength(z))[0];return T.hash.getHashByteLength(x)>=T.hash.getHashByteLength(P)?x:P};if(new Set([o.publicKey.ecdsa,o.publicKey.eddsaLegacy,o.publicKey.ed25519,o.publicKey.ed448]).has(v.algorithm)){let x=T.getPreferredCurveHashAlgo(v.algorithm,v.publicParams.oid),H=E(k),z=T.hash.getHashByteLength(k)>=T.hash.getHashByteLength(x);if(H&&z)return k;{let j=C();return T.hash.getHashByteLength(j)>=T.hash.getHashByteLength(x)?j:x}}return E(k)?k:C()})}(e,t,n,a,u),m.rawNotations=[...s],yield m.sign(t,i,n,c,u),m})}function Qt(a,s,c){return f(this,arguments,function*(i,e,t,r=new Date,n){(i=i[t])&&(e[t].length?yield Promise.all(i.map(function(u){return f(this,null,function*(){u.isExpired(r)||n&&!(yield n(u))||e[t].some(function(h){return l.equalsUint8Array(h.writeParams(),u.writeParams())})||e[t].push(u)})})):e[t]=i)})}function lr(u,h,y,p,g,d){return f(this,arguments,function*(i,e,t,r,n,a,s=new Date,c){a=a||i;let w=[];return yield Promise.all(r.map(function(m){return f(this,null,function*(){try{if(!n||m.issuerKeyID.equals(n.issuerKeyID)){let b=![o.reasonForRevocation.keyRetired,o.reasonForRevocation.keySuperseded,o.reasonForRevocation.userIDInvalid].includes(m.reasonForRevocationFlag);yield m.verify(a,e,t,b?null:s,!1,c),w.push(m.issuerKeyID)}}catch{}})})),n?(n.revoked=!!w.some(m=>m.equals(n.issuerKeyID))||n.revoked||!1,n.revoked):w.length>0})}function Bi(i,e){let t;return e.keyNeverExpires===!1&&(t=i.created.getTime()+1e3*e.keyExpirationTime),t?new Date(t):1/0}function On(i,e={}){switch(i.type=i.type||e.type,i.curve=i.curve||e.curve,i.rsaBits=i.rsaBits||e.rsaBits,i.keyExpirationTime=i.keyExpirationTime!==void 0?i.keyExpirationTime:e.keyExpirationTime,i.passphrase=l.isString(i.passphrase)?i.passphrase:e.passphrase,i.date=i.date||e.date,i.sign=i.sign||!1,i.type){case"ecc":try{i.curve=o.write(o.curve,i.curve)}catch{throw Error("Unknown curve")}i.curve!==o.curve.ed25519Legacy&&i.curve!==o.curve.curve25519Legacy&&i.curve!=="ed25519"&&i.curve!=="curve25519"||(i.curve=i.sign?o.curve.ed25519Legacy:o.curve.curve25519Legacy),i.sign?i.algorithm=i.curve===o.curve.ed25519Legacy?o.publicKey.eddsaLegacy:o.publicKey.ecdsa:i.algorithm=o.publicKey.ecdh;break;case"curve25519":i.algorithm=i.sign?o.publicKey.ed25519:o.publicKey.x25519;break;case"curve448":i.algorithm=i.sign?o.publicKey.ed448:o.publicKey.x448;break;case"rsa":i.algorithm=o.publicKey.rsaEncryptSign;break;default:throw Error("Unsupported key type "+i.type)}return i}function Wa(i,e,t){switch(i.algorithm){case o.publicKey.rsaEncryptSign:case o.publicKey.rsaSign:case o.publicKey.dsa:case o.publicKey.ecdsa:case o.publicKey.eddsaLegacy:case o.publicKey.ed25519:case o.publicKey.ed448:if(!e.keyFlags&&!t.allowMissingKeyFlags)throw Error("None of the key flags is set: consider passing `config.allowMissingKeyFlags`");return!e.keyFlags||!!(e.keyFlags[0]&o.keyFlags.signData);default:return!1}}function $a(i,e,t){switch(i.algorithm){case o.publicKey.rsaEncryptSign:case o.publicKey.rsaEncrypt:case o.publicKey.elgamal:case o.publicKey.ecdh:case o.publicKey.x25519:case o.publicKey.x448:if(!e.keyFlags&&!t.allowMissingKeyFlags)throw Error("None of the key flags is set: consider passing `config.allowMissingKeyFlags`");return!e.keyFlags||!!(e.keyFlags[0]&o.keyFlags.encryptCommunication)||!!(e.keyFlags[0]&o.keyFlags.encryptStorage);default:return!1}}function Qa(i,e,t){if(!e.keyFlags&&!t.allowMissingKeyFlags)throw Error("None of the key flags is set: consider passing `config.allowMissingKeyFlags`");switch(i.algorithm){case o.publicKey.rsaEncryptSign:case o.publicKey.rsaEncrypt:case o.publicKey.elgamal:case o.publicKey.ecdh:case o.publicKey.x25519:case o.publicKey.x448:return!(!(!e.keyFlags||e.keyFlags[0]&o.keyFlags.signData)||!t.allowInsecureDecryptionWithSigningKeys)||!e.keyFlags||!!(e.keyFlags[0]&o.keyFlags.encryptCommunication)||!!(e.keyFlags[0]&o.keyFlags.encryptStorage);default:return!1}}function Bt(i,e){let t=o.write(o.publicKey,i.algorithm),r=i.getAlgorithmInfo();if(e.rejectPublicKeyAlgorithms.has(t))throw Error(r.algorithm+" keys are considered too weak.");switch(t){case o.publicKey.rsaEncryptSign:case o.publicKey.rsaSign:case o.publicKey.rsaEncrypt:if(r.bits<e.minRSABits)throw Error(`RSA keys shorter than ${e.minRSABits} bits are considered too weak.`);break;case o.publicKey.ecdsa:case o.publicKey.eddsaLegacy:case o.publicKey.ecdh:if(e.rejectCurves.has(r.curve))throw Error(`Support for ${r.algorithm} keys using curve ${r.curve} is disabled.`)}}var _n=class i{constructor(e,t){this.userID=e.constructor.tag===o.packet.userID?e:null,this.userAttribute=e.constructor.tag===o.packet.userAttribute?e:null,this.selfCertifications=[],this.otherCertifications=[],this.revocationSignatures=[],this.mainKey=t}toPacketList(){let e=new ie;return e.push(this.userID||this.userAttribute),e.push(...this.revocationSignatures),e.push(...this.selfCertifications),e.push(...this.otherCertifications),e}clone(){let e=new i(this.userID||this.userAttribute,this.mainKey);return e.selfCertifications=[...this.selfCertifications],e.otherCertifications=[...this.otherCertifications],e.revocationSignatures=[...this.revocationSignatures],e}certify(e,t,r){return f(this,null,function*(){let n=this.mainKey.keyPacket,a={userID:this.userID,userAttribute:this.userAttribute,key:n},s=new i(a.userID||a.userAttribute,this.mainKey);return s.otherCertifications=yield Promise.all(e.map(function(c){return f(this,null,function*(){if(!c.isPrivate())throw Error("Need private key for signing");if(c.hasSameFingerprintAs(n))throw Error("The user's own key can only be used for self-certifications");let u=yield c.getSigningKey(void 0,t,void 0,r);return gt(a,[c],u.keyPacket,{signatureType:o.signature.certGeneric,keyFlags:[o.keyFlags.certifyKeys|o.keyFlags.signData]},t,void 0,void 0,void 0,r)})})),yield s.update(this,t,r),s})}isRevoked(a,s){return f(this,arguments,function*(e,t,r=new Date,n=M){let c=this.mainKey.keyPacket;return lr(c,o.signature.certRevocation,{key:c,userID:this.userID,userAttribute:this.userAttribute},this.revocationSignatures,e,t,r,n)})}verifyCertificate(a,s){return f(this,arguments,function*(e,t,r=new Date,n){let c=this,u=this.mainKey.keyPacket,h={userID:this.userID,userAttribute:this.userAttribute,key:u},{issuerKeyID:y}=e,p=t.filter(g=>g.getKeys(y).length>0);return p.length===0?null:(yield Promise.all(p.map(g=>f(this,null,function*(){let d=yield g.getSigningKey(y,e.created,void 0,n);if(e.revoked||(yield c.isRevoked(e,d.keyPacket,r,n)))throw Error("User certificate is revoked");try{yield e.verify(d.keyPacket,o.signature.certGeneric,h,r,void 0,n)}catch(w){throw l.wrapError("User certificate is invalid",w)}}))),!0)})}verifyAllCertifications(n){return f(this,arguments,function*(e,t=new Date,r){let a=this,s=this.selfCertifications.concat(this.otherCertifications);return Promise.all(s.map(c=>f(this,null,function*(){return{keyID:c.issuerKeyID,valid:yield a.verifyCertificate(c,e,t,r).catch(()=>!1)}})))})}verify(){return f(this,arguments,function*(e=new Date,t){if(!this.selfCertifications.length)throw Error("No self-certifications found");let r=this,n=this.mainKey.keyPacket,a={userID:this.userID,userAttribute:this.userAttribute,key:n},s;for(let c=this.selfCertifications.length-1;c>=0;c--)try{let u=this.selfCertifications[c];if(u.revoked||(yield r.isRevoked(u,void 0,e,t)))throw Error("Self-certification is revoked");try{yield u.verify(n,o.signature.certGeneric,a,e,void 0,t)}catch(h){throw l.wrapError("Self-certification is invalid",h)}return!0}catch(u){s=u}throw s})}update(e,t,r){return f(this,null,function*(){let n=this.mainKey.keyPacket,a={userID:this.userID,userAttribute:this.userAttribute,key:n};yield Qt(e,this,"selfCertifications",t,function(s){return f(this,null,function*(){try{return yield s.verify(n,o.signature.certGeneric,a,t,!1,r),!0}catch{return!1}})}),yield Qt(e,this,"otherCertifications",t),yield Qt(e,this,"revocationSignatures",t,function(s){return lr(n,o.signature.certRevocation,a,[s],void 0,void 0,t,r)})})}revoke(s){return f(this,arguments,function*(e,{flag:t=o.reasonForRevocation.noReason,string:r=""}={},n=new Date,a=M){let c={userID:this.userID,userAttribute:this.userAttribute,key:e},u=new i(c.userID||c.userAttribute,this.mainKey);return u.revocationSignatures.push(yield gt(c,[],e,{signatureType:o.signature.certRevocation,reasonForRevocationFlag:o.write(o.reasonForRevocation,t),reasonForRevocationString:r},n,void 0,void 0,!1,a)),yield u.update(this),u})}},Fr=class i{constructor(e,t){this.keyPacket=e,this.bindingSignatures=[],this.revocationSignatures=[],this.mainKey=t}toPacketList(){let e=new ie;return e.push(this.keyPacket),e.push(...this.revocationSignatures),e.push(...this.bindingSignatures),e}clone(){let e=new i(this.keyPacket,this.mainKey);return e.bindingSignatures=[...this.bindingSignatures],e.revocationSignatures=[...this.revocationSignatures],e}isRevoked(a,s){return f(this,arguments,function*(e,t,r=new Date,n=M){let c=this.mainKey.keyPacket;return lr(c,o.signature.subkeyRevocation,{key:c,bind:this.keyPacket},this.revocationSignatures,e,t,r,n)})}verify(){return f(this,arguments,function*(e=new Date,t=M){let r=this.mainKey.keyPacket,n={key:r,bind:this.keyPacket},a=yield Ze(this.bindingSignatures,r,o.signature.subkeyBinding,n,e,t);if(a.revoked||(yield this.isRevoked(a,null,e,t)))throw Error("Subkey is revoked");if(jn(this.keyPacket,a,e))throw Error("Subkey is expired");return a})}getExpirationTime(){return f(this,arguments,function*(e=new Date,t=M){let r=this.mainKey.keyPacket,n={key:r,bind:this.keyPacket},a;try{a=yield Ze(this.bindingSignatures,r,o.signature.subkeyBinding,n,e,t)}catch{return null}let s=Bi(this.keyPacket,a),c=a.getExpirationTime();return s<c?s:c})}update(n){return f(this,arguments,function*(e,t=new Date,r=M){let a=this.mainKey.keyPacket;if(!this.hasSameFingerprintAs(e))throw Error("Subkey update method: fingerprints of subkeys not equal");this.keyPacket.constructor.tag===o.packet.publicSubkey&&e.keyPacket.constructor.tag===o.packet.secretSubkey&&(this.keyPacket=e.keyPacket);let s=this,c={key:a,bind:s.keyPacket};yield Qt(e,this,"bindingSignatures",t,function(u){return f(this,null,function*(){for(let h=0;h<s.bindingSignatures.length;h++)if(s.bindingSignatures[h].issuerKeyID.equals(u.issuerKeyID))return u.created>s.bindingSignatures[h].created&&(s.bindingSignatures[h]=u),!1;try{return yield u.verify(a,o.signature.subkeyBinding,c,t,void 0,r),!0}catch{return!1}})}),yield Qt(e,this,"revocationSignatures",t,function(u){return lr(a,o.signature.subkeyRevocation,c,[u],void 0,void 0,t,r)})})}revoke(s){return f(this,arguments,function*(e,{flag:t=o.reasonForRevocation.noReason,string:r=""}={},n=new Date,a=M){let c={key:e,bind:this.keyPacket},u=new i(this.keyPacket,this.mainKey);return u.revocationSignatures.push(yield gt(c,[],e,{signatureType:o.signature.subkeyRevocation,reasonForRevocationFlag:o.write(o.reasonForRevocation,t),reasonForRevocationString:r},n,void 0,void 0,!1,a)),yield u.update(this),u})}hasSameFingerprintAs(e){return this.keyPacket.hasSameFingerprintAs(e.keyPacket||e)}};["getKeyID","getFingerprint","getAlgorithmInfo","getCreationTime","isDecrypted"].forEach(i=>{Fr.prototype[i]=function(){return this.keyPacket[i]()}});var Kc=l.constructAllowedPackets([Se]),Xa=new Set([o.packet.publicKey,o.packet.privateKey]),Ya=new Set([o.packet.publicKey,o.packet.privateKey,o.packet.publicSubkey,o.packet.privateSubkey]),Ti=class{packetListToStructure(e,t=new Set){let r,n,a,s;for(let c of e){if(c instanceof xr){Ya.has(c.tag)&&!s&&(s=Xa.has(c.tag)?Xa:Ya);continue}let u=c.constructor.tag;if(s){if(!s.has(u))continue;s=null}if(t.has(u))throw Error("Unexpected packet type: "+u);switch(u){case o.packet.publicKey:case o.packet.secretKey:if(this.keyPacket)throw Error("Key block contains multiple keys");if(this.keyPacket=c,n=this.getKeyID(),!n)throw Error("Missing Key ID");break;case o.packet.userID:case o.packet.userAttribute:r=new _n(c,this),this.users.push(r);break;case o.packet.publicSubkey:case o.packet.secretSubkey:r=null,a=new Fr(c,this),this.subkeys.push(a);break;case o.packet.signature:switch(c.signatureType){case o.signature.certGeneric:case o.signature.certPersona:case o.signature.certCasual:case o.signature.certPositive:if(!r){l.printDebug("Dropping certification signatures without preceding user packet");continue}c.issuerKeyID.equals(n)?r.selfCertifications.push(c):r.otherCertifications.push(c);break;case o.signature.certRevocation:r?r.revocationSignatures.push(c):this.directSignatures.push(c);break;case o.signature.key:this.directSignatures.push(c);break;case o.signature.subkeyBinding:if(!a){l.printDebug("Dropping subkey binding signature without preceding subkey packet");continue}a.bindingSignatures.push(c);break;case o.signature.keyRevocation:this.revocationSignatures.push(c);break;case o.signature.subkeyRevocation:if(!a){l.printDebug("Dropping subkey revocation signature without preceding subkey packet");continue}a.revocationSignatures.push(c)}}}}toPacketList(){let e=new ie;return e.push(this.keyPacket),e.push(...this.revocationSignatures),e.push(...this.directSignatures),this.users.map(t=>e.push(...t.toPacketList())),this.subkeys.map(t=>e.push(...t.toPacketList())),e}clone(e=!1){let t=new this.constructor(this.toPacketList());return e&&t.getKeys().forEach(r=>{if(r.keyPacket=Object.create(Object.getPrototypeOf(r.keyPacket),Object.getOwnPropertyDescriptors(r.keyPacket)),!r.keyPacket.isDecrypted())return;let n={};Object.keys(r.keyPacket.privateParams).forEach(a=>{n[a]=new Uint8Array(r.keyPacket.privateParams[a])}),r.keyPacket.privateParams=n}),t}getSubkeys(e=null){return this.subkeys.filter(t=>!e||t.getKeyID().equals(e,!0))}getKeys(e=null){let t=[];return e&&!this.getKeyID().equals(e,!0)||t.push(this),t.concat(this.getSubkeys(e))}getKeyIDs(){return this.getKeys().map(e=>e.getKeyID())}getUserIDs(){return this.users.map(e=>e.userID?e.userID.userID:null).filter(e=>e!==null)}write(){return this.toPacketList().write()}getSigningKey(){return f(this,arguments,function*(e=null,t=new Date,r={},n=M){yield this.verifyPrimaryKey(t,r,n);let a=this.keyPacket;try{Bt(a,n)}catch(u){throw l.wrapError("Could not verify primary key",u)}let s=this.subkeys.slice().sort((u,h)=>h.keyPacket.created-u.keyPacket.created),c;for(let u of s)if(!e||u.getKeyID().equals(e))try{yield u.verify(t,n);let h={key:a,bind:u.keyPacket},y=yield Ze(u.bindingSignatures,a,o.signature.subkeyBinding,h,t,n);if(!Wa(u.keyPacket,y,n))continue;if(!y.embeddedSignature)throw Error("Missing embedded signature");return yield Ze([y.embeddedSignature],u.keyPacket,o.signature.keyBinding,h,t,n),Bt(u.keyPacket,n),u}catch(h){c=h}try{let u=yield this.getPrimarySelfSignature(t,r,n);if((!e||a.getKeyID().equals(e))&&Wa(a,u,n))return Bt(a,n),this}catch(u){c=u}throw l.wrapError("Could not find valid signing key packet in key "+this.getKeyID().toHex(),c)})}getEncryptionKey(a){return f(this,arguments,function*(e,t=new Date,r={},n=M){yield this.verifyPrimaryKey(t,r,n);let s=this.keyPacket;try{Bt(s,n)}catch(h){throw l.wrapError("Could not verify primary key",h)}let c=this.subkeys.slice().sort((h,y)=>y.keyPacket.created-h.keyPacket.created),u;for(let h of c)if(!e||h.getKeyID().equals(e))try{yield h.verify(t,n);let y={key:s,bind:h.keyPacket},p=yield Ze(h.bindingSignatures,s,o.signature.subkeyBinding,y,t,n);if($a(h.keyPacket,p,n))return Bt(h.keyPacket,n),h}catch(y){u=y}try{let h=yield this.getPrimarySelfSignature(t,r,n);if((!e||s.getKeyID().equals(e))&&$a(s,h,n))return Bt(s,n),this}catch(h){u=h}throw l.wrapError("Could not find valid encryption key packet in key "+this.getKeyID().toHex(),u)})}isRevoked(a,s){return f(this,arguments,function*(e,t,r=new Date,n=M){return lr(this.keyPacket,o.signature.keyRevocation,{key:this.keyPacket},this.revocationSignatures,e,t,r,n)})}verifyPrimaryKey(){return f(this,arguments,function*(e=new Date,t={},r=M){let n=this.keyPacket;if(yield this.isRevoked(null,null,e,r))throw Error("Primary key is revoked");if(jn(n,yield this.getPrimarySelfSignature(e,t,r),e))throw Error("Primary key is expired");if(n.version!==6){let a=yield Ze(this.directSignatures,n,o.signature.key,{key:n},e,r).catch(()=>{});if(a&&jn(n,a,e))throw Error("Primary key is expired")}})}getExpirationTime(r){return f(this,arguments,function*(e,t=M){let n;try{let a=yield this.getPrimarySelfSignature(null,e,t),s=Bi(this.keyPacket,a),c=a.getExpirationTime(),u=this.keyPacket.version!==6&&(yield Ze(this.directSignatures,this.keyPacket,o.signature.key,{key:this.keyPacket},null,t).catch(()=>{}));if(u){let h=Bi(this.keyPacket,u);n=Math.min(s,c,h)}else n=s<c?s:c}catch{n=null}return l.normalizeDate(n)})}getPrimarySelfSignature(){return f(this,arguments,function*(e=new Date,t={},r=M){let n=this.keyPacket;if(n.version===6)return Ze(this.directSignatures,n,o.signature.key,{key:n},e,r);let{selfCertification:a}=yield this.getPrimaryUser(e,t,r);return a})}getPrimaryUser(){return f(this,arguments,function*(e=new Date,t={},r=M){let n=this.keyPacket,a=[],s;for(let y=0;y<this.users.length;y++)try{let p=this.users[y];if(!p.userID)continue;if(t.name!==void 0&&p.userID.name!==t.name||t.email!==void 0&&p.userID.email!==t.email||t.comment!==void 0&&p.userID.comment!==t.comment)throw Error("Could not find user that matches that user ID");let g={userID:p.userID,key:n},d=yield Ze(p.selfCertifications,n,o.signature.certGeneric,g,e,r);a.push({index:y,user:p,selfCertification:d})}catch(p){s=p}if(!a.length)throw s||Error("Could not find primary user");yield Promise.all(a.map(function(y){return f(this,null,function*(){return y.selfCertification.revoked||y.user.isRevoked(y.selfCertification,null,e,r)})}));let c=a.sort(function(y,p){let g=y.selfCertification,d=p.selfCertification;return d.revoked-g.revoked||g.isPrimaryUserID-d.isPrimaryUserID||g.created-d.created}).pop(),{user:u,selfCertification:h}=c;if(h.revoked||(yield u.isRevoked(h,null,e,r)))throw Error("Primary user is revoked");return c})}update(n){return f(this,arguments,function*(e,t=new Date,r=M){if(!this.hasSameFingerprintAs(e))throw Error("Primary key fingerprints must be equal to update the key");if(!this.isPrivate()&&e.isPrivate()){if(!(this.subkeys.length===e.subkeys.length&&this.subkeys.every(s=>e.subkeys.some(c=>s.hasSameFingerprintAs(c)))))throw Error("Cannot update public key with private key if subkeys mismatch");return e.update(this,r)}let a=this.clone();return yield Qt(e,a,"revocationSignatures",t,s=>lr(a.keyPacket,o.signature.keyRevocation,a,[s],null,e.keyPacket,t,r)),yield Qt(e,a,"directSignatures",t),yield Promise.all(e.users.map(s=>f(this,null,function*(){let c=a.users.filter(u=>s.userID&&s.userID.equals(u.userID)||s.userAttribute&&s.userAttribute.equals(u.userAttribute));if(c.length>0)yield Promise.all(c.map(u=>u.update(s,t,r)));else{let u=s.clone();u.mainKey=a,a.users.push(u)}}))),yield Promise.all(e.subkeys.map(s=>f(this,null,function*(){let c=a.subkeys.filter(u=>u.hasSameFingerprintAs(s));if(c.length>0)yield Promise.all(c.map(u=>u.update(s,t,r)));else{let u=s.clone();u.mainKey=a,a.subkeys.push(u)}}))),a})}getRevocationCertificate(){return f(this,arguments,function*(e=new Date,t=M){let r={key:this.keyPacket},n=yield Ze(this.revocationSignatures,this.keyPacket,o.signature.keyRevocation,r,e,t),a=new ie;a.push(n);let s=this.keyPacket.version!==6;return jr(o.armor.publicKey,a.write(),null,null,"This is a revocation certificate",s,t)})}applyRevocationCertificate(n){return f(this,arguments,function*(e,t=new Date,r=M){let a=yield Hr(e),s=(yield ie.fromBinary(a.data,Kc,r)).findPacket(o.packet.signature);if(!s||s.signatureType!==o.signature.keyRevocation)throw Error("Could not find revocation signature packet");if(!s.issuerKeyID.equals(this.getKeyID()))throw Error("Revocation signature does not match key");try{yield s.verify(this.keyPacket,o.signature.keyRevocation,{key:this.keyPacket},t,void 0,r)}catch(u){throw l.wrapError("Could not verify revocation signature",u)}let c=this.clone();return c.revocationSignatures.push(s),c})}signPrimaryUser(a,s,c){return f(this,arguments,function*(e,t,r,n=M){let{index:u,user:h}=yield this.getPrimaryUser(t,r,n),y=yield h.certify(e,t,n),p=this.clone();return p.users[u]=y,p})}signAllUsers(n){return f(this,arguments,function*(e,t=new Date,r=M){let a=this.clone();return a.users=yield Promise.all(this.users.map(function(s){return s.certify(e,t,r)})),a})}verifyPrimaryUser(a){return f(this,arguments,function*(e,t=new Date,r,n=M){let s=this.keyPacket,{user:c}=yield this.getPrimaryUser(t,r,n);return e?yield c.verifyAllCertifications(e,t,n):[{keyID:s.getKeyID(),valid:yield c.verify(t,n).catch(()=>!1)}]})}verifyAllUsers(n){return f(this,arguments,function*(e,t=new Date,r=M){let a=this.keyPacket,s=[];return yield Promise.all(this.users.map(c=>f(this,null,function*(){let u=e?yield c.verifyAllCertifications(e,t,r):[{keyID:a.getKeyID(),valid:yield c.verify(t,r).catch(()=>!1)}];s.push(...u.map(h=>({userID:c.userID?c.userID.userID:null,userAttribute:c.userAttribute,keyID:h.keyID,valid:h.valid})))}))),s})}};["getKeyID","getFingerprint","getAlgorithmInfo","getCreationTime","hasSameFingerprintAs"].forEach(i=>{Ti.prototype[i]=Fr.prototype[i]});var Rr=class extends Ti{constructor(e){if(super(),this.keyPacket=null,this.revocationSignatures=[],this.directSignatures=[],this.users=[],this.subkeys=[],e&&(this.packetListToStructure(e,new Set([o.packet.secretKey,o.packet.secretSubkey])),!this.keyPacket))throw Error("Invalid key: missing public-key packet")}isPrivate(){return!1}toPublic(){return this}armor(e=M){let t=this.keyPacket.version!==6;return jr(o.armor.publicKey,this.toPacketList().write(),void 0,void 0,void 0,t,e)}},zr=class i extends Rr{constructor(e){if(super(),this.packetListToStructure(e,new Set([o.packet.publicKey,o.packet.publicSubkey])),!this.keyPacket)throw Error("Invalid key: missing private-key packet")}isPrivate(){return!0}toPublic(){let e=new ie,t=this.toPacketList();for(let r of t)switch(r.constructor.tag){case o.packet.secretKey:{let n=yt.fromSecretKeyPacket(r);e.push(n);break}case o.packet.secretSubkey:{let n=Di.fromSecretSubkeyPacket(r);e.push(n);break}default:e.push(r)}return new Rr(e)}armor(e=M){let t=this.keyPacket.version!==6;return jr(o.armor.privateKey,this.toPacketList().write(),void 0,void 0,void 0,t,e)}getDecryptionKeys(a){return f(this,arguments,function*(e,t=new Date,r={},n=M){let s=this.keyPacket,c=[],u=null;for(let y=0;y<this.subkeys.length;y++)if(!e||this.subkeys[y].getKeyID().equals(e,!0)){if(this.subkeys[y].keyPacket.isDummy()){u=u||Error("Gnu-dummy key packets cannot be used for decryption");continue}try{let p={key:s,bind:this.subkeys[y].keyPacket},g=yield Ze(this.subkeys[y].bindingSignatures,s,o.signature.subkeyBinding,p,t,n);Qa(this.subkeys[y].keyPacket,g,n)&&c.push(this.subkeys[y])}catch(p){u=p}}let h=yield this.getPrimarySelfSignature(t,r,n);if(e&&!s.getKeyID().equals(e,!0)||!Qa(s,h,n)||(s.isDummy()?u=u||Error("Gnu-dummy key packets cannot be used for decryption"):c.push(this)),c.length===0)throw u||Error("No decryption key packets found");return c})}isDecrypted(){return this.getKeys().some(({keyPacket:e})=>e.isDecrypted())}validate(){return f(this,arguments,function*(e=M){if(!this.isPrivate())throw Error("Cannot validate a public key");let t;if(this.keyPacket.isDummy()){let r=yield this.getSigningKey(null,null,void 0,qi(be({},e),{rejectPublicKeyAlgorithms:new Set,minRSABits:0}));r&&!r.keyPacket.isDummy()&&(t=r.keyPacket)}else t=this.keyPacket;if(t)return t.validate();{let r=this.getKeys();if(r.map(n=>n.keyPacket.isDummy()).every(Boolean))throw Error("Cannot validate an all-gnu-dummy key");return Promise.all(r.map(n=>f(this,null,function*(){return n.keyPacket.validate()})))}})}clearPrivateParams(){this.getKeys().forEach(({keyPacket:e})=>{e.isDecrypted()&&e.clearPrivateParams()})}revoke(){return f(this,arguments,function*({flag:e=o.reasonForRevocation.noReason,string:t=""}={},r=new Date,n=M){if(!this.isPrivate())throw Error("Need private key for revoking");let a={key:this.keyPacket},s=this.clone();return s.revocationSignatures.push(yield gt(a,[],this.keyPacket,{signatureType:o.signature.keyRevocation,reasonForRevocationFlag:o.write(o.reasonForRevocation,e),reasonForRevocationString:t},r,void 0,void 0,void 0,n)),s})}addSubkey(){return f(this,arguments,function*(e={}){let t=be(be({},M),e.config);if(e.passphrase)throw Error("Subkey could not be encrypted here, please encrypt whole key");if(e.rsaBits<t.minRSABits)throw Error(`rsaBits should be at least ${t.minRSABits}, got: ${e.rsaBits}`);let r=this.keyPacket;if(r.isDummy())throw Error("Cannot add subkey to gnu-dummy primary key");if(!r.isDecrypted())throw Error("Key is not decrypted");let n=r.getAlgorithmInfo();n.type=function(u){switch(o.write(o.publicKey,u)){case o.publicKey.rsaEncrypt:case o.publicKey.rsaEncryptSign:case o.publicKey.rsaSign:case o.publicKey.dsa:return"rsa";case o.publicKey.ecdsa:case o.publicKey.eddsaLegacy:return"ecc";case o.publicKey.ed25519:return"curve25519";case o.publicKey.ed448:return"curve448";default:throw Error("Unsupported algorithm")}}(n.algorithm),n.rsaBits=n.bits||4096,n.curve=n.curve||"curve25519Legacy",e=On(e,n);let a=yield Zs(e,qi(be({},t),{v6Keys:this.keyPacket.version===6}));Bt(a,t);let s=yield Js(a,r,e,t),c=this.toPacketList();return c.push(a,s),new i(c)})}},eo=l.constructAllowedPackets([yt,Di,Lr,Ii,Ci,Hn,Se]);function Ec(i){for(let e of i)switch(e.constructor.tag){case o.packet.secretKey:return new zr(i);case o.packet.publicKey:return new Rr(i)}throw Error("No key packet found")}function Sc(i,e,t,r){return f(this,null,function*(){t.passphrase&&(yield i.encrypt(t.passphrase,r)),yield Promise.all(e.map(function(u,h){return f(this,null,function*(){let y=t.subkeys[h].passphrase;y&&(yield u.encrypt(y,r))})}));let n=new ie;function a(u,h){return[h,...u.filter(y=>y!==h)]}function s(){let u={};u.keyFlags=[o.keyFlags.certifyKeys|o.keyFlags.signData];let h=a([o.symmetric.aes256,o.symmetric.aes128],r.preferredSymmetricAlgorithm);if(u.preferredSymmetricAlgorithms=h,r.aeadProtect){let y=a([o.aead.gcm,o.aead.eax,o.aead.ocb],r.preferredAEADAlgorithm);u.preferredCipherSuites=y.flatMap(p=>h.map(g=>[g,p]))}return u.preferredHashAlgorithms=a([o.hash.sha512,o.hash.sha256,o.hash.sha3_512,o.hash.sha3_256],r.preferredHashAlgorithm),u.preferredCompressionAlgorithms=a([o.compression.uncompressed,o.compression.zlib,o.compression.zip],r.preferredCompressionAlgorithm),u.features=[0],u.features[0]|=o.features.modificationDetection,r.aeadProtect&&(u.features[0]|=o.features.seipdv2),t.keyExpirationTime>0&&(u.keyExpirationTime=t.keyExpirationTime,u.keyNeverExpires=!1),u}if(n.push(i),i.version===6){let u={key:i},h=s();h.signatureType=o.signature.key;let y=yield gt(u,[],i,h,t.date,void 0,void 0,void 0,r);n.push(y)}yield Promise.all(t.userIDs.map(function(u,h){return f(this,null,function*(){let y=Ci.fromObject(u),p={userID:y,key:i},g=i.version!==6?s():{};return g.signatureType=o.signature.certPositive,h===0&&(g.isPrimaryUserID=!0),{userIDPacket:y,signaturePacket:yield gt(p,[],i,g,t.date,void 0,void 0,void 0,r)}})})).then(u=>{u.forEach(({userIDPacket:h,signaturePacket:y})=>{n.push(h),n.push(y)})}),yield Promise.all(e.map(function(u,h){return f(this,null,function*(){let y=t.subkeys[h];return{secretSubkeyPacket:u,subkeySignaturePacket:yield Js(u,i,y,r)}})})).then(u=>{u.forEach(({secretSubkeyPacket:h,subkeySignaturePacket:y})=>{n.push(h),n.push(y)})});let c={key:i};return n.push(yield gt(c,[],i,{signatureType:o.signature.keyRevocation,reasonForRevocationFlag:o.reasonForRevocation.noReason,reasonForRevocationString:""},t.date,void 0,void 0,void 0,r)),t.passphrase&&i.clearPrivateParams(),yield Promise.all(e.map(function(u,h){return f(this,null,function*(){t.subkeys[h].passphrase&&u.clearPrivateParams()})})),new zr(n)})}function Bc(n){return f(this,null,function*(){var a=n,{armoredKey:i,binaryKey:e,config:t}=a,r=Ut(a,["armoredKey","binaryKey","config"]);if(t=be(be({},M),t),!i&&!e)throw Error("readKey: must pass options object containing `armoredKey` or `binaryKey`");if(i&&!l.isString(i))throw Error("readKey: options.armoredKey must be a string");if(e&&!l.isUint8Array(e))throw Error("readKey: options.binaryKey must be a Uint8Array");let s=Object.keys(r);if(s.length>0)throw Error("Unknown option: "+s.join(", "));let c;if(i){let{type:y,data:p}=yield Hr(i);if(y!==o.armor.publicKey&&y!==o.armor.privateKey)throw Error("Armored text not of type key");c=p}else c=e;let u=yield ie.fromBinary(c,eo,t),h=u.indexOfTag(o.packet.publicKey,o.packet.secretKey);if(h.length===0)throw Error("No key packet found");return Ec(u.slice(h[0],h[1]))})}function Tc(n){return f(this,null,function*(){var a=n,{armoredKey:i,binaryKey:e,config:t}=a,r=Ut(a,["armoredKey","binaryKey","config"]);if(t=be(be({},M),t),!i&&!e)throw Error("readPrivateKey: must pass options object containing `armoredKey` or `binaryKey`");if(i&&!l.isString(i))throw Error("readPrivateKey: options.armoredKey must be a string");if(e&&!l.isUint8Array(e))throw Error("readPrivateKey: options.binaryKey must be a Uint8Array");let s=Object.keys(r);if(s.length>0)throw Error("Unknown option: "+s.join(", "));let c;if(i){let{type:y,data:p}=yield Hr(i);if(y!==o.armor.privateKey)throw Error("Armored text not of type private key");c=p}else c=e;let u=yield ie.fromBinary(c,eo,t),h=u.indexOfTag(o.packet.publicKey,o.packet.secretKey);for(let y=0;y<h.length;y++){if(u[h[y]].constructor.tag===o.packet.publicKey)continue;let p=u.slice(h[y],h[y+1]);return new zr(p)}throw Error("No secret key packet found")})}var Pc=l.constructAllowedPackets([Nt,Zt,zn,yr,Nn,Tr,Mr,Xe,Se]),Uc=l.constructAllowedPackets([Mr]),Dc=l.constructAllowedPackets([Se]),Nr=class i{constructor(e){this.packets=e||new ie}getEncryptionKeyIDs(){let e=[];return this.packets.filterByTag(o.packet.publicKeyEncryptedSessionKey).forEach(function(t){e.push(t.publicKeyID)}),e}getSigningKeyIDs(){let e=this.unwrapCompressed(),t=e.packets.filterByTag(o.packet.onePassSignature);return t.length>0?t.map(r=>r.issuerKeyID):e.packets.filterByTag(o.packet.signature).map(r=>r.issuerKeyID)}decrypt(s,c,u){return f(this,arguments,function*(e,t,r,n=new Date,a=M){let h=this.packets.filterByTag(o.packet.symmetricallyEncryptedData,o.packet.symEncryptedIntegrityProtectedData,o.packet.aeadEncryptedData);if(h.length===0)throw Error("No encrypted data found");let y=h[0],p=y.cipherAlgorithm,g=r||(yield this.decryptSessionKeys(e,t,p,n,a)),d=null,w=Promise.all(g.map(A=>f(this,[A],function*({algorithm:b,data:v}){if(!l.isUint8Array(v)||!y.cipherAlgorithm&&!l.isString(b))throw Error("Invalid session key for decryption.");try{let S=y.cipherAlgorithm||o.write(o.symmetric,b);yield y.decrypt(S,v,a)}catch(S){l.printDebugError(S),d=S}})));if(gn(y.encrypted),y.encrypted=null,yield w,!y.packets||!y.packets.length)throw d||Error("Decryption failed.");let m=new i(y.packets);return y.packets=new ie,m})}decryptSessionKeys(s,c,u){return f(this,arguments,function*(e,t,r,n=new Date,a=M){let h,y=[];if(t){let p=this.packets.filterByTag(o.packet.symEncryptedSessionKey);if(p.length===0)throw Error("No symmetrically encrypted session key packet found.");yield Promise.all(t.map(function(g,d){return f(this,null,function*(){let w;w=d?yield ie.fromBinary(p.write(),Uc,a):p,yield Promise.all(w.map(function(m){return f(this,null,function*(){try{yield m.decrypt(g),y.push(m)}catch(b){l.printDebugError(b),b instanceof Ai&&(h=b)}})}))})}))}else{if(!e)throw Error("No key or password specified.");{let p=this.packets.filterByTag(o.packet.publicKeyEncryptedSessionKey);if(p.length===0)throw Error("No public key encrypted session key packet found.");yield Promise.all(p.map(function(g){return f(this,null,function*(){yield Promise.all(e.map(function(d){return f(this,null,function*(){let w;try{w=(yield d.getDecryptionKeys(g.publicKeyID,null,void 0,a)).map(b=>b.keyPacket)}catch(b){return void(h=b)}let m=[o.symmetric.aes256,o.symmetric.aes128,o.symmetric.tripledes,o.symmetric.cast5];try{let b=yield d.getPrimarySelfSignature(n,void 0,a);b.preferredSymmetricAlgorithms&&(m=m.concat(b.preferredSymmetricAlgorithms))}catch{}yield Promise.all(w.map(function(b){return f(this,null,function*(){if(!b.isDecrypted())throw Error("Decryption key is not decrypted.");if(a.constantTimePKCS1Decryption&&(g.publicKeyAlgorithm===o.publicKey.rsaEncrypt||g.publicKeyAlgorithm===o.publicKey.rsaEncryptSign||g.publicKeyAlgorithm===o.publicKey.rsaSign||g.publicKeyAlgorithm===o.publicKey.elgamal)){let v=g.write();yield Promise.all((r?[r]:Array.from(a.constantTimePKCS1DecryptionSupportedSymmetricAlgorithms)).map(A=>f(this,null,function*(){let S=new Tr;S.read(v);let K={sessionKeyAlgorithm:A,sessionKey:T.generateSessionKey(A)};try{yield S.decrypt(b,K),y.push(S)}catch(D){l.printDebugError(D),h=D}})))}else try{yield g.decrypt(b);let v=r||g.sessionKeyAlgorithm;if(v&&!m.includes(o.write(o.symmetric,v)))throw Error("A non-preferred symmetric algorithm was used.");y.push(g)}catch(v){l.printDebugError(v),h=v}})}))})})),gn(g.encrypted),g.encrypted=null})}))}}if(y.length>0){if(y.length>1){let p=new Set;y=y.filter(g=>{let d=g.sessionKeyAlgorithm+l.uint8ArrayToString(g.sessionKey);return!p.has(d)&&(p.add(d),!0)})}return y.map(p=>({data:p.sessionKey,algorithm:p.sessionKeyAlgorithm&&o.read(o.symmetric,p.sessionKeyAlgorithm)}))}throw h||Error("Session key decryption failed.")})}getLiteralData(){let e=this.unwrapCompressed().packets.findPacket(o.packet.literalData);return e&&e.getBytes()||null}getFilename(){let e=this.unwrapCompressed().packets.findPacket(o.packet.literalData);return e&&e.getFilename()||null}getText(){let e=this.unwrapCompressed().packets.findPacket(o.packet.literalData);return e?e.getText():null}static generateSessionKey(){return f(this,arguments,function*(e=[],t=new Date,r=[],n=M){let{symmetricAlgo:a,aeadAlgo:s}=yield function(){return f(this,arguments,function*(h=[],y=new Date,p=[],g=M){let d=yield Promise.all(h.map((b,v)=>b.getPrimarySelfSignature(y,p[v],g)));if(h.length?d.every(b=>b.features&&b.features[0]&o.features.seipdv2):g.aeadProtect){let b={symmetricAlgo:o.symmetric.aes128,aeadAlgo:o.aead.ocb},v=[{symmetricAlgo:g.preferredSymmetricAlgorithm,aeadAlgo:g.preferredAEADAlgorithm},{symmetricAlgo:g.preferredSymmetricAlgorithm,aeadAlgo:o.aead.ocb},{symmetricAlgo:o.symmetric.aes128,aeadAlgo:g.preferredAEADAlgorithm}];for(let A of v)if(d.every(S=>S.preferredCipherSuites&&S.preferredCipherSuites.some(K=>K[0]===A.symmetricAlgo&&K[1]===A.aeadAlgo)))return A;return b}let w=o.symmetric.aes128,m=g.preferredSymmetricAlgorithm;return{symmetricAlgo:d.every(b=>b.preferredSymmetricAlgorithms&&b.preferredSymmetricAlgorithms.includes(m))?m:w,aeadAlgo:void 0}})}(e,t,r,n),c=o.read(o.symmetric,a),u=s?o.read(o.aead,s):void 0;return yield Promise.all(e.map(h=>h.getEncryptionKey().catch(()=>null).then(y=>{if(y&&(y.keyPacket.algorithm===o.publicKey.x25519||y.keyPacket.algorithm===o.publicKey.x448)&&!u&&!l.isAES(a))throw Error("Could not generate a session key compatible with the given `encryptionKeys`: X22519 and X448 keys can only be used to encrypt AES session keys; change `config.preferredSymmetricAlgorithm` accordingly.")}))),{data:T.generateSessionKey(a),algorithm:c,aeadAlgorithm:u}})}encrypt(h,y,p){return f(this,arguments,function*(e,t,r,n=!1,a=[],s=new Date,c=[],u=M){if(r){if(!l.isUint8Array(r.data)||!l.isString(r.algorithm))throw Error("Invalid session key for encryption.")}else if(e&&e.length)r=yield i.generateSessionKey(e,s,c,u);else{if(!t||!t.length)throw Error("No keys, passwords, or session key provided.");r=yield i.generateSessionKey(void 0,void 0,void 0,u)}let{data:g,algorithm:d,aeadAlgorithm:w}=r,m=yield i.encryptSessionKey(g,d,w,e,t,n,a,s,c,u),b=yr.fromObject({version:w?2:1,aeadAlgorithm:w?o.write(o.aead,w):null});b.packets=this.packets;let v=o.write(o.symmetric,d);return yield b.encrypt(v,g,u),m.packets.push(b),b.packets=new ie,m})}static encryptSessionKey(p,g,d,w,m){return f(this,arguments,function*(e,t,r,n,a,s=!1,c=[],u=new Date,h=[],y=M){let b=new ie,v=o.write(o.symmetric,t),A=r&&o.write(o.aead,r);if(n){let S=yield Promise.all(n.map(function(K,D){return f(this,null,function*(){let B=yield K.getEncryptionKey(c[D],u,h,y),P=Tr.fromObject({version:A?6:3,encryptionKeyPacket:B.keyPacket,anonymousRecipient:s,sessionKey:e,sessionKeyAlgorithm:v});return yield P.encrypt(B.keyPacket),delete P.sessionKey,P})}));b.push(...S)}if(a){let S=function(P,k){return f(this,null,function*(){try{return yield P.decrypt(k),1}catch{return 0}})},K=(P,k)=>P+k,D=function(P,k,U,I){return f(this,null,function*(){let E=new Mr(y);return E.sessionKey=P,E.sessionKeyAlgorithm=k,U&&(E.aeadAlgorithm=U),yield E.encrypt(I,y),y.passwordCollisionCheck&&(yield Promise.all(a.map(C=>S(E,C)))).reduce(K)!==1?D(P,k,I):(delete E.sessionKey,E)})},B=yield Promise.all(a.map(P=>D(e,v,A,P)));b.push(...B)}return new i(b)})}sign(){return f(this,arguments,function*(e=[],t=[],r=null,n=[],a=new Date,s=[],c=[],u=[],h=M){let y=new ie,p=this.packets.findPacket(o.packet.literalData);if(!p)throw Error("No literal data packet to sign.");let g=yield Za(p,e,t,r,n,a,s,c,u,!1,h),d=g.map((w,m)=>Xe.fromSignaturePacket(w,m===0)).reverse();return y.push(...d),y.push(p),y.push(...g),new i(y)})}compress(e,t=M){if(e===o.compression.uncompressed)return this;let r=new Zt(t);r.algorithm=e,r.packets=this.packets;let n=new ie;return n.push(r),new i(n)}signDetached(){return f(this,arguments,function*(e=[],t=[],r=null,n=[],a=[],s=new Date,c=[],u=[],h=M){let y=this.packets.findPacket(o.packet.literalData);if(!y)throw Error("No literal data packet to sign.");return new xi(yield Za(y,e,t,r,n,a,s,c,u,!0,h))})}verify(n){return f(this,arguments,function*(e,t=new Date,r=M){let a=this.unwrapCompressed(),s=a.packets.filterByTag(o.packet.literalData);if(s.length!==1)throw Error("Can only verify message with one literal data packet.");ge(a.packets.stream)&&a.packets.push(...yield ke(a.packets.stream,h=>h||[]));let c=a.packets.filterByTag(o.packet.onePassSignature).reverse(),u=a.packets.filterByTag(o.packet.signature);return c.length&&!u.length&&l.isStream(a.packets.stream)&&!ge(a.packets.stream)?(yield Promise.all(c.map(h=>f(this,null,function*(){h.correspondingSig=new Promise((y,p)=>{h.correspondingSigResolve=y,h.correspondingSigReject=p}),h.signatureData=jt(()=>f(this,null,function*(){return(yield h.correspondingSig).signatureData})),h.hashed=ke(yield h.hash(h.signatureType,s[0],void 0,!1)),h.hashed.catch(()=>{})}))),a.packets.stream=Ht(a.packets.stream,(h,y)=>f(this,null,function*(){let p=Pt(h),g=Ge(y);try{for(let d=0;d<c.length;d++){let{value:w}=yield p.read();c[d].correspondingSigResolve(w)}yield p.readToEnd(),yield g.ready,yield g.close()}catch(d){c.forEach(w=>{w.correspondingSigReject(d)}),yield g.abort(d)}})),pn(c,s,e,t,!1,r)):pn(u,s,e,t,!1,r)})}verifyDetached(e,t,r=new Date,n=M){let a=this.unwrapCompressed().packets.filterByTag(o.packet.literalData);if(a.length!==1)throw Error("Can only verify message with one literal data packet.");return pn(e.packets.filterByTag(o.packet.signature),a,t,r,!0,n)}unwrapCompressed(){let e=this.packets.filterByTag(o.packet.compressedData);return e.length?new i(e[0].packets):this}appendSignature(r){return f(this,arguments,function*(e,t=M){yield this.packets.read(l.isUint8Array(e)?e:(yield Hr(e)).data,Dc,t)})}write(){return this.packets.write()}armor(e=M){let t=this.packets[this.packets.length-1],r=t.constructor.tag===yr.tag?t.version!==2:this.packets.some(n=>n.constructor.tag===Se.tag&&n.version!==6);return jr(o.armor.message,this.write(),null,null,null,r,e)}};function Za(p,g){return f(this,arguments,function*(i,e,t=[],r=null,n=[],a=new Date,s=[],c=[],u=[],h=!1,y=M){let d=new ie,w=i.text===null?o.signature.binary:o.signature.text;if(yield Promise.all(e.map((m,b)=>f(this,null,function*(){let v=s[b];if(!m.isPrivate())throw Error("Need private key for signing");let A=yield m.getSigningKey(n[b],a,v,y);return gt(i,t.length?t:[m],A.keyPacket,{signatureType:w},a,c,u,h,y)}))).then(m=>{d.push(...m)}),r){let m=r.packets.filterByTag(o.packet.signature);d.push(...m)}return d})}function pn(s,c,u){return f(this,arguments,function*(i,e,t,r=new Date,n=!1,a=M){return Promise.all(i.filter(function(h){return["text","binary"].includes(o.read(o.signature,h.signatureType))}).map(function(h){return f(this,null,function*(){return function(b,v,A){return f(this,arguments,function*(y,p,g,d=new Date,w=!1,m=M){let S,K;for(let P of g){let k=P.getKeys(y.issuerKeyID);if(k.length>0){S=P,K=k[0];break}}let D=y instanceof Xe?y.correspondingSig:y,B={keyID:y.issuerKeyID,verified:f(this,null,function*(){if(!K)throw Error("Could not find signing key with key ID "+y.issuerKeyID.toHex());yield y.verify(K.keyPacket,y.signatureType,p[0],d,w,m);let P=yield D;if(K.getCreationTime()>P.created)throw Error("Key is newer than the signature");try{yield S.getSigningKey(K.getKeyID(),P.created,void 0,m)}catch(k){if(!m.allowInsecureVerificationWithReformattedKeys||!k.message.match(/Signature creation time is in the future/))throw k;yield S.getSigningKey(K.getKeyID(),d,void 0,m)}return!0}),signature:f(this,null,function*(){let P=yield D,k=new ie;return P&&k.push(P),new xi(k)})};return B.signature.catch(()=>{}),B.verified.catch(()=>{}),B})}(h,e,t,r,n,a)})}))})}function Mc(n){return f(this,null,function*(){var a=n,{armoredMessage:i,binaryMessage:e,config:t}=a,r=Ut(a,["armoredMessage","binaryMessage","config"]);t=be(be({},M),t);let s=i||e;if(!s)throw Error("readMessage: must pass options object containing `armoredMessage` or `binaryMessage`");if(i&&!l.isString(i)&&!l.isStream(i))throw Error("readMessage: options.armoredMessage must be a string or stream");if(e&&!l.isUint8Array(e)&&!l.isStream(e))throw Error("readMessage: options.binaryMessage must be a Uint8Array or stream");let c=Object.keys(r);if(c.length>0)throw Error("Unknown option: "+c.join(", "));let u=l.isStream(s);if(i){let{type:p,data:g}=yield Hr(s);if(p!==o.armor.message)throw Error("Armored text not of type message");s=g}let h=yield ie.fromBinary(s,Pc,t),y=new Nr(h);return y.fromStream=u,y})}function Lc(s){return f(this,null,function*(){var c=s,{text:i,binary:e,filename:t,date:r=new Date,format:n=i!==void 0?"utf8":"binary"}=c,a=Ut(c,["text","binary","filename","date","format"]);let u=i!==void 0?i:e;if(u===void 0)throw Error("createMessage: must pass options object containing `text` or `binary`");if(i&&!l.isString(i)&&!l.isStream(i))throw Error("createMessage: options.text must be a string or stream");if(e&&!l.isUint8Array(e)&&!l.isStream(e))throw Error("createMessage: options.binary must be a Uint8Array or stream");let h=Object.keys(a);if(h.length>0)throw Error("Unknown option: "+h.join(", "));let y=l.isStream(u),p=new Nt(r);i!==void 0?p.setText(u,o.write(o.literal,n)):p.setBytes(u,o.write(o.literal,n)),t!==void 0&&p.setFilename(t);let g=new ie;g.push(p);let d=new Nr(g);return d.fromStream=y,d})}function Fc(p){return f(this,null,function*(){var g=p,{userIDs:i=[],passphrase:e,type:t,curve:r,rsaBits:n=4096,keyExpirationTime:a=0,date:s=new Date,subkeys:c=[{}],format:u="armored",config:h}=g,y=Ut(g,["userIDs","passphrase","type","curve","rsaBits","keyExpirationTime","date","subkeys","format","config"]);ta(h=be(be({},M),h)),t||r?(t=t||"ecc",r=r||"curve25519Legacy"):(t=h.v6Keys?"curve25519":"ecc",r="curve25519Legacy"),i=_e(i);let d=Object.keys(y);if(d.length>0)throw Error("Unknown option: "+d.join(", "));if(i.length===0&&!h.v6Keys)throw Error("UserIDs are required for V4 keys");if(t==="rsa"&&n<h.minRSABits)throw Error(`rsaBits should be at least ${h.minRSABits}, got: ${n}`);let w={userIDs:i,passphrase:e,type:t,rsaBits:n,curve:r,keyExpirationTime:a,date:s,subkeys:c};try{let{key:m,revocationCertificate:b}=yield function(v,A){return f(this,null,function*(){v.sign=!0,(v=On(v)).subkeys=v.subkeys.map((P,k)=>On(v.subkeys[k],v));let S=[Ac(v,A)];S=S.concat(v.subkeys.map(P=>Zs(P,A)));let K=yield Promise.all(S),D=yield Sc(K[0],K.slice(1),v,A),B=yield D.getRevocationCertificate(v.date,A);return D.revocationSignatures=[],{key:D,revocationCertificate:B}})}(w,h);return m.getKeys().forEach(({keyPacket:v})=>Bt(v,h)),{privateKey:Ja(m,u,h),publicKey:Ja(m.toPublic(),u,h),revocationCertificate:b}}catch(m){throw l.wrapError("Error generating keypair",m)}})}function Rc(b){return f(this,null,function*(){var v=b,{message:i,encryptionKeys:e,signingKeys:t,passwords:r,sessionKey:n,format:a="armored",signature:s=null,wildcard:c=!1,signingKeyIDs:u=[],encryptionKeyIDs:h=[],date:y=new Date,signingUserIDs:p=[],encryptionUserIDs:g=[],signatureNotations:d=[],config:w}=v,m=Ut(v,["message","encryptionKeys","signingKeys","passwords","sessionKey","format","signature","wildcard","signingKeyIDs","encryptionKeyIDs","date","signingUserIDs","encryptionUserIDs","signatureNotations","config"]);if(ta(w=be(be({},M),w)),to(i),Cc(a),e=_e(e),t=_e(t),r=_e(r),u=_e(u),h=_e(h),p=_e(p),g=_e(g),d=_e(d),m.detached)throw Error("The `detached` option has been removed from openpgp.encrypt, separately call openpgp.sign instead. Don't forget to remove the `privateKeys` option as well.");if(m.publicKeys)throw Error("The `publicKeys` option has been removed from openpgp.encrypt, pass `encryptionKeys` instead");if(m.privateKeys)throw Error("The `privateKeys` option has been removed from openpgp.encrypt, pass `signingKeys` instead");if(m.armor!==void 0)throw Error("The `armor` option has been removed from openpgp.encrypt, pass `format` instead.");let A=Object.keys(m);if(A.length>0)throw Error("Unknown option: "+A.join(", "));t||(t=[]);try{if((t.length||s)&&(i=yield i.sign(t,e,s,u,y,p,h,d,w)),i=i.compress(yield function(){return f(this,arguments,function*(K=[],D=new Date,B=[],P=M){let k=o.compression.uncompressed,U=P.preferredCompressionAlgorithm;return(yield Promise.all(K.map(function(E,C){return f(this,null,function*(){let x=(yield E.getPrimarySelfSignature(D,B[C],P)).preferredCompressionAlgorithms;return!!x&&x.indexOf(U)>=0})}))).every(Boolean)?U:k})}(e,y,g,w),w),i=yield i.encrypt(e,r,n,c,h,y,g,w),a==="object")return i;let S=a==="armored"?i.armor(w):i.write();return yield ro(S)}catch(S){throw l.wrapError("Error encrypting message",S)}})}function zc(p){return f(this,null,function*(){var g=p,{message:i,decryptionKeys:e,passwords:t,sessionKeys:r,verificationKeys:n,expectSigned:a=!1,format:s="utf8",signature:c=null,date:u=new Date,config:h}=g,y=Ut(g,["message","decryptionKeys","passwords","sessionKeys","verificationKeys","expectSigned","format","signature","date","config"]);if(ta(h=be(be({},M),h)),to(i),n=_e(n),e=_e(e),t=_e(t),r=_e(r),y.privateKeys)throw Error("The `privateKeys` option has been removed from openpgp.decrypt, pass `decryptionKeys` instead");if(y.publicKeys)throw Error("The `publicKeys` option has been removed from openpgp.decrypt, pass `verificationKeys` instead");let d=Object.keys(y);if(d.length>0)throw Error("Unknown option: "+d.join(", "));try{let w=yield i.decrypt(e,t,r,u,h);n||(n=[]);let m={};if(m.signatures=c?yield w.verifyDetached(c,n,u,h):yield w.verify(n,u,h),m.data=s==="binary"?w.getLiteralData():w.getText(),m.filename=w.getFilename(),xc(m,i),a){if(n.length===0)throw Error("Verification keys are required to verify message signatures");if(m.signatures.length===0)throw Error("Message is not signed");m.data=Fe([m.data,jt(()=>f(this,null,function*(){return yield l.anyPromise(m.signatures.map(b=>b.verified)),s==="binary"?new Uint8Array:""}))])}return m.data=yield ro(m.data),m}catch(w){throw l.wrapError("Error decrypting message",w)}})}function to(i){if(!(i instanceof Nr))throw Error("Parameter [message] needs to be of type Message")}function Cc(i){if(i!=="armored"&&i!=="binary"&&i!=="object")throw Error("Unsupported format "+i)}var Ic=Object.keys(M).length;function ta(i){let e=Object.keys(i);if(e.length!==Ic){for(let t of e)if(M[t]===void 0)throw Error("Unknown config property: "+t)}}function _e(i){return i&&!l.isArray(i)&&(i=[i]),i}function ro(i){return f(this,null,function*(){return l.isStream(i)==="array"?ke(i):i})}function xc(i,e){i.data=Ht(e.packets.stream,(t,r)=>f(this,null,function*(){yield Xt(i.data,r,{preventClose:!0});let n=Ge(r);try{yield ke(t,a=>a),yield n.close()}catch(a){yield n.abort(a)}}))}function Ja(i,e,t){switch(e){case"object":return i;case"armored":return i.armor(t);case"binary":return i.write();default:throw Error("Unsupported format "+e)}}export{o as a,Bc as b,Tc as c,Mc as d,Lc as e,Fc as f,Rc as g,zc as h};
