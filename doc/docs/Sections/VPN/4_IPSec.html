<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>IPsec | FWCloud-UI</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="User&#39;s manual">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/manual/assets/css/0.styles.726cd4c7.css" as="style"><link rel="preload" href="/manual/assets/js/app.bd85ee5e.js" as="script"><link rel="preload" href="/manual/assets/js/2.81c34002.js" as="script"><link rel="preload" href="/manual/assets/js/1.9918cdf1.js" as="script"><link rel="preload" href="/manual/assets/js/57.aa58712d.js" as="script"><link rel="prefetch" href="/manual/assets/js/10.18e280b2.js"><link rel="prefetch" href="/manual/assets/js/11.532fb960.js"><link rel="prefetch" href="/manual/assets/js/12.67238036.js"><link rel="prefetch" href="/manual/assets/js/13.d9bc12e0.js"><link rel="prefetch" href="/manual/assets/js/14.c1e18cc4.js"><link rel="prefetch" href="/manual/assets/js/15.fbba562b.js"><link rel="prefetch" href="/manual/assets/js/16.4574fd2a.js"><link rel="prefetch" href="/manual/assets/js/17.9e69dfdb.js"><link rel="prefetch" href="/manual/assets/js/18.99e6bfc2.js"><link rel="prefetch" href="/manual/assets/js/19.58d0e401.js"><link rel="prefetch" href="/manual/assets/js/20.d718e0a8.js"><link rel="prefetch" href="/manual/assets/js/21.4d2eb33f.js"><link rel="prefetch" href="/manual/assets/js/22.502e27ce.js"><link rel="prefetch" href="/manual/assets/js/23.170ad083.js"><link rel="prefetch" href="/manual/assets/js/24.64a9493f.js"><link rel="prefetch" href="/manual/assets/js/25.362e487a.js"><link rel="prefetch" href="/manual/assets/js/26.c6a2aeaa.js"><link rel="prefetch" href="/manual/assets/js/27.4fc045e1.js"><link rel="prefetch" href="/manual/assets/js/28.c9e64aad.js"><link rel="prefetch" href="/manual/assets/js/29.8860e752.js"><link rel="prefetch" href="/manual/assets/js/3.244f0799.js"><link rel="prefetch" href="/manual/assets/js/30.a377e902.js"><link rel="prefetch" href="/manual/assets/js/31.3092c650.js"><link rel="prefetch" href="/manual/assets/js/32.ec1f5379.js"><link rel="prefetch" href="/manual/assets/js/33.e63508dc.js"><link rel="prefetch" href="/manual/assets/js/34.ba49c4ba.js"><link rel="prefetch" href="/manual/assets/js/35.01358bce.js"><link rel="prefetch" href="/manual/assets/js/36.e56b8664.js"><link rel="prefetch" href="/manual/assets/js/37.28b031ab.js"><link rel="prefetch" href="/manual/assets/js/38.361673f4.js"><link rel="prefetch" href="/manual/assets/js/39.f4ed5897.js"><link rel="prefetch" href="/manual/assets/js/4.db06a48d.js"><link rel="prefetch" href="/manual/assets/js/40.55b31cee.js"><link rel="prefetch" href="/manual/assets/js/41.b623e49d.js"><link rel="prefetch" href="/manual/assets/js/42.db61dfeb.js"><link rel="prefetch" href="/manual/assets/js/43.2f639234.js"><link rel="prefetch" href="/manual/assets/js/44.2b5a1587.js"><link rel="prefetch" href="/manual/assets/js/45.75d65825.js"><link rel="prefetch" href="/manual/assets/js/46.97d1542c.js"><link rel="prefetch" href="/manual/assets/js/47.eb9a4631.js"><link rel="prefetch" href="/manual/assets/js/48.31f32cc7.js"><link rel="prefetch" href="/manual/assets/js/49.d683a3e8.js"><link rel="prefetch" href="/manual/assets/js/5.caca6451.js"><link rel="prefetch" href="/manual/assets/js/50.b62a3343.js"><link rel="prefetch" href="/manual/assets/js/51.502f044e.js"><link rel="prefetch" href="/manual/assets/js/52.edeb0c04.js"><link rel="prefetch" href="/manual/assets/js/53.18fe2aee.js"><link rel="prefetch" href="/manual/assets/js/54.a790c127.js"><link rel="prefetch" href="/manual/assets/js/55.3c60ad94.js"><link rel="prefetch" href="/manual/assets/js/56.d5726f03.js"><link rel="prefetch" href="/manual/assets/js/58.5c567535.js"><link rel="prefetch" href="/manual/assets/js/59.b728d18e.js"><link rel="prefetch" href="/manual/assets/js/6.963cb6f5.js"><link rel="prefetch" href="/manual/assets/js/7.f5c742a4.js"><link rel="prefetch" href="/manual/assets/js/vendors~docsearch.cc58001a.js">
    <link rel="stylesheet" href="/manual/assets/css/0.styles.726cd4c7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/manual/" class="home-link router-link-active"><img src="/manual/assets/img/fwcloud_q.png" alt="FWCloud-UI" class="logo"> <span class="site-name can-hide">FWCloud-UI</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/manual/docs/Sections/Introduction/" class="nav-link">
  Introduction
</a></div><div class="nav-item"><a href="/manual/docs/Sections/Overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/manual/docs/Sections/Configuration/" class="nav-link">
  Configuration
</a></div><div class="nav-item"><a href="/manual/docs/Sections/FWClouds/" class="nav-link">
  FWClouds
</a></div><div class="nav-item"><a href="/manual/docs/Sections/Firewalls/" class="nav-link">
  Firewalls
</a></div><div class="nav-item"><a href="/manual/docs/Sections/Plugins/" class="nav-link">
  Plugins
</a></div><div class="nav-item"><a href="/manual/docs/Sections/Agent/" class="nav-link">
  Agent
</a></div><div class="nav-item"><a href="/manual/docs/Sections/Objects/" class="nav-link">
  Objects
</a></div><div class="nav-item"><a href="/manual/docs/Sections/Policy/" class="nav-link">
  Policy
</a></div><div class="nav-item"><a href="/manual/docs/Sections/VPN/" class="nav-link router-link-active">
  VPN
</a></div><div class="nav-item"><a href="/manual/docs/Sections/Routing/" class="nav-link">
  Routing
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/manual/docs/Sections/Introduction/" class="nav-link">
  Introduction
</a></div><div class="nav-item"><a href="/manual/docs/Sections/Overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/manual/docs/Sections/Configuration/" class="nav-link">
  Configuration
</a></div><div class="nav-item"><a href="/manual/docs/Sections/FWClouds/" class="nav-link">
  FWClouds
</a></div><div class="nav-item"><a href="/manual/docs/Sections/Firewalls/" class="nav-link">
  Firewalls
</a></div><div class="nav-item"><a href="/manual/docs/Sections/Plugins/" class="nav-link">
  Plugins
</a></div><div class="nav-item"><a href="/manual/docs/Sections/Agent/" class="nav-link">
  Agent
</a></div><div class="nav-item"><a href="/manual/docs/Sections/Objects/" class="nav-link">
  Objects
</a></div><div class="nav-item"><a href="/manual/docs/Sections/Policy/" class="nav-link">
  Policy
</a></div><div class="nav-item"><a href="/manual/docs/Sections/VPN/" class="nav-link router-link-active">
  VPN
</a></div><div class="nav-item"><a href="/manual/docs/Sections/Routing/" class="nav-link">
  Routing
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>VPN</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/manual/docs/Sections/VPN/" aria-current="page" class="sidebar-link">PKI</a></li><li><a href="/manual/docs/Sections/VPN/2_OpenVPN.html" class="sidebar-link">OpenVPN</a></li><li><a href="/manual/docs/Sections/VPN/3_Wireguard.html" class="sidebar-link">WireGuard</a></li><li><a href="/manual/docs/Sections/VPN/4_IPSec.html" aria-current="page" class="active sidebar-link">IPsec</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/manual/docs/Sections/VPN/4_IPSec.html#ipsec" class="sidebar-link">IPsec</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/manual/docs/Sections/VPN/4_IPSec.html#server-configuration" class="sidebar-link">Server Configuration</a></li><li class="sidebar-sub-header"><a href="/manual/docs/Sections/VPN/4_IPSec.html#install-sever-configuration" class="sidebar-link">Install Sever Configuration</a></li><li class="sidebar-sub-header"><a href="/manual/docs/Sections/VPN/4_IPSec.html#client-configuration" class="sidebar-link">Client Configuration</a></li><li class="sidebar-sub-header"><a href="/manual/docs/Sections/VPN/4_IPSec.html#install-client-configuration" class="sidebar-link">Install Client Configuration</a></li><li class="sidebar-sub-header"><a href="/manual/docs/Sections/VPN/4_IPSec.html#prefixes" class="sidebar-link">Prefixes</a></li><li class="sidebar-sub-header"><a href="/manual/docs/Sections/VPN/4_IPSec.html#server-config-file" class="sidebar-link">Server Config File</a></li><li class="sidebar-sub-header"><a href="/manual/docs/Sections/VPN/4_IPSec.html#clients-config-file" class="sidebar-link">Clients Config File</a></li><li class="sidebar-sub-header"><a href="/manual/docs/Sections/VPN/4_IPSec.html#edit-configurations" class="sidebar-link">Edit Configurations</a></li><li class="sidebar-sub-header"><a href="/manual/docs/Sections/VPN/4_IPSec.html#block-unblock-client-configurations" class="sidebar-link">Block / Unblock Client Configurations</a></li><li class="sidebar-sub-header"><a href="/manual/docs/Sections/VPN/4_IPSec.html#uninstall-configurations" class="sidebar-link">Uninstall Configurations</a></li><li class="sidebar-sub-header"><a href="/manual/docs/Sections/VPN/4_IPSec.html#delete-configurations" class="sidebar-link">Delete Configurations</a></li></ul></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="ipsec"><a href="#ipsec" class="header-anchor">#</a> IPsec</h2> <p>IPsec (Internet Protocol Security) is a suite of protocols used to secure IP communications by authenticating and encrypting each IP packet exchanged between network endpoints. It is commonly used to implement Virtual Private Networks (VPNs), particularly in site-to-site and enterprise network environments.</p> <p>IPsec operates at the network layer and provides security services such as data confidentiality, integrity, and authentication. It can be used in combination with key management protocols, such as Internet Key Exchange (IKE), to negotiate security associations and cryptographic parameters between peers.</p> <p>In an IPsec VPN deployment, secure tunnels are established between gateways or hosts, allowing protected communication over untrusted networks. IPsec supports multiple authentication methods, including pre-shared keys and certificate-based authentication using Public Key Infrastructure (PKI).</p> <p>Due to its flexibility, standards-based design, and widespread support across networking devices and operating systems, IPsec remains a widely adopted technology for secure VPN connectivity.</p> <p>FWCloud provides a centralized environment for the deployment and administration of IPsec-based VPN connections.</p> <div class="custom-block tip"><p class="custom-block-title">Terminology Note: Server / Client vs. IPsec Roles</p> <p>For consistency with the previous sections of this documentation, we will continue using the terms server and client when describing IPsec-based VPN scenarios.</p> <p>It is important to note that these terms are not technically correct in the context of IPsec.</p> <p>IPsec does not follow a true client/server model. Instead, both endpoints are considered peers, and their roles are defined dynamically during the Internet Key Exchange (IKE) process:</p> <ul><li><p>Initiator: the peer that initiates the IKE negotiation</p></li> <li><p>Responder: the peer that responds to the negotiation</p></li></ul> <p>Either endpoint can act as an initiator or responder depending on which side brings up the tunnel. There is no permanent hierarchical relationship as implied by the terms server and client.</p> <p>In practice, however, many IPsec deployments, especially road-warrior or remote-access VPNs, behave similarly to a client/server architecture:</p> <ul><li><p>A central VPN gateway with a static public IP</p></li> <li><p>Multiple remote endpoints connecting to it</p></li></ul> <p>For this reason, and to maintain conceptual continuity with earlier VPN examples, this documentation will use:</p> <ul><li><p>Server to refer to the IPsec gateway (typically the IKE responder)</p></li> <li><p>Client to refer to the remote endpoint (typically the IKE initiator)</p></li></ul> <p>These terms are used purely for readability and consistency, and should not be interpreted as reflecting the actual IPsec protocol architecture.</p></div> <h3 id="server-configuration"><a href="#server-configuration" class="header-anchor">#</a> Server Configuration</h3> <p>To use the server certificate drag it and drop it over the name of the firewall that is going to be the VPN server or one of the peers of the VPN connection.</p> <p><img src="/manual/assets/img/wg-cert_server-drag.png" alt="Server Drag"><br></p> <p><img src="/manual/assets/img/ipsec-cert_server-drop.png" alt="Server Drop"><br></p> <p>A dedicated panel is provided to configure the server parameters. Users can modify the values of these parameters according to their requirements, remove unnecessary entries, or add new ones. Certain parameters are mandatory and cannot be deleted; FWCloud enforces these restrictions to ensure proper VPN functionality.</p> <p>You need write down the network and the mask of the VPN network. FWCloud will create an object named LAN-VPN-xxxx, where xxxx is the common name of the Sever Certificate, it can be modified. FWCloud will use this network for the value of the IPsec attribute &quot;leftsubnet&quot; and the first IP address of this network for the attribute &quot;left&quot;.</p> <p><img src="/manual/assets/img/ipsec-cert_server-form.png" alt="Server Form"><br></p> <p>A road-warrior VPN scenario is designed to provide secure remote access for individual clients, such as users or devices, that connect from varying and often unknown IP addresses. In this model, the VPN server typically has a fixed IP address, while clients connect from dynamic networks. Each client is authenticated individually and is usually assigned a unique virtual IP address by the server from its internal subnet. In this case address from LAN-VPN-xxx are given to &quot;rightsourceip&quot; attribute.</p> <p>Road-warrior VPNs focus on secure access for mobile or remote clients. The following is an example of the generated <code>ipsec.conf</code> file:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># FWCloud.net - Developed by SOLTECSIS (https://soltecsis.com)</span>
<span class="token comment"># Generated: Tue Dec 16 2025 14:13:18 GMT+0000 (Coordinated Universal Time)</span>
<span class="token comment"># Certificate Common Name: VPN-Server</span>
<span class="token comment"># Firewall: FW</span>
<span class="token comment"># IPsec Server: ipsec</span>
<span class="token comment"># Type: Server</span>

config setup
 <span class="token assign-left variable">charondebug</span><span class="token operator">=</span><span class="token string">&quot;ike 1, knl 1, cfg 0&quot;</span>

conn %default
 <span class="token builtin class-name">type</span> <span class="token operator">=</span> tunnel
 keyexchange <span class="token operator">=</span> ikev2
 ike <span class="token operator">=</span> aes256-sha256-modp2048<span class="token operator">!</span>
 esp <span class="token operator">=</span> aes256-sha256<span class="token operator">!</span>
 dpdaction <span class="token operator">=</span> <span class="token function">clear</span>
 dpddelay <span class="token operator">=</span> 300s
 rekey <span class="token operator">=</span> no
 
 left <span class="token operator">=</span> <span class="token number">192.168</span>.1.1
 leftid <span class="token operator">=</span> <span class="token string">&quot;CN=VPN-Server&quot;</span>
 leftcert <span class="token operator">=</span> VPN-Server.crt
 leftsubnet <span class="token operator">=</span> <span class="token number">10.13</span>.13.0/24
 leftfirewall <span class="token operator">=</span> <span class="token function">yes</span>

 rightauth <span class="token operator">=</span> pubkey
 auto <span class="token operator">=</span> ignore

conn ENGINEERS-Anna
 rightsourceip <span class="token operator">=</span> <span class="token number">10.13</span>.13.2/32
 rightid <span class="token operator">=</span> <span class="token string">&quot;CN=ENGINEERS-Anna.Two-00&quot;</span>
 auto <span class="token operator">=</span> <span class="token function">add</span>
 <span class="token assign-left variable">right</span><span class="token operator">=</span>%any
</code></pre></div><p>The following section provides a brief description of commonly used parameters in this file:</p> <ul><li>left – Defines the server’s network endpoint.</li></ul> <p>Value: The server’s private IP or hostname (e.g., 192.168.1.1). The value of the parameter must correspond to the peer’s real network IP address. It must not be set to a virtual or inner IP address assigned to one of the tunnel endpoints, because it is used during the initial IKE negotiation to establish the VPN tunnel. At this stage, the virtual or inner IP addresses have not yet been assigned and are not reachable.</p> <ul><li>leftid – Specifies the server identity used in the VPN.</li></ul> <p>Value: Can be an IP address, FQDN, or Distinguished Name from the server certificate.</p> <ul><li>leftcert – References the server certificate file.</li></ul> <p>Value: Path to the certificate file (e.g., /etc/ipsec.d/certs/serverCert.crt).</p> <ul><li>leftsubnet - Specifies the server-side subnet or subnets that are accessible through the VPN. Defines which internal resources are routed to the VPN clients.</li></ul> <p>Value: Can be an IP address or network (e.g., 10.200.0.0/24)</p> <ul><li>leftauth – Sets the authentication method for the server.</li></ul> <p>Possible values: psk (pre-shared key), rsasig (RSA signature via certificates) or pubkey (public key).</p> <ul><li>leftfirewall – Controls automatic firewall rules for the server.</li></ul> <p>Possible values: yes (enables automatic iptables rules), no (manual configuration).</p> <ul><li>right – Defines the client endpoint.</li></ul> <p>Value: Typically %any for Road-Warrior clients, allowing connections from any IP.</p> <ul><li>rightid – Specifies the client identity.</li></ul> <p>Value: IP address, FQDN, or certificate Distinguished Name matching the client certificate.</p> <ul><li>rightcert – References the client certificate file (optional for server configuration; primarily used on the client).</li></ul> <p>Value: Path to the client certificate.</p> <ul><li>rightsubnet - Usually set to the client’s local subnet or left empty for single-host clients.</li></ul> <p>Value: rightsubnet=192.168.0.0/24 or 0.0.0.0/0 if routing all traffic through VPN.</p> <ul><li>rightauth – Sets the authentication method for the client.</li></ul> <p>Possible values: psk, rsasig or pubkey.</p> <ul><li>rightsourceip – Assigns the virtual IP address, or IP range for clients.</li></ul> <p>Value: Subnet from which the server dynamically allocates unique IPs to each client (e.g., 10.13.13.0/24).</p> <p>In contrast, a Site-to-Site VPN scenario connects two or more fixed networks over a secure tunnel. Each endpoint represents a gateway with a static IP address and defined local subnets. Once the tunnel is established, all devices within each site can communicate with the remote network without requiring individual VPN clients or per-user authentication.</p> <p>Site-to-Site VPNs are intended for permanent, network-to-network connectivity between fixed locations.
The following example shows the contents of the <code>ipsec.conf</code> file for this scenario:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>
<span class="token comment"># FWCloud.net - Developed by SOLTECSIS (https://soltecsis.com)</span>
<span class="token comment"># Generated: Tue Dec 16 2025 12:11:03 GMT+0100 (Central European Standard Time)</span>
<span class="token comment"># Certificate Common Name: VPN-Server</span>
<span class="token comment"># Firewall: FW</span>
<span class="token comment"># IPsec Server: ipsec</span>
<span class="token comment"># Type: Server</span>

config setup
 <span class="token assign-left variable">charondebug</span><span class="token operator">=</span><span class="token string">&quot;ike 1, knl 1, cfg 0&quot;</span>
  
conn %default
 keyexchange <span class="token operator">=</span> ikev2
 ike <span class="token operator">=</span> aes256-sha256-modp2048<span class="token operator">!</span>
 esp <span class="token operator">=</span> aes256-sha256<span class="token operator">!</span>
 dpdaction <span class="token operator">=</span> <span class="token function">clear</span>
 dpddelay <span class="token operator">=</span> 300s
 rekey <span class="token operator">=</span> no

 left <span class="token operator">=</span> <span class="token number">10.1</span>.1.1
 leftsubnet <span class="token operator">=</span> <span class="token number">10.200</span>.0.0/24
 leftid <span class="token operator">=</span> <span class="token string">&quot;CN=VPN-Server&quot;</span>
 leftcert <span class="token operator">=</span> VPN-Server.crt
 leftfirewall <span class="token operator">=</span> <span class="token function">yes</span>
 rightauth <span class="token operator">=</span> pubkey
 auto <span class="token operator">=</span> ignore

conn ENGINEERS-Anna
 right <span class="token operator">=</span> ███.███.███.███
 rightsubnet <span class="token operator">=</span> <span class="token number">192.168</span>.0.0/24
 rightid <span class="token operator">=</span> <span class="token string">&quot;CN=ENGINEERS-Anna-Two-00&quot;</span>
 auto <span class="token operator">=</span> start
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">Note:</p> <p>In this example the right side is behind NAT and its real public IP address has been intentionally hidden</p></div> <p>Although the configuration in this form is enough for the VPN Sever configuration you can modify these settings and modify, add or delete the allowed options, like the name of the file that will store this configuration or its folder or other options like leftid.</p> <p><img src="/manual/assets/img/ipsec-cert_server-form.png" alt="Server Form"><br></p> <p>For reference, next are the allowed options: keyexchange, ike, esp, dpdaction, dpddelay, rekey, left, leftid, leftcert, leftsubnet, leftfirewall, rightauth, auto, charondebug, right, rightsubnet. More information about the options can be found in <a href="https://docs.strongswan.org" target="_blank" rel="noopener noreferrer"> strongSwan Docs <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>All parameters can also be modified later on if you double click the name of the Sever Certificate on the right panel of VPN section or if you right click and select <code>Edit configuration</code>.</p> <h3 id="install-sever-configuration"><a href="#install-sever-configuration" class="header-anchor">#</a> Install Sever Configuration</h3> <p>Once the VPN Server configuration is created, it needs to be installed in the firewall. Right click over the server certificate and select <code>Install Configuration</code>.</p> <p><img src="/manual/assets/img/ipsec-cert_server_install.png" alt="Server Install"><br></p> <p>If FWCloud access the target firewall via SSH and the credentials are not configured a pop up windows will ask for them, otherwise the installation will proceed.</p> <p><img src="/manual/assets/img/cert_server_install-form.png" alt="Server Install Form"><br></p> <p>When using SSH access, the user provided also needs to be able to execute &quot;sudo&quot; commands, otherwise the next error will occur:</p> <p><img src="/manual/assets/img/ipsec-cert_server_install-error.png" alt="Server Install Error"><br></p> <p>If no problems occur the VPN Server configuration will be installed on the target firewall</p> <p><img src="/manual/assets/img/ipsec-server_install-success.png" alt="Server Install Success"><br></p> <p>The installation process generates the configuration files <code>/etc/ipsec.conf</code> and <code>/etc/ipsec.secrets</code>, and deploys the required PKI infrastructure, including the certificates, on the target firewall.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># tree /etc/ipsec.d</span>
/etc/ipsec.d
├── aacerts
├── acerts
├── cacerts
│   └── ca.crt
├── certs
│   └── VPN-Server.crt
├── crls
├── ocspcerts
├── policies
├── private
│   └── VPN-Server.key
└── reqs
</code></pre></div><h3 id="client-configuration"><a href="#client-configuration" class="header-anchor">#</a> Client Configuration</h3> <p>To use the client certificate drag it and drop it over the name of the VPN server. Note that the VPN server background turns green we you hover the certificate over it.</p> <p><img src="/manual/assets/img/ipsec-cert_client-drag.png" alt="Client Drag"><br></p> <p><img src="/manual/assets/img/ipsec-cert_client-drop.png" alt="Client Drop"><br></p> <p>If the VPN server already has another certificate with the same name you will receive a warning and the certificate will not be moved to the server. The name of the certificates must be unique within the VPN server scope.</p> <p><img src="/manual/assets/img/ipsec-cert_drop-error.png" alt="Client Drop Error"><br></p> <p>If this the first certificate you drop, automatically a new form is opened where you can configure the IPsec options for the client.</p> <p><img src="/manual/assets/img/ipsec-cert_client-form.png" alt="Client Form"><br></p> <p>The <code>right</code> attribute is required, you can fill its value directly or using the magnifying glass to look for a FWCloud object:</p> <p><img src="/manual/assets/img/ipsec-right_object.png" alt="Client Form"><br></p> <p>Select the appropriate object and click the <img src="/manual/assets/img/tick.png" alt="Tick"> icon, and then click on the <code>+</code> icon next to the field.</p> <p>In the VPN client configuration form you can add, delete or modify options like keyexchange, ike, esp, left, leftid, leftcert,leftauth, leftsourceip, right, rightid, rightauth, rightsubnet, charondebub and auto. More information about this options can be found in <a href="https://docs.strongswan.org" target="_blank" rel="noopener noreferrer"> strongSwan Docs <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>When you have the VPN client configuration ready press <code>Save changes</code> button in right bottom side of the form. The new client certificate appears in the FIREWALLS/CLUSTER side and the server configuration is adapted to include the new peer. The server configurations needs to be installed again in the firewall to reflect these changes, what is indicated by an <img src="/manual/assets/img/I.png" alt="I"> icon by the server name.</p> <p>When you drop the client certificate in the VPN server, if this server already have other client certificates you will be asked if you want to clone the configuration from another VPN client.</p> <p><img src="/manual/assets/img/wg-cert_client-clone.png" alt="Clone Client Cert"><br></p> <p>In this form you can choose from the drop down field which client configuration you want to copy its options from. When you are configuring multiple clients this feature save you a lot of time and avoid mistakes. After that the client configuration form will be opened.</p> <h3 id="install-client-configuration"><a href="#install-client-configuration" class="header-anchor">#</a> Install Client Configuration</h3> <p>Once the VPN client configuration is created, it is incorporated into the VPN server configuration. For this reason, the server configuration must be installed in the firewall in order for the client settings to take effect</p> <p>When a server configuration contains pending changes, an <img src="/manual/assets/img/I.png" alt="I"> icon is displayed next to the server name. To apply the configuration, right-click on the server and select <code>Install Configuration</code>.</p> <p><img src="/manual/assets/img/ipsec-server_install-success.png" alt="Client Install Form"><br></p> <p>After the server configuration has been successfully installed in the firewall, the <img src="/manual/assets/img/I.png" alt="I"> icon is cleared, indicating that all changes have been applied.</p> <p>The client configuration file must be installed on the client system or systems, which are not directly accessible from FWCloud. From FWCloud, configuration installation is only supported on the server firewall (or left site). For the remote endpoint, the client configuration file must be downloaded and installed manually.</p> <p>To download the client configuration file, refer to the <a href="#clients-config-file"> Clients Config File </a> section.</p> <p>In addition, the corresponding client certificates (including both the private key and the public certificate), as well as the Certificate Authority (CA) certificate used to issue those certificates, must also be downloaded and installed on the client systems.</p> <h3 id="prefixes"><a href="#prefixes" class="header-anchor">#</a> Prefixes</h3> <p>Prefixes can also be created in the FIREWALL/CLUSTER section.</p> <p><img src="/manual/assets/img/ipsec-cert_prefix-fws.png" alt="VPN FW Prefix"><br></p> <p><img src="/manual/assets/img/ovpn_prefix-form.png" alt="VPN Prefix Form"><br></p> <div class="custom-block warning"><p class="custom-block-title">Do not confuse with PKI prefixes</p> <p>PKI prefixed are for organizational purposes only while WireGuard server prefixes can be used in the security policy.</p></div> <p>In the next figure you can see PKI prefixes on the left side are represented by <img src="/manual/assets/img/pki_prefix-icon.png" alt="PKI Prefix Icon"> while the prefixes created in the WireGuard server have a different <img src="/manual/assets/img/ovpn_prefix-icon.png" alt="OpenVPN Prefix Icon"> icon.</p> <p><img src="/manual/assets/img/ipsec-prefix-types.png" alt="Prefix types"><br></p> <p>You can use the <code>Prefix</code> when creating the policy rules. Instead of needing to add all IP addresses of every VPN connections of any client which his certificate name starts with a common part (the prefix), you can add that <code>Prefix</code> in the rule. The prefix can be dragged and dropped in the rule fields. Only non empty prefixes can be dropped.</p> <p><img src="/manual/assets/img/wg-empty-prefix.png" alt="VPN Prefix Policy"><br></p> <p>FWCloud-UI will display the prefixes in the Policy section when you expand the WireGuard branch inside the firewalls in the Firewalls group. Only VPN server prefixes will be displayed here.</p> <p><img src="/manual/assets/img/ipsec-cert_prefix_policy.png" alt="VPN Prefix Policy"><br></p> <p>Here you have an example with two rules using prefixes</p> <p><img src="/manual/assets/img/vpn_prefix-rule.png" alt="VPN Prefix Policy Rule"><br></p> <p>In this case since we have two VPN client configurations with the prefix ENGINEERS, the rule number 10 refers to any connections established from this two VPN clients</p> <p><img src="/manual/assets/img/ipsec-vpn_prefix-tree.png" alt="VPN Prefix Policy Rule"><br></p> <p>The use of prefixes makes the security policy more clear and easy to read. Also when you create new VPN client configurations with the same prefix you do not need to modify or create new rules. Although the policy needs to be compiled and installed again, since when it was installed in the firewall it did not yet have the new clients configurations.</p> <h3 id="server-config-file"><a href="#server-config-file" class="header-anchor">#</a> Server Config File</h3> <p>Although the VPN server configuration can be installed on the firewall from the FWCloud-UI, also you can get access to the file that stores this configuration, just right click and select <code>Configuration file</code>.</p> <p><img src="/manual/assets/img/ipsec-vpn_server_file.png" alt="Server VPN file"><br></p> <p>A new form is opened where you can download or copy the content of the file to the clipboard.</p> <p><img src="/manual/assets/img/ipsec-vpn_server_config_file.png" alt="Server VPN Config File"><br></p> <h3 id="clients-config-file"><a href="#clients-config-file" class="header-anchor">#</a> Clients Config File</h3> <p>The configuration file of the VPN clients can be obtained by right clicking on the client configuration name and select <code>Configuration file</code>.</p> <p><img src="/manual/assets/img/ipsec-vpn_client_file.png" alt="Client VPN file"><br></p> <p>A new form is opened where you can download or copy the content of the file to the clipboard.</p> <p><img src="/manual/assets/img/ipsec-vnp_client_config_file.png" alt="Client VPN Config File"><br></p> <p>If you copy it to the clipboard a popup message in the right top corner will indicate when the copy has finished.</p> <p><img src="/manual/assets/img/vpn_client_copied.png" alt="Client VPN File Copied"><br></p> <p>This file will be needed if you want to install the a VPN connection in the client equipment.</p> <h3 id="edit-configurations"><a href="#edit-configurations" class="header-anchor">#</a> Edit Configurations</h3> <p>In order to edit the VPN server configuration right click on the VPN server name and select <code>Edit configuration</code>.</p> <p><img src="/manual/assets/img/ipsec-vpn_server_edit.png" alt="Edit VPN Server"><br></p> <p>The configuration form for the server is opened and you can make any notifications to it.</p> <p><img src="/manual/assets/img/ipsec-cert_server-form.png" alt="Server Form"><br></p> <p>Also the VPN configuration of a client can be edited if you right click on the client configuration name and select <code>Edit configuration</code>.</p> <p><img src="/manual/assets/img/ipsec-vpn_client_edit.png" alt="Edit VPN Client"><br></p> <p>The configuration form for the client is opened.</p> <p><img src="/manual/assets/img/ipsec-cert_client-form.png" alt="Client Form"><br></p> <h3 id="block-unblock-client-configurations"><a href="#block-unblock-client-configurations" class="header-anchor">#</a> Block / Unblock Client Configurations</h3> <p>When a VPN connection is not going to be used for a temporal period it can be blocked, not allowing the connection to be established</p> <p><img src="/manual/assets/img/vpn-block.png" alt="Block VPN"><br></p> <p>The process will install the new server configuration to start to blocking the connection. If the password of the the firewall is not stored it will be required.</p> <p>A message informs the connection has been successfully blocked:</p> <p><img src="/manual/assets/img/ipsec-blocked-client-msg.png" alt="Block VPN Message"><br></p> <p>Now the server configuration has the peer configuration commented out:</p> <p><img src="/manual/assets/img/ipsec-config-blocked.png" alt="Peer lines commented out"><br></p> <p>VPN connections blocked are displayed in gray text and the icons change to reflect that.</p> <p><img src="/manual/assets/img/ipsec-vpn-blocked.png" alt="Blocked VPN connections"><br></p> <p>Any blocked VPN connection can the unblocked from the context menu:</p> <p><img src="/manual/assets/img/vpn-unblock.png" alt="Unblock VPN"><br></p> <p>Again the modified server configuration will be installed in the firewall, and a message will inform it has been unblocked.</p> <h3 id="uninstall-configurations"><a href="#uninstall-configurations" class="header-anchor">#</a> Uninstall Configurations</h3> <p>The VPN server configuration can be uninstalled from the firewall. All client configuration of the VPN server must be uninstalled first.</p> <p><img src="/manual/assets/img/ipsec-vpn_server_uninstall.png" alt="Server VPN Uninstall"><br></p> <p>FWCloud will check if there are client configurations for the server configuration. In that case it will not proceed and will show an error message.</p> <p><img src="/manual/assets/img/ipsec-server_uninstall-warn.png" alt="Server VPN Uninstall Warn"><br></p> <h3 id="delete-configurations"><a href="#delete-configurations" class="header-anchor">#</a> Delete Configurations</h3> <p>If a VPN configuration is no longer needed it can be removed. This can be done from the context menu of the configuration name. Right click and select <code>Delete configuration</code>.</p> <p><img src="/manual/assets/img/ipsec-vpn_server_delete.png" alt="VPN Server Delete"><br></p> <p>A server configuration can only be deleted if there are no client configurations. FWCloud will detect if client configurations exist.</p> <p><img src="/manual/assets/img/ipsec-vpn_server_delete-warn.png" alt="VPN Server Delete Warn"><br></p> <p>To delete a client configuration select <code>Delete configuration</code> from the client context menu.</p> <p><img src="/manual/assets/img/ipsec-vpn_client_delete-menu.png" alt="VPN Client Delete Menu"><br></p> <p>Again FWCloud will check first if there is any conflict that not allows the deletion and it will warn if that is the case.</p> <p><img src="/manual/assets/img/ipsec-vpn_client_delete-error.png" alt="Client VPN Delete Error"><br></p> <p>Otherwise you can proceed with client configuration deletion</p> <p><img src="/manual/assets/img/ipsec-vpn_client_delete.png" alt="Client VPN Delete"><br></p> <p>The server configuration is updated since this peer section is removed from it and needs to be reinstalled, as reflected by the <img src="/manual/assets/img/I.png" alt="I"> icon.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/manual/docs/Sections/VPN/3_Wireguard.html" class="prev">
        WireGuard
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/manual/assets/js/app.bd85ee5e.js" defer></script><script src="/manual/assets/js/2.81c34002.js" defer></script><script src="/manual/assets/js/1.9918cdf1.js" defer></script><script src="/manual/assets/js/57.aa58712d.js" defer></script>
  </body>
</html>
